import{d as q,a as M,u as R,r as n,j as e,f as l,z as c}from"./index-BDiw9Bx0.js";import{D as y}from"./dollar-sign-DpHX-cdY.js";import{C as T}from"./circle-check-big-GBkkbCeO.js";import{C as A}from"./clock-DzH9WZzL.js";import{S as L}from"./send-5T7q3yfJ.js";const V=()=>{const{teacherId:N}=q(),{userRole:s,currentUserId:r}=M(),P=R(),a=N,[x,C]=n.useState([]),[d,g]=n.useState(""),[i,p]=n.useState(null),[o,S]=n.useState(null),b=n.useRef(null),[k,u]=n.useState(!1),[m,_]=n.useState(59),[f,w]=n.useState(!1);n.useEffect(()=>{let t;return r&&a&&(async()=>{try{const h=await l.getPublicProfile(a);S(h);const E=await l.getRequestStatus(s==="student"?r:a,s==="student"?a:r);p(E);const z=s==="student"?r:a,D=s==="student"?a:r;t=l.subscribeToChat(z,D,$=>{C($)})}catch(h){console.error("Chat init error",h)}})(),()=>{t&&t()}},[a,r,s]),n.useEffect(()=>{var t;(t=b.current)==null||t.scrollIntoView({behavior:"smooth"})},[x]);const j=async()=>{if(d.trim())try{const t={studentId:s==="student"?r:a,teacherId:s==="student"?a:r,text:d,sender:s||"student",timestamp:Date.now(),type:"text"};s==="student"&&!i&&(await l.createRequest({id:`req_${Date.now()}`,studentId:r,teacherId:a,status:"pending",timestamp:Date.now(),message:d}),p("pending")),await l.sendMessage(t),g("")}catch{c.error("Error al enviar mensaje")}},I=async()=>{w(!0);try{const t=await l.processPayment(r,a,m);if(t.success){c.success(t.message),u(!1);const v=new Date().toLocaleString("es-ES",{month:"long"});await l.sendMessage({studentId:r,teacherId:a,text:`ðŸ’° He pagado la mensualidad de ${v} (${m}â‚¬)`,sender:"student",timestamp:Date.now(),type:"payment_request"})}else c.error(t.message)}catch(t){console.error("Payment error",t),c.error("Error al procesar el pago")}finally{w(!1)}};return o?e.jsxs("div",{className:"max-w-2xl mx-auto h-[calc(100vh-100px)] flex flex-col pt-4 px-4 sm:px-0 animate-fade-in",children:[e.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-t-2xl p-4 flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:o.image,alt:o.name,className:"w-12 h-12 rounded-full object-cover border border-[#403d39]"}),e.jsxs("div",{className:"hidden sm:block",children:[e.jsx("h2",{className:"font-bold text-white text-lg leading-tight",children:o.name}),e.jsxs("p",{className:"text-[10px] uppercase font-bold tracking-widest text-[#8b8982]",children:[s==="student"?"Profesor":"Estudiante"," â€¢ ELO ",o.elo]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s==="student"&&i==="approved"&&e.jsxs("button",{onClick:()=>u(!0),className:"bg-gold/10 hover:bg-gold/20 text-gold border border-gold/30 px-3 py-1.5 rounded-lg font-bold flex items-center gap-2 text-xs transition-all active:scale-95",children:[e.jsx(y,{size:14})," Pagar"]}),i==="approved"&&e.jsxs("button",{onClick:()=>P(s==="student"?`/classroom/${a}`:`/classroom/${r}`),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-1.5 rounded-lg font-bold flex items-center gap-2 text-xs transition-all shadow-lg active:scale-95",children:[e.jsx(T,{size:14})," Ir al Aula"]}),i==="pending"&&e.jsxs("div",{className:"bg-orange-500/10 text-orange-400 border border-orange-500/20 px-3 py-1.5 rounded-lg text-xs flex items-center gap-2 font-bold",children:[e.jsx(A,{size:14})," Pendiente"]})]})]}),e.jsxs("div",{className:"flex-grow bg-[#161512]/80 border-x border-[#302e2b] p-4 overflow-y-auto space-y-4 custom-scrollbar",children:[x.length===0?e.jsxs("div",{className:"text-center text-[#666] mt-10 space-y-2",children:[e.jsx("p",{className:"text-sm",children:s==="student"?`CuÃ©ntale a ${o.name} por quÃ© quieres aprender ajedrez.`:`Inicio del chat con ${o.name}.`}),e.jsx("div",{className:"w-12 h-0.5 bg-white/5 mx-auto"})]}):x.map(t=>e.jsx("div",{className:`flex ${t.sender===s?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl px-4 py-2.5 shadow-sm text-sm ${t.sender===s?"bg-blue-600 text-white rounded-br-none":"bg-[#262421] text-text-secondary border border-white/5 rounded-bl-none"}`,children:[e.jsx("p",{className:"leading-relaxed",children:t.text}),e.jsx("span",{className:"text-[9px] block text-right mt-1 opacity-60",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},t.id)),e.jsx("div",{ref:b})]}),e.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-b-2xl p-4 flex gap-3 shadow-2xl",children:[e.jsx("input",{type:"text",value:d,onChange:t=>g(t.target.value),onKeyDown:t=>t.key==="Enter"&&j(),placeholder:i==="approved"?"Escribe un mensaje...":"Escribe para presentarte...",className:"flex-grow bg-[#1a1917] border border-white/5 text-white text-sm rounded-xl px-4 py-2 focus:outline-none focus:border-gold/50 transition-all placeholder:text-[#444]"}),e.jsx("button",{onClick:j,disabled:!d.trim(),className:"bg-gold text-black p-2 rounded-xl hover:bg-gold-hover disabled:opacity-30 disabled:grayscale transition-all shadow-lg active:scale-95",children:e.jsx(L,{size:20})})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-md z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#262421] w-full max-w-sm rounded-3xl border border-white/10 shadow-2xl overflow-hidden animate-enter",children:[e.jsxs("div",{className:"p-6 border-b border-white/5",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(y,{size:20,className:"text-gold"}),"Pagar Mensualidad"]}),e.jsxs("p",{className:"text-sm text-[#8b8982] mt-1",children:["SuscripciÃ³n: ",o.name]})]}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-[#8b8982] text-xs uppercase font-bold tracking-widest mb-1",children:"Monto a pagar"}),e.jsxs("div",{className:"text-5xl font-black text-white",children:[m,"â‚¬"]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:I,disabled:f,className:"w-full py-4 bg-gold text-black font-black rounded-2xl hover:bg-white transition-all shadow-xl shadow-gold/10 flex items-center justify-center gap-2",children:f?"Procesando...":"Confirmar Pago"}),e.jsx("button",{onClick:()=>u(!1),className:"w-full py-3 text-[#8b8982] hover:text-white font-bold text-sm transition-colors",children:"Cancelar"})]})]})]})})]}):e.jsx("div",{className:"p-8 text-center text-white",children:"Cargando perfil..."})};export{V as default};
