import{c as h,a as f,r as u,j as n,U as S,z as w}from"./index-kI6ZWuHu.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b=h("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=h("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),p=[],c={TEACHERS:"topchess_teachers",ROOMS:"topchess_rooms"},l={initialize:()=>{localStorage.getItem(c.TEACHERS)||localStorage.setItem(c.TEACHERS,JSON.stringify(p)),localStorage.getItem(c.ROOMS)||localStorage.setItem(c.ROOMS,JSON.stringify({}))},getTeachers:()=>{const e=localStorage.getItem(c.TEACHERS);return e?JSON.parse(e):p},getTeacherById:e=>l.getTeachers().find(t=>t.id===e)||null,updateTeacher:(e,s)=>{const t=l.getTeachers(),a=t.findIndex(o=>o.id===e);return a!==-1?(t[a]={...t[a],...s},localStorage.setItem(c.TEACHERS,JSON.stringify(t)),t[a]):null},getRoom:e=>JSON.parse(localStorage.getItem(c.ROOMS)||"{}")[e]||null,updateRoom:(e,s)=>{const t=JSON.parse(localStorage.getItem(c.ROOMS)||"{}");t[e]={...t[e],...s},localStorage.setItem(c.ROOMS,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("room-update",{detail:{teacherId:e,data:t[e]}}))},subscribeToRoom:(e,s)=>{const t=r=>{const i=r;i.detail.teacherId===e&&s(i.detail.data)};window.addEventListener("room-update",t);const a=r=>{if(r.key===c.ROOMS&&r.newValue)try{const d=JSON.parse(r.newValue)[e];d&&s(d)}catch(i){console.error("Error parsing storage update",i)}};window.addEventListener("storage",a);const o=l.getRoom(e);return o&&s(o),()=>{window.removeEventListener("room-update",t),window.removeEventListener("storage",a)}},createRequest:(e,s,t)=>{const a=JSON.parse(localStorage.getItem("topchess_requests")||"[]"),o=a.find(i=>i.studentId===e&&i.teacherId===s);if(o)return l.sendMessage(e,s,t,"student"),o;const r={id:Date.now().toString(),studentId:e,teacherId:s,status:"pending",timestamp:Date.now()};return a.push(r),localStorage.setItem("topchess_requests",JSON.stringify(a)),t&&l.sendMessage(e,s,t,"student"),r},getRequestStatus:(e,s)=>{const a=JSON.parse(localStorage.getItem("topchess_requests")||"[]").find(o=>o.studentId===e&&o.teacherId===s);return a?a.status:null},getRequestsForTeacher:e=>JSON.parse(localStorage.getItem("topchess_requests")||"[]").filter(t=>t.teacherId===e&&t.status==="pending"),getRequestsForStudent:e=>JSON.parse(localStorage.getItem("topchess_requests")||"[]").filter(t=>t.studentId===e),updateRequestStatus:(e,s,t)=>{const a=JSON.parse(localStorage.getItem("topchess_requests")||"[]"),o=a.findIndex(r=>r.studentId===e&&r.teacherId===s);return o!==-1?(a[o].status=t,localStorage.setItem("topchess_requests",JSON.stringify(a)),!0):!1},sendMessage:(e,s,t,a)=>{const o=JSON.parse(localStorage.getItem("topchess_messages")||"[]"),r={id:Date.now().toString()+Math.random(),studentId:e,teacherId:s,text:t,sender:a,timestamp:Date.now()};o.push(r),localStorage.setItem("topchess_messages",JSON.stringify(o)),window.dispatchEvent(new CustomEvent("chat-update",{detail:{studentId:e,teacherId:s}}))},getMessages:(e,s)=>JSON.parse(localStorage.getItem("topchess_messages")||"[]").filter(a=>a.studentId===e&&a.teacherId===s).sort((a,o)=>a.timestamp-o.timestamp),subscribeToChat:(e,s,t)=>{const a=r=>{const i=r;i.detail.studentId===e&&i.detail.teacherId===s&&t(l.getMessages(e,s))};window.addEventListener("chat-update",a);const o=r=>{r.key==="topchess_messages"&&r.newValue&&t(l.getMessages(e,s))};return window.addEventListener("storage",o),()=>{window.removeEventListener("chat-update",a),window.removeEventListener("storage",o)}},getWallet:e=>{const s=JSON.parse(localStorage.getItem("topchess_wallets")||"{}");return s[e]||(s[e]={balance:0,currency:"EUR"},localStorage.setItem("topchess_wallets",JSON.stringify(s))),s[e]},getTransactions:e=>JSON.parse(localStorage.getItem("topchess_transactions")||"[]").filter(t=>t.fromId===e||t.toId===e).sort((t,a)=>a.timestamp-t.timestamp),addFunds:(e,s)=>{const t=JSON.parse(localStorage.getItem("topchess_wallets")||"{}");t[e]||(t[e]={balance:0,currency:"EUR"}),t[e].balance+=s,localStorage.setItem("topchess_wallets",JSON.stringify(t));const a=JSON.parse(localStorage.getItem("topchess_transactions")||"[]");return a.push({id:"tx_"+Date.now(),type:"deposit",fromId:"system",toId:e,amount:s,timestamp:Date.now(),description:"Recarga de Saldo"}),localStorage.setItem("topchess_transactions",JSON.stringify(a)),window.dispatchEvent(new Event("wallet-update")),t[e]},calculateCommission:e=>{const t=JSON.parse(localStorage.getItem("topchess_requests")||"[]").filter(i=>i.teacherId===e&&i.status==="approved").length;let a=.5,o="Novato",r=3;return t>=20?(a=.85,o="Gran Maestro",r=null):t>=10?(a=.75,o="Avanzado",r=20):t>=3&&(a=.65,o="Intermedio",r=10),{rate:a,levelName:o,activeStudents:t,nextLevelStart:r,platformFee:1-a}},processPayment:(e,s,t,a)=>{const o=JSON.parse(localStorage.getItem("topchess_wallets")||"{}");if(o[e]||(o[e]={balance:0,currency:"EUR"}),o[s]||(o[s]={balance:0,currency:"EUR"}),o[e].balance<t)return{success:!1,error:"Saldo insuficiente"};const r=l.calculateCommission(s),i=t,d=t*r.rate;o[e].balance-=i,o[s].balance+=d,localStorage.setItem("topchess_wallets",JSON.stringify(o));const g=JSON.parse(localStorage.getItem("topchess_transactions")||"[]"),m=Date.now();return g.push({id:"tx_out_"+m+"_"+e,type:"payment_sent",fromId:e,toId:s,amount:-i,timestamp:m,description:a}),g.push({id:"tx_in_"+m+"_"+s,type:"payment_received",fromId:e,toId:s,amount:d,timestamp:m,description:`${a} (Comisión ${(r.platformFee*100).toFixed(0)}% aplicada)`}),localStorage.setItem("topchess_transactions",JSON.stringify(g)),window.dispatchEvent(new Event("wallet-update")),{success:!0}},getTeacherAvailability:e=>JSON.parse(localStorage.getItem("topchess_availability")||"{}")[e]||[],updateTeacherAvailability:(e,s)=>{const t=JSON.parse(localStorage.getItem("topchess_availability")||"{}");t[e]=s,localStorage.setItem("topchess_availability",JSON.stringify(t))},getBookings:()=>JSON.parse(localStorage.getItem("topchess_bookings")||"[]"),createBooking:(e,s,t,a)=>{const o=l.getBookings();if(o.find(i=>i.teacherId===s&&i.slotId===t&&i.date===a&&i.status!=="cancelled"))return{success:!1,error:"Horario ya reservado"};const r={id:"bk_"+Date.now(),studentId:e,teacherId:s,slotId:t,date:a,status:"confirmed",timestamp:Date.now()};return o.push(r),localStorage.setItem("topchess_bookings",JSON.stringify(o)),{success:!0,booking:r}},getProfile:e=>{const t=l.getTeachers().find(o=>o.id===e);if(t)return{name:t.name,bio:t.description,image:t.image,elo:t.elo};const a=JSON.parse(localStorage.getItem("topchess_users")||"{}");return a[e]?a[e]:{name:e==="student1"?"Estudiante Demo":`User ${e}`,elo:1200,image:"https://images.unsplash.com/photo-1599566150163-29194dcaad36?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80",bio:"Estudiante de ajedrez apasionado."}},updateProfile:(e,s)=>{const t=l.getTeachers(),a=t.findIndex(r=>r.id===e);if(a!==-1){const r={};return s.name&&(r.name=s.name),s.bio&&(r.description=s.bio),s.image&&(r.image=s.image),s.elo&&(r.elo=s.elo),t[a]={...t[a],...r},localStorage.setItem(c.TEACHERS,JSON.stringify(t)),t[a]}const o=JSON.parse(localStorage.getItem("topchess_users")||"{}");return o[e]={...o[e]||l.getProfile(e),...s},localStorage.setItem("topchess_users",JSON.stringify(o)),window.dispatchEvent(new CustomEvent("profile-update",{detail:{userId:e,profile:o[e]}})),o[e]}},y=()=>{const{currentUserId:e}=f(),[s,t]=u.useState({name:"",bio:"",image:"",elo:0}),[a,o]=u.useState(!0);u.useEffect(()=>{const d=l.getProfile(e);d&&t(d),o(!1)},[e]);const r=d=>{const{name:g,value:m}=d.target;t(x=>({...x,[g]:m}))},i=()=>{l.updateProfile(e,s),w.success("Perfil actualizado correctamente")};return a?n.jsx("div",{className:"text-white p-8",children:"Cargando perfil..."}):n.jsxs("div",{className:"p-4 md:p-8 max-w-4xl mx-auto animate-fade-in pb-24",children:[n.jsx("h1",{className:"text-3xl font-bold font-display text-white mb-2",children:"Mi Perfil"}),n.jsx("p",{className:"text-text-muted mb-8",children:"Personaliza tu identidad en la plataforma."}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[n.jsxs("div",{className:"glass-panel p-6 rounded-2xl flex flex-col items-center text-center h-fit",children:[n.jsxs("div",{className:"relative group mb-4",children:[n.jsx("div",{className:"w-32 h-32 rounded-full bg-cover bg-center border-4 border-white/5 shadow-2xl",style:{backgroundImage:`url(${s.image})`}}),n.jsx("div",{className:"absolute inset-0 rounded-full bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:n.jsx(b,{className:"text-white"})})]}),n.jsx("h2",{className:"text-xl font-bold text-white",children:s.name}),n.jsxs("p",{className:"text-gold font-mono text-sm mb-4",children:["ELO ",s.elo]}),n.jsxs("div",{className:"w-full pt-4 border-t border-white/5 space-y-2",children:[n.jsxs("div",{className:"flex justify-between text-xs text-text-muted",children:[n.jsx("span",{children:"ID Usuario"}),n.jsx("span",{className:"font-mono text-white opacity-50",children:e})]}),n.jsxs("div",{className:"flex justify-between text-xs text-text-muted",children:[n.jsx("span",{children:"Miembro desde"}),n.jsx("span",{className:"text-white",children:"Nov 2023"})]})]})]}),n.jsxs("div",{className:"md:col-span-2 glass-panel p-6 rounded-2xl",children:[n.jsxs("h3",{className:"text-lg font-bold text-white mb-6 flex items-center gap-2",children:[n.jsx(S,{size:18,className:"text-gold"})," Información Personal"]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2",children:"Nombre Visible"}),n.jsx("input",{type:"text",name:"name",value:s.name,onChange:r,className:"w-full bg-black/20 border border-white/10 rounded-lg p-3 text-white focus:border-gold/50 focus:outline-none transition-colors"})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2",children:"Biografía"}),n.jsx("textarea",{name:"bio",value:s.bio||"",onChange:r,rows:4,className:"w-full bg-black/20 border border-white/10 rounded-lg p-3 text-white focus:border-gold/50 focus:outline-none transition-colors",placeholder:"Cuéntanos sobre tu experiencia en ajedrez..."})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-xs font-bold text-text-muted uppercase tracking-wider mb-2",children:"URL de Avatar"}),n.jsx("input",{type:"text",name:"image",value:s.image,onChange:r,className:"w-full bg-black/20 border border-white/10 rounded-lg p-3 text-white text-xs font-mono focus:border-gold/50 focus:outline-none transition-colors"}),n.jsx("p",{className:"text-[10px] text-text-muted mt-1",children:"Usa una URL de imagen válida (ej. Unsplash)."})]}),n.jsx("div",{className:"pt-4 flex justify-end",children:n.jsxs("button",{onClick:i,className:"btn-primary flex items-center gap-2 px-6",children:[n.jsx(N,{size:18})," Guardar Cambios"]})})]})]})]})]})};export{y as default};
