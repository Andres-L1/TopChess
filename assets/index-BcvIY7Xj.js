var w4=Object.defineProperty;var R4=(t,e,n)=>e in t?w4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var vt=(t,e,n)=>R4(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();function rT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function A4(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}),n}var mI={exports:{}},Ag={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var I4=Symbol.for("react.transitional.element"),P4=Symbol.for("react.fragment");function gI(t,e,n){var i=null;if(n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),"key"in e){n={};for(var r in e)r!=="key"&&(n[r]=e[r])}else n=e;return e=n.ref,{$$typeof:I4,type:t,key:i,ref:e!==void 0?e:null,props:n}}Ag.Fragment=P4;Ag.jsx=gI;Ag.jsxs=gI;mI.exports=Ag;var G=mI.exports,vI={exports:{}},Te={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sT=Symbol.for("react.transitional.element"),x4=Symbol.for("react.portal"),D4=Symbol.for("react.fragment"),O4=Symbol.for("react.strict_mode"),N4=Symbol.for("react.profiler"),M4=Symbol.for("react.consumer"),L4=Symbol.for("react.context"),U4=Symbol.for("react.forward_ref"),V4=Symbol.for("react.suspense"),F4=Symbol.for("react.memo"),yI=Symbol.for("react.lazy"),j4=Symbol.for("react.activity"),WC=Symbol.iterator;function B4(t){return t===null||typeof t!="object"?null:(t=WC&&t[WC]||t["@@iterator"],typeof t=="function"?t:null)}var _I={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bI=Object.assign,TI={};function $c(t,e,n){this.props=t,this.context=e,this.refs=TI,this.updater=n||_I}$c.prototype.isReactComponent={};$c.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};$c.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function SI(){}SI.prototype=$c.prototype;function oT(t,e,n){this.props=t,this.context=e,this.refs=TI,this.updater=n||_I}var aT=oT.prototype=new SI;aT.constructor=oT;bI(aT,$c.prototype);aT.isPureReactComponent=!0;var QC=Array.isArray;function j0(){}var pt={H:null,A:null,T:null,S:null},EI=Object.prototype.hasOwnProperty;function lT(t,e,n){var i=n.ref;return{$$typeof:sT,type:t,key:e,ref:i!==void 0?i:null,props:n}}function q4(t,e){return lT(t.type,e,t.props)}function cT(t){return typeof t=="object"&&t!==null&&t.$$typeof===sT}function z4(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var YC=/\/+/g;function ry(t,e){return typeof t=="object"&&t!==null&&t.key!=null?z4(""+t.key):e.toString(36)}function H4(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(j0,j0):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function Al(t,e,n,i,r){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"bigint":case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case sT:case x4:o=!0;break;case yI:return o=t._init,Al(o(t._payload),e,n,i,r)}}if(o)return r=r(t),o=i===""?"."+ry(t,0):i,QC(r)?(n="",o!=null&&(n=o.replace(YC,"$&/")+"/"),Al(r,e,n,"",function(c){return c})):r!=null&&(cT(r)&&(r=q4(r,n+(r.key==null||t&&t.key===r.key?"":(""+r.key).replace(YC,"$&/")+"/")+o)),e.push(r)),1;o=0;var a=i===""?".":i+":";if(QC(t))for(var l=0;l<t.length;l++)i=t[l],s=a+ry(i,l),o+=Al(i,e,n,s,r);else if(l=B4(t),typeof l=="function")for(t=l.call(t),l=0;!(i=t.next()).done;)i=i.value,s=a+ry(i,l++),o+=Al(i,e,n,s,r);else if(s==="object"){if(typeof t.then=="function")return Al(H4(t),e,n,i,r);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return o}function Uf(t,e,n){if(t==null)return t;var i=[],r=0;return Al(t,i,"","",function(s){return e.call(n,s,r++)}),i}function G4(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var JC=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},K4={map:Uf,forEach:function(t,e,n){Uf(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Uf(t,function(){e++}),e},toArray:function(t){return Uf(t,function(e){return e})||[]},only:function(t){if(!cT(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Te.Activity=j4;Te.Children=K4;Te.Component=$c;Te.Fragment=D4;Te.Profiler=N4;Te.PureComponent=oT;Te.StrictMode=O4;Te.Suspense=V4;Te.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=pt;Te.__COMPILER_RUNTIME={__proto__:null,c:function(t){return pt.H.useMemoCache(t)}};Te.cache=function(t){return function(){return t.apply(null,arguments)}};Te.cacheSignal=function(){return null};Te.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var i=bI({},t.props),r=t.key;if(e!=null)for(s in e.key!==void 0&&(r=""+e.key),e)!EI.call(e,s)||s==="key"||s==="__self"||s==="__source"||s==="ref"&&e.ref===void 0||(i[s]=e[s]);var s=arguments.length-2;if(s===1)i.children=n;else if(1<s){for(var o=Array(s),a=0;a<s;a++)o[a]=arguments[a+2];i.children=o}return lT(t.type,r,i)};Te.createContext=function(t){return t={$$typeof:L4,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:M4,_context:t},t};Te.createElement=function(t,e,n){var i,r={},s=null;if(e!=null)for(i in e.key!==void 0&&(s=""+e.key),e)EI.call(e,i)&&i!=="key"&&i!=="__self"&&i!=="__source"&&(r[i]=e[i]);var o=arguments.length-2;if(o===1)r.children=n;else if(1<o){for(var a=Array(o),l=0;l<o;l++)a[l]=arguments[l+2];r.children=a}if(t&&t.defaultProps)for(i in o=t.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return lT(t,s,r)};Te.createRef=function(){return{current:null}};Te.forwardRef=function(t){return{$$typeof:U4,render:t}};Te.isValidElement=cT;Te.lazy=function(t){return{$$typeof:yI,_payload:{_status:-1,_result:t},_init:G4}};Te.memo=function(t,e){return{$$typeof:F4,type:t,compare:e===void 0?null:e}};Te.startTransition=function(t){var e=pt.T,n={};pt.T=n;try{var i=t(),r=pt.S;r!==null&&r(n,i),typeof i=="object"&&i!==null&&typeof i.then=="function"&&i.then(j0,JC)}catch(s){JC(s)}finally{e!==null&&n.types!==null&&(e.types=n.types),pt.T=e}};Te.unstable_useCacheRefresh=function(){return pt.H.useCacheRefresh()};Te.use=function(t){return pt.H.use(t)};Te.useActionState=function(t,e,n){return pt.H.useActionState(t,e,n)};Te.useCallback=function(t,e){return pt.H.useCallback(t,e)};Te.useContext=function(t){return pt.H.useContext(t)};Te.useDebugValue=function(){};Te.useDeferredValue=function(t,e){return pt.H.useDeferredValue(t,e)};Te.useEffect=function(t,e){return pt.H.useEffect(t,e)};Te.useEffectEvent=function(t){return pt.H.useEffectEvent(t)};Te.useId=function(){return pt.H.useId()};Te.useImperativeHandle=function(t,e,n){return pt.H.useImperativeHandle(t,e,n)};Te.useInsertionEffect=function(t,e){return pt.H.useInsertionEffect(t,e)};Te.useLayoutEffect=function(t,e){return pt.H.useLayoutEffect(t,e)};Te.useMemo=function(t,e){return pt.H.useMemo(t,e)};Te.useOptimistic=function(t,e){return pt.H.useOptimistic(t,e)};Te.useReducer=function(t,e,n){return pt.H.useReducer(t,e,n)};Te.useRef=function(t){return pt.H.useRef(t)};Te.useState=function(t){return pt.H.useState(t)};Te.useSyncExternalStore=function(t,e,n){return pt.H.useSyncExternalStore(t,e,n)};Te.useTransition=function(){return pt.H.useTransition()};Te.version="19.2.4";vI.exports=Te;var P=vI.exports;const Na=rT(P);var CI={exports:{}},Ig={},kI={exports:{}},wI={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(J,re){var se=J.length;J.push(re);e:for(;0<se;){var be=se-1>>>1,ze=J[be];if(0<r(ze,re))J[be]=re,J[se]=ze,se=be;else break e}}function n(J){return J.length===0?null:J[0]}function i(J){if(J.length===0)return null;var re=J[0],se=J.pop();if(se!==re){J[0]=se;e:for(var be=0,ze=J.length,xn=ze>>>1;be<xn;){var Zt=2*(be+1)-1,gn=J[Zt],en=Zt+1,Dn=J[en];if(0>r(gn,se))en<ze&&0>r(Dn,gn)?(J[be]=Dn,J[en]=se,be=en):(J[be]=gn,J[Zt]=se,be=Zt);else if(en<ze&&0>r(Dn,se))J[be]=Dn,J[en]=se,be=en;else break e}}return re}function r(J,re){var se=J.sortIndex-re.sortIndex;return se!==0?se:J.id-re.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,f=3,p=!1,v=!1,g=!1,E=!1,y=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function b(J){for(var re=n(c);re!==null;){if(re.callback===null)i(c);else if(re.startTime<=J)i(c),re.sortIndex=re.expirationTime,e(l,re);else break;re=n(c)}}function w(J){if(g=!1,b(J),!v)if(n(l)!==null)v=!0,D||(D=!0,N());else{var re=n(c);re!==null&&Ye(w,re.startTime-J)}}var D=!1,C=-1,k=5,S=-1;function A(){return E?!0:!(t.unstable_now()-S<k)}function I(){if(E=!1,D){var J=t.unstable_now();S=J;var re=!0;try{e:{v=!1,g&&(g=!1,T(C),C=-1),p=!0;var se=f;try{t:{for(b(J),d=n(l);d!==null&&!(d.expirationTime>J&&A());){var be=d.callback;if(typeof be=="function"){d.callback=null,f=d.priorityLevel;var ze=be(d.expirationTime<=J);if(J=t.unstable_now(),typeof ze=="function"){d.callback=ze,b(J),re=!0;break t}d===n(l)&&i(l),b(J)}else i(l);d=n(l)}if(d!==null)re=!0;else{var xn=n(c);xn!==null&&Ye(w,xn.startTime-J),re=!1}}break e}finally{d=null,f=se,p=!1}re=void 0}}finally{re?N():D=!1}}}var N;if(typeof R=="function")N=function(){R(I)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,he=O.port2;O.port1.onmessage=I,N=function(){he.postMessage(null)}}else N=function(){y(I,0)};function Ye(J,re){C=y(function(){J(t.unstable_now())},re)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(J){J.callback=null},t.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<J?Math.floor(1e3/J):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(J){switch(f){case 1:case 2:case 3:var re=3;break;default:re=f}var se=f;f=re;try{return J()}finally{f=se}},t.unstable_requestPaint=function(){E=!0},t.unstable_runWithPriority=function(J,re){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var se=f;f=J;try{return re()}finally{f=se}},t.unstable_scheduleCallback=function(J,re,se){var be=t.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?be+se:be):se=be,J){case 1:var ze=-1;break;case 2:ze=250;break;case 5:ze=1073741823;break;case 4:ze=1e4;break;default:ze=5e3}return ze=se+ze,J={id:u++,callback:re,priorityLevel:J,startTime:se,expirationTime:ze,sortIndex:-1},se>be?(J.sortIndex=se,e(c,J),n(l)===null&&J===n(c)&&(g?(T(C),C=-1):g=!0,Ye(w,se-be))):(J.sortIndex=ze,e(l,J),v||p||(v=!0,D||(D=!0,N()))),J},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(J){var re=f;return function(){var se=f;f=re;try{return J.apply(this,arguments)}finally{f=se}}}})(wI);kI.exports=wI;var $4=kI.exports,RI={exports:{}},$n={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W4=P;function AI(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Fs(){}var Hn={d:{f:Fs,r:function(){throw Error(AI(522))},D:Fs,C:Fs,L:Fs,m:Fs,X:Fs,S:Fs,M:Fs},p:0,findDOMNode:null},Q4=Symbol.for("react.portal");function Y4(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Q4,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}var bd=W4.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Pg(t,e){if(t==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}$n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Hn;$n.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(AI(299));return Y4(t,e,null,n)};$n.flushSync=function(t){var e=bd.T,n=Hn.p;try{if(bd.T=null,Hn.p=2,t)return t()}finally{bd.T=e,Hn.p=n,Hn.d.f()}};$n.preconnect=function(t,e){typeof t=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,Hn.d.C(t,e))};$n.prefetchDNS=function(t){typeof t=="string"&&Hn.d.D(t)};$n.preinit=function(t,e){if(typeof t=="string"&&e&&typeof e.as=="string"){var n=e.as,i=Pg(n,e.crossOrigin),r=typeof e.integrity=="string"?e.integrity:void 0,s=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;n==="style"?Hn.d.S(t,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:i,integrity:r,fetchPriority:s}):n==="script"&&Hn.d.X(t,{crossOrigin:i,integrity:r,fetchPriority:s,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};$n.preinitModule=function(t,e){if(typeof t=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var n=Pg(e.as,e.crossOrigin);Hn.d.M(t,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&Hn.d.M(t)};$n.preload=function(t,e){if(typeof t=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var n=e.as,i=Pg(n,e.crossOrigin);Hn.d.L(t,n,{crossOrigin:i,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};$n.preloadModule=function(t,e){if(typeof t=="string")if(e){var n=Pg(e.as,e.crossOrigin);Hn.d.m(t,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else Hn.d.m(t)};$n.requestFormReset=function(t){Hn.d.r(t)};$n.unstable_batchedUpdates=function(t,e){return t(e)};$n.useFormState=function(t,e,n){return bd.H.useFormState(t,e,n)};$n.useFormStatus=function(){return bd.H.useHostTransitionStatus()};$n.version="19.2.4";function II(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(II)}catch(t){console.error(t)}}II(),RI.exports=$n;var J4=RI.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xt=$4,PI=P,X4=J4;function K(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function xI(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Vh(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function DI(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function OI(t){if(t.tag===31){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function XC(t){if(Vh(t)!==t)throw Error(K(188))}function Z4(t){var e=t.alternate;if(!e){if(e=Vh(t),e===null)throw Error(K(188));return e!==t?null:t}for(var n=t,i=e;;){var r=n.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){n=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===n)return XC(r),t;if(s===i)return XC(r),e;s=s.sibling}throw Error(K(188))}if(n.return!==i.return)n=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,i=s;break}if(a===i){o=!0,i=r,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,i=r;break}if(a===i){o=!0,i=s,n=r;break}a=a.sibling}if(!o)throw Error(K(189))}}if(n.alternate!==i)throw Error(K(190))}if(n.tag!==3)throw Error(K(188));return n.stateNode.current===n?t:e}function NI(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t;for(t=t.child;t!==null;){if(e=NI(t),e!==null)return e;t=t.sibling}return null}var mt=Object.assign,eU=Symbol.for("react.element"),Vf=Symbol.for("react.transitional.element"),ld=Symbol.for("react.portal"),Ml=Symbol.for("react.fragment"),MI=Symbol.for("react.strict_mode"),B0=Symbol.for("react.profiler"),LI=Symbol.for("react.consumer"),is=Symbol.for("react.context"),uT=Symbol.for("react.forward_ref"),q0=Symbol.for("react.suspense"),z0=Symbol.for("react.suspense_list"),dT=Symbol.for("react.memo"),$s=Symbol.for("react.lazy"),H0=Symbol.for("react.activity"),tU=Symbol.for("react.memo_cache_sentinel"),ZC=Symbol.iterator;function Fu(t){return t===null||typeof t!="object"?null:(t=ZC&&t[ZC]||t["@@iterator"],typeof t=="function"?t:null)}var nU=Symbol.for("react.client.reference");function G0(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===nU?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ml:return"Fragment";case B0:return"Profiler";case MI:return"StrictMode";case q0:return"Suspense";case z0:return"SuspenseList";case H0:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case ld:return"Portal";case is:return t.displayName||"Context";case LI:return(t._context.displayName||"Context")+".Consumer";case uT:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case dT:return e=t.displayName||null,e!==null?e:G0(t.type)||"Memo";case $s:e=t._payload,t=t._init;try{return G0(t(e))}catch{}}return null}var cd=Array.isArray,ge=PI.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$e=X4.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ka={pending:!1,data:null,method:null,action:null},K0=[],Ll=-1;function Nr(t){return{current:t}}function pn(t){0>Ll||(t.current=K0[Ll],K0[Ll]=null,Ll--)}function ct(t,e){Ll++,K0[Ll]=t.current,t.current=e}var Sr=Nr(null),Wd=Nr(null),uo=Nr(null),im=Nr(null);function rm(t,e){switch(ct(uo,e),ct(Wd,t),ct(Sr,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?sk(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)e=sk(e),t=nD(e,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}pn(Sr),ct(Sr,t)}function bc(){pn(Sr),pn(Wd),pn(uo)}function $0(t){t.memoizedState!==null&&ct(im,t);var e=Sr.current,n=nD(e,t.type);e!==n&&(ct(Wd,t),ct(Sr,n))}function sm(t){Wd.current===t&&(pn(Sr),pn(Wd)),im.current===t&&(pn(im),sh._currentValue=ka)}var sy,e1;function ha(t){if(sy===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);sy=e&&e[1]||"",e1=-1<n.stack.indexOf(`
    at`)?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return`
`+sy+t+e1}var oy=!1;function ay(t,e){if(!t||oy)return"";oy=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(e){var d=function(){throw Error()};if(Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(p){var f=p}Reflect.construct(t,[],d)}else{try{d.call()}catch(p){f=p}t.call(d.prototype)}}else{try{throw Error()}catch(p){f=p}(d=t())&&typeof d.catch=="function"&&d.catch(function(){})}}catch(p){if(p&&f&&typeof p.stack=="string")return[p.stack,f.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var r=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");r&&r.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=i.DetermineComponentFrameRoot(),o=s[0],a=s[1];if(o&&a){var l=o.split(`
`),c=a.split(`
`);for(r=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;r<c.length&&!c[r].includes("DetermineComponentFrameRoot");)r++;if(i===l.length||r===c.length)for(i=l.length-1,r=c.length-1;1<=i&&0<=r&&l[i]!==c[r];)r--;for(;1<=i&&0<=r;i--,r--)if(l[i]!==c[r]){if(i!==1||r!==1)do if(i--,r--,0>r||l[i]!==c[r]){var u=`
`+l[i].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=i&&0<=r);break}}}finally{oy=!1,Error.prepareStackTrace=n}return(n=t?t.displayName||t.name:"")?ha(n):""}function iU(t,e){switch(t.tag){case 26:case 27:case 5:return ha(t.type);case 16:return ha("Lazy");case 13:return t.child!==e&&e!==null?ha("Suspense Fallback"):ha("Suspense");case 19:return ha("SuspenseList");case 0:case 15:return ay(t.type,!1);case 11:return ay(t.type.render,!1);case 1:return ay(t.type,!0);case 31:return ha("Activity");default:return""}}function t1(t){try{var e="",n=null;do e+=iU(t,n),n=t,t=t.return;while(t);return e}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}var W0=Object.prototype.hasOwnProperty,hT=Xt.unstable_scheduleCallback,ly=Xt.unstable_cancelCallback,rU=Xt.unstable_shouldYield,sU=Xt.unstable_requestPaint,bi=Xt.unstable_now,oU=Xt.unstable_getCurrentPriorityLevel,UI=Xt.unstable_ImmediatePriority,VI=Xt.unstable_UserBlockingPriority,om=Xt.unstable_NormalPriority,aU=Xt.unstable_LowPriority,FI=Xt.unstable_IdlePriority,lU=Xt.log,cU=Xt.unstable_setDisableYieldValue,Fh=null,Ti=null;function to(t){if(typeof lU=="function"&&cU(t),Ti&&typeof Ti.setStrictMode=="function")try{Ti.setStrictMode(Fh,t)}catch{}}var Si=Math.clz32?Math.clz32:hU,uU=Math.log,dU=Math.LN2;function hU(t){return t>>>=0,t===0?32:31-(uU(t)/dU|0)|0}var Ff=256,jf=262144,Bf=4194304;function fa(t){var e=t&42;if(e!==0)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function xg(t,e,n){var i=t.pendingLanes;if(i===0)return 0;var r=0,s=t.suspendedLanes,o=t.pingedLanes;t=t.warmLanes;var a=i&134217727;return a!==0?(i=a&~s,i!==0?r=fa(i):(o&=a,o!==0?r=fa(o):n||(n=a&~t,n!==0&&(r=fa(n))))):(a=i&~s,a!==0?r=fa(a):o!==0?r=fa(o):n||(n=i&~t,n!==0&&(r=fa(n)))),r===0?0:e!==0&&e!==r&&!(e&s)&&(s=r&-r,n=e&-e,s>=n||s===32&&(n&4194048)!==0)?e:r}function jh(t,e){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)===0}function fU(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jI(){var t=Bf;return Bf<<=1,!(Bf&62914560)&&(Bf=4194304),t}function cy(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Bh(t,e){t.pendingLanes|=e,e!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function pU(t,e,n,i,r,s){var o=t.pendingLanes;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=n,t.entangledLanes&=n,t.errorRecoveryDisabledLanes&=n,t.shellSuspendCounter=0;var a=t.entanglements,l=t.expirationTimes,c=t.hiddenUpdates;for(n=o&~n;0<n;){var u=31-Si(n),d=1<<u;a[u]=0,l[u]=-1;var f=c[u];if(f!==null)for(c[u]=null,u=0;u<f.length;u++){var p=f[u];p!==null&&(p.lane&=-536870913)}n&=~d}i!==0&&BI(t,i,0),s!==0&&r===0&&t.tag!==0&&(t.suspendedLanes|=s&~(o&~e))}function BI(t,e,n){t.pendingLanes|=e,t.suspendedLanes&=~e;var i=31-Si(e);t.entangledLanes|=e,t.entanglements[i]=t.entanglements[i]|1073741824|n&261930}function qI(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Si(n),r=1<<i;r&e|t[i]&e&&(t[i]|=e),n&=~r}}function zI(t,e){var n=e&-e;return n=n&42?1:fT(n),n&(t.suspendedLanes|e)?0:n}function fT(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function pT(t){return t&=-t,2<t?8<t?t&134217727?32:268435456:8:2}function HI(){var t=$e.p;return t!==0?t:(t=window.event,t===void 0?32:fD(t.type))}function n1(t,e){var n=$e.p;try{return $e.p=t,e()}finally{$e.p=n}}var Go=Math.random().toString(36).slice(2),Sn="__reactFiber$"+Go,ai="__reactProps$"+Go,Wc="__reactContainer$"+Go,Q0="__reactEvents$"+Go,mU="__reactListeners$"+Go,gU="__reactHandles$"+Go,i1="__reactResources$"+Go,qh="__reactMarker$"+Go;function mT(t){delete t[Sn],delete t[ai],delete t[Q0],delete t[mU],delete t[gU]}function Ul(t){var e=t[Sn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Wc]||n[Sn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=uk(t);t!==null;){if(n=t[Sn])return n;t=uk(t)}return e}t=n,n=t.parentNode}return null}function Qc(t){if(t=t[Sn]||t[Wc]){var e=t.tag;if(e===5||e===6||e===13||e===31||e===26||e===27||e===3)return t}return null}function ud(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t.stateNode;throw Error(K(33))}function Jl(t){var e=t[i1];return e||(e=t[i1]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function dn(t){t[qh]=!0}var GI=new Set,KI={};function tl(t,e){Tc(t,e),Tc(t+"Capture",e)}function Tc(t,e){for(KI[t]=e,t=0;t<e.length;t++)GI.add(e[t])}var vU=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),r1={},s1={};function yU(t){return W0.call(s1,t)?!0:W0.call(r1,t)?!1:vU.test(t)?s1[t]=!0:(r1[t]=!0,!1)}function gp(t,e,n){if(yU(e))if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":t.removeAttribute(e);return;case"boolean":var i=e.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){t.removeAttribute(e);return}}t.setAttribute(e,""+n)}}function qf(t,e,n){if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(e);return}t.setAttribute(e,""+n)}}function zr(t,e,n,i){if(i===null)t.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttributeNS(e,n,""+i)}}function Di(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function $I(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function _U(t,e,n){var i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e);if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var r=i.get,s=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){n=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Y0(t){if(!t._valueTracker){var e=$I(t)?"checked":"value";t._valueTracker=_U(t,e,""+t[e])}}function WI(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=$I(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function am(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var bU=/[\n"\\]/g;function Li(t){return t.replace(bU,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function J0(t,e,n,i,r,s,o,a){t.name="",o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"?t.type=o:t.removeAttribute("type"),e!=null?o==="number"?(e===0&&t.value===""||t.value!=e)&&(t.value=""+Di(e)):t.value!==""+Di(e)&&(t.value=""+Di(e)):o!=="submit"&&o!=="reset"||t.removeAttribute("value"),e!=null?X0(t,o,Di(e)):n!=null?X0(t,o,Di(n)):i!=null&&t.removeAttribute("value"),r==null&&s!=null&&(t.defaultChecked=!!s),r!=null&&(t.checked=r&&typeof r!="function"&&typeof r!="symbol"),a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"?t.name=""+Di(a):t.removeAttribute("name")}function QI(t,e,n,i,r,s,o,a){if(s!=null&&typeof s!="function"&&typeof s!="symbol"&&typeof s!="boolean"&&(t.type=s),e!=null||n!=null){if(!(s!=="submit"&&s!=="reset"||e!=null)){Y0(t);return}n=n!=null?""+Di(n):"",e=e!=null?""+Di(e):n,a||e===t.value||(t.value=e),t.defaultValue=e}i=i??r,i=typeof i!="function"&&typeof i!="symbol"&&!!i,t.checked=a?t.checked:!!i,t.defaultChecked=!!i,o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"&&(t.name=o),Y0(t)}function X0(t,e,n){e==="number"&&am(t.ownerDocument)===t||t.defaultValue===""+n||(t.defaultValue=""+n)}function Xl(t,e,n,i){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&i&&(t[n].defaultSelected=!0)}else{for(n=""+Di(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,i&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function YI(t,e,n){if(e!=null&&(e=""+Di(e),e!==t.value&&(t.value=e),n==null)){t.defaultValue!==e&&(t.defaultValue=e);return}t.defaultValue=n!=null?""+Di(n):""}function JI(t,e,n,i){if(e==null){if(i!=null){if(n!=null)throw Error(K(92));if(cd(i)){if(1<i.length)throw Error(K(93));i=i[0]}n=i}n==null&&(n=""),e=n}n=Di(e),t.defaultValue=n,i=t.textContent,i===n&&i!==""&&i!==null&&(t.value=i),Y0(t)}function Sc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var TU=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function o1(t,e,n){var i=e.indexOf("--")===0;n==null||typeof n=="boolean"||n===""?i?t.setProperty(e,""):e==="float"?t.cssFloat="":t[e]="":i?t.setProperty(e,n):typeof n!="number"||n===0||TU.has(e)?e==="float"?t.cssFloat=n:t[e]=(""+n).trim():t[e]=n+"px"}function XI(t,e,n){if(e!=null&&typeof e!="object")throw Error(K(62));if(t=t.style,n!=null){for(var i in n)!n.hasOwnProperty(i)||e!=null&&e.hasOwnProperty(i)||(i.indexOf("--")===0?t.setProperty(i,""):i==="float"?t.cssFloat="":t[i]="");for(var r in e)i=e[r],e.hasOwnProperty(r)&&n[r]!==i&&o1(t,r,i)}else for(var s in e)e.hasOwnProperty(s)&&o1(t,s,e[s])}function gT(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var SU=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),EU=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function vp(t){return EU.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function rs(){}var Z0=null;function vT(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Vl=null,Zl=null;function a1(t){var e=Qc(t);if(e&&(t=e.stateNode)){var n=t[ai]||null;e:switch(t=e.stateNode,e.type){case"input":if(J0(t,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+Li(""+e)+'"][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var r=i[ai]||null;if(!r)throw Error(K(90));J0(i,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name)}}for(e=0;e<n.length;e++)i=n[e],i.form===t.form&&WI(i)}break e;case"textarea":YI(t,n.value,n.defaultValue);break e;case"select":e=n.value,e!=null&&Xl(t,!!n.multiple,e,!1)}}}var uy=!1;function ZI(t,e,n){if(uy)return t(e,n);uy=!0;try{var i=t(e);return i}finally{if(uy=!1,(Vl!==null||Zl!==null)&&(zg(),Vl&&(e=Vl,t=Zl,Zl=Vl=null,a1(e),t)))for(e=0;e<t.length;e++)a1(t[e])}}function Qd(t,e){var n=t.stateNode;if(n===null)return null;var i=n[ai]||null;if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(K(231,e,typeof n));return n}var ps=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),e_=!1;if(ps)try{var ju={};Object.defineProperty(ju,"passive",{get:function(){e_=!0}}),window.addEventListener("test",ju,ju),window.removeEventListener("test",ju,ju)}catch{e_=!1}var no=null,yT=null,yp=null;function eP(){if(yp)return yp;var t,e=yT,n=e.length,i,r="value"in no?no.value:no.textContent,s=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(i=1;i<=o&&e[n-i]===r[s-i];i++);return yp=r.slice(t,1<i?1-i:void 0)}function _p(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function zf(){return!0}function l1(){return!1}function ui(t){function e(n,i,r,s,o){this._reactName=n,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?zf:l1,this.isPropagationStopped=l1,this}return mt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=zf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=zf)},persist:function(){},isPersistent:zf}),e}var nl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Dg=ui(nl),zh=mt({},nl,{view:0,detail:0}),CU=ui(zh),dy,hy,Bu,Og=mt({},zh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_T,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Bu&&(Bu&&t.type==="mousemove"?(dy=t.screenX-Bu.screenX,hy=t.screenY-Bu.screenY):hy=dy=0,Bu=t),dy)},movementY:function(t){return"movementY"in t?t.movementY:hy}}),c1=ui(Og),kU=mt({},Og,{dataTransfer:0}),wU=ui(kU),RU=mt({},zh,{relatedTarget:0}),fy=ui(RU),AU=mt({},nl,{animationName:0,elapsedTime:0,pseudoElement:0}),IU=ui(AU),PU=mt({},nl,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),xU=ui(PU),DU=mt({},nl,{data:0}),u1=ui(DU),OU={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},NU={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},MU={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function LU(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=MU[t])?!!e[t]:!1}function _T(){return LU}var UU=mt({},zh,{key:function(t){if(t.key){var e=OU[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=_p(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?NU[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_T,charCode:function(t){return t.type==="keypress"?_p(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?_p(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),VU=ui(UU),FU=mt({},Og,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),d1=ui(FU),jU=mt({},zh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_T}),BU=ui(jU),qU=mt({},nl,{propertyName:0,elapsedTime:0,pseudoElement:0}),zU=ui(qU),HU=mt({},Og,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),GU=ui(HU),KU=mt({},nl,{newState:0,oldState:0}),$U=ui(KU),WU=[9,13,27,32],bT=ps&&"CompositionEvent"in window,Td=null;ps&&"documentMode"in document&&(Td=document.documentMode);var QU=ps&&"TextEvent"in window&&!Td,tP=ps&&(!bT||Td&&8<Td&&11>=Td),h1=" ",f1=!1;function nP(t,e){switch(t){case"keyup":return WU.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iP(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Fl=!1;function YU(t,e){switch(t){case"compositionend":return iP(e);case"keypress":return e.which!==32?null:(f1=!0,h1);case"textInput":return t=e.data,t===h1&&f1?null:t;default:return null}}function JU(t,e){if(Fl)return t==="compositionend"||!bT&&nP(t,e)?(t=eP(),yp=yT=no=null,Fl=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return tP&&e.locale!=="ko"?null:e.data;default:return null}}var XU={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function p1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!XU[t.type]:e==="textarea"}function rP(t,e,n,i){Vl?Zl?Zl.push(i):Zl=[i]:Vl=i,e=km(e,"onChange"),0<e.length&&(n=new Dg("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Sd=null,Yd=null;function ZU(t){Zx(t,0)}function Ng(t){var e=ud(t);if(WI(e))return t}function m1(t,e){if(t==="change")return e}var sP=!1;if(ps){var py;if(ps){var my="oninput"in document;if(!my){var g1=document.createElement("div");g1.setAttribute("oninput","return;"),my=typeof g1.oninput=="function"}py=my}else py=!1;sP=py&&(!document.documentMode||9<document.documentMode)}function v1(){Sd&&(Sd.detachEvent("onpropertychange",oP),Yd=Sd=null)}function oP(t){if(t.propertyName==="value"&&Ng(Yd)){var e=[];rP(e,Yd,t,vT(t)),ZI(ZU,e)}}function e6(t,e,n){t==="focusin"?(v1(),Sd=e,Yd=n,Sd.attachEvent("onpropertychange",oP)):t==="focusout"&&v1()}function t6(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ng(Yd)}function n6(t,e){if(t==="click")return Ng(e)}function i6(t,e){if(t==="input"||t==="change")return Ng(e)}function r6(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ki=typeof Object.is=="function"?Object.is:r6;function Jd(t,e){if(ki(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var r=n[i];if(!W0.call(e,r)||!ki(t[r],e[r]))return!1}return!0}function y1(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function _1(t,e){var n=y1(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=y1(n)}}function aP(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?aP(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function lP(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var e=am(t.document);e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=am(t.document)}return e}function TT(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var s6=ps&&"documentMode"in document&&11>=document.documentMode,jl=null,t_=null,Ed=null,n_=!1;function b1(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;n_||jl==null||jl!==am(i)||(i=jl,"selectionStart"in i&&TT(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Ed&&Jd(Ed,i)||(Ed=i,i=km(t_,"onSelect"),0<i.length&&(e=new Dg("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=jl)))}function ua(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Bl={animationend:ua("Animation","AnimationEnd"),animationiteration:ua("Animation","AnimationIteration"),animationstart:ua("Animation","AnimationStart"),transitionrun:ua("Transition","TransitionRun"),transitionstart:ua("Transition","TransitionStart"),transitioncancel:ua("Transition","TransitionCancel"),transitionend:ua("Transition","TransitionEnd")},gy={},cP={};ps&&(cP=document.createElement("div").style,"AnimationEvent"in window||(delete Bl.animationend.animation,delete Bl.animationiteration.animation,delete Bl.animationstart.animation),"TransitionEvent"in window||delete Bl.transitionend.transition);function il(t){if(gy[t])return gy[t];if(!Bl[t])return t;var e=Bl[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in cP)return gy[t]=e[n];return t}var uP=il("animationend"),dP=il("animationiteration"),hP=il("animationstart"),o6=il("transitionrun"),a6=il("transitionstart"),l6=il("transitioncancel"),fP=il("transitionend"),pP=new Map,i_="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");i_.push("scrollEnd");function hr(t,e){pP.set(t,e),tl(e,[t])}var lm=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},xi=[],ql=0,ST=0;function Mg(){for(var t=ql,e=ST=ql=0;e<t;){var n=xi[e];xi[e++]=null;var i=xi[e];xi[e++]=null;var r=xi[e];xi[e++]=null;var s=xi[e];if(xi[e++]=null,i!==null&&r!==null){var o=i.pending;o===null?r.next=r:(r.next=o.next,o.next=r),i.pending=r}s!==0&&mP(n,r,s)}}function Lg(t,e,n,i){xi[ql++]=t,xi[ql++]=e,xi[ql++]=n,xi[ql++]=i,ST|=i,t.lanes|=i,t=t.alternate,t!==null&&(t.lanes|=i)}function ET(t,e,n,i){return Lg(t,e,n,i),cm(t)}function rl(t,e){return Lg(t,null,null,e),cm(t)}function mP(t,e,n){t.lanes|=n;var i=t.alternate;i!==null&&(i.lanes|=n);for(var r=!1,s=t.return;s!==null;)s.childLanes|=n,i=s.alternate,i!==null&&(i.childLanes|=n),s.tag===22&&(t=s.stateNode,t===null||t._visibility&1||(r=!0)),t=s,s=s.return;return t.tag===3?(s=t.stateNode,r&&e!==null&&(r=31-Si(n),t=s.hiddenUpdates,i=t[r],i===null?t[r]=[e]:i.push(e),e.lane=n|536870912),s):null}function cm(t){if(50<Dd)throw Dd=0,C_=null,Error(K(185));for(var e=t.return;e!==null;)t=e,e=t.return;return t.tag===3?t.stateNode:null}var zl={};function c6(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(t,e,n,i){return new c6(t,e,n,i)}function CT(t){return t=t.prototype,!(!t||!t.isReactComponent)}function as(t,e){var n=t.alternate;return n===null?(n=gi(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&65011712,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n.refCleanup=t.refCleanup,n}function gP(t,e){t.flags&=65011714;var n=t.alternate;return n===null?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,t.type=n.type,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function bp(t,e,n,i,r,s){var o=0;if(i=t,typeof t=="function")CT(t)&&(o=1);else if(typeof t=="string")o=p5(t,n,Sr.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case H0:return t=gi(31,n,e,r),t.elementType=H0,t.lanes=s,t;case Ml:return wa(n.children,r,s,e);case MI:o=8,r|=24;break;case B0:return t=gi(12,n,e,r|2),t.elementType=B0,t.lanes=s,t;case q0:return t=gi(13,n,e,r),t.elementType=q0,t.lanes=s,t;case z0:return t=gi(19,n,e,r),t.elementType=z0,t.lanes=s,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case is:o=10;break e;case LI:o=9;break e;case uT:o=11;break e;case dT:o=14;break e;case $s:o=16,i=null;break e}o=29,n=Error(K(130,t===null?"null":typeof t,"")),i=null}return e=gi(o,n,e,r),e.elementType=t,e.type=i,e.lanes=s,e}function wa(t,e,n,i){return t=gi(7,t,i,e),t.lanes=n,t}function vy(t,e,n){return t=gi(6,t,null,e),t.lanes=n,t}function vP(t){var e=gi(18,null,null,0);return e.stateNode=t,e}function yy(t,e,n){return e=gi(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var T1=new WeakMap;function Ui(t,e){if(typeof t=="object"&&t!==null){var n=T1.get(t);return n!==void 0?n:(e={value:t,source:e,stack:t1(e)},T1.set(t,e),e)}return{value:t,source:e,stack:t1(e)}}var Hl=[],Gl=0,um=null,Xd=0,Oi=[],Ni=0,Po=null,_r=1,br="";function Yr(t,e){Hl[Gl++]=Xd,Hl[Gl++]=um,um=t,Xd=e}function yP(t,e,n){Oi[Ni++]=_r,Oi[Ni++]=br,Oi[Ni++]=Po,Po=t;var i=_r;t=br;var r=32-Si(i)-1;i&=~(1<<r),n+=1;var s=32-Si(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,_r=1<<32-Si(e)+r|n<<r|i,br=s+t}else _r=1<<s|n<<r|i,br=t}function kT(t){t.return!==null&&(Yr(t,1),yP(t,1,0))}function wT(t){for(;t===um;)um=Hl[--Gl],Hl[Gl]=null,Xd=Hl[--Gl],Hl[Gl]=null;for(;t===Po;)Po=Oi[--Ni],Oi[Ni]=null,br=Oi[--Ni],Oi[Ni]=null,_r=Oi[--Ni],Oi[Ni]=null}function _P(t,e){Oi[Ni++]=_r,Oi[Ni++]=br,Oi[Ni++]=Po,_r=e.id,br=e.overflow,Po=t}var En=null,ht=null,Ue=!1,ho=null,Vi=!1,r_=Error(K(519));function xo(t){var e=Error(K(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Zd(Ui(e,t)),r_}function S1(t){var e=t.stateNode,n=t.type,i=t.memoizedProps;switch(e[Sn]=t,e[ai]=i,n){case"dialog":Ie("cancel",e),Ie("close",e);break;case"iframe":case"object":case"embed":Ie("load",e);break;case"video":case"audio":for(n=0;n<ih.length;n++)Ie(ih[n],e);break;case"source":Ie("error",e);break;case"img":case"image":case"link":Ie("error",e),Ie("load",e);break;case"details":Ie("toggle",e);break;case"input":Ie("invalid",e),QI(e,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0);break;case"select":Ie("invalid",e);break;case"textarea":Ie("invalid",e),JI(e,i.value,i.defaultValue,i.children)}n=i.children,typeof n!="string"&&typeof n!="number"&&typeof n!="bigint"||e.textContent===""+n||i.suppressHydrationWarning===!0||tD(e.textContent,n)?(i.popover!=null&&(Ie("beforetoggle",e),Ie("toggle",e)),i.onScroll!=null&&Ie("scroll",e),i.onScrollEnd!=null&&Ie("scrollend",e),i.onClick!=null&&(e.onclick=rs),e=!0):e=!1,e||xo(t,!0)}function E1(t){for(En=t.return;En;)switch(En.tag){case 5:case 31:case 13:Vi=!1;return;case 27:case 3:Vi=!0;return;default:En=En.return}}function El(t){if(t!==En)return!1;if(!Ue)return E1(t),Ue=!0,!1;var e=t.tag,n;if((n=e!==3&&e!==27)&&((n=e===5)&&(n=t.type,n=!(n!=="form"&&n!=="button")||I_(t.type,t.memoizedProps)),n=!n),n&&ht&&xo(t),E1(t),e===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(K(317));ht=ck(t)}else if(e===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(K(317));ht=ck(t)}else e===27?(e=ht,Ko(t.type)?(t=O_,O_=null,ht=t):ht=e):ht=En?zi(t.stateNode.nextSibling):null;return!0}function Ma(){ht=En=null,Ue=!1}function _y(){var t=ho;return t!==null&&(Zn===null?Zn=t:Zn.push.apply(Zn,t),ho=null),t}function Zd(t){ho===null?ho=[t]:ho.push(t)}var s_=Nr(null),sl=null,ss=null;function Ys(t,e,n){ct(s_,e._currentValue),e._currentValue=n}function ls(t){t._currentValue=s_.current,pn(s_)}function o_(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function a_(t,e,n,i){var r=t.child;for(r!==null&&(r.return=t);r!==null;){var s=r.dependencies;if(s!==null){var o=r.child;s=s.firstContext;e:for(;s!==null;){var a=s;s=r;for(var l=0;l<e.length;l++)if(a.context===e[l]){s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),o_(s.return,n,t),i||(o=null);break e}s=a.next}}else if(r.tag===18){if(o=r.return,o===null)throw Error(K(341));o.lanes|=n,s=o.alternate,s!==null&&(s.lanes|=n),o_(o,n,t),o=null}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===t){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}}function Yc(t,e,n,i){t=null;for(var r=e,s=!1;r!==null;){if(!s){if(r.flags&524288)s=!0;else if(r.flags&262144)break}if(r.tag===10){var o=r.alternate;if(o===null)throw Error(K(387));if(o=o.memoizedProps,o!==null){var a=r.type;ki(r.pendingProps.value,o.value)||(t!==null?t.push(a):t=[a])}}else if(r===im.current){if(o=r.alternate,o===null)throw Error(K(387));o.memoizedState.memoizedState!==r.memoizedState.memoizedState&&(t!==null?t.push(sh):t=[sh])}r=r.return}t!==null&&a_(e,t,n,i),e.flags|=262144}function dm(t){for(t=t.firstContext;t!==null;){if(!ki(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function La(t){sl=t,ss=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function kn(t){return bP(sl,t)}function Hf(t,e){return sl===null&&La(t),bP(t,e)}function bP(t,e){var n=e._currentValue;if(e={context:e,memoizedValue:n,next:null},ss===null){if(t===null)throw Error(K(308));ss=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else ss=ss.next=e;return n}var u6=typeof AbortController<"u"?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(n,i){t.push(i)}};this.abort=function(){e.aborted=!0,t.forEach(function(n){return n()})}},d6=Xt.unstable_scheduleCallback,h6=Xt.unstable_NormalPriority,jt={$$typeof:is,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function RT(){return{controller:new u6,data:new Map,refCount:0}}function Hh(t){t.refCount--,t.refCount===0&&d6(h6,function(){t.controller.abort()})}var Cd=null,l_=0,Ec=0,ec=null;function f6(t,e){if(Cd===null){var n=Cd=[];l_=0,Ec=XT(),ec={status:"pending",value:void 0,then:function(i){n.push(i)}}}return l_++,e.then(C1,C1),e}function C1(){if(--l_===0&&Cd!==null){ec!==null&&(ec.status="fulfilled");var t=Cd;Cd=null,Ec=0,ec=null;for(var e=0;e<t.length;e++)(0,t[e])()}}function p6(t,e){var n=[],i={status:"pending",value:null,reason:null,then:function(r){n.push(r)}};return t.then(function(){i.status="fulfilled",i.value=e;for(var r=0;r<n.length;r++)(0,n[r])(e)},function(r){for(i.status="rejected",i.reason=r,r=0;r<n.length;r++)(0,n[r])(void 0)}),i}var k1=ge.S;ge.S=function(t,e){Nx=bi(),typeof e=="object"&&e!==null&&typeof e.then=="function"&&f6(t,e),k1!==null&&k1(t,e)};var Ra=Nr(null);function AT(){var t=Ra.current;return t!==null?t:ot.pooledCache}function Tp(t,e){e===null?ct(Ra,Ra.current):ct(Ra,e.pool)}function TP(){var t=AT();return t===null?null:{parent:jt._currentValue,pool:t}}var Jc=Error(K(460)),IT=Error(K(474)),Ug=Error(K(542)),hm={then:function(){}};function w1(t){return t=t.status,t==="fulfilled"||t==="rejected"}function SP(t,e,n){switch(n=t[n],n===void 0?t.push(e):n!==e&&(e.then(rs,rs),e=n),e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,A1(t),t;default:if(typeof e.status=="string")e.then(rs,rs);else{if(t=ot,t!==null&&100<t.shellSuspendCounter)throw Error(K(482));t=e,t.status="pending",t.then(function(i){if(e.status==="pending"){var r=e;r.status="fulfilled",r.value=i}},function(i){if(e.status==="pending"){var r=e;r.status="rejected",r.reason=i}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,A1(t),t}throw Aa=e,Jc}}function pa(t){try{var e=t._init;return e(t._payload)}catch(n){throw n!==null&&typeof n=="object"&&typeof n.then=="function"?(Aa=n,Jc):n}}var Aa=null;function R1(){if(Aa===null)throw Error(K(459));var t=Aa;return Aa=null,t}function A1(t){if(t===Jc||t===Ug)throw Error(K(483))}var tc=null,eh=0;function Gf(t){var e=eh;return eh+=1,tc===null&&(tc=[]),SP(tc,t,e)}function qu(t,e){e=e.props.ref,t.ref=e!==void 0?e:null}function Kf(t,e){throw e.$$typeof===eU?Error(K(525)):(t=Object.prototype.toString.call(e),Error(K(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)))}function EP(t){function e(y,T){if(t){var R=y.deletions;R===null?(y.deletions=[T],y.flags|=16):R.push(T)}}function n(y,T){if(!t)return null;for(;T!==null;)e(y,T),T=T.sibling;return null}function i(y){for(var T=new Map;y!==null;)y.key!==null?T.set(y.key,y):T.set(y.index,y),y=y.sibling;return T}function r(y,T){return y=as(y,T),y.index=0,y.sibling=null,y}function s(y,T,R){return y.index=R,t?(R=y.alternate,R!==null?(R=R.index,R<T?(y.flags|=67108866,T):R):(y.flags|=67108866,T)):(y.flags|=1048576,T)}function o(y){return t&&y.alternate===null&&(y.flags|=67108866),y}function a(y,T,R,b){return T===null||T.tag!==6?(T=vy(R,y.mode,b),T.return=y,T):(T=r(T,R),T.return=y,T)}function l(y,T,R,b){var w=R.type;return w===Ml?u(y,T,R.props.children,b,R.key):T!==null&&(T.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===$s&&pa(w)===T.type)?(T=r(T,R.props),qu(T,R),T.return=y,T):(T=bp(R.type,R.key,R.props,null,y.mode,b),qu(T,R),T.return=y,T)}function c(y,T,R,b){return T===null||T.tag!==4||T.stateNode.containerInfo!==R.containerInfo||T.stateNode.implementation!==R.implementation?(T=yy(R,y.mode,b),T.return=y,T):(T=r(T,R.children||[]),T.return=y,T)}function u(y,T,R,b,w){return T===null||T.tag!==7?(T=wa(R,y.mode,b,w),T.return=y,T):(T=r(T,R),T.return=y,T)}function d(y,T,R){if(typeof T=="string"&&T!==""||typeof T=="number"||typeof T=="bigint")return T=vy(""+T,y.mode,R),T.return=y,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Vf:return R=bp(T.type,T.key,T.props,null,y.mode,R),qu(R,T),R.return=y,R;case ld:return T=yy(T,y.mode,R),T.return=y,T;case $s:return T=pa(T),d(y,T,R)}if(cd(T)||Fu(T))return T=wa(T,y.mode,R,null),T.return=y,T;if(typeof T.then=="function")return d(y,Gf(T),R);if(T.$$typeof===is)return d(y,Hf(y,T),R);Kf(y,T)}return null}function f(y,T,R,b){var w=T!==null?T.key:null;if(typeof R=="string"&&R!==""||typeof R=="number"||typeof R=="bigint")return w!==null?null:a(y,T,""+R,b);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case Vf:return R.key===w?l(y,T,R,b):null;case ld:return R.key===w?c(y,T,R,b):null;case $s:return R=pa(R),f(y,T,R,b)}if(cd(R)||Fu(R))return w!==null?null:u(y,T,R,b,null);if(typeof R.then=="function")return f(y,T,Gf(R),b);if(R.$$typeof===is)return f(y,T,Hf(y,R),b);Kf(y,R)}return null}function p(y,T,R,b,w){if(typeof b=="string"&&b!==""||typeof b=="number"||typeof b=="bigint")return y=y.get(R)||null,a(T,y,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Vf:return y=y.get(b.key===null?R:b.key)||null,l(T,y,b,w);case ld:return y=y.get(b.key===null?R:b.key)||null,c(T,y,b,w);case $s:return b=pa(b),p(y,T,R,b,w)}if(cd(b)||Fu(b))return y=y.get(R)||null,u(T,y,b,w,null);if(typeof b.then=="function")return p(y,T,R,Gf(b),w);if(b.$$typeof===is)return p(y,T,R,Hf(T,b),w);Kf(T,b)}return null}function v(y,T,R,b){for(var w=null,D=null,C=T,k=T=0,S=null;C!==null&&k<R.length;k++){C.index>k?(S=C,C=null):S=C.sibling;var A=f(y,C,R[k],b);if(A===null){C===null&&(C=S);break}t&&C&&A.alternate===null&&e(y,C),T=s(A,T,k),D===null?w=A:D.sibling=A,D=A,C=S}if(k===R.length)return n(y,C),Ue&&Yr(y,k),w;if(C===null){for(;k<R.length;k++)C=d(y,R[k],b),C!==null&&(T=s(C,T,k),D===null?w=C:D.sibling=C,D=C);return Ue&&Yr(y,k),w}for(C=i(C);k<R.length;k++)S=p(C,y,k,R[k],b),S!==null&&(t&&S.alternate!==null&&C.delete(S.key===null?k:S.key),T=s(S,T,k),D===null?w=S:D.sibling=S,D=S);return t&&C.forEach(function(I){return e(y,I)}),Ue&&Yr(y,k),w}function g(y,T,R,b){if(R==null)throw Error(K(151));for(var w=null,D=null,C=T,k=T=0,S=null,A=R.next();C!==null&&!A.done;k++,A=R.next()){C.index>k?(S=C,C=null):S=C.sibling;var I=f(y,C,A.value,b);if(I===null){C===null&&(C=S);break}t&&C&&I.alternate===null&&e(y,C),T=s(I,T,k),D===null?w=I:D.sibling=I,D=I,C=S}if(A.done)return n(y,C),Ue&&Yr(y,k),w;if(C===null){for(;!A.done;k++,A=R.next())A=d(y,A.value,b),A!==null&&(T=s(A,T,k),D===null?w=A:D.sibling=A,D=A);return Ue&&Yr(y,k),w}for(C=i(C);!A.done;k++,A=R.next())A=p(C,y,k,A.value,b),A!==null&&(t&&A.alternate!==null&&C.delete(A.key===null?k:A.key),T=s(A,T,k),D===null?w=A:D.sibling=A,D=A);return t&&C.forEach(function(N){return e(y,N)}),Ue&&Yr(y,k),w}function E(y,T,R,b){if(typeof R=="object"&&R!==null&&R.type===Ml&&R.key===null&&(R=R.props.children),typeof R=="object"&&R!==null){switch(R.$$typeof){case Vf:e:{for(var w=R.key;T!==null;){if(T.key===w){if(w=R.type,w===Ml){if(T.tag===7){n(y,T.sibling),b=r(T,R.props.children),b.return=y,y=b;break e}}else if(T.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===$s&&pa(w)===T.type){n(y,T.sibling),b=r(T,R.props),qu(b,R),b.return=y,y=b;break e}n(y,T);break}else e(y,T);T=T.sibling}R.type===Ml?(b=wa(R.props.children,y.mode,b,R.key),b.return=y,y=b):(b=bp(R.type,R.key,R.props,null,y.mode,b),qu(b,R),b.return=y,y=b)}return o(y);case ld:e:{for(w=R.key;T!==null;){if(T.key===w)if(T.tag===4&&T.stateNode.containerInfo===R.containerInfo&&T.stateNode.implementation===R.implementation){n(y,T.sibling),b=r(T,R.children||[]),b.return=y,y=b;break e}else{n(y,T);break}else e(y,T);T=T.sibling}b=yy(R,y.mode,b),b.return=y,y=b}return o(y);case $s:return R=pa(R),E(y,T,R,b)}if(cd(R))return v(y,T,R,b);if(Fu(R)){if(w=Fu(R),typeof w!="function")throw Error(K(150));return R=w.call(R),g(y,T,R,b)}if(typeof R.then=="function")return E(y,T,Gf(R),b);if(R.$$typeof===is)return E(y,T,Hf(y,R),b);Kf(y,R)}return typeof R=="string"&&R!==""||typeof R=="number"||typeof R=="bigint"?(R=""+R,T!==null&&T.tag===6?(n(y,T.sibling),b=r(T,R),b.return=y,y=b):(n(y,T),b=vy(R,y.mode,b),b.return=y,y=b),o(y)):n(y,T)}return function(y,T,R,b){try{eh=0;var w=E(y,T,R,b);return tc=null,w}catch(C){if(C===Jc||C===Ug)throw C;var D=gi(29,C,null,y.mode);return D.lanes=b,D.return=y,D}finally{}}}var Ua=EP(!0),CP=EP(!1),Ws=!1;function PT(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function c_(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function fo(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function po(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,Ke&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,e=cm(t),mP(t,null,n),e}return Lg(t,i,e,n),cm(t)}function kd(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194048)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,qI(t,n)}}function by(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var r=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};s===null?r=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?r=s=e:s=s.next=e}else r=s=e;n={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,callbacks:i.callbacks},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}var u_=!1;function wd(){if(u_){var t=ec;if(t!==null)throw t}}function Rd(t,e,n,i){u_=!1;var r=t.updateQueue;Ws=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=r.baseState;o=0,u=c=l=null,a=s;do{var f=a.lane&-536870913,p=f!==a.lane;if(p?(Me&f)===f:(i&f)===f){f!==0&&f===Ec&&(u_=!0),u!==null&&(u=u.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});e:{var v=t,g=a;f=e;var E=n;switch(g.tag){case 1:if(v=g.payload,typeof v=="function"){d=v.call(E,d,f);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=g.payload,f=typeof v=="function"?v.call(E,d,f):v,f==null)break e;d=mt({},d,f);break e;case 2:Ws=!0}}f=a.callback,f!==null&&(t.flags|=64,p&&(t.flags|=8192),p=r.callbacks,p===null?r.callbacks=[f]:p.push(f))}else p={lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=d):u=u.next=p,o|=f;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;p=a,a=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(!0);u===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,s===null&&(r.shared.lanes=0),Oo|=o,t.lanes=o,t.memoizedState=d}}function kP(t,e){if(typeof t!="function")throw Error(K(191,t));t.call(e)}function wP(t,e){var n=t.callbacks;if(n!==null)for(t.callbacks=null,t=0;t<n.length;t++)kP(n[t],e)}var Cc=Nr(null),fm=Nr(0);function I1(t,e){t=ys,ct(fm,t),ct(Cc,e),ys=t|e.baseLanes}function d_(){ct(fm,ys),ct(Cc,Cc.current)}function xT(){ys=fm.current,pn(Cc),pn(fm)}var wi=Nr(null),qi=null;function Js(t){var e=t.alternate;ct(Ot,Ot.current&1),ct(wi,t),qi===null&&(e===null||Cc.current!==null||e.memoizedState!==null)&&(qi=t)}function h_(t){ct(Ot,Ot.current),ct(wi,t),qi===null&&(qi=t)}function RP(t){t.tag===22?(ct(Ot,Ot.current),ct(wi,t),qi===null&&(qi=t)):Xs()}function Xs(){ct(Ot,Ot.current),ct(wi,wi.current)}function mi(t){pn(wi),qi===t&&(qi=null),pn(Ot)}var Ot=Nr(0);function pm(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||x_(n)||D_(n)))return e}else if(e.tag===19&&(e.memoizedProps.revealOrder==="forwards"||e.memoizedProps.revealOrder==="backwards"||e.memoizedProps.revealOrder==="unstable_legacy-backwards"||e.memoizedProps.revealOrder==="together")){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ms=0,Se=null,nt=null,Vt=null,mm=!1,nc=!1,Va=!1,gm=0,th=0,ic=null,m6=0;function St(){throw Error(K(321))}function DT(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ki(t[n],e[n]))return!1;return!0}function OT(t,e,n,i,r,s){return ms=s,Se=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ge.H=t===null||t.memoizedState===null?rx:HT,Va=!1,s=n(i,r),Va=!1,nc&&(s=IP(e,n,i,r)),AP(t),s}function AP(t){ge.H=nh;var e=nt!==null&&nt.next!==null;if(ms=0,Vt=nt=Se=null,mm=!1,th=0,ic=null,e)throw Error(K(300));t===null||Bt||(t=t.dependencies,t!==null&&dm(t)&&(Bt=!0))}function IP(t,e,n,i){Se=t;var r=0;do{if(nc&&(ic=null),th=0,nc=!1,25<=r)throw Error(K(301));if(r+=1,Vt=nt=null,t.updateQueue!=null){var s=t.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,s.memoCache!=null&&(s.memoCache.index=0)}ge.H=sx,s=e(n,i)}while(nc);return s}function g6(){var t=ge.H,e=t.useState()[0];return e=typeof e.then=="function"?Gh(e):e,t=t.useState()[0],(nt!==null?nt.memoizedState:null)!==t&&(Se.flags|=1024),e}function NT(){var t=gm!==0;return gm=0,t}function MT(t,e,n){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n}function LT(t){if(mm){for(t=t.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}mm=!1}ms=0,Vt=nt=Se=null,nc=!1,th=gm=0,ic=null}function Bn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vt===null?Se.memoizedState=Vt=t:Vt=Vt.next=t,Vt}function Nt(){if(nt===null){var t=Se.alternate;t=t!==null?t.memoizedState:null}else t=nt.next;var e=Vt===null?Se.memoizedState:Vt.next;if(e!==null)Vt=e,nt=t;else{if(t===null)throw Se.alternate===null?Error(K(467)):Error(K(310));nt=t,t={memoizedState:nt.memoizedState,baseState:nt.baseState,baseQueue:nt.baseQueue,queue:nt.queue,next:null},Vt===null?Se.memoizedState=Vt=t:Vt=Vt.next=t}return Vt}function Vg(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Gh(t){var e=th;return th+=1,ic===null&&(ic=[]),t=SP(ic,t,e),e=Se,(Vt===null?e.memoizedState:Vt.next)===null&&(e=e.alternate,ge.H=e===null||e.memoizedState===null?rx:HT),t}function Fg(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Gh(t);if(t.$$typeof===is)return kn(t)}throw Error(K(438,String(t)))}function UT(t){var e=null,n=Se.updateQueue;if(n!==null&&(e=n.memoCache),e==null){var i=Se.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(e={data:i.data.map(function(r){return r.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),n===null&&(n=Vg(),Se.updateQueue=n),n.memoCache=e,n=e.data[e.index],n===void 0)for(n=e.data[e.index]=Array(t),i=0;i<t;i++)n[i]=tU;return e.index++,n}function gs(t,e){return typeof e=="function"?e(t):e}function Sp(t){var e=Nt();return VT(e,nt,t)}function VT(t,e,n){var i=t.queue;if(i===null)throw Error(K(311));i.lastRenderedReducer=n;var r=t.baseQueue,s=i.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}e.baseQueue=r=s,i.pending=null}if(s=t.baseState,r===null)t.memoizedState=s;else{e=r.next;var a=o=null,l=null,c=e,u=!1;do{var d=c.lane&-536870913;if(d!==c.lane?(Me&d)===d:(ms&d)===d){var f=c.revertLane;if(f===0)l!==null&&(l=l.next={lane:0,revertLane:0,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===Ec&&(u=!0);else if((ms&f)===f){c=c.next,f===Ec&&(u=!0);continue}else d={lane:0,revertLane:c.revertLane,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},l===null?(a=l=d,o=s):l=l.next=d,Se.lanes|=f,Oo|=f;d=c.action,Va&&n(s,d),s=c.hasEagerState?c.eagerState:n(s,d)}else f={lane:d,revertLane:c.revertLane,gesture:c.gesture,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},l===null?(a=l=f,o=s):l=l.next=f,Se.lanes|=d,Oo|=d;c=c.next}while(c!==null&&c!==e);if(l===null?o=s:l.next=a,!ki(s,t.memoizedState)&&(Bt=!0,u&&(n=ec,n!==null)))throw n;t.memoizedState=s,t.baseState=o,t.baseQueue=l,i.lastRenderedState=s}return r===null&&(i.lanes=0),[t.memoizedState,i.dispatch]}function Ty(t){var e=Nt(),n=e.queue;if(n===null)throw Error(K(311));n.lastRenderedReducer=t;var i=n.dispatch,r=n.pending,s=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do s=t(s,o.action),o=o.next;while(o!==r);ki(s,e.memoizedState)||(Bt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function PP(t,e,n){var i=Se,r=Nt(),s=Ue;if(s){if(n===void 0)throw Error(K(407));n=n()}else n=e();var o=!ki((nt||r).memoizedState,n);if(o&&(r.memoizedState=n,Bt=!0),r=r.queue,FT(OP.bind(null,i,r,t),[t]),r.getSnapshot!==e||o||Vt!==null&&Vt.memoizedState.tag&1){if(i.flags|=2048,kc(9,{destroy:void 0},DP.bind(null,i,r,n,e),null),ot===null)throw Error(K(349));s||ms&127||xP(i,e,n)}return n}function xP(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Se.updateQueue,e===null?(e=Vg(),Se.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function DP(t,e,n,i){e.value=n,e.getSnapshot=i,NP(e)&&MP(t)}function OP(t,e,n){return n(function(){NP(e)&&MP(t)})}function NP(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ki(t,n)}catch{return!0}}function MP(t){var e=rl(t,2);e!==null&&si(e,t,2)}function f_(t){var e=Bn();if(typeof t=="function"){var n=t;if(t=n(),Va){to(!0);try{n()}finally{to(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:t},e}function LP(t,e,n,i){return t.baseState=n,VT(t,nt,typeof i=="function"?i:gs)}function v6(t,e,n,i,r){if(Bg(t))throw Error(K(485));if(t=e.action,t!==null){var s={payload:r,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(o){s.listeners.push(o)}};ge.T!==null?n(!0):s.isTransition=!1,i(s),n=e.pending,n===null?(s.next=e.pending=s,UP(e,s)):(s.next=n.next,e.pending=n.next=s)}}function UP(t,e){var n=e.action,i=e.payload,r=t.state;if(e.isTransition){var s=ge.T,o={};ge.T=o;try{var a=n(r,i),l=ge.S;l!==null&&l(o,a),P1(t,e,a)}catch(c){p_(t,e,c)}finally{s!==null&&o.types!==null&&(s.types=o.types),ge.T=s}}else try{s=n(r,i),P1(t,e,s)}catch(c){p_(t,e,c)}}function P1(t,e,n){n!==null&&typeof n=="object"&&typeof n.then=="function"?n.then(function(i){x1(t,e,i)},function(i){return p_(t,e,i)}):x1(t,e,n)}function x1(t,e,n){e.status="fulfilled",e.value=n,VP(e),t.state=n,e=t.pending,e!==null&&(n=e.next,n===e?t.pending=null:(n=n.next,e.next=n,UP(t,n)))}function p_(t,e,n){var i=t.pending;if(t.pending=null,i!==null){i=i.next;do e.status="rejected",e.reason=n,VP(e),e=e.next;while(e!==i)}t.action=null}function VP(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function FP(t,e){return e}function D1(t,e){if(Ue){var n=ot.formState;if(n!==null){e:{var i=Se;if(Ue){if(ht){t:{for(var r=ht,s=Vi;r.nodeType!==8;){if(!s){r=null;break t}if(r=zi(r.nextSibling),r===null){r=null;break t}}s=r.data,r=s==="F!"||s==="F"?r:null}if(r){ht=zi(r.nextSibling),i=r.data==="F!";break e}}xo(i)}i=!1}i&&(e=n[0])}}return n=Bn(),n.memoizedState=n.baseState=e,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:FP,lastRenderedState:e},n.queue=i,n=tx.bind(null,Se,i),i.dispatch=n,i=f_(!1),s=zT.bind(null,Se,!1,i.queue),i=Bn(),r={state:e,dispatch:null,action:t,pending:null},i.queue=r,n=v6.bind(null,Se,r,s,n),r.dispatch=n,i.memoizedState=t,[e,n,!1]}function O1(t){var e=Nt();return jP(e,nt,t)}function jP(t,e,n){if(e=VT(t,e,FP)[0],t=Sp(gs)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var i=Gh(e)}catch(o){throw o===Jc?Ug:o}else i=e;e=Nt();var r=e.queue,s=r.dispatch;return n!==e.memoizedState&&(Se.flags|=2048,kc(9,{destroy:void 0},y6.bind(null,r,n),null)),[i,s,t]}function y6(t,e){t.action=e}function N1(t){var e=Nt(),n=nt;if(n!==null)return jP(e,n,t);Nt(),e=e.memoizedState,n=Nt();var i=n.queue.dispatch;return n.memoizedState=t,[e,i,!1]}function kc(t,e,n,i){return t={tag:t,create:n,deps:i,inst:e,next:null},e=Se.updateQueue,e===null&&(e=Vg(),Se.updateQueue=e),n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function BP(){return Nt().memoizedState}function Ep(t,e,n,i){var r=Bn();Se.flags|=t,r.memoizedState=kc(1|e,{destroy:void 0},n,i===void 0?null:i)}function jg(t,e,n,i){var r=Nt();i=i===void 0?null:i;var s=r.memoizedState.inst;nt!==null&&i!==null&&DT(i,nt.memoizedState.deps)?r.memoizedState=kc(e,s,n,i):(Se.flags|=t,r.memoizedState=kc(1|e,s,n,i))}function M1(t,e){Ep(8390656,8,t,e)}function FT(t,e){jg(2048,8,t,e)}function _6(t){Se.flags|=4;var e=Se.updateQueue;if(e===null)e=Vg(),Se.updateQueue=e,e.events=[t];else{var n=e.events;n===null?e.events=[t]:n.push(t)}}function qP(t){var e=Nt().memoizedState;return _6({ref:e,nextImpl:t}),function(){if(Ke&2)throw Error(K(440));return e.impl.apply(void 0,arguments)}}function zP(t,e){return jg(4,2,t,e)}function HP(t,e){return jg(4,4,t,e)}function GP(t,e){if(typeof e=="function"){t=t();var n=e(t);return function(){typeof n=="function"?n():e(null)}}if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function KP(t,e,n){n=n!=null?n.concat([t]):null,jg(4,4,GP.bind(null,e,t),n)}function jT(){}function $P(t,e){var n=Nt();e=e===void 0?null:e;var i=n.memoizedState;return e!==null&&DT(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function WP(t,e){var n=Nt();e=e===void 0?null:e;var i=n.memoizedState;if(e!==null&&DT(e,i[1]))return i[0];if(i=t(),Va){to(!0);try{t()}finally{to(!1)}}return n.memoizedState=[i,e],i}function BT(t,e,n){return n===void 0||ms&1073741824&&!(Me&261930)?t.memoizedState=e:(t.memoizedState=n,t=Lx(),Se.lanes|=t,Oo|=t,n)}function QP(t,e,n,i){return ki(n,e)?n:Cc.current!==null?(t=BT(t,n,i),ki(t,e)||(Bt=!0),t):!(ms&42)||ms&1073741824&&!(Me&261930)?(Bt=!0,t.memoizedState=n):(t=Lx(),Se.lanes|=t,Oo|=t,e)}function YP(t,e,n,i,r){var s=$e.p;$e.p=s!==0&&8>s?s:8;var o=ge.T,a={};ge.T=a,zT(t,!1,e,n);try{var l=r(),c=ge.S;if(c!==null&&c(a,l),l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=p6(l,i);Ad(t,e,u,Ei(t))}else Ad(t,e,i,Ei(t))}catch(d){Ad(t,e,{then:function(){},status:"rejected",reason:d},Ei())}finally{$e.p=s,o!==null&&a.types!==null&&(o.types=a.types),ge.T=o}}function b6(){}function m_(t,e,n,i){if(t.tag!==5)throw Error(K(476));var r=JP(t).queue;YP(t,r,e,ka,n===null?b6:function(){return XP(t),n(i)})}function JP(t){var e=t.memoizedState;if(e!==null)return e;e={memoizedState:ka,baseState:ka,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:ka},next:null};var n={};return e.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gs,lastRenderedState:n},next:null},t.memoizedState=e,t=t.alternate,t!==null&&(t.memoizedState=e),e}function XP(t){var e=JP(t);e.next===null&&(e=t.alternate.memoizedState),Ad(t,e.next.queue,{},Ei())}function qT(){return kn(sh)}function ZP(){return Nt().memoizedState}function ex(){return Nt().memoizedState}function T6(t){for(var e=t.return;e!==null;){switch(e.tag){case 24:case 3:var n=Ei();t=fo(n);var i=po(e,t,n);i!==null&&(si(i,e,n),kd(i,e,n)),e={cache:RT()},t.payload=e;return}e=e.return}}function S6(t,e,n){var i=Ei();n={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Bg(t)?nx(e,n):(n=ET(t,e,n,i),n!==null&&(si(n,t,i),ix(n,e,i)))}function tx(t,e,n){var i=Ei();Ad(t,e,n,i)}function Ad(t,e,n,i){var r={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(Bg(t))nx(e,r);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(r.hasEagerState=!0,r.eagerState=a,ki(a,o))return Lg(t,e,r,0),ot===null&&Mg(),!1}catch{}finally{}if(n=ET(t,e,r,i),n!==null)return si(n,t,i),ix(n,e,i),!0}return!1}function zT(t,e,n,i){if(i={lane:2,revertLane:XT(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},Bg(t)){if(e)throw Error(K(479))}else e=ET(t,n,i,2),e!==null&&si(e,t,2)}function Bg(t){var e=t.alternate;return t===Se||e!==null&&e===Se}function nx(t,e){nc=mm=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function ix(t,e,n){if(n&4194048){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,qI(t,n)}}var nh={readContext:kn,use:Fg,useCallback:St,useContext:St,useEffect:St,useImperativeHandle:St,useLayoutEffect:St,useInsertionEffect:St,useMemo:St,useReducer:St,useRef:St,useState:St,useDebugValue:St,useDeferredValue:St,useTransition:St,useSyncExternalStore:St,useId:St,useHostTransitionStatus:St,useFormState:St,useActionState:St,useOptimistic:St,useMemoCache:St,useCacheRefresh:St};nh.useEffectEvent=St;var rx={readContext:kn,use:Fg,useCallback:function(t,e){return Bn().memoizedState=[t,e===void 0?null:e],t},useContext:kn,useEffect:M1,useImperativeHandle:function(t,e,n){n=n!=null?n.concat([t]):null,Ep(4194308,4,GP.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Ep(4194308,4,t,e)},useInsertionEffect:function(t,e){Ep(4,2,t,e)},useMemo:function(t,e){var n=Bn();e=e===void 0?null:e;var i=t();if(Va){to(!0);try{t()}finally{to(!1)}}return n.memoizedState=[i,e],i},useReducer:function(t,e,n){var i=Bn();if(n!==void 0){var r=n(e);if(Va){to(!0);try{n(e)}finally{to(!1)}}}else r=e;return i.memoizedState=i.baseState=r,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:r},i.queue=t,t=t.dispatch=S6.bind(null,Se,t),[i.memoizedState,t]},useRef:function(t){var e=Bn();return t={current:t},e.memoizedState=t},useState:function(t){t=f_(t);var e=t.queue,n=tx.bind(null,Se,e);return e.dispatch=n,[t.memoizedState,n]},useDebugValue:jT,useDeferredValue:function(t,e){var n=Bn();return BT(n,t,e)},useTransition:function(){var t=f_(!1);return t=YP.bind(null,Se,t.queue,!0,!1),Bn().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,n){var i=Se,r=Bn();if(Ue){if(n===void 0)throw Error(K(407));n=n()}else{if(n=e(),ot===null)throw Error(K(349));Me&127||xP(i,e,n)}r.memoizedState=n;var s={value:n,getSnapshot:e};return r.queue=s,M1(OP.bind(null,i,s,t),[t]),i.flags|=2048,kc(9,{destroy:void 0},DP.bind(null,i,s,n,e),null),n},useId:function(){var t=Bn(),e=ot.identifierPrefix;if(Ue){var n=br,i=_r;n=(i&~(1<<32-Si(i)-1)).toString(32)+n,e="_"+e+"R_"+n,n=gm++,0<n&&(e+="H"+n.toString(32)),e+="_"}else n=m6++,e="_"+e+"r_"+n.toString(32)+"_";return t.memoizedState=e},useHostTransitionStatus:qT,useFormState:D1,useActionState:D1,useOptimistic:function(t){var e=Bn();e.memoizedState=e.baseState=t;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=n,e=zT.bind(null,Se,!0,n),n.dispatch=e,[t,e]},useMemoCache:UT,useCacheRefresh:function(){return Bn().memoizedState=T6.bind(null,Se)},useEffectEvent:function(t){var e=Bn(),n={impl:t};return e.memoizedState=n,function(){if(Ke&2)throw Error(K(440));return n.impl.apply(void 0,arguments)}}},HT={readContext:kn,use:Fg,useCallback:$P,useContext:kn,useEffect:FT,useImperativeHandle:KP,useInsertionEffect:zP,useLayoutEffect:HP,useMemo:WP,useReducer:Sp,useRef:BP,useState:function(){return Sp(gs)},useDebugValue:jT,useDeferredValue:function(t,e){var n=Nt();return QP(n,nt.memoizedState,t,e)},useTransition:function(){var t=Sp(gs)[0],e=Nt().memoizedState;return[typeof t=="boolean"?t:Gh(t),e]},useSyncExternalStore:PP,useId:ZP,useHostTransitionStatus:qT,useFormState:O1,useActionState:O1,useOptimistic:function(t,e){var n=Nt();return LP(n,nt,t,e)},useMemoCache:UT,useCacheRefresh:ex};HT.useEffectEvent=qP;var sx={readContext:kn,use:Fg,useCallback:$P,useContext:kn,useEffect:FT,useImperativeHandle:KP,useInsertionEffect:zP,useLayoutEffect:HP,useMemo:WP,useReducer:Ty,useRef:BP,useState:function(){return Ty(gs)},useDebugValue:jT,useDeferredValue:function(t,e){var n=Nt();return nt===null?BT(n,t,e):QP(n,nt.memoizedState,t,e)},useTransition:function(){var t=Ty(gs)[0],e=Nt().memoizedState;return[typeof t=="boolean"?t:Gh(t),e]},useSyncExternalStore:PP,useId:ZP,useHostTransitionStatus:qT,useFormState:N1,useActionState:N1,useOptimistic:function(t,e){var n=Nt();return nt!==null?LP(n,nt,t,e):(n.baseState=t,[t,n.queue.dispatch])},useMemoCache:UT,useCacheRefresh:ex};sx.useEffectEvent=qP;function Sy(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:mt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var g_={enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Ei(),r=fo(i);r.payload=e,n!=null&&(r.callback=n),e=po(t,r,i),e!==null&&(si(e,t,i),kd(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Ei(),r=fo(i);r.tag=1,r.payload=e,n!=null&&(r.callback=n),e=po(t,r,i),e!==null&&(si(e,t,i),kd(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ei(),i=fo(n);i.tag=2,e!=null&&(i.callback=e),e=po(t,i,n),e!==null&&(si(e,t,n),kd(e,t,n))}};function L1(t,e,n,i,r,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!Jd(n,i)||!Jd(r,s):!0}function U1(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&g_.enqueueReplaceState(e,e.state,null)}function Fa(t,e){var n=e;if("ref"in e){n={};for(var i in e)i!=="ref"&&(n[i]=e[i])}if(t=t.defaultProps){n===e&&(n=mt({},n));for(var r in t)n[r]===void 0&&(n[r]=t[r])}return n}function ox(t){lm(t)}function ax(t){console.error(t)}function lx(t){lm(t)}function vm(t,e){try{var n=t.onUncaughtError;n(e.value,{componentStack:e.stack})}catch(i){setTimeout(function(){throw i})}}function V1(t,e,n){try{var i=t.onCaughtError;i(n.value,{componentStack:n.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(r){setTimeout(function(){throw r})}}function v_(t,e,n){return n=fo(n),n.tag=3,n.payload={element:null},n.callback=function(){vm(t,e)},n}function cx(t){return t=fo(t),t.tag=3,t}function ux(t,e,n,i){var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var s=i.value;t.payload=function(){return r(s)},t.callback=function(){V1(e,n,i)}}var o=n.stateNode;o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){V1(e,n,i),typeof r!="function"&&(mo===null?mo=new Set([this]):mo.add(this));var a=i.stack;this.componentDidCatch(i.value,{componentStack:a!==null?a:""})})}function E6(t,e,n,i,r){if(n.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(e=n.alternate,e!==null&&Yc(e,n,r,!0),n=wi.current,n!==null){switch(n.tag){case 31:case 13:return qi===null?Sm():n.alternate===null&&Ct===0&&(Ct=3),n.flags&=-257,n.flags|=65536,n.lanes=r,i===hm?n.flags|=16384:(e=n.updateQueue,e===null?n.updateQueue=new Set([i]):e.add(i),Oy(t,i,r)),!1;case 22:return n.flags|=65536,i===hm?n.flags|=16384:(e=n.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=e):(n=e.retryQueue,n===null?e.retryQueue=new Set([i]):n.add(i)),Oy(t,i,r)),!1}throw Error(K(435,n.tag))}return Oy(t,i,r),Sm(),!1}if(Ue)return e=wi.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=r,i!==r_&&(t=Error(K(422),{cause:i}),Zd(Ui(t,n)))):(i!==r_&&(e=Error(K(423),{cause:i}),Zd(Ui(e,n))),t=t.current.alternate,t.flags|=65536,r&=-r,t.lanes|=r,i=Ui(i,n),r=v_(t.stateNode,i,r),by(t,r),Ct!==4&&(Ct=2)),!1;var s=Error(K(520),{cause:i});if(s=Ui(s,n),xd===null?xd=[s]:xd.push(s),Ct!==4&&(Ct=2),e===null)return!0;i=Ui(i,n),n=e;do{switch(n.tag){case 3:return n.flags|=65536,t=r&-r,n.lanes|=t,t=v_(n.stateNode,i,t),by(n,t),!1;case 1:if(e=n.type,s=n.stateNode,(n.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||s!==null&&typeof s.componentDidCatch=="function"&&(mo===null||!mo.has(s))))return n.flags|=65536,r&=-r,n.lanes|=r,r=cx(r),ux(r,t,n,i),by(n,r),!1}n=n.return}while(n!==null);return!1}var GT=Error(K(461)),Bt=!1;function bn(t,e,n,i){e.child=t===null?CP(e,null,n,i):Ua(e,t.child,n,i)}function F1(t,e,n,i,r){n=n.render;var s=e.ref;if("ref"in i){var o={};for(var a in i)a!=="ref"&&(o[a]=i[a])}else o=i;return La(e),i=OT(t,e,n,o,s,r),a=NT(),t!==null&&!Bt?(MT(t,e,r),vs(t,e,r)):(Ue&&a&&kT(e),e.flags|=1,bn(t,e,i,r),e.child)}function j1(t,e,n,i,r){if(t===null){var s=n.type;return typeof s=="function"&&!CT(s)&&s.defaultProps===void 0&&n.compare===null?(e.tag=15,e.type=s,dx(t,e,s,i,r)):(t=bp(n.type,null,i,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!KT(t,r)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Jd,n(o,i)&&t.ref===e.ref)return vs(t,e,r)}return e.flags|=1,t=as(s,i),t.ref=e.ref,t.return=e,e.child=t}function dx(t,e,n,i,r){if(t!==null){var s=t.memoizedProps;if(Jd(s,i)&&t.ref===e.ref)if(Bt=!1,e.pendingProps=i=s,KT(t,r))t.flags&131072&&(Bt=!0);else return e.lanes=t.lanes,vs(t,e,r)}return y_(t,e,n,i,r)}function hx(t,e,n,i){var r=i.children,s=t!==null?t.memoizedState:null;if(t===null&&e.stateNode===null&&(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.mode==="hidden"){if(e.flags&128){if(s=s!==null?s.baseLanes|n:n,t!==null){for(i=e.child=t.child,r=0;i!==null;)r=r|i.lanes|i.childLanes,i=i.sibling;i=r&~s}else i=0,e.child=null;return B1(t,e,s,n,i)}if(n&536870912)e.memoizedState={baseLanes:0,cachePool:null},t!==null&&Tp(e,s!==null?s.cachePool:null),s!==null?I1(e,s):d_(),RP(e);else return i=e.lanes=536870912,B1(t,e,s!==null?s.baseLanes|n:n,n,i)}else s!==null?(Tp(e,s.cachePool),I1(e,s),Xs(),e.memoizedState=null):(t!==null&&Tp(e,null),d_(),Xs());return bn(t,e,r,n),e.child}function dd(t,e){return t!==null&&t.tag===22||e.stateNode!==null||(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),e.sibling}function B1(t,e,n,i,r){var s=AT();return s=s===null?null:{parent:jt._currentValue,pool:s},e.memoizedState={baseLanes:n,cachePool:s},t!==null&&Tp(e,null),d_(),RP(e),t!==null&&Yc(t,e,i,!0),e.childLanes=r,null}function Cp(t,e){return e=ym({mode:e.mode,children:e.children},t.mode),e.ref=t.ref,t.child=e,e.return=t,e}function q1(t,e,n){return Ua(e,t.child,null,n),t=Cp(e,e.pendingProps),t.flags|=2,mi(e),e.memoizedState=null,t}function C6(t,e,n){var i=e.pendingProps,r=(e.flags&128)!==0;if(e.flags&=-129,t===null){if(Ue){if(i.mode==="hidden")return t=Cp(e,i),e.lanes=536870912,dd(null,t);if(h_(e),(t=ht)?(t=rD(t,Vi),t=t!==null&&t.data==="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:Po!==null?{id:_r,overflow:br}:null,retryLane:536870912,hydrationErrors:null},n=vP(t),n.return=e,e.child=n,En=e,ht=null)):t=null,t===null)throw xo(e);return e.lanes=536870912,null}return Cp(e,i)}var s=t.memoizedState;if(s!==null){var o=s.dehydrated;if(h_(e),r)if(e.flags&256)e.flags&=-257,e=q1(t,e,n);else if(e.memoizedState!==null)e.child=t.child,e.flags|=128,e=null;else throw Error(K(558));else if(Bt||Yc(t,e,n,!1),r=(n&t.childLanes)!==0,Bt||r){if(i=ot,i!==null&&(o=zI(i,n),o!==0&&o!==s.retryLane))throw s.retryLane=o,rl(t,o),si(i,t,o),GT;Sm(),e=q1(t,e,n)}else t=s.treeContext,ht=zi(o.nextSibling),En=e,Ue=!0,ho=null,Vi=!1,t!==null&&_P(e,t),e=Cp(e,i),e.flags|=4096;return e}return t=as(t.child,{mode:i.mode,children:i.children}),t.ref=e.ref,e.child=t,t.return=e,t}function kp(t,e){var n=e.ref;if(n===null)t!==null&&t.ref!==null&&(e.flags|=4194816);else{if(typeof n!="function"&&typeof n!="object")throw Error(K(284));(t===null||t.ref!==n)&&(e.flags|=4194816)}}function y_(t,e,n,i,r){return La(e),n=OT(t,e,n,i,void 0,r),i=NT(),t!==null&&!Bt?(MT(t,e,r),vs(t,e,r)):(Ue&&i&&kT(e),e.flags|=1,bn(t,e,n,r),e.child)}function z1(t,e,n,i,r,s){return La(e),e.updateQueue=null,n=IP(e,i,n,r),AP(t),i=NT(),t!==null&&!Bt?(MT(t,e,s),vs(t,e,s)):(Ue&&i&&kT(e),e.flags|=1,bn(t,e,n,s),e.child)}function H1(t,e,n,i,r){if(La(e),e.stateNode===null){var s=zl,o=n.contextType;typeof o=="object"&&o!==null&&(s=kn(o)),s=new n(i,s),e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=g_,e.stateNode=s,s._reactInternals=e,s=e.stateNode,s.props=i,s.state=e.memoizedState,s.refs={},PT(e),o=n.contextType,s.context=typeof o=="object"&&o!==null?kn(o):zl,s.state=e.memoizedState,o=n.getDerivedStateFromProps,typeof o=="function"&&(Sy(e,n,o,i),s.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(o=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),o!==s.state&&g_.enqueueReplaceState(s,s.state,null),Rd(e,i,s,r),wd(),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308),i=!0}else if(t===null){s=e.stateNode;var a=e.memoizedProps,l=Fa(n,a);s.props=l;var c=s.context,u=n.contextType;o=zl,typeof u=="object"&&u!==null&&(o=kn(u));var d=n.getDerivedStateFromProps;u=typeof d=="function"||typeof s.getSnapshotBeforeUpdate=="function",a=e.pendingProps!==a,u||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a||c!==o)&&U1(e,s,i,o),Ws=!1;var f=e.memoizedState;s.state=f,Rd(e,i,s,r),wd(),c=e.memoizedState,a||f!==c||Ws?(typeof d=="function"&&(Sy(e,n,d,i),c=e.memoizedState),(l=Ws||L1(e,n,l,i,f,c,o))?(u||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),s.props=i,s.state=c,s.context=o,i=l):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{s=e.stateNode,c_(t,e),o=e.memoizedProps,u=Fa(n,o),s.props=u,d=e.pendingProps,f=s.context,c=n.contextType,l=zl,typeof c=="object"&&c!==null&&(l=kn(c)),a=n.getDerivedStateFromProps,(c=typeof a=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o!==d||f!==l)&&U1(e,s,i,l),Ws=!1,f=e.memoizedState,s.state=f,Rd(e,i,s,r),wd();var p=e.memoizedState;o!==d||f!==p||Ws||t!==null&&t.dependencies!==null&&dm(t.dependencies)?(typeof a=="function"&&(Sy(e,n,a,i),p=e.memoizedState),(u=Ws||L1(e,n,u,i,f,p,l)||t!==null&&t.dependencies!==null&&dm(t.dependencies))?(c||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(i,p,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(i,p,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),s.props=i,s.state=p,s.context=l,i=u):(typeof s.componentDidUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return s=i,kp(t,e),i=(e.flags&128)!==0,s||i?(s=e.stateNode,n=i&&typeof n.getDerivedStateFromError!="function"?null:s.render(),e.flags|=1,t!==null&&i?(e.child=Ua(e,t.child,null,r),e.child=Ua(e,null,n,r)):bn(t,e,n,r),e.memoizedState=s.state,t=e.child):t=vs(t,e,r),t}function G1(t,e,n,i){return Ma(),e.flags|=256,bn(t,e,n,i),e.child}var Ey={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Cy(t){return{baseLanes:t,cachePool:TP()}}function ky(t,e,n){return t=t!==null?t.childLanes&~n:0,e&&(t|=yi),t}function fx(t,e,n){var i=e.pendingProps,r=!1,s=(e.flags&128)!==0,o;if((o=s)||(o=t!==null&&t.memoizedState===null?!1:(Ot.current&2)!==0),o&&(r=!0,e.flags&=-129),o=(e.flags&32)!==0,e.flags&=-33,t===null){if(Ue){if(r?Js(e):Xs(),(t=ht)?(t=rD(t,Vi),t=t!==null&&t.data!=="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:Po!==null?{id:_r,overflow:br}:null,retryLane:536870912,hydrationErrors:null},n=vP(t),n.return=e,e.child=n,En=e,ht=null)):t=null,t===null)throw xo(e);return D_(t)?e.lanes=32:e.lanes=536870912,null}var a=i.children;return i=i.fallback,r?(Xs(),r=e.mode,a=ym({mode:"hidden",children:a},r),i=wa(i,r,n,null),a.return=e,i.return=e,a.sibling=i,e.child=a,i=e.child,i.memoizedState=Cy(n),i.childLanes=ky(t,o,n),e.memoizedState=Ey,dd(null,i)):(Js(e),__(e,a))}var l=t.memoizedState;if(l!==null&&(a=l.dehydrated,a!==null)){if(s)e.flags&256?(Js(e),e.flags&=-257,e=wy(t,e,n)):e.memoizedState!==null?(Xs(),e.child=t.child,e.flags|=128,e=null):(Xs(),a=i.fallback,r=e.mode,i=ym({mode:"visible",children:i.children},r),a=wa(a,r,n,null),a.flags|=2,i.return=e,a.return=e,i.sibling=a,e.child=i,Ua(e,t.child,null,n),i=e.child,i.memoizedState=Cy(n),i.childLanes=ky(t,o,n),e.memoizedState=Ey,e=dd(null,i));else if(Js(e),D_(a)){if(o=a.nextSibling&&a.nextSibling.dataset,o)var c=o.dgst;o=c,i=Error(K(419)),i.stack="",i.digest=o,Zd({value:i,source:null,stack:null}),e=wy(t,e,n)}else if(Bt||Yc(t,e,n,!1),o=(n&t.childLanes)!==0,Bt||o){if(o=ot,o!==null&&(i=zI(o,n),i!==0&&i!==l.retryLane))throw l.retryLane=i,rl(t,i),si(o,t,i),GT;x_(a)||Sm(),e=wy(t,e,n)}else x_(a)?(e.flags|=192,e.child=t.child,e=null):(t=l.treeContext,ht=zi(a.nextSibling),En=e,Ue=!0,ho=null,Vi=!1,t!==null&&_P(e,t),e=__(e,i.children),e.flags|=4096);return e}return r?(Xs(),a=i.fallback,r=e.mode,l=t.child,c=l.sibling,i=as(l,{mode:"hidden",children:i.children}),i.subtreeFlags=l.subtreeFlags&65011712,c!==null?a=as(c,a):(a=wa(a,r,n,null),a.flags|=2),a.return=e,i.return=e,i.sibling=a,e.child=i,dd(null,i),i=e.child,a=t.child.memoizedState,a===null?a=Cy(n):(r=a.cachePool,r!==null?(l=jt._currentValue,r=r.parent!==l?{parent:l,pool:l}:r):r=TP(),a={baseLanes:a.baseLanes|n,cachePool:r}),i.memoizedState=a,i.childLanes=ky(t,o,n),e.memoizedState=Ey,dd(t.child,i)):(Js(e),n=t.child,t=n.sibling,n=as(n,{mode:"visible",children:i.children}),n.return=e,n.sibling=null,t!==null&&(o=e.deletions,o===null?(e.deletions=[t],e.flags|=16):o.push(t)),e.child=n,e.memoizedState=null,n)}function __(t,e){return e=ym({mode:"visible",children:e},t.mode),e.return=t,t.child=e}function ym(t,e){return t=gi(22,t,null,e),t.lanes=0,t}function wy(t,e,n){return Ua(e,t.child,null,n),t=__(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function K1(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),o_(t.return,e,n)}function Ry(t,e,n,i,r,s){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:r,treeForkCount:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=n,o.tailMode=r,o.treeForkCount=s)}function px(t,e,n){var i=e.pendingProps,r=i.revealOrder,s=i.tail;i=i.children;var o=Ot.current,a=(o&2)!==0;if(a?(o=o&1|2,e.flags|=128):o&=1,ct(Ot,o),bn(t,e,i,n),i=Ue?Xd:0,!a&&t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&K1(t,n,e);else if(t.tag===19)K1(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&pm(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),Ry(e,!1,r,n,s,i);break;case"backwards":case"unstable_legacy-backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&pm(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}Ry(e,!0,n,null,s,i);break;case"together":Ry(e,!1,null,null,void 0,i);break;default:e.memoizedState=null}return e.child}function vs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Oo|=e.lanes,!(n&e.childLanes))if(t!==null){if(Yc(t,e,n,!1),(n&e.childLanes)===0)return null}else return null;if(t!==null&&e.child!==t.child)throw Error(K(153));if(e.child!==null){for(t=e.child,n=as(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=as(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function KT(t,e){return t.lanes&e?!0:(t=t.dependencies,!!(t!==null&&dm(t)))}function k6(t,e,n){switch(e.tag){case 3:rm(e,e.stateNode.containerInfo),Ys(e,jt,t.memoizedState.cache),Ma();break;case 27:case 5:$0(e);break;case 4:rm(e,e.stateNode.containerInfo);break;case 10:Ys(e,e.type,e.memoizedProps.value);break;case 31:if(e.memoizedState!==null)return e.flags|=128,h_(e),null;break;case 13:var i=e.memoizedState;if(i!==null)return i.dehydrated!==null?(Js(e),e.flags|=128,null):n&e.child.childLanes?fx(t,e,n):(Js(e),t=vs(t,e,n),t!==null?t.sibling:null);Js(e);break;case 19:var r=(t.flags&128)!==0;if(i=(n&e.childLanes)!==0,i||(Yc(t,e,n,!1),i=(n&e.childLanes)!==0),r){if(i)return px(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ct(Ot,Ot.current),i)break;return null;case 22:return e.lanes=0,hx(t,e,n,e.pendingProps);case 24:Ys(e,jt,t.memoizedState.cache)}return vs(t,e,n)}function mx(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps)Bt=!0;else{if(!KT(t,n)&&!(e.flags&128))return Bt=!1,k6(t,e,n);Bt=!!(t.flags&131072)}else Bt=!1,Ue&&e.flags&1048576&&yP(e,Xd,e.index);switch(e.lanes=0,e.tag){case 16:e:{var i=e.pendingProps;if(t=pa(e.elementType),e.type=t,typeof t=="function")CT(t)?(i=Fa(t,i),e.tag=1,e=H1(null,e,t,i,n)):(e.tag=0,e=y_(null,e,t,i,n));else{if(t!=null){var r=t.$$typeof;if(r===uT){e.tag=11,e=F1(null,e,t,i,n);break e}else if(r===dT){e.tag=14,e=j1(null,e,t,i,n);break e}}throw e=G0(t)||t,Error(K(306,e,""))}}return e;case 0:return y_(t,e,e.type,e.pendingProps,n);case 1:return i=e.type,r=Fa(i,e.pendingProps),H1(t,e,i,r,n);case 3:e:{if(rm(e,e.stateNode.containerInfo),t===null)throw Error(K(387));i=e.pendingProps;var s=e.memoizedState;r=s.element,c_(t,e),Rd(e,i,null,n);var o=e.memoizedState;if(i=o.cache,Ys(e,jt,i),i!==s.cache&&a_(e,[jt],n,!0),wd(),i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){e=G1(t,e,i,n);break e}else if(i!==r){r=Ui(Error(K(424)),e),Zd(r),e=G1(t,e,i,n);break e}else{switch(t=e.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(ht=zi(t.firstChild),En=e,Ue=!0,ho=null,Vi=!0,n=CP(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(Ma(),i===r){e=vs(t,e,n);break e}bn(t,e,i,n)}e=e.child}return e;case 26:return kp(t,e),t===null?(n=hk(e.type,null,e.pendingProps,null))?e.memoizedState=n:Ue||(n=e.type,t=e.pendingProps,i=wm(uo.current).createElement(n),i[Sn]=e,i[ai]=t,An(i,n,t),dn(i),e.stateNode=i):e.memoizedState=hk(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return $0(e),t===null&&Ue&&(i=e.stateNode=sD(e.type,e.pendingProps,uo.current),En=e,Vi=!0,r=ht,Ko(e.type)?(O_=r,ht=zi(i.firstChild)):ht=r),bn(t,e,e.pendingProps.children,n),kp(t,e),t===null&&(e.flags|=4194304),e.child;case 5:return t===null&&Ue&&((r=i=ht)&&(i=t5(i,e.type,e.pendingProps,Vi),i!==null?(e.stateNode=i,En=e,ht=zi(i.firstChild),Vi=!1,r=!0):r=!1),r||xo(e)),$0(e),r=e.type,s=e.pendingProps,o=t!==null?t.memoizedProps:null,i=s.children,I_(r,s)?i=null:o!==null&&I_(r,o)&&(e.flags|=32),e.memoizedState!==null&&(r=OT(t,e,g6,null,null,n),sh._currentValue=r),kp(t,e),bn(t,e,i,n),e.child;case 6:return t===null&&Ue&&((t=n=ht)&&(n=n5(n,e.pendingProps,Vi),n!==null?(e.stateNode=n,En=e,ht=null,t=!0):t=!1),t||xo(e)),null;case 13:return fx(t,e,n);case 4:return rm(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Ua(e,null,i,n):bn(t,e,i,n),e.child;case 11:return F1(t,e,e.type,e.pendingProps,n);case 7:return bn(t,e,e.pendingProps,n),e.child;case 8:return bn(t,e,e.pendingProps.children,n),e.child;case 12:return bn(t,e,e.pendingProps.children,n),e.child;case 10:return i=e.pendingProps,Ys(e,e.type,i.value),bn(t,e,i.children,n),e.child;case 9:return r=e.type._context,i=e.pendingProps.children,La(e),r=kn(r),i=i(r),e.flags|=1,bn(t,e,i,n),e.child;case 14:return j1(t,e,e.type,e.pendingProps,n);case 15:return dx(t,e,e.type,e.pendingProps,n);case 19:return px(t,e,n);case 31:return C6(t,e,n);case 22:return hx(t,e,n,e.pendingProps);case 24:return La(e),i=kn(jt),t===null?(r=AT(),r===null&&(r=ot,s=RT(),r.pooledCache=s,s.refCount++,s!==null&&(r.pooledCacheLanes|=n),r=s),e.memoizedState={parent:i,cache:r},PT(e),Ys(e,jt,r)):(t.lanes&n&&(c_(t,e),Rd(e,null,null,n),wd()),r=t.memoizedState,s=e.memoizedState,r.parent!==i?(r={parent:i,cache:i},e.memoizedState=r,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=r),Ys(e,jt,i)):(i=s.cache,Ys(e,jt,i),i!==r.cache&&a_(e,[jt],n,!0))),bn(t,e,e.pendingProps.children,n),e.child;case 29:throw e.pendingProps}throw Error(K(156,e.tag))}function Hr(t){t.flags|=4}function Ay(t,e,n,i,r){if((e=(t.mode&32)!==0)&&(e=!1),e){if(t.flags|=16777216,(r&335544128)===r)if(t.stateNode.complete)t.flags|=8192;else if(Fx())t.flags|=8192;else throw Aa=hm,IT}else t.flags&=-16777217}function $1(t,e){if(e.type!=="stylesheet"||e.state.loading&4)t.flags&=-16777217;else if(t.flags|=16777216,!lD(e))if(Fx())t.flags|=8192;else throw Aa=hm,IT}function $f(t,e){e!==null&&(t.flags|=4),t.flags&16384&&(e=t.tag!==22?jI():536870912,t.lanes|=e,wc|=e)}function zu(t,e){if(!Ue)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function ut(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags&65011712,i|=r.flags&65011712,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function w6(t,e,n){var i=e.pendingProps;switch(wT(e),e.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ut(e),null;case 1:return ut(e),null;case 3:return n=e.stateNode,i=null,t!==null&&(i=t.memoizedState.cache),e.memoizedState.cache!==i&&(e.flags|=2048),ls(jt),bc(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(El(e)?Hr(e):t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,_y())),ut(e),null;case 26:var r=e.type,s=e.memoizedState;return t===null?(Hr(e),s!==null?(ut(e),$1(e,s)):(ut(e),Ay(e,r,null,i,n))):s?s!==t.memoizedState?(Hr(e),ut(e),$1(e,s)):(ut(e),e.flags&=-16777217):(t=t.memoizedProps,t!==i&&Hr(e),ut(e),Ay(e,r,t,i,n)),null;case 27:if(sm(e),n=uo.current,r=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==i&&Hr(e);else{if(!i){if(e.stateNode===null)throw Error(K(166));return ut(e),null}t=Sr.current,El(e)?S1(e):(t=sD(r,i,n),e.stateNode=t,Hr(e))}return ut(e),null;case 5:if(sm(e),r=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==i&&Hr(e);else{if(!i){if(e.stateNode===null)throw Error(K(166));return ut(e),null}if(s=Sr.current,El(e))S1(e);else{var o=wm(uo.current);switch(s){case 1:s=o.createElementNS("http://www.w3.org/2000/svg",r);break;case 2:s=o.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;default:switch(r){case"svg":s=o.createElementNS("http://www.w3.org/2000/svg",r);break;case"math":s=o.createElementNS("http://www.w3.org/1998/Math/MathML",r);break;case"script":s=o.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof i.is=="string"?o.createElement("select",{is:i.is}):o.createElement("select"),i.multiple?s.multiple=!0:i.size&&(s.size=i.size);break;default:s=typeof i.is=="string"?o.createElement(r,{is:i.is}):o.createElement(r)}}s[Sn]=e,s[ai]=i;e:for(o=e.child;o!==null;){if(o.tag===5||o.tag===6)s.appendChild(o.stateNode);else if(o.tag!==4&&o.tag!==27&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===e)break e;for(;o.sibling===null;){if(o.return===null||o.return===e)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}e.stateNode=s;e:switch(An(s,r,i),r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Hr(e)}}return ut(e),Ay(e,e.type,t===null?null:t.memoizedProps,e.pendingProps,n),null;case 6:if(t&&e.stateNode!=null)t.memoizedProps!==i&&Hr(e);else{if(typeof i!="string"&&e.stateNode===null)throw Error(K(166));if(t=uo.current,El(e)){if(t=e.stateNode,n=e.memoizedProps,i=null,r=En,r!==null)switch(r.tag){case 27:case 5:i=r.memoizedProps}t[Sn]=e,t=!!(t.nodeValue===n||i!==null&&i.suppressHydrationWarning===!0||tD(t.nodeValue,n)),t||xo(e,!0)}else t=wm(t).createTextNode(i),t[Sn]=e,e.stateNode=t}return ut(e),null;case 31:if(n=e.memoizedState,t===null||t.memoizedState!==null){if(i=El(e),n!==null){if(t===null){if(!i)throw Error(K(318));if(t=e.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(K(557));t[Sn]=e}else Ma(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ut(e),t=!1}else n=_y(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=n),t=!0;if(!t)return e.flags&256?(mi(e),e):(mi(e),null);if(e.flags&128)throw Error(K(558))}return ut(e),null;case 13:if(i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(r=El(e),i!==null&&i.dehydrated!==null){if(t===null){if(!r)throw Error(K(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(K(317));r[Sn]=e}else Ma(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ut(e),r=!1}else r=_y(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=r),r=!0;if(!r)return e.flags&256?(mi(e),e):(mi(e),null)}return mi(e),e.flags&128?(e.lanes=n,e):(n=i!==null,t=t!==null&&t.memoizedState!==null,n&&(i=e.child,r=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(r=i.alternate.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==r&&(i.flags|=2048)),n!==t&&n&&(e.child.flags|=8192),$f(e,e.updateQueue),ut(e),null);case 4:return bc(),t===null&&ZT(e.stateNode.containerInfo),ut(e),null;case 10:return ls(e.type),ut(e),null;case 19:if(pn(Ot),i=e.memoizedState,i===null)return ut(e),null;if(r=(e.flags&128)!==0,s=i.rendering,s===null)if(r)zu(i,!1);else{if(Ct!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=pm(t),s!==null){for(e.flags|=128,zu(i,!1),t=s.updateQueue,e.updateQueue=t,$f(e,t),e.subtreeFlags=0,t=n,n=e.child;n!==null;)gP(n,t),n=n.sibling;return ct(Ot,Ot.current&1|2),Ue&&Yr(e,i.treeForkCount),e.child}t=t.sibling}i.tail!==null&&bi()>bm&&(e.flags|=128,r=!0,zu(i,!1),e.lanes=4194304)}else{if(!r)if(t=pm(s),t!==null){if(e.flags|=128,r=!0,t=t.updateQueue,e.updateQueue=t,$f(e,t),zu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!Ue)return ut(e),null}else 2*bi()-i.renderingStartTime>bm&&n!==536870912&&(e.flags|=128,r=!0,zu(i,!1),e.lanes=4194304);i.isBackwards?(s.sibling=e.child,e.child=s):(t=i.last,t!==null?t.sibling=s:e.child=s,i.last=s)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=bi(),t.sibling=null,n=Ot.current,ct(Ot,r?n&1|2:n&1),Ue&&Yr(e,i.treeForkCount),t):(ut(e),null);case 22:case 23:return mi(e),xT(),i=e.memoizedState!==null,t!==null?t.memoizedState!==null!==i&&(e.flags|=8192):i&&(e.flags|=8192),i?n&536870912&&!(e.flags&128)&&(ut(e),e.subtreeFlags&6&&(e.flags|=8192)):ut(e),n=e.updateQueue,n!==null&&$f(e,n.retryQueue),n=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),i=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),i!==n&&(e.flags|=2048),t!==null&&pn(Ra),null;case 24:return n=null,t!==null&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),ls(jt),ut(e),null;case 25:return null;case 30:return null}throw Error(K(156,e.tag))}function R6(t,e){switch(wT(e),e.tag){case 1:return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ls(jt),bc(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 26:case 27:case 5:return sm(e),null;case 31:if(e.memoizedState!==null){if(mi(e),e.alternate===null)throw Error(K(340));Ma()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 13:if(mi(e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(K(340));Ma()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return pn(Ot),null;case 4:return bc(),null;case 10:return ls(e.type),null;case 22:case 23:return mi(e),xT(),t!==null&&pn(Ra),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 24:return ls(jt),null;case 25:return null;default:return null}}function gx(t,e){switch(wT(e),e.tag){case 3:ls(jt),bc();break;case 26:case 27:case 5:sm(e);break;case 4:bc();break;case 31:e.memoizedState!==null&&mi(e);break;case 13:mi(e);break;case 19:pn(Ot);break;case 10:ls(e.type);break;case 22:case 23:mi(e),xT(),t!==null&&pn(Ra);break;case 24:ls(jt)}}function Kh(t,e){try{var n=e.updateQueue,i=n!==null?n.lastEffect:null;if(i!==null){var r=i.next;n=r;do{if((n.tag&t)===t){i=void 0;var s=n.create,o=n.inst;i=s(),o.destroy=i}n=n.next}while(n!==r)}}catch(a){Xe(e,e.return,a)}}function Do(t,e,n){try{var i=e.updateQueue,r=i!==null?i.lastEffect:null;if(r!==null){var s=r.next;i=s;do{if((i.tag&t)===t){var o=i.inst,a=o.destroy;if(a!==void 0){o.destroy=void 0,r=e;var l=n,c=a;try{c()}catch(u){Xe(r,l,u)}}}i=i.next}while(i!==s)}}catch(u){Xe(e,e.return,u)}}function vx(t){var e=t.updateQueue;if(e!==null){var n=t.stateNode;try{wP(e,n)}catch(i){Xe(t,t.return,i)}}}function yx(t,e,n){n.props=Fa(t.type,t.memoizedProps),n.state=t.memoizedState;try{n.componentWillUnmount()}catch(i){Xe(t,e,i)}}function Id(t,e){try{var n=t.ref;if(n!==null){switch(t.tag){case 26:case 27:case 5:var i=t.stateNode;break;case 30:i=t.stateNode;break;default:i=t.stateNode}typeof n=="function"?t.refCleanup=n(i):n.current=i}}catch(r){Xe(t,e,r)}}function Tr(t,e){var n=t.ref,i=t.refCleanup;if(n!==null)if(typeof i=="function")try{i()}catch(r){Xe(t,e,r)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof n=="function")try{n(null)}catch(r){Xe(t,e,r)}else n.current=null}function _x(t){var e=t.type,n=t.memoizedProps,i=t.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(r){Xe(t,t.return,r)}}function Iy(t,e,n){try{var i=t.stateNode;Q6(i,t.type,n,e),i[ai]=e}catch(r){Xe(t,t.return,r)}}function bx(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Ko(t.type)||t.tag===4}function Py(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||bx(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Ko(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function b_(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n).insertBefore(t,e):(e=n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,e.appendChild(t),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=rs));else if(i!==4&&(i===27&&Ko(t.type)&&(n=t.stateNode,e=null),t=t.child,t!==null))for(b_(t,e,n),t=t.sibling;t!==null;)b_(t,e,n),t=t.sibling}function _m(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(i===27&&Ko(t.type)&&(n=t.stateNode),t=t.child,t!==null))for(_m(t,e,n),t=t.sibling;t!==null;)_m(t,e,n),t=t.sibling}function Tx(t){var e=t.stateNode,n=t.memoizedProps;try{for(var i=t.type,r=e.attributes;r.length;)e.removeAttributeNode(r[0]);An(e,i,n),e[Sn]=t,e[ai]=n}catch(s){Xe(t,t.return,s)}}var Xr=!1,Ft=!1,xy=!1,W1=typeof WeakSet=="function"?WeakSet:Set,ln=null;function A6(t,e){if(t=t.containerInfo,R_=Pm,t=lP(t),TT(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,f=null;t:for(;;){for(var p;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==s||i!==0&&d.nodeType!==3||(l=o+i),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===t)break t;if(f===n&&++c===r&&(a=o),f===s&&++u===i&&(l=o),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(A_={focusedElem:t,selectionRange:n},Pm=!1,ln=e;ln!==null;)if(e=ln,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ln=t;else for(;ln!==null;){switch(e=ln,s=e.alternate,t=e.flags,e.tag){case 0:if(t&4&&(t=e.updateQueue,t=t!==null?t.events:null,t!==null))for(n=0;n<t.length;n++)r=t[n],r.ref.impl=r.nextImpl;break;case 11:case 15:break;case 1:if(t&1024&&s!==null){t=void 0,n=e,r=s.memoizedProps,s=s.memoizedState,i=n.stateNode;try{var v=Fa(n.type,r);t=i.getSnapshotBeforeUpdate(v,s),i.__reactInternalSnapshotBeforeUpdate=t}catch(g){Xe(n,n.return,g)}}break;case 3:if(t&1024){if(t=e.stateNode.containerInfo,n=t.nodeType,n===9)P_(t);else if(n===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":P_(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(t&1024)throw Error(K(163))}if(t=e.sibling,t!==null){t.return=e.return,ln=t;break}ln=e.return}}function Sx(t,e,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:Kr(t,n),i&4&&Kh(5,n);break;case 1:if(Kr(t,n),i&4)if(t=n.stateNode,e===null)try{t.componentDidMount()}catch(o){Xe(n,n.return,o)}else{var r=Fa(n.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(r,e,t.__reactInternalSnapshotBeforeUpdate)}catch(o){Xe(n,n.return,o)}}i&64&&vx(n),i&512&&Id(n,n.return);break;case 3:if(Kr(t,n),i&64&&(t=n.updateQueue,t!==null)){if(e=null,n.child!==null)switch(n.child.tag){case 27:case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}try{wP(t,e)}catch(o){Xe(n,n.return,o)}}break;case 27:e===null&&i&4&&Tx(n);case 26:case 5:Kr(t,n),e===null&&i&4&&_x(n),i&512&&Id(n,n.return);break;case 12:Kr(t,n);break;case 31:Kr(t,n),i&4&&kx(t,n);break;case 13:Kr(t,n),i&4&&wx(t,n),i&64&&(t=n.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(n=U6.bind(null,n),i5(t,n))));break;case 22:if(i=n.memoizedState!==null||Xr,!i){e=e!==null&&e.memoizedState!==null||Ft,r=Xr;var s=Ft;Xr=i,(Ft=e)&&!s?$r(t,n,(n.subtreeFlags&8772)!==0):Kr(t,n),Xr=r,Ft=s}break;case 30:break;default:Kr(t,n)}}function Ex(t){var e=t.alternate;e!==null&&(t.alternate=null,Ex(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&mT(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var yt=null,Xn=!1;function Gr(t,e,n){for(n=n.child;n!==null;)Cx(t,e,n),n=n.sibling}function Cx(t,e,n){if(Ti&&typeof Ti.onCommitFiberUnmount=="function")try{Ti.onCommitFiberUnmount(Fh,n)}catch{}switch(n.tag){case 26:Ft||Tr(n,e),Gr(t,e,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:Ft||Tr(n,e);var i=yt,r=Xn;Ko(n.type)&&(yt=n.stateNode,Xn=!1),Gr(t,e,n),Od(n.stateNode),yt=i,Xn=r;break;case 5:Ft||Tr(n,e);case 6:if(i=yt,r=Xn,yt=null,Gr(t,e,n),yt=i,Xn=r,yt!==null)if(Xn)try{(yt.nodeType===9?yt.body:yt.nodeName==="HTML"?yt.ownerDocument.body:yt).removeChild(n.stateNode)}catch(s){Xe(n,e,s)}else try{yt.removeChild(n.stateNode)}catch(s){Xe(n,e,s)}break;case 18:yt!==null&&(Xn?(t=yt,ak(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,n.stateNode),Pc(t)):ak(yt,n.stateNode));break;case 4:i=yt,r=Xn,yt=n.stateNode.containerInfo,Xn=!0,Gr(t,e,n),yt=i,Xn=r;break;case 0:case 11:case 14:case 15:Do(2,n,e),Ft||Do(4,n,e),Gr(t,e,n);break;case 1:Ft||(Tr(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"&&yx(n,e,i)),Gr(t,e,n);break;case 21:Gr(t,e,n);break;case 22:Ft=(i=Ft)||n.memoizedState!==null,Gr(t,e,n),Ft=i;break;default:Gr(t,e,n)}}function kx(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{Pc(t)}catch(n){Xe(e,e.return,n)}}}function wx(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Pc(t)}catch(n){Xe(e,e.return,n)}}function I6(t){switch(t.tag){case 31:case 13:case 19:var e=t.stateNode;return e===null&&(e=t.stateNode=new W1),e;case 22:return t=t.stateNode,e=t._retryCache,e===null&&(e=t._retryCache=new W1),e;default:throw Error(K(435,t.tag))}}function Wf(t,e){var n=I6(t);e.forEach(function(i){if(!n.has(i)){n.add(i);var r=V6.bind(null,t,i);i.then(r,r)}})}function Yn(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var r=n[i],s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 27:if(Ko(a.type)){yt=a.stateNode,Xn=!1;break e}break;case 5:yt=a.stateNode,Xn=!1;break e;case 3:case 4:yt=a.stateNode.containerInfo,Xn=!0;break e}a=a.return}if(yt===null)throw Error(K(160));Cx(s,o,r),yt=null,Xn=!1,s=r.alternate,s!==null&&(s.return=null),r.return=null}if(e.subtreeFlags&13886)for(e=e.child;e!==null;)Rx(e,t),e=e.sibling}var Yi=null;function Rx(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Yn(e,t),Jn(t),i&4&&(Do(3,t,t.return),Kh(3,t),Do(5,t,t.return));break;case 1:Yn(e,t),Jn(t),i&512&&(Ft||n===null||Tr(n,n.return)),i&64&&Xr&&(t=t.updateQueue,t!==null&&(i=t.callbacks,i!==null&&(n=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=n===null?i:n.concat(i))));break;case 26:var r=Yi;if(Yn(e,t),Jn(t),i&512&&(Ft||n===null||Tr(n,n.return)),i&4){var s=n!==null?n.memoizedState:null;if(i=t.memoizedState,n===null)if(i===null)if(t.stateNode===null){e:{i=t.type,n=t.memoizedProps,r=r.ownerDocument||r;t:switch(i){case"title":s=r.getElementsByTagName("title")[0],(!s||s[qh]||s[Sn]||s.namespaceURI==="http://www.w3.org/2000/svg"||s.hasAttribute("itemprop"))&&(s=r.createElement(i),r.head.insertBefore(s,r.querySelector("head > title"))),An(s,i,n),s[Sn]=t,dn(s),i=s;break e;case"link":var o=pk("link","href",r).get(i+(n.href||""));if(o){for(var a=0;a<o.length;a++)if(s=o[a],s.getAttribute("href")===(n.href==null||n.href===""?null:n.href)&&s.getAttribute("rel")===(n.rel==null?null:n.rel)&&s.getAttribute("title")===(n.title==null?null:n.title)&&s.getAttribute("crossorigin")===(n.crossOrigin==null?null:n.crossOrigin)){o.splice(a,1);break t}}s=r.createElement(i),An(s,i,n),r.head.appendChild(s);break;case"meta":if(o=pk("meta","content",r).get(i+(n.content||""))){for(a=0;a<o.length;a++)if(s=o[a],s.getAttribute("content")===(n.content==null?null:""+n.content)&&s.getAttribute("name")===(n.name==null?null:n.name)&&s.getAttribute("property")===(n.property==null?null:n.property)&&s.getAttribute("http-equiv")===(n.httpEquiv==null?null:n.httpEquiv)&&s.getAttribute("charset")===(n.charSet==null?null:n.charSet)){o.splice(a,1);break t}}s=r.createElement(i),An(s,i,n),r.head.appendChild(s);break;default:throw Error(K(468,i))}s[Sn]=t,dn(s),i=s}t.stateNode=i}else mk(r,t.type,t.stateNode);else t.stateNode=fk(r,i,t.memoizedProps);else s!==i?(s===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):s.count--,i===null?mk(r,t.type,t.stateNode):fk(r,i,t.memoizedProps)):i===null&&t.stateNode!==null&&Iy(t,t.memoizedProps,n.memoizedProps)}break;case 27:Yn(e,t),Jn(t),i&512&&(Ft||n===null||Tr(n,n.return)),n!==null&&i&4&&Iy(t,t.memoizedProps,n.memoizedProps);break;case 5:if(Yn(e,t),Jn(t),i&512&&(Ft||n===null||Tr(n,n.return)),t.flags&32){r=t.stateNode;try{Sc(r,"")}catch(v){Xe(t,t.return,v)}}i&4&&t.stateNode!=null&&(r=t.memoizedProps,Iy(t,r,n!==null?n.memoizedProps:r)),i&1024&&(xy=!0);break;case 6:if(Yn(e,t),Jn(t),i&4){if(t.stateNode===null)throw Error(K(162));i=t.memoizedProps,n=t.stateNode;try{n.nodeValue=i}catch(v){Xe(t,t.return,v)}}break;case 3:if(Ap=null,r=Yi,Yi=Rm(e.containerInfo),Yn(e,t),Yi=r,Jn(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Pc(e.containerInfo)}catch(v){Xe(t,t.return,v)}xy&&(xy=!1,Ax(t));break;case 4:i=Yi,Yi=Rm(t.stateNode.containerInfo),Yn(e,t),Jn(t),Yi=i;break;case 12:Yn(e,t),Jn(t);break;case 31:Yn(e,t),Jn(t),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,Wf(t,i)));break;case 13:Yn(e,t),Jn(t),t.child.flags&8192&&t.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(qg=bi()),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,Wf(t,i)));break;case 22:r=t.memoizedState!==null;var l=n!==null&&n.memoizedState!==null,c=Xr,u=Ft;if(Xr=c||r,Ft=u||l,Yn(e,t),Ft=u,Xr=c,Jn(t),i&8192)e:for(e=t.stateNode,e._visibility=r?e._visibility&-2:e._visibility|1,r&&(n===null||l||Xr||Ft||ma(t)),n=null,e=t;;){if(e.tag===5||e.tag===26){if(n===null){l=n=e;try{if(s=l.stateNode,r)o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none";else{a=l.stateNode;var d=l.memoizedProps.style,f=d!=null&&d.hasOwnProperty("display")?d.display:null;a.style.display=f==null||typeof f=="boolean"?"":(""+f).trim()}}catch(v){Xe(l,l.return,v)}}}else if(e.tag===6){if(n===null){l=e;try{l.stateNode.nodeValue=r?"":l.memoizedProps}catch(v){Xe(l,l.return,v)}}}else if(e.tag===18){if(n===null){l=e;try{var p=l.stateNode;r?lk(p,!0):lk(l.stateNode,!1)}catch(v){Xe(l,l.return,v)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===t)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;n===e&&(n=null),e=e.return}n===e&&(n=null),e.sibling.return=e.return,e=e.sibling}i&4&&(i=t.updateQueue,i!==null&&(n=i.retryQueue,n!==null&&(i.retryQueue=null,Wf(t,n))));break;case 19:Yn(e,t),Jn(t),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,Wf(t,i)));break;case 30:break;case 21:break;default:Yn(e,t),Jn(t)}}function Jn(t){var e=t.flags;if(e&2){try{for(var n,i=t.return;i!==null;){if(bx(i)){n=i;break}i=i.return}if(n==null)throw Error(K(160));switch(n.tag){case 27:var r=n.stateNode,s=Py(t);_m(t,s,r);break;case 5:var o=n.stateNode;n.flags&32&&(Sc(o,""),n.flags&=-33);var a=Py(t);_m(t,a,o);break;case 3:case 4:var l=n.stateNode.containerInfo,c=Py(t);b_(t,c,l);break;default:throw Error(K(161))}}catch(u){Xe(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ax(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var e=t;Ax(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),t=t.sibling}}function Kr(t,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)Sx(t,e.alternate,e),e=e.sibling}function ma(t){for(t=t.child;t!==null;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:Do(4,e,e.return),ma(e);break;case 1:Tr(e,e.return);var n=e.stateNode;typeof n.componentWillUnmount=="function"&&yx(e,e.return,n),ma(e);break;case 27:Od(e.stateNode);case 26:case 5:Tr(e,e.return),ma(e);break;case 22:e.memoizedState===null&&ma(e);break;case 30:ma(e);break;default:ma(e)}t=t.sibling}}function $r(t,e,n){for(n=n&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var i=e.alternate,r=t,s=e,o=s.flags;switch(s.tag){case 0:case 11:case 15:$r(r,s,n),Kh(4,s);break;case 1:if($r(r,s,n),i=s,r=i.stateNode,typeof r.componentDidMount=="function")try{r.componentDidMount()}catch(c){Xe(i,i.return,c)}if(i=s,r=i.updateQueue,r!==null){var a=i.stateNode;try{var l=r.shared.hiddenCallbacks;if(l!==null)for(r.shared.hiddenCallbacks=null,r=0;r<l.length;r++)kP(l[r],a)}catch(c){Xe(i,i.return,c)}}n&&o&64&&vx(s),Id(s,s.return);break;case 27:Tx(s);case 26:case 5:$r(r,s,n),n&&i===null&&o&4&&_x(s),Id(s,s.return);break;case 12:$r(r,s,n);break;case 31:$r(r,s,n),n&&o&4&&kx(r,s);break;case 13:$r(r,s,n),n&&o&4&&wx(r,s);break;case 22:s.memoizedState===null&&$r(r,s,n),Id(s,s.return);break;case 30:break;default:$r(r,s,n)}e=e.sibling}}function $T(t,e){var n=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),t=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(t=e.memoizedState.cachePool.pool),t!==n&&(t!=null&&t.refCount++,n!=null&&Hh(n))}function WT(t,e){t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Hh(t))}function Wi(t,e,n,i){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Ix(t,e,n,i),e=e.sibling}function Ix(t,e,n,i){var r=e.flags;switch(e.tag){case 0:case 11:case 15:Wi(t,e,n,i),r&2048&&Kh(9,e);break;case 1:Wi(t,e,n,i);break;case 3:Wi(t,e,n,i),r&2048&&(t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Hh(t)));break;case 12:if(r&2048){Wi(t,e,n,i),t=e.stateNode;try{var s=e.memoizedProps,o=s.id,a=s.onPostCommit;typeof a=="function"&&a(o,e.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(l){Xe(e,e.return,l)}}else Wi(t,e,n,i);break;case 31:Wi(t,e,n,i);break;case 13:Wi(t,e,n,i);break;case 23:break;case 22:s=e.stateNode,o=e.alternate,e.memoizedState!==null?s._visibility&2?Wi(t,e,n,i):Pd(t,e):s._visibility&2?Wi(t,e,n,i):(s._visibility|=2,Il(t,e,n,i,(e.subtreeFlags&10256)!==0||!1)),r&2048&&$T(o,e);break;case 24:Wi(t,e,n,i),r&2048&&WT(e.alternate,e);break;default:Wi(t,e,n,i)}}function Il(t,e,n,i,r){for(r=r&&((e.subtreeFlags&10256)!==0||!1),e=e.child;e!==null;){var s=t,o=e,a=n,l=i,c=o.flags;switch(o.tag){case 0:case 11:case 15:Il(s,o,a,l,r),Kh(8,o);break;case 23:break;case 22:var u=o.stateNode;o.memoizedState!==null?u._visibility&2?Il(s,o,a,l,r):Pd(s,o):(u._visibility|=2,Il(s,o,a,l,r)),r&&c&2048&&$T(o.alternate,o);break;case 24:Il(s,o,a,l,r),r&&c&2048&&WT(o.alternate,o);break;default:Il(s,o,a,l,r)}e=e.sibling}}function Pd(t,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var n=t,i=e,r=i.flags;switch(i.tag){case 22:Pd(n,i),r&2048&&$T(i.alternate,i);break;case 24:Pd(n,i),r&2048&&WT(i.alternate,i);break;default:Pd(n,i)}e=e.sibling}}var hd=8192;function Cl(t,e,n){if(t.subtreeFlags&hd)for(t=t.child;t!==null;)Px(t,e,n),t=t.sibling}function Px(t,e,n){switch(t.tag){case 26:Cl(t,e,n),t.flags&hd&&t.memoizedState!==null&&m5(n,Yi,t.memoizedState,t.memoizedProps);break;case 5:Cl(t,e,n);break;case 3:case 4:var i=Yi;Yi=Rm(t.stateNode.containerInfo),Cl(t,e,n),Yi=i;break;case 22:t.memoizedState===null&&(i=t.alternate,i!==null&&i.memoizedState!==null?(i=hd,hd=16777216,Cl(t,e,n),hd=i):Cl(t,e,n));break;default:Cl(t,e,n)}}function xx(t){var e=t.alternate;if(e!==null&&(t=e.child,t!==null)){e.child=null;do e=t.sibling,t.sibling=null,t=e;while(t!==null)}}function Hu(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var i=e[n];ln=i,Ox(i,t)}xx(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Dx(t),t=t.sibling}function Dx(t){switch(t.tag){case 0:case 11:case 15:Hu(t),t.flags&2048&&Do(9,t,t.return);break;case 3:Hu(t);break;case 12:Hu(t);break;case 22:var e=t.stateNode;t.memoizedState!==null&&e._visibility&2&&(t.return===null||t.return.tag!==13)?(e._visibility&=-3,wp(t)):Hu(t);break;default:Hu(t)}}function wp(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var i=e[n];ln=i,Ox(i,t)}xx(t)}for(t=t.child;t!==null;){switch(e=t,e.tag){case 0:case 11:case 15:Do(8,e,e.return),wp(e);break;case 22:n=e.stateNode,n._visibility&2&&(n._visibility&=-3,wp(e));break;default:wp(e)}t=t.sibling}}function Ox(t,e){for(;ln!==null;){var n=ln;switch(n.tag){case 0:case 11:case 15:Do(8,n,e);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var i=n.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:Hh(n.memoizedState.cache)}if(i=n.child,i!==null)i.return=n,ln=i;else e:for(n=t;ln!==null;){i=ln;var r=i.sibling,s=i.return;if(Ex(i),i===n){ln=null;break e}if(r!==null){r.return=s,ln=r;break e}ln=s}}}var P6={getCacheForType:function(t){var e=kn(jt),n=e.data.get(t);return n===void 0&&(n=t(),e.data.set(t,n)),n},cacheSignal:function(){return kn(jt).controller.signal}},x6=typeof WeakMap=="function"?WeakMap:Map,Ke=0,ot=null,Pe=null,Me=0,Je=0,pi=null,io=!1,Xc=!1,QT=!1,ys=0,Ct=0,Oo=0,Ia=0,YT=0,yi=0,wc=0,xd=null,Zn=null,T_=!1,qg=0,Nx=0,bm=1/0,Tm=null,mo=null,Kt=0,go=null,Rc=null,cs=0,S_=0,E_=null,Mx=null,Dd=0,C_=null;function Ei(){return Ke&2&&Me!==0?Me&-Me:ge.T!==null?XT():HI()}function Lx(){if(yi===0)if(!(Me&536870912)||Ue){var t=jf;jf<<=1,!(jf&3932160)&&(jf=262144),yi=t}else yi=536870912;return t=wi.current,t!==null&&(t.flags|=32),yi}function si(t,e,n){(t===ot&&(Je===2||Je===9)||t.cancelPendingCommit!==null)&&(Ac(t,0),ro(t,Me,yi,!1)),Bh(t,n),(!(Ke&2)||t!==ot)&&(t===ot&&(!(Ke&2)&&(Ia|=n),Ct===4&&ro(t,Me,yi,!1)),Mr(t))}function Ux(t,e,n){if(Ke&6)throw Error(K(327));var i=!n&&(e&127)===0&&(e&t.expiredLanes)===0||jh(t,e),r=i?N6(t,e):Dy(t,e,!0),s=i;do{if(r===0){Xc&&!i&&ro(t,e,0,!1);break}else{if(n=t.current.alternate,s&&!D6(n)){r=Dy(t,e,!1),s=!1;continue}if(r===2){if(s=e,t.errorRecoveryDisabledLanes&s)var o=0;else o=t.pendingLanes&-536870913,o=o!==0?o:o&536870912?536870912:0;if(o!==0){e=o;e:{var a=t;r=xd;var l=a.current.memoizedState.isDehydrated;if(l&&(Ac(a,o).flags|=256),o=Dy(a,o,!1),o!==2){if(QT&&!l){a.errorRecoveryDisabledLanes|=s,Ia|=s,r=4;break e}s=Zn,Zn=r,s!==null&&(Zn===null?Zn=s:Zn.push.apply(Zn,s))}r=o}if(s=!1,r!==2)continue}}if(r===1){Ac(t,0),ro(t,e,0,!0);break}e:{switch(i=t,s=r,s){case 0:case 1:throw Error(K(345));case 4:if((e&4194048)!==e)break;case 6:ro(i,e,yi,!io);break e;case 2:Zn=null;break;case 3:case 5:break;default:throw Error(K(329))}if((e&62914560)===e&&(r=qg+300-bi(),10<r)){if(ro(i,e,yi,!io),xg(i,0,!0)!==0)break e;cs=e,i.timeoutHandle=iD(Q1.bind(null,i,n,Zn,Tm,T_,e,yi,Ia,wc,io,s,"Throttled",-0,0),r);break e}Q1(i,n,Zn,Tm,T_,e,yi,Ia,wc,io,s,null,-0,0)}}break}while(!0);Mr(t)}function Q1(t,e,n,i,r,s,o,a,l,c,u,d,f,p){if(t.timeoutHandle=-1,d=e.subtreeFlags,d&8192||(d&16785408)===16785408){d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:rs},Px(e,s,d);var v=(s&62914560)===s?qg-bi():(s&4194048)===s?Nx-bi():0;if(v=g5(d,v),v!==null){cs=s,t.cancelPendingCommit=v(J1.bind(null,t,e,s,n,i,r,o,a,l,u,d,null,f,p)),ro(t,s,o,!c);return}}J1(t,e,s,n,i,r,o,a,l)}function D6(t){for(var e=t;;){var n=e.tag;if((n===0||n===11||n===15)&&e.flags&16384&&(n=e.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var i=0;i<n.length;i++){var r=n[i],s=r.getSnapshot;r=r.value;try{if(!ki(s(),r))return!1}catch{return!1}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ro(t,e,n,i){e&=~YT,e&=~Ia,t.suspendedLanes|=e,t.pingedLanes&=~e,i&&(t.warmLanes|=e),i=t.expirationTimes;for(var r=e;0<r;){var s=31-Si(r),o=1<<s;i[s]=-1,r&=~o}n!==0&&BI(t,n,e)}function zg(){return Ke&6?!0:($h(0),!1)}function JT(){if(Pe!==null){if(Je===0)var t=Pe.return;else t=Pe,ss=sl=null,LT(t),tc=null,eh=0,t=Pe;for(;t!==null;)gx(t.alternate,t),t=t.return;Pe=null}}function Ac(t,e){var n=t.timeoutHandle;n!==-1&&(t.timeoutHandle=-1,X6(n)),n=t.cancelPendingCommit,n!==null&&(t.cancelPendingCommit=null,n()),cs=0,JT(),ot=t,Pe=n=as(t.current,null),Me=e,Je=0,pi=null,io=!1,Xc=jh(t,e),QT=!1,wc=yi=YT=Ia=Oo=Ct=0,Zn=xd=null,T_=!1,e&8&&(e|=e&32);var i=t.entangledLanes;if(i!==0)for(t=t.entanglements,i&=e;0<i;){var r=31-Si(i),s=1<<r;e|=t[r],i&=~s}return ys=e,Mg(),n}function Vx(t,e){Se=null,ge.H=nh,e===Jc||e===Ug?(e=R1(),Je=3):e===IT?(e=R1(),Je=4):Je=e===GT?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,pi=e,Pe===null&&(Ct=1,vm(t,Ui(e,t.current)))}function Fx(){var t=wi.current;return t===null?!0:(Me&4194048)===Me?qi===null:(Me&62914560)===Me||Me&536870912?t===qi:!1}function jx(){var t=ge.H;return ge.H=nh,t===null?nh:t}function Bx(){var t=ge.A;return ge.A=P6,t}function Sm(){Ct=4,io||(Me&4194048)!==Me&&wi.current!==null||(Xc=!0),!(Oo&134217727)&&!(Ia&134217727)||ot===null||ro(ot,Me,yi,!1)}function Dy(t,e,n){var i=Ke;Ke|=2;var r=jx(),s=Bx();(ot!==t||Me!==e)&&(Tm=null,Ac(t,e)),e=!1;var o=Ct;e:do try{if(Je!==0&&Pe!==null){var a=Pe,l=pi;switch(Je){case 8:JT(),o=6;break e;case 3:case 2:case 9:case 6:wi.current===null&&(e=!0);var c=Je;if(Je=0,pi=null,Kl(t,a,l,c),n&&Xc){o=0;break e}break;default:c=Je,Je=0,pi=null,Kl(t,a,l,c)}}O6(),o=Ct;break}catch(u){Vx(t,u)}while(!0);return e&&t.shellSuspendCounter++,ss=sl=null,Ke=i,ge.H=r,ge.A=s,Pe===null&&(ot=null,Me=0,Mg()),o}function O6(){for(;Pe!==null;)qx(Pe)}function N6(t,e){var n=Ke;Ke|=2;var i=jx(),r=Bx();ot!==t||Me!==e?(Tm=null,bm=bi()+500,Ac(t,e)):Xc=jh(t,e);e:do try{if(Je!==0&&Pe!==null){e=Pe;var s=pi;t:switch(Je){case 1:Je=0,pi=null,Kl(t,e,s,1);break;case 2:case 9:if(w1(s)){Je=0,pi=null,Y1(e);break}e=function(){Je!==2&&Je!==9||ot!==t||(Je=7),Mr(t)},s.then(e,e);break e;case 3:Je=7;break e;case 4:Je=5;break e;case 7:w1(s)?(Je=0,pi=null,Y1(e)):(Je=0,pi=null,Kl(t,e,s,7));break;case 5:var o=null;switch(Pe.tag){case 26:o=Pe.memoizedState;case 5:case 27:var a=Pe;if(o?lD(o):a.stateNode.complete){Je=0,pi=null;var l=a.sibling;if(l!==null)Pe=l;else{var c=a.return;c!==null?(Pe=c,Hg(c)):Pe=null}break t}}Je=0,pi=null,Kl(t,e,s,5);break;case 6:Je=0,pi=null,Kl(t,e,s,6);break;case 8:JT(),Ct=6;break e;default:throw Error(K(462))}}M6();break}catch(u){Vx(t,u)}while(!0);return ss=sl=null,ge.H=i,ge.A=r,Ke=n,Pe!==null?0:(ot=null,Me=0,Mg(),Ct)}function M6(){for(;Pe!==null&&!rU();)qx(Pe)}function qx(t){var e=mx(t.alternate,t,ys);t.memoizedProps=t.pendingProps,e===null?Hg(t):Pe=e}function Y1(t){var e=t,n=e.alternate;switch(e.tag){case 15:case 0:e=z1(n,e,e.pendingProps,e.type,void 0,Me);break;case 11:e=z1(n,e,e.pendingProps,e.type.render,e.ref,Me);break;case 5:LT(e);default:gx(n,e),e=Pe=gP(e,ys),e=mx(n,e,ys)}t.memoizedProps=t.pendingProps,e===null?Hg(t):Pe=e}function Kl(t,e,n,i){ss=sl=null,LT(e),tc=null,eh=0;var r=e.return;try{if(E6(t,r,e,n,Me)){Ct=1,vm(t,Ui(n,t.current)),Pe=null;return}}catch(s){if(r!==null)throw Pe=r,s;Ct=1,vm(t,Ui(n,t.current)),Pe=null;return}e.flags&32768?(Ue||i===1?t=!0:Xc||Me&536870912?t=!1:(io=t=!0,(i===2||i===9||i===3||i===6)&&(i=wi.current,i!==null&&i.tag===13&&(i.flags|=16384))),zx(e,t)):Hg(e)}function Hg(t){var e=t;do{if(e.flags&32768){zx(e,io);return}t=e.return;var n=w6(e.alternate,e,ys);if(n!==null){Pe=n;return}if(e=e.sibling,e!==null){Pe=e;return}Pe=e=t}while(e!==null);Ct===0&&(Ct=5)}function zx(t,e){do{var n=R6(t.alternate,t);if(n!==null){n.flags&=32767,Pe=n;return}if(n=t.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!e&&(t=t.sibling,t!==null)){Pe=t;return}Pe=t=n}while(t!==null);Ct=6,Pe=null}function J1(t,e,n,i,r,s,o,a,l){t.cancelPendingCommit=null;do Gg();while(Kt!==0);if(Ke&6)throw Error(K(327));if(e!==null){if(e===t.current)throw Error(K(177));if(s=e.lanes|e.childLanes,s|=ST,pU(t,n,s,o,a,l),t===ot&&(Pe=ot=null,Me=0),Rc=e,go=t,cs=n,S_=s,E_=r,Mx=i,e.subtreeFlags&10256||e.flags&10256?(t.callbackNode=null,t.callbackPriority=0,F6(om,function(){return Wx(),null})):(t.callbackNode=null,t.callbackPriority=0),i=(e.flags&13878)!==0,e.subtreeFlags&13878||i){i=ge.T,ge.T=null,r=$e.p,$e.p=2,o=Ke,Ke|=4;try{A6(t,e,n)}finally{Ke=o,$e.p=r,ge.T=i}}Kt=1,Hx(),Gx(),Kx()}}function Hx(){if(Kt===1){Kt=0;var t=go,e=Rc,n=(e.flags&13878)!==0;if(e.subtreeFlags&13878||n){n=ge.T,ge.T=null;var i=$e.p;$e.p=2;var r=Ke;Ke|=4;try{Rx(e,t);var s=A_,o=lP(t.containerInfo),a=s.focusedElem,l=s.selectionRange;if(o!==a&&a&&a.ownerDocument&&aP(a.ownerDocument.documentElement,a)){if(l!==null&&TT(a)){var c=l.start,u=l.end;if(u===void 0&&(u=c),"selectionStart"in a)a.selectionStart=c,a.selectionEnd=Math.min(u,a.value.length);else{var d=a.ownerDocument||document,f=d&&d.defaultView||window;if(f.getSelection){var p=f.getSelection(),v=a.textContent.length,g=Math.min(l.start,v),E=l.end===void 0?g:Math.min(l.end,v);!p.extend&&g>E&&(o=E,E=g,g=o);var y=_1(a,g),T=_1(a,E);if(y&&T&&(p.rangeCount!==1||p.anchorNode!==y.node||p.anchorOffset!==y.offset||p.focusNode!==T.node||p.focusOffset!==T.offset)){var R=d.createRange();R.setStart(y.node,y.offset),p.removeAllRanges(),g>E?(p.addRange(R),p.extend(T.node,T.offset)):(R.setEnd(T.node,T.offset),p.addRange(R))}}}}for(d=[],p=a;p=p.parentNode;)p.nodeType===1&&d.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<d.length;a++){var b=d[a];b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}Pm=!!R_,A_=R_=null}finally{Ke=r,$e.p=i,ge.T=n}}t.current=e,Kt=2}}function Gx(){if(Kt===2){Kt=0;var t=go,e=Rc,n=(e.flags&8772)!==0;if(e.subtreeFlags&8772||n){n=ge.T,ge.T=null;var i=$e.p;$e.p=2;var r=Ke;Ke|=4;try{Sx(t,e.alternate,e)}finally{Ke=r,$e.p=i,ge.T=n}}Kt=3}}function Kx(){if(Kt===4||Kt===3){Kt=0,sU();var t=go,e=Rc,n=cs,i=Mx;e.subtreeFlags&10256||e.flags&10256?Kt=5:(Kt=0,Rc=go=null,$x(t,t.pendingLanes));var r=t.pendingLanes;if(r===0&&(mo=null),pT(n),e=e.stateNode,Ti&&typeof Ti.onCommitFiberRoot=="function")try{Ti.onCommitFiberRoot(Fh,e,void 0,(e.current.flags&128)===128)}catch{}if(i!==null){e=ge.T,r=$e.p,$e.p=2,ge.T=null;try{for(var s=t.onRecoverableError,o=0;o<i.length;o++){var a=i[o];s(a.value,{componentStack:a.stack})}}finally{ge.T=e,$e.p=r}}cs&3&&Gg(),Mr(t),r=t.pendingLanes,n&261930&&r&42?t===C_?Dd++:(Dd=0,C_=t):Dd=0,$h(0)}}function $x(t,e){(t.pooledCacheLanes&=e)===0&&(e=t.pooledCache,e!=null&&(t.pooledCache=null,Hh(e)))}function Gg(){return Hx(),Gx(),Kx(),Wx()}function Wx(){if(Kt!==5)return!1;var t=go,e=S_;S_=0;var n=pT(cs),i=ge.T,r=$e.p;try{$e.p=32>n?32:n,ge.T=null,n=E_,E_=null;var s=go,o=cs;if(Kt=0,Rc=go=null,cs=0,Ke&6)throw Error(K(331));var a=Ke;if(Ke|=4,Dx(s.current),Ix(s,s.current,o,n),Ke=a,$h(0,!1),Ti&&typeof Ti.onPostCommitFiberRoot=="function")try{Ti.onPostCommitFiberRoot(Fh,s)}catch{}return!0}finally{$e.p=r,ge.T=i,$x(t,e)}}function X1(t,e,n){e=Ui(n,e),e=v_(t.stateNode,e,2),t=po(t,e,2),t!==null&&(Bh(t,2),Mr(t))}function Xe(t,e,n){if(t.tag===3)X1(t,t,n);else for(;e!==null;){if(e.tag===3){X1(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(mo===null||!mo.has(i))){t=Ui(n,t),n=cx(2),i=po(e,n,2),i!==null&&(ux(n,i,e,t),Bh(i,2),Mr(i));break}}e=e.return}}function Oy(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new x6;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(n)||(QT=!0,r.add(n),t=L6.bind(null,t,e,n),e.then(t,t))}function L6(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),t.pingedLanes|=t.suspendedLanes&n,t.warmLanes&=~n,ot===t&&(Me&n)===n&&(Ct===4||Ct===3&&(Me&62914560)===Me&&300>bi()-qg?!(Ke&2)&&Ac(t,0):YT|=n,wc===Me&&(wc=0)),Mr(t)}function Qx(t,e){e===0&&(e=jI()),t=rl(t,e),t!==null&&(Bh(t,e),Mr(t))}function U6(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Qx(t,n)}function V6(t,e){var n=0;switch(t.tag){case 31:case 13:var i=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:i=t.stateNode;break;case 22:i=t.stateNode._retryCache;break;default:throw Error(K(314))}i!==null&&i.delete(e),Qx(t,n)}function F6(t,e){return hT(t,e)}var Em=null,Pl=null,k_=!1,Cm=!1,Ny=!1,so=0;function Mr(t){t!==Pl&&t.next===null&&(Pl===null?Em=Pl=t:Pl=Pl.next=t),Cm=!0,k_||(k_=!0,B6())}function $h(t,e){if(!Ny&&Cm){Ny=!0;do for(var n=!1,i=Em;i!==null;){if(t!==0){var r=i.pendingLanes;if(r===0)var s=0;else{var o=i.suspendedLanes,a=i.pingedLanes;s=(1<<31-Si(42|t)+1)-1,s&=r&~(o&~a),s=s&201326741?s&201326741|1:s?s|2:0}s!==0&&(n=!0,Z1(i,s))}else s=Me,s=xg(i,i===ot?s:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),!(s&3)||jh(i,s)||(n=!0,Z1(i,s));i=i.next}while(n);Ny=!1}}function j6(){Yx()}function Yx(){Cm=k_=!1;var t=0;so!==0&&J6()&&(t=so);for(var e=bi(),n=null,i=Em;i!==null;){var r=i.next,s=Jx(i,e);s===0?(i.next=null,n===null?Em=r:n.next=r,r===null&&(Pl=n)):(n=i,(t!==0||s&3)&&(Cm=!0)),i=r}Kt!==0&&Kt!==5||$h(t),so!==0&&(so=0)}function Jx(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,r=t.expirationTimes,s=t.pendingLanes&-62914561;0<s;){var o=31-Si(s),a=1<<o,l=r[o];l===-1?(!(a&n)||a&i)&&(r[o]=fU(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}if(e=ot,n=Me,n=xg(t,t===e?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),i=t.callbackNode,n===0||t===e&&(Je===2||Je===9)||t.cancelPendingCommit!==null)return i!==null&&i!==null&&ly(i),t.callbackNode=null,t.callbackPriority=0;if(!(n&3)||jh(t,n)){if(e=n&-n,e===t.callbackPriority)return e;switch(i!==null&&ly(i),pT(n)){case 2:case 8:n=VI;break;case 32:n=om;break;case 268435456:n=FI;break;default:n=om}return i=Xx.bind(null,t),n=hT(n,i),t.callbackPriority=e,t.callbackNode=n,e}return i!==null&&i!==null&&ly(i),t.callbackPriority=2,t.callbackNode=null,2}function Xx(t,e){if(Kt!==0&&Kt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var n=t.callbackNode;if(Gg()&&t.callbackNode!==n)return null;var i=Me;return i=xg(t,t===ot?i:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),i===0?null:(Ux(t,i,e),Jx(t,bi()),t.callbackNode!=null&&t.callbackNode===n?Xx.bind(null,t):null)}function Z1(t,e){if(Gg())return null;Ux(t,e,!0)}function B6(){Z6(function(){Ke&6?hT(UI,j6):Yx()})}function XT(){if(so===0){var t=Ec;t===0&&(t=Ff,Ff<<=1,!(Ff&261888)&&(Ff=256)),so=t}return so}function ek(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:vp(""+t)}function tk(t,e){var n=e.ownerDocument.createElement("input");return n.name=e.name,n.value=e.value,t.id&&n.setAttribute("form",t.id),e.parentNode.insertBefore(n,e),t=new FormData(t),n.parentNode.removeChild(n),t}function q6(t,e,n,i,r){if(e==="submit"&&n&&n.stateNode===r){var s=ek((r[ai]||null).action),o=i.submitter;o&&(e=(e=o[ai]||null)?ek(e.formAction):o.getAttribute("formAction"),e!==null&&(s=e,o=null));var a=new Dg("action","action",null,i,r);t.push({event:a,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(so!==0){var l=o?tk(r,o):new FormData(r);m_(n,{pending:!0,data:l,method:r.method,action:s},null,l)}}else typeof s=="function"&&(a.preventDefault(),l=o?tk(r,o):new FormData(r),m_(n,{pending:!0,data:l,method:r.method,action:s},s,l))},currentTarget:r}]})}}for(var My=0;My<i_.length;My++){var Ly=i_[My],z6=Ly.toLowerCase(),H6=Ly[0].toUpperCase()+Ly.slice(1);hr(z6,"on"+H6)}hr(uP,"onAnimationEnd");hr(dP,"onAnimationIteration");hr(hP,"onAnimationStart");hr("dblclick","onDoubleClick");hr("focusin","onFocus");hr("focusout","onBlur");hr(o6,"onTransitionRun");hr(a6,"onTransitionStart");hr(l6,"onTransitionCancel");hr(fP,"onTransitionEnd");Tc("onMouseEnter",["mouseout","mouseover"]);Tc("onMouseLeave",["mouseout","mouseover"]);Tc("onPointerEnter",["pointerout","pointerover"]);Tc("onPointerLeave",["pointerout","pointerover"]);tl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));tl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));tl("onBeforeInput",["compositionend","keypress","textInput","paste"]);tl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));tl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));tl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ih="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),G6=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ih));function Zx(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;s=a,r.currentTarget=c;try{s(r)}catch(u){lm(u)}r.currentTarget=null,s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;s=a,r.currentTarget=c;try{s(r)}catch(u){lm(u)}r.currentTarget=null,s=l}}}}function Ie(t,e){var n=e[Q0];n===void 0&&(n=e[Q0]=new Set);var i=t+"__bubble";n.has(i)||(eD(e,t,2,!1),n.add(i))}function Uy(t,e,n){var i=0;e&&(i|=4),eD(n,t,i,e)}var Qf="_reactListening"+Math.random().toString(36).slice(2);function ZT(t){if(!t[Qf]){t[Qf]=!0,GI.forEach(function(n){n!=="selectionchange"&&(G6.has(n)||Uy(n,!1,t),Uy(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Qf]||(e[Qf]=!0,Uy("selectionchange",!1,e))}}function eD(t,e,n,i){switch(fD(e)){case 2:var r=_5;break;case 8:r=b5;break;default:r=iS}n=r.bind(null,e,n,t),r=void 0,!e_||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function Vy(t,e,n,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&o.stateNode.containerInfo===r)return;o=o.return}for(;a!==null;){if(o=Ul(a),o===null)return;if(l=o.tag,l===5||l===6||l===26||l===27){i=s=o;continue e}a=a.parentNode}}i=i.return}ZI(function(){var c=s,u=vT(n),d=[];e:{var f=pP.get(t);if(f!==void 0){var p=Dg,v=t;switch(t){case"keypress":if(_p(n)===0)break e;case"keydown":case"keyup":p=VU;break;case"focusin":v="focus",p=fy;break;case"focusout":v="blur",p=fy;break;case"beforeblur":case"afterblur":p=fy;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=c1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=wU;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=BU;break;case uP:case dP:case hP:p=IU;break;case fP:p=zU;break;case"scroll":case"scrollend":p=CU;break;case"wheel":p=GU;break;case"copy":case"cut":case"paste":p=xU;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=d1;break;case"toggle":case"beforetoggle":p=$U}var g=(e&4)!==0,E=!g&&(t==="scroll"||t==="scrollend"),y=g?f!==null?f+"Capture":null:f;g=[];for(var T=c,R;T!==null;){var b=T;if(R=b.stateNode,b=b.tag,b!==5&&b!==26&&b!==27||R===null||y===null||(b=Qd(T,y),b!=null&&g.push(rh(T,b,R))),E)break;T=T.return}0<g.length&&(f=new p(f,v,null,n,u),d.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",f&&n!==Z0&&(v=n.relatedTarget||n.fromElement)&&(Ul(v)||v[Wc]))break e;if((p||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,p?(v=n.relatedTarget||n.toElement,p=c,v=v?Ul(v):null,v!==null&&(E=Vh(v),g=v.tag,v!==E||g!==5&&g!==27&&g!==6)&&(v=null)):(p=null,v=c),p!==v)){if(g=c1,b="onMouseLeave",y="onMouseEnter",T="mouse",(t==="pointerout"||t==="pointerover")&&(g=d1,b="onPointerLeave",y="onPointerEnter",T="pointer"),E=p==null?f:ud(p),R=v==null?f:ud(v),f=new g(b,T+"leave",p,n,u),f.target=E,f.relatedTarget=R,b=null,Ul(u)===c&&(g=new g(y,T+"enter",v,n,u),g.target=R,g.relatedTarget=E,b=g),E=b,p&&v)t:{for(g=K6,y=p,T=v,R=0,b=y;b;b=g(b))R++;b=0;for(var w=T;w;w=g(w))b++;for(;0<R-b;)y=g(y),R--;for(;0<b-R;)T=g(T),b--;for(;R--;){if(y===T||T!==null&&y===T.alternate){g=y;break t}y=g(y),T=g(T)}g=null}else g=null;p!==null&&nk(d,f,p,g,!1),v!==null&&E!==null&&nk(d,E,v,g,!0)}}e:{if(f=c?ud(c):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var D=m1;else if(p1(f))if(sP)D=i6;else{D=t6;var C=e6}else p=f.nodeName,!p||p.toLowerCase()!=="input"||f.type!=="checkbox"&&f.type!=="radio"?c&&gT(c.elementType)&&(D=m1):D=n6;if(D&&(D=D(t,c))){rP(d,D,n,u);break e}C&&C(t,f,c),t==="focusout"&&c&&f.type==="number"&&c.memoizedProps.value!=null&&X0(f,"number",f.value)}switch(C=c?ud(c):window,t){case"focusin":(p1(C)||C.contentEditable==="true")&&(jl=C,t_=c,Ed=null);break;case"focusout":Ed=t_=jl=null;break;case"mousedown":n_=!0;break;case"contextmenu":case"mouseup":case"dragend":n_=!1,b1(d,n,u);break;case"selectionchange":if(s6)break;case"keydown":case"keyup":b1(d,n,u)}var k;if(bT)e:{switch(t){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else Fl?nP(t,n)&&(S="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(S="onCompositionStart");S&&(tP&&n.locale!=="ko"&&(Fl||S!=="onCompositionStart"?S==="onCompositionEnd"&&Fl&&(k=eP()):(no=u,yT="value"in no?no.value:no.textContent,Fl=!0)),C=km(c,S),0<C.length&&(S=new u1(S,t,null,n,u),d.push({event:S,listeners:C}),k?S.data=k:(k=iP(n),k!==null&&(S.data=k)))),(k=QU?YU(t,n):JU(t,n))&&(S=km(c,"onBeforeInput"),0<S.length&&(C=new u1("onBeforeInput","beforeinput",null,n,u),d.push({event:C,listeners:S}),C.data=k)),q6(d,t,c,n,u)}Zx(d,e)})}function rh(t,e,n){return{instance:t,listener:e,currentTarget:n}}function km(t,e){for(var n=e+"Capture",i=[];t!==null;){var r=t,s=r.stateNode;if(r=r.tag,r!==5&&r!==26&&r!==27||s===null||(r=Qd(t,n),r!=null&&i.unshift(rh(t,r,s)),r=Qd(t,e),r!=null&&i.push(rh(t,r,s))),t.tag===3)return i;t=t.return}return[]}function K6(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function nk(t,e,n,i,r){for(var s=e._reactName,o=[];n!==null&&n!==i;){var a=n,l=a.alternate,c=a.stateNode;if(a=a.tag,l!==null&&l===i)break;a!==5&&a!==26&&a!==27||c===null||(l=c,r?(c=Qd(n,s),c!=null&&o.unshift(rh(n,c,l))):r||(c=Qd(n,s),c!=null&&o.push(rh(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var $6=/\r\n?/g,W6=/\u0000|\uFFFD/g;function ik(t){return(typeof t=="string"?t:""+t).replace($6,`
`).replace(W6,"")}function tD(t,e){return e=ik(e),ik(t)===e}function et(t,e,n,i,r,s){switch(n){case"children":typeof i=="string"?e==="body"||e==="textarea"&&i===""||Sc(t,i):(typeof i=="number"||typeof i=="bigint")&&e!=="body"&&Sc(t,""+i);break;case"className":qf(t,"class",i);break;case"tabIndex":qf(t,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":qf(t,n,i);break;case"style":XI(t,i,s);break;case"data":if(e!=="object"){qf(t,"data",i);break}case"src":case"href":if(i===""&&(e!=="a"||n!=="href")){t.removeAttribute(n);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){t.removeAttribute(n);break}i=vp(""+i),t.setAttribute(n,i);break;case"action":case"formAction":if(typeof i=="function"){t.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof s=="function"&&(n==="formAction"?(e!=="input"&&et(t,e,"name",r.name,r,null),et(t,e,"formEncType",r.formEncType,r,null),et(t,e,"formMethod",r.formMethod,r,null),et(t,e,"formTarget",r.formTarget,r,null)):(et(t,e,"encType",r.encType,r,null),et(t,e,"method",r.method,r,null),et(t,e,"target",r.target,r,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){t.removeAttribute(n);break}i=vp(""+i),t.setAttribute(n,i);break;case"onClick":i!=null&&(t.onclick=rs);break;case"onScroll":i!=null&&Ie("scroll",t);break;case"onScrollEnd":i!=null&&Ie("scrollend",t);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(K(61));if(n=i.__html,n!=null){if(r.children!=null)throw Error(K(60));t.innerHTML=n}}break;case"multiple":t.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":t.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){t.removeAttribute("xlink:href");break}n=vp(""+i),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,""+i):t.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,""):t.removeAttribute(n);break;case"capture":case"download":i===!0?t.setAttribute(n,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,i):t.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?t.setAttribute(n,i):t.removeAttribute(n);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?t.removeAttribute(n):t.setAttribute(n,i);break;case"popover":Ie("beforetoggle",t),Ie("toggle",t),gp(t,"popover",i);break;case"xlinkActuate":zr(t,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":zr(t,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":zr(t,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":zr(t,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":zr(t,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":zr(t,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":zr(t,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":zr(t,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":zr(t,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":gp(t,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(n=SU.get(n)||n,gp(t,n,i))}}function w_(t,e,n,i,r,s){switch(n){case"style":XI(t,i,s);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(K(61));if(n=i.__html,n!=null){if(r.children!=null)throw Error(K(60));t.innerHTML=n}}break;case"children":typeof i=="string"?Sc(t,i):(typeof i=="number"||typeof i=="bigint")&&Sc(t,""+i);break;case"onScroll":i!=null&&Ie("scroll",t);break;case"onScrollEnd":i!=null&&Ie("scrollend",t);break;case"onClick":i!=null&&(t.onclick=rs);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!KI.hasOwnProperty(n))e:{if(n[0]==="o"&&n[1]==="n"&&(r=n.endsWith("Capture"),e=n.slice(2,r?n.length-7:void 0),s=t[ai]||null,s=s!=null?s[n]:null,typeof s=="function"&&t.removeEventListener(e,s,r),typeof i=="function")){typeof s!="function"&&s!==null&&(n in t?t[n]=null:t.hasAttribute(n)&&t.removeAttribute(n)),t.addEventListener(e,i,r);break e}n in t?t[n]=i:i===!0?t.setAttribute(n,""):gp(t,n,i)}}}function An(t,e,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ie("error",t),Ie("load",t);var i=!1,r=!1,s;for(s in n)if(n.hasOwnProperty(s)){var o=n[s];if(o!=null)switch(s){case"src":i=!0;break;case"srcSet":r=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(K(137,e));default:et(t,e,s,o,n,null)}}r&&et(t,e,"srcSet",n.srcSet,n,null),i&&et(t,e,"src",n.src,n,null);return;case"input":Ie("invalid",t);var a=s=o=r=null,l=null,c=null;for(i in n)if(n.hasOwnProperty(i)){var u=n[i];if(u!=null)switch(i){case"name":r=u;break;case"type":o=u;break;case"checked":l=u;break;case"defaultChecked":c=u;break;case"value":s=u;break;case"defaultValue":a=u;break;case"children":case"dangerouslySetInnerHTML":if(u!=null)throw Error(K(137,e));break;default:et(t,e,i,u,n,null)}}QI(t,s,a,l,c,o,r,!1);return;case"select":Ie("invalid",t),i=o=s=null;for(r in n)if(n.hasOwnProperty(r)&&(a=n[r],a!=null))switch(r){case"value":s=a;break;case"defaultValue":o=a;break;case"multiple":i=a;default:et(t,e,r,a,n,null)}e=s,n=o,t.multiple=!!i,e!=null?Xl(t,!!i,e,!1):n!=null&&Xl(t,!!i,n,!0);return;case"textarea":Ie("invalid",t),s=r=i=null;for(o in n)if(n.hasOwnProperty(o)&&(a=n[o],a!=null))switch(o){case"value":i=a;break;case"defaultValue":r=a;break;case"children":s=a;break;case"dangerouslySetInnerHTML":if(a!=null)throw Error(K(91));break;default:et(t,e,o,a,n,null)}JI(t,i,r,s);return;case"option":for(l in n)if(n.hasOwnProperty(l)&&(i=n[l],i!=null))switch(l){case"selected":t.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:et(t,e,l,i,n,null)}return;case"dialog":Ie("beforetoggle",t),Ie("toggle",t),Ie("cancel",t),Ie("close",t);break;case"iframe":case"object":Ie("load",t);break;case"video":case"audio":for(i=0;i<ih.length;i++)Ie(ih[i],t);break;case"image":Ie("error",t),Ie("load",t);break;case"details":Ie("toggle",t);break;case"embed":case"source":case"link":Ie("error",t),Ie("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in n)if(n.hasOwnProperty(c)&&(i=n[c],i!=null))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(K(137,e));default:et(t,e,c,i,n,null)}return;default:if(gT(e)){for(u in n)n.hasOwnProperty(u)&&(i=n[u],i!==void 0&&w_(t,e,u,i,n,void 0));return}}for(a in n)n.hasOwnProperty(a)&&(i=n[a],i!=null&&et(t,e,a,i,n,null))}function Q6(t,e,n,i){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var r=null,s=null,o=null,a=null,l=null,c=null,u=null;for(p in n){var d=n[p];if(n.hasOwnProperty(p)&&d!=null)switch(p){case"checked":break;case"value":break;case"defaultValue":l=d;default:i.hasOwnProperty(p)||et(t,e,p,null,i,d)}}for(var f in i){var p=i[f];if(d=n[f],i.hasOwnProperty(f)&&(p!=null||d!=null))switch(f){case"type":s=p;break;case"name":r=p;break;case"checked":c=p;break;case"defaultChecked":u=p;break;case"value":o=p;break;case"defaultValue":a=p;break;case"children":case"dangerouslySetInnerHTML":if(p!=null)throw Error(K(137,e));break;default:p!==d&&et(t,e,f,p,i,d)}}J0(t,o,a,l,c,u,s,r);return;case"select":p=o=a=f=null;for(s in n)if(l=n[s],n.hasOwnProperty(s)&&l!=null)switch(s){case"value":break;case"multiple":p=l;default:i.hasOwnProperty(s)||et(t,e,s,null,i,l)}for(r in i)if(s=i[r],l=n[r],i.hasOwnProperty(r)&&(s!=null||l!=null))switch(r){case"value":f=s;break;case"defaultValue":a=s;break;case"multiple":o=s;default:s!==l&&et(t,e,r,s,i,l)}e=a,n=o,i=p,f!=null?Xl(t,!!n,f,!1):!!i!=!!n&&(e!=null?Xl(t,!!n,e,!0):Xl(t,!!n,n?[]:"",!1));return;case"textarea":p=f=null;for(a in n)if(r=n[a],n.hasOwnProperty(a)&&r!=null&&!i.hasOwnProperty(a))switch(a){case"value":break;case"children":break;default:et(t,e,a,null,i,r)}for(o in i)if(r=i[o],s=n[o],i.hasOwnProperty(o)&&(r!=null||s!=null))switch(o){case"value":f=r;break;case"defaultValue":p=r;break;case"children":break;case"dangerouslySetInnerHTML":if(r!=null)throw Error(K(91));break;default:r!==s&&et(t,e,o,r,i,s)}YI(t,f,p);return;case"option":for(var v in n)if(f=n[v],n.hasOwnProperty(v)&&f!=null&&!i.hasOwnProperty(v))switch(v){case"selected":t.selected=!1;break;default:et(t,e,v,null,i,f)}for(l in i)if(f=i[l],p=n[l],i.hasOwnProperty(l)&&f!==p&&(f!=null||p!=null))switch(l){case"selected":t.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:et(t,e,l,f,i,p)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)f=n[g],n.hasOwnProperty(g)&&f!=null&&!i.hasOwnProperty(g)&&et(t,e,g,null,i,f);for(c in i)if(f=i[c],p=n[c],i.hasOwnProperty(c)&&f!==p&&(f!=null||p!=null))switch(c){case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(K(137,e));break;default:et(t,e,c,f,i,p)}return;default:if(gT(e)){for(var E in n)f=n[E],n.hasOwnProperty(E)&&f!==void 0&&!i.hasOwnProperty(E)&&w_(t,e,E,void 0,i,f);for(u in i)f=i[u],p=n[u],!i.hasOwnProperty(u)||f===p||f===void 0&&p===void 0||w_(t,e,u,f,i,p);return}}for(var y in n)f=n[y],n.hasOwnProperty(y)&&f!=null&&!i.hasOwnProperty(y)&&et(t,e,y,null,i,f);for(d in i)f=i[d],p=n[d],!i.hasOwnProperty(d)||f===p||f==null&&p==null||et(t,e,d,f,i,p)}function rk(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Y6(){if(typeof performance.getEntriesByType=="function"){for(var t=0,e=0,n=performance.getEntriesByType("resource"),i=0;i<n.length;i++){var r=n[i],s=r.transferSize,o=r.initiatorType,a=r.duration;if(s&&a&&rk(o)){for(o=0,a=r.responseEnd,i+=1;i<n.length;i++){var l=n[i],c=l.startTime;if(c>a)break;var u=l.transferSize,d=l.initiatorType;u&&rk(d)&&(l=l.responseEnd,o+=u*(l<a?1:(a-c)/(l-c)))}if(--i,e+=8*(s+o)/(r.duration/1e3),t++,10<t)break}}if(0<t)return e/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var R_=null,A_=null;function wm(t){return t.nodeType===9?t:t.ownerDocument}function sk(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function nD(t,e){if(t===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&e==="foreignObject"?0:t}function I_(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Fy=null;function J6(){var t=window.event;return t&&t.type==="popstate"?t===Fy?!1:(Fy=t,!0):(Fy=null,!1)}var iD=typeof setTimeout=="function"?setTimeout:void 0,X6=typeof clearTimeout=="function"?clearTimeout:void 0,ok=typeof Promise=="function"?Promise:void 0,Z6=typeof queueMicrotask=="function"?queueMicrotask:typeof ok<"u"?function(t){return ok.resolve(null).then(t).catch(e5)}:iD;function e5(t){setTimeout(function(){throw t})}function Ko(t){return t==="head"}function ak(t,e){var n=e,i=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"||n==="/&"){if(i===0){t.removeChild(r),Pc(e);return}i--}else if(n==="$"||n==="$?"||n==="$~"||n==="$!"||n==="&")i++;else if(n==="html")Od(t.ownerDocument.documentElement);else if(n==="head"){n=t.ownerDocument.head,Od(n);for(var s=n.firstChild;s;){var o=s.nextSibling,a=s.nodeName;s[qh]||a==="SCRIPT"||a==="STYLE"||a==="LINK"&&s.rel.toLowerCase()==="stylesheet"||n.removeChild(s),s=o}}else n==="body"&&Od(t.ownerDocument.body);n=r}while(n);Pc(e)}function lk(t,e){var n=t;t=0;do{var i=n.nextSibling;if(n.nodeType===1?e?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",n.getAttribute("style")===""&&n.removeAttribute("style")):n.nodeType===3&&(e?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(t===0)break;t--}else n!=="$"&&n!=="$?"&&n!=="$~"&&n!=="$!"||t++;n=i}while(n)}function P_(t){var e=t.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var n=e;switch(e=e.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":P_(n),mT(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(n.rel.toLowerCase()==="stylesheet")continue}t.removeChild(n)}}function t5(t,e,n,i){for(;t.nodeType===1;){var r=n;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!i&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(i){if(!t[qh])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(s=t.getAttribute("rel"),s==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(s!==r.rel||t.getAttribute("href")!==(r.href==null||r.href===""?null:r.href)||t.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin)||t.getAttribute("title")!==(r.title==null?null:r.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(s=t.getAttribute("src"),(s!==(r.src==null?null:r.src)||t.getAttribute("type")!==(r.type==null?null:r.type)||t.getAttribute("crossorigin")!==(r.crossOrigin==null?null:r.crossOrigin))&&s&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(e==="input"&&t.type==="hidden"){var s=r.name==null?null:""+r.name;if(r.type==="hidden"&&t.getAttribute("name")===s)return t}else return t;if(t=zi(t.nextSibling),t===null)break}return null}function n5(t,e,n){if(e==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=zi(t.nextSibling),t===null))return null;return t}function rD(t,e){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!e||(t=zi(t.nextSibling),t===null))return null;return t}function x_(t){return t.data==="$?"||t.data==="$~"}function D_(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function i5(t,e){var n=t.ownerDocument;if(t.data==="$~")t._reactRetry=e;else if(t.data!=="$?"||n.readyState!=="loading")e();else{var i=function(){e(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),t._reactRetry=i}}function zi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?"||e==="$~"||e==="&"||e==="F!"||e==="F")break;if(e==="/$"||e==="/&")return null}}return t}var O_=null;function ck(t){t=t.nextSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"||n==="/&"){if(e===0)return zi(t.nextSibling);e--}else n!=="$"&&n!=="$!"&&n!=="$?"&&n!=="$~"&&n!=="&"||e++}t=t.nextSibling}return null}function uk(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"){if(e===0)return t;e--}else n!=="/$"&&n!=="/&"||e++}t=t.previousSibling}return null}function sD(t,e,n){switch(e=wm(n),t){case"html":if(t=e.documentElement,!t)throw Error(K(452));return t;case"head":if(t=e.head,!t)throw Error(K(453));return t;case"body":if(t=e.body,!t)throw Error(K(454));return t;default:throw Error(K(451))}}function Od(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);mT(t)}var Gi=new Map,dk=new Set;function Rm(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Is=$e.d;$e.d={f:r5,r:s5,D:o5,C:a5,L:l5,m:c5,X:d5,S:u5,M:h5};function r5(){var t=Is.f(),e=zg();return t||e}function s5(t){var e=Qc(t);e!==null&&e.tag===5&&e.type==="form"?XP(e):Is.r(t)}var Zc=typeof document>"u"?null:document;function oD(t,e,n){var i=Zc;if(i&&typeof e=="string"&&e){var r=Li(e);r='link[rel="'+t+'"][href="'+r+'"]',typeof n=="string"&&(r+='[crossorigin="'+n+'"]'),dk.has(r)||(dk.add(r),t={rel:t,crossOrigin:n,href:e},i.querySelector(r)===null&&(e=i.createElement("link"),An(e,"link",t),dn(e),i.head.appendChild(e)))}}function o5(t){Is.D(t),oD("dns-prefetch",t,null)}function a5(t,e){Is.C(t,e),oD("preconnect",t,e)}function l5(t,e,n){Is.L(t,e,n);var i=Zc;if(i&&t&&e){var r='link[rel="preload"][as="'+Li(e)+'"]';e==="image"&&n&&n.imageSrcSet?(r+='[imagesrcset="'+Li(n.imageSrcSet)+'"]',typeof n.imageSizes=="string"&&(r+='[imagesizes="'+Li(n.imageSizes)+'"]')):r+='[href="'+Li(t)+'"]';var s=r;switch(e){case"style":s=Ic(t);break;case"script":s=eu(t)}Gi.has(s)||(t=mt({rel:"preload",href:e==="image"&&n&&n.imageSrcSet?void 0:t,as:e},n),Gi.set(s,t),i.querySelector(r)!==null||e==="style"&&i.querySelector(Wh(s))||e==="script"&&i.querySelector(Qh(s))||(e=i.createElement("link"),An(e,"link",t),dn(e),i.head.appendChild(e)))}}function c5(t,e){Is.m(t,e);var n=Zc;if(n&&t){var i=e&&typeof e.as=="string"?e.as:"script",r='link[rel="modulepreload"][as="'+Li(i)+'"][href="'+Li(t)+'"]',s=r;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=eu(t)}if(!Gi.has(s)&&(t=mt({rel:"modulepreload",href:t},e),Gi.set(s,t),n.querySelector(r)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(Qh(s)))return}i=n.createElement("link"),An(i,"link",t),dn(i),n.head.appendChild(i)}}}function u5(t,e,n){Is.S(t,e,n);var i=Zc;if(i&&t){var r=Jl(i).hoistableStyles,s=Ic(t);e=e||"default";var o=r.get(s);if(!o){var a={loading:0,preload:null};if(o=i.querySelector(Wh(s)))a.loading=5;else{t=mt({rel:"stylesheet",href:t,"data-precedence":e},n),(n=Gi.get(s))&&eS(t,n);var l=o=i.createElement("link");dn(l),An(l,"link",t),l._p=new Promise(function(c,u){l.onload=c,l.onerror=u}),l.addEventListener("load",function(){a.loading|=1}),l.addEventListener("error",function(){a.loading|=2}),a.loading|=4,Rp(o,e,i)}o={type:"stylesheet",instance:o,count:1,state:a},r.set(s,o)}}}function d5(t,e){Is.X(t,e);var n=Zc;if(n&&t){var i=Jl(n).hoistableScripts,r=eu(t),s=i.get(r);s||(s=n.querySelector(Qh(r)),s||(t=mt({src:t,async:!0},e),(e=Gi.get(r))&&tS(t,e),s=n.createElement("script"),dn(s),An(s,"link",t),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}}function h5(t,e){Is.M(t,e);var n=Zc;if(n&&t){var i=Jl(n).hoistableScripts,r=eu(t),s=i.get(r);s||(s=n.querySelector(Qh(r)),s||(t=mt({src:t,async:!0,type:"module"},e),(e=Gi.get(r))&&tS(t,e),s=n.createElement("script"),dn(s),An(s,"link",t),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(r,s))}}function hk(t,e,n,i){var r=(r=uo.current)?Rm(r):null;if(!r)throw Error(K(446));switch(t){case"meta":case"title":return null;case"style":return typeof n.precedence=="string"&&typeof n.href=="string"?(e=Ic(n.href),n=Jl(r).hoistableStyles,i=n.get(e),i||(i={type:"style",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(n.rel==="stylesheet"&&typeof n.href=="string"&&typeof n.precedence=="string"){t=Ic(n.href);var s=Jl(r).hoistableStyles,o=s.get(t);if(o||(r=r.ownerDocument||r,o={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},s.set(t,o),(s=r.querySelector(Wh(t)))&&!s._p&&(o.instance=s,o.state.loading=5),Gi.has(t)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Gi.set(t,n),s||f5(r,t,n,o.state))),e&&i===null)throw Error(K(528,""));return o}if(e&&i!==null)throw Error(K(529,""));return null;case"script":return e=n.async,n=n.src,typeof n=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=eu(n),n=Jl(r).hoistableScripts,i=n.get(e),i||(i={type:"script",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(K(444,t))}}function Ic(t){return'href="'+Li(t)+'"'}function Wh(t){return'link[rel="stylesheet"]['+t+"]"}function aD(t){return mt({},t,{"data-precedence":t.precedence,precedence:null})}function f5(t,e,n,i){t.querySelector('link[rel="preload"][as="style"]['+e+"]")?i.loading=1:(e=t.createElement("link"),i.preload=e,e.addEventListener("load",function(){return i.loading|=1}),e.addEventListener("error",function(){return i.loading|=2}),An(e,"link",n),dn(e),t.head.appendChild(e))}function eu(t){return'[src="'+Li(t)+'"]'}function Qh(t){return"script[async]"+t}function fk(t,e,n){if(e.count++,e.instance===null)switch(e.type){case"style":var i=t.querySelector('style[data-href~="'+Li(n.href)+'"]');if(i)return e.instance=i,dn(i),i;var r=mt({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return i=(t.ownerDocument||t).createElement("style"),dn(i),An(i,"style",r),Rp(i,n.precedence,t),e.instance=i;case"stylesheet":r=Ic(n.href);var s=t.querySelector(Wh(r));if(s)return e.state.loading|=4,e.instance=s,dn(s),s;i=aD(n),(r=Gi.get(r))&&eS(i,r),s=(t.ownerDocument||t).createElement("link"),dn(s);var o=s;return o._p=new Promise(function(a,l){o.onload=a,o.onerror=l}),An(s,"link",i),e.state.loading|=4,Rp(s,n.precedence,t),e.instance=s;case"script":return s=eu(n.src),(r=t.querySelector(Qh(s)))?(e.instance=r,dn(r),r):(i=n,(r=Gi.get(s))&&(i=mt({},n),tS(i,r)),t=t.ownerDocument||t,r=t.createElement("script"),dn(r),An(r,"link",i),t.head.appendChild(r),e.instance=r);case"void":return null;default:throw Error(K(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(i=e.instance,e.state.loading|=4,Rp(i,n.precedence,t));return e.instance}function Rp(t,e,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),r=i.length?i[i.length-1]:null,s=r,o=0;o<i.length;o++){var a=i[o];if(a.dataset.precedence===e)s=a;else if(s!==r)break}s?s.parentNode.insertBefore(t,s.nextSibling):(e=n.nodeType===9?n.head:n,e.insertBefore(t,e.firstChild))}function eS(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.title==null&&(t.title=e.title)}function tS(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.integrity==null&&(t.integrity=e.integrity)}var Ap=null;function pk(t,e,n){if(Ap===null){var i=new Map,r=Ap=new Map;r.set(n,i)}else r=Ap,i=r.get(n),i||(i=new Map,r.set(n,i));if(i.has(t))return i;for(i.set(t,null),n=n.getElementsByTagName(t),r=0;r<n.length;r++){var s=n[r];if(!(s[qh]||s[Sn]||t==="link"&&s.getAttribute("rel")==="stylesheet")&&s.namespaceURI!=="http://www.w3.org/2000/svg"){var o=s.getAttribute(e)||"";o=t+o;var a=i.get(o);a?a.push(s):i.set(o,[s])}}return i}function mk(t,e,n){t=t.ownerDocument||t,t.head.insertBefore(n,e==="title"?t.querySelector("head > title"):null)}function p5(t,e,n){if(n===1||e.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return t=e.disabled,typeof e.precedence=="string"&&t==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function lD(t){return!(t.type==="stylesheet"&&!(t.state.loading&3))}function m5(t,e,n,i){if(n.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&!(n.state.loading&4)){if(n.instance===null){var r=Ic(i.href),s=e.querySelector(Wh(r));if(s){e=s._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(t.count++,t=Am.bind(t),e.then(t,t)),n.state.loading|=4,n.instance=s,dn(s);return}s=e.ownerDocument||e,i=aD(i),(r=Gi.get(r))&&eS(i,r),s=s.createElement("link"),dn(s);var o=s;o._p=new Promise(function(a,l){o.onload=a,o.onerror=l}),An(s,"link",i),n.instance=s}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(n,e),(e=n.state.preload)&&!(n.state.loading&3)&&(t.count++,n=Am.bind(t),e.addEventListener("load",n),e.addEventListener("error",n))}}var jy=0;function g5(t,e){return t.stylesheets&&t.count===0&&Ip(t,t.stylesheets),0<t.count||0<t.imgCount?function(n){var i=setTimeout(function(){if(t.stylesheets&&Ip(t,t.stylesheets),t.unsuspend){var s=t.unsuspend;t.unsuspend=null,s()}},6e4+e);0<t.imgBytes&&jy===0&&(jy=62500*Y6());var r=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Ip(t,t.stylesheets),t.unsuspend)){var s=t.unsuspend;t.unsuspend=null,s()}},(t.imgBytes>jy?50:800)+e);return t.unsuspend=n,function(){t.unsuspend=null,clearTimeout(i),clearTimeout(r)}}:null}function Am(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ip(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Im=null;function Ip(t,e){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Im=new Map,e.forEach(v5,t),Im=null,Am.call(t))}function v5(t,e){if(!(e.state.loading&4)){var n=Im.get(t);if(n)var i=n.get(null);else{n=new Map,Im.set(t,n);for(var r=t.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<r.length;s++){var o=r[s];(o.nodeName==="LINK"||o.getAttribute("media")!=="not all")&&(n.set(o.dataset.precedence,o),i=o)}i&&n.set(null,i)}r=e.instance,o=r.getAttribute("data-precedence"),s=n.get(o)||i,s===i&&n.set(null,r),n.set(o,r),this.count++,i=Am.bind(this),r.addEventListener("load",i),r.addEventListener("error",i),s?s.parentNode.insertBefore(r,s.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(r,t.firstChild)),e.state.loading|=4}}var sh={$$typeof:is,Provider:null,Consumer:null,_currentValue:ka,_currentValue2:ka,_threadCount:0};function y5(t,e,n,i,r,s,o,a,l){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=cy(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cy(0),this.hiddenUpdates=cy(null),this.identifierPrefix=i,this.onUncaughtError=r,this.onCaughtError=s,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function cD(t,e,n,i,r,s,o,a,l,c,u,d){return t=new y5(t,e,n,o,l,c,u,d,a),e=1,s===!0&&(e|=24),s=gi(3,null,null,e),t.current=s,s.stateNode=t,e=RT(),e.refCount++,t.pooledCache=e,e.refCount++,s.memoizedState={element:i,isDehydrated:n,cache:e},PT(s),t}function uD(t){return t?(t=zl,t):zl}function dD(t,e,n,i,r,s){r=uD(r),i.context===null?i.context=r:i.pendingContext=r,i=fo(e),i.payload={element:n},s=s===void 0?null:s,s!==null&&(i.callback=s),n=po(t,i,e),n!==null&&(si(n,t,e),kd(n,t,e))}function gk(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function nS(t,e){gk(t,e),(t=t.alternate)&&gk(t,e)}function hD(t){if(t.tag===13||t.tag===31){var e=rl(t,67108864);e!==null&&si(e,t,67108864),nS(t,67108864)}}function vk(t){if(t.tag===13||t.tag===31){var e=Ei();e=fT(e);var n=rl(t,e);n!==null&&si(n,t,e),nS(t,e)}}var Pm=!0;function _5(t,e,n,i){var r=ge.T;ge.T=null;var s=$e.p;try{$e.p=2,iS(t,e,n,i)}finally{$e.p=s,ge.T=r}}function b5(t,e,n,i){var r=ge.T;ge.T=null;var s=$e.p;try{$e.p=8,iS(t,e,n,i)}finally{$e.p=s,ge.T=r}}function iS(t,e,n,i){if(Pm){var r=N_(i);if(r===null)Vy(t,e,i,xm,n),yk(t,i);else if(S5(r,t,e,n,i))i.stopPropagation();else if(yk(t,i),e&4&&-1<T5.indexOf(t)){for(;r!==null;){var s=Qc(r);if(s!==null)switch(s.tag){case 3:if(s=s.stateNode,s.current.memoizedState.isDehydrated){var o=fa(s.pendingLanes);if(o!==0){var a=s;for(a.pendingLanes|=2,a.entangledLanes|=2;o;){var l=1<<31-Si(o);a.entanglements[1]|=l,o&=~l}Mr(s),!(Ke&6)&&(bm=bi()+500,$h(0))}}break;case 31:case 13:a=rl(s,2),a!==null&&si(a,s,2),zg(),nS(s,2)}if(s=N_(i),s===null&&Vy(t,e,i,xm,n),s===r)break;r=s}r!==null&&i.stopPropagation()}else Vy(t,e,i,null,n)}}function N_(t){return t=vT(t),rS(t)}var xm=null;function rS(t){if(xm=null,t=Ul(t),t!==null){var e=Vh(t);if(e===null)t=null;else{var n=e.tag;if(n===13){if(t=DI(e),t!==null)return t;t=null}else if(n===31){if(t=OI(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return xm=t,null}function fD(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(oU()){case UI:return 2;case VI:return 8;case om:case aU:return 32;case FI:return 268435456;default:return 32}default:return 32}}var M_=!1,vo=null,yo=null,_o=null,oh=new Map,ah=new Map,Zs=[],T5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function yk(t,e){switch(t){case"focusin":case"focusout":vo=null;break;case"dragenter":case"dragleave":yo=null;break;case"mouseover":case"mouseout":_o=null;break;case"pointerover":case"pointerout":oh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ah.delete(e.pointerId)}}function Gu(t,e,n,i,r,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=Qc(e),e!==null&&hD(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function S5(t,e,n,i,r){switch(e){case"focusin":return vo=Gu(vo,t,e,n,i,r),!0;case"dragenter":return yo=Gu(yo,t,e,n,i,r),!0;case"mouseover":return _o=Gu(_o,t,e,n,i,r),!0;case"pointerover":var s=r.pointerId;return oh.set(s,Gu(oh.get(s)||null,t,e,n,i,r)),!0;case"gotpointercapture":return s=r.pointerId,ah.set(s,Gu(ah.get(s)||null,t,e,n,i,r)),!0}return!1}function pD(t){var e=Ul(t.target);if(e!==null){var n=Vh(e);if(n!==null){if(e=n.tag,e===13){if(e=DI(n),e!==null){t.blockedOn=e,n1(t.priority,function(){vk(n)});return}}else if(e===31){if(e=OI(n),e!==null){t.blockedOn=e,n1(t.priority,function(){vk(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Pp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=N_(t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Z0=i,n.target.dispatchEvent(i),Z0=null}else return e=Qc(n),e!==null&&hD(e),t.blockedOn=n,!1;e.shift()}return!0}function _k(t,e,n){Pp(t)&&n.delete(e)}function E5(){M_=!1,vo!==null&&Pp(vo)&&(vo=null),yo!==null&&Pp(yo)&&(yo=null),_o!==null&&Pp(_o)&&(_o=null),oh.forEach(_k),ah.forEach(_k)}function Yf(t,e){t.blockedOn===e&&(t.blockedOn=null,M_||(M_=!0,Xt.unstable_scheduleCallback(Xt.unstable_NormalPriority,E5)))}var Jf=null;function bk(t){Jf!==t&&(Jf=t,Xt.unstable_scheduleCallback(Xt.unstable_NormalPriority,function(){Jf===t&&(Jf=null);for(var e=0;e<t.length;e+=3){var n=t[e],i=t[e+1],r=t[e+2];if(typeof i!="function"){if(rS(i||n)===null)continue;break}var s=Qc(n);s!==null&&(t.splice(e,3),e-=3,m_(s,{pending:!0,data:r,method:n.method,action:i},i,r))}}))}function Pc(t){function e(l){return Yf(l,t)}vo!==null&&Yf(vo,t),yo!==null&&Yf(yo,t),_o!==null&&Yf(_o,t),oh.forEach(e),ah.forEach(e);for(var n=0;n<Zs.length;n++){var i=Zs[n];i.blockedOn===t&&(i.blockedOn=null)}for(;0<Zs.length&&(n=Zs[0],n.blockedOn===null);)pD(n),n.blockedOn===null&&Zs.shift();if(n=(t.ownerDocument||t).$$reactFormReplay,n!=null)for(i=0;i<n.length;i+=3){var r=n[i],s=n[i+1],o=r[ai]||null;if(typeof s=="function")o||bk(n);else if(o){var a=null;if(s&&s.hasAttribute("formAction")){if(r=s,o=s[ai]||null)a=o.formAction;else if(rS(r)!==null)continue}else a=o.action;typeof a=="function"?n[i+1]=a:(n.splice(i,3),i-=3),bk(n)}}}function mD(){function t(s){s.canIntercept&&s.info==="react-transition"&&s.intercept({handler:function(){return new Promise(function(o){return r=o})},focusReset:"manual",scroll:"manual"})}function e(){r!==null&&(r(),r=null),i||setTimeout(n,20)}function n(){if(!i&&!navigation.transition){var s=navigation.currentEntry;s&&s.url!=null&&navigation.navigate(s.url,{state:s.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var i=!1,r=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",e),navigation.addEventListener("navigateerror",e),setTimeout(n,100),function(){i=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",e),navigation.removeEventListener("navigateerror",e),r!==null&&(r(),r=null)}}}function sS(t){this._internalRoot=t}Kg.prototype.render=sS.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(K(409));var n=e.current,i=Ei();dD(n,i,t,e,null,null)};Kg.prototype.unmount=sS.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;dD(t.current,2,null,t,null,null),zg(),e[Wc]=null}};function Kg(t){this._internalRoot=t}Kg.prototype.unstable_scheduleHydration=function(t){if(t){var e=HI();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Zs.length&&e!==0&&e<Zs[n].priority;n++);Zs.splice(n,0,t),n===0&&pD(t)}};var Tk=PI.version;if(Tk!=="19.2.4")throw Error(K(527,Tk,"19.2.4"));$e.findDOMNode=function(t){var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(K(188)):(t=Object.keys(t).join(","),Error(K(268,t)));return t=Z4(e),t=t!==null?NI(t):null,t=t===null?null:t.stateNode,t};var C5={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:ge,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xf.isDisabled&&Xf.supportsFiber)try{Fh=Xf.inject(C5),Ti=Xf}catch{}}Ig.createRoot=function(t,e){if(!xI(t))throw Error(K(299));var n=!1,i="",r=ox,s=ax,o=lx;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onUncaughtError!==void 0&&(r=e.onUncaughtError),e.onCaughtError!==void 0&&(s=e.onCaughtError),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=cD(t,1,!1,null,null,n,i,null,r,s,o,mD),t[Wc]=e.current,ZT(t),new sS(e)};Ig.hydrateRoot=function(t,e,n){if(!xI(t))throw Error(K(299));var i=!1,r="",s=ox,o=ax,a=lx,l=null;return n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(r=n.identifierPrefix),n.onUncaughtError!==void 0&&(s=n.onUncaughtError),n.onCaughtError!==void 0&&(o=n.onCaughtError),n.onRecoverableError!==void 0&&(a=n.onRecoverableError),n.formState!==void 0&&(l=n.formState)),e=cD(t,1,!0,e,n??null,i,r,l,s,o,a,mD),e.context=uD(null),n=e.current,i=Ei(),i=fT(i),r=fo(i),r.callback=null,po(n,r,i),n=i,e.current.lanes=n,Bh(e,n),Mr(e),t[Wc]=e.current,ZT(t),new Kg(e)};Ig.version="19.2.4";function gD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(gD)}catch(t){console.error(t)}}gD(),CI.exports=Ig;var k5=CI.exports;/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Sk="popstate";function w5(t={}){function e(i,r){let{pathname:s,search:o,hash:a}=i.location;return L_("",{pathname:s,search:o,hash:a},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(i,r){return typeof r=="string"?r:lh(r)}return A5(e,n,null,t)}function bt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ar(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function R5(){return Math.random().toString(36).substring(2,10)}function Ek(t,e){return{usr:t.state,key:t.key,idx:e}}function L_(t,e,n=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?tu(e):e,state:n,key:e&&e.key||i||R5()}}function lh({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function tu(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substring(i),t=t.substring(0,i)),t&&(e.pathname=t)}return e}function A5(t,e,n,i={}){let{window:r=document.defaultView,v5Compat:s=!1}=i,o=r.history,a="POP",l=null,c=u();c==null&&(c=0,o.replaceState({...o.state,idx:c},""));function u(){return(o.state||{idx:null}).idx}function d(){a="POP";let E=u(),y=E==null?null:E-c;c=E,l&&l({action:a,location:g.location,delta:y})}function f(E,y){a="PUSH";let T=L_(g.location,E,y);c=u()+1;let R=Ek(T,c),b=g.createHref(T);try{o.pushState(R,"",b)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;r.location.assign(b)}s&&l&&l({action:a,location:g.location,delta:1})}function p(E,y){a="REPLACE";let T=L_(g.location,E,y);c=u();let R=Ek(T,c),b=g.createHref(T);o.replaceState(R,"",b),s&&l&&l({action:a,location:g.location,delta:0})}function v(E){return I5(E)}let g={get action(){return a},get location(){return t(r,o)},listen(E){if(l)throw new Error("A history only accepts one active listener");return r.addEventListener(Sk,d),l=E,()=>{r.removeEventListener(Sk,d),l=null}},createHref(E){return e(r,E)},createURL:v,encodeLocation(E){let y=v(E);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:f,replace:p,go(E){return o.go(E)}};return g}function I5(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),bt(n,"No window.location.(origin|href) available to create URL");let i=typeof t=="string"?t:lh(t);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=n+i),new URL(i,n)}function vD(t,e,n="/"){return P5(t,e,n,!1)}function P5(t,e,n,i){let r=typeof e=="string"?tu(e):e,s=_s(r.pathname||"/",n);if(s==null)return null;let o=yD(t);x5(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=q5(s);a=j5(o[l],c,i)}return a}function yD(t,e=[],n=[],i="",r=!1){let s=(o,a,l=r,c)=>{let u={relativePath:c===void 0?o.path||"":c,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(i)&&l)return;bt(u.relativePath.startsWith(i),`Absolute route path "${u.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(i.length)}let d=us([i,u.relativePath]),f=n.concat(u);o.children&&o.children.length>0&&(bt(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${d}".`),yD(o.children,e,f,d,l)),!(o.path==null&&!o.index)&&e.push({path:d,score:V5(d,o.index),routesMeta:f})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))s(o,a);else for(let c of _D(o.path))s(o,a,!0,c)}),e}function _D(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,r=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let o=_D(i.join("/")),a=[];return a.push(...o.map(l=>l===""?s:[s,l].join("/"))),r&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function x5(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:F5(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var D5=/^:[\w-]+$/,O5=3,N5=2,M5=1,L5=10,U5=-2,Ck=t=>t==="*";function V5(t,e){let n=t.split("/"),i=n.length;return n.some(Ck)&&(i+=U5),e&&(i+=N5),n.filter(r=>!Ck(r)).reduce((r,s)=>r+(D5.test(s)?O5:s===""?M5:L5),i)}function F5(t,e){return t.length===e.length&&t.slice(0,-1).every((i,r)=>i===e[r])?t[t.length-1]-e[e.length-1]:0}function j5(t,e,n=!1){let{routesMeta:i}=t,r={},s="/",o=[];for(let a=0;a<i.length;++a){let l=i[a],c=a===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",d=Dm({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!d&&c&&n&&!i[i.length-1].route.index&&(d=Dm({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(r,d.params),o.push({params:r,pathname:us([s,d.pathname]),pathnameBase:K5(us([s,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(s=us([s,d.pathnameBase]))}return o}function Dm(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=B5(t.path,t.caseSensitive,t.end),r=e.match(n);if(!r)return null;let s=r[0],o=s.replace(/(.)\/+$/,"$1"),a=r.slice(1);return{params:i.reduce((c,{paramName:u,isOptional:d},f)=>{if(u==="*"){let v=a[f]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const p=a[f];return d&&!p?c[u]=void 0:c[u]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:o,pattern:t}}function B5(t,e=!1,n=!0){Ar(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(i.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(i.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function q5(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ar(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function _s(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}var z5=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function H5(t,e="/"){let{pathname:n,search:i="",hash:r=""}=typeof t=="string"?tu(t):t,s;return n?(n=n.replace(/\/\/+/g,"/"),n.startsWith("/")?s=kk(n.substring(1),"/"):s=kk(n,e)):s=e,{pathname:s,search:$5(i),hash:W5(r)}}function kk(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function By(t,e,n,i){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function G5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function bD(t){let e=G5(t);return e.map((n,i)=>i===e.length-1?n.pathname:n.pathnameBase)}function TD(t,e,n,i=!1){let r;typeof t=="string"?r=tu(t):(r={...t},bt(!r.pathname||!r.pathname.includes("?"),By("?","pathname","search",r)),bt(!r.pathname||!r.pathname.includes("#"),By("#","pathname","hash",r)),bt(!r.search||!r.search.includes("#"),By("#","search","hash",r)));let s=t===""||r.pathname==="",o=s?"/":r.pathname,a;if(o==null)a=n;else{let d=e.length-1;if(!i&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),d-=1;r.pathname=f.join("/")}a=d>=0?e[d]:"/"}let l=H5(r,a),c=o&&o!=="/"&&o.endsWith("/"),u=(s||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var us=t=>t.join("/").replace(/\/\/+/g,"/"),K5=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),$5=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,W5=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,Q5=class{constructor(t,e,n,i=!1){this.status=t,this.statusText=e||"",this.internal=i,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function Y5(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function J5(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var SD=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function ED(t,e){let n=t;if(typeof n!="string"||!z5.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let i=n,r=!1;if(SD)try{let s=new URL(window.location.href),o=n.startsWith("//")?new URL(s.protocol+n):new URL(n),a=_s(o.pathname,e);o.origin===s.origin&&a!=null?n=a+o.search+o.hash:r=!0}catch{Ar(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:i,isExternal:r,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var CD=["POST","PUT","PATCH","DELETE"];new Set(CD);var X5=["GET",...CD];new Set(X5);var nu=P.createContext(null);nu.displayName="DataRouter";var $g=P.createContext(null);$g.displayName="DataRouterState";var Z5=P.createContext(!1),kD=P.createContext({isTransitioning:!1});kD.displayName="ViewTransition";var eV=P.createContext(new Map);eV.displayName="Fetchers";var tV=P.createContext(null);tV.displayName="Await";var Ki=P.createContext(null);Ki.displayName="Navigation";var Yh=P.createContext(null);Yh.displayName="Location";var Lr=P.createContext({outlet:null,matches:[],isDataRoute:!1});Lr.displayName="Route";var oS=P.createContext(null);oS.displayName="RouteError";var wD="REACT_ROUTER_ERROR",nV="REDIRECT",iV="ROUTE_ERROR_RESPONSE";function rV(t){if(t.startsWith(`${wD}:${nV}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function sV(t){if(t.startsWith(`${wD}:${iV}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new Q5(e.status,e.statusText,e.data)}catch{}}function oV(t,{relative:e}={}){bt(Jh(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=P.useContext(Ki),{hash:r,pathname:s,search:o}=Xh(t,{relative:e}),a=s;return n!=="/"&&(a=s==="/"?n:us([n,s])),i.createHref({pathname:a,search:o,hash:r})}function Jh(){return P.useContext(Yh)!=null}function ol(){return bt(Jh(),"useLocation() may be used only in the context of a <Router> component."),P.useContext(Yh).location}var RD="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function AD(t){P.useContext(Ki).static||P.useLayoutEffect(t)}function ID(){let{isDataRoute:t}=P.useContext(Lr);return t?bV():aV()}function aV(){bt(Jh(),"useNavigate() may be used only in the context of a <Router> component.");let t=P.useContext(nu),{basename:e,navigator:n}=P.useContext(Ki),{matches:i}=P.useContext(Lr),{pathname:r}=ol(),s=JSON.stringify(bD(i)),o=P.useRef(!1);return AD(()=>{o.current=!0}),P.useCallback((l,c={})=>{if(Ar(o.current,RD),!o.current)return;if(typeof l=="number"){n.go(l);return}let u=TD(l,JSON.parse(s),r,c.relative==="path");t==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:us([e,u.pathname])),(c.replace?n.replace:n.push)(u,c.state,c)},[e,n,s,r,t])}P.createContext(null);function lV(){let{matches:t}=P.useContext(Lr),e=t[t.length-1];return e?e.params:{}}function Xh(t,{relative:e}={}){let{matches:n}=P.useContext(Lr),{pathname:i}=ol(),r=JSON.stringify(bD(n));return P.useMemo(()=>TD(t,JSON.parse(r),i,e==="path"),[t,r,i,e])}function cV(t,e){return PD(t,e)}function PD(t,e,n,i,r){var T;bt(Jh(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=P.useContext(Ki),{matches:o}=P.useContext(Lr),a=o[o.length-1],l=a?a.params:{},c=a?a.pathname:"/",u=a?a.pathnameBase:"/",d=a&&a.route;{let R=d&&d.path||"";DD(c,!d||R.endsWith("*")||R.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${R}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${R}"> to <Route path="${R==="/"?"*":`${R}/*`}">.`)}let f=ol(),p;if(e){let R=typeof e=="string"?tu(e):e;bt(u==="/"||((T=R.pathname)==null?void 0:T.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${R.pathname}" was given in the \`location\` prop.`),p=R}else p=f;let v=p.pathname||"/",g=v;if(u!=="/"){let R=u.replace(/^\//,"").split("/");g="/"+v.replace(/^\//,"").split("/").slice(R.length).join("/")}let E=vD(t,{pathname:g});Ar(d||E!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),Ar(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let y=pV(E&&E.map(R=>Object.assign({},R,{params:Object.assign({},l,R.params),pathname:us([u,s.encodeLocation?s.encodeLocation(R.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:R.pathname]),pathnameBase:R.pathnameBase==="/"?u:us([u,s.encodeLocation?s.encodeLocation(R.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:R.pathnameBase])})),o,n,i,r);return e&&y?P.createElement(Yh.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},y):y}function uV(){let t=_V(),e=Y5(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:i},s={padding:"2px 4px",backgroundColor:i},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=P.createElement(P.Fragment,null,P.createElement("p",null," Hey developer "),P.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",P.createElement("code",{style:s},"ErrorBoundary")," or"," ",P.createElement("code",{style:s},"errorElement")," prop on your route.")),P.createElement(P.Fragment,null,P.createElement("h2",null,"Unexpected Application Error!"),P.createElement("h3",{style:{fontStyle:"italic"}},e),n?P.createElement("pre",{style:r},n):null,o)}var dV=P.createElement(uV,null),xD=class extends P.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=sV(t.digest);n&&(t=n)}let e=t!==void 0?P.createElement(Lr.Provider,{value:this.props.routeContext},P.createElement(oS.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?P.createElement(hV,{error:t},e):e}};xD.contextType=Z5;var qy=new WeakMap;function hV({children:t,error:e}){let{basename:n}=P.useContext(Ki);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let i=rV(e.digest);if(i){let r=qy.get(e);if(r)throw r;let s=ED(i.location,n);if(SD&&!qy.get(e))if(s.isExternal||i.reloadDocument)window.location.href=s.absoluteURL||s.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(s.to,{replace:i.replace}));throw qy.set(e,o),o}return P.createElement("meta",{httpEquiv:"refresh",content:`0;url=${s.absoluteURL||s.to}`})}}return t}function fV({routeContext:t,match:e,children:n}){let i=P.useContext(nu);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),P.createElement(Lr.Provider,{value:t},n)}function pV(t,e=[],n=null,i=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let s=t,o=n==null?void 0:n.errors;if(o!=null){let u=s.findIndex(d=>d.route.id&&(o==null?void 0:o[d.route.id])!==void 0);bt(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),s=s.slice(0,Math.min(s.length,u+1))}let a=!1,l=-1;if(n)for(let u=0;u<s.length;u++){let d=s[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=u),d.route.id){let{loaderData:f,errors:p}=n,v=d.route.loader&&!f.hasOwnProperty(d.route.id)&&(!p||p[d.route.id]===void 0);if(d.route.lazy||v){a=!0,l>=0?s=s.slice(0,l+1):s=[s[0]];break}}}let c=n&&i?(u,d)=>{var f,p;i(u,{location:n.location,params:((p=(f=n.matches)==null?void 0:f[0])==null?void 0:p.params)??{},unstable_pattern:J5(n.matches),errorInfo:d})}:void 0;return s.reduceRight((u,d,f)=>{let p,v=!1,g=null,E=null;n&&(p=o&&d.route.id?o[d.route.id]:void 0,g=d.route.errorElement||dV,a&&(l<0&&f===0?(DD("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,E=null):l===f&&(v=!0,E=d.route.hydrateFallbackElement||null)));let y=e.concat(s.slice(0,f+1)),T=()=>{let R;return p?R=g:v?R=E:d.route.Component?R=P.createElement(d.route.Component,null):d.route.element?R=d.route.element:R=u,P.createElement(fV,{match:d,routeContext:{outlet:u,matches:y,isDataRoute:n!=null},children:R})};return n&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?P.createElement(xD,{location:n.location,revalidation:n.revalidation,component:g,error:p,children:T(),routeContext:{outlet:null,matches:y,isDataRoute:!0},onError:c}):T()},null)}function aS(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function mV(t){let e=P.useContext(nu);return bt(e,aS(t)),e}function gV(t){let e=P.useContext($g);return bt(e,aS(t)),e}function vV(t){let e=P.useContext(Lr);return bt(e,aS(t)),e}function lS(t){let e=vV(t),n=e.matches[e.matches.length-1];return bt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function yV(){return lS("useRouteId")}function _V(){var i;let t=P.useContext(oS),e=gV("useRouteError"),n=lS("useRouteError");return t!==void 0?t:(i=e.errors)==null?void 0:i[n]}function bV(){let{router:t}=mV("useNavigate"),e=lS("useNavigate"),n=P.useRef(!1);return AD(()=>{n.current=!0}),P.useCallback(async(r,s={})=>{Ar(n.current,RD),n.current&&(typeof r=="number"?await t.navigate(r):await t.navigate(r,{fromRouteId:e,...s}))},[t,e])}var wk={};function DD(t,e,n){!e&&!wk[t]&&(wk[t]=!0,Ar(!1,n))}P.memo(TV);function TV({routes:t,future:e,state:n,onError:i}){return PD(t,void 0,n,i,e)}function xp(t){bt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function SV({basename:t="/",children:e=null,location:n,navigationType:i="POP",navigator:r,static:s=!1,unstable_useTransitions:o}){bt(!Jh(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=P.useMemo(()=>({basename:a,navigator:r,static:s,unstable_useTransitions:o,future:{}}),[a,r,s,o]);typeof n=="string"&&(n=tu(n));let{pathname:c="/",search:u="",hash:d="",state:f=null,key:p="default"}=n,v=P.useMemo(()=>{let g=_s(c,a);return g==null?null:{location:{pathname:g,search:u,hash:d,state:f,key:p},navigationType:i}},[a,c,u,d,f,p,i]);return Ar(v!=null,`<Router basename="${a}"> is not able to match the URL "${c}${u}${d}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:P.createElement(Ki.Provider,{value:l},P.createElement(Yh.Provider,{children:e,value:v}))}function EV({children:t,location:e}){return cV(U_(t),e)}function U_(t,e=[]){let n=[];return P.Children.forEach(t,(i,r)=>{if(!P.isValidElement(i))return;let s=[...e,r];if(i.type===P.Fragment){n.push.apply(n,U_(i.props.children,s));return}bt(i.type===xp,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),bt(!i.props.index||!i.props.children,"An index route cannot have child routes.");let o={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=U_(i.props.children,s)),n.push(o)}),n}var Dp="get",Op="application/x-www-form-urlencoded";function Wg(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function CV(t){return Wg(t)&&t.tagName.toLowerCase()==="button"}function kV(t){return Wg(t)&&t.tagName.toLowerCase()==="form"}function wV(t){return Wg(t)&&t.tagName.toLowerCase()==="input"}function RV(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function AV(t,e){return t.button===0&&(!e||e==="_self")&&!RV(t)}var Zf=null;function IV(){if(Zf===null)try{new FormData(document.createElement("form"),0),Zf=!1}catch{Zf=!0}return Zf}var PV=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function zy(t){return t!=null&&!PV.has(t)?(Ar(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Op}"`),null):t}function xV(t,e){let n,i,r,s,o;if(kV(t)){let a=t.getAttribute("action");i=a?_s(a,e):null,n=t.getAttribute("method")||Dp,r=zy(t.getAttribute("enctype"))||Op,s=new FormData(t)}else if(CV(t)||wV(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(i=l?_s(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||Dp,r=zy(t.getAttribute("formenctype"))||zy(a.getAttribute("enctype"))||Op,s=new FormData(a,t),!IV()){let{name:c,type:u,value:d}=t;if(u==="image"){let f=c?`${c}.`:"";s.append(`${f}x`,"0"),s.append(`${f}y`,"0")}else c&&s.append(c,d)}}else{if(Wg(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Dp,i=null,r=Op,o=t}return s&&r==="text/plain"&&(o=s,s=void 0),{action:i,method:n.toLowerCase(),encType:r,formData:s,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function cS(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function DV(t,e,n,i){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n?r.pathname.endsWith("/")?r.pathname=`${r.pathname}_.${i}`:r.pathname=`${r.pathname}.${i}`:r.pathname==="/"?r.pathname=`_root.${i}`:e&&_s(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${i}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${i}`,r}async function OV(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function NV(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function MV(t,e,n){let i=await Promise.all(t.map(async r=>{let s=e.routes[r.route.id];if(s){let o=await OV(s,n);return o.links?o.links():[]}return[]}));return FV(i.flat(1).filter(NV).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function Rk(t,e,n,i,r,s){let o=(l,c)=>n[c]?l.route.id!==n[c].route.id:!0,a=(l,c)=>{var u;return n[c].pathname!==l.pathname||((u=n[c].route.path)==null?void 0:u.endsWith("*"))&&n[c].params["*"]!==l.params["*"]};return s==="assets"?e.filter((l,c)=>o(l,c)||a(l,c)):s==="data"?e.filter((l,c)=>{var d;let u=i.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(o(l,c)||a(l,c))return!0;if(l.route.shouldRevalidate){let f=l.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((d=n[0])==null?void 0:d.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function LV(t,e,{includeHydrateFallback:n}={}){return UV(t.map(i=>{let r=e.routes[i.route.id];if(!r)return[];let s=[r.module];return r.clientActionModule&&(s=s.concat(r.clientActionModule)),r.clientLoaderModule&&(s=s.concat(r.clientLoaderModule)),n&&r.hydrateFallbackModule&&(s=s.concat(r.hydrateFallbackModule)),r.imports&&(s=s.concat(r.imports)),s}).flat(1))}function UV(t){return[...new Set(t)]}function VV(t){let e={},n=Object.keys(t).sort();for(let i of n)e[i]=t[i];return e}function FV(t,e){let n=new Set;return new Set(e),t.reduce((i,r)=>{let s=JSON.stringify(VV(r));return n.has(s)||(n.add(s),i.push({key:s,link:r})),i},[])}function OD(){let t=P.useContext(nu);return cS(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function jV(){let t=P.useContext($g);return cS(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var uS=P.createContext(void 0);uS.displayName="FrameworkContext";function ND(){let t=P.useContext(uS);return cS(t,"You must render this element inside a <HydratedRouter> element"),t}function BV(t,e){let n=P.useContext(uS),[i,r]=P.useState(!1),[s,o]=P.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:d}=e,f=P.useRef(null);P.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let g=y=>{y.forEach(T=>{o(T.isIntersecting)})},E=new IntersectionObserver(g,{threshold:.5});return f.current&&E.observe(f.current),()=>{E.disconnect()}}},[t]),P.useEffect(()=>{if(i){let g=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(g)}}},[i]);let p=()=>{r(!0)},v=()=>{r(!1),o(!1)};return n?t!=="intent"?[s,f,{}]:[s,f,{onFocus:Ku(a,p),onBlur:Ku(l,v),onMouseEnter:Ku(c,p),onMouseLeave:Ku(u,v),onTouchStart:Ku(d,p)}]:[!1,f,{}]}function Ku(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function qV({page:t,...e}){let{router:n}=OD(),i=P.useMemo(()=>vD(n.routes,t,n.basename),[n.routes,t,n.basename]);return i?P.createElement(HV,{page:t,matches:i,...e}):null}function zV(t){let{manifest:e,routeModules:n}=ND(),[i,r]=P.useState([]);return P.useEffect(()=>{let s=!1;return MV(t,e,n).then(o=>{s||r(o)}),()=>{s=!0}},[t,e,n]),i}function HV({page:t,matches:e,...n}){let i=ol(),{future:r,manifest:s,routeModules:o}=ND(),{basename:a}=OD(),{loaderData:l,matches:c}=jV(),u=P.useMemo(()=>Rk(t,e,c,s,i,"data"),[t,e,c,s,i]),d=P.useMemo(()=>Rk(t,e,c,s,i,"assets"),[t,e,c,s,i]),f=P.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let g=new Set,E=!1;if(e.forEach(T=>{var b;let R=s.routes[T.route.id];!R||!R.hasLoader||(!u.some(w=>w.route.id===T.route.id)&&T.route.id in l&&((b=o[T.route.id])!=null&&b.shouldRevalidate)||R.hasClientLoader?E=!0:g.add(T.route.id))}),g.size===0)return[];let y=DV(t,a,r.unstable_trailingSlashAwareDataRequests,"data");return E&&g.size>0&&y.searchParams.set("_routes",e.filter(T=>g.has(T.route.id)).map(T=>T.route.id).join(",")),[y.pathname+y.search]},[a,r.unstable_trailingSlashAwareDataRequests,l,i,s,u,e,t,o]),p=P.useMemo(()=>LV(d,s),[d,s]),v=zV(d);return P.createElement(P.Fragment,null,f.map(g=>P.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...n})),p.map(g=>P.createElement("link",{key:g,rel:"modulepreload",href:g,...n})),v.map(({key:g,link:E})=>P.createElement("link",{key:g,nonce:n.nonce,...E,crossOrigin:E.crossOrigin??n.crossOrigin})))}function GV(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var KV=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{KV&&(window.__reactRouterVersion="7.13.0")}catch{}function $V({basename:t,children:e,unstable_useTransitions:n,window:i}){let r=P.useRef();r.current==null&&(r.current=w5({window:i,v5Compat:!0}));let s=r.current,[o,a]=P.useState({action:s.action,location:s.location}),l=P.useCallback(c=>{n===!1?a(c):P.startTransition(()=>a(c))},[n]);return P.useLayoutEffect(()=>s.listen(l),[s,l]),P.createElement(SV,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:s,unstable_useTransitions:n})}var MD=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xc=P.forwardRef(function({onClick:e,discover:n="render",prefetch:i="none",relative:r,reloadDocument:s,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:d,unstable_defaultShouldRevalidate:f,...p},v){let{basename:g,unstable_useTransitions:E}=P.useContext(Ki),y=typeof c=="string"&&MD.test(c),T=ED(c,g);c=T.to;let R=oV(c,{relative:r}),[b,w,D]=BV(i,p),C=JV(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:r,viewTransition:d,unstable_defaultShouldRevalidate:f,unstable_useTransitions:E});function k(A){e&&e(A),A.defaultPrevented||C(A)}let S=P.createElement("a",{...p,...D,href:T.absoluteURL||R,onClick:T.isExternal||s?e:k,ref:GV(v,w),target:l,"data-discover":!y&&n==="render"?"true":void 0});return b&&!y?P.createElement(P.Fragment,null,S,P.createElement(qV,{page:R})):S});xc.displayName="Link";var WV=P.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:i="",end:r=!1,style:s,to:o,viewTransition:a,children:l,...c},u){let d=Xh(o,{relative:c.relative}),f=ol(),p=P.useContext($g),{navigator:v,basename:g}=P.useContext(Ki),E=p!=null&&n9(d)&&a===!0,y=v.encodeLocation?v.encodeLocation(d).pathname:d.pathname,T=f.pathname,R=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;n||(T=T.toLowerCase(),R=R?R.toLowerCase():null,y=y.toLowerCase()),R&&g&&(R=_s(R,g)||R);const b=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let w=T===y||!r&&T.startsWith(y)&&T.charAt(b)==="/",D=R!=null&&(R===y||!r&&R.startsWith(y)&&R.charAt(y.length)==="/"),C={isActive:w,isPending:D,isTransitioning:E},k=w?e:void 0,S;typeof i=="function"?S=i(C):S=[i,w?"active":null,D?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let A=typeof s=="function"?s(C):s;return P.createElement(xc,{...c,"aria-current":k,className:S,ref:u,style:A,to:o,viewTransition:a},typeof l=="function"?l(C):l)});WV.displayName="NavLink";var QV=P.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:i,replace:r,state:s,method:o=Dp,action:a,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:d,unstable_defaultShouldRevalidate:f,...p},v)=>{let{unstable_useTransitions:g}=P.useContext(Ki),E=e9(),y=t9(a,{relative:c}),T=o.toLowerCase()==="get"?"get":"post",R=typeof a=="string"&&MD.test(a),b=w=>{if(l&&l(w),w.defaultPrevented)return;w.preventDefault();let D=w.nativeEvent.submitter,C=(D==null?void 0:D.getAttribute("formmethod"))||o,k=()=>E(D||w.currentTarget,{fetcherKey:e,method:C,navigate:n,replace:r,state:s,relative:c,preventScrollReset:u,viewTransition:d,unstable_defaultShouldRevalidate:f});g&&n!==!1?P.startTransition(()=>k()):k()};return P.createElement("form",{ref:v,method:T,action:y,onSubmit:i?l:b,...p,"data-discover":!R&&t==="render"?"true":void 0})});QV.displayName="Form";function YV(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function LD(t){let e=P.useContext(nu);return bt(e,YV(t)),e}function JV(t,{target:e,replace:n,state:i,preventScrollReset:r,relative:s,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let c=ID(),u=ol(),d=Xh(t,{relative:s});return P.useCallback(f=>{if(AV(f,e)){f.preventDefault();let p=n!==void 0?n:lh(u)===lh(d),v=()=>c(t,{replace:p,state:i,preventScrollReset:r,relative:s,viewTransition:o,unstable_defaultShouldRevalidate:a});l?P.startTransition(()=>v()):v()}},[u,c,d,n,i,e,t,r,s,o,a,l])}var XV=0,ZV=()=>`__${String(++XV)}__`;function e9(){let{router:t}=LD("useSubmit"),{basename:e}=P.useContext(Ki),n=yV(),i=t.fetch,r=t.navigate;return P.useCallback(async(s,o={})=>{let{action:a,method:l,encType:c,formData:u,body:d}=xV(s,e);if(o.navigate===!1){let f=o.fetcherKey||ZV();await i(f,n,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:u,body:d,formMethod:o.method||l,formEncType:o.encType||c,flushSync:o.flushSync})}else await r(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:u,body:d,formMethod:o.method||l,formEncType:o.encType||c,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[i,r,e,n])}function t9(t,{relative:e}={}){let{basename:n}=P.useContext(Ki),i=P.useContext(Lr);bt(i,"useFormAction must be used inside a RouteContext");let[r]=i.matches.slice(-1),s={...Xh(t||".",{relative:e})},o=ol();if(t==null){s.search=o.search;let a=new URLSearchParams(s.search),l=a.getAll("index");if(l.some(u=>u==="")){a.delete("index"),l.filter(d=>d).forEach(d=>a.append("index",d));let u=a.toString();s.search=u?`?${u}`:""}}return(!t||t===".")&&r.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(s.pathname=s.pathname==="/"?n:us([n,s.pathname])),lh(s)}function n9(t,{relative:e}={}){let n=P.useContext(kD);bt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=LD("useViewTransitionState"),r=Xh(t,{relative:e});if(!n.isTransitioning)return!1;let s=_s(n.currentLocation.pathname,i)||n.currentLocation.pathname,o=_s(n.nextLocation.pathname,i)||n.nextLocation.pathname;return Dm(r.pathname,o)!=null||Dm(r.pathname,s)!=null}/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UD=(...t)=>t.filter((e,n,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===n).join(" ").trim();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i9=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r9=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,i)=>i?i.toUpperCase():n.toLowerCase());/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ak=t=>{const e=r9(t);return e.charAt(0).toUpperCase()+e.slice(1)};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var s9={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o9=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0;return!1};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a9=P.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:r="",children:s,iconNode:o,...a},l)=>P.createElement("svg",{ref:l,...s9,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:UD("lucide",r),...!s&&!o9(a)&&{"aria-hidden":"true"},...a},[...o.map(([c,u])=>P.createElement(c,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qg=(t,e)=>{const n=P.forwardRef(({className:i,...r},s)=>P.createElement(a9,{ref:s,iconNode:e,className:UD(`lucide-${i9(Ak(t))}`,`lucide-${t}`,i),...r}));return n.displayName=Ak(t),n};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l9=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],c9=Qg("book-open",l9);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u9=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],d9=Qg("dollar-sign",u9);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h9=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],f9=Qg("layout-dashboard",h9);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p9=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],m9=Qg("trending-up",p9),g9=()=>{};var Ik={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VD={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z=function(t,e){if(!t)throw iu(e)},iu=function(t){return new Error("Firebase Database ("+VD.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FD=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):(r&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},v9=function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=t[n++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){const s=t[n++],o=t[n++],a=t[n++],l=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const s=t[n++],o=t[n++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},dS={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<t.length;r+=3){const s=t[r],o=r+1<t.length,a=o?t[r+1]:0,l=r+2<t.length,c=l?t[r+2]:0,u=s>>2,d=(s&3)<<4|a>>4;let f=(a&15)<<2|c>>6,p=c&63;l||(p=64,o||(f=64)),i.push(n[u],n[d],n[f],n[p])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(FD(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):v9(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<t.length;){const s=n[t.charAt(r++)],a=r<t.length?n[t.charAt(r)]:0;++r;const c=r<t.length?n[t.charAt(r)]:64;++r;const d=r<t.length?n[t.charAt(r)]:64;if(++r,s==null||a==null||c==null||d==null)throw new y9;const f=s<<2|a>>4;if(i.push(f),c!==64){const p=a<<4&240|c>>2;if(i.push(p),d!==64){const v=c<<6&192|d;i.push(v)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class y9 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const jD=function(t){const e=FD(t);return dS.encodeByteArray(e,!0)},Om=function(t){return jD(t).replace(/\./g,"")},V_=function(t){try{return dS.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _9(t){return BD(void 0,t)}function BD(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!b9(n)||(t[n]=BD(t[n],e[n]));return t}function b9(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T9(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S9=()=>T9().__FIREBASE_DEFAULTS__,E9=()=>{if(typeof process>"u"||typeof Ik>"u")return;const t=Ik.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},C9=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&V_(t[1]);return e&&JSON.parse(e)},hS=()=>{try{return g9()||S9()||E9()||C9()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},k9=t=>{var e,n;return(n=(e=hS())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},qD=t=>{const e=k9(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},zD=()=>{var t;return(t=hS())==null?void 0:t.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zh(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function HD(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GD(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},i=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Om(JSON.stringify(n)),Om(JSON.stringify(o)),""].join(".")}const Nd={};function w9(){const t={prod:[],emulator:[]};for(const e of Object.keys(Nd))Nd[e]?t.emulator.push(e):t.prod.push(e);return t}function R9(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Pk=!1;function KD(t,e){if(typeof window>"u"||typeof document>"u"||!Zh(window.location.host)||Nd[t]===e||Nd[t]||Pk)return;Nd[t]=e;function n(f){return`__firebase__banner__${f}`}const i="__firebase__banner",s=w9().prod.length>0;function o(){const f=document.getElementById(i);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,p){f.setAttribute("width","24"),f.setAttribute("id",p),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function c(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{Pk=!0,o()},f}function u(f,p){f.setAttribute("id",p),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function d(){const f=R9(i),p=n("text"),v=document.getElementById(p)||document.createElement("span"),g=n("learnmore"),E=document.getElementById(g)||document.createElement("a"),y=n("preprendIcon"),T=document.getElementById(y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const R=f.element;a(R),u(E,g);const b=c();l(T,y),R.append(T,v,E,b),document.body.appendChild(R)}s?(v.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,v.innerText="Preview backend running in this workspace."),v.setAttribute("id",p)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $D(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function WD(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test($D())}function A9(){var e;const t=(e=hS())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function I9(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function P9(){return VD.NODE_ADMIN===!0}function x9(){return!A9()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function D9(){try{return typeof indexedDB=="object"}catch{return!1}}function O9(){return new Promise((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var s;e(((s=r.error)==null?void 0:s.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N9="FirebaseError";class ru extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=N9,Object.setPrototypeOf(this,ru.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,QD.prototype.create)}}class QD{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){const i=n[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?M9(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new ru(r,a,i)}}function M9(t,e){return t.replace(L9,(n,i)=>{const r=e[i];return r!=null?String(r):`<${i}?>`})}const L9=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ch(t){return JSON.parse(t)}function fn(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YD=function(t){let e={},n={},i={},r="";try{const s=t.split(".");e=ch(V_(s[0])||""),n=ch(V_(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:i,signature:r}},U9=function(t){const e=YD(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},V9=function(t){const e=YD(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ps(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Dc(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function xk(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Nm(t,e,n){const i={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(i[r]=e.call(n,t[r],r,t));return i}function uh(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const s=t[r],o=e[r];if(Dk(s)&&Dk(o)){if(!uh(s,o))return!1}else if(s!==o)return!1}for(const r of i)if(!n.includes(r))return!1;return!0}function Dk(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F9(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j9{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const i=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)i[d]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let d=0;d<16;d++)i[d]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let d=16;d<80;d++){const f=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=(f<<1|f>>>31)&4294967295}let r=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,u;for(let d=0;d<80;d++){d<40?d<20?(c=a^s&(o^a),u=1518500249):(c=s^o^a,u=1859775393):d<60?(c=s&o|a&(s|o),u=2400959708):(c=s^o^a,u=3395469782);const f=(r<<5|r>>>27)+c+l+u+i[d]&4294967295;l=a,a=o,o=(s<<30|s>>>2)&4294967295,s=r,r=f}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const i=n-this.blockSize;let r=0;const s=this.buf_;let o=this.inbuf_;for(;r<n;){if(o===0)for(;r<=i;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<n;)if(s[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}else for(;r<n;)if(s[o]=e[r],++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=n&255,n/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[r]>>s&255,++i;return e}}function fS(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B9=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);if(r>=55296&&r<=56319){const s=r-55296;i++,Z(i<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(i)-56320;r=65536+(s<<10)+o}r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=r&63|128):r<65536?(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=r&63|128):(e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=r&63|128)}return e},Jg=function(t){let e=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(t){return t&&t._delegate?t._delegate:t}class Oc{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ga="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q9{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const i=new Yg;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:n});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(H9(e))try{this.getOrInitializeService({instanceIdentifier:ga})}catch{}for(const[n,i]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=ga){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ga){return this.instances.has(e)}getOptions(e=ga){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,n){const i=this.normalizeInstanceIdentifier(n),r=this.onInitCallbacks.get(i)??new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){const i=this.onInitCallbacks.get(n);if(i)for(const r of i)try{r(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:z9(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=ga){return this.component?this.component.multipleInstances?e:ga:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function z9(t){return t===ga?void 0:t}function H9(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G9{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new q9(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Le;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Le||(Le={}));const K9={debug:Le.DEBUG,verbose:Le.VERBOSE,info:Le.INFO,warn:Le.WARN,error:Le.ERROR,silent:Le.SILENT},$9=Le.INFO,W9={[Le.DEBUG]:"log",[Le.VERBOSE]:"log",[Le.INFO]:"info",[Le.WARN]:"warn",[Le.ERROR]:"error"},Q9=(t,e,...n)=>{if(e<t.logLevel)return;const i=new Date().toISOString(),r=W9[e];if(r)console[r](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class pS{constructor(e){this.name=e,this._logLevel=$9,this._logHandler=Q9,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Le))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?K9[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Le.DEBUG,...e),this._logHandler(this,Le.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Le.VERBOSE,...e),this._logHandler(this,Le.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Le.INFO,...e),this._logHandler(this,Le.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Le.WARN,...e),this._logHandler(this,Le.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Le.ERROR,...e),this._logHandler(this,Le.ERROR,...e)}}const Y9=(t,e)=>e.some(n=>t instanceof n);let Ok,Nk;function J9(){return Ok||(Ok=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function X9(){return Nk||(Nk=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const JD=new WeakMap,F_=new WeakMap,XD=new WeakMap,Hy=new WeakMap,mS=new WeakMap;function Z9(t){const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(bo(t.result)),r()},o=()=>{i(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&JD.set(n,t)}).catch(()=>{}),mS.set(e,t),e}function eF(t){if(F_.has(t))return;const e=new Promise((n,i)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),r()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});F_.set(t,e)}let j_={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return F_.get(t);if(e==="objectStoreNames")return t.objectStoreNames||XD.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return bo(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function tF(t){j_=t(j_)}function nF(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const i=t.call(Gy(this),e,...n);return XD.set(i,e.sort?e.sort():[e]),bo(i)}:X9().includes(t)?function(...e){return t.apply(Gy(this),e),bo(JD.get(this))}:function(...e){return bo(t.apply(Gy(this),e))}}function iF(t){return typeof t=="function"?nF(t):(t instanceof IDBTransaction&&eF(t),Y9(t,J9())?new Proxy(t,j_):t)}function bo(t){if(t instanceof IDBRequest)return Z9(t);if(Hy.has(t))return Hy.get(t);const e=iF(t);return e!==t&&(Hy.set(t,e),mS.set(e,t)),e}const Gy=t=>mS.get(t);function rF(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=bo(o);return i&&o.addEventListener("upgradeneeded",l=>{i(bo(o.result),l.oldVersion,l.newVersion,bo(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{s&&l.addEventListener("close",()=>s()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const sF=["get","getKey","getAll","getAllKeys","count"],oF=["put","add","delete","clear"],Ky=new Map;function Mk(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Ky.get(e))return Ky.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=oF.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||sF.includes(n)))return;const s=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),r&&l.done]))[0]};return Ky.set(e,s),s}tF(t=>({...t,get:(e,n,i)=>Mk(e,n)||t.get(e,n,i),has:(e,n)=>!!Mk(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aF{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(lF(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function lF(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const B_="@firebase/app",Lk="0.14.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bs=new pS("@firebase/app"),cF="@firebase/app-compat",uF="@firebase/analytics-compat",dF="@firebase/analytics",hF="@firebase/app-check-compat",fF="@firebase/app-check",pF="@firebase/auth",mF="@firebase/auth-compat",gF="@firebase/database",vF="@firebase/data-connect",yF="@firebase/database-compat",_F="@firebase/functions",bF="@firebase/functions-compat",TF="@firebase/installations",SF="@firebase/installations-compat",EF="@firebase/messaging",CF="@firebase/messaging-compat",kF="@firebase/performance",wF="@firebase/performance-compat",RF="@firebase/remote-config",AF="@firebase/remote-config-compat",IF="@firebase/storage",PF="@firebase/storage-compat",xF="@firebase/firestore",DF="@firebase/ai",OF="@firebase/firestore-compat",NF="firebase",MF="12.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q_="[DEFAULT]",LF={[B_]:"fire-core",[cF]:"fire-core-compat",[dF]:"fire-analytics",[uF]:"fire-analytics-compat",[fF]:"fire-app-check",[hF]:"fire-app-check-compat",[pF]:"fire-auth",[mF]:"fire-auth-compat",[gF]:"fire-rtdb",[vF]:"fire-data-connect",[yF]:"fire-rtdb-compat",[_F]:"fire-fn",[bF]:"fire-fn-compat",[TF]:"fire-iid",[SF]:"fire-iid-compat",[EF]:"fire-fcm",[CF]:"fire-fcm-compat",[kF]:"fire-perf",[wF]:"fire-perf-compat",[RF]:"fire-rc",[AF]:"fire-rc-compat",[IF]:"fire-gcs",[PF]:"fire-gcs-compat",[xF]:"fire-fst",[OF]:"fire-fst-compat",[DF]:"fire-vertex","fire-js":"fire-js",[NF]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mm=new Map,UF=new Map,z_=new Map;function Uk(t,e){try{t.container.addComponent(e)}catch(n){bs.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function dh(t){const e=t.name;if(z_.has(e))return bs.debug(`There were multiple attempts to register component ${e}.`),!1;z_.set(e,t);for(const n of Mm.values())Uk(n,t);for(const n of UF.values())Uk(n,t);return!0}function ZD(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function eO(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VF={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},To=new QD("app","Firebase",VF);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FF{constructor(e,n,i){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Oc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw To.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tO=MF;function nO(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const i={name:q_,automaticDataCollectionEnabled:!0,...e},r=i.name;if(typeof r!="string"||!r)throw To.create("bad-app-name",{appName:String(r)});if(n||(n=zD()),!n)throw To.create("no-options");const s=Mm.get(r);if(s){if(uh(n,s.options)&&uh(i,s.config))return s;throw To.create("duplicate-app",{appName:r})}const o=new G9(r);for(const l of z_.values())o.addComponent(l);const a=new FF(n,i,o);return Mm.set(r,a),a}function iO(t=q_){const e=Mm.get(t);if(!e&&t===q_&&zD())return nO();if(!e)throw To.create("no-app",{appName:t});return e}function So(t,e,n){let i=LF[t]??t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),s=e.match(/\s|\//);if(r||s){const o=[`Unable to register library "${i}" with version "${e}":`];r&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),bs.warn(o.join(" "));return}dh(new Oc(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jF="firebase-heartbeat-database",BF=1,hh="firebase-heartbeat-store";let $y=null;function rO(){return $y||($y=rF(jF,BF,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(hh)}catch(n){console.warn(n)}}}}).catch(t=>{throw To.create("idb-open",{originalErrorMessage:t.message})})),$y}async function qF(t){try{const n=(await rO()).transaction(hh),i=await n.objectStore(hh).get(sO(t));return await n.done,i}catch(e){if(e instanceof ru)bs.warn(e.message);else{const n=To.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});bs.warn(n.message)}}}async function Vk(t,e){try{const i=(await rO()).transaction(hh,"readwrite");await i.objectStore(hh).put(e,sO(t)),await i.done}catch(n){if(n instanceof ru)bs.warn(n.message);else{const i=To.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});bs.warn(i.message)}}}function sO(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zF=1024,HF=30;class GF{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new $F(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,n;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Fk();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats.length>HF){const o=WF(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){bs.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Fk(),{heartbeatsToSend:i,unsentEntries:r}=KF(this._heartbeatsCache.heartbeats),s=Om(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=n,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(n){return bs.warn(n),""}}}function Fk(){return new Date().toISOString().substring(0,10)}function KF(t,e=zF){const n=[];let i=t.slice();for(const r of t){const s=n.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),jk(n)>e){s.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),jk(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class $F{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return D9()?O9().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await qF(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Vk(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Vk(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function jk(t){return Om(JSON.stringify({version:2,heartbeats:t})).length}function WF(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QF(t){dh(new Oc("platform-logger",e=>new aF(e),"PRIVATE")),dh(new Oc("heartbeat",e=>new GF(e),"PRIVATE")),So(B_,Lk,t),So(B_,Lk,"esm2020"),So("fire-js","")}QF("");var Bk=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Eo,oO;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(C,k){function S(){}S.prototype=k.prototype,C.F=k.prototype,C.prototype=new S,C.prototype.constructor=C,C.D=function(A,I,N){for(var O=Array(arguments.length-2),he=2;he<arguments.length;he++)O[he-2]=arguments[he];return k.prototype[I].apply(A,O)}}function n(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,n),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function r(C,k,S){S||(S=0);const A=Array(16);if(typeof k=="string")for(var I=0;I<16;++I)A[I]=k.charCodeAt(S++)|k.charCodeAt(S++)<<8|k.charCodeAt(S++)<<16|k.charCodeAt(S++)<<24;else for(I=0;I<16;++I)A[I]=k[S++]|k[S++]<<8|k[S++]<<16|k[S++]<<24;k=C.g[0],S=C.g[1],I=C.g[2];let N=C.g[3],O;O=k+(N^S&(I^N))+A[0]+3614090360&4294967295,k=S+(O<<7&4294967295|O>>>25),O=N+(I^k&(S^I))+A[1]+3905402710&4294967295,N=k+(O<<12&4294967295|O>>>20),O=I+(S^N&(k^S))+A[2]+606105819&4294967295,I=N+(O<<17&4294967295|O>>>15),O=S+(k^I&(N^k))+A[3]+3250441966&4294967295,S=I+(O<<22&4294967295|O>>>10),O=k+(N^S&(I^N))+A[4]+4118548399&4294967295,k=S+(O<<7&4294967295|O>>>25),O=N+(I^k&(S^I))+A[5]+1200080426&4294967295,N=k+(O<<12&4294967295|O>>>20),O=I+(S^N&(k^S))+A[6]+2821735955&4294967295,I=N+(O<<17&4294967295|O>>>15),O=S+(k^I&(N^k))+A[7]+4249261313&4294967295,S=I+(O<<22&4294967295|O>>>10),O=k+(N^S&(I^N))+A[8]+1770035416&4294967295,k=S+(O<<7&4294967295|O>>>25),O=N+(I^k&(S^I))+A[9]+2336552879&4294967295,N=k+(O<<12&4294967295|O>>>20),O=I+(S^N&(k^S))+A[10]+4294925233&4294967295,I=N+(O<<17&4294967295|O>>>15),O=S+(k^I&(N^k))+A[11]+2304563134&4294967295,S=I+(O<<22&4294967295|O>>>10),O=k+(N^S&(I^N))+A[12]+1804603682&4294967295,k=S+(O<<7&4294967295|O>>>25),O=N+(I^k&(S^I))+A[13]+4254626195&4294967295,N=k+(O<<12&4294967295|O>>>20),O=I+(S^N&(k^S))+A[14]+2792965006&4294967295,I=N+(O<<17&4294967295|O>>>15),O=S+(k^I&(N^k))+A[15]+1236535329&4294967295,S=I+(O<<22&4294967295|O>>>10),O=k+(I^N&(S^I))+A[1]+4129170786&4294967295,k=S+(O<<5&4294967295|O>>>27),O=N+(S^I&(k^S))+A[6]+3225465664&4294967295,N=k+(O<<9&4294967295|O>>>23),O=I+(k^S&(N^k))+A[11]+643717713&4294967295,I=N+(O<<14&4294967295|O>>>18),O=S+(N^k&(I^N))+A[0]+3921069994&4294967295,S=I+(O<<20&4294967295|O>>>12),O=k+(I^N&(S^I))+A[5]+3593408605&4294967295,k=S+(O<<5&4294967295|O>>>27),O=N+(S^I&(k^S))+A[10]+38016083&4294967295,N=k+(O<<9&4294967295|O>>>23),O=I+(k^S&(N^k))+A[15]+3634488961&4294967295,I=N+(O<<14&4294967295|O>>>18),O=S+(N^k&(I^N))+A[4]+3889429448&4294967295,S=I+(O<<20&4294967295|O>>>12),O=k+(I^N&(S^I))+A[9]+568446438&4294967295,k=S+(O<<5&4294967295|O>>>27),O=N+(S^I&(k^S))+A[14]+3275163606&4294967295,N=k+(O<<9&4294967295|O>>>23),O=I+(k^S&(N^k))+A[3]+4107603335&4294967295,I=N+(O<<14&4294967295|O>>>18),O=S+(N^k&(I^N))+A[8]+1163531501&4294967295,S=I+(O<<20&4294967295|O>>>12),O=k+(I^N&(S^I))+A[13]+2850285829&4294967295,k=S+(O<<5&4294967295|O>>>27),O=N+(S^I&(k^S))+A[2]+4243563512&4294967295,N=k+(O<<9&4294967295|O>>>23),O=I+(k^S&(N^k))+A[7]+1735328473&4294967295,I=N+(O<<14&4294967295|O>>>18),O=S+(N^k&(I^N))+A[12]+2368359562&4294967295,S=I+(O<<20&4294967295|O>>>12),O=k+(S^I^N)+A[5]+4294588738&4294967295,k=S+(O<<4&4294967295|O>>>28),O=N+(k^S^I)+A[8]+2272392833&4294967295,N=k+(O<<11&4294967295|O>>>21),O=I+(N^k^S)+A[11]+1839030562&4294967295,I=N+(O<<16&4294967295|O>>>16),O=S+(I^N^k)+A[14]+4259657740&4294967295,S=I+(O<<23&4294967295|O>>>9),O=k+(S^I^N)+A[1]+2763975236&4294967295,k=S+(O<<4&4294967295|O>>>28),O=N+(k^S^I)+A[4]+1272893353&4294967295,N=k+(O<<11&4294967295|O>>>21),O=I+(N^k^S)+A[7]+4139469664&4294967295,I=N+(O<<16&4294967295|O>>>16),O=S+(I^N^k)+A[10]+3200236656&4294967295,S=I+(O<<23&4294967295|O>>>9),O=k+(S^I^N)+A[13]+681279174&4294967295,k=S+(O<<4&4294967295|O>>>28),O=N+(k^S^I)+A[0]+3936430074&4294967295,N=k+(O<<11&4294967295|O>>>21),O=I+(N^k^S)+A[3]+3572445317&4294967295,I=N+(O<<16&4294967295|O>>>16),O=S+(I^N^k)+A[6]+76029189&4294967295,S=I+(O<<23&4294967295|O>>>9),O=k+(S^I^N)+A[9]+3654602809&4294967295,k=S+(O<<4&4294967295|O>>>28),O=N+(k^S^I)+A[12]+3873151461&4294967295,N=k+(O<<11&4294967295|O>>>21),O=I+(N^k^S)+A[15]+530742520&4294967295,I=N+(O<<16&4294967295|O>>>16),O=S+(I^N^k)+A[2]+3299628645&4294967295,S=I+(O<<23&4294967295|O>>>9),O=k+(I^(S|~N))+A[0]+4096336452&4294967295,k=S+(O<<6&4294967295|O>>>26),O=N+(S^(k|~I))+A[7]+1126891415&4294967295,N=k+(O<<10&4294967295|O>>>22),O=I+(k^(N|~S))+A[14]+2878612391&4294967295,I=N+(O<<15&4294967295|O>>>17),O=S+(N^(I|~k))+A[5]+4237533241&4294967295,S=I+(O<<21&4294967295|O>>>11),O=k+(I^(S|~N))+A[12]+1700485571&4294967295,k=S+(O<<6&4294967295|O>>>26),O=N+(S^(k|~I))+A[3]+2399980690&4294967295,N=k+(O<<10&4294967295|O>>>22),O=I+(k^(N|~S))+A[10]+4293915773&4294967295,I=N+(O<<15&4294967295|O>>>17),O=S+(N^(I|~k))+A[1]+2240044497&4294967295,S=I+(O<<21&4294967295|O>>>11),O=k+(I^(S|~N))+A[8]+1873313359&4294967295,k=S+(O<<6&4294967295|O>>>26),O=N+(S^(k|~I))+A[15]+4264355552&4294967295,N=k+(O<<10&4294967295|O>>>22),O=I+(k^(N|~S))+A[6]+2734768916&4294967295,I=N+(O<<15&4294967295|O>>>17),O=S+(N^(I|~k))+A[13]+1309151649&4294967295,S=I+(O<<21&4294967295|O>>>11),O=k+(I^(S|~N))+A[4]+4149444226&4294967295,k=S+(O<<6&4294967295|O>>>26),O=N+(S^(k|~I))+A[11]+3174756917&4294967295,N=k+(O<<10&4294967295|O>>>22),O=I+(k^(N|~S))+A[2]+718787259&4294967295,I=N+(O<<15&4294967295|O>>>17),O=S+(N^(I|~k))+A[9]+3951481745&4294967295,C.g[0]=C.g[0]+k&4294967295,C.g[1]=C.g[1]+(I+(O<<21&4294967295|O>>>11))&4294967295,C.g[2]=C.g[2]+I&4294967295,C.g[3]=C.g[3]+N&4294967295}i.prototype.v=function(C,k){k===void 0&&(k=C.length);const S=k-this.blockSize,A=this.C;let I=this.h,N=0;for(;N<k;){if(I==0)for(;N<=S;)r(this,C,N),N+=this.blockSize;if(typeof C=="string"){for(;N<k;)if(A[I++]=C.charCodeAt(N++),I==this.blockSize){r(this,A),I=0;break}}else for(;N<k;)if(A[I++]=C[N++],I==this.blockSize){r(this,A),I=0;break}}this.h=I,this.o+=k},i.prototype.A=function(){var C=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);C[0]=128;for(var k=1;k<C.length-8;++k)C[k]=0;k=this.o*8;for(var S=C.length-8;S<C.length;++S)C[S]=k&255,k/=256;for(this.v(C),C=Array(16),k=0,S=0;S<4;++S)for(let A=0;A<32;A+=8)C[k++]=this.g[S]>>>A&255;return C};function s(C,k){var S=a;return Object.prototype.hasOwnProperty.call(S,C)?S[C]:S[C]=k(C)}function o(C,k){this.h=k;const S=[];let A=!0;for(let I=C.length-1;I>=0;I--){const N=C[I]|0;A&&N==k||(S[I]=N,A=!1)}this.g=S}var a={};function l(C){return-128<=C&&C<128?s(C,function(k){return new o([k|0],k<0?-1:0)}):new o([C|0],C<0?-1:0)}function c(C){if(isNaN(C)||!isFinite(C))return d;if(C<0)return E(c(-C));const k=[];let S=1;for(let A=0;C>=S;A++)k[A]=C/S|0,S*=4294967296;return new o(k,0)}function u(C,k){if(C.length==0)throw Error("number format error: empty string");if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(C.charAt(0)=="-")return E(u(C.substring(1),k));if(C.indexOf("-")>=0)throw Error('number format error: interior "-" character');const S=c(Math.pow(k,8));let A=d;for(let N=0;N<C.length;N+=8){var I=Math.min(8,C.length-N);const O=parseInt(C.substring(N,N+I),k);I<8?(I=c(Math.pow(k,I)),A=A.j(I).add(c(O))):(A=A.j(S),A=A.add(c(O)))}return A}var d=l(0),f=l(1),p=l(16777216);t=o.prototype,t.m=function(){if(g(this))return-E(this).m();let C=0,k=1;for(let S=0;S<this.g.length;S++){const A=this.i(S);C+=(A>=0?A:4294967296+A)*k,k*=4294967296}return C},t.toString=function(C){if(C=C||10,C<2||36<C)throw Error("radix out of range: "+C);if(v(this))return"0";if(g(this))return"-"+E(this).toString(C);const k=c(Math.pow(C,6));var S=this;let A="";for(;;){const I=b(S,k).g;S=y(S,I.j(k));let N=((S.g.length>0?S.g[0]:S.h)>>>0).toString(C);if(S=I,v(S))return N+A;for(;N.length<6;)N="0"+N;A=N+A}},t.i=function(C){return C<0?0:C<this.g.length?this.g[C]:this.h};function v(C){if(C.h!=0)return!1;for(let k=0;k<C.g.length;k++)if(C.g[k]!=0)return!1;return!0}function g(C){return C.h==-1}t.l=function(C){return C=y(this,C),g(C)?-1:v(C)?0:1};function E(C){const k=C.g.length,S=[];for(let A=0;A<k;A++)S[A]=~C.g[A];return new o(S,~C.h).add(f)}t.abs=function(){return g(this)?E(this):this},t.add=function(C){const k=Math.max(this.g.length,C.g.length),S=[];let A=0;for(let I=0;I<=k;I++){let N=A+(this.i(I)&65535)+(C.i(I)&65535),O=(N>>>16)+(this.i(I)>>>16)+(C.i(I)>>>16);A=O>>>16,N&=65535,O&=65535,S[I]=O<<16|N}return new o(S,S[S.length-1]&-2147483648?-1:0)};function y(C,k){return C.add(E(k))}t.j=function(C){if(v(this)||v(C))return d;if(g(this))return g(C)?E(this).j(E(C)):E(E(this).j(C));if(g(C))return E(this.j(E(C)));if(this.l(p)<0&&C.l(p)<0)return c(this.m()*C.m());const k=this.g.length+C.g.length,S=[];for(var A=0;A<2*k;A++)S[A]=0;for(A=0;A<this.g.length;A++)for(let I=0;I<C.g.length;I++){const N=this.i(A)>>>16,O=this.i(A)&65535,he=C.i(I)>>>16,Ye=C.i(I)&65535;S[2*A+2*I]+=O*Ye,T(S,2*A+2*I),S[2*A+2*I+1]+=N*Ye,T(S,2*A+2*I+1),S[2*A+2*I+1]+=O*he,T(S,2*A+2*I+1),S[2*A+2*I+2]+=N*he,T(S,2*A+2*I+2)}for(C=0;C<k;C++)S[C]=S[2*C+1]<<16|S[2*C];for(C=k;C<2*k;C++)S[C]=0;return new o(S,0)};function T(C,k){for(;(C[k]&65535)!=C[k];)C[k+1]+=C[k]>>>16,C[k]&=65535,k++}function R(C,k){this.g=C,this.h=k}function b(C,k){if(v(k))throw Error("division by zero");if(v(C))return new R(d,d);if(g(C))return k=b(E(C),k),new R(E(k.g),E(k.h));if(g(k))return k=b(C,E(k)),new R(E(k.g),k.h);if(C.g.length>30){if(g(C)||g(k))throw Error("slowDivide_ only works with positive integers.");for(var S=f,A=k;A.l(C)<=0;)S=w(S),A=w(A);var I=D(S,1),N=D(A,1);for(A=D(A,2),S=D(S,2);!v(A);){var O=N.add(A);O.l(C)<=0&&(I=I.add(S),N=O),A=D(A,1),S=D(S,1)}return k=y(C,I.j(k)),new R(I,k)}for(I=d;C.l(k)>=0;){for(S=Math.max(1,Math.floor(C.m()/k.m())),A=Math.ceil(Math.log(S)/Math.LN2),A=A<=48?1:Math.pow(2,A-48),N=c(S),O=N.j(k);g(O)||O.l(C)>0;)S-=A,N=c(S),O=N.j(k);v(N)&&(N=f),I=I.add(N),C=y(C,O)}return new R(I,C)}t.B=function(C){return b(this,C).h},t.and=function(C){const k=Math.max(this.g.length,C.g.length),S=[];for(let A=0;A<k;A++)S[A]=this.i(A)&C.i(A);return new o(S,this.h&C.h)},t.or=function(C){const k=Math.max(this.g.length,C.g.length),S=[];for(let A=0;A<k;A++)S[A]=this.i(A)|C.i(A);return new o(S,this.h|C.h)},t.xor=function(C){const k=Math.max(this.g.length,C.g.length),S=[];for(let A=0;A<k;A++)S[A]=this.i(A)^C.i(A);return new o(S,this.h^C.h)};function w(C){const k=C.g.length+1,S=[];for(let A=0;A<k;A++)S[A]=C.i(A)<<1|C.i(A-1)>>>31;return new o(S,C.h)}function D(C,k){const S=k>>5;k%=32;const A=C.g.length-S,I=[];for(let N=0;N<A;N++)I[N]=k>0?C.i(N+S)>>>k|C.i(N+S+1)<<32-k:C.i(N+S);return new o(I,C.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,oO=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,Eo=o}).apply(typeof Bk<"u"?Bk:typeof self<"u"?self:typeof window<"u"?window:{});var ep=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var aO,fd,lO,Np,H_,cO,uO,dO;(function(){var t,e=Object.defineProperty;function n(h){h=[typeof globalThis=="object"&&globalThis,h,typeof window=="object"&&window,typeof self=="object"&&self,typeof ep=="object"&&ep];for(var m=0;m<h.length;++m){var _=h[m];if(_&&_.Math==Math)return _}throw Error("Cannot find global object")}var i=n(this);function r(h,m){if(m)e:{var _=i;h=h.split(".");for(var x=0;x<h.length-1;x++){var V=h[x];if(!(V in _))break e;_=_[V]}h=h[h.length-1],x=_[h],m=m(x),m!=x&&m!=null&&e(_,h,{configurable:!0,writable:!0,value:m})}}r("Symbol.dispose",function(h){return h||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(h){return h||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(h){return h||function(m){var _=[],x;for(x in m)Object.prototype.hasOwnProperty.call(m,x)&&_.push([x,m[x]]);return _}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var s=s||{},o=this||self;function a(h){var m=typeof h;return m=="object"&&h!=null||m=="function"}function l(h,m,_){return h.call.apply(h.bind,arguments)}function c(h,m,_){return c=l,c.apply(null,arguments)}function u(h,m){var _=Array.prototype.slice.call(arguments,1);return function(){var x=_.slice();return x.push.apply(x,arguments),h.apply(this,x)}}function d(h,m){function _(){}_.prototype=m.prototype,h.Z=m.prototype,h.prototype=new _,h.prototype.constructor=h,h.Ob=function(x,V,q){for(var ee=Array(arguments.length-2),Ce=2;Ce<arguments.length;Ce++)ee[Ce-2]=arguments[Ce];return m.prototype[V].apply(x,ee)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?h=>h&&AsyncContext.Snapshot.wrap(h):h=>h;function p(h){const m=h.length;if(m>0){const _=Array(m);for(let x=0;x<m;x++)_[x]=h[x];return _}return[]}function v(h,m){for(let x=1;x<arguments.length;x++){const V=arguments[x];var _=typeof V;if(_=_!="object"?_:V?Array.isArray(V)?"array":_:"null",_=="array"||_=="object"&&typeof V.length=="number"){_=h.length||0;const q=V.length||0;h.length=_+q;for(let ee=0;ee<q;ee++)h[_+ee]=V[ee]}else h.push(V)}}class g{constructor(m,_){this.i=m,this.j=_,this.h=0,this.g=null}get(){let m;return this.h>0?(this.h--,m=this.g,this.g=m.next,m.next=null):m=this.i(),m}}function E(h){o.setTimeout(()=>{throw h},0)}function y(){var h=C;let m=null;return h.g&&(m=h.g,h.g=h.g.next,h.g||(h.h=null),m.next=null),m}class T{constructor(){this.h=this.g=null}add(m,_){const x=R.get();x.set(m,_),this.h?this.h.next=x:this.g=x,this.h=x}}var R=new g(()=>new b,h=>h.reset());class b{constructor(){this.next=this.g=this.h=null}set(m,_){this.h=m,this.g=_,this.next=null}reset(){this.next=this.g=this.h=null}}let w,D=!1,C=new T,k=()=>{const h=Promise.resolve(void 0);w=()=>{h.then(S)}};function S(){for(var h;h=y();){try{h.h.call(h.g)}catch(_){E(_)}var m=R;m.j(h),m.h<100&&(m.h++,h.next=m.g,m.g=h)}D=!1}function A(){this.u=this.u,this.C=this.C}A.prototype.u=!1,A.prototype.dispose=function(){this.u||(this.u=!0,this.N())},A.prototype[Symbol.dispose]=function(){this.dispose()},A.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function I(h,m){this.type=h,this.g=this.target=m,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var N=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var h=!1,m=Object.defineProperty({},"passive",{get:function(){h=!0}});try{const _=()=>{};o.addEventListener("test",_,m),o.removeEventListener("test",_,m)}catch{}return h}();function O(h){return/^[\s\xa0]*$/.test(h)}function he(h,m){I.call(this,h?h.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,h&&this.init(h,m)}d(he,I),he.prototype.init=function(h,m){const _=this.type=h.type,x=h.changedTouches&&h.changedTouches.length?h.changedTouches[0]:null;this.target=h.target||h.srcElement,this.g=m,m=h.relatedTarget,m||(_=="mouseover"?m=h.fromElement:_=="mouseout"&&(m=h.toElement)),this.relatedTarget=m,x?(this.clientX=x.clientX!==void 0?x.clientX:x.pageX,this.clientY=x.clientY!==void 0?x.clientY:x.pageY,this.screenX=x.screenX||0,this.screenY=x.screenY||0):(this.clientX=h.clientX!==void 0?h.clientX:h.pageX,this.clientY=h.clientY!==void 0?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0),this.button=h.button,this.key=h.key||"",this.ctrlKey=h.ctrlKey,this.altKey=h.altKey,this.shiftKey=h.shiftKey,this.metaKey=h.metaKey,this.pointerId=h.pointerId||0,this.pointerType=h.pointerType,this.state=h.state,this.i=h,h.defaultPrevented&&he.Z.h.call(this)},he.prototype.h=function(){he.Z.h.call(this);const h=this.i;h.preventDefault?h.preventDefault():h.returnValue=!1};var Ye="closure_listenable_"+(Math.random()*1e6|0),J=0;function re(h,m,_,x,V){this.listener=h,this.proxy=null,this.src=m,this.type=_,this.capture=!!x,this.ha=V,this.key=++J,this.da=this.fa=!1}function se(h){h.da=!0,h.listener=null,h.proxy=null,h.src=null,h.ha=null}function be(h,m,_){for(const x in h)m.call(_,h[x],x,h)}function ze(h,m){for(const _ in h)m.call(void 0,h[_],_,h)}function xn(h){const m={};for(const _ in h)m[_]=h[_];return m}const Zt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function gn(h,m){let _,x;for(let V=1;V<arguments.length;V++){x=arguments[V];for(_ in x)h[_]=x[_];for(let q=0;q<Zt.length;q++)_=Zt[q],Object.prototype.hasOwnProperty.call(x,_)&&(h[_]=x[_])}}function en(h){this.src=h,this.g={},this.h=0}en.prototype.add=function(h,m,_,x,V){const q=h.toString();h=this.g[q],h||(h=this.g[q]=[],this.h++);const ee=di(h,m,x,V);return ee>-1?(m=h[ee],_||(m.fa=!1)):(m=new re(m,this.src,q,!!x,V),m.fa=_,h.push(m)),m};function Dn(h,m){const _=m.type;if(_ in h.g){var x=h.g[_],V=Array.prototype.indexOf.call(x,m,void 0),q;(q=V>=0)&&Array.prototype.splice.call(x,V,1),q&&(se(m),h.g[_].length==0&&(delete h.g[_],h.h--))}}function di(h,m,_,x){for(let V=0;V<h.length;++V){const q=h[V];if(!q.da&&q.listener==m&&q.capture==!!_&&q.ha==x)return V}return-1}var Ze="closure_lm_"+(Math.random()*1e6|0),Qn={};function $i(h,m,_,x,V){if(Array.isArray(m)){for(let q=0;q<m.length;q++)$i(h,m[q],_,x,V);return null}return _=yu(_),h&&h[Ye]?h.J(m,_,a(x)?!!x.capture:!1,V):ml(h,m,_,!1,x,V)}function ml(h,m,_,x,V,q){if(!m)throw Error("Invalid event type");const ee=a(V)?!!V.capture:!!V;let Ce=gu(h);if(Ce||(h[Ze]=Ce=new en(h)),_=Ce.add(m,_,x,ee,q),_.proxy)return _;if(x=Hv(),_.proxy=x,x.src=h,x.listener=_,h.addEventListener)N||(V=ee),V===void 0&&(V=!1),h.addEventListener(m.toString(),x,V);else if(h.attachEvent)h.attachEvent(mf(m.toString()),x);else if(h.addListener&&h.removeListener)h.addListener(x);else throw Error("addEventListener and attachEvent are unavailable.");return _}function Hv(){function h(_){return m.call(h.src,h.listener,_)}const m=gf;return h}function pf(h,m,_,x,V){if(Array.isArray(m))for(var q=0;q<m.length;q++)pf(h,m[q],_,x,V);else x=a(x)?!!x.capture:!!x,_=yu(_),h&&h[Ye]?(h=h.i,q=String(m).toString(),q in h.g&&(m=h.g[q],_=di(m,_,x,V),_>-1&&(se(m[_]),Array.prototype.splice.call(m,_,1),m.length==0&&(delete h.g[q],h.h--)))):h&&(h=gu(h))&&(m=h.g[m.toString()],h=-1,m&&(h=di(m,_,x,V)),(_=h>-1?m[h]:null)&&mu(_))}function mu(h){if(typeof h!="number"&&h&&!h.da){var m=h.src;if(m&&m[Ye])Dn(m.i,h);else{var _=h.type,x=h.proxy;m.removeEventListener?m.removeEventListener(_,x,h.capture):m.detachEvent?m.detachEvent(mf(_),x):m.addListener&&m.removeListener&&m.removeListener(x),(_=gu(m))?(Dn(_,h),_.h==0&&(_.src=null,m[Ze]=null)):se(h)}}}function mf(h){return h in Qn?Qn[h]:Qn[h]="on"+h}function gf(h,m){if(h.da)h=!0;else{m=new he(m,this);const _=h.listener,x=h.ha||h.src;h.fa&&mu(h),h=_.call(x,m)}return h}function gu(h){return h=h[Ze],h instanceof en?h:null}var vu="__closure_events_fn_"+(Math.random()*1e9>>>0);function yu(h){return typeof h=="function"?h:(h[vu]||(h[vu]=function(m){return h.handleEvent(m)}),h[vu])}function tn(){A.call(this),this.i=new en(this),this.M=this,this.G=null}d(tn,A),tn.prototype[Ye]=!0,tn.prototype.removeEventListener=function(h,m,_,x){pf(this,h,m,_,x)};function vn(h,m){var _,x=h.G;if(x)for(_=[];x;x=x.G)_.push(x);if(h=h.M,x=m.type||m,typeof m=="string")m=new I(m,h);else if(m instanceof I)m.target=m.target||h;else{var V=m;m=new I(x,h),gn(m,V)}V=!0;let q,ee;if(_)for(ee=_.length-1;ee>=0;ee--)q=m.g=_[ee],V=gl(q,x,!0,m)&&V;if(q=m.g=h,V=gl(q,x,!0,m)&&V,V=gl(q,x,!1,m)&&V,_)for(ee=0;ee<_.length;ee++)q=m.g=_[ee],V=gl(q,x,!1,m)&&V}tn.prototype.N=function(){if(tn.Z.N.call(this),this.i){var h=this.i;for(const m in h.g){const _=h.g[m];for(let x=0;x<_.length;x++)se(_[x]);delete h.g[m],h.h--}}this.G=null},tn.prototype.J=function(h,m,_,x){return this.i.add(String(h),m,!1,_,x)},tn.prototype.K=function(h,m,_,x){return this.i.add(String(h),m,!0,_,x)};function gl(h,m,_,x){if(m=h.i.g[String(m)],!m)return!0;m=m.concat();let V=!0;for(let q=0;q<m.length;++q){const ee=m[q];if(ee&&!ee.da&&ee.capture==_){const Ce=ee.listener,Ht=ee.ha||ee.src;ee.fa&&Dn(h.i,ee),V=Ce.call(Ht,x)!==!1&&V}}return V&&!x.defaultPrevented}function Gv(h,m){if(typeof h!="function")if(h&&typeof h.handleEvent=="function")h=c(h.handleEvent,h);else throw Error("Invalid listener argument");return Number(m)>2147483647?-1:o.setTimeout(h,m||0)}function _u(h){h.g=Gv(()=>{h.g=null,h.i&&(h.i=!1,_u(h))},h.l);const m=h.h;h.h=null,h.m.apply(null,m)}class Kv extends A{constructor(m,_){super(),this.m=m,this.l=_,this.h=null,this.i=!1,this.g=null}j(m){this.h=arguments,this.g?this.i=!0:_u(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ta(h){A.call(this),this.h=h,this.g={}}d(ta,A);var vf=[];function bu(h){be(h.g,function(m,_){this.g.hasOwnProperty(_)&&mu(m)},h),h.g={}}ta.prototype.N=function(){ta.Z.N.call(this),bu(this)},ta.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Tu=o.JSON.stringify,$v=o.JSON.parse,Wv=class{stringify(h){return o.JSON.stringify(h,void 0)}parse(h){return o.JSON.parse(h,void 0)}};function yf(){}function _f(){}var na={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Su(){I.call(this,"d")}d(Su,I);function Eu(){I.call(this,"c")}d(Eu,I);var jr={},Cu=null;function vl(){return Cu=Cu||new tn}jr.Ia="serverreachability";function bf(h){I.call(this,jr.Ia,h)}d(bf,I);function ia(h){const m=vl();vn(m,new bf(m))}jr.STAT_EVENT="statevent";function Tf(h,m){I.call(this,jr.STAT_EVENT,h),this.stat=m}d(Tf,I);function yn(h){const m=vl();vn(m,new Tf(m,h))}jr.Ja="timingevent";function Sf(h,m){I.call(this,jr.Ja,h),this.size=m}d(Sf,I);function ra(h,m){if(typeof h!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){h()},m)}function sa(){this.g=!0}sa.prototype.ua=function(){this.g=!1};function Qv(h,m,_,x,V,q){h.info(function(){if(h.g)if(q){var ee="",Ce=q.split("&");for(let it=0;it<Ce.length;it++){var Ht=Ce[it].split("=");if(Ht.length>1){const rn=Ht[0];Ht=Ht[1];const mr=rn.split("_");ee=mr.length>=2&&mr[1]=="type"?ee+(rn+"="+Ht+"&"):ee+(rn+"=redacted&")}}}else ee=null;else ee=q;return"XMLHTTP REQ ("+x+") [attempt "+V+"]: "+m+`
`+_+`
`+ee})}function Yv(h,m,_,x,V,q,ee){h.info(function(){return"XMLHTTP RESP ("+x+") [ attempt "+V+"]: "+m+`
`+_+`
`+q+" "+ee})}function Ds(h,m,_,x){h.info(function(){return"XMLHTTP TEXT ("+m+"): "+Os(h,_)+(x?" "+x:"")})}function z(h,m){h.info(function(){return"TIMEOUT: "+m})}sa.prototype.info=function(){};function Os(h,m){if(!h.g)return m;if(!m)return null;try{const q=JSON.parse(m);if(q){for(h=0;h<q.length;h++)if(Array.isArray(q[h])){var _=q[h];if(!(_.length<2)){var x=_[1];if(Array.isArray(x)&&!(x.length<1)){var V=x[0];if(V!="noop"&&V!="stop"&&V!="close")for(let ee=1;ee<x.length;ee++)x[ee]=""}}}}return Tu(q)}catch{return m}}var On={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},oa={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},ne;function Br(){}d(Br,yf),Br.prototype.g=function(){return new XMLHttpRequest},ne=new Br;function gt(h){return encodeURIComponent(String(h))}function Ai(h){var m=1;h=h.split(":");const _=[];for(;m>0&&h.length;)_.push(h.shift()),m--;return h.length&&_.push(h.join(":")),_}function fr(h,m,_,x){this.j=h,this.i=m,this.l=_,this.S=x||1,this.V=new ta(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new jn}function jn(){this.i=null,this.g="",this.h=!1}var ku={},yl={};function le(h,m,_){h.M=1,h.A=qr(j(m)),h.u=_,h.R=!0,Ef(h,null)}function Ef(h,m){h.F=Date.now(),_l(h),h.B=j(h.A);var _=h.B,x=h.S;Array.isArray(x)||(x=[String(x)]),wC(_.i,"t",x),h.C=0,_=h.j.L,h.h=new jn,h.g=HC(h.j,_?m:null,!h.u),h.P>0&&(h.O=new Kv(c(h.Y,h,h.g),h.P)),m=h.V,_=h.g,x=h.ba;var V="readystatechange";Array.isArray(V)||(V&&(vf[0]=V.toString()),V=vf);for(let q=0;q<V.length;q++){const ee=$i(_,V[q],x||m.handleEvent,!1,m.h||m);if(!ee)break;m.g[ee.key]=ee}m=h.J?xn(h.J):{},h.u?(h.v||(h.v="POST"),m["Content-Type"]="application/x-www-form-urlencoded",h.g.ea(h.B,h.v,h.u,m)):(h.v="GET",h.g.ea(h.B,h.v,null,m)),ia(),Qv(h.i,h.v,h.B,h.l,h.S,h.u)}fr.prototype.ba=function(h){h=h.target;const m=this.O;m&&Ls(h)==3?m.j():this.Y(h)},fr.prototype.Y=function(h){try{if(h==this.g)e:{const Ce=Ls(this.g),Ht=this.g.ya(),it=this.g.ca();if(!(Ce<3)&&(Ce!=3||this.g&&(this.h.h||this.g.la()||OC(this.g)))){this.K||Ce!=4||Ht==7||(Ht==8||it<=0?ia(3):ia(2)),wu(this);var m=this.g.ca();this.X=m;var _=Cf(this);if(this.o=m==200,Yv(this.i,this.v,this.B,this.l,this.S,Ce,m),this.o){if(this.U&&!this.L){t:{if(this.g){var x,V=this.g;if((x=V.g?V.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!O(x)){var q=x;break t}}q=null}if(h=q)Ds(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ru(this,h);else{this.o=!1,this.m=3,yn(12),pr(this),Ns(this);break e}}if(this.R){h=!0;let rn;for(;!this.K&&this.C<_.length;)if(rn=wf(this,_),rn==yl){Ce==4&&(this.m=4,yn(14),h=!1),Ds(this.i,this.l,null,"[Incomplete Response]");break}else if(rn==ku){this.m=4,yn(15),Ds(this.i,this.l,_,"[Invalid Chunk]"),h=!1;break}else Ds(this.i,this.l,rn,null),Ru(this,rn);if(kf(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ce!=4||_.length!=0||this.h.h||(this.m=1,yn(16),h=!1),this.o=this.o&&h,!h)Ds(this.i,this.l,_,"[Invalid Chunked Response]"),pr(this),Ns(this);else if(_.length>0&&!this.W){this.W=!0;var ee=this.j;ee.g==this&&ee.aa&&!ee.P&&(ee.j.info("Great, no buffering proxy detected. Bytes received: "+_.length),ny(ee),ee.P=!0,yn(11))}}else Ds(this.i,this.l,_,null),Ru(this,_);Ce==4&&pr(this),this.o&&!this.K&&(Ce==4?jC(this.j,this):(this.o=!1,_l(this)))}else C4(this.g),m==400&&_.indexOf("Unknown SID")>0?(this.m=3,yn(12)):(this.m=0,yn(13)),pr(this),Ns(this)}}}catch{}finally{}};function Cf(h){if(!kf(h))return h.g.la();const m=OC(h.g);if(m==="")return"";let _="";const x=m.length,V=Ls(h.g)==4;if(!h.h.i){if(typeof TextDecoder>"u")return pr(h),Ns(h),"";h.h.i=new o.TextDecoder}for(let q=0;q<x;q++)h.h.h=!0,_+=h.h.i.decode(m[q],{stream:!(V&&q==x-1)});return m.length=0,h.h.g+=_,h.C=0,h.h.g}function kf(h){return h.g?h.v=="GET"&&h.M!=2&&h.j.Aa:!1}function wf(h,m){var _=h.C,x=m.indexOf(`
`,_);return x==-1?yl:(_=Number(m.substring(_,x)),isNaN(_)?ku:(x+=1,x+_>m.length?yl:(m=m.slice(x,x+_),h.C=x+_,m)))}fr.prototype.cancel=function(){this.K=!0,pr(this)};function _l(h){h.T=Date.now()+h.H,Rf(h,h.H)}function Rf(h,m){if(h.D!=null)throw Error("WatchDog timer not null");h.D=ra(c(h.aa,h),m)}function wu(h){h.D&&(o.clearTimeout(h.D),h.D=null)}fr.prototype.aa=function(){this.D=null;const h=Date.now();h-this.T>=0?(z(this.i,this.B),this.M!=2&&(ia(),yn(17)),pr(this),this.m=2,Ns(this)):Rf(this,this.T-h)};function Ns(h){h.j.I==0||h.K||jC(h.j,h)}function pr(h){wu(h);var m=h.O;m&&typeof m.dispose=="function"&&m.dispose(),h.O=null,bu(h.V),h.g&&(m=h.g,h.g=null,m.abort(),m.dispose())}function Ru(h,m){try{var _=h.j;if(_.I!=0&&(_.g==h||Iu(_.h,h))){if(!h.L&&Iu(_.h,h)&&_.I==3){try{var x=_.Ba.g.parse(m)}catch{x=null}if(Array.isArray(x)&&x.length==3){var V=x;if(V[0]==0){e:if(!_.v){if(_.g)if(_.g.F+3e3<h.F)Nf(_),Df(_);else break e;ty(_),yn(18)}}else _.xa=V[1],0<_.xa-_.K&&V[2]<37500&&_.F&&_.A==0&&!_.C&&(_.C=ra(c(_.Va,_),6e3));bl(_.h)<=1&&_.ta&&(_.ta=void 0)}else la(_,11)}else if((h.L||_.g==h)&&Nf(_),!O(m))for(V=_.Ba.g.parse(m),m=0;m<V.length;m++){let it=V[m];const rn=it[0];if(!(rn<=_.K))if(_.K=rn,it=it[1],_.I==2)if(it[0]=="c"){_.M=it[1],_.ba=it[2];const mr=it[3];mr!=null&&(_.ka=mr,_.j.info("VER="+_.ka));const ca=it[4];ca!=null&&(_.za=ca,_.j.info("SVER="+_.za));const Us=it[5];Us!=null&&typeof Us=="number"&&Us>0&&(x=1.5*Us,_.O=x,_.j.info("backChannelRequestTimeoutMs_="+x)),x=_;const Vs=h.g;if(Vs){const Lf=Vs.g?Vs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Lf){var q=x.h;q.g||Lf.indexOf("spdy")==-1&&Lf.indexOf("quic")==-1&&Lf.indexOf("h2")==-1||(q.j=q.l,q.g=new Set,q.h&&(Pu(q,q.h),q.h=null))}if(x.G){const iy=Vs.g?Vs.g.getResponseHeader("X-HTTP-Session-Id"):null;iy&&(x.wa=iy,je(x.J,x.G,iy))}}_.I=3,_.l&&_.l.ra(),_.aa&&(_.T=Date.now()-h.F,_.j.info("Handshake RTT: "+_.T+"ms")),x=_;var ee=h;if(x.na=zC(x,x.L?x.ba:null,x.W),ee.L){xu(x.h,ee);var Ce=ee,Ht=x.O;Ht&&(Ce.H=Ht),Ce.D&&(wu(Ce),_l(Ce)),x.g=ee}else VC(x);_.i.length>0&&Of(_)}else it[0]!="stop"&&it[0]!="close"||la(_,7);else _.I==3&&(it[0]=="stop"||it[0]=="close"?it[0]=="stop"?la(_,7):ey(_):it[0]!="noop"&&_.l&&_.l.qa(it),_.A=0)}}ia(4)}catch{}}var Jv=class{constructor(h,m){this.g=h,this.map=m}};function Af(h){this.l=h||10,o.PerformanceNavigationTiming?(h=o.performance.getEntriesByType("navigation"),h=h.length>0&&(h[0].nextHopProtocol=="hq"||h[0].nextHopProtocol=="h2")):h=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=h?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Au(h){return h.h?!0:h.g?h.g.size>=h.j:!1}function bl(h){return h.h?1:h.g?h.g.size:0}function Iu(h,m){return h.h?h.h==m:h.g?h.g.has(m):!1}function Pu(h,m){h.g?h.g.add(m):h.h=m}function xu(h,m){h.h&&h.h==m?h.h=null:h.g&&h.g.has(m)&&h.g.delete(m)}Af.prototype.cancel=function(){if(this.i=If(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const h of this.g.values())h.cancel();this.g.clear()}};function If(h){if(h.h!=null)return h.i.concat(h.h.G);if(h.g!=null&&h.g.size!==0){let m=h.i;for(const _ of h.g.values())m=m.concat(_.G);return m}return p(h.i)}var nn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function U(h,m){if(h){h=h.split("&");for(let _=0;_<h.length;_++){const x=h[_].indexOf("=");let V,q=null;x>=0?(V=h[_].substring(0,x),q=h[_].substring(x+1)):V=h[_],m(V,q?decodeURIComponent(q.replace(/\+/g," ")):"")}}}function B(h){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let m;h instanceof B?(this.l=h.l,ae(this,h.j),this.o=h.o,this.g=h.g,ce(this,h.u),this.h=h.h,Fe(this,RC(h.i)),this.m=h.m):h&&(m=String(h).match(nn))?(this.l=!1,ae(this,m[1]||"",!0),this.o=Du(m[2]||""),this.g=Du(m[3]||"",!0),ce(this,m[4]),this.h=Du(m[5]||"",!0),Fe(this,m[6]||"",!0),this.m=Du(m[7]||"")):(this.l=!1,this.i=new Nu(null,this.l))}B.prototype.toString=function(){const h=[];var m=this.j;m&&h.push(Ou(m,SC,!0),":");var _=this.g;return(_||m=="file")&&(h.push("//"),(m=this.o)&&h.push(Ou(m,SC,!0),"@"),h.push(gt(_).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_=this.u,_!=null&&h.push(":",String(_))),(_=this.h)&&(this.g&&_.charAt(0)!="/"&&h.push("/"),h.push(Ou(_,_.charAt(0)=="/"?m4:p4,!0))),(_=this.i.toString())&&h.push("?",_),(_=this.m)&&h.push("#",Ou(_,v4)),h.join("")},B.prototype.resolve=function(h){const m=j(this);let _=!!h.j;_?ae(m,h.j):_=!!h.o,_?m.o=h.o:_=!!h.g,_?m.g=h.g:_=h.u!=null;var x=h.h;if(_)ce(m,h.u);else if(_=!!h.h){if(x.charAt(0)!="/")if(this.g&&!this.h)x="/"+x;else{var V=m.h.lastIndexOf("/");V!=-1&&(x=m.h.slice(0,V+1)+x)}if(V=x,V==".."||V==".")x="";else if(V.indexOf("./")!=-1||V.indexOf("/.")!=-1){x=V.lastIndexOf("/",0)==0,V=V.split("/");const q=[];for(let ee=0;ee<V.length;){const Ce=V[ee++];Ce=="."?x&&ee==V.length&&q.push(""):Ce==".."?((q.length>1||q.length==1&&q[0]!="")&&q.pop(),x&&ee==V.length&&q.push("")):(q.push(Ce),x=!0)}x=q.join("/")}else x=V}return _?m.h=x:_=h.i.toString()!=="",_?Fe(m,RC(h.i)):_=!!h.m,_&&(m.m=h.m),m};function j(h){return new B(h)}function ae(h,m,_){h.j=_?Du(m,!0):m,h.j&&(h.j=h.j.replace(/:$/,""))}function ce(h,m){if(m){if(m=Number(m),isNaN(m)||m<0)throw Error("Bad port number "+m);h.u=m}else h.u=null}function Fe(h,m,_){m instanceof Nu?(h.i=m,y4(h.i,h.l)):(_||(m=Ou(m,g4)),h.i=new Nu(m,h.l))}function je(h,m,_){h.i.set(m,_)}function qr(h){return je(h,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),h}function Du(h,m){return h?m?decodeURI(h.replace(/%25/g,"%2525")):decodeURIComponent(h):""}function Ou(h,m,_){return typeof h=="string"?(h=encodeURI(h).replace(m,f4),_&&(h=h.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h):null}function f4(h){return h=h.charCodeAt(0),"%"+(h>>4&15).toString(16)+(h&15).toString(16)}var SC=/[#\/\?@]/g,p4=/[#\?:]/g,m4=/[#\?]/g,g4=/[#\?@]/g,v4=/#/g;function Nu(h,m){this.h=this.g=null,this.i=h||null,this.j=!!m}function aa(h){h.g||(h.g=new Map,h.h=0,h.i&&U(h.i,function(m,_){h.add(decodeURIComponent(m.replace(/\+/g," ")),_)}))}t=Nu.prototype,t.add=function(h,m){aa(this),this.i=null,h=Tl(this,h);let _=this.g.get(h);return _||this.g.set(h,_=[]),_.push(m),this.h+=1,this};function EC(h,m){aa(h),m=Tl(h,m),h.g.has(m)&&(h.i=null,h.h-=h.g.get(m).length,h.g.delete(m))}function CC(h,m){return aa(h),m=Tl(h,m),h.g.has(m)}t.forEach=function(h,m){aa(this),this.g.forEach(function(_,x){_.forEach(function(V){h.call(m,V,x,this)},this)},this)};function kC(h,m){aa(h);let _=[];if(typeof m=="string")CC(h,m)&&(_=_.concat(h.g.get(Tl(h,m))));else for(h=Array.from(h.g.values()),m=0;m<h.length;m++)_=_.concat(h[m]);return _}t.set=function(h,m){return aa(this),this.i=null,h=Tl(this,h),CC(this,h)&&(this.h-=this.g.get(h).length),this.g.set(h,[m]),this.h+=1,this},t.get=function(h,m){return h?(h=kC(this,h),h.length>0?String(h[0]):m):m};function wC(h,m,_){EC(h,m),_.length>0&&(h.i=null,h.g.set(Tl(h,m),p(_)),h.h+=_.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const h=[],m=Array.from(this.g.keys());for(let x=0;x<m.length;x++){var _=m[x];const V=gt(_);_=kC(this,_);for(let q=0;q<_.length;q++){let ee=V;_[q]!==""&&(ee+="="+gt(_[q])),h.push(ee)}}return this.i=h.join("&")};function RC(h){const m=new Nu;return m.i=h.i,h.g&&(m.g=new Map(h.g),m.h=h.h),m}function Tl(h,m){return m=String(m),h.j&&(m=m.toLowerCase()),m}function y4(h,m){m&&!h.j&&(aa(h),h.i=null,h.g.forEach(function(_,x){const V=x.toLowerCase();x!=V&&(EC(this,x),wC(this,V,_))},h)),h.j=m}function _4(h,m){const _=new sa;if(o.Image){const x=new Image;x.onload=u(Ms,_,"TestLoadImage: loaded",!0,m,x),x.onerror=u(Ms,_,"TestLoadImage: error",!1,m,x),x.onabort=u(Ms,_,"TestLoadImage: abort",!1,m,x),x.ontimeout=u(Ms,_,"TestLoadImage: timeout",!1,m,x),o.setTimeout(function(){x.ontimeout&&x.ontimeout()},1e4),x.src=h}else m(!1)}function b4(h,m){const _=new sa,x=new AbortController,V=setTimeout(()=>{x.abort(),Ms(_,"TestPingServer: timeout",!1,m)},1e4);fetch(h,{signal:x.signal}).then(q=>{clearTimeout(V),q.ok?Ms(_,"TestPingServer: ok",!0,m):Ms(_,"TestPingServer: server error",!1,m)}).catch(()=>{clearTimeout(V),Ms(_,"TestPingServer: error",!1,m)})}function Ms(h,m,_,x,V){try{V&&(V.onload=null,V.onerror=null,V.onabort=null,V.ontimeout=null),x(_)}catch{}}function T4(){this.g=new Wv}function Xv(h){this.i=h.Sb||null,this.h=h.ab||!1}d(Xv,yf),Xv.prototype.g=function(){return new Pf(this.i,this.h)};function Pf(h,m){tn.call(this),this.H=h,this.o=m,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}d(Pf,tn),t=Pf.prototype,t.open=function(h,m){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=h,this.D=m,this.readyState=1,Lu(this)},t.send=function(h){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const m={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};h&&(m.body=h),(this.H||o).fetch(new Request(this.D,m)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Mu(this)),this.readyState=0},t.Pa=function(h){if(this.g&&(this.l=h,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=h.headers,this.readyState=2,Lu(this)),this.g&&(this.readyState=3,Lu(this),this.g)))if(this.responseType==="arraybuffer")h.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in h){if(this.j=h.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;AC(this)}else h.text().then(this.Oa.bind(this),this.ga.bind(this))};function AC(h){h.j.read().then(h.Ma.bind(h)).catch(h.ga.bind(h))}t.Ma=function(h){if(this.g){if(this.o&&h.value)this.response.push(h.value);else if(!this.o){var m=h.value?h.value:new Uint8Array(0);(m=this.B.decode(m,{stream:!h.done}))&&(this.response=this.responseText+=m)}h.done?Mu(this):Lu(this),this.readyState==3&&AC(this)}},t.Oa=function(h){this.g&&(this.response=this.responseText=h,Mu(this))},t.Na=function(h){this.g&&(this.response=h,Mu(this))},t.ga=function(){this.g&&Mu(this)};function Mu(h){h.readyState=4,h.l=null,h.j=null,h.B=null,Lu(h)}t.setRequestHeader=function(h,m){this.A.append(h,m)},t.getResponseHeader=function(h){return this.h&&this.h.get(h.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const h=[],m=this.h.entries();for(var _=m.next();!_.done;)_=_.value,h.push(_[0]+": "+_[1]),_=m.next();return h.join(`\r
`)};function Lu(h){h.onreadystatechange&&h.onreadystatechange.call(h)}Object.defineProperty(Pf.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(h){this.m=h?"include":"same-origin"}});function IC(h){let m="";return be(h,function(_,x){m+=x,m+=":",m+=_,m+=`\r
`}),m}function Zv(h,m,_){e:{for(x in _){var x=!1;break e}x=!0}x||(_=IC(_),typeof h=="string"?_!=null&&gt(_):je(h,m,_))}function Tt(h){tn.call(this),this.headers=new Map,this.L=h||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}d(Tt,tn);var S4=/^https?$/i,E4=["POST","PUT"];t=Tt.prototype,t.Fa=function(h){this.H=h},t.ea=function(h,m,_,x){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+h);m=m?m.toUpperCase():"GET",this.D=h,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():ne.g(),this.g.onreadystatechange=f(c(this.Ca,this));try{this.B=!0,this.g.open(m,String(h),!0),this.B=!1}catch(q){PC(this,q);return}if(h=_||"",_=new Map(this.headers),x)if(Object.getPrototypeOf(x)===Object.prototype)for(var V in x)_.set(V,x[V]);else if(typeof x.keys=="function"&&typeof x.get=="function")for(const q of x.keys())_.set(q,x.get(q));else throw Error("Unknown input type for opt_headers: "+String(x));x=Array.from(_.keys()).find(q=>q.toLowerCase()=="content-type"),V=o.FormData&&h instanceof o.FormData,!(Array.prototype.indexOf.call(E4,m,void 0)>=0)||x||V||_.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[q,ee]of _)this.g.setRequestHeader(q,ee);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(h),this.v=!1}catch(q){PC(this,q)}};function PC(h,m){h.h=!1,h.g&&(h.j=!0,h.g.abort(),h.j=!1),h.l=m,h.o=5,xC(h),xf(h)}function xC(h){h.A||(h.A=!0,vn(h,"complete"),vn(h,"error"))}t.abort=function(h){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=h||7,vn(this,"complete"),vn(this,"abort"),xf(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),xf(this,!0)),Tt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?DC(this):this.Xa())},t.Xa=function(){DC(this)};function DC(h){if(h.h&&typeof s<"u"){if(h.v&&Ls(h)==4)setTimeout(h.Ca.bind(h),0);else if(vn(h,"readystatechange"),Ls(h)==4){h.h=!1;try{const q=h.ca();e:switch(q){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var m=!0;break e;default:m=!1}var _;if(!(_=m)){var x;if(x=q===0){let ee=String(h.D).match(nn)[1]||null;!ee&&o.self&&o.self.location&&(ee=o.self.location.protocol.slice(0,-1)),x=!S4.test(ee?ee.toLowerCase():"")}_=x}if(_)vn(h,"complete"),vn(h,"success");else{h.o=6;try{var V=Ls(h)>2?h.g.statusText:""}catch{V=""}h.l=V+" ["+h.ca()+"]",xC(h)}}finally{xf(h)}}}}function xf(h,m){if(h.g){h.m&&(clearTimeout(h.m),h.m=null);const _=h.g;h.g=null,m||vn(h,"ready");try{_.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Ls(h){return h.g?h.g.readyState:0}t.ca=function(){try{return Ls(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(h){if(this.g){var m=this.g.responseText;return h&&m.indexOf(h)==0&&(m=m.substring(h.length)),$v(m)}};function OC(h){try{if(!h.g)return null;if("response"in h.g)return h.g.response;switch(h.F){case"":case"text":return h.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in h.g)return h.g.mozResponseArrayBuffer}return null}catch{return null}}function C4(h){const m={};h=(h.g&&Ls(h)>=2&&h.g.getAllResponseHeaders()||"").split(`\r
`);for(let x=0;x<h.length;x++){if(O(h[x]))continue;var _=Ai(h[x]);const V=_[0];if(_=_[1],typeof _!="string")continue;_=_.trim();const q=m[V]||[];m[V]=q,q.push(_)}ze(m,function(x){return x.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Uu(h,m,_){return _&&_.internalChannelParams&&_.internalChannelParams[h]||m}function NC(h){this.za=0,this.i=[],this.j=new sa,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Uu("failFast",!1,h),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Uu("baseRetryDelayMs",5e3,h),this.Za=Uu("retryDelaySeedMs",1e4,h),this.Ta=Uu("forwardChannelMaxRetries",2,h),this.va=Uu("forwardChannelRequestTimeoutMs",2e4,h),this.ma=h&&h.xmlHttpFactory||void 0,this.Ua=h&&h.Rb||void 0,this.Aa=h&&h.useFetchStreams||!1,this.O=void 0,this.L=h&&h.supportsCrossDomainXhr||!1,this.M="",this.h=new Af(h&&h.concurrentRequestLimit),this.Ba=new T4,this.S=h&&h.fastHandshake||!1,this.R=h&&h.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=h&&h.Pb||!1,h&&h.ua&&this.j.ua(),h&&h.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&h&&h.detectBufferingProxy||!1,this.ia=void 0,h&&h.longPollingTimeout&&h.longPollingTimeout>0&&(this.ia=h.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=NC.prototype,t.ka=8,t.I=1,t.connect=function(h,m,_,x){yn(0),this.W=h,this.H=m||{},_&&x!==void 0&&(this.H.OSID=_,this.H.OAID=x),this.F=this.X,this.J=zC(this,null,this.W),Of(this)};function ey(h){if(MC(h),h.I==3){var m=h.V++,_=j(h.J);if(je(_,"SID",h.M),je(_,"RID",m),je(_,"TYPE","terminate"),Vu(h,_),m=new fr(h,h.j,m),m.M=2,m.A=qr(j(_)),_=!1,o.navigator&&o.navigator.sendBeacon)try{_=o.navigator.sendBeacon(m.A.toString(),"")}catch{}!_&&o.Image&&(new Image().src=m.A,_=!0),_||(m.g=HC(m.j,null),m.g.ea(m.A)),m.F=Date.now(),_l(m)}qC(h)}function Df(h){h.g&&(ny(h),h.g.cancel(),h.g=null)}function MC(h){Df(h),h.v&&(o.clearTimeout(h.v),h.v=null),Nf(h),h.h.cancel(),h.m&&(typeof h.m=="number"&&o.clearTimeout(h.m),h.m=null)}function Of(h){if(!Au(h.h)&&!h.m){h.m=!0;var m=h.Ea;w||k(),D||(w(),D=!0),C.add(m,h),h.D=0}}function k4(h,m){return bl(h.h)>=h.h.j-(h.m?1:0)?!1:h.m?(h.i=m.G.concat(h.i),!0):h.I==1||h.I==2||h.D>=(h.Sa?0:h.Ta)?!1:(h.m=ra(c(h.Ea,h,m),BC(h,h.D)),h.D++,!0)}t.Ea=function(h){if(this.m)if(this.m=null,this.I==1){if(!h){this.V=Math.floor(Math.random()*1e5),h=this.V++;const V=new fr(this,this.j,h);let q=this.o;if(this.U&&(q?(q=xn(q),gn(q,this.U)):q=this.U),this.u!==null||this.R||(V.J=q,q=null),this.S)e:{for(var m=0,_=0;_<this.i.length;_++){t:{var x=this.i[_];if("__data__"in x.map&&(x=x.map.__data__,typeof x=="string")){x=x.length;break t}x=void 0}if(x===void 0)break;if(m+=x,m>4096){m=_;break e}if(m===4096||_===this.i.length-1){m=_+1;break e}}m=1e3}else m=1e3;m=UC(this,V,m),_=j(this.J),je(_,"RID",h),je(_,"CVER",22),this.G&&je(_,"X-HTTP-Session-Id",this.G),Vu(this,_),q&&(this.R?m="headers="+gt(IC(q))+"&"+m:this.u&&Zv(_,this.u,q)),Pu(this.h,V),this.Ra&&je(_,"TYPE","init"),this.S?(je(_,"$req",m),je(_,"SID","null"),V.U=!0,le(V,_,null)):le(V,_,m),this.I=2}}else this.I==3&&(h?LC(this,h):this.i.length==0||Au(this.h)||LC(this))};function LC(h,m){var _;m?_=m.l:_=h.V++;const x=j(h.J);je(x,"SID",h.M),je(x,"RID",_),je(x,"AID",h.K),Vu(h,x),h.u&&h.o&&Zv(x,h.u,h.o),_=new fr(h,h.j,_,h.D+1),h.u===null&&(_.J=h.o),m&&(h.i=m.G.concat(h.i)),m=UC(h,_,1e3),_.H=Math.round(h.va*.5)+Math.round(h.va*.5*Math.random()),Pu(h.h,_),le(_,x,m)}function Vu(h,m){h.H&&be(h.H,function(_,x){je(m,x,_)}),h.l&&be({},function(_,x){je(m,x,_)})}function UC(h,m,_){_=Math.min(h.i.length,_);const x=h.l?c(h.l.Ka,h.l,h):null;e:{var V=h.i;let Ce=-1;for(;;){const Ht=["count="+_];Ce==-1?_>0?(Ce=V[0].g,Ht.push("ofs="+Ce)):Ce=0:Ht.push("ofs="+Ce);let it=!0;for(let rn=0;rn<_;rn++){var q=V[rn].g;const mr=V[rn].map;if(q-=Ce,q<0)Ce=Math.max(0,V[rn].g-100),it=!1;else try{q="req"+q+"_"||"";try{var ee=mr instanceof Map?mr:Object.entries(mr);for(const[ca,Us]of ee){let Vs=Us;a(Us)&&(Vs=Tu(Us)),Ht.push(q+ca+"="+encodeURIComponent(Vs))}}catch(ca){throw Ht.push(q+"type="+encodeURIComponent("_badmap")),ca}}catch{x&&x(mr)}}if(it){ee=Ht.join("&");break e}}ee=void 0}return h=h.i.splice(0,_),m.G=h,ee}function VC(h){if(!h.g&&!h.v){h.Y=1;var m=h.Da;w||k(),D||(w(),D=!0),C.add(m,h),h.A=0}}function ty(h){return h.g||h.v||h.A>=3?!1:(h.Y++,h.v=ra(c(h.Da,h),BC(h,h.A)),h.A++,!0)}t.Da=function(){if(this.v=null,FC(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var h=4*this.T;this.j.info("BP detection timer enabled: "+h),this.B=ra(c(this.Wa,this),h)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,yn(10),Df(this),FC(this))};function ny(h){h.B!=null&&(o.clearTimeout(h.B),h.B=null)}function FC(h){h.g=new fr(h,h.j,"rpc",h.Y),h.u===null&&(h.g.J=h.o),h.g.P=0;var m=j(h.na);je(m,"RID","rpc"),je(m,"SID",h.M),je(m,"AID",h.K),je(m,"CI",h.F?"0":"1"),!h.F&&h.ia&&je(m,"TO",h.ia),je(m,"TYPE","xmlhttp"),Vu(h,m),h.u&&h.o&&Zv(m,h.u,h.o),h.O&&(h.g.H=h.O);var _=h.g;h=h.ba,_.M=1,_.A=qr(j(m)),_.u=null,_.R=!0,Ef(_,h)}t.Va=function(){this.C!=null&&(this.C=null,Df(this),ty(this),yn(19))};function Nf(h){h.C!=null&&(o.clearTimeout(h.C),h.C=null)}function jC(h,m){var _=null;if(h.g==m){Nf(h),ny(h),h.g=null;var x=2}else if(Iu(h.h,m))_=m.G,xu(h.h,m),x=1;else return;if(h.I!=0){if(m.o)if(x==1){_=m.u?m.u.length:0,m=Date.now()-m.F;var V=h.D;x=vl(),vn(x,new Sf(x,_)),Of(h)}else VC(h);else if(V=m.m,V==3||V==0&&m.X>0||!(x==1&&k4(h,m)||x==2&&ty(h)))switch(_&&_.length>0&&(m=h.h,m.i=m.i.concat(_)),V){case 1:la(h,5);break;case 4:la(h,10);break;case 3:la(h,6);break;default:la(h,2)}}}function BC(h,m){let _=h.Qa+Math.floor(Math.random()*h.Za);return h.isActive()||(_*=2),_*m}function la(h,m){if(h.j.info("Error code "+m),m==2){var _=c(h.bb,h),x=h.Ua;const V=!x;x=new B(x||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||ae(x,"https"),qr(x),V?_4(x.toString(),_):b4(x.toString(),_)}else yn(2);h.I=0,h.l&&h.l.pa(m),qC(h),MC(h)}t.bb=function(h){h?(this.j.info("Successfully pinged google.com"),yn(2)):(this.j.info("Failed to ping google.com"),yn(1))};function qC(h){if(h.I=0,h.ja=[],h.l){const m=If(h.h);(m.length!=0||h.i.length!=0)&&(v(h.ja,m),v(h.ja,h.i),h.h.i.length=0,p(h.i),h.i.length=0),h.l.oa()}}function zC(h,m,_){var x=_ instanceof B?j(_):new B(_);if(x.g!="")m&&(x.g=m+"."+x.g),ce(x,x.u);else{var V=o.location;x=V.protocol,m=m?m+"."+V.hostname:V.hostname,V=+V.port;const q=new B(null);x&&ae(q,x),m&&(q.g=m),V&&ce(q,V),_&&(q.h=_),x=q}return _=h.G,m=h.wa,_&&m&&je(x,_,m),je(x,"VER",h.ka),Vu(h,x),x}function HC(h,m,_){if(m&&!h.L)throw Error("Can't create secondary domain capable XhrIo object.");return m=h.Aa&&!h.ma?new Tt(new Xv({ab:_})):new Tt(h.ma),m.Fa(h.L),m}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function GC(){}t=GC.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function Mf(){}Mf.prototype.g=function(h,m){return new hi(h,m)};function hi(h,m){tn.call(this),this.g=new NC(m),this.l=h,this.h=m&&m.messageUrlParams||null,h=m&&m.messageHeaders||null,m&&m.clientProtocolHeaderRequired&&(h?h["X-Client-Protocol"]="webchannel":h={"X-Client-Protocol":"webchannel"}),this.g.o=h,h=m&&m.initMessageHeaders||null,m&&m.messageContentType&&(h?h["X-WebChannel-Content-Type"]=m.messageContentType:h={"X-WebChannel-Content-Type":m.messageContentType}),m&&m.sa&&(h?h["X-WebChannel-Client-Profile"]=m.sa:h={"X-WebChannel-Client-Profile":m.sa}),this.g.U=h,(h=m&&m.Qb)&&!O(h)&&(this.g.u=h),this.A=m&&m.supportsCrossDomainXhr||!1,this.v=m&&m.sendRawJson||!1,(m=m&&m.httpSessionIdParam)&&!O(m)&&(this.g.G=m,h=this.h,h!==null&&m in h&&(h=this.h,m in h&&delete h[m])),this.j=new Sl(this)}d(hi,tn),hi.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},hi.prototype.close=function(){ey(this.g)},hi.prototype.o=function(h){var m=this.g;if(typeof h=="string"){var _={};_.__data__=h,h=_}else this.v&&(_={},_.__data__=Tu(h),h=_);m.i.push(new Jv(m.Ya++,h)),m.I==3&&Of(m)},hi.prototype.N=function(){this.g.l=null,delete this.j,ey(this.g),delete this.g,hi.Z.N.call(this)};function KC(h){Su.call(this),h.__headers__&&(this.headers=h.__headers__,this.statusCode=h.__status__,delete h.__headers__,delete h.__status__);var m=h.__sm__;if(m){e:{for(const _ in m){h=_;break e}h=void 0}(this.i=h)&&(h=this.i,m=m!==null&&h in m?m[h]:void 0),this.data=m}else this.data=h}d(KC,Su);function $C(){Eu.call(this),this.status=1}d($C,Eu);function Sl(h){this.g=h}d(Sl,GC),Sl.prototype.ra=function(){vn(this.g,"a")},Sl.prototype.qa=function(h){vn(this.g,new KC(h))},Sl.prototype.pa=function(h){vn(this.g,new $C)},Sl.prototype.oa=function(){vn(this.g,"b")},Mf.prototype.createWebChannel=Mf.prototype.g,hi.prototype.send=hi.prototype.o,hi.prototype.open=hi.prototype.m,hi.prototype.close=hi.prototype.close,dO=function(){return new Mf},uO=function(){return vl()},cO=jr,H_={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},On.NO_ERROR=0,On.TIMEOUT=8,On.HTTP_ERROR=6,Np=On,oa.COMPLETE="complete",lO=oa,_f.EventType=na,na.OPEN="a",na.CLOSE="b",na.ERROR="c",na.MESSAGE="d",tn.prototype.listen=tn.prototype.J,fd=_f,Tt.prototype.listenOnce=Tt.prototype.K,Tt.prototype.getLastError=Tt.prototype.Ha,Tt.prototype.getLastErrorCode=Tt.prototype.ya,Tt.prototype.getStatus=Tt.prototype.ca,Tt.prototype.getResponseJson=Tt.prototype.La,Tt.prototype.getResponseText=Tt.prototype.la,Tt.prototype.send=Tt.prototype.ea,Tt.prototype.setWithCredentials=Tt.prototype.Fa,aO=Tt}).apply(typeof ep<"u"?ep:typeof self<"u"?self:typeof window<"u"?window:{});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ln.UNAUTHENTICATED=new Ln(null),Ln.GOOGLE_CREDENTIALS=new Ln("google-credentials-uid"),Ln.FIRST_PARTY=new Ln("first-party-uid"),Ln.MOCK_USER=new Ln("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let su="12.9.0";function YF(t){su=t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ja=new pS("@firebase/firestore");function xl(){return ja.logLevel}function ie(t,...e){if(ja.logLevel<=Le.DEBUG){const n=e.map(gS);ja.debug(`Firestore (${su}): ${t}`,...n)}}function Ts(t,...e){if(ja.logLevel<=Le.ERROR){const n=e.map(gS);ja.error(`Firestore (${su}): ${t}`,...n)}}function Ba(t,...e){if(ja.logLevel<=Le.WARN){const n=e.map(gS);ja.warn(`Firestore (${su}): ${t}`,...n)}}function gS(t){if(typeof t=="string")return t;try{return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fe(t,e,n){let i="Unexpected state";typeof e=="string"?i=e:n=e,hO(t,i,n)}function hO(t,e,n){let i=`FIRESTORE (${su}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{i+=" CONTEXT: "+JSON.stringify(n)}catch{i+=" CONTEXT: "+n}throw Ts(i),new Error(i)}function Qe(t,e,n,i){let r="Unexpected state";typeof n=="string"?r=n:i=n,t||hO(e,r,i)}function _e(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class oe extends ru{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fO{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class JF{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(Ln.UNAUTHENTICATED))}shutdown(){}}class XF{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class ZF{constructor(e){this.t=e,this.currentUser=Ln.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){Qe(this.o===void 0,42304);let i=this.i;const r=l=>this.i!==i?(i=this.i,n(l)):Promise.resolve();let s=new ds;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ds,e.enqueueRetryable(()=>r(this.currentUser))};const o=()=>{const l=s;e.enqueueRetryable(async()=>{await l.promise,await r(this.currentUser)})},a=l=>{ie("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ie("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ds)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(i=>this.i!==e?(ie("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Qe(typeof i.accessToken=="string",31837,{l:i}),new fO(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Qe(e===null||typeof e=="string",2055,{h:e}),new Ln(e)}}class e8{constructor(e,n,i){this.P=e,this.T=n,this.I=i,this.type="FirstParty",this.user=Ln.FIRST_PARTY,this.R=new Map}A(){return this.I?this.I():null}get headers(){this.R.set("X-Goog-AuthUser",this.P);const e=this.A();return e&&this.R.set("Authorization",e),this.T&&this.R.set("X-Goog-Iam-Authorization-Token",this.T),this.R}}class t8{constructor(e,n,i){this.P=e,this.T=n,this.I=i}getToken(){return Promise.resolve(new e8(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(Ln.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class qk{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class n8{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,eO(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){Qe(this.o===void 0,3512);const i=s=>{s.error!=null&&ie("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.m;return this.m=s.token,ie("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{ie("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?r(s):ie("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new qk(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(Qe(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new qk(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i8(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let i=0;i<t;i++)n[i]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vS{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const r=i8(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<n&&(i+=e.charAt(r[s]%62))}return i}}function Oe(t,e){return t<e?-1:t>e?1:0}function G_(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const r=t.charAt(i),s=e.charAt(i);if(r!==s)return Wy(r)===Wy(s)?Oe(r,s):Wy(r)?1:-1}return Oe(t.length,e.length)}const r8=55296,s8=57343;function Wy(t){const e=t.charCodeAt(0);return e>=r8&&e<=s8}function Nc(t,e,n){return t.length===e.length&&t.every((i,r)=>n(i,e[r]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zk="__name__";class vr{constructor(e,n,i){n===void 0?n=0:n>e.length&&fe(637,{offset:n,range:e.length}),i===void 0?i=e.length-n:i>e.length-n&&fe(1746,{length:i,range:e.length-n}),this.segments=e,this.offset=n,this.len=i}get length(){return this.len}isEqual(e){return vr.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof vr?e.forEach(i=>{n.push(i)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,i=this.limit();n<i;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const i=Math.min(e.length,n.length);for(let r=0;r<i;r++){const s=vr.compareSegments(e.get(r),n.get(r));if(s!==0)return s}return Oe(e.length,n.length)}static compareSegments(e,n){const i=vr.isNumericId(e),r=vr.isNumericId(n);return i&&!r?-1:!i&&r?1:i&&r?vr.extractNumericId(e).compare(vr.extractNumericId(n)):G_(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Eo.fromString(e.substring(4,e.length-2))}}class ft extends vr{construct(e,n,i){return new ft(e,n,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const i of e){if(i.indexOf("//")>=0)throw new oe(Y.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);n.push(...i.split("/").filter(r=>r.length>0))}return new ft(n)}static emptyPath(){return new ft([])}}const o8=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Cn extends vr{construct(e,n,i){return new Cn(e,n,i)}static isValidIdentifier(e){return o8.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Cn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===zk}static keyField(){return new Cn([zk])}static fromServerFormat(e){const n=[];let i="",r=0;const s=()=>{if(i.length===0)throw new oe(Y.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(i),i=""};let o=!1;for(;r<e.length;){const a=e[r];if(a==="\\"){if(r+1===e.length)throw new oe(Y.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[r+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new oe(Y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,r+=2}else a==="`"?(o=!o,r++):a!=="."||o?(i+=a,r++):(s(),r++)}if(s(),o)throw new oe(Y.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Cn(n)}static emptyPath(){return new Cn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e){this.path=e}static fromPath(e){return new ue(ft.fromString(e))}static fromName(e){return new ue(ft.fromString(e).popFirst(5))}static empty(){return new ue(ft.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ft.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ft.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ue(new ft(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pO(t,e,n){if(!n)throw new oe(Y.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function a8(t,e,n,i){if(e===!0&&i===!0)throw new oe(Y.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Hk(t){if(!ue.isDocumentKey(t))throw new oe(Y.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Gk(t){if(ue.isDocumentKey(t))throw new oe(Y.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function mO(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function yS(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":fe(12329,{type:typeof t})}function qa(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new oe(Y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=yS(t);throw new oe(Y.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qt(t,e){const n={typeString:t};return e&&(n.value=e),n}function ef(t,e){if(!mO(t))throw new oe(Y.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in e)if(e[i]){const r=e[i].typeString,s="value"in e[i]?{value:e[i].value}:void 0;if(!(i in t)){n=`JSON missing required field: '${i}'`;break}const o=t[i];if(r&&typeof o!==r){n=`JSON field '${i}' must be a ${r}.`;break}if(s!==void 0&&o!==s.value){n=`Expected '${i}' field to equal '${s.value}'`;break}}if(n)throw new oe(Y.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk=-62135596800,$k=1e6;let mn=class va{static now(){return va.fromMillis(Date.now())}static fromDate(e){return va.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),i=Math.floor((e-1e3*n)*$k);return new va(n,i)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new oe(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new oe(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<Kk)throw new oe(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new oe(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$k}_compareTo(e){return this.seconds===e.seconds?Oe(this.nanoseconds,e.nanoseconds):Oe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:va._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ef(e,va._jsonSchema))return new va(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Kk;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};mn._jsonSchemaVersion="firestore/timestamp/1.0",mn._jsonSchema={type:qt("string",mn._jsonSchemaVersion),seconds:qt("number"),nanoseconds:qt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{static fromTimestamp(e){return new ye(e)}static min(){return new ye(new mn(0,0))}static max(){return new ye(new mn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fh=-1;function l8(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,r=ye.fromTimestamp(i===1e9?new mn(n+1,0):new mn(n,i));return new No(r,ue.empty(),e)}function c8(t){return new No(t.readTime,t.key,fh)}class No{constructor(e,n,i){this.readTime=e,this.documentKey=n,this.largestBatchId=i}static min(){return new No(ye.min(),ue.empty(),fh)}static max(){return new No(ye.max(),ue.empty(),fh)}}function u8(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=ue.comparator(t.documentKey,e.documentKey),n!==0?n:Oe(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d8="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class h8{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ou(t){if(t.code!==Y.FAILED_PRECONDITION||t.message!==d8)throw t;ie("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&fe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new W((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(n,s).next(i,r)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof W?n:W.resolve(n)}catch(n){return W.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):W.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):W.reject(n)}static resolve(e){return new W((n,i)=>{n(e)})}static reject(e){return new W((n,i)=>{i(e)})}static waitFor(e){return new W((n,i)=>{let r=0,s=0,o=!1;e.forEach(a=>{++r,a.next(()=>{++s,o&&s===r&&n()},l=>i(l))}),o=!0,s===r&&n()})}static or(e){let n=W.resolve(!1);for(const i of e)n=n.next(r=>r?W.resolve(r):i());return n}static forEach(e,n){const i=[];return e.forEach((r,s)=>{i.push(n.call(this,r,s))}),this.waitFor(i)}static mapArray(e,n){return new W((i,r)=>{const s=e.length,o=new Array(s);let a=0;for(let l=0;l<s;l++){const c=l;n(e[c]).next(u=>{o[c]=u,++a,a===s&&i(o)},u=>r(u))}})}static doWhile(e,n){return new W((i,r)=>{const s=()=>{e()===!0?n().next(()=>{s()},r):i()};s()})}}function f8(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function au(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xg{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>n.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Xg.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _S=-1;function Zg(t){return t==null}function Lm(t){return t===0&&1/t==-1/0}function p8(t){return typeof t=="number"&&Number.isInteger(t)&&!Lm(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gO="";function m8(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Wk(e)),e=g8(t.get(n),e);return Wk(e)}function g8(t,e){let n=e;const i=t.length;for(let r=0;r<i;r++){const s=t.charAt(r);switch(s){case"\0":n+="";break;case gO:n+="";break;default:n+=s}}return n}function Wk(t){return t+gO+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qk(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function $o(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function vO(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zt=class K_{constructor(e,n){this.comparator=e,this.root=n||Co.EMPTY}insert(e,n){return new K_(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Co.BLACK,null,null))}remove(e){return new K_(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Co.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return n.value;i<0?n=n.left:i>0&&(n=n.right)}return null}indexOf(e){let n=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(r===0)return n+i.left.size;r<0?i=i.left:(n+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,i)=>(e(n,i),!1))}toString(){const e=[];return this.inorderTraversal((n,i)=>(e.push(`${n}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tp(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tp(this.root,e,this.comparator,!1)}getReverseIterator(){return new tp(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tp(this.root,e,this.comparator,!0)}},tp=class{constructor(e,n,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?i(e.key,n):1,n&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Co=class Wr{constructor(e,n,i,r,s){this.key=e,this.value=n,this.color=i??Wr.RED,this.left=r??Wr.EMPTY,this.right=s??Wr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,i,r,s){return new Wr(e??this.key,n??this.value,i??this.color,r??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,n,i),null):s===0?r.copy(null,n,null,null,null):r.copy(null,null,null,null,r.right.insert(e,n,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Wr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let i,r=this;if(n(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),n(e,r.key)===0){if(r.right.isEmpty())return Wr.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Wr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Wr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw fe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw fe(27949);return e+(this.isRed()?0:1)}};Co.EMPTY=null,Co.RED=!0,Co.BLACK=!1;Co.EMPTY=new class{constructor(){this.size=0}get key(){throw fe(57766)}get value(){throw fe(16141)}get color(){throw fe(16727)}get left(){throw fe(29726)}get right(){throw fe(36894)}copy(e,n,i,r,s){return this}insert(e,n,i){return new Co(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yt{constructor(e){this.comparator=e,this.data=new zt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,i)=>(e(n),!1))}forEachInRange(e,n){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;n(r.key)}}forEachWhile(e,n){let i;for(i=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Yk(this.data.getIterator())}getIteratorFrom(e){return new Yk(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(i=>{n=n.add(i)}),n}isEqual(e){if(!(e instanceof Yt)||this.size!==e.size)return!1;const n=this.data.getIterator(),i=e.data.getIterator();for(;n.hasNext();){const r=n.getNext().key,s=i.getNext().key;if(this.comparator(r,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Yt(this.comparator);return n.data=e,n}}class Yk{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(e){this.fields=e,e.sort(Cn.comparator)}static empty(){return new nr([])}unionWith(e){let n=new Yt(Cn.comparator);for(const i of this.fields)n=n.add(i);for(const i of e)n=n.add(i);return new nr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Nc(this.fields,e.fields,(n,i)=>n.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yO extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new yO("Invalid base64 string: "+s):s}}(e);return new In(n)}static fromUint8Array(e){const n=function(r){let s="";for(let o=0;o<r.length;++o)s+=String.fromCharCode(r[o]);return s}(e);return new In(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const i=new Uint8Array(n.length);for(let r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Oe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}In.EMPTY_BYTE_STRING=new In("");const v8=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mo(t){if(Qe(!!t,39018),typeof t=="string"){let e=0;const n=v8.exec(t);if(Qe(!!n,46558,{timestamp:t}),n[1]){let r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:It(t.seconds),nanos:It(t.nanos)}}function It(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function Lo(t){return typeof t=="string"?In.fromBase64String(t):In.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _O="server_timestamp",bO="__type__",TO="__previous_value__",SO="__local_write_time__";function bS(t){var n,i;return((i=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[bO])==null?void 0:i.stringValue)===_O}function ev(t){const e=t.mapValue.fields[TO];return bS(e)?ev(e):e}function ph(t){const e=Mo(t.mapValue.fields[SO].timestampValue);return new mn(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y8{constructor(e,n,i,r,s,o,a,l,c,u,d){this.databaseId=e,this.appId=n,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=u,this.apiKey=d}}const Um="(default)";class mh{constructor(e,n){this.projectId=e,this.database=n||Um}static empty(){return new mh("","")}get isDefaultDatabase(){return this.database===Um}isEqual(e){return e instanceof mh&&e.projectId===this.projectId&&e.database===this.database}}function _8(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new oe(Y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mh(t.options.projectId,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EO="__type__",b8="__max__",np={mapValue:{}},CO="__vector__",Vm="value";function Uo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?bS(t)?4:S8(t)?9007199254740991:T8(t)?10:11:fe(28295,{value:t})}function Ir(t,e){if(t===e)return!0;const n=Uo(t);if(n!==Uo(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ph(t).isEqual(ph(e));case 3:return function(r,s){if(typeof r.timestampValue=="string"&&typeof s.timestampValue=="string"&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const o=Mo(r.timestampValue),a=Mo(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(r,s){return Lo(r.bytesValue).isEqual(Lo(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(r,s){return It(r.geoPointValue.latitude)===It(s.geoPointValue.latitude)&&It(r.geoPointValue.longitude)===It(s.geoPointValue.longitude)}(t,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return It(r.integerValue)===It(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const o=It(r.doubleValue),a=It(s.doubleValue);return o===a?Lm(o)===Lm(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return Nc(t.arrayValue.values||[],e.arrayValue.values||[],Ir);case 10:case 11:return function(r,s){const o=r.mapValue.fields||{},a=s.mapValue.fields||{};if(Qk(o)!==Qk(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ir(o[l],a[l])))return!1;return!0}(t,e);default:return fe(52216,{left:t})}}function gh(t,e){return(t.values||[]).find(n=>Ir(n,e))!==void 0}function Mc(t,e){if(t===e)return 0;const n=Uo(t),i=Uo(e);if(n!==i)return Oe(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Oe(t.booleanValue,e.booleanValue);case 2:return function(s,o){const a=It(s.integerValue||s.doubleValue),l=It(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(t,e);case 3:return Jk(t.timestampValue,e.timestampValue);case 4:return Jk(ph(t),ph(e));case 5:return G_(t.stringValue,e.stringValue);case 6:return function(s,o){const a=Lo(s),l=Lo(o);return a.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const u=Oe(a[c],l[c]);if(u!==0)return u}return Oe(a.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){const a=Oe(It(s.latitude),It(o.latitude));return a!==0?a:Oe(It(s.longitude),It(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Xk(t.arrayValue,e.arrayValue);case 10:return function(s,o){var f,p,v,g;const a=s.fields||{},l=o.fields||{},c=(f=a[Vm])==null?void 0:f.arrayValue,u=(p=l[Vm])==null?void 0:p.arrayValue,d=Oe(((v=c==null?void 0:c.values)==null?void 0:v.length)||0,((g=u==null?void 0:u.values)==null?void 0:g.length)||0);return d!==0?d:Xk(c,u)}(t.mapValue,e.mapValue);case 11:return function(s,o){if(s===np.mapValue&&o===np.mapValue)return 0;if(s===np.mapValue)return 1;if(o===np.mapValue)return-1;const a=s.fields||{},l=Object.keys(a),c=o.fields||{},u=Object.keys(c);l.sort(),u.sort();for(let d=0;d<l.length&&d<u.length;++d){const f=G_(l[d],u[d]);if(f!==0)return f;const p=Mc(a[l[d]],c[u[d]]);if(p!==0)return p}return Oe(l.length,u.length)}(t.mapValue,e.mapValue);default:throw fe(23264,{he:n})}}function Jk(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Oe(t,e);const n=Mo(t),i=Mo(e),r=Oe(n.seconds,i.seconds);return r!==0?r:Oe(n.nanos,i.nanos)}function Xk(t,e){const n=t.values||[],i=e.values||[];for(let r=0;r<n.length&&r<i.length;++r){const s=Mc(n[r],i[r]);if(s)return s}return Oe(n.length,i.length)}function Lc(t){return $_(t)}function $_(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const i=Mo(n);return`time(${i.seconds},${i.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return Lo(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return ue.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let i="[",r=!0;for(const s of n.values||[])r?r=!1:i+=",",i+=$_(s);return i+"]"}(t.arrayValue):"mapValue"in t?function(n){const i=Object.keys(n.fields||{}).sort();let r="{",s=!0;for(const o of i)s?s=!1:r+=",",r+=`${o}:${$_(n.fields[o])}`;return r+"}"}(t.mapValue):fe(61005,{value:t})}function Mp(t){switch(Uo(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ev(t);return e?16+Mp(e):16;case 5:return 2*t.stringValue.length;case 6:return Lo(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((r,s)=>r+Mp(s),0)}(t.arrayValue);case 10:case 11:return function(i){let r=0;return $o(i.fields,(s,o)=>{r+=s.length+Mp(o)}),r}(t.mapValue);default:throw fe(13486,{value:t})}}function W_(t){return!!t&&"integerValue"in t}function TS(t){return!!t&&"arrayValue"in t}function Zk(t){return!!t&&"nullValue"in t}function ew(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Lp(t){return!!t&&"mapValue"in t}function T8(t){var n,i;return((i=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[EO])==null?void 0:i.stringValue)===CO}function Md(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return $o(t.mapValue.fields,(n,i)=>e.mapValue.fields[n]=Md(i)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Md(t.arrayValue.values[n]);return e}return{...t}}function S8(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===b8}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vi{constructor(e){this.value=e}static empty(){return new vi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let i=0;i<e.length-1;++i)if(n=(n.mapValue.fields||{})[e.get(i)],!Lp(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Md(n)}setAll(e){let n=Cn.emptyPath(),i={},r=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,i,r),i={},r=[],n=a.popLast()}o?i[a.lastSegment()]=Md(o):r.push(a.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,i,r)}delete(e){const n=this.field(e.popLast());Lp(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ir(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=n.mapValue.fields[e.get(i)];Lp(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},n.mapValue.fields[e.get(i)]=r),n=r}return n.mapValue.fields}applyChanges(e,n,i){$o(n,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new vi(Md(this.value))}}function kO(t){const e=[];return $o(t.fields,(n,i)=>{const r=new Cn([n]);if(Lp(i)){const s=kO(i.mapValue).fields;if(s.length===0)e.push(r);else for(const o of s)e.push(r.child(o))}else e.push(r)}),new nr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,n,i,r,s,o,a){this.key=e,this.documentType=n,this.version=i,this.readTime=r,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Un(e,0,ye.min(),ye.min(),ye.min(),vi.empty(),0)}static newFoundDocument(e,n,i,r){return new Un(e,1,n,ye.min(),i,r,0)}static newNoDocument(e,n){return new Un(e,2,n,ye.min(),ye.min(),vi.empty(),0)}static newUnknownDocument(e,n){return new Un(e,3,n,ye.min(),ye.min(),vi.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(ye.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=vi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=vi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ye.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Un&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Un(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(e,n){this.position=e,this.inclusive=n}}function tw(t,e,n){let i=0;for(let r=0;r<t.position.length;r++){const s=e[r],o=t.position[r];if(s.field.isKeyField()?i=ue.comparator(ue.fromName(o.referenceValue),n.key):i=Mc(o,n.data.field(s.field)),s.dir==="desc"&&(i*=-1),i!==0)break}return i}function nw(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ir(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{constructor(e,n="asc"){this.field=e,this.dir=n}}function E8(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wO{}class $t extends wO{constructor(e,n,i){super(),this.field=e,this.op=n,this.value=i}static create(e,n,i){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,i):new k8(e,n,i):n==="array-contains"?new A8(e,i):n==="in"?new I8(e,i):n==="not-in"?new P8(e,i):n==="array-contains-any"?new x8(e,i):new $t(e,n,i)}static createKeyFieldInFilter(e,n,i){return n==="in"?new w8(e,i):new R8(e,i)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Mc(n,this.value)):n!==null&&Uo(this.value)===Uo(n)&&this.matchesComparison(Mc(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return fe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Pr extends wO{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new Pr(e,n)}matches(e){return RO(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function RO(t){return t.op==="and"}function AO(t){return C8(t)&&RO(t)}function C8(t){for(const e of t.filters)if(e instanceof Pr)return!1;return!0}function Q_(t){if(t instanceof $t)return t.field.canonicalString()+t.op.toString()+Lc(t.value);if(AO(t))return t.filters.map(e=>Q_(e)).join(",");{const e=t.filters.map(n=>Q_(n)).join(",");return`${t.op}(${e})`}}function IO(t,e){return t instanceof $t?function(i,r){return r instanceof $t&&i.op===r.op&&i.field.isEqual(r.field)&&Ir(i.value,r.value)}(t,e):t instanceof Pr?function(i,r){return r instanceof Pr&&i.op===r.op&&i.filters.length===r.filters.length?i.filters.reduce((s,o,a)=>s&&IO(o,r.filters[a]),!0):!1}(t,e):void fe(19439)}function PO(t){return t instanceof $t?function(n){return`${n.field.canonicalString()} ${n.op} ${Lc(n.value)}`}(t):t instanceof Pr?function(n){return n.op.toString()+" {"+n.getFilters().map(PO).join(" ,")+"}"}(t):"Filter"}class k8 extends $t{constructor(e,n,i){super(e,n,i),this.key=ue.fromName(i.referenceValue)}matches(e){const n=ue.comparator(e.key,this.key);return this.matchesComparison(n)}}class w8 extends $t{constructor(e,n){super(e,"in",n),this.keys=xO("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class R8 extends $t{constructor(e,n){super(e,"not-in",n),this.keys=xO("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function xO(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(i=>ue.fromName(i.referenceValue))}class A8 extends $t{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return TS(n)&&gh(n.arrayValue,this.value)}}class I8 extends $t{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&gh(this.value.arrayValue,n)}}class P8 extends $t{constructor(e,n){super(e,"not-in",n)}matches(e){if(gh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!gh(this.value.arrayValue,n)}}class x8 extends $t{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!TS(n)||!n.arrayValue.values)&&n.arrayValue.values.some(i=>gh(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D8{constructor(e,n=null,i=[],r=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=o,this.endAt=a,this.Te=null}}function iw(t,e=null,n=[],i=[],r=null,s=null,o=null){return new D8(t,e,n,i,r,s,o)}function SS(t){const e=_e(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(i=>Q_(i)).join(","),n+="|ob:",n+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),Zg(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>Lc(i)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>Lc(i)).join(",")),e.Te=n}return e.Te}function ES(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!E8(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!IO(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!nw(t.startAt,e.startAt)&&nw(t.endAt,e.endAt)}function Y_(t){return ue.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tv{constructor(e,n=null,i=[],r=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.Re=null,this.startAt,this.endAt}}function O8(t,e,n,i,r,s,o,a){return new tv(t,e,n,i,r,s,o,a)}function CS(t){return new tv(t)}function rw(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function N8(t){return ue.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function M8(t){return t.collectionGroup!==null}function Ld(t){const e=_e(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),n.add(s.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Yt(Cn.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.Ie.push(new jm(s,i))}),n.has(Cn.keyField().canonicalString())||e.Ie.push(new jm(Cn.keyField(),i))}return e.Ie}function Er(t){const e=_e(t);return e.Ee||(e.Ee=L8(e,Ld(t))),e.Ee}function L8(t,e){if(t.limitType==="F")return iw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(r=>{const s=r.dir==="desc"?"asc":"desc";return new jm(r.field,s)});const n=t.endAt?new Fm(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new Fm(t.startAt.position,t.startAt.inclusive):null;return iw(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}}function J_(t,e,n){return new tv(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function nv(t,e){return ES(Er(t),Er(e))&&t.limitType===e.limitType}function DO(t){return`${SS(Er(t))}|lt:${t.limitType}`}function Dl(t){return`Query(target=${function(n){let i=n.path.canonicalString();return n.collectionGroup!==null&&(i+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(i+=`, filters: [${n.filters.map(r=>PO(r)).join(", ")}]`),Zg(n.limit)||(i+=", limit: "+n.limit),n.orderBy.length>0&&(i+=`, orderBy: [${n.orderBy.map(r=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(r)).join(", ")}]`),n.startAt&&(i+=", startAt: ",i+=n.startAt.inclusive?"b:":"a:",i+=n.startAt.position.map(r=>Lc(r)).join(",")),n.endAt&&(i+=", endAt: ",i+=n.endAt.inclusive?"a:":"b:",i+=n.endAt.position.map(r=>Lc(r)).join(",")),`Target(${i})`}(Er(t))}; limitType=${t.limitType})`}function iv(t,e){return e.isFoundDocument()&&function(i,r){const s=r.key.path;return i.collectionGroup!==null?r.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(s):ue.isDocumentKey(i.path)?i.path.isEqual(s):i.path.isImmediateParentOf(s)}(t,e)&&function(i,r){for(const s of Ld(i))if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1;return!0}(t,e)&&function(i,r){for(const s of i.filters)if(!s.matches(r))return!1;return!0}(t,e)&&function(i,r){return!(i.startAt&&!function(o,a,l){const c=tw(o,a,l);return o.inclusive?c<=0:c<0}(i.startAt,Ld(i),r)||i.endAt&&!function(o,a,l){const c=tw(o,a,l);return o.inclusive?c>=0:c>0}(i.endAt,Ld(i),r))}(t,e)}function U8(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function OO(t){return(e,n)=>{let i=!1;for(const r of Ld(t)){const s=V8(r,e,n);if(s!==0)return s;i=i||r.field.isKeyField()}return 0}}function V8(t,e,n){const i=t.field.isKeyField()?ue.comparator(e.key,n.key):function(s,o,a){const l=o.data.field(s),c=a.data.field(s);return l!==null&&c!==null?Mc(l,c):fe(42886)}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return fe(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class al{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),i=this.inner[n];if(i!==void 0){for(const[r,s]of i)if(this.equalsFn(r,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const i=this.mapKeyFn(e),r=this.inner[i];if(r===void 0)return this.inner[i]=[[e,n]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,n]);r.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return i.length===1?delete this.inner[n]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){$o(this.inner,(n,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return vO(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F8=new zt(ue.comparator);function Ss(){return F8}const NO=new zt(ue.comparator);function pd(...t){let e=NO;for(const n of t)e=e.insert(n.key,n);return e}function MO(t){let e=NO;return t.forEach((n,i)=>e=e.insert(n,i.overlayedDocument)),e}function Sa(){return Ud()}function LO(){return Ud()}function Ud(){return new al(t=>t.toString(),(t,e)=>t.isEqual(e))}const j8=new zt(ue.comparator),B8=new Yt(ue.comparator);function Ne(...t){let e=B8;for(const n of t)e=e.add(n);return e}const q8=new Yt(Oe);function z8(){return q8}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kS(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Lm(e)?"-0":e}}function UO(t){return{integerValue:""+t}}function VO(t,e){return p8(e)?UO(e):kS(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{constructor(){this._=void 0}}function H8(t,e,n){return t instanceof Bm?function(r,s){const o={fields:{[bO]:{stringValue:_O},[SO]:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&bS(s)&&(s=ev(s)),s&&(o.fields[TO]=s),{mapValue:o}}(n,e):t instanceof vh?jO(t,e):t instanceof yh?BO(t,e):function(r,s){const o=FO(r,s),a=sw(o)+sw(r.Ae);return W_(o)&&W_(r.Ae)?UO(a):kS(r.serializer,a)}(t,e)}function G8(t,e,n){return t instanceof vh?jO(t,e):t instanceof yh?BO(t,e):n}function FO(t,e){return t instanceof _h?function(i){return W_(i)||function(s){return!!s&&"doubleValue"in s}(i)}(e)?e:{integerValue:0}:null}class Bm extends rv{}class vh extends rv{constructor(e){super(),this.elements=e}}function jO(t,e){const n=qO(e);for(const i of t.elements)n.some(r=>Ir(r,i))||n.push(i);return{arrayValue:{values:n}}}class yh extends rv{constructor(e){super(),this.elements=e}}function BO(t,e){let n=qO(e);for(const i of t.elements)n=n.filter(r=>!Ir(r,i));return{arrayValue:{values:n}}}class _h extends rv{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function sw(t){return It(t.integerValue||t.doubleValue)}function qO(t){return TS(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K8{constructor(e,n){this.field=e,this.transform=n}}function $8(t,e){return t.field.isEqual(e.field)&&function(i,r){return i instanceof vh&&r instanceof vh||i instanceof yh&&r instanceof yh?Nc(i.elements,r.elements,Ir):i instanceof _h&&r instanceof _h?Ir(i.Ae,r.Ae):i instanceof Bm&&r instanceof Bm}(t.transform,e.transform)}class W8{constructor(e,n){this.version=e,this.transformResults=n}}class hs{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new hs}static exists(e){return new hs(void 0,e)}static updateTime(e){return new hs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Up(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class sv{}function zO(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new GO(t.key,hs.none()):new ov(t.key,t.data,hs.none());{const n=t.data,i=vi.empty();let r=new Yt(Cn.comparator);for(let s of e.fields)if(!r.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?i.delete(s):i.set(s,o),r=r.add(s)}return new ll(t.key,i,new nr(r.toArray()),hs.none())}}function Q8(t,e,n){t instanceof ov?function(r,s,o){const a=r.value.clone(),l=aw(r.fieldTransforms,s,o.transformResults);a.setAll(l),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof ll?function(r,s,o){if(!Up(r.precondition,s))return void s.convertToUnknownDocument(o.version);const a=aw(r.fieldTransforms,s,o.transformResults),l=s.data;l.setAll(HO(r)),l.setAll(a),s.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):function(r,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function Vd(t,e,n,i){return t instanceof ov?function(s,o,a,l){if(!Up(s.precondition,o))return a;const c=s.value.clone(),u=lw(s.fieldTransforms,l,o);return c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(t,e,n,i):t instanceof ll?function(s,o,a,l){if(!Up(s.precondition,o))return a;const c=lw(s.fieldTransforms,l,o),u=o.data;return u.setAll(HO(s)),u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(d=>d.field))}(t,e,n,i):function(s,o,a){return Up(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function Y8(t,e){let n=null;for(const i of t.fieldTransforms){const r=e.data.field(i.field),s=FO(i.transform,r||null);s!=null&&(n===null&&(n=vi.empty()),n.set(i.field,s))}return n||null}function ow(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(i,r){return i===void 0&&r===void 0||!(!i||!r)&&Nc(i,r,(s,o)=>$8(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ov extends sv{constructor(e,n,i,r=[]){super(),this.key=e,this.value=n,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ll extends sv{constructor(e,n,i,r,s=[]){super(),this.key=e,this.data=n,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function HO(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}}),e}function aw(t,e,n){const i=new Map;Qe(t.length===n.length,32656,{Ve:n.length,de:t.length});for(let r=0;r<n.length;r++){const s=t[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,G8(o,a,n[r]))}return i}function lw(t,e,n){const i=new Map;for(const r of t){const s=r.transform,o=n.data.field(r.field);i.set(r.field,H8(s,o,e))}return i}class GO extends sv{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class J8 extends sv{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X8{constructor(e,n,i,r){this.batchId=e,this.localWriteTime=n,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,n){const i=n.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&Q8(s,e,i[r])}}applyToLocalView(e,n){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(n=Vd(i,e,n,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(n=Vd(i,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const i=LO();return this.mutations.forEach(r=>{const s=e.get(r.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=n.has(r.key)?null:a;const l=zO(o,a);l!==null&&i.set(r.key,l),o.isValidDocument()||o.convertToNoDocument(ye.min())}),i}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ne())}isEqual(e){return this.batchId===e.batchId&&Nc(this.mutations,e.mutations,(n,i)=>ow(n,i))&&Nc(this.baseMutations,e.baseMutations,(n,i)=>ow(n,i))}}class wS{constructor(e,n,i,r){this.batch=e,this.commitVersion=n,this.mutationResults=i,this.docVersions=r}static from(e,n,i){Qe(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let r=function(){return j8}();const s=e.mutations;for(let o=0;o<s.length;o++)r=r.insert(s[o].key,i[o].version);return new wS(e,n,i,r)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z8{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lt,Ve;function tj(t){switch(t){case Y.OK:return fe(64938);case Y.CANCELLED:case Y.UNKNOWN:case Y.DEADLINE_EXCEEDED:case Y.RESOURCE_EXHAUSTED:case Y.INTERNAL:case Y.UNAVAILABLE:case Y.UNAUTHENTICATED:return!1;case Y.INVALID_ARGUMENT:case Y.NOT_FOUND:case Y.ALREADY_EXISTS:case Y.PERMISSION_DENIED:case Y.FAILED_PRECONDITION:case Y.ABORTED:case Y.OUT_OF_RANGE:case Y.UNIMPLEMENTED:case Y.DATA_LOSS:return!0;default:return fe(15467,{code:t})}}function KO(t){if(t===void 0)return Ts("GRPC error has no .code"),Y.UNKNOWN;switch(t){case Lt.OK:return Y.OK;case Lt.CANCELLED:return Y.CANCELLED;case Lt.UNKNOWN:return Y.UNKNOWN;case Lt.DEADLINE_EXCEEDED:return Y.DEADLINE_EXCEEDED;case Lt.RESOURCE_EXHAUSTED:return Y.RESOURCE_EXHAUSTED;case Lt.INTERNAL:return Y.INTERNAL;case Lt.UNAVAILABLE:return Y.UNAVAILABLE;case Lt.UNAUTHENTICATED:return Y.UNAUTHENTICATED;case Lt.INVALID_ARGUMENT:return Y.INVALID_ARGUMENT;case Lt.NOT_FOUND:return Y.NOT_FOUND;case Lt.ALREADY_EXISTS:return Y.ALREADY_EXISTS;case Lt.PERMISSION_DENIED:return Y.PERMISSION_DENIED;case Lt.FAILED_PRECONDITION:return Y.FAILED_PRECONDITION;case Lt.ABORTED:return Y.ABORTED;case Lt.OUT_OF_RANGE:return Y.OUT_OF_RANGE;case Lt.UNIMPLEMENTED:return Y.UNIMPLEMENTED;case Lt.DATA_LOSS:return Y.DATA_LOSS;default:return fe(39323,{code:t})}}(Ve=Lt||(Lt={}))[Ve.OK=0]="OK",Ve[Ve.CANCELLED=1]="CANCELLED",Ve[Ve.UNKNOWN=2]="UNKNOWN",Ve[Ve.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ve[Ve.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ve[Ve.NOT_FOUND=5]="NOT_FOUND",Ve[Ve.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ve[Ve.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ve[Ve.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ve[Ve.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ve[Ve.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ve[Ve.ABORTED=10]="ABORTED",Ve[Ve.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ve[Ve.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ve[Ve.INTERNAL=13]="INTERNAL",Ve[Ve.UNAVAILABLE=14]="UNAVAILABLE",Ve[Ve.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nj(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ij=new Eo([4294967295,4294967295],0);function cw(t){const e=nj().encode(t),n=new oO;return n.update(e),new Uint8Array(n.digest())}function uw(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Eo([n,i],0),new Eo([r,s],0)]}class RS{constructor(e,n,i){if(this.bitmap=e,this.padding=n,this.hashCount=i,n<0||n>=8)throw new md(`Invalid padding: ${n}`);if(i<0)throw new md(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new md(`Invalid hash count: ${i}`);if(e.length===0&&n!==0)throw new md(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Eo.fromNumber(this.ge)}ye(e,n,i){let r=e.add(n.multiply(Eo.fromNumber(i)));return r.compare(ij)===1&&(r=new Eo([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=cw(e),[i,r]=uw(n);for(let s=0;s<this.hashCount;s++){const o=this.ye(i,r,s);if(!this.we(o))return!1}return!0}static create(e,n,i){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new RS(s,r,n);return i.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const n=cw(e),[i,r]=uw(n);for(let s=0;s<this.hashCount;s++){const o=this.ye(i,r,s);this.be(o)}}be(e){const n=Math.floor(e/8),i=e%8;this.bitmap[n]|=1<<i}}class md extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class av{constructor(e,n,i,r,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,i){const r=new Map;return r.set(e,tf.createSynthesizedTargetChangeForCurrentChange(e,n,i)),new av(ye.min(),r,new zt(Oe),Ss(),Ne())}}class tf{constructor(e,n,i,r,s){this.resumeToken=e,this.current=n,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,i){return new tf(i,n,Ne(),Ne(),Ne())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e,n,i,r){this.Se=e,this.removedTargetIds=n,this.key=i,this.De=r}}class $O{constructor(e,n){this.targetId=e,this.Ce=n}}class WO{constructor(e,n,i=In.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=n,this.resumeToken=i,this.cause=r}}class dw{constructor(){this.ve=0,this.Fe=hw(),this.Me=In.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ne(),n=Ne(),i=Ne();return this.Fe.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:n=n.add(r);break;case 1:i=i.add(r);break;default:fe(38017,{changeType:s})}}),new tf(this.Me,this.xe,e,n,i)}Ke(){this.Oe=!1,this.Fe=hw()}qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}Ue(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}$e(){this.ve+=1}We(){this.ve-=1,Qe(this.ve>=0,3241,{ve:this.ve})}Qe(){this.Oe=!0,this.xe=!0}}class rj{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ss(),this.He=ip(),this.Je=ip(),this.Ze=new zt(Oe)}Xe(e){for(const n of e.Se)e.De&&e.De.isFoundDocument()?this.Ye(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const i=this.nt(n);switch(e.state){case 0:this.rt(n)&&i.Le(e.resumeToken);break;case 1:i.We(),i.Ne||i.Ke(),i.Le(e.resumeToken);break;case 2:i.We(),i.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(i.Qe(),i.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),i.Le(e.resumeToken));break;default:fe(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((i,r)=>{this.rt(r)&&n(r)})}st(e){const n=e.targetId,i=e.Ce.count,r=this.ot(n);if(r){const s=r.target;if(Y_(s))if(i===0){const o=new ue(s.path);this.et(n,o,Un.newNoDocument(o,ye.min()))}else Qe(i===1,20013,{expectedCount:i});else{const o=this._t(n);if(o!==i){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(n);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(n,c)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:i="",padding:r=0},hashCount:s=0}=n;let o,a;try{o=Lo(i).toUint8Array()}catch(l){if(l instanceof yO)return Ba("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new RS(o,r,s)}catch(l){return Ba(l instanceof md?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,n,i){return n.Ce.count===i-this.Pt(e,n.targetId)?0:2}Pt(e,n){const i=this.Ge.getRemoteKeysForTarget(n);let r=0;return i.forEach(s=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.et(n,s,null),r++)}),r}Tt(e){const n=new Map;this.ze.forEach((s,o)=>{const a=this.ot(o);if(a){if(s.current&&Y_(a.target)){const l=new ue(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Un.newNoDocument(l,e))}s.Be&&(n.set(o,s.ke()),s.Ke())}});let i=Ne();this.Je.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.ot(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(i=i.add(s))}),this.je.forEach((s,o)=>o.setReadTime(e));const r=new av(e,n,this.Ze,this.je,i);return this.je=Ss(),this.He=ip(),this.Je=ip(),this.Ze=new zt(Oe),r}Ye(e,n){if(!this.rt(e))return;const i=this.Et(e,n.key)?2:0;this.nt(e).qe(n.key,i),this.je=this.je.insert(n.key,n),this.He=this.He.insert(n.key,this.It(n.key).add(e)),this.Je=this.Je.insert(n.key,this.Rt(n.key).add(e))}et(e,n,i){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,n)?r.qe(n,1):r.Ue(n),this.Je=this.Je.insert(n,this.Rt(n).delete(e)),this.Je=this.Je.insert(n,this.Rt(n).add(e)),i&&(this.je=this.je.insert(n,i))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}$e(e){this.nt(e).$e()}nt(e){let n=this.ze.get(e);return n||(n=new dw,this.ze.set(e,n)),n}Rt(e){let n=this.Je.get(e);return n||(n=new Yt(Oe),this.Je=this.Je.insert(e,n)),n}It(e){let n=this.He.get(e);return n||(n=new Yt(Oe),this.He=this.He.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||ie("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new dw),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function ip(){return new zt(ue.comparator)}function hw(){return new zt(ue.comparator)}const sj={asc:"ASCENDING",desc:"DESCENDING"},oj={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aj={and:"AND",or:"OR"};class lj{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function X_(t,e){return t.useProto3Json||Zg(e)?e:{value:e}}function qm(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function QO(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function cj(t,e){return qm(t,e.toTimestamp())}function Cr(t){return Qe(!!t,49232),ye.fromTimestamp(function(n){const i=Mo(n);return new mn(i.seconds,i.nanos)}(t))}function AS(t,e){return Z_(t,e).canonicalString()}function Z_(t,e){const n=function(r){return new ft(["projects",r.projectId,"databases",r.database])}(t).child("documents");return e===void 0?n:n.child(e)}function YO(t){const e=ft.fromString(t);return Qe(tN(e),10190,{key:e.toString()}),e}function eb(t,e){return AS(t.databaseId,e.path)}function Qy(t,e){const n=YO(e);if(n.get(1)!==t.databaseId.projectId)throw new oe(Y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new oe(Y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ue(XO(n))}function JO(t,e){return AS(t.databaseId,e)}function uj(t){const e=YO(t);return e.length===4?ft.emptyPath():XO(e)}function tb(t){return new ft(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function XO(t){return Qe(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function fw(t,e,n){return{name:eb(t,e),fields:n.value.mapValue.fields}}function dj(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:fe(39313,{state:c})}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(c,u){return c.useProto3Json?(Qe(u===void 0||typeof u=="string",58123),In.fromBase64String(u||"")):(Qe(u===void 0||u instanceof Buffer||u instanceof Uint8Array,16193),In.fromUint8Array(u||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const u=c.code===void 0?Y.UNKNOWN:KO(c.code);return new oe(u,c.message||"")}(o);n=new WO(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=Qy(t,i.document.name),s=Cr(i.document.updateTime),o=i.document.createTime?Cr(i.document.createTime):ye.min(),a=new vi({mapValue:{fields:i.document.fields}}),l=Un.newFoundDocument(r,s,o,a),c=i.targetIds||[],u=i.removedTargetIds||[];n=new Vp(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=Qy(t,i.document),s=i.readTime?Cr(i.readTime):ye.min(),o=Un.newNoDocument(r,s),a=i.removedTargetIds||[];n=new Vp([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=Qy(t,i.document),s=i.removedTargetIds||[];n=new Vp([],s,r,null)}else{if(!("filter"in e))return fe(11601,{Vt:e});{e.filter;const i=e.filter;i.targetId;const{count:r=0,unchangedNames:s}=i,o=new ej(r,s),a=i.targetId;n=new $O(a,o)}}return n}function hj(t,e){let n;if(e instanceof ov)n={update:fw(t,e.key,e.value)};else if(e instanceof GO)n={delete:eb(t,e.key)};else if(e instanceof ll)n={update:fw(t,e.key,e.data),updateMask:Tj(e.fieldMask)};else{if(!(e instanceof J8))return fe(16599,{dt:e.type});n={verify:eb(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(i=>function(s,o){const a=o.transform;if(a instanceof Bm)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof vh)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof yh)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof _h)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw fe(20930,{transform:o.transform})}(0,i))),e.precondition.isNone||(n.currentDocument=function(r,s){return s.updateTime!==void 0?{updateTime:cj(r,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:fe(27497)}(t,e.precondition)),n}function fj(t,e){return t&&t.length>0?(Qe(e!==void 0,14353),t.map(n=>function(r,s){let o=r.updateTime?Cr(r.updateTime):Cr(s);return o.isEqual(ye.min())&&(o=Cr(s)),new W8(o,r.transformResults||[])}(n,e))):[]}function pj(t,e){return{documents:[JO(t,e.path)]}}function mj(t,e){const n={structuredQuery:{}},i=e.path;let r;e.collectionGroup!==null?(r=i,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=JO(t,r);const s=function(c){if(c.length!==0)return eN(Pr.create(c,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(c){if(c.length!==0)return c.map(u=>function(f){return{field:Ol(f.field),direction:yj(f.dir)}}(u))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=X_(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ft:n,parent:r}}function gj(t){let e=uj(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){Qe(i===1,65062);const u=n.from[0];u.allDescendants?r=u.collectionId:e=e.child(u.collectionId)}let s=[];n.where&&(s=function(d){const f=ZO(d);return f instanceof Pr&&AO(f)?f.getFilters():[f]}(n.where));let o=[];n.orderBy&&(o=function(d){return d.map(f=>function(v){return new jm(Nl(v.field),function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(f))}(n.orderBy));let a=null;n.limit&&(a=function(d){let f;return f=typeof d=="object"?d.value:d,Zg(f)?null:f}(n.limit));let l=null;n.startAt&&(l=function(d){const f=!!d.before,p=d.values||[];return new Fm(p,f)}(n.startAt));let c=null;return n.endAt&&(c=function(d){const f=!d.before,p=d.values||[];return new Fm(p,f)}(n.endAt)),O8(e,r,o,s,a,"F",l,c)}function vj(t,e){const n=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fe(28987,{purpose:r})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function ZO(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const i=Nl(n.unaryFilter.field);return $t.create(i,"==",{doubleValue:NaN});case"IS_NULL":const r=Nl(n.unaryFilter.field);return $t.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Nl(n.unaryFilter.field);return $t.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Nl(n.unaryFilter.field);return $t.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return fe(61313);default:return fe(60726)}}(t):t.fieldFilter!==void 0?function(n){return $t.create(Nl(n.fieldFilter.field),function(r){switch(r){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return fe(58110);default:return fe(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Pr.create(n.compositeFilter.filters.map(i=>ZO(i)),function(r){switch(r){case"AND":return"and";case"OR":return"or";default:return fe(1026)}}(n.compositeFilter.op))}(t):fe(30097,{filter:t})}function yj(t){return sj[t]}function _j(t){return oj[t]}function bj(t){return aj[t]}function Ol(t){return{fieldPath:t.canonicalString()}}function Nl(t){return Cn.fromServerFormat(t.fieldPath)}function eN(t){return t instanceof $t?function(n){if(n.op==="=="){if(ew(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NAN"}};if(Zk(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(ew(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NOT_NAN"}};if(Zk(n.value))return{unaryFilter:{field:Ol(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ol(n.field),op:_j(n.op),value:n.value}}}(t):t instanceof Pr?function(n){const i=n.getFilters().map(r=>eN(r));return i.length===1?i[0]:{compositeFilter:{op:bj(n.op),filters:i}}}(t):fe(54877,{filter:t})}function Tj(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function tN(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}function nN(t){return!!t&&typeof t._toProto=="function"&&t._protoValueType==="ProtoValue"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(e,n,i,r,s=ye.min(),o=ye.min(),a=In.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new oo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new oo(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new oo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new oo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sj{constructor(e){this.yt=e}}function Ej(t){const e=gj({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?J_(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(){this.Sn=new kj}addToCollectionParentIndex(e,n){return this.Sn.add(n),W.resolve()}getCollectionParents(e,n){return W.resolve(this.Sn.getEntries(n))}addFieldIndex(e,n){return W.resolve()}deleteFieldIndex(e,n){return W.resolve()}deleteAllFieldIndexes(e){return W.resolve()}createTargetIndexes(e,n){return W.resolve()}getDocumentsMatchingTarget(e,n){return W.resolve(null)}getIndexType(e,n){return W.resolve(0)}getFieldIndexes(e,n){return W.resolve([])}getNextCollectionGroupToUpdate(e){return W.resolve(null)}getMinOffset(e,n){return W.resolve(No.min())}getMinOffsetFromCollectionGroup(e,n){return W.resolve(No.min())}updateCollectionGroup(e,n,i){return W.resolve()}updateIndexEntries(e,n){return W.resolve()}}class kj{constructor(){this.index={}}add(e){const n=e.lastSegment(),i=e.popLast(),r=this.index[n]||new Yt(ft.comparator),s=!r.has(i);return this.index[n]=r.add(i),s}has(e){const n=e.lastSegment(),i=e.popLast(),r=this.index[n];return r&&r.has(i)}getEntries(e){return(this.index[e]||new Yt(ft.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},iN=41943040;class ei{static withCacheSize(e){return new ei(e,ei.DEFAULT_COLLECTION_PERCENTILE,ei.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ei.DEFAULT_COLLECTION_PERCENTILE=10,ei.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ei.DEFAULT=new ei(iN,ei.DEFAULT_COLLECTION_PERCENTILE,ei.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ei.DISABLED=new ei(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e){this.sr=e}next(){return this.sr+=2,this.sr}static _r(){return new Uc(0)}static ar(){return new Uc(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mw="LruGarbageCollector",wj=1048576;function gw([t,e],[n,i]){const r=Oe(t,n);return r===0?Oe(e,i):r}class Rj{constructor(e){this.Pr=e,this.buffer=new Yt(gw),this.Tr=0}Ir(){return++this.Tr}Er(e){const n=[e,this.Ir()];if(this.buffer.size<this.Pr)this.buffer=this.buffer.add(n);else{const i=this.buffer.last();gw(n,i)<0&&(this.buffer=this.buffer.delete(i).add(n))}}get maxValue(){return this.buffer.last()[0]}}class Aj{constructor(e,n,i){this.garbageCollector=e,this.asyncQueue=n,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Ar(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Ar(e){ie(mw,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){au(n)?ie(mw,"Ignoring IndexedDB error during garbage collection: ",n):await ou(n)}await this.Ar(3e5)})}}class Ij{constructor(e,n){this.Vr=e,this.params=n}calculateTargetCount(e,n){return this.Vr.dr(e).next(i=>Math.floor(n/100*i))}nthSequenceNumber(e,n){if(n===0)return W.resolve(Xg.ce);const i=new Rj(n);return this.Vr.forEachTarget(e,r=>i.Er(r.sequenceNumber)).next(()=>this.Vr.mr(e,r=>i.Er(r))).next(()=>i.maxValue)}removeTargets(e,n,i){return this.Vr.removeTargets(e,n,i)}removeOrphanedDocuments(e,n){return this.Vr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(ie("LruGarbageCollector","Garbage collection skipped; disabled"),W.resolve(pw)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(ie("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),pw):this.gr(e,n))}getCacheSize(e){return this.Vr.getCacheSize(e)}gr(e,n){let i,r,s,o,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(ie("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),r=this.params.maximumSequenceNumbersToCollect):r=d,o=Date.now(),this.nthSequenceNumber(e,r))).next(d=>(i=d,a=Date.now(),this.removeTargets(e,i,n))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,i))).next(d=>(c=Date.now(),xl()<=Le.DEBUG&&ie("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${r} in `+(a-o)+`ms
	Removed ${s} targets in `+(l-a)+`ms
	Removed ${d} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),W.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:d})))}}function Pj(t,e){return new Ij(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xj{constructor(){this.changes=new al(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Un.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const i=this.changes.get(n);return i!==void 0?W.resolve(i):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dj{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oj{constructor(e,n,i,r){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,n){let i=null;return this.documentOverlayCache.getOverlay(e,n).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,n))).next(r=>(i!==null&&Vd(i.mutation,r,nr.empty(),mn.now()),r))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(i=>this.getLocalViewOfDocuments(e,i,Ne()).next(()=>i))}getLocalViewOfDocuments(e,n,i=Ne()){const r=Sa();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,i).next(s=>{let o=pd();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const i=Sa();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,Ne()))}populateOverlays(e,n,i){const r=[];return i.forEach(s=>{n.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,i,r){let s=Ss();const o=Ud(),a=function(){return Ud()}();return n.forEach((l,c)=>{const u=i.get(c.key);r.has(c.key)&&(u===void 0||u.mutation instanceof ll)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),Vd(u.mutation,c,u.mutation.getFieldMask(),mn.now())):o.set(c.key,nr.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),n.forEach((c,u)=>a.set(c,new Dj(u,o.get(c)??null))),a))}recalculateAndSaveOverlays(e,n){const i=Ud();let r=new zt((o,a)=>o-a),s=Ne();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=n.get(l);if(c===null)return;let u=i.get(l)||nr.empty();u=a.applyToLocalView(c,u),i.set(l,u);const d=(r.get(a.batchId)||Ne()).add(l);r=r.insert(a.batchId,d)})}).next(()=>{const o=[],a=r.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,d=LO();u.forEach(f=>{if(!s.has(f)){const p=zO(n.get(f),i.get(f));p!==null&&d.set(f,p),s=s.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return W.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,n,i,r){return N8(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):M8(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,i,r):this.getDocumentsMatchingCollectionQuery(e,n,i,r)}getNextDocuments(e,n,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,i,r).next(s=>{const o=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,i.largestBatchId,r-s.size):W.resolve(Sa());let a=fh,l=s;return o.next(c=>W.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?W.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Ne())).next(u=>({batchId:a,changes:MO(u)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new ue(n)).next(i=>{let r=pd();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,n,i,r){const s=n.collectionGroup;let o=pd();return this.indexManager.getCollectionParents(e,s).next(a=>W.forEach(a,l=>{const c=function(d,f){return new tv(f,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(n,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,i,r).next(u=>{u.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,i,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,i.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,i,s,r))).next(o=>{s.forEach((l,c)=>{const u=c.getKey();o.get(u)===null&&(o=o.insert(u,Un.newInvalidDocument(u)))});let a=pd();return o.forEach((l,c)=>{const u=s.get(l);u!==void 0&&Vd(u.mutation,c,nr.empty(),mn.now()),iv(n,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nj{constructor(e){this.serializer=e,this.Nr=new Map,this.Br=new Map}getBundleMetadata(e,n){return W.resolve(this.Nr.get(n))}saveBundleMetadata(e,n){return this.Nr.set(n.id,function(r){return{id:r.id,version:r.version,createTime:Cr(r.createTime)}}(n)),W.resolve()}getNamedQuery(e,n){return W.resolve(this.Br.get(n))}saveNamedQuery(e,n){return this.Br.set(n.name,function(r){return{name:r.name,query:Ej(r.bundledQuery),readTime:Cr(r.readTime)}}(n)),W.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mj{constructor(){this.overlays=new zt(ue.comparator),this.Lr=new Map}getOverlay(e,n){return W.resolve(this.overlays.get(n))}getOverlays(e,n){const i=Sa();return W.forEach(n,r=>this.getOverlay(e,r).next(s=>{s!==null&&i.set(r,s)})).next(()=>i)}saveOverlays(e,n,i){return i.forEach((r,s)=>{this.bt(e,n,s)}),W.resolve()}removeOverlaysForBatchId(e,n,i){const r=this.Lr.get(i);return r!==void 0&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.Lr.delete(i)),W.resolve()}getOverlaysForCollection(e,n,i){const r=Sa(),s=n.length+1,o=new ue(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!n.isPrefixOf(c.path))break;c.path.length===s&&l.largestBatchId>i&&r.set(l.getKey(),l)}return W.resolve(r)}getOverlaysForCollectionGroup(e,n,i,r){let s=new zt((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===n&&c.largestBatchId>i){let u=s.get(c.largestBatchId);u===null&&(u=Sa(),s=s.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=Sa(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=r)););return W.resolve(a)}bt(e,n,i){const r=this.overlays.get(i.key);if(r!==null){const o=this.Lr.get(r.largestBatchId).delete(i.key);this.Lr.set(r.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Z8(n,i));let s=this.Lr.get(n);s===void 0&&(s=Ne(),this.Lr.set(n,s)),this.Lr.set(n,s.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lj{constructor(){this.sessionToken=In.EMPTY_BYTE_STRING}getSessionToken(e){return W.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,W.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IS{constructor(){this.kr=new Yt(an.Kr),this.qr=new Yt(an.Ur)}isEmpty(){return this.kr.isEmpty()}addReference(e,n){const i=new an(e,n);this.kr=this.kr.add(i),this.qr=this.qr.add(i)}$r(e,n){e.forEach(i=>this.addReference(i,n))}removeReference(e,n){this.Wr(new an(e,n))}Qr(e,n){e.forEach(i=>this.removeReference(i,n))}Gr(e){const n=new ue(new ft([])),i=new an(n,e),r=new an(n,e+1),s=[];return this.qr.forEachInRange([i,r],o=>{this.Wr(o),s.push(o.key)}),s}zr(){this.kr.forEach(e=>this.Wr(e))}Wr(e){this.kr=this.kr.delete(e),this.qr=this.qr.delete(e)}jr(e){const n=new ue(new ft([])),i=new an(n,e),r=new an(n,e+1);let s=Ne();return this.qr.forEachInRange([i,r],o=>{s=s.add(o.key)}),s}containsKey(e){const n=new an(e,0),i=this.kr.firstAfterOrEqual(n);return i!==null&&e.isEqual(i.key)}}class an{constructor(e,n){this.key=e,this.Hr=n}static Kr(e,n){return ue.comparator(e.key,n.key)||Oe(e.Hr,n.Hr)}static Ur(e,n){return Oe(e.Hr,n.Hr)||ue.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uj{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Yn=1,this.Jr=new Yt(an.Kr)}checkEmpty(e){return W.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,i,r){const s=this.Yn;this.Yn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new X8(s,n,i,r);this.mutationQueue.push(o);for(const a of r)this.Jr=this.Jr.add(new an(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return W.resolve(o)}lookupMutationBatch(e,n){return W.resolve(this.Zr(n))}getNextMutationBatchAfterBatchId(e,n){const i=n+1,r=this.Xr(i),s=r<0?0:r;return W.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return W.resolve(this.mutationQueue.length===0?_S:this.Yn-1)}getAllMutationBatches(e){return W.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const i=new an(n,0),r=new an(n,Number.POSITIVE_INFINITY),s=[];return this.Jr.forEachInRange([i,r],o=>{const a=this.Zr(o.Hr);s.push(a)}),W.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let i=new Yt(Oe);return n.forEach(r=>{const s=new an(r,0),o=new an(r,Number.POSITIVE_INFINITY);this.Jr.forEachInRange([s,o],a=>{i=i.add(a.Hr)})}),W.resolve(this.Yr(i))}getAllMutationBatchesAffectingQuery(e,n){const i=n.path,r=i.length+1;let s=i;ue.isDocumentKey(s)||(s=s.child(""));const o=new an(new ue(s),0);let a=new Yt(Oe);return this.Jr.forEachWhile(l=>{const c=l.key.path;return!!i.isPrefixOf(c)&&(c.length===r&&(a=a.add(l.Hr)),!0)},o),W.resolve(this.Yr(a))}Yr(e){const n=[];return e.forEach(i=>{const r=this.Zr(i);r!==null&&n.push(r)}),n}removeMutationBatch(e,n){Qe(this.ei(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Jr;return W.forEach(n.mutations,r=>{const s=new an(r.key,n.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Jr=i})}nr(e){}containsKey(e,n){const i=new an(n,0),r=this.Jr.firstAfterOrEqual(i);return W.resolve(n.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,W.resolve()}ei(e,n){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const n=this.Xr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vj{constructor(e){this.ti=e,this.docs=function(){return new zt(ue.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const i=n.key,r=this.docs.get(i),s=r?r.size:0,o=this.ti(n);return this.docs=this.docs.insert(i,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const i=this.docs.get(n);return W.resolve(i?i.document.mutableCopy():Un.newInvalidDocument(n))}getEntries(e,n){let i=Ss();return n.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():Un.newInvalidDocument(r))}),W.resolve(i)}getDocumentsMatchingQuery(e,n,i,r){let s=Ss();const o=n.path,a=new ue(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||u8(c8(u),i)<=0||(r.has(u.key)||iv(n,u))&&(s=s.insert(u.key,u.mutableCopy()))}return W.resolve(s)}getAllFromCollectionGroup(e,n,i,r){fe(9500)}ni(e,n){return W.forEach(this.docs,i=>n(i))}newChangeBuffer(e){return new Fj(this)}getSize(e){return W.resolve(this.size)}}class Fj extends xj{constructor(e){super(),this.Mr=e}applyChanges(e){const n=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?n.push(this.Mr.addEntry(e,r)):this.Mr.removeEntry(i)}),W.waitFor(n)}getFromCache(e,n){return this.Mr.getEntry(e,n)}getAllFromCache(e,n){return this.Mr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jj{constructor(e){this.persistence=e,this.ri=new al(n=>SS(n),ES),this.lastRemoteSnapshotVersion=ye.min(),this.highestTargetId=0,this.ii=0,this.si=new IS,this.targetCount=0,this.oi=Uc._r()}forEachTarget(e,n){return this.ri.forEach((i,r)=>n(r)),W.resolve()}getLastRemoteSnapshotVersion(e){return W.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return W.resolve(this.ii)}allocateTargetId(e){return this.highestTargetId=this.oi.next(),W.resolve(this.highestTargetId)}setTargetsMetadata(e,n,i){return i&&(this.lastRemoteSnapshotVersion=i),n>this.ii&&(this.ii=n),W.resolve()}lr(e){this.ri.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.oi=new Uc(n),this.highestTargetId=n),e.sequenceNumber>this.ii&&(this.ii=e.sequenceNumber)}addTargetData(e,n){return this.lr(n),this.targetCount+=1,W.resolve()}updateTargetData(e,n){return this.lr(n),W.resolve()}removeTargetData(e,n){return this.ri.delete(n.target),this.si.Gr(n.targetId),this.targetCount-=1,W.resolve()}removeTargets(e,n,i){let r=0;const s=[];return this.ri.forEach((o,a)=>{a.sequenceNumber<=n&&i.get(a.targetId)===null&&(this.ri.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),W.waitFor(s).next(()=>r)}getTargetCount(e){return W.resolve(this.targetCount)}getTargetData(e,n){const i=this.ri.get(n)||null;return W.resolve(i)}addMatchingKeys(e,n,i){return this.si.$r(n,i),W.resolve()}removeMatchingKeys(e,n,i){this.si.Qr(n,i);const r=this.persistence.referenceDelegate,s=[];return r&&n.forEach(o=>{s.push(r.markPotentiallyOrphaned(e,o))}),W.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.si.Gr(n),W.resolve()}getMatchingKeysForTargetId(e,n){const i=this.si.jr(n);return W.resolve(i)}containsKey(e,n){return W.resolve(this.si.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN{constructor(e,n){this._i={},this.overlays={},this.ai=new Xg(0),this.ui=!1,this.ui=!0,this.ci=new Lj,this.referenceDelegate=e(this),this.li=new jj(this),this.indexManager=new Cj,this.remoteDocumentCache=function(r){return new Vj(r)}(i=>this.referenceDelegate.hi(i)),this.serializer=new Sj(n),this.Pi=new Nj(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ui=!1,Promise.resolve()}get started(){return this.ui}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new Mj,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let i=this._i[e.toKey()];return i||(i=new Uj(n,this.referenceDelegate),this._i[e.toKey()]=i),i}getGlobalsCache(){return this.ci}getTargetCache(){return this.li}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Pi}runTransaction(e,n,i){ie("MemoryPersistence","Starting transaction:",e);const r=new Bj(this.ai.next());return this.referenceDelegate.Ti(),i(r).next(s=>this.referenceDelegate.Ii(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ei(e,n){return W.or(Object.values(this._i).map(i=>()=>i.containsKey(e,n)))}}class Bj extends h8{constructor(e){super(),this.currentSequenceNumber=e}}class PS{constructor(e){this.persistence=e,this.Ri=new IS,this.Ai=null}static Vi(e){return new PS(e)}get di(){if(this.Ai)return this.Ai;throw fe(60996)}addReference(e,n,i){return this.Ri.addReference(i,n),this.di.delete(i.toString()),W.resolve()}removeReference(e,n,i){return this.Ri.removeReference(i,n),this.di.add(i.toString()),W.resolve()}markPotentiallyOrphaned(e,n){return this.di.add(n.toString()),W.resolve()}removeTarget(e,n){this.Ri.Gr(n.targetId).forEach(r=>this.di.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,n.targetId).next(r=>{r.forEach(s=>this.di.add(s.toString()))}).next(()=>i.removeTargetData(e,n))}Ti(){this.Ai=new Set}Ii(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return W.forEach(this.di,i=>{const r=ue.fromPath(i);return this.mi(e,r).next(s=>{s||n.removeEntry(r,ye.min())})}).next(()=>(this.Ai=null,n.apply(e)))}updateLimboDocument(e,n){return this.mi(e,n).next(i=>{i?this.di.delete(n.toString()):this.di.add(n.toString())})}hi(e){return 0}mi(e,n){return W.or([()=>W.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ei(e,n)])}}class zm{constructor(e,n){this.persistence=e,this.fi=new al(i=>m8(i.path),(i,r)=>i.isEqual(r)),this.garbageCollector=Pj(this,n)}static Vi(e,n){return new zm(e,n)}Ti(){}Ii(e){return W.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}dr(e){const n=this.pr(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>n.next(r=>i+r))}pr(e){let n=0;return this.mr(e,i=>{n++}).next(()=>n)}mr(e,n){return W.forEach(this.fi,(i,r)=>this.wr(e,i,r).next(s=>s?W.resolve():n(r)))}removeTargets(e,n,i){return this.persistence.getTargetCache().removeTargets(e,n,i)}removeOrphanedDocuments(e,n){let i=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ni(e,o=>this.wr(e,o,n).next(a=>{a||(i++,s.removeEntry(o,ye.min()))})).next(()=>s.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,n){return this.fi.set(n,e.currentSequenceNumber),W.resolve()}removeTarget(e,n){const i=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,n,i){return this.fi.set(i,e.currentSequenceNumber),W.resolve()}removeReference(e,n,i){return this.fi.set(i,e.currentSequenceNumber),W.resolve()}updateLimboDocument(e,n){return this.fi.set(n,e.currentSequenceNumber),W.resolve()}hi(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Mp(e.data.value)),n}wr(e,n,i){return W.or([()=>this.persistence.Ei(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const r=this.fi.get(n);return W.resolve(r!==void 0&&r>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xS{constructor(e,n,i,r){this.targetId=e,this.fromCache=n,this.Ts=i,this.Is=r}static Es(e,n){let i=Ne(),r=Ne();for(const s of n.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new xS(e,n.fromCache,i,r)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qj{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zj{constructor(){this.Rs=!1,this.As=!1,this.Vs=100,this.ds=function(){return x9()?8:f8($D())>0?6:4}()}initialize(e,n){this.fs=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,i,r){const s={result:null};return this.gs(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ps(e,n,r,i).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new qj;return this.ys(e,n,o).next(a=>{if(s.result=a,this.As)return this.ws(e,n,o,a.size)})}).next(()=>s.result)}ws(e,n,i,r){return i.documentReadCount<this.Vs?(xl()<=Le.DEBUG&&ie("QueryEngine","SDK will not create cache indexes for query:",Dl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),W.resolve()):(xl()<=Le.DEBUG&&ie("QueryEngine","Query:",Dl(n),"scans",i.documentReadCount,"local documents and returns",r,"documents as results."),i.documentReadCount>this.ds*r?(xl()<=Le.DEBUG&&ie("QueryEngine","The SDK decides to create cache indexes for query:",Dl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Er(n))):W.resolve())}gs(e,n){if(rw(n))return W.resolve(null);let i=Er(n);return this.indexManager.getIndexType(e,i).next(r=>r===0?null:(n.limit!==null&&r===1&&(n=J_(n,null,"F"),i=Er(n)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const o=Ne(...s);return this.fs.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(l=>{const c=this.bs(n,a);return this.Ss(n,c,o,l.readTime)?this.gs(e,J_(n,null,"F")):this.Ds(e,c,n,l)}))})))}ps(e,n,i,r){return rw(n)||r.isEqual(ye.min())?W.resolve(null):this.fs.getDocuments(e,i).next(s=>{const o=this.bs(n,s);return this.Ss(n,o,i,r)?W.resolve(null):(xl()<=Le.DEBUG&&ie("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Dl(n)),this.Ds(e,o,n,l8(r,fh)).next(a=>a))})}bs(e,n){let i=new Yt(OO(e));return n.forEach((r,s)=>{iv(e,s)&&(i=i.add(s))}),i}Ss(e,n,i,r){if(e.limit===null)return!1;if(i.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}ys(e,n,i){return xl()<=Le.DEBUG&&ie("QueryEngine","Using full collection scan to execute query:",Dl(n)),this.fs.getDocumentsMatchingQuery(e,n,No.min(),i)}Ds(e,n,i,r){return this.fs.getDocumentsMatchingQuery(e,i,r).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DS="LocalStore",Hj=3e8;class Gj{constructor(e,n,i,r){this.persistence=e,this.Cs=n,this.serializer=r,this.vs=new zt(Oe),this.Fs=new al(s=>SS(s),ES),this.Ms=new Map,this.xs=e.getRemoteDocumentCache(),this.li=e.getTargetCache(),this.Pi=e.getBundleCache(),this.Os(i)}Os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Oj(this.xs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.xs.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.vs))}}function Kj(t,e,n,i){return new Gj(t,e,n,i)}async function sN(t,e){const n=_e(t);return await n.persistence.runTransaction("Handle user change","readonly",i=>{let r;return n.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,n.Os(e),n.mutationQueue.getAllMutationBatches(i))).next(s=>{const o=[],a=[];let l=Ne();for(const c of r){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of s){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return n.localDocuments.getDocuments(i,l).next(c=>({Ns:c,removedBatchIds:o,addedBatchIds:a}))})})}function $j(t,e){const n=_e(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=n.xs.newChangeBuffer({trackRemovals:!0});return function(a,l,c,u){const d=c.batch,f=d.keys();let p=W.resolve();return f.forEach(v=>{p=p.next(()=>u.getEntry(l,v)).next(g=>{const E=c.docVersions.get(v);Qe(E!==null,48541),g.version.compareTo(E)<0&&(d.applyToRemoteDocument(g,c),g.isValidDocument()&&(g.setReadTime(c.commitVersion),u.addEntry(g)))})}),p.next(()=>a.mutationQueue.removeMutationBatch(l,d))}(n,i,e,s).next(()=>s.apply(i)).next(()=>n.mutationQueue.performConsistencyCheck(i)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let l=Ne();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>n.localDocuments.getDocuments(i,r))})}function oN(t){const e=_e(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.li.getLastRemoteSnapshotVersion(n))}function Wj(t,e){const n=_e(t),i=e.snapshotVersion;let r=n.vs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=n.xs.newChangeBuffer({trackRemovals:!0});r=n.vs;const a=[];e.targetChanges.forEach((u,d)=>{const f=r.get(d);if(!f)return;a.push(n.li.removeMatchingKeys(s,u.removedDocuments,d).next(()=>n.li.addMatchingKeys(s,u.addedDocuments,d)));let p=f.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?p=p.withResumeToken(In.EMPTY_BYTE_STRING,ye.min()).withLastLimboFreeSnapshotVersion(ye.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,i)),r=r.insert(d,p),function(g,E,y){return g.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-g.snapshotVersion.toMicroseconds()>=Hj?!0:y.addedDocuments.size+y.modifiedDocuments.size+y.removedDocuments.size>0}(f,p,u)&&a.push(n.li.updateTargetData(s,p))});let l=Ss(),c=Ne();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(Qj(s,o,e.documentUpdates).next(u=>{l=u.Bs,c=u.Ls})),!i.isEqual(ye.min())){const u=n.li.getLastRemoteSnapshotVersion(s).next(d=>n.li.setTargetsMetadata(s,s.currentSequenceNumber,i));a.push(u)}return W.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(n.vs=r,s))}function Qj(t,e,n){let i=Ne(),r=Ne();return n.forEach(s=>i=i.add(s)),e.getEntries(t,i).next(s=>{let o=Ss();return n.forEach((a,l)=>{const c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(r=r.add(a)),l.isNoDocument()&&l.version.isEqual(ye.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):ie(DS,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{Bs:o,Ls:r}})}function Yj(t,e){const n=_e(t);return n.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=_S),n.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function Jj(t,e){const n=_e(t);return n.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return n.li.getTargetData(i,e).next(s=>s?(r=s,W.resolve(r)):n.li.allocateTargetId(i).next(o=>(r=new oo(e,o,"TargetPurposeListen",i.currentSequenceNumber),n.li.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=n.vs.get(i.targetId);return(r===null||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.vs=n.vs.insert(i.targetId,i),n.Fs.set(e,i.targetId)),i})}async function nb(t,e,n){const i=_e(t),r=i.vs.get(e),s=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",s,o=>i.persistence.referenceDelegate.removeTarget(o,r))}catch(o){if(!au(o))throw o;ie(DS,`Failed to update sequence numbers for target ${e}: ${o}`)}i.vs=i.vs.remove(e),i.Fs.delete(r.target)}function vw(t,e,n){const i=_e(t);let r=ye.min(),s=Ne();return i.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,u){const d=_e(l),f=d.Fs.get(u);return f!==void 0?W.resolve(d.vs.get(f)):d.li.getTargetData(c,u)}(i,o,Er(e)).next(a=>{if(a)return r=a.lastLimboFreeSnapshotVersion,i.li.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>i.Cs.getDocumentsMatchingQuery(o,e,n?r:ye.min(),n?s:Ne())).next(a=>(Xj(i,U8(e),a),{documents:a,ks:s})))}function Xj(t,e,n){let i=t.Ms.get(e)||ye.min();n.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),t.Ms.set(e,i)}class yw{constructor(){this.activeTargetIds=z8()}Qs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Zj{constructor(){this.vo=new yw,this.Fo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,i){}addLocalQueryTarget(e,n=!0){return n&&this.vo.Qs(e),this.Fo[e]||"not-current"}updateQueryState(e,n,i){this.Fo[e]=n}removeLocalQueryTarget(e){this.vo.Gs(e)}isLocalQueryTarget(e){return this.vo.activeTargetIds.has(e)}clearQueryState(e){delete this.Fo[e]}getAllActiveQueryTargets(){return this.vo.activeTargetIds}isActiveQueryTarget(e){return this.vo.activeTargetIds.has(e)}start(){return this.vo=new yw,Promise.resolve()}handleUserChange(e,n,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eB{Mo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _w="ConnectivityMonitor";class bw{constructor(){this.xo=()=>this.Oo(),this.No=()=>this.Bo(),this.Lo=[],this.ko()}Mo(e){this.Lo.push(e)}shutdown(){window.removeEventListener("online",this.xo),window.removeEventListener("offline",this.No)}ko(){window.addEventListener("online",this.xo),window.addEventListener("offline",this.No)}Oo(){ie(_w,"Network connectivity changed: AVAILABLE");for(const e of this.Lo)e(0)}Bo(){ie(_w,"Network connectivity changed: UNAVAILABLE");for(const e of this.Lo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rp=null;function ib(){return rp===null?rp=function(){return 268435456+Math.round(2147483648*Math.random())}():rp++,"0x"+rp.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yy="RestConnection",tB={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery",ExecutePipeline:"executePipeline"};class nB{get Ko(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.qo=n+"://"+e.host,this.Uo=`projects/${i}/databases/${r}`,this.$o=this.databaseId.database===Um?`project_id=${i}`:`project_id=${i}&database_id=${r}`}Wo(e,n,i,r,s){const o=ib(),a=this.Qo(e,n.toUriEncodedString());ie(Yy,`Sending RPC '${e}' ${o}:`,a,i);const l={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.$o};this.Go(l,r,s);const{host:c}=new URL(a),u=Zh(c);return this.zo(e,a,l,i,u).then(d=>(ie(Yy,`Received RPC '${e}' ${o}: `,d),d),d=>{throw Ba(Yy,`RPC '${e}' ${o} failed with error: `,d,"url: ",a,"request:",i),d})}jo(e,n,i,r,s,o){return this.Wo(e,n,i,r,s)}Go(e,n,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+su}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}Qo(e,n){const i=tB[e];let r=`${this.qo}/v1/${n}:${i}`;return this.databaseInfo.apiKey&&(r=`${r}?key=${encodeURIComponent(this.databaseInfo.apiKey)}`),r}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iB{constructor(e){this.Ho=e.Ho,this.Jo=e.Jo}Zo(e){this.Xo=e}Yo(e){this.e_=e}t_(e){this.n_=e}onMessage(e){this.r_=e}close(){this.Jo()}send(e){this.Ho(e)}i_(){this.Xo()}s_(){this.e_()}o_(e){this.n_(e)}__(e){this.r_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nn="WebChannelConnection",$u=(t,e,n)=>{t.listen(e,i=>{try{n(i)}catch(r){setTimeout(()=>{throw r},0)}})};class rc extends nB{constructor(e){super(e),this.a_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}static u_(){if(!rc.c_){const e=uO();$u(e,cO.STAT_EVENT,n=>{n.stat===H_.PROXY?ie(Nn,"STAT_EVENT: detected buffering proxy"):n.stat===H_.NOPROXY&&ie(Nn,"STAT_EVENT: detected no buffering proxy")}),rc.c_=!0}}zo(e,n,i,r,s){const o=ib();return new Promise((a,l)=>{const c=new aO;c.setWithCredentials(!0),c.listenOnce(lO.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Np.NO_ERROR:const d=c.getResponseJson();ie(Nn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(d)),a(d);break;case Np.TIMEOUT:ie(Nn,`RPC '${e}' ${o} timed out`),l(new oe(Y.DEADLINE_EXCEEDED,"Request time out"));break;case Np.HTTP_ERROR:const f=c.getStatus();if(ie(Nn,`RPC '${e}' ${o} failed with status:`,f,"response text:",c.getResponseText()),f>0){let p=c.getResponseJson();Array.isArray(p)&&(p=p[0]);const v=p==null?void 0:p.error;if(v&&v.status&&v.message){const g=function(y){const T=y.toLowerCase().replace(/_/g,"-");return Object.values(Y).indexOf(T)>=0?T:Y.UNKNOWN}(v.status);l(new oe(g,v.message))}else l(new oe(Y.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new oe(Y.UNAVAILABLE,"Connection failed."));break;default:fe(9055,{l_:e,streamId:o,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{ie(Nn,`RPC '${e}' ${o} completed.`)}});const u=JSON.stringify(r);ie(Nn,`RPC '${e}' ${o} sending request:`,r),c.send(n,"POST",u,i,15)})}T_(e,n,i){const r=ib(),s=[this.qo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=this.createWebChannelTransport(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Go(a.initMessageHeaders,n,i),a.encodeInitMessageHeaders=!0;const c=s.join("");ie(Nn,`Creating RPC '${e}' stream ${r}: ${c}`,a);const u=o.createWebChannel(c,a);this.I_(u);let d=!1,f=!1;const p=new iB({Ho:v=>{f?ie(Nn,`Not sending because RPC '${e}' stream ${r} is closed:`,v):(d||(ie(Nn,`Opening RPC '${e}' stream ${r} transport.`),u.open(),d=!0),ie(Nn,`RPC '${e}' stream ${r} sending:`,v),u.send(v))},Jo:()=>u.close()});return $u(u,fd.EventType.OPEN,()=>{f||(ie(Nn,`RPC '${e}' stream ${r} transport opened.`),p.i_())}),$u(u,fd.EventType.CLOSE,()=>{f||(f=!0,ie(Nn,`RPC '${e}' stream ${r} transport closed`),p.o_(),this.E_(u))}),$u(u,fd.EventType.ERROR,v=>{f||(f=!0,Ba(Nn,`RPC '${e}' stream ${r} transport errored. Name:`,v.name,"Message:",v.message),p.o_(new oe(Y.UNAVAILABLE,"The operation could not be completed")))}),$u(u,fd.EventType.MESSAGE,v=>{var g;if(!f){const E=v.data[0];Qe(!!E,16349);const y=E,T=(y==null?void 0:y.error)||((g=y[0])==null?void 0:g.error);if(T){ie(Nn,`RPC '${e}' stream ${r} received error:`,T);const R=T.status;let b=function(C){const k=Lt[C];if(k!==void 0)return KO(k)}(R),w=T.message;R==="NOT_FOUND"&&w.includes("database")&&w.includes("does not exist")&&w.includes(this.databaseId.database)&&Ba(`Database '${this.databaseId.database}' not found. Please check your project configuration.`),b===void 0&&(b=Y.INTERNAL,w="Unknown error status: "+R+" with message "+T.message),f=!0,p.o_(new oe(b,w)),u.close()}else ie(Nn,`RPC '${e}' stream ${r} received:`,E),p.__(E)}}),rc.u_(),setTimeout(()=>{p.s_()},0),p}terminate(){this.a_.forEach(e=>e.close()),this.a_=[]}I_(e){this.a_.push(e)}E_(e){this.a_=this.a_.filter(n=>n===e)}Go(e,n,i){super.Go(e,n,i),this.databaseInfo.apiKey&&(e["x-goog-api-key"]=this.databaseInfo.apiKey)}createWebChannelTransport(){return dO()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rB(t){return new rc(t)}function Jy(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lv(t){return new lj(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rc.c_=!1;class aN{constructor(e,n,i=1e3,r=1.5,s=6e4){this.Ci=e,this.timerId=n,this.R_=i,this.A_=r,this.V_=s,this.d_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.d_=0}g_(){this.d_=this.V_}p_(e){this.cancel();const n=Math.floor(this.d_+this.y_()),i=Math.max(0,Date.now()-this.f_),r=Math.max(0,n-i);r>0&&ie("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.d_} ms, delay with jitter: ${n} ms, last attempt: ${i} ms ago)`),this.m_=this.Ci.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.d_*=this.A_,this.d_<this.R_&&(this.d_=this.R_),this.d_>this.V_&&(this.d_=this.V_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.d_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tw="PersistentStream";class lN{constructor(e,n,i,r,s,o,a,l){this.Ci=e,this.b_=i,this.S_=r,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new aN(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Ci.enqueueAfterDelay(this.b_,6e4,()=>this.k_()))}K_(e){this.q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===Y.RESOURCE_EXHAUSTED?(Ts(n.toString()),Ts("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Y.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.t_(n)}W_(){}auth(){this.state=1;const e=this.Q_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.D_===n&&this.G_(i,r)},i=>{e(()=>{const r=new oe(Y.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(r)})})}G_(e,n){const i=this.Q_(this.D_);this.stream=this.j_(e,n),this.stream.Zo(()=>{i(()=>this.listener.Zo())}),this.stream.Yo(()=>{i(()=>(this.state=2,this.v_=this.Ci.enqueueAfterDelay(this.S_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.Yo()))}),this.stream.t_(r=>{i(()=>this.z_(r))}),this.stream.onMessage(r=>{i(()=>++this.F_==1?this.H_(r):this.onNext(r))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ie(Tw,`close with error: ${e}`),this.stream=null,this.close(4,e)}Q_(e){return n=>{this.Ci.enqueueAndForget(()=>this.D_===e?n():(ie(Tw,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class sB extends lN{constructor(e,n,i,r,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,i,r,o),this.serializer=s}j_(e,n){return this.connection.T_("Listen",e,n)}H_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=dj(this.serializer,e),i=function(s){if(!("targetChange"in s))return ye.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?ye.min():o.readTime?Cr(o.readTime):ye.min()}(e);return this.listener.J_(n,i)}Z_(e){const n={};n.database=tb(this.serializer),n.addTarget=function(s,o){let a;const l=o.target;if(a=Y_(l)?{documents:pj(s,l)}:{query:mj(s,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=QO(s,o.resumeToken);const c=X_(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(ye.min())>0){a.readTime=qm(s,o.snapshotVersion.toTimestamp());const c=X_(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const i=vj(this.serializer,e);i&&(n.labels=i),this.K_(n)}X_(e){const n={};n.database=tb(this.serializer),n.removeTarget=e,this.K_(n)}}class oB extends lN{constructor(e,n,i,r,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,i,r,o),this.serializer=s}get Y_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.Y_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}H_(e){return Qe(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Qe(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){Qe(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=fj(e.writeResults,e.commitTime),i=Cr(e.commitTime);return this.listener.na(i,n)}ra(){const e={};e.database=tb(this.serializer),this.K_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(i=>hj(this.serializer,i))};this.K_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aB{}class lB extends aB{constructor(e,n,i,r){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=i,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new oe(Y.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,n,i,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(e,Z_(n,i),r,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new oe(Y.UNKNOWN,s.toString())})}jo(e,n,i,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.jo(e,Z_(n,i),r,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new oe(Y.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}function cB(t,e,n,i){return new lB(t,e,n,i)}class uB{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ts(n),this.aa=!1):ie("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const za="RemoteStore";class dB{constructor(e,n,i,r,s){this.localStore=e,this.datastore=n,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.Ra=[],this.Aa=s,this.Aa.Mo(o=>{i.enqueueAndForget(async()=>{cl(this)&&(ie(za,"Restarting streams for network reachability change."),await async function(l){const c=_e(l);c.Ea.add(4),await nf(c),c.Va.set("Unknown"),c.Ea.delete(4),await cv(c)}(this))})}),this.Va=new uB(i,r)}}async function cv(t){if(cl(t))for(const e of t.Ra)await e(!0)}async function nf(t){for(const e of t.Ra)await e(!1)}function cN(t,e){const n=_e(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),LS(n)?MS(n):lu(n).O_()&&NS(n,e))}function OS(t,e){const n=_e(t),i=lu(n);n.Ia.delete(e),i.O_()&&uN(n,e),n.Ia.size===0&&(i.O_()?i.L_():cl(n)&&n.Va.set("Unknown"))}function NS(t,e){if(t.da.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ye.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}lu(t).Z_(e)}function uN(t,e){t.da.$e(e),lu(t).X_(e)}function MS(t){t.da=new rj({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),lu(t).start(),t.Va.ua()}function LS(t){return cl(t)&&!lu(t).x_()&&t.Ia.size>0}function cl(t){return _e(t).Ea.size===0}function dN(t){t.da=void 0}async function hB(t){t.Va.set("Online")}async function fB(t){t.Ia.forEach((e,n)=>{NS(t,e)})}async function pB(t,e){dN(t),LS(t)?(t.Va.ha(e),MS(t)):t.Va.set("Unknown")}async function mB(t,e,n){if(t.Va.set("Online"),e instanceof WO&&e.state===2&&e.cause)try{await async function(r,s){const o=s.cause;for(const a of s.targetIds)r.Ia.has(a)&&(await r.remoteSyncer.rejectListen(a,o),r.Ia.delete(a),r.da.removeTarget(a))}(t,e)}catch(i){ie(za,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Hm(t,i)}else if(e instanceof Vp?t.da.Xe(e):e instanceof $O?t.da.st(e):t.da.tt(e),!n.isEqual(ye.min()))try{const i=await oN(t.localStore);n.compareTo(i)>=0&&await function(s,o){const a=s.da.Tt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const u=s.Ia.get(c);u&&s.Ia.set(c,u.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const u=s.Ia.get(l);if(!u)return;s.Ia.set(l,u.withResumeToken(In.EMPTY_BYTE_STRING,u.snapshotVersion)),uN(s,l);const d=new oo(u.target,l,c,u.sequenceNumber);NS(s,d)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(i){ie(za,"Failed to raise snapshot:",i),await Hm(t,i)}}async function Hm(t,e,n){if(!au(e))throw e;t.Ea.add(1),await nf(t),t.Va.set("Offline"),n||(n=()=>oN(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ie(za,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await cv(t)})}function hN(t,e){return e().catch(n=>Hm(t,n,e))}async function uv(t){const e=_e(t),n=Vo(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:_S;for(;gB(e);)try{const r=await Yj(e.localStore,i);if(r===null){e.Ta.length===0&&n.L_();break}i=r.batchId,vB(e,r)}catch(r){await Hm(e,r)}fN(e)&&pN(e)}function gB(t){return cl(t)&&t.Ta.length<10}function vB(t,e){t.Ta.push(e);const n=Vo(t);n.O_()&&n.Y_&&n.ea(e.mutations)}function fN(t){return cl(t)&&!Vo(t).x_()&&t.Ta.length>0}function pN(t){Vo(t).start()}async function yB(t){Vo(t).ra()}async function _B(t){const e=Vo(t);for(const n of t.Ta)e.ea(n.mutations)}async function bB(t,e,n){const i=t.Ta.shift(),r=wS.from(i,e,n);await hN(t,()=>t.remoteSyncer.applySuccessfulWrite(r)),await uv(t)}async function TB(t,e){e&&Vo(t).Y_&&await async function(i,r){if(function(o){return tj(o)&&o!==Y.ABORTED}(r.code)){const s=i.Ta.shift();Vo(i).B_(),await hN(i,()=>i.remoteSyncer.rejectFailedWrite(s.batchId,r)),await uv(i)}}(t,e),fN(t)&&pN(t)}async function Sw(t,e){const n=_e(t);n.asyncQueue.verifyOperationInProgress(),ie(za,"RemoteStore received new credentials");const i=cl(n);n.Ea.add(3),await nf(n),i&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await cv(n)}async function SB(t,e){const n=_e(t);e?(n.Ea.delete(2),await cv(n)):e||(n.Ea.add(2),await nf(n),n.Va.set("Unknown"))}function lu(t){return t.ma||(t.ma=function(n,i,r){const s=_e(n);return s.sa(),new sB(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(t.datastore,t.asyncQueue,{Zo:hB.bind(null,t),Yo:fB.bind(null,t),t_:pB.bind(null,t),J_:mB.bind(null,t)}),t.Ra.push(async e=>{e?(t.ma.B_(),LS(t)?MS(t):t.Va.set("Unknown")):(await t.ma.stop(),dN(t))})),t.ma}function Vo(t){return t.fa||(t.fa=function(n,i,r){const s=_e(n);return s.sa(),new oB(i,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(t.datastore,t.asyncQueue,{Zo:()=>Promise.resolve(),Yo:yB.bind(null,t),t_:TB.bind(null,t),ta:_B.bind(null,t),na:bB.bind(null,t)}),t.Ra.push(async e=>{e?(t.fa.B_(),await uv(t)):(await t.fa.stop(),t.Ta.length>0&&(ie(za,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class US{constructor(e,n,i,r,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new ds,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,i,r,s){const o=Date.now()+i,a=new US(e,n,o,r,s);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new oe(Y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function VS(t,e){if(Ts("AsyncQueue",`${e}: ${t}`),au(t))return new oe(Y.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{static emptySet(e){return new sc(e.comparator)}constructor(e){this.comparator=e?(n,i)=>e(n,i)||ue.comparator(n.key,i.key):(n,i)=>ue.comparator(n.key,i.key),this.keyedMap=pd(),this.sortedSet=new zt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,i)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof sc)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;n.hasNext();){const r=n.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const i=new sc;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=n,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ew{constructor(){this.ga=new zt(ue.comparator)}track(e){const n=e.doc.key,i=this.ga.get(n);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(n,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(n,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(n):e.type===1&&i.type===2?this.ga=this.ga.insert(n,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):fe(63341,{Vt:e,pa:i}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,i)=>{e.push(i)}),e}}class Vc{constructor(e,n,i,r,s,o,a,l,c){this.query=e,this.docs=n,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,n,i,r,s){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new Vc(e,n,sc.emptySet(n),o,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&nv(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,i=e.docChanges;if(n.length!==i.length)return!1;for(let r=0;r<n.length;r++)if(n[r].type!==i[r].type||!n[r].doc.isEqual(i[r].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EB{constructor(){this.wa=void 0,this.ba=[]}Sa(){return this.ba.some(e=>e.Da())}}class CB{constructor(){this.queries=Cw(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,i){const r=_e(n),s=r.queries;r.queries=Cw(),s.forEach((o,a)=>{for(const l of a.ba)l.onError(i)})})(this,new oe(Y.ABORTED,"Firestore shutting down"))}}function Cw(){return new al(t=>DO(t),nv)}async function mN(t,e){const n=_e(t);let i=3;const r=e.query;let s=n.queries.get(r);s?!s.Sa()&&e.Da()&&(i=2):(s=new EB,i=e.Da()?0:1);try{switch(i){case 0:s.wa=await n.onListen(r,!0);break;case 1:s.wa=await n.onListen(r,!1);break;case 2:await n.onFirstRemoteStoreListen(r)}}catch(o){const a=VS(o,`Initialization of query '${Dl(e.query)}' failed`);return void e.onError(a)}n.queries.set(r,s),s.ba.push(e),e.va(n.onlineState),s.wa&&e.Fa(s.wa)&&FS(n)}async function gN(t,e){const n=_e(t),i=e.query;let r=3;const s=n.queries.get(i);if(s){const o=s.ba.indexOf(e);o>=0&&(s.ba.splice(o,1),s.ba.length===0?r=e.Da()?0:1:!s.Sa()&&e.Da()&&(r=2))}switch(r){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}function kB(t,e){const n=_e(t);let i=!1;for(const r of e){const s=r.query,o=n.queries.get(s);if(o){for(const a of o.ba)a.Fa(r)&&(i=!0);o.wa=r}}i&&FS(n)}function wB(t,e,n){const i=_e(t),r=i.queries.get(e);if(r)for(const s of r.ba)s.onError(n);i.queries.delete(e)}function FS(t){t.Ca.forEach(e=>{e.next()})}var rb,kw;(kw=rb||(rb={})).Ma="default",kw.Cache="cache";class vN{constructor(e,n,i){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)r.type!==3&&i.push(r);e=new Vc(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const i=n!=="Offline";return(!this.options.Ka||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Vc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==rb.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e){this.key=e}}class _N{constructor(e){this.key=e}}class RB{constructor(e,n){this.query=e,this.Za=n,this.Xa=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Ne(),this.mutatedKeys=Ne(),this.eu=OO(e),this.tu=new sc(this.eu)}get nu(){return this.Za}ru(e,n){const i=n?n.iu:new Ew,r=n?n.tu:this.tu;let s=n?n.mutatedKeys:this.mutatedKeys,o=r,a=!1;const l=this.query.limitType==="F"&&r.size===this.query.limit?r.last():null,c=this.query.limitType==="L"&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((u,d)=>{const f=r.get(u),p=iv(this.query,d)?d:null,v=!!f&&this.mutatedKeys.has(f.key),g=!!p&&(p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations);let E=!1;f&&p?f.data.isEqual(p.data)?v!==g&&(i.track({type:3,doc:p}),E=!0):this.su(f,p)||(i.track({type:2,doc:p}),E=!0,(l&&this.eu(p,l)>0||c&&this.eu(p,c)<0)&&(a=!0)):!f&&p?(i.track({type:0,doc:p}),E=!0):f&&!p&&(i.track({type:1,doc:f}),E=!0,(l||c)&&(a=!0)),E&&(p?(o=o.add(p),s=g?s.add(u):s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),i.track({type:1,doc:u})}return{tu:o,iu:i,Ss:a,mutatedKeys:s}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,i,r){const s=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((u,d)=>function(p,v){const g=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fe(20277,{Vt:E})}};return g(p)-g(v)}(u.type,d.type)||this.eu(u.doc,d.doc)),this.ou(i),r=r??!1;const a=n&&!r?this._u():[],l=this.Ya.size===0&&this.current&&!r?1:0,c=l!==this.Xa;return this.Xa=l,o.length!==0||c?{snapshot:new Vc(this.query,e.tu,s,o,e.mutatedKeys,l===0,c,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ew,mutatedKeys:this.mutatedKeys,Ss:!1},!1)):{au:[]}}uu(e){return!this.Za.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Za=this.Za.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Za=this.Za.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Ya;this.Ya=Ne(),this.tu.forEach(i=>{this.uu(i.key)&&(this.Ya=this.Ya.add(i.key))});const n=[];return e.forEach(i=>{this.Ya.has(i)||n.push(new _N(i))}),this.Ya.forEach(i=>{e.has(i)||n.push(new yN(i))}),n}cu(e){this.Za=e.ks,this.Ya=Ne();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Vc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Xa===0,this.hasCachedResults)}}const jS="SyncEngine";class AB{constructor(e,n,i){this.query=e,this.targetId=n,this.view=i}}class IB{constructor(e){this.key=e,this.hu=!1}}class PB{constructor(e,n,i,r,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new al(a=>DO(a),nv),this.Iu=new Map,this.Eu=new Set,this.Ru=new zt(ue.comparator),this.Au=new Map,this.Vu=new IS,this.du={},this.mu=new Map,this.fu=Uc.ar(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function xB(t,e,n=!0){const i=kN(t);let r;const s=i.Tu.get(e);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await bN(i,e,n,!0),r}async function DB(t,e){const n=kN(t);await bN(n,e,!0,!1)}async function bN(t,e,n,i){const r=await Jj(t.localStore,Er(e)),s=r.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return i&&(a=await OB(t,e,s,o==="current",r.resumeToken)),t.isPrimaryClient&&n&&cN(t.remoteStore,r),a}async function OB(t,e,n,i,r){t.pu=(d,f,p)=>async function(g,E,y,T){let R=E.view.ru(y);R.Ss&&(R=await vw(g.localStore,E.query,!1).then(({documents:C})=>E.view.ru(C,R)));const b=T&&T.targetChanges.get(E.targetId),w=T&&T.targetMismatches.get(E.targetId)!=null,D=E.view.applyChanges(R,g.isPrimaryClient,b,w);return Rw(g,E.targetId,D.au),D.snapshot}(t,d,f,p);const s=await vw(t.localStore,e,!0),o=new RB(e,s.ks),a=o.ru(s.documents),l=tf.createSynthesizedTargetChangeForCurrentChange(n,i&&t.onlineState!=="Offline",r),c=o.applyChanges(a,t.isPrimaryClient,l);Rw(t,n,c.au);const u=new AB(e,n,o);return t.Tu.set(e,u),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),c.snapshot}async function NB(t,e,n){const i=_e(t),r=i.Tu.get(e),s=i.Iu.get(r.targetId);if(s.length>1)return i.Iu.set(r.targetId,s.filter(o=>!nv(o,e))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await nb(i.localStore,r.targetId,!1).then(()=>{i.sharedClientState.clearQueryState(r.targetId),n&&OS(i.remoteStore,r.targetId),sb(i,r.targetId)}).catch(ou)):(sb(i,r.targetId),await nb(i.localStore,r.targetId,!0))}async function MB(t,e){const n=_e(t),i=n.Tu.get(e),r=n.Iu.get(i.targetId);n.isPrimaryClient&&r.length===1&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),OS(n.remoteStore,i.targetId))}async function LB(t,e,n){const i=zB(t);try{const r=await function(o,a){const l=_e(o),c=mn.now(),u=a.reduce((p,v)=>p.add(v.key),Ne());let d,f;return l.persistence.runTransaction("Locally write mutations","readwrite",p=>{let v=Ss(),g=Ne();return l.xs.getEntries(p,u).next(E=>{v=E,v.forEach((y,T)=>{T.isValidDocument()||(g=g.add(y))})}).next(()=>l.localDocuments.getOverlayedDocuments(p,v)).next(E=>{d=E;const y=[];for(const T of a){const R=Y8(T,d.get(T.key).overlayedDocument);R!=null&&y.push(new ll(T.key,R,kO(R.value.mapValue),hs.exists(!0)))}return l.mutationQueue.addMutationBatch(p,c,y,a)}).next(E=>{f=E;const y=E.applyToLocalDocumentSet(d,g);return l.documentOverlayCache.saveOverlays(p,E.batchId,y)})}).then(()=>({batchId:f.batchId,changes:MO(d)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(o,a,l){let c=o.du[o.currentUser.toKey()];c||(c=new zt(Oe)),c=c.insert(a,l),o.du[o.currentUser.toKey()]=c}(i,r.batchId,n),await rf(i,r.changes),await uv(i.remoteStore)}catch(r){const s=VS(r,"Failed to persist write");n.reject(s)}}async function TN(t,e){const n=_e(t);try{const i=await Wj(n.localStore,e);e.targetChanges.forEach((r,s)=>{const o=n.Au.get(s);o&&(Qe(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1,22616),r.addedDocuments.size>0?o.hu=!0:r.modifiedDocuments.size>0?Qe(o.hu,14607):r.removedDocuments.size>0&&(Qe(o.hu,42227),o.hu=!1))}),await rf(n,i,e)}catch(i){await ou(i)}}function ww(t,e,n){const i=_e(t);if(i.isPrimaryClient&&n===0||!i.isPrimaryClient&&n===1){const r=[];i.Tu.forEach((s,o)=>{const a=o.view.va(e);a.snapshot&&r.push(a.snapshot)}),function(o,a){const l=_e(o);l.onlineState=a;let c=!1;l.queries.forEach((u,d)=>{for(const f of d.ba)f.va(a)&&(c=!0)}),c&&FS(l)}(i.eventManager,e),r.length&&i.Pu.J_(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function UB(t,e,n){const i=_e(t);i.sharedClientState.updateQueryState(e,"rejected",n);const r=i.Au.get(e),s=r&&r.key;if(s){let o=new zt(ue.comparator);o=o.insert(s,Un.newNoDocument(s,ye.min()));const a=Ne().add(s),l=new av(ye.min(),new Map,new zt(Oe),o,a);await TN(i,l),i.Ru=i.Ru.remove(s),i.Au.delete(e),BS(i)}else await nb(i.localStore,e,!1).then(()=>sb(i,e,n)).catch(ou)}async function VB(t,e){const n=_e(t),i=e.batch.batchId;try{const r=await $j(n.localStore,e);EN(n,i,null),SN(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await rf(n,r)}catch(r){await ou(r)}}async function FB(t,e,n){const i=_e(t);try{const r=await function(o,a){const l=_e(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return l.mutationQueue.lookupMutationBatch(c,a).next(d=>(Qe(d!==null,37113),u=d.keys(),l.mutationQueue.removeMutationBatch(c,d))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,u,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,u)).next(()=>l.localDocuments.getDocuments(c,u))})}(i.localStore,e);EN(i,e,n),SN(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await rf(i,r)}catch(r){await ou(r)}}function SN(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function EN(t,e,n){const i=_e(t);let r=i.du[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(n?s.reject(n):s.resolve(),r=r.remove(e)),i.du[i.currentUser.toKey()]=r}}function sb(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.Iu.get(e))t.Tu.delete(i),n&&t.Pu.yu(i,n);t.Iu.delete(e),t.isPrimaryClient&&t.Vu.Gr(e).forEach(i=>{t.Vu.containsKey(i)||CN(t,i)})}function CN(t,e){t.Eu.delete(e.path.canonicalString());const n=t.Ru.get(e);n!==null&&(OS(t.remoteStore,n),t.Ru=t.Ru.remove(e),t.Au.delete(n),BS(t))}function Rw(t,e,n){for(const i of n)i instanceof yN?(t.Vu.addReference(i.key,e),jB(t,i)):i instanceof _N?(ie(jS,"Document no longer in limbo: "+i.key),t.Vu.removeReference(i.key,e),t.Vu.containsKey(i.key)||CN(t,i.key)):fe(19791,{wu:i})}function jB(t,e){const n=e.key,i=n.path.canonicalString();t.Ru.get(n)||t.Eu.has(i)||(ie(jS,"New document in limbo: "+n),t.Eu.add(i),BS(t))}function BS(t){for(;t.Eu.size>0&&t.Ru.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new ue(ft.fromString(e)),i=t.fu.next();t.Au.set(i,new IB(n)),t.Ru=t.Ru.insert(n,i),cN(t.remoteStore,new oo(Er(CS(n.path)),i,"TargetPurposeLimboResolution",Xg.ce))}}async function rf(t,e,n){const i=_e(t),r=[],s=[],o=[];i.Tu.isEmpty()||(i.Tu.forEach((a,l)=>{o.push(i.pu(l,e,n).then(c=>{var u;if((c||n)&&i.isPrimaryClient){const d=c?!c.fromCache:(u=n==null?void 0:n.targetChanges.get(l.targetId))==null?void 0:u.current;i.sharedClientState.updateQueryState(l.targetId,d?"current":"not-current")}if(c){r.push(c);const d=xS.Es(l.targetId,c);s.push(d)}}))}),await Promise.all(o),i.Pu.J_(r),await async function(l,c){const u=_e(l);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>W.forEach(c,f=>W.forEach(f.Ts,p=>u.persistence.referenceDelegate.addReference(d,f.targetId,p)).next(()=>W.forEach(f.Is,p=>u.persistence.referenceDelegate.removeReference(d,f.targetId,p)))))}catch(d){if(!au(d))throw d;ie(DS,"Failed to update sequence numbers: "+d)}for(const d of c){const f=d.targetId;if(!d.fromCache){const p=u.vs.get(f),v=p.snapshotVersion,g=p.withLastLimboFreeSnapshotVersion(v);u.vs=u.vs.insert(f,g)}}}(i.localStore,s))}async function BB(t,e){const n=_e(t);if(!n.currentUser.isEqual(e)){ie(jS,"User change. New user:",e.toKey());const i=await sN(n.localStore,e);n.currentUser=e,function(s,o){s.mu.forEach(a=>{a.forEach(l=>{l.reject(new oe(Y.CANCELLED,o))})}),s.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await rf(n,i.Ns)}}function qB(t,e){const n=_e(t),i=n.Au.get(e);if(i&&i.hu)return Ne().add(i.key);{let r=Ne();const s=n.Iu.get(e);if(!s)return r;for(const o of s){const a=n.Tu.get(o);r=r.unionWith(a.view.nu)}return r}}function kN(t){const e=_e(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=TN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=qB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=UB.bind(null,e),e.Pu.J_=kB.bind(null,e.eventManager),e.Pu.yu=wB.bind(null,e.eventManager),e}function zB(t){const e=_e(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=VB.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=FB.bind(null,e),e}class Gm{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=lv(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return Kj(this.persistence,new zj,e.initialUser,this.serializer)}Cu(e){return new rN(PS.Vi,this.serializer)}Du(e){return new Zj}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gm.provider={build:()=>new Gm};class HB extends Gm{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){Qe(this.persistence.referenceDelegate instanceof zm,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new Aj(i,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?ei.withCacheSize(this.cacheSizeBytes):ei.DEFAULT;return new rN(i=>zm.Vi(i,n),this.serializer)}}class ob{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>ww(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=BB.bind(null,this.syncEngine),await SB(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new CB}()}createDatastore(e){const n=lv(e.databaseInfo.databaseId),i=rB(e.databaseInfo);return cB(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return function(i,r,s,o,a){return new dB(i,r,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>ww(this.syncEngine,n,0),function(){return bw.v()?new bw:new eB}())}createSyncEngine(e,n){return function(r,s,o,a,l,c,u){const d=new PB(r,s,o,a,l,c);return u&&(d.gu=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(r){const s=_e(r);ie(za,"RemoteStore shutting down."),s.Ea.add(5),await nf(s),s.Aa.shutdown(),s.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}ob.provider={build:()=>new ob};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wN{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ts("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fo="FirestoreClient";class GB{constructor(e,n,i,r,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=i,this._databaseInfo=r,this.user=Ln.UNAUTHENTICATED,this.clientId=vS.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(i,async o=>{ie(Fo,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(i,o=>(ie(Fo,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this._databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ds;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const i=VS(n,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function Xy(t,e){t.asyncQueue.verifyOperationInProgress(),ie(Fo,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener(async r=>{i.isEqual(r)||(await sN(e.localStore,r),i=r)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Aw(t,e){t.asyncQueue.verifyOperationInProgress();const n=await KB(t);ie(Fo,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(i=>Sw(e.remoteStore,i)),t.setAppCheckTokenChangeListener((i,r)=>Sw(e.remoteStore,r)),t._onlineComponents=e}async function KB(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ie(Fo,"Using user provided OfflineComponentProvider");try{await Xy(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(r){return r.name==="FirebaseError"?r.code===Y.FAILED_PRECONDITION||r.code===Y.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}(n))throw n;Ba("Error using user provided cache. Falling back to memory cache: "+n),await Xy(t,new Gm)}}else ie(Fo,"Using default OfflineComponentProvider"),await Xy(t,new HB(void 0));return t._offlineComponents}async function RN(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ie(Fo,"Using user provided OnlineComponentProvider"),await Aw(t,t._uninitializedComponentsProvider._online)):(ie(Fo,"Using default OnlineComponentProvider"),await Aw(t,new ob))),t._onlineComponents}function $B(t){return RN(t).then(e=>e.syncEngine)}async function AN(t){const e=await RN(t),n=e.eventManager;return n.onListen=xB.bind(null,e.syncEngine),n.onUnlisten=NB.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=DB.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=MB.bind(null,e.syncEngine),n}function WB(t,e,n={}){const i=new ds;return t.asyncQueue.enqueueAndForget(async()=>function(s,o,a,l,c){const u=new wN({next:f=>{u.Nu(),o.enqueueAndForget(()=>gN(s,d));const p=f.docs.has(a);!p&&f.fromCache?c.reject(new oe(Y.UNAVAILABLE,"Failed to get document because the client is offline.")):p&&f.fromCache&&l&&l.source==="server"?c.reject(new oe(Y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(f)},error:f=>c.reject(f)}),d=new vN(CS(a.path),u,{includeMetadataChanges:!0,Ka:!0});return mN(s,d)}(await AN(t),t.asyncQueue,e,n,i)),i.promise}function QB(t,e,n={}){const i=new ds;return t.asyncQueue.enqueueAndForget(async()=>function(s,o,a,l,c){const u=new wN({next:f=>{u.Nu(),o.enqueueAndForget(()=>gN(s,d)),f.fromCache&&l.source==="server"?c.reject(new oe(Y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(f)},error:f=>c.reject(f)}),d=new vN(a,u,{includeMetadataChanges:!0,Ka:!0});return mN(s,d)}(await AN(t),t.asyncQueue,e,n,i)),i.promise}function YB(t,e){const n=new ds;return t.asyncQueue.enqueueAndForget(async()=>LB(await $B(t),e,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IN(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JB="ComponentProvider",Iw=new Map;function XB(t,e,n,i,r){return new y8(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,IN(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PN="firestore.googleapis.com",Pw=!0;class xw{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new oe(Y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=PN,this.ssl=Pw}else this.host=e.host,this.ssl=e.ssl??Pw;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=iN;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<wj)throw new oe(Y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}a8("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=IN(e.experimentalLongPollingOptions??{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new oe(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new oe(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new oe(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,r){return i.timeoutSeconds===r.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class dv{constructor(e,n,i,r){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xw({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new oe(Y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new oe(Y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xw(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new JF;switch(i.type){case"firstParty":return new t8(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new oe(Y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const i=Iw.get(n);i&&(ie(JB,"Removing Datastore"),Iw.delete(n),i.terminate())}(this),Promise.resolve()}}function ZB(t,e,n,i={}){var c;t=qa(t,dv);const r=Zh(e),s=t._getSettings(),o={...s,emulatorOptions:t._getEmulatorOptions()},a=`${e}:${n}`;r&&(HD(`https://${a}`),KD("Firestore",!0)),s.host!==PN&&s.host!==a&&Ba("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...s,host:a,ssl:r,emulatorOptions:i};if(!uh(l,o)&&(t._setSettings(l),i.mockUserToken)){let u,d;if(typeof i.mockUserToken=="string")u=i.mockUserToken,d=Ln.MOCK_USER;else{u=GD(i.mockUserToken,(c=t._app)==null?void 0:c.options.projectId);const f=i.mockUserToken.sub||i.mockUserToken.user_id;if(!f)throw new oe(Y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Ln(f)}t._authCredentials=new XF(new fO(u,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{constructor(e,n,i){this.converter=n,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new hv(this.firestore,e,this._query)}}class Qt{constructor(e,n,i){this.converter=n,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ko(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Qt(this.firestore,e,this._key)}toJSON(){return{type:Qt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,i){if(ef(n,Qt._jsonSchema))return new Qt(e,i||null,new ue(ft.fromString(n.referencePath)))}}Qt._jsonSchemaVersion="firestore/documentReference/1.0",Qt._jsonSchema={type:qt("string",Qt._jsonSchemaVersion),referencePath:qt("string")};class ko extends hv{constructor(e,n,i){super(e,n,CS(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Qt(this.firestore,null,new ue(e))}withConverter(e){return new ko(this.firestore,e,this._path)}}function e7(t,e,...n){if(t=Ri(t),pO("collection","path",e),t instanceof dv){const i=ft.fromString(e,...n);return Gk(i),new ko(t,null,i)}{if(!(t instanceof Qt||t instanceof ko))throw new oe(Y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(ft.fromString(e,...n));return Gk(i),new ko(t.firestore,null,i)}}function Dw(t,e,...n){if(t=Ri(t),arguments.length===1&&(e=vS.newId()),pO("doc","path",e),t instanceof dv){const i=ft.fromString(e,...n);return Hk(i),new Qt(t,null,new ue(i))}{if(!(t instanceof Qt||t instanceof ko))throw new oe(Y.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(ft.fromString(e,...n));return Hk(i),new Qt(t.firestore,t instanceof ko?t.converter:null,new ue(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ow="AsyncQueue";class Nw{constructor(e=Promise.resolve()){this.Yu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new aN(this,"async_queue_retry"),this._c=()=>{const i=Jy();i&&ie(Ow,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const n=Jy();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Jy();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new ds;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Yu.push(e),this.lc()))}async lc(){if(this.Yu.length!==0){try{await this.Yu[0](),this.Yu.shift(),this.M_.reset()}catch(e){if(!au(e))throw e;ie(Ow,"Operation failed with retryable error: "+e)}this.Yu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(i=>{throw this.nc=i,this.rc=!1,Ts("INTERNAL UNHANDLED ERROR: ",Mw(i)),i}).then(i=>(this.rc=!1,i))));return this.ac=n,n}enqueueAfterDelay(e,n,i){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const r=US.createAndSchedule(this,e,n,i,s=>this.hc(s));return this.tc.push(r),r}uc(){this.nc&&fe(47125,{Pc:Mw(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,i)=>n.targetTimeMs-i.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}Rc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function Mw(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class fv extends dv{constructor(e,n,i,r){super(e,n,i,r),this.type="firestore",this._queue=new Nw,this._persistenceKey=(r==null?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Nw(e),this._firestoreClient=void 0,await e}}}function t7(t,e){const n=typeof t=="object"?t:iO(),i=typeof t=="string"?t:Um,r=ZD(n,"firestore").getImmediate({identifier:i});if(!r._initialized){const s=qD("firestore");s&&ZB(r,...s)}return r}function qS(t){if(t._terminated)throw new oe(Y.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||n7(t),t._firestoreClient}function n7(t){var i,r,s,o;const e=t._freezeSettings(),n=XB(t._databaseId,((i=t._app)==null?void 0:i.options.appId)||"",t._persistenceKey,(r=t._app)==null?void 0:r.options.apiKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((o=e.localCache)!=null&&o._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new GB(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(l){const c=l==null?void 0:l._online.build();return{_offline:l==null?void 0:l._offline.build(c),_online:c}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Fi(In.fromBase64String(e))}catch(n){throw new oe(Y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Fi(In.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Fi._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ef(e,Fi._jsonSchema))return Fi.fromBase64String(e.bytes)}}Fi._jsonSchemaVersion="firestore/bytes/1.0",Fi._jsonSchema={type:qt("string",Fi._jsonSchemaVersion),bytes:qt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zS{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new oe(Y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Cn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kr{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new oe(Y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new oe(Y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Oe(this._lat,e._lat)||Oe(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:kr._jsonSchemaVersion}}static fromJSON(e){if(ef(e,kr._jsonSchema))return new kr(e.latitude,e.longitude)}}kr._jsonSchemaVersion="firestore/geoPoint/1.0",kr._jsonSchema={type:qt("string",kr._jsonSchemaVersion),latitude:qt("number"),longitude:qt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,r){if(i.length!==r.length)return!1;for(let s=0;s<i.length;++s)if(i[s]!==r[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:or._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ef(e,or._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new or(e.vectorValues);throw new oe(Y.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}or._jsonSchemaVersion="firestore/vectorValue/1.0",or._jsonSchema={type:qt("string",or._jsonSchemaVersion),vectorValues:qt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i7=/^__.*__$/;class xN{constructor(e,n,i){this.data=e,this.fieldMask=n,this.fieldTransforms=i}toMutation(e,n){return new ll(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function DN(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fe(40011,{dataSource:t})}}class HS{constructor(e,n,i,r,s,o){this.settings=e,this.databaseId=n,this.serializer=i,this.ignoreUndefinedProperties=r,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new HS({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var r;const n=(r=this.path)==null?void 0:r.child(e),i=this.contextWith({path:n,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var r;const n=(r=this.path)==null?void 0:r.child(e),i=this.contextWith({path:n,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return $m(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(DN(this.dataSource)&&i7.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class r7{constructor(e,n,i){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=i||lv(e)}createContext(e,n,i,r=!1){return new HS({dataSource:e,methodName:n,targetDoc:i,path:Cn.emptyPath(),arrayElement:!1,hasConverter:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function s7(t){const e=t._freezeSettings(),n=lv(t._databaseId);return new r7(t._databaseId,!!e.ignoreUndefinedProperties,n)}class mv extends pv{_toFieldTransform(e){if(e.dataSource!==2)throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof mv}}class GS extends pv{constructor(e,n){super(e),this.Vc=n}_toFieldTransform(e){const n=new _h(e.serializer,VO(e.serializer,this.Vc));return new K8(e.path,n)}isEqual(e){return e instanceof GS&&this.Vc===e.Vc}}function o7(t,e,n,i){const r=t.createContext(1,e,n);NN("Data must be an object, but it was:",r,i);const s=[],o=vi.empty();$o(i,(l,c)=>{const u=MN(e,l,n);c=Ri(c);const d=r.childContextForFieldPath(u);if(c instanceof mv)s.push(u);else{const f=gv(c,d);f!=null&&(s.push(u),o.set(u,f))}});const a=new nr(s);return new xN(o,a,r.fieldTransforms)}function a7(t,e,n,i,r,s){const o=t.createContext(1,e,n),a=[Km(e,i,n)],l=[r];if(s.length%2!=0)throw new oe(Y.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<s.length;f+=2)a.push(Km(e,s[f])),l.push(s[f+1]);const c=[],u=vi.empty();for(let f=a.length-1;f>=0;--f)if(!u7(c,a[f])){const p=a[f];let v=l[f];v=Ri(v);const g=o.childContextForFieldPath(p);if(v instanceof mv)c.push(p);else{const E=gv(v,g);E!=null&&(c.push(p),u.set(p,E))}}const d=new nr(c);return new xN(u,d,o.fieldTransforms)}function gv(t,e){if(ON(t=Ri(t)))return NN("Unsupported field value:",e,t),l7(t,e);if(t instanceof pv)return function(i,r){if(!DN(r.dataSource))throw r.createError(`${i._methodName}() can only be used with update() and set()`);if(!r.path)throw r.createError(`${i._methodName}() is not currently supported inside arrays`);const s=i._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return function(i,r){const s=[];let o=0;for(const a of i){let l=gv(a,r.childContextForArray(o));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),o++}return{arrayValue:{values:s}}}(t,e)}return function(i,r){if((i=Ri(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return VO(r.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const s=mn.fromDate(i);return{timestampValue:qm(r.serializer,s)}}if(i instanceof mn){const s=new mn(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:qm(r.serializer,s)}}if(i instanceof kr)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Fi)return{bytesValue:QO(r.serializer,i._byteString)};if(i instanceof Qt){const s=r.databaseId,o=i.firestore._databaseId;if(!o.isEqual(s))throw r.createError(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:AS(i.firestore._databaseId||r.databaseId,i._key.path)}}if(i instanceof or)return function(o,a){const l=o instanceof or?o.toArray():o;return{mapValue:{fields:{[EO]:{stringValue:CO},[Vm]:{arrayValue:{values:l.map(u=>{if(typeof u!="number")throw a.createError("VectorValues must only contain numeric values.");return kS(a.serializer,u)})}}}}}}(i,r);if(nN(i))return i._toProto(r.serializer);throw r.createError(`Unsupported field value: ${yS(i)}`)}(t,e)}function l7(t,e){const n={};return vO(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):$o(t,(i,r)=>{const s=gv(r,e.childContextForField(i));s!=null&&(n[i]=s)}),{mapValue:{fields:n}}}function ON(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof mn||t instanceof kr||t instanceof Fi||t instanceof Qt||t instanceof pv||t instanceof or||nN(t))}function NN(t,e,n){if(!ON(n)||!mO(n)){const i=yS(n);throw i==="an object"?e.createError(t+" a custom object"):e.createError(t+" "+i)}}function Km(t,e,n){if((e=Ri(e))instanceof zS)return e._internalPath;if(typeof e=="string")return MN(t,e);throw $m("Field path arguments must be of type string or ",t,!1,void 0,n)}const c7=new RegExp("[~\\*/\\[\\]]");function MN(t,e,n){if(e.search(c7)>=0)throw $m(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new zS(...e.split("."))._internalPath}catch{throw $m(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function $m(t,e,n,i,r){const s=i&&!i.isEmpty(),o=r!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new oe(Y.INVALID_ARGUMENT,a+t+l)}function u7(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d7{convertValue(e,n="none"){switch(Uo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return It(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(Lo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw fe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const i={};return $o(e,(r,s)=>{i[r]=this.convertValue(s,n)}),i}convertVectorValue(e){var i,r,s;const n=(s=(r=(i=e.fields)==null?void 0:i[Vm].arrayValue)==null?void 0:r.values)==null?void 0:s.map(o=>It(o.doubleValue));return new or(n)}convertGeoPoint(e){return new kr(It(e.latitude),It(e.longitude))}convertArray(e,n){return(e.values||[]).map(i=>this.convertValue(i,n))}convertServerTimestamp(e,n){switch(n){case"previous":const i=ev(e);return i==null?null:this.convertValue(i,n);case"estimate":return this.convertTimestamp(ph(e));default:return null}}convertTimestamp(e){const n=Mo(e);return new mn(n.seconds,n.nanos)}convertDocumentKey(e,n){const i=ft.fromString(e);Qe(tN(i),9688,{name:e});const r=new mh(i.get(1),i.get(3)),s=new ue(i.popFirst(5));return r.isEqual(n)||Ts(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN extends d7{constructor(e){super(),this.firestore=e}convertBytes(e){return new Fi(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Qt(this.firestore,null,n)}}function Lw(t){return new GS("increment",t)}const Uw="@firebase/firestore",Vw="4.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UN{constructor(e,n,i,r,s){this._firestore=e,this._userDataWriter=n,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Qt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new h7(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}_fieldsProto(){var e;return((e=this._document)==null?void 0:e.data.clone().value.mapValue.fields)??void 0}get(e){if(this._document){const n=this._document.data.field(Km("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class h7 extends UN{data(){return super.data()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f7(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new oe(Y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class gd{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Pa extends UN{constructor(e,n,i,r,s,o){super(e,n,i,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Fp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const i=this._document.data.field(Km("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new oe(Y.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Pa._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Pa._jsonSchemaVersion="firestore/documentSnapshot/1.0",Pa._jsonSchema={type:qt("string",Pa._jsonSchemaVersion),bundleSource:qt("string","DocumentSnapshot"),bundleName:qt("string"),bundle:qt("string")};class Fp extends Pa{data(e={}){return super.data(e)}}class oc{constructor(e,n,i,r){this._firestore=e,this._userDataWriter=n,this._snapshot=r,this.metadata=new gd(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(i=>{e.call(n,new Fp(this._firestore,this._userDataWriter,i.key,i,new gd(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new oe(Y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let o=0;return r._snapshot.docChanges.map(a=>{const l=new Fp(r._firestore,r._userDataWriter,a.doc.key,a.doc,new gd(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const l=new Fp(r._firestore,r._userDataWriter,a.doc.key,a.doc,new gd(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);let c=-1,u=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:p7(a.type),doc:l,oldIndex:c,newIndex:u}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new oe(Y.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=oc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=vS.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],i=[],r=[];return this.docs.forEach(s=>{s._document!==null&&(n.push(s._document),i.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),r.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function p7(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fe(61501,{type:t})}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */oc._jsonSchemaVersion="firestore/querySnapshot/1.0",oc._jsonSchema={type:qt("string",oc._jsonSchemaVersion),bundleSource:qt("string","QuerySnapshot"),bundleName:qt("string"),bundle:qt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m7(t){t=qa(t,Qt);const e=qa(t.firestore,fv),n=qS(e);return WB(n,t._key).then(i=>_7(e,t,i))}function g7(t){t=qa(t,hv);const e=qa(t.firestore,fv),n=qS(e),i=new LN(e);return f7(t._query),QB(n,t._query).then(r=>new oc(e,i,t,r))}function v7(t,e,n,...i){t=qa(t,Qt);const r=qa(t.firestore,fv),s=s7(r);let o;return o=typeof(e=Ri(e))=="string"||e instanceof zS?a7(s,"updateDoc",t._key,e,n,i):o7(s,"updateDoc",t._key,e),y7(r,[o.toMutation(t._key,hs.exists(!0))])}function y7(t,e){const n=qS(t);return YB(n,e)}function _7(t,e,n){const i=n.docs.get(e._key),r=new LN(t);return new Pa(t,r,e._key,i,new gd(n.hasPendingWrites,n.fromCache),e.converter)}(function(e,n=!0){YF(tO),dh(new Oc("firestore",(i,{instanceIdentifier:r,options:s})=>{const o=i.getProvider("app").getImmediate(),a=new fv(new ZF(i.getProvider("auth-internal")),new n8(o,i.getProvider("app-check-internal")),_8(o,r),o);return s={useFetchStreams:n,...s},a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),So(Uw,Vw,e),So(Uw,Vw,"esm2020")})();var b7="firebase",T7="12.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */So(b7,T7,"app");var Fw={};const jw="@firebase/database",Bw="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let VN="";function S7(t){VN=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E7{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),fn(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:ch(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C7{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return Ps(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FN=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new E7(e)}}catch{}return new C7},Ea=FN("localStorage"),k7=FN("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ac=new pS("@firebase/database"),w7=function(){let t=1;return function(){return t++}}(),jN=function(t){const e=B9(t),n=new j9;n.update(e);const i=n.digest();return dS.encodeByteArray(i)},sf=function(...t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=sf.apply(null,i):typeof i=="object"?e+=fn(i):e+=i,e+=" "}return e};let Fd=null,qw=!0;const R7=function(t,e){Z(!0,"Can't turn on custom loggers persistently."),ac.logLevel=Le.VERBOSE,Fd=ac.log.bind(ac)},Vn=function(...t){if(qw===!0&&(qw=!1,Fd===null&&k7.get("logging_enabled")===!0&&R7()),Fd){const e=sf.apply(null,t);Fd(e)}},of=function(t){return function(...e){Vn(t,...e)}},ab=function(...t){const e="FIREBASE INTERNAL ERROR: "+sf(...t);ac.error(e)},Es=function(...t){const e=`FIREBASE FATAL ERROR: ${sf(...t)}`;throw ac.error(e),new Error(e)},oi=function(...t){const e="FIREBASE WARNING: "+sf(...t);ac.warn(e)},A7=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&oi("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},BN=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},I7=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Fc="[MIN_NAME]",Ha="[MAX_NAME]",cu=function(t,e){if(t===e)return 0;if(t===Fc||e===Ha)return-1;if(e===Fc||t===Ha)return 1;{const n=zw(t),i=zw(e);return n!==null?i!==null?n-i===0?t.length-e.length:n-i:-1:i!==null?1:t<e?-1:1}},P7=function(t,e){return t===e?0:t<e?-1:1},Wu=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+fn(e))},KS=function(t){if(typeof t!="object"||t===null)return fn(t);const e=[];for(const i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)i!==0&&(n+=","),n+=fn(e[i]),n+=":",n+=KS(t[e[i]]);return n+="}",n},qN=function(t,e){const n=t.length;if(n<=e)return[t];const i=[];for(let r=0;r<n;r+=e)r+e>n?i.push(t.substring(r,n)):i.push(t.substring(r,r+e));return i};function li(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const zN=function(t){Z(!BN(t),"Invalid JSON number");const e=11,n=52,i=(1<<e-1)-1;let r,s,o,a,l;t===0?(s=0,o=0,r=1/t===-1/0?1:0):(r=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),s=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(s=0,o=Math.round(t/Math.pow(2,1-i-n))));const c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(s%2?1:0),s=Math.floor(s/2);c.push(r?1:0),c.reverse();const u=c.join("");let d="";for(l=0;l<64;l+=8){let f=parseInt(u.substr(l,8),2).toString(16);f.length===1&&(f="0"+f),d=d+f}return d.toLowerCase()},x7=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},D7=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function O7(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}const N7=new RegExp("^-?(0*)\\d{1,10}$"),M7=-2147483648,L7=2147483647,zw=function(t){if(N7.test(t)){const e=Number(t);if(e>=M7&&e<=L7)return e}return null},uu=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw oi("Exception was thrown by user callback.",n),e},Math.floor(0))}},U7=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},jd=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V7{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,eO(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)==null||n.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){oi(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F7{constructor(e,n,i){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(Vn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',oi(e)}}class jp{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}jp.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $S="5",HN="v",GN="s",KN="r",$N="f",WN=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,QN="ls",YN="p",lb="ac",JN="websocket",XN="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZN{constructor(e,n,i,r,s=!1,o="",a=!1,l=!1,c=null){this.secure=n,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ea.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ea.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function j7(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function eM(t,e,n){Z(typeof e=="string","typeof type must == string"),Z(typeof n=="object","typeof params must == object");let i;if(e===JN)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===XN)i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);j7(t)&&(n.ns=t.namespace);const r=[];return li(n,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B7{constructor(){this.counters_={}}incrementCounter(e,n=1){Ps(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return _9(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zy={},e0={};function WS(t){const e=t.toString();return Zy[e]||(Zy[e]=new B7),Zy[e]}function q7(t,e){const n=t.toString();return e0[n]||(e0[n]=e()),e0[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z7{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&uu(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hw="start",H7="close",G7="pLPCommand",K7="pRTLPCB",tM="id",nM="pw",iM="ser",$7="cb",W7="seg",Q7="ts",Y7="d",J7="dframe",rM=1870,sM=30,X7=rM-sM,Z7=25e3,eq=3e4;class $l{constructor(e,n,i,r,s,o,a){this.connId=e,this.repoInfo=n,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=of(e),this.stats_=WS(n),this.urlFn=l=>(this.appCheckToken&&(l[lb]=this.appCheckToken),eM(n,XN,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new z7(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(eq)),I7(()=>{if(this.isClosed_)return;this.scriptTagHolder=new QS((...s)=>{const[o,a,l,c,u]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Hw)this.id=a,this.password=l;else if(o===H7)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[Hw]="t",i[iM]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[$7]=this.scriptTagHolder.uniqueCallbackIdentifier),i[HN]=$S,this.transportSessionId&&(i[GN]=this.transportSessionId),this.lastSessionId&&(i[QN]=this.lastSessionId),this.applicationId&&(i[YN]=this.applicationId),this.appCheckToken&&(i[lb]=this.appCheckToken),typeof location<"u"&&location.hostname&&WN.test(location.hostname)&&(i[KN]=$N);const r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){$l.forceAllow_=!0}static forceDisallow(){$l.forceDisallow_=!0}static isAvailable(){return $l.forceAllow_?!0:!$l.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!x7()&&!D7()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=fn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=jD(n),r=qN(i,X7);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const i={};i[J7]="t",i[tM]=e,i[nM]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=fn(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class QS{constructor(e,n,i,r){this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=w7(),window[G7+this.uniqueCallbackIdentifier]=e,window[K7+this.uniqueCallbackIdentifier]=n,this.myIFrame=QS.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Vn("frame writing exception"),a.stack&&Vn(a.stack),Vn(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Vn("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[tM]=this.myID,e[nM]=this.myPW,e[iM]=this.currentSerial;let n=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+sM+i.length<=rM;){const o=this.pendingSegs.shift();i=i+"&"+W7+r+"="+o.seg+"&"+Q7+r+"="+o.ts+"&"+Y7+r+"="+o.d,r++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,i){this.pendingSegs.push({seg:e,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},r=setTimeout(i,Math.floor(Z7)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{Vn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tq=16384,nq=45e3;let Wm=null;typeof MozWebSocket<"u"?Wm=MozWebSocket:typeof WebSocket<"u"&&(Wm=WebSocket);class Xi{constructor(e,n,i,r,s,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=of(this.connId),this.stats_=WS(n),this.connURL=Xi.connectionURL_(n,o,a,r,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,i,r,s){const o={};return o[HN]=$S,typeof location<"u"&&location.hostname&&WN.test(location.hostname)&&(o[KN]=$N),n&&(o[GN]=n),i&&(o[QN]=i),r&&(o[lb]=r),s&&(o[YN]=s),eM(e,JN,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ea.set("previous_websocket_failure",!0);try{let i;P9(),this.mySock=new Wm(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Xi.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(n);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&Wm!==null&&!Xi.forceDisallow_}static previouslyFailed(){return Ea.isInMemoryStorage||Ea.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ea.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const i=ch(n);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Z(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const i=this.extractFrameCount_(n);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const n=fn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=qN(n,tq);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(nq))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Xi.responsesRequiredToBeHealthy=2;Xi.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{static get ALL_TRANSPORTS(){return[$l,Xi]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Xi&&Xi.isAvailable();let i=n&&!Xi.previouslyFailed();if(e.webSocketOnly&&(n||oi("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Xi];else{const r=this.transports_=[];for(const s of bh.ALL_TRANSPORTS)s&&s.isAvailable()&&r.push(s);bh.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}bh.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iq=6e4,rq=5e3,sq=10*1024,oq=100*1024,t0="t",Gw="d",aq="s",Kw="r",lq="e",$w="o",Ww="a",Qw="n",Yw="p",cq="h";class uq{constructor(e,n,i,r,s,o,a,l,c,u){this.id=e,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=of("c:"+this.id+":"),this.transportManager_=new bh(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=jd(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>oq?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>sq?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(t0 in e){const n=e[t0];n===Ww?this.upgradeIfSecondaryHealthy_():n===Kw?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===$w&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Wu("t",e),i=Wu("d",e);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Yw,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Ww,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Qw,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Wu("t",e),i=Wu("d",e);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Wu(t0,e);if(Gw in e){const i=e[Gw];if(n===cq){const r={...i};this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(n===Qw){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===aq?this.onConnectionShutdown_(i):n===Kw?this.onReset_(i):n===lq?ab("Server Error: "+i):n===$w?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ab("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),$S!==i&&oi("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),jd(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(iq))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):jd(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(rq))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Yw,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ea.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{put(e,n,i,r){}merge(e,n,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,i){}onDisconnectMerge(e,n,i){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aM{constructor(e){this.allowedEvents_=e,this.listeners_={},Z(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,n)}}on(e,n,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:i});const r=this.getInitialEvent(e);r&&n.apply(i,r)}off(e,n,i){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===n&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){Z(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm extends aM{static getInstance(){return new Qm}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!WD()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Z(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jw=32,Xw=768;class at{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Ge(){return new at("")}function we(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function jo(t){return t.pieces_.length-t.pieceNum_}function lt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new at(t.pieces_,e)}function lM(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function dq(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function cM(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function uM(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new at(e,0)}function Wt(t,e){const n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof at)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{const i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new at(n,0)}function xe(t){return t.pieceNum_>=t.pieces_.length}function ni(t,e){const n=we(t),i=we(e);if(n===null)return e;if(n===i)return ni(lt(t),lt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function YS(t,e){if(jo(t)!==jo(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function ir(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(jo(t)>jo(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}class hq{constructor(e,n){this.errorPrefix_=n,this.parts_=cM(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Jg(this.parts_[i]);dM(this)}}function fq(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Jg(e),dM(t)}function pq(t){const e=t.parts_.pop();t.byteLength_-=Jg(e),t.parts_.length>0&&(t.byteLength_-=1)}function dM(t){if(t.byteLength_>Xw)throw new Error(t.errorPrefix_+"has a key path longer than "+Xw+" bytes ("+t.byteLength_+").");if(t.parts_.length>Jw)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Jw+") or object contains a cycle "+ya(t))}function ya(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS extends aM{static getInstance(){return new JS}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return Z(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qu=1e3,mq=60*5*1e3,Zw=30*1e3,gq=1.3,vq=3e4,yq="server_kill",eR=3;class fs extends oM{constructor(e,n,i,r,s,o,a,l){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=l,this.id=fs.nextPersistentConnectionId_++,this.log_=of("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Qu,this.maxReconnectDelay_=mq,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");JS.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Qm.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,i){const r=++this.requestNumber_,s={r,a:e,b:n};this.log_(fn(s)),Z(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),i&&(this.requestCBHash_[r]=i)}get(e){this.initConnection_();const n=new Yg,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),n.promise}listen(e,n,i,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Z(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:n,query:e,tag:i};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(i)})}sendListen_(e){const n=e.query,i=n._path.toString(),r=n._queryIdentifier;this.log_("Listen on "+i+" for "+r);const s={p:i},o="q";e.tag&&(s.q=n._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const l=a.d,c=a.s;fs.warnOnListenWarnings_(l,n),(this.listens.get(i)&&this.listens.get(i).get(r))===e&&(this.log_("listen response",a),c!=="ok"&&this.removeListen_(i,r),e.onComplete&&e.onComplete(c,l))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&Ps(e,"w")){const i=Dc(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const r='".indexOn": "'+n._queryParams.getIndex().toString()+'"',s=n._path.toString();oi(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||V9(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Zw)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=U9(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(n,i,r=>{const s=r.s,o=r.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,i=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,i)})}unlisten(e,n){const i=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),Z(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,e._queryObject,n)}sendUnlisten_(e,n,i,r){this.log_("Unlisten on "+e+" for "+n);const s={p:e},o="n";r&&(s.q=i,s.t=r),this.sendRequest(o,s)}onDisconnectPut(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:i})}onDisconnectMerge(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:i})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,i,r){const s={p:n,d:i};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{r&&setTimeout(()=>{r(o.s,o.d)},Math.floor(0))})}put(e,n,i,r){this.putInternal("p",e,n,i,r)}merge(e,n,i,r){this.putInternal("m",e,n,i,r)}putInternal(e,n,i,r,s){this.initConnection_();const o={p:n,d:i};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,i,s=>{this.log_(n+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(s.s,s.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,i=>{if(i.s!=="ok"){const s=i.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+fn(e));const n=e.r,i=this.requestCBHash_[n];i&&(delete this.requestCBHash_[n],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):ab("Unrecognized action received from server: "+fn(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Z(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Qu,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Qu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>vq&&(this.reconnectDelay_=Qu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*gq)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+fs.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const l=function(){a?a.close():(o=!0,i())},c=function(d){Z(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(d)};this.realtime_={close:l,sendRequest:c};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[d,f]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?Vn("getToken() completed but was canceled"):(Vn("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,a=new uq(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,i,p=>{oi(p+" ("+this.repoInfo_.toString()+")"),this.interrupt(yq)},s))}catch(d){this.log_("Failed to get token: "+d),o||(this.repoInfo_.nodeAdmin&&oi(d),l())}}}interrupt(e){Vn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Vn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],xk(this.interruptReasons_)&&(this.reconnectDelay_=Qu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let i;n?i=n.map(s=>KS(s)).join("$"):i="default";const r=this.removeListen_(e,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,n){const i=new at(e).toString();let r;if(this.listens.has(i)){const s=this.listens.get(i);r=s.get(n),s.delete(n),s.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(e,n){Vn("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=eR&&(this.reconnectDelay_=Zw,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){Vn("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=eR&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+VN.replace(/\./g,"-")]=1,WD()?e["framework.cordova"]=1:I9()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Qm.getInstance().currentlyOnline();return xk(this.interruptReasons_)&&e}}fs.nextPersistentConnectionId_=0;fs.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new Re(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const i=new Re(Fc,e),r=new Re(Fc,n);return this.compare(i,r)!==0}minPost(){return Re.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sp;class hM extends vv{static get __EMPTY_NODE(){return sp}static set __EMPTY_NODE(e){sp=e}compare(e,n){return cu(e.name,n.name)}isDefinedOn(e){throw iu("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return Re.MIN}maxPost(){return new Re(Ha,sp)}makePost(e,n){return Z(typeof e=="string","KeyIndex indexValue must always be a string."),new Re(e,sp)}toString(){return".key"}}const lc=new hM;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class op{constructor(e,n,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?i(e.key,n):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class cn{constructor(e,n,i,r,s){this.key=e,this.value=n,this.color=i??cn.RED,this.left=r??ii.EMPTY_NODE,this.right=s??ii.EMPTY_NODE}copy(e,n,i,r,s){return new cn(e??this.key,n??this.value,i??this.color,r??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let r=this;const s=i(e,r.key);return s<0?r=r.copy(null,null,null,r.left.insert(e,n,i),null):s===0?r=r.copy(null,n,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,n,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ii.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let i,r;if(i=this,n(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),n(e,i.key)===0){if(i.right.isEmpty())return ii.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,cn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,cn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}cn.RED=!0;cn.BLACK=!1;class _q{copy(e,n,i,r,s){return this}insert(e,n,i){return new cn(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ii{constructor(e,n=ii.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new ii(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,cn.BLACK,null,null))}remove(e){return new ii(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,cn.BLACK,null,null))}get(e){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(e,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(e){let n,i=this.root_,r=null;for(;!i.isEmpty();)if(n=this.comparator_(e,i.key),n===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new op(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new op(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new op(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new op(this.root_,null,this.comparator_,!0,e)}}ii.EMPTY_NODE=new _q;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bq(t,e){return cu(t.name,e.name)}function XS(t,e){return cu(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cb;function Tq(t){cb=t}const fM=function(t){return typeof t=="number"?"number:"+zN(t):"string:"+t},pM=function(t){if(t.isLeafNode()){const e=t.val();Z(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ps(e,".sv"),"Priority must be a string or number.")}else Z(t===cb||t.isEmpty(),"priority of unexpected type.");Z(t===cb||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tR;class on{static set __childrenNodeConstructor(e){tR=e}static get __childrenNodeConstructor(){return tR}constructor(e,n=on.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,Z(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),pM(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new on(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:on.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return xe(e)?this:we(e)===".priority"?this.priorityNode_:on.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:on.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const i=we(e);return i===null?n:n.isEmpty()&&i!==".priority"?this:(Z(i!==".priority"||jo(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,on.__childrenNodeConstructor.EMPTY_NODE.updateChild(lt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+fM(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=zN(this.value_):e+=this.value_,this.lazyHash_=jN(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===on.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof on.__childrenNodeConstructor?-1:(Z(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,i=typeof this.value_,r=on.VALUE_TYPE_ORDER.indexOf(n),s=on.VALUE_TYPE_ORDER.indexOf(i);return Z(r>=0,"Unknown leaf type: "+n),Z(s>=0,"Unknown leaf type: "+i),r===s?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}on.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mM,gM;function Sq(t){mM=t}function Eq(t){gM=t}class Cq extends vv{compare(e,n){const i=e.node.getPriority(),r=n.node.getPriority(),s=i.compareTo(r);return s===0?cu(e.name,n.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return Re.MIN}maxPost(){return new Re(Ha,new on("[PRIORITY-POST]",gM))}makePost(e,n){const i=mM(e);return new Re(n,new on("[PRIORITY-POST]",i))}toString(){return".priority"}}const Rt=new Cq;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kq=Math.log(2);class wq{constructor(e){const n=s=>parseInt(Math.log(s)/kq,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Ym=function(t,e,n,i){t.sort(e);const r=function(l,c){const u=c-l;let d,f;if(u===0)return null;if(u===1)return d=t[l],f=n?n(d):d,new cn(f,d.node,cn.BLACK,null,null);{const p=parseInt(u/2,10)+l,v=r(l,p),g=r(p+1,c);return d=t[p],f=n?n(d):d,new cn(f,d.node,cn.BLACK,v,g)}},s=function(l){let c=null,u=null,d=t.length;const f=function(v,g){const E=d-v,y=d;d-=v;const T=r(E+1,y),R=t[E],b=n?n(R):R;p(new cn(b,R.node,g,null,T))},p=function(v){c?(c.left=v,c=v):(u=v,c=v)};for(let v=0;v<l.count;++v){const g=l.nextBitIsOne(),E=Math.pow(2,l.count-(v+1));g?f(E,cn.BLACK):(f(E,cn.BLACK),f(E,cn.RED))}return u},o=new wq(t.length),a=s(o);return new ii(i||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let n0;const kl={};class os{static get Default(){return Z(kl&&Rt,"ChildrenNode.ts has not been loaded"),n0=n0||new os({".priority":kl},{".priority":Rt}),n0}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Dc(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof ii?n:null}hasIndex(e){return Ps(this.indexSet_,e.toString())}addIndex(e,n){Z(e!==lc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let r=!1;const s=n.getIterator(Re.Wrap);let o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=Ym(i,e.getCompare()):a=kl;const l=e.toString(),c={...this.indexSet_};c[l]=e;const u={...this.indexes_};return u[l]=a,new os(u,c)}addToIndexes(e,n){const i=Nm(this.indexes_,(r,s)=>{const o=Dc(this.indexSet_,s);if(Z(o,"Missing index implementation for "+s),r===kl)if(o.isDefinedOn(e.node)){const a=[],l=n.getIterator(Re.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Ym(a,o.getCompare())}else return kl;else{const a=n.get(e.name);let l=r;return a&&(l=l.remove(new Re(e.name,a))),l.insert(e,e.node)}});return new os(i,this.indexSet_)}removeFromIndexes(e,n){const i=Nm(this.indexes_,r=>{if(r===kl)return r;{const s=n.get(e.name);return s?r.remove(new Re(e.name,s)):r}});return new os(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yu;class me{static get EMPTY_NODE(){return Yu||(Yu=new me(new ii(XS),null,os.Default))}constructor(e,n,i){this.children_=e,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&pM(this.priorityNode_),this.children_.isEmpty()&&Z(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Yu}updatePriority(e){return this.children_.isEmpty()?this:new me(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Yu:n}}getChild(e){const n=we(e);return n===null?this:this.getImmediateChild(n).getChild(lt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(Z(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const i=new Re(e,n);let r,s;n.isEmpty()?(r=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(i,this.children_));const o=r.isEmpty()?Yu:this.priorityNode_;return new me(r,o,s)}}updateChild(e,n){const i=we(e);if(i===null)return n;{Z(we(e)!==".priority"||jo(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(i).updateChild(lt(e),n);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let i=0,r=0,s=!0;if(this.forEachChild(Rt,(o,a)=>{n[o]=a.val(e),i++,s&&me.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):s=!1}),!e&&s&&r<2*i){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+fM(this.getPriority().val())+":"),this.forEachChild(Rt,(n,i)=>{const r=i.hash();r!==""&&(e+=":"+n+":"+r)}),this.lazyHash_=e===""?"":jN(e)}return this.lazyHash_}getPredecessorChildName(e,n,i){const r=this.resolveIndex_(i);if(r){const s=r.getPredecessorKey(new Re(e,n));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new Re(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new Re(n,this.children_.get(n)):null}forEachChild(e,n){const i=this.resolveIndex_(e);return i?i.inorderTraversal(r=>n(r.name,r.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,Re.Wrap);let s=r.peek();for(;s!=null&&n.compare(s,e)<0;)r.getNext(),s=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,Re.Wrap);let s=r.peek();for(;s!=null&&n.compare(s,e)>0;)r.getNext(),s=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===af?-1:0}withIndex(e){if(e===lc||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new me(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===lc||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const i=this.getIterator(Rt),r=n.getIterator(Rt);let s=i.getNext(),o=r.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=i.getNext(),o=r.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===lc?null:this.indexMap_.get(e.toString())}}me.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Rq extends me{constructor(){super(new ii(XS),me.EMPTY_NODE,os.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return me.EMPTY_NODE}isEmpty(){return!1}}const af=new Rq;Object.defineProperties(Re,{MIN:{value:new Re(Fc,me.EMPTY_NODE)},MAX:{value:new Re(Ha,af)}});hM.__EMPTY_NODE=me.EMPTY_NODE;on.__childrenNodeConstructor=me;Tq(af);Eq(af);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aq=!0;function Tn(t,e=null){if(t===null)return me.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),Z(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new on(n,Tn(e))}if(!(t instanceof Array)&&Aq){const n=[];let i=!1;if(li(t,(o,a)=>{if(o.substring(0,1)!=="."){const l=Tn(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),n.push(new Re(o,l)))}}),n.length===0)return me.EMPTY_NODE;const s=Ym(n,bq,o=>o.name,XS);if(i){const o=Ym(n,Rt.getCompare());return new me(s,Tn(e),new os({".priority":o},{".priority":Rt}))}else return new me(s,Tn(e),os.Default)}else{let n=me.EMPTY_NODE;return li(t,(i,r)=>{if(Ps(t,i)&&i.substring(0,1)!=="."){const s=Tn(r);(s.isLeafNode()||!s.isEmpty())&&(n=n.updateImmediateChild(i,s))}}),n.updatePriority(Tn(e))}}Sq(Tn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iq extends vv{constructor(e){super(),this.indexPath_=e,Z(!xe(e)&&we(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const i=this.extractChild(e.node),r=this.extractChild(n.node),s=i.compareTo(r);return s===0?cu(e.name,n.name):s}makePost(e,n){const i=Tn(e),r=me.EMPTY_NODE.updateChild(this.indexPath_,i);return new Re(n,r)}maxPost(){const e=me.EMPTY_NODE.updateChild(this.indexPath_,af);return new Re(Ha,e)}toString(){return cM(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pq extends vv{compare(e,n){const i=e.node.compareTo(n.node);return i===0?cu(e.name,n.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return Re.MIN}maxPost(){return Re.MAX}makePost(e,n){const i=Tn(e);return new Re(n,i)}toString(){return".value"}}const xq=new Pq;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vM(t){return{type:"value",snapshotNode:t}}function jc(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Th(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Sh(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Dq(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZS{constructor(e){this.index_=e}updateChild(e,n,i,r,s,o){Z(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(Th(n,a)):Z(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(jc(n,i)):o.trackChildChange(Sh(n,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(n,i).withIndex(this.index_)}updateFullNode(e,n,i){return i!=null&&(e.isLeafNode()||e.forEachChild(Rt,(r,s)=>{n.hasChild(r)||i.trackChildChange(Th(r,s))}),n.isLeafNode()||n.forEachChild(Rt,(r,s)=>{if(e.hasChild(r)){const o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(Sh(r,s,o))}else i.trackChildChange(jc(r,s))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?me.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(e){this.indexedFilter_=new ZS(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Eh.getStartPost_(e),this.endPost_=Eh.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&i}updateChild(e,n,i,r,s,o){return this.matches(new Re(n,i))||(i=me.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,i,r,s,o)}updateFullNode(e,n,i){n.isLeafNode()&&(n=me.EMPTY_NODE);let r=n.withIndex(this.index_);r=r.updatePriority(me.EMPTY_NODE);const s=this;return n.forEachChild(Rt,(o,a)=>{s.matches(new Re(o,a))||(r=r.updateImmediateChild(o,me.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oq{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=n=>{const i=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Eh(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,i,r,s,o){return this.rangedFilter_.matches(new Re(n,i))||(i=me.EMPTY_NODE),e.getImmediateChild(n).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,i,r,s,o):this.fullLimitUpdateChild_(e,n,i,s,o)}updateFullNode(e,n,i){let r;if(n.isLeafNode()||n.isEmpty())r=me.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){r=me.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=n.withIndex(this.index_),r=r.updatePriority(me.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,me.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,r,s){let o;if(this.reverse_){const d=this.index_.getCompare();o=(f,p)=>d(p,f)}else o=this.index_.getCompare();const a=e;Z(a.numChildren()===this.limit_,"");const l=new Re(n,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(n)){const d=a.getImmediateChild(n);let f=r.getChildAfterChild(this.index_,c,this.reverse_);for(;f!=null&&(f.name===n||a.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);const p=f==null?1:o(f,l);if(u&&!i.isEmpty()&&p>=0)return s!=null&&s.trackChildChange(Sh(n,i,d)),a.updateImmediateChild(n,i);{s!=null&&s.trackChildChange(Th(n,d));const g=a.updateImmediateChild(n,me.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(s!=null&&s.trackChildChange(jc(f.name,f.node)),g.updateImmediateChild(f.name,f.node)):g}}else return i.isEmpty()?e:u&&o(c,l)>=0?(s!=null&&(s.trackChildChange(Th(c.name,c.node)),s.trackChildChange(jc(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(c.name,me.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Rt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Z(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Z(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Fc}hasEnd(){return this.endSet_}getIndexEndValue(){return Z(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Z(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ha}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Z(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Rt}copy(){const e=new eE;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Nq(t){return t.loadsAllData()?new ZS(t.getIndex()):t.hasLimit()?new Oq(t):new Eh(t)}function nR(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Rt?n="$priority":t.index_===xq?n="$value":t.index_===lc?n="$key":(Z(t.index_ instanceof Iq,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=fn(n),t.startSet_){const i=t.startAfterSet_?"startAfter":"startAt";e[i]=fn(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+fn(t.indexStartName_))}if(t.endSet_){const i=t.endBeforeSet_?"endBefore":"endAt";e[i]=fn(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+fn(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function iR(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Rt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm extends oM{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(Z(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=of("p:rest:"),this.listens_={}}listen(e,n,i,r){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=Jm.getListenId_(e,i),a={};this.listens_[o]=a;const l=nR(e._queryParams);this.restRequest_(s+".json",l,(c,u)=>{let d=u;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(s,d,!1,i),Dc(this.listens_,o)===a){let f;c?c===401?f="permission_denied":f="rest_error:"+c:f="ok",r(f,null)}})}unlisten(e,n){const i=Jm.getListenId_(e,n);delete this.listens_[i]}get(e){const n=nR(e._queryParams),i=e._path.toString(),r=new Yg;return this.restRequest_(i+".json",n,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(n.auth=r.accessToken),s&&s.token&&(n.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+F9(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=ch(a.responseText)}catch{oi("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&oi("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mq{constructor(){this.rootNode_=me.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xm(){return{value:null,children:new Map}}function yM(t,e,n){if(xe(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const i=we(e);t.children.has(i)||t.children.set(i,Xm());const r=t.children.get(i);e=lt(e),yM(r,e,n)}}function ub(t,e,n){t.value!==null?n(e,t.value):Lq(t,(i,r)=>{const s=new at(e.toString()+"/"+i);ub(r,s,n)})}function Lq(t,e){t.children.forEach((n,i)=>{e(i,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uq{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&li(this.last_,(i,r)=>{n[i]=n[i]-r}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rR=10*1e3,Vq=30*1e3,Fq=5*60*1e3;class jq{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Uq(e);const i=rR+(Vq-rR)*Math.random();jd(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),n={};let i=!1;li(e,(r,s)=>{s>0&&Ps(this.statsToReport_,r)&&(n[r]=s,i=!0)}),i&&this.server_.reportStats(n),jd(this.reportStats_.bind(this),Math.floor(Math.random()*2*Fq))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rr;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(rr||(rr={}));function _M(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function tE(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function nE(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(e,n,i){this.path=e,this.affectedTree=n,this.revert=i,this.type=rr.ACK_USER_WRITE,this.source=_M()}operationForChild(e){if(xe(this.path)){if(this.affectedTree.value!=null)return Z(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new at(e));return new Zm(Ge(),n,this.revert)}}else return Z(we(this.path)===e,"operationForChild called for unrelated child."),new Zm(lt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ch{constructor(e,n){this.source=e,this.path=n,this.type=rr.LISTEN_COMPLETE}operationForChild(e){return xe(this.path)?new Ch(this.source,Ge()):new Ch(this.source,lt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ga{constructor(e,n,i){this.source=e,this.path=n,this.snap=i,this.type=rr.OVERWRITE}operationForChild(e){return xe(this.path)?new Ga(this.source,Ge(),this.snap.getImmediateChild(e)):new Ga(this.source,lt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kh{constructor(e,n,i){this.source=e,this.path=n,this.children=i,this.type=rr.MERGE}operationForChild(e){if(xe(this.path)){const n=this.children.subtree(new at(e));return n.isEmpty()?null:n.value?new Ga(this.source,Ge(),n.value):new kh(this.source,Ge(),n)}else return Z(we(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new kh(this.source,lt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka{constructor(e,n,i){this.node_=e,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(xe(e))return this.isFullyInitialized()&&!this.filtered_;const n=we(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bq{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function qq(t,e,n,i){const r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(Dq(o.childName,o.snapshotNode))}),Ju(t,r,"child_removed",e,i,n),Ju(t,r,"child_added",e,i,n),Ju(t,r,"child_moved",s,i,n),Ju(t,r,"child_changed",e,i,n),Ju(t,r,"value",e,i,n),r}function Ju(t,e,n,i,r,s){const o=i.filter(a=>a.type===n);o.sort((a,l)=>Hq(t,a,l)),o.forEach(a=>{const l=zq(t,a,s);r.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function zq(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Hq(t,e,n){if(e.childName==null||n.childName==null)throw iu("Should only compare child_ events.");const i=new Re(e.childName,e.snapshotNode),r=new Re(n.childName,n.snapshotNode);return t.index_.compare(i,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yv(t,e){return{eventCache:t,serverCache:e}}function Bd(t,e,n,i){return yv(new Ka(e,n,i),t.serverCache)}function bM(t,e,n,i){return yv(t.eventCache,new Ka(e,n,i))}function db(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function $a(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let i0;const Gq=()=>(i0||(i0=new ii(P7)),i0);class dt{static fromObject(e){let n=new dt(null);return li(e,(i,r)=>{n=n.set(new at(i),r)}),n}constructor(e,n=Gq()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Ge(),value:this.value};if(xe(e))return null;{const i=we(e),r=this.children.get(i);if(r!==null){const s=r.findRootMostMatchingPathAndValue(lt(e),n);return s!=null?{path:Wt(new at(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(xe(e))return this;{const n=we(e),i=this.children.get(n);return i!==null?i.subtree(lt(e)):new dt(null)}}set(e,n){if(xe(e))return new dt(n,this.children);{const i=we(e),s=(this.children.get(i)||new dt(null)).set(lt(e),n),o=this.children.insert(i,s);return new dt(this.value,o)}}remove(e){if(xe(e))return this.children.isEmpty()?new dt(null):new dt(null,this.children);{const n=we(e),i=this.children.get(n);if(i){const r=i.remove(lt(e));let s;return r.isEmpty()?s=this.children.remove(n):s=this.children.insert(n,r),this.value===null&&s.isEmpty()?new dt(null):new dt(this.value,s)}else return this}}get(e){if(xe(e))return this.value;{const n=we(e),i=this.children.get(n);return i?i.get(lt(e)):null}}setTree(e,n){if(xe(e))return n;{const i=we(e),s=(this.children.get(i)||new dt(null)).setTree(lt(e),n);let o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new dt(this.value,o)}}fold(e){return this.fold_(Ge(),e)}fold_(e,n){const i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(Wt(e,r),n)}),n(e,this.value,i)}findOnPath(e,n){return this.findOnPath_(e,Ge(),n)}findOnPath_(e,n,i){const r=this.value?i(n,this.value):!1;if(r)return r;if(xe(e))return null;{const s=we(e),o=this.children.get(s);return o?o.findOnPath_(lt(e),Wt(n,s),i):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Ge(),n)}foreachOnPath_(e,n,i){if(xe(e))return this;{this.value&&i(n,this.value);const r=we(e),s=this.children.get(r);return s?s.foreachOnPath_(lt(e),Wt(n,r),i):new dt(null)}}foreach(e){this.foreach_(Ge(),e)}foreach_(e,n){this.children.inorderTraversal((i,r)=>{r.foreach_(Wt(e,i),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,i)=>{i.value&&e(n,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{constructor(e){this.writeTree_=e}static empty(){return new ar(new dt(null))}}function qd(t,e,n){if(xe(e))return new ar(new dt(n));{const i=t.writeTree_.findRootMostValueAndPath(e);if(i!=null){const r=i.path;let s=i.value;const o=ni(r,e);return s=s.updateChild(o,n),new ar(t.writeTree_.set(r,s))}else{const r=new dt(n),s=t.writeTree_.setTree(e,r);return new ar(s)}}}function sR(t,e,n){let i=t;return li(n,(r,s)=>{i=qd(i,Wt(e,r),s)}),i}function oR(t,e){if(xe(e))return ar.empty();{const n=t.writeTree_.setTree(e,new dt(null));return new ar(n)}}function hb(t,e){return ul(t,e)!=null}function ul(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(ni(n.path,e)):null}function aR(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Rt,(i,r)=>{e.push(new Re(i,r))}):t.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new Re(i,r.value))}),e}function wo(t,e){if(xe(e))return t;{const n=ul(t,e);return n!=null?new ar(new dt(n)):new ar(t.writeTree_.subtree(e))}}function fb(t){return t.writeTree_.isEmpty()}function Bc(t,e){return TM(Ge(),t.writeTree_,e)}function TM(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(Z(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):n=TM(Wt(t,r),s,n)}),!n.getChild(t).isEmpty()&&i!==null&&(n=n.updateChild(Wt(t,".priority"),i)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iE(t,e){return kM(e,t)}function Kq(t,e,n,i,r){Z(i>t.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:r}),r&&(t.visibleWrites=qd(t.visibleWrites,e,n)),t.lastWriteId=i}function $q(t,e){for(let n=0;n<t.allWrites.length;n++){const i=t.allWrites[n];if(i.writeId===e)return i}return null}function Wq(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);Z(n>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[n];t.allWrites.splice(n,1);let r=i.visible,s=!1,o=t.allWrites.length-1;for(;r&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&Qq(a,i.path)?r=!1:ir(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return Yq(t),!0;if(i.snap)t.visibleWrites=oR(t.visibleWrites,i.path);else{const a=i.children;li(a,l=>{t.visibleWrites=oR(t.visibleWrites,Wt(i.path,l))})}return!0}else return!1}function Qq(t,e){if(t.snap)return ir(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&ir(Wt(t.path,n),e))return!0;return!1}function Yq(t){t.visibleWrites=SM(t.allWrites,Jq,Ge()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Jq(t){return t.visible}function SM(t,e,n){let i=ar.empty();for(let r=0;r<t.length;++r){const s=t[r];if(e(s)){const o=s.path;let a;if(s.snap)ir(n,o)?(a=ni(n,o),i=qd(i,a,s.snap)):ir(o,n)&&(a=ni(o,n),i=qd(i,Ge(),s.snap.getChild(a)));else if(s.children){if(ir(n,o))a=ni(n,o),i=sR(i,a,s.children);else if(ir(o,n))if(a=ni(o,n),xe(a))i=sR(i,Ge(),s.children);else{const l=Dc(s.children,we(a));if(l){const c=l.getChild(lt(a));i=qd(i,Ge(),c)}}}else throw iu("WriteRecord should have .snap or .children")}}return i}function EM(t,e,n,i,r){if(!i&&!r){const s=ul(t.visibleWrites,e);if(s!=null)return s;{const o=wo(t.visibleWrites,e);if(fb(o))return n;if(n==null&&!hb(o,Ge()))return null;{const a=n||me.EMPTY_NODE;return Bc(o,a)}}}else{const s=wo(t.visibleWrites,e);if(!r&&fb(s))return n;if(!r&&n==null&&!hb(s,Ge()))return null;{const o=function(c){return(c.visible||r)&&(!i||!~i.indexOf(c.writeId))&&(ir(c.path,e)||ir(e,c.path))},a=SM(t.allWrites,o,e),l=n||me.EMPTY_NODE;return Bc(a,l)}}}function Xq(t,e,n){let i=me.EMPTY_NODE;const r=ul(t.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(Rt,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(n){const s=wo(t.visibleWrites,e);return n.forEachChild(Rt,(o,a)=>{const l=Bc(wo(s,new at(o)),a);i=i.updateImmediateChild(o,l)}),aR(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const s=wo(t.visibleWrites,e);return aR(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Zq(t,e,n,i,r){Z(i||r,"Either existingEventSnap or existingServerSnap must exist");const s=Wt(e,n);if(hb(t.visibleWrites,s))return null;{const o=wo(t.visibleWrites,s);return fb(o)?r.getChild(n):Bc(o,r.getChild(n))}}function ez(t,e,n,i){const r=Wt(e,n),s=ul(t.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(n)){const o=wo(t.visibleWrites,r);return Bc(o,i.getNode().getImmediateChild(n))}else return null}function tz(t,e){return ul(t.visibleWrites,e)}function nz(t,e,n,i,r,s,o){let a;const l=wo(t.visibleWrites,e),c=ul(l,Ge());if(c!=null)a=c;else if(n!=null)a=Bc(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const u=[],d=o.getCompare(),f=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let p=f.getNext();for(;p&&u.length<r;)d(p,i)!==0&&u.push(p),p=f.getNext();return u}else return[]}function iz(){return{visibleWrites:ar.empty(),allWrites:[],lastWriteId:-1}}function eg(t,e,n,i){return EM(t.writeTree,t.treePath,e,n,i)}function rE(t,e){return Xq(t.writeTree,t.treePath,e)}function lR(t,e,n,i){return Zq(t.writeTree,t.treePath,e,n,i)}function tg(t,e){return tz(t.writeTree,Wt(t.treePath,e))}function rz(t,e,n,i,r,s){return nz(t.writeTree,t.treePath,e,n,i,r,s)}function sE(t,e,n){return ez(t.writeTree,t.treePath,e,n)}function CM(t,e){return kM(Wt(t.treePath,e),t.writeTree)}function kM(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sz{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,i=e.childName;Z(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),Z(i!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(i);if(r){const s=r.type;if(n==="child_added"&&s==="child_removed")this.changeMap.set(i,Sh(i,e.snapshotNode,r.snapshotNode));else if(n==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&s==="child_changed")this.changeMap.set(i,Th(i,r.oldSnap));else if(n==="child_changed"&&s==="child_added")this.changeMap.set(i,jc(i,e.snapshotNode));else if(n==="child_changed"&&s==="child_changed")this.changeMap.set(i,Sh(i,e.snapshotNode,r.oldSnap));else throw iu("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oz{getCompleteChild(e){return null}getChildAfterChild(e,n,i){return null}}const wM=new oz;class oE{constructor(e,n,i=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new Ka(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return sE(this.writes_,e,i)}}getChildAfterChild(e,n,i){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:$a(this.viewCache_),s=rz(this.writes_,r,n,1,i,e);return s.length===0?null:s[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function az(t){return{filter:t}}function lz(t,e){Z(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),Z(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function cz(t,e,n,i,r){const s=new sz;let o,a;if(n.type===rr.OVERWRITE){const c=n;c.source.fromUser?o=pb(t,e,c.path,c.snap,i,r,s):(Z(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!xe(c.path),o=ng(t,e,c.path,c.snap,i,r,a,s))}else if(n.type===rr.MERGE){const c=n;c.source.fromUser?o=dz(t,e,c.path,c.children,i,r,s):(Z(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=mb(t,e,c.path,c.children,i,r,a,s))}else if(n.type===rr.ACK_USER_WRITE){const c=n;c.revert?o=pz(t,e,c.path,i,r,s):o=hz(t,e,c.path,c.affectedTree,i,r,s)}else if(n.type===rr.LISTEN_COMPLETE)o=fz(t,e,n.path,i,s);else throw iu("Unknown operation type: "+n.type);const l=s.getChanges();return uz(e,o,l),{viewCache:o,changes:l}}function uz(t,e,n){const i=e.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=db(t);(n.length>0||!t.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(vM(db(e)))}}function RM(t,e,n,i,r,s){const o=e.eventCache;if(tg(i,n)!=null)return e;{let a,l;if(xe(n))if(Z(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=$a(e),u=c instanceof me?c:me.EMPTY_NODE,d=rE(i,u);a=t.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{const c=eg(i,$a(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,s)}else{const c=we(n);if(c===".priority"){Z(jo(n)===1,"Can't have a priority with additional path components");const u=o.getNode();l=e.serverCache.getNode();const d=lR(i,n,u,l);d!=null?a=t.filter.updatePriority(u,d):a=o.getNode()}else{const u=lt(n);let d;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const f=lR(i,n,o.getNode(),l);f!=null?d=o.getNode().getImmediateChild(c).updateChild(u,f):d=o.getNode().getImmediateChild(c)}else d=sE(i,c,e.serverCache);d!=null?a=t.filter.updateChild(o.getNode(),c,d,u,r,s):a=o.getNode()}}return Bd(e,a,o.isFullyInitialized()||xe(n),t.filter.filtersNodes())}}function ng(t,e,n,i,r,s,o,a){const l=e.serverCache;let c;const u=o?t.filter:t.filter.getIndexedFilter();if(xe(n))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){const p=l.getNode().updateChild(n,i);c=u.updateFullNode(l.getNode(),p,null)}else{const p=we(n);if(!l.isCompleteForPath(n)&&jo(n)>1)return e;const v=lt(n),E=l.getNode().getImmediateChild(p).updateChild(v,i);p===".priority"?c=u.updatePriority(l.getNode(),E):c=u.updateChild(l.getNode(),p,E,v,wM,null)}const d=bM(e,c,l.isFullyInitialized()||xe(n),u.filtersNodes()),f=new oE(r,d,s);return RM(t,d,n,r,f,a)}function pb(t,e,n,i,r,s,o){const a=e.eventCache;let l,c;const u=new oE(r,e,s);if(xe(n))c=t.filter.updateFullNode(e.eventCache.getNode(),i,o),l=Bd(e,c,!0,t.filter.filtersNodes());else{const d=we(n);if(d===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),i),l=Bd(e,c,a.isFullyInitialized(),a.isFiltered());else{const f=lt(n),p=a.getNode().getImmediateChild(d);let v;if(xe(f))v=i;else{const g=u.getCompleteChild(d);g!=null?lM(f)===".priority"&&g.getChild(uM(f)).isEmpty()?v=g:v=g.updateChild(f,i):v=me.EMPTY_NODE}if(p.equals(v))l=e;else{const g=t.filter.updateChild(a.getNode(),d,v,f,u,o);l=Bd(e,g,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function cR(t,e){return t.eventCache.isCompleteForChild(e)}function dz(t,e,n,i,r,s,o){let a=e;return i.foreach((l,c)=>{const u=Wt(n,l);cR(e,we(u))&&(a=pb(t,a,u,c,r,s,o))}),i.foreach((l,c)=>{const u=Wt(n,l);cR(e,we(u))||(a=pb(t,a,u,c,r,s,o))}),a}function uR(t,e,n){return n.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function mb(t,e,n,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;xe(n)?c=i:c=new dt(null).setTree(n,i);const u=e.serverCache.getNode();return c.children.inorderTraversal((d,f)=>{if(u.hasChild(d)){const p=e.serverCache.getNode().getImmediateChild(d),v=uR(t,p,f);l=ng(t,l,new at(d),v,r,s,o,a)}}),c.children.inorderTraversal((d,f)=>{const p=!e.serverCache.isCompleteForChild(d)&&f.value===null;if(!u.hasChild(d)&&!p){const v=e.serverCache.getNode().getImmediateChild(d),g=uR(t,v,f);l=ng(t,l,new at(d),g,r,s,o,a)}}),l}function hz(t,e,n,i,r,s,o){if(tg(r,n)!=null)return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(xe(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return ng(t,e,n,l.getNode().getChild(n),r,s,a,o);if(xe(n)){let c=new dt(null);return l.getNode().forEachChild(lc,(u,d)=>{c=c.set(new at(u),d)}),mb(t,e,n,c,r,s,a,o)}else return e}else{let c=new dt(null);return i.foreach((u,d)=>{const f=Wt(n,u);l.isCompleteForPath(f)&&(c=c.set(u,l.getNode().getChild(f)))}),mb(t,e,n,c,r,s,a,o)}}function fz(t,e,n,i,r){const s=e.serverCache,o=bM(e,s.getNode(),s.isFullyInitialized()||xe(n),s.isFiltered());return RM(t,o,n,i,wM,r)}function pz(t,e,n,i,r,s){let o;if(tg(i,n)!=null)return e;{const a=new oE(i,e,r),l=e.eventCache.getNode();let c;if(xe(n)||we(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=eg(i,$a(e));else{const d=e.serverCache.getNode();Z(d instanceof me,"serverChildren would be complete if leaf node"),u=rE(i,d)}u=u,c=t.filter.updateFullNode(l,u,s)}else{const u=we(n);let d=sE(i,u,e.serverCache);d==null&&e.serverCache.isCompleteForChild(u)&&(d=l.getImmediateChild(u)),d!=null?c=t.filter.updateChild(l,u,d,lt(n),a,s):e.eventCache.getNode().hasChild(u)?c=t.filter.updateChild(l,u,me.EMPTY_NODE,lt(n),a,s):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=eg(i,$a(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,s)))}return o=e.serverCache.isFullyInitialized()||tg(i,Ge())!=null,Bd(e,c,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mz{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,r=new ZS(i.getIndex()),s=Nq(i);this.processor_=az(s);const o=n.serverCache,a=n.eventCache,l=r.updateFullNode(me.EMPTY_NODE,o.getNode(),null),c=s.updateFullNode(me.EMPTY_NODE,a.getNode(),null),u=new Ka(l,o.isFullyInitialized(),r.filtersNodes()),d=new Ka(c,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=yv(d,u),this.eventGenerator_=new Bq(this.query_)}get query(){return this.query_}}function gz(t){return t.viewCache_.serverCache.getNode()}function vz(t,e){const n=$a(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!xe(e)&&!n.getImmediateChild(we(e)).isEmpty())?n.getChild(e):null}function dR(t){return t.eventRegistrations_.length===0}function yz(t,e){t.eventRegistrations_.push(e)}function hR(t,e,n){const i=[];if(n){Z(e==null,"A cancel should cancel all event registrations.");const r=t.query._path;t.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(n,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<t.eventRegistrations_.length;++s){const o=t.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(t.eventRegistrations_.slice(s+1));break}}t.eventRegistrations_=r}else t.eventRegistrations_=[];return i}function fR(t,e,n,i){e.type===rr.MERGE&&e.source.queryId!==null&&(Z($a(t.viewCache_),"We should always have a full cache before handling merges"),Z(db(t.viewCache_),"Missing event cache, even though we have a server cache"));const r=t.viewCache_,s=cz(t.processor_,r,e,n,i);return lz(t.processor_,s.viewCache),Z(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=s.viewCache,AM(t,s.changes,s.viewCache.eventCache.getNode(),null)}function _z(t,e){const n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Rt,(s,o)=>{i.push(jc(s,o))}),n.isFullyInitialized()&&i.push(vM(n.getNode())),AM(t,i,n.getNode(),e)}function AM(t,e,n,i){const r=i?[i]:t.eventRegistrations_;return qq(t.eventGenerator_,e,n,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ig;class bz{constructor(){this.views=new Map}}function Tz(t){Z(!ig,"__referenceConstructor has already been defined"),ig=t}function Sz(){return Z(ig,"Reference.ts has not been loaded"),ig}function Ez(t){return t.views.size===0}function aE(t,e,n,i){const r=e.source.queryId;if(r!==null){const s=t.views.get(r);return Z(s!=null,"SyncTree gave us an op for an invalid query."),fR(s,e,n,i)}else{let s=[];for(const o of t.views.values())s=s.concat(fR(o,e,n,i));return s}}function Cz(t,e,n,i,r){const s=e._queryIdentifier,o=t.views.get(s);if(!o){let a=eg(n,r?i:null),l=!1;a?l=!0:i instanceof me?(a=rE(n,i),l=!1):(a=me.EMPTY_NODE,l=!1);const c=yv(new Ka(a,l,!1),new Ka(i,r,!1));return new mz(e,c)}return o}function kz(t,e,n,i,r,s){const o=Cz(t,e,i,r,s);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),yz(o,n),_z(o,n)}function wz(t,e,n,i){const r=e._queryIdentifier,s=[];let o=[];const a=Bo(t);if(r==="default")for(const[l,c]of t.views.entries())o=o.concat(hR(c,n,i)),dR(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||s.push(c.query));else{const l=t.views.get(r);l&&(o=o.concat(hR(l,n,i)),dR(l)&&(t.views.delete(r),l.query._queryParams.loadsAllData()||s.push(l.query)))}return a&&!Bo(t)&&s.push(new(Sz())(e._repo,e._path)),{removed:s,events:o}}function IM(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function cc(t,e){let n=null;for(const i of t.views.values())n=n||vz(i,e);return n}function PM(t,e){if(e._queryParams.loadsAllData())return _v(t);{const i=e._queryIdentifier;return t.views.get(i)}}function xM(t,e){return PM(t,e)!=null}function Bo(t){return _v(t)!=null}function _v(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rg;function Rz(t){Z(!rg,"__referenceConstructor has already been defined"),rg=t}function Az(){return Z(rg,"Reference.ts has not been loaded"),rg}let Iz=1;class pR{constructor(e){this.listenProvider_=e,this.syncPointTree_=new dt(null),this.pendingWriteTree_=iz(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function DM(t,e,n,i,r){return Kq(t.pendingWriteTree_,e,n,i,r),r?lf(t,new Ga(_M(),e,n)):[]}function Ca(t,e,n=!1){const i=$q(t.pendingWriteTree_,e);if(Wq(t.pendingWriteTree_,e)){let s=new dt(null);return i.snap!=null?s=s.set(Ge(),!0):li(i.children,o=>{s=s.set(new at(o),!0)}),lf(t,new Zm(i.path,s,n))}else return[]}function bv(t,e,n){return lf(t,new Ga(tE(),e,n))}function Pz(t,e,n){const i=dt.fromObject(n);return lf(t,new kh(tE(),e,i))}function xz(t,e){return lf(t,new Ch(tE(),e))}function Dz(t,e,n){const i=cE(t,n);if(i){const r=uE(i),s=r.path,o=r.queryId,a=ni(s,e),l=new Ch(nE(o),a);return dE(t,s,l)}else return[]}function gb(t,e,n,i,r=!1){const s=e._path,o=t.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||xM(o,e))){const l=wz(o,e,n,i);Ez(o)&&(t.syncPointTree_=t.syncPointTree_.remove(s));const c=l.removed;if(a=l.events,!r){const u=c.findIndex(f=>f._queryParams.loadsAllData())!==-1,d=t.syncPointTree_.findOnPath(s,(f,p)=>Bo(p));if(u&&!d){const f=t.syncPointTree_.subtree(s);if(!f.isEmpty()){const p=Mz(f);for(let v=0;v<p.length;++v){const g=p[v],E=g.query,y=MM(t,g);t.listenProvider_.startListening(zd(E),sg(t,E),y.hashFn,y.onComplete)}}}!d&&c.length>0&&!i&&(u?t.listenProvider_.stopListening(zd(e),null):c.forEach(f=>{const p=t.queryToTagMap.get(Tv(f));t.listenProvider_.stopListening(zd(f),p)}))}Lz(t,c)}return a}function Oz(t,e,n,i){const r=cE(t,i);if(r!=null){const s=uE(r),o=s.path,a=s.queryId,l=ni(o,e),c=new Ga(nE(a),l,n);return dE(t,o,c)}else return[]}function Nz(t,e,n,i){const r=cE(t,i);if(r){const s=uE(r),o=s.path,a=s.queryId,l=ni(o,e),c=dt.fromObject(n),u=new kh(nE(a),l,c);return dE(t,o,u)}else return[]}function mR(t,e,n,i=!1){const r=e._path;let s=null,o=!1;t.syncPointTree_.foreachOnPath(r,(f,p)=>{const v=ni(f,r);s=s||cc(p,v),o=o||Bo(p)});let a=t.syncPointTree_.get(r);a?(o=o||Bo(a),s=s||cc(a,Ge())):(a=new bz,t.syncPointTree_=t.syncPointTree_.set(r,a));let l;s!=null?l=!0:(l=!1,s=me.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild((p,v)=>{const g=cc(v,Ge());g&&(s=s.updateImmediateChild(p,g))}));const c=xM(a,e);if(!c&&!e._queryParams.loadsAllData()){const f=Tv(e);Z(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const p=Uz();t.queryToTagMap.set(f,p),t.tagToQueryMap.set(p,f)}const u=iE(t.pendingWriteTree_,r);let d=kz(a,e,n,u,s,l);if(!c&&!o&&!i){const f=PM(a,e);d=d.concat(Vz(t,e,f))}return d}function lE(t,e,n){const r=t.pendingWriteTree_,s=t.syncPointTree_.findOnPath(e,(o,a)=>{const l=ni(o,e),c=cc(a,l);if(c)return c});return EM(r,e,s,n,!0)}function lf(t,e){return OM(e,t.syncPointTree_,null,iE(t.pendingWriteTree_,Ge()))}function OM(t,e,n,i){if(xe(t.path))return NM(t,e,n,i);{const r=e.get(Ge());n==null&&r!=null&&(n=cc(r,Ge()));let s=[];const o=we(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){const c=n?n.getImmediateChild(o):null,u=CM(i,o);s=s.concat(OM(a,l,c,u))}return r&&(s=s.concat(aE(r,t,i,n))),s}}function NM(t,e,n,i){const r=e.get(Ge());n==null&&r!=null&&(n=cc(r,Ge()));let s=[];return e.children.inorderTraversal((o,a)=>{const l=n?n.getImmediateChild(o):null,c=CM(i,o),u=t.operationForChild(o);u&&(s=s.concat(NM(u,a,l,c)))}),r&&(s=s.concat(aE(r,t,i,n))),s}function MM(t,e){const n=e.query,i=sg(t,n);return{hashFn:()=>(gz(e)||me.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?Dz(t,n._path,i):xz(t,n._path);{const s=O7(r,n);return gb(t,n,null,s)}}}}function sg(t,e){const n=Tv(e);return t.queryToTagMap.get(n)}function Tv(t){return t._path.toString()+"$"+t._queryIdentifier}function cE(t,e){return t.tagToQueryMap.get(e)}function uE(t){const e=t.indexOf("$");return Z(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new at(t.substr(0,e))}}function dE(t,e,n){const i=t.syncPointTree_.get(e);Z(i,"Missing sync point for query tag that we're tracking");const r=iE(t.pendingWriteTree_,e);return aE(i,n,r,null)}function Mz(t){return t.fold((e,n,i)=>{if(n&&Bo(n))return[_v(n)];{let r=[];return n&&(r=IM(n)),li(i,(s,o)=>{r=r.concat(o)}),r}})}function zd(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Az())(t._repo,t._path):t}function Lz(t,e){for(let n=0;n<e.length;++n){const i=e[n];if(!i._queryParams.loadsAllData()){const r=Tv(i),s=t.queryToTagMap.get(r);t.queryToTagMap.delete(r),t.tagToQueryMap.delete(s)}}}function Uz(){return Iz++}function Vz(t,e,n){const i=e._path,r=sg(t,e),s=MM(t,n),o=t.listenProvider_.startListening(zd(e),r,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(i);if(r)Z(!Bo(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,u,d)=>{if(!xe(c)&&u&&Bo(u))return[_v(u).query];{let f=[];return u&&(f=f.concat(IM(u).map(p=>p.query))),li(d,(p,v)=>{f=f.concat(v)}),f}});for(let c=0;c<l.length;++c){const u=l[c];t.listenProvider_.stopListening(zd(u),sg(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new hE(n)}node(){return this.node_}}class fE{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=Wt(this.path_,e);return new fE(this.syncTree_,n)}node(){return lE(this.syncTree_,this.path_)}}const Fz=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},gR=function(t,e,n){if(!t||typeof t!="object")return t;if(Z(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return jz(t[".sv"],e,n);if(typeof t[".sv"]=="object")return Bz(t[".sv"],e);Z(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},jz=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:Z(!1,"Unexpected server value: "+t)}},Bz=function(t,e,n){t.hasOwnProperty("increment")||Z(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t.increment;typeof i!="number"&&Z(!1,"Unexpected increment value: "+i);const r=e.node();if(Z(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;const o=r.getValue();return typeof o!="number"?i:o+i},qz=function(t,e,n,i){return pE(e,new fE(n,t),i)},LM=function(t,e,n){return pE(t,new hE(e),n)};function pE(t,e,n){const i=t.getPriority().val(),r=gR(i,e.getImmediateChild(".priority"),n);let s;if(t.isLeafNode()){const o=t,a=gR(o.getValue(),e,n);return a!==o.getValue()||r!==o.getPriority().val()?new on(a,Tn(r)):t}else{const o=t;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new on(r))),o.forEachChild(Rt,(a,l)=>{const c=pE(l,e.getImmediateChild(a),n);c!==l&&(s=s.updateImmediateChild(a,c))}),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE{constructor(e="",n=null,i={children:{},childCount:0}){this.name=e,this.parent=n,this.node=i}}function gE(t,e){let n=e instanceof at?e:new at(e),i=t,r=we(n);for(;r!==null;){const s=Dc(i.node.children,r)||{children:{},childCount:0};i=new mE(r,i,s),n=lt(n),r=we(n)}return i}function du(t){return t.node.value}function UM(t,e){t.node.value=e,vb(t)}function VM(t){return t.node.childCount>0}function zz(t){return du(t)===void 0&&!VM(t)}function Sv(t,e){li(t.node.children,(n,i)=>{e(new mE(n,t,i))})}function FM(t,e,n,i){n&&e(t),Sv(t,r=>{FM(r,e,!0)})}function Hz(t,e,n){let i=t.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function cf(t){return new at(t.parent===null?t.name:cf(t.parent)+"/"+t.name)}function vb(t){t.parent!==null&&Gz(t.parent,t.name,t)}function Gz(t,e,n){const i=zz(n),r=Ps(t.node.children,e);i&&r?(delete t.node.children[e],t.node.childCount--,vb(t)):!i&&!r&&(t.node.children[e]=n.node,t.node.childCount++,vb(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kz=/[\[\].#$\/\u0000-\u001F\u007F]/,$z=/[\[\].#$\u0000-\u001F\u007F]/,r0=10*1024*1024,jM=function(t){return typeof t=="string"&&t.length!==0&&!Kz.test(t)},BM=function(t){return typeof t=="string"&&t.length!==0&&!$z.test(t)},Wz=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),BM(t)},Qz=function(t,e,n,i){vE(fS(t,"value"),e,n)},vE=function(t,e,n){const i=n instanceof at?new hq(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+ya(i));if(typeof e=="function")throw new Error(t+"contains a function "+ya(i)+" with contents = "+e.toString());if(BN(e))throw new Error(t+"contains "+e.toString()+" "+ya(i));if(typeof e=="string"&&e.length>r0/3&&Jg(e)>r0)throw new Error(t+"contains a string greater than "+r0+" utf8 bytes "+ya(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(li(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!jM(o)))throw new Error(t+" contains an invalid key ("+o+") "+ya(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);fq(i,o),vE(t,a,i),pq(i)}),r&&s)throw new Error(t+' contains ".value" child '+ya(i)+" in addition to actual children.")}},qM=function(t,e,n,i){if(!BM(n))throw new Error(fS(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Yz=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),qM(t,e,n)},Jz=function(t,e){if(we(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},Xz=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!jM(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!Wz(n))throw new Error(fS(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zz{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function yE(t,e){let n=null;for(let i=0;i<e.length;i++){const r=e[i],s=r.getPath();n!==null&&!YS(s,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:s}),n.events.push(r)}n&&t.eventLists_.push(n)}function zM(t,e,n){yE(t,n),HM(t,i=>YS(i,e))}function Cs(t,e,n){yE(t,n),HM(t,i=>ir(i,e)||ir(e,i))}function HM(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){const r=t.eventLists_[i];if(r){const s=r.path;e(s)?(eH(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function eH(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const i=n.getEventRunner();Fd&&Vn("event: "+n.toString()),uu(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tH="repo_interrupt",nH=25;class iH{constructor(e,n,i,r){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Zz,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Xm(),this.transactionQueueTree_=new mE,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function rH(t,e,n){if(t.stats_=WS(t.repoInfo_),t.forceRestClient_||U7())t.server_=new Jm(t.repoInfo_,(i,r,s,o)=>{vR(t,i,r,s,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>yR(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{fn(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new fs(t.repoInfo_,e,(i,r,s,o)=>{vR(t,i,r,s,o)},i=>{yR(t,i)},i=>{oH(t,i)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(i=>{t.server_.refreshAuthToken(i)}),t.appCheckProvider_.addTokenChangeListener(i=>{t.server_.refreshAppCheckToken(i.token)}),t.statsReporter_=q7(t.repoInfo_,()=>new jq(t.stats_,t.server_)),t.infoData_=new Mq,t.infoSyncTree_=new pR({startListening:(i,r,s,o)=>{let a=[];const l=t.infoData_.getNode(i._path);return l.isEmpty()||(a=bv(t.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),bE(t,"connected",!1),t.serverSyncTree_=new pR({startListening:(i,r,s,o)=>(t.server_.listen(i,s,r,(a,l)=>{const c=o(a,l);Cs(t.eventQueue_,i._path,c)}),[]),stopListening:(i,r)=>{t.server_.unlisten(i,r)}})}function sH(t){const n=t.infoData_.getNode(new at(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function _E(t){return Fz({timestamp:sH(t)})}function vR(t,e,n,i,r){t.dataUpdateCount++;const s=new at(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(r)if(i){const l=Nm(n,c=>Tn(c));o=Nz(t.serverSyncTree_,s,l,r)}else{const l=Tn(n);o=Oz(t.serverSyncTree_,s,l,r)}else if(i){const l=Nm(n,c=>Tn(c));o=Pz(t.serverSyncTree_,s,l)}else{const l=Tn(n);o=bv(t.serverSyncTree_,s,l)}let a=s;o.length>0&&(a=Ev(t,s)),Cs(t.eventQueue_,a,o)}function yR(t,e){bE(t,"connected",e),e===!1&&lH(t)}function oH(t,e){li(e,(n,i)=>{bE(t,n,i)})}function bE(t,e,n){const i=new at("/.info/"+e),r=Tn(n);t.infoData_.updateSnapshot(i,r);const s=bv(t.infoSyncTree_,i,r);Cs(t.eventQueue_,i,s)}function GM(t){return t.nextWriteId_++}function aH(t,e,n,i,r){TE(t,"set",{path:e.toString(),value:n,priority:i});const s=_E(t),o=Tn(n,i),a=lE(t.serverSyncTree_,e),l=LM(o,a,s),c=GM(t),u=DM(t.serverSyncTree_,e,l,c,!0);yE(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(f,p)=>{const v=f==="ok";v||oi("set at "+e+" failed: "+f);const g=Ca(t.serverSyncTree_,c,!v);Cs(t.eventQueue_,e,g),hH(t,r,f,p)});const d=YM(t,e);Ev(t,d),Cs(t.eventQueue_,d,[])}function lH(t){TE(t,"onDisconnectEvents");const e=_E(t),n=Xm();ub(t.onDisconnect_,Ge(),(r,s)=>{const o=qz(r,s,t.serverSyncTree_,e);yM(n,r,o)});let i=[];ub(n,Ge(),(r,s)=>{i=i.concat(bv(t.serverSyncTree_,r,s));const o=YM(t,r);Ev(t,o)}),t.onDisconnect_=Xm(),Cs(t.eventQueue_,Ge(),i)}function cH(t,e,n){let i;we(e._path)===".info"?i=mR(t.infoSyncTree_,e,n):i=mR(t.serverSyncTree_,e,n),zM(t.eventQueue_,e._path,i)}function uH(t,e,n){let i;we(e._path)===".info"?i=gb(t.infoSyncTree_,e,n):i=gb(t.serverSyncTree_,e,n),zM(t.eventQueue_,e._path,i)}function dH(t){t.persistentConnection_&&t.persistentConnection_.interrupt(tH)}function TE(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Vn(n,...e)}function hH(t,e,n,i){e&&uu(()=>{if(n==="ok")e(null);else{const r=(n||"error").toUpperCase();let s=r;i&&(s+=": "+i);const o=new Error(s);o.code=r,e(o)}})}function KM(t,e,n){return lE(t.serverSyncTree_,e,n)||me.EMPTY_NODE}function SE(t,e=t.transactionQueueTree_){if(e||Cv(t,e),du(e)){const n=WM(t,e);Z(n.length>0,"Sending zero length transaction queue"),n.every(r=>r.status===0)&&fH(t,cf(e),n)}else VM(e)&&Sv(e,n=>{SE(t,n)})}function fH(t,e,n){const i=n.map(c=>c.currentWriteId),r=KM(t,e,i);let s=r;const o=r.hash();for(let c=0;c<n.length;c++){const u=n[c];Z(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const d=ni(e,u.path);s=s.updateChild(d,u.currentOutputSnapshotRaw)}const a=s.val(!0),l=e;t.server_.put(l.toString(),a,c=>{TE(t,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){const d=[];for(let f=0;f<n.length;f++)n[f].status=2,u=u.concat(Ca(t.serverSyncTree_,n[f].currentWriteId)),n[f].onComplete&&d.push(()=>n[f].onComplete(null,!0,n[f].currentOutputSnapshotResolved)),n[f].unwatcher();Cv(t,gE(t.transactionQueueTree_,e)),SE(t,t.transactionQueueTree_),Cs(t.eventQueue_,e,u);for(let f=0;f<d.length;f++)uu(d[f])}else{if(c==="datastale")for(let d=0;d<n.length;d++)n[d].status===3?n[d].status=4:n[d].status=0;else{oi("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<n.length;d++)n[d].status=4,n[d].abortReason=c}Ev(t,e)}},o)}function Ev(t,e){const n=$M(t,e),i=cf(n),r=WM(t,n);return pH(t,r,i),i}function pH(t,e,n){if(e.length===0)return;const i=[];let r=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=ni(n,l.path);let u=!1,d;if(Z(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,d=l.abortReason,r=r.concat(Ca(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=nH)u=!0,d="maxretry",r=r.concat(Ca(t.serverSyncTree_,l.currentWriteId,!0));else{const f=KM(t,l.path,o);l.currentInputSnapshot=f;const p=e[a].update(f.val());if(p!==void 0){vE("transaction failed: Data returned ",p,l.path);let v=Tn(p);typeof p=="object"&&p!=null&&Ps(p,".priority")||(v=v.updatePriority(f.getPriority()));const E=l.currentWriteId,y=_E(t),T=LM(v,f,y);l.currentOutputSnapshotRaw=v,l.currentOutputSnapshotResolved=T,l.currentWriteId=GM(t),o.splice(o.indexOf(E),1),r=r.concat(DM(t.serverSyncTree_,l.path,T,l.currentWriteId,l.applyLocally)),r=r.concat(Ca(t.serverSyncTree_,E,!0))}else u=!0,d="nodata",r=r.concat(Ca(t.serverSyncTree_,l.currentWriteId,!0))}Cs(t.eventQueue_,n,r),r=[],u&&(e[a].status=2,function(f){setTimeout(f,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(d),!1,null))))}Cv(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)uu(i[a]);SE(t,t.transactionQueueTree_)}function $M(t,e){let n,i=t.transactionQueueTree_;for(n=we(e);n!==null&&du(i)===void 0;)i=gE(i,n),e=lt(e),n=we(e);return i}function WM(t,e){const n=[];return QM(t,e,n),n.sort((i,r)=>i.order-r.order),n}function QM(t,e,n){const i=du(e);if(i)for(let r=0;r<i.length;r++)n.push(i[r]);Sv(e,r=>{QM(t,r,n)})}function Cv(t,e){const n=du(e);if(n){let i=0;for(let r=0;r<n.length;r++)n[r].status!==2&&(n[i]=n[r],i++);n.length=i,UM(e,n.length>0?n:void 0)}Sv(e,i=>{Cv(t,i)})}function YM(t,e){const n=cf($M(t,e)),i=gE(t.transactionQueueTree_,e);return Hz(i,r=>{s0(t,r)}),s0(t,i),FM(i,r=>{s0(t,r)}),n}function s0(t,e){const n=du(e);if(n){const i=[];let r=[],s=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(Z(s===o-1,"All SENT items should be at beginning of queue."),s=o,n[o].status=3,n[o].abortReason="set"):(Z(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),r=r.concat(Ca(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&i.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?UM(e,void 0):n.length=s+1,Cs(t.eventQueue_,cf(e),r);for(let o=0;o<i.length;o++)uu(i[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mH(t){let e="";const n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let r=n[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function gH(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const i=n.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):oi(`Invalid query segment '${n}' in query '${t}'`)}return e}const _R=function(t,e){const n=vH(t),i=n.namespace;n.domain==="firebase.com"&&Es(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&Es("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||A7();const r=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new ZN(n.host,n.secure,i,r,e,"",i!==n.subdomain),path:new at(n.pathString)}},vH=function(t){let e="",n="",i="",r="",s="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let u=t.indexOf("/");u===-1&&(u=t.length);let d=t.indexOf("?");d===-1&&(d=t.length),e=t.substring(0,Math.min(u,d)),u<d&&(r=mH(t.substring(u,d)));const f=gH(t.substring(Math.min(t.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;const p=e.slice(0,c);if(p.toLowerCase()==="localhost")n="localhost";else if(p.split(".").length<=2)n=p;else{const v=e.indexOf(".");i=e.substring(0,v).toLowerCase(),n=e.substring(v+1),s=i}"ns"in f&&(s=f.ns)}return{host:e,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yH{constructor(e,n,i,r){this.eventType=e,this.eventRegistration=n,this.snapshot=i,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+fn(this.snapshot.exportVal())}}class _H{constructor(e,n,i){this.eventRegistration=e,this.error=n,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bH{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return Z(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EE{constructor(e,n,i,r){this._repo=e,this._path=n,this._queryParams=i,this._orderByCalled=r}get key(){return xe(this._path)?null:lM(this._path)}get ref(){return new Wo(this._repo,this._path)}get _queryIdentifier(){const e=iR(this._queryParams),n=KS(e);return n==="{}"?"default":n}get _queryObject(){return iR(this._queryParams)}isEqual(e){if(e=Ri(e),!(e instanceof EE))return!1;const n=this._repo===e._repo,i=YS(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return n&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+dq(this._path)}}class Wo extends EE{constructor(e,n){super(e,n,new eE,!1)}get parent(){const e=uM(this._path);return e===null?null:new Wo(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class og{constructor(e,n,i){this._node=e,this.ref=n,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new at(e),i=yb(this.ref,e);return new og(this._node.getChild(n),i,Rt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new og(r,yb(this.ref,i),Rt)))}hasChild(e){const n=new at(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function bR(t,e){return t=Ri(t),t._checkNotDeleted("ref"),e!==void 0?yb(t._root,e):t._root}function yb(t,e){return t=Ri(t),we(t._path)===null?Yz("child","path",e):qM("child","path",e),new Wo(t._repo,Wt(t._path,e))}function TR(t,e){t=Ri(t),Jz("set",t._path),Qz("set",e,t._path);const n=new Yg;return aH(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}class CE{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const i=n._queryParams.getIndex();return new yH("value",this,new og(e.snapshotNode,new Wo(n._repo,n._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new _H(this,e,n):null}matches(e){return e instanceof CE?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function TH(t,e,n,i,r){const s=new bH(n,void 0),o=new CE(s);return cH(t._repo,t,o),()=>uH(t._repo,t,o)}function SH(t,e,n,i){return TH(t,"value",e)}Tz(Wo);Rz(Wo);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EH="FIREBASE_DATABASE_EMULATOR_HOST",_b={};let CH=!1;function kH(t,e,n,i){const r=e.lastIndexOf(":"),s=e.substring(0,r),o=Zh(s);t.repoInfo_=new ZN(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(t.authTokenProvider_=i)}function wH(t,e,n,i,r){let s=i||t.options.databaseURL;s===void 0&&(t.options.projectId||Es("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Vn("Using default host for project ",t.options.projectId),s=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=_R(s,r),a=o.repoInfo,l;typeof process<"u"&&Fw&&(l=Fw[EH]),l?(s=`http://${l}?ns=${a.namespace}`,o=_R(s,r),a=o.repoInfo):o.repoInfo.secure;const c=new F7(t.name,t.options,e);Xz("Invalid Firebase Database URL",o),xe(o.path)||Es("Database URL must point to the root of a Firebase Database (not including a child path).");const u=AH(a,t,c,new V7(t,n));return new IH(u,t)}function RH(t,e){const n=_b[e];(!n||n[t.key]!==t)&&Es(`Database ${e}(${t.repoInfo_}) has already been deleted.`),dH(t),delete n[t.key]}function AH(t,e,n,i){let r=_b[e.name];r||(r={},_b[e.name]=r);let s=r[t.toURLString()];return s&&Es("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new iH(t,CH,n,i),r[t.toURLString()]=s,s}class IH{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(rH(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Wo(this._repo,Ge())),this._rootInternal}_delete(){return this._rootInternal!==null&&(RH(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Es("Cannot call "+e+" on a deleted database.")}}function PH(t=iO(),e){const n=ZD(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const i=qD("database");i&&xH(n,...i)}return n}function xH(t,e,n,i={}){t=Ri(t),t._checkNotDeleted("useEmulator");const r=`${e}:${n}`,s=t._repoInternal;if(t._instanceStarted){if(r===t._repoInternal.repoInfo_.host&&uh(i,s.repoInfo_.emulatorOptions))return;Es("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&Es('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new jp(jp.OWNER);else if(i.mockUserToken){const a=typeof i.mockUserToken=="string"?i.mockUserToken:GD(i.mockUserToken,t.app.options.projectId);o=new jp(a)}Zh(e)&&(HD(e),KD("Database",!0)),kH(s,r,i,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DH(t){S7(tO),dh(new Oc("database",(e,{instanceIdentifier:n})=>{const i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return wH(i,r,s,n)},"PUBLIC").setMultipleInstances(!0)),So(jw,Bw,t),So(jw,Bw,"esm2020")}fs.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};fs.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};DH();const OH={apiKey:"YOUR_API_KEY",authDomain:"your-project.firebaseapp.com",projectId:"your-project",storageBucket:"your-project.appspot.com",messagingSenderId:"123456789",appId:"1:123456789:web:abcdef"},JM=nO(OH),bb=t7(JM),SR=PH(JM),NH=()=>{const[t,e]=P.useState([]),{userRole:n}=Na.useContext(ff),[i,r]=P.useState(!0),s=[{id:"teacher1",name:"GM Ana Smith",elo:2450,price:35,classesGiven:42,description:"Especialista en defensa siciliana y finales.",image:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher2",name:"IM Carlos Ruiz",elo:2310,price:25,classesGiven:18,description:"Entrenador tctico para jugadores de club.",image:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher3",name:"WGM Sarah Polgar",elo:2505,price:50,classesGiven:156,description:"Ex-campeona mundial juvenil. Clases avanzadas.",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"}];return P.useEffect(()=>{(async()=>{try{const l=(await g7(e7(bb,"teachers"))).docs.map(c=>({id:c.id,...c.data()}));if(l.length>0){const c=l.map((u,d)=>({...s[d%s.length],...u}));e(c)}else e(s)}catch{console.log("Using offline data"),e(s)}finally{r(!1)}})()},[]),G.jsxs("div",{className:"min-h-screen",children:[G.jsxs("section",{className:"relative py-20 px-4 mb-16 overflow-hidden",children:[G.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-br from-[#161512] via-[#201e1b] to-[#262421] z-0"}),G.jsxs("div",{className:"relative z-10 max-w-5xl mx-auto text-center",children:[G.jsx("div",{className:"inline-block px-4 py-1.5 mb-6 rounded-full bg-[#bf811d]/10 border border-[#bf811d]/20 text-[#bf811d] text-sm font-semibold tracking-wide uppercase",children:"La Escuela de Ajedrez del Futuro"}),G.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Domina el Tablero ",G.jsx("br",{}),G.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-[#bf811d] to-[#f0d9b5]",children:"Sin Lmites"})]}),G.jsx("p",{className:"text-xl text-[#bababa] max-w-2xl mx-auto mb-10 leading-relaxed",children:"Conectamos a estudiantes apasionados con grandes maestros en aulas virtuales con audio en tiempo real."}),G.jsx("div",{className:"flex gap-4 justify-center",children:G.jsx("button",{className:"bg-[#bf811d] hover:bg-[#a66f19] text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg shadow-orange-900/20",children:"Buscar Profesor"})})]})]}),G.jsxs("div",{className:"max-w-6xl mx-auto px-4 pb-20",children:[G.jsx("h2",{className:"text-3xl font-bold text-white mb-8",children:"Maestros Recomendados"}),i?G.jsx("div",{className:"text-center py-20 text-[#666]",children:"Cargando maestros..."}):G.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map(o=>G.jsxs("div",{className:"bg-[#21201d] border border-[#302e2b] rounded-2xl p-6 hover:border-[#bf811d]/50 transition-all",children:[G.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[G.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-800 overflow-hidden",children:G.jsx("img",{src:o.image,alt:o.name,className:"w-full h-full object-cover"})}),G.jsxs("div",{children:[G.jsx("h3",{className:"text-xl font-bold text-white",children:o.name}),G.jsxs("div",{className:"text-[#bf811d] font-bold text-sm",children:[o.elo," ELO"]})]})]}),G.jsx("p",{className:"text-[#bababa] text-sm mb-4 h-12 overflow-hidden",children:o.description}),G.jsxs("div",{className:"flex justify-between items-center mb-6",children:[G.jsxs("span",{className:"text-white font-bold",children:["$",o.price,"/hr"]}),G.jsxs("span",{className:"text-gray-500 text-sm",children:[o.classesGiven," clases"]})]}),n==="student"?G.jsx(xc,{to:`/room/${o.id}`,className:"block w-full text-center py-3 bg-[#bf811d] text-white font-bold rounded-xl hover:bg-[#a66f19]",children:"Reservar Clase"}):o.id==="teacher1"&&G.jsx(xc,{to:`/room/${o.id}`,className:"block w-full text-center py-3 bg-[#363431] text-white font-bold rounded-xl border border-[#403d39]",children:"Ir al Aula"})]},o.id))})]})]})};var XM={exports:{}},MH="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",LH=MH,UH=LH;function ZM(){}function e2(){}e2.resetWarningCache=ZM;var VH=function(){function t(i,r,s,o,a,l){if(l!==UH){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:e2,resetWarningCache:ZM};return n.PropTypes=n,n};XM.exports=VH();var FH=XM.exports;const He=rT(FH),jH=["white","black"],kE=["a","b","c","d","e","f","g","h"],wE=["1","2","3","4","5","6","7","8"],BH=[...wE].reverse(),RE=Array.prototype.concat(...kE.map(t=>wE.map(e=>t+e))),Mi=t=>RE[8*t[0]+t[1]],Pt=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],t2=RE.map(Pt);function qH(t){let e;const n=()=>(e===void 0&&(e=t()),e);return n.clear=()=>{e=void 0},n}const zH=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},AE=t=>t==="white"?"black":"white",wh=(t,e)=>{const n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i},Tb=(t,e)=>t.role===e.role&&t.color===e.color,n2=(t,e,n,i)=>[(e?t[0]:7-t[0])*n,(e?7-t[1]:t[1])*i],IE=t=>{const e=t.width/8,n=t.height/8;return(i,r)=>n2(i,r,e,n)},HH=(t,e)=>n2(t,e,100,100),kv=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},GH=(t,e)=>{t.style.transform=`translate(${e[0]}%,${e[1]}%)`},PE=(t,e)=>{t.style.visibility=e?"visible":"hidden"},dl=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},i2=t=>t.buttons===2||t.button===2,ao=(t,e)=>{const n=document.createElement(t);return e&&(n.className=e),n};function r2(t,e,n){const i=Pt(t);return e||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}function Wa(t,e){return Math.abs(t-e)}function KH(t){return(e,n,i,r)=>Wa(e,i)<2&&(t==="white"?r===n+1||n<=1&&r===n+2&&e===i:r===n-1||n>=6&&r===n-2&&e===i)}const s2=(t,e,n,i)=>{const r=Wa(t,n),s=Wa(e,i);return r===1&&s===2||r===2&&s===1},o2=(t,e,n,i)=>Wa(t,n)===Wa(e,i),a2=(t,e,n,i)=>t===n||e===i,l2=(t,e,n,i)=>o2(t,e,n,i)||a2(t,e,n,i);function $H(t,e,n){return(i,r,s,o)=>Wa(i,s)<2&&Wa(r,o)<2||n&&r===o&&r===(t==="white"?0:7)&&(i===4&&(s===2&&e.includes(0)||s===6&&e.includes(7))||e.includes(s))}function WH(t,e){const n=e==="white"?"1":"8",i=[];for(const[r,s]of t)r[1]===n&&s.color===e&&s.role==="rook"&&i.push(Pt(r)[0]);return i}function c2(t,e,n){const i=t.get(e);if(!i)return[];const r=Pt(e),s=i.role,o=s==="pawn"?KH(i.color):s==="knight"?s2:s==="bishop"?o2:s==="rook"?a2:s==="queen"?l2:$H(i.color,WH(t,i.color),n);return t2.filter(a=>(r[0]!==a[0]||r[1]!==a[1])&&o(r[0],r[1],a[0],a[1])).map(Mi)}function ci(t,...e){t&&setTimeout(()=>t(...e),1)}function QH(t){t.orientation=AE(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function YH(t,e){for(const[n,i]of e)i?t.pieces.set(n,i):t.pieces.delete(n)}function JH(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[n,i]of t.pieces)i.role==="king"&&i.color===e&&(t.check=n)}function XH(t,e,n,i){Yo(t),t.premovable.current=[e,n],ci(t.premovable.events.set,e,n,i)}function Qo(t){t.premovable.current&&(t.premovable.current=void 0,ci(t.premovable.events.unset))}function ZH(t,e,n){Qo(t),t.predroppable.current={role:e,key:n},ci(t.predroppable.events.set,e,n)}function Yo(t){const e=t.predroppable;e.current&&(e.current=void 0,ci(e.events.unset))}function eG(t,e,n){if(!t.autoCastle)return!1;const i=t.pieces.get(e);if(!i||i.role!=="king")return!1;const r=Pt(e),s=Pt(n);if(r[1]!==0&&r[1]!==7||r[1]!==s[1])return!1;r[0]===4&&!t.pieces.has(n)&&(s[0]===6?n=Mi([7,s[1]]):s[0]===2&&(n=Mi([0,s[1]])));const o=t.pieces.get(n);return!o||o.color!==i.color||o.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(n),r[0]<s[0]?(t.pieces.set(Mi([6,s[1]]),i),t.pieces.set(Mi([5,s[1]]),o)):(t.pieces.set(Mi([2,s[1]]),i),t.pieces.set(Mi([3,s[1]]),o)),!0)}function u2(t,e,n){const i=t.pieces.get(e),r=t.pieces.get(n);if(e===n||!i)return!1;const s=r&&r.color!==i.color?r:void 0;return n===t.selected&&Hi(t),ci(t.events.move,e,n,s),eG(t,e,n)||(t.pieces.set(n,i),t.pieces.delete(e)),t.lastMove=[e,n],t.check=void 0,ci(t.events.change),s||!0}function xE(t,e,n,i){if(t.pieces.has(n))if(i)t.pieces.delete(n);else return!1;return ci(t.events.dropNewPiece,e,n),t.pieces.set(n,e),t.lastMove=[n],t.check=void 0,ci(t.events.change),t.movable.dests=void 0,t.turnColor=AE(t.turnColor),!0}function d2(t,e,n){const i=u2(t,e,n);return i&&(t.movable.dests=void 0,t.turnColor=AE(t.turnColor),t.animation.current=void 0),i}function h2(t,e,n){if(DE(t,e,n)){const i=d2(t,e,n);if(i){const r=t.hold.stop();Hi(t);const s={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:r};return i!==!0&&(s.captured=i),ci(t.movable.events.after,e,n,s),!0}}else if(nG(t,e,n))return XH(t,e,n,{ctrlKey:t.stats.ctrlKey}),Hi(t),!0;return Hi(t),!1}function f2(t,e,n,i){const r=t.pieces.get(e);r&&(tG(t,e,n)||i)?(t.pieces.delete(e),xE(t,r,n,i),ci(t.movable.events.afterNewPiece,r.role,n,{premove:!1,predrop:!1})):r&&iG(t,e,n)?ZH(t,r.role,n):(Qo(t),Yo(t)),t.pieces.delete(e),Hi(t)}function Sb(t,e,n){if(ci(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){Hi(t),t.hold.cancel();return}else if((t.selectable.enabled||n)&&t.selected!==e&&h2(t,t.selected,e)){t.stats.dragged=!1;return}}(m2(t,e)||OE(t,e))&&(p2(t,e),t.hold.start())}function p2(t,e){t.selected=e,OE(t,e)?t.premovable.dests=c2(t.pieces,e,t.premovable.castle):t.premovable.dests=void 0}function Hi(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function m2(t,e){const n=t.pieces.get(e);return!!n&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}function DE(t,e,n){var i,r;return e!==n&&m2(t,e)&&(t.movable.free||!!(!((r=(i=t.movable.dests)===null||i===void 0?void 0:i.get(e))===null||r===void 0)&&r.includes(n)))}function tG(t,e,n){const i=t.pieces.get(e);return!!i&&(e===n||!t.pieces.has(n))&&(t.movable.color==="both"||t.movable.color===i.color&&t.turnColor===i.color)}function OE(t,e){const n=t.pieces.get(e);return!!n&&t.premovable.enabled&&t.movable.color===n.color&&t.turnColor!==n.color}function nG(t,e,n){return e!==n&&OE(t,e)&&c2(t.pieces,e,t.premovable.castle).includes(n)}function iG(t,e,n){const i=t.pieces.get(e),r=t.pieces.get(n);return!!i&&(!r||r.color!==t.movable.color)&&t.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&t.movable.color===i.color&&t.turnColor!==i.color}function rG(t,e){const n=t.pieces.get(e);return!!n&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===n.color&&(t.turnColor===n.color||t.premovable.enabled))}function sG(t){const e=t.premovable.current;if(!e)return!1;const n=e[0],i=e[1];let r=!1;if(DE(t,n,i)){const s=d2(t,n,i);if(s){const o={premove:!0};s!==!0&&(o.captured=s),ci(t.movable.events.after,n,i,o),r=!0}}return Qo(t),r}function oG(t,e){const n=t.predroppable.current;let i=!1;if(!n)return!1;if(e(n)){const r={role:n.role,color:t.movable.color};xE(t,r,n.key)&&(ci(t.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return Yo(t),i}function NE(t){Qo(t),Yo(t),Hi(t)}function ER(t){t.movable.color=t.movable.dests=t.animation.current=void 0,NE(t)}function hu(t,e,n){let i=Math.floor(8*(t[0]-n.left)/n.width);e||(i=7-i);let r=7-Math.floor(8*(t[1]-n.top)/n.height);return e||(r=7-r),i>=0&&i<8&&r>=0&&r<8?Mi([i,r]):void 0}function aG(t,e,n,i){const r=Pt(t),s=t2.filter(c=>l2(r[0],r[1],c[0],c[1])||s2(r[0],r[1],c[0],c[1])),a=s.map(c=>r2(Mi(c),n,i)).map(c=>wh(e,c)),[,l]=a.reduce((c,u,d)=>c[0]<u?c:[u,d],[a[0],0]);return Mi(s[l])}function lr(t){return t.orientation==="white"}const g2="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",lG={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},cG={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function v2(t){t==="start"&&(t=g2);const e=new Map;let n=7,i=0;for(const r of t)switch(r){case" ":return e;case"/":if(--n,n<0)return e;i=0;break;case"~":{const s=e.get(Mi([i,n]));s&&(s.promoted=!0);break}default:{const s=r.charCodeAt(0);if(s<57)i+=s-48;else{const o=r.toLowerCase();e.set(Mi([i,n]),{role:lG[o],color:r===o?"black":"white"}),++i}}}return e}function uG(t){return BH.map(e=>kE.map(n=>{const i=t.get(n+e);if(i){const r=cG[i.role];return i.color==="white"?r.toUpperCase():r}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function y2(t,e){var n,i;if(!((n=e.movable)===null||n===void 0)&&n.dests&&(t.movable.dests=void 0),!((i=e.drawable)===null||i===void 0)&&i.autoShapes&&(t.drawable.autoShapes=[]),_2(t,e),e.fen&&(t.pieces=v2(e.fen),t.drawable.shapes=[]),"check"in e&&JH(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&p2(t,t.selected),(!t.animation.duration||t.animation.duration<100)&&(t.animation.enabled=!1),!t.movable.rookCastle&&t.movable.dests){const r=t.movable.color==="white"?"1":"8",s="e"+r,o=t.movable.dests.get(s),a=t.pieces.get(s);if(!o||!a||a.role!=="king")return;t.movable.dests.set(s,o.filter(l=>!(l==="a"+r&&o.includes("c"+r))&&!(l==="h"+r&&o.includes("g"+r))))}}function _2(t,e){for(const n in e)CR(t[n])&&CR(e[n])?_2(t[n],e[n]):t[n]=e[n]}function CR(t){return typeof t=="object"}function _a(t,e){return e.animation.enabled?fG(t,e):Gs(t,e)}function Gs(t,e){const n=t(e);return e.dom.redraw(),n}function o0(t,e){return{key:t,pos:Pt(t),piece:e}}function dG(t,e){return e.sort((n,i)=>wh(t.pos,n.pos)-wh(t.pos,i.pos))[0]}function hG(t,e){const n=new Map,i=[],r=new Map,s=[],o=[],a=new Map;let l,c,u;for(const[d,f]of t)a.set(d,o0(d,f));for(const d of RE)l=e.pieces.get(d),c=a.get(d),l?c?Tb(l,c.piece)||(s.push(c),o.push(o0(d,l))):o.push(o0(d,l)):c&&s.push(c);for(const d of o)c=dG(d,s.filter(f=>Tb(d.piece,f.piece))),c&&(u=[c.pos[0]-d.pos[0],c.pos[1]-d.pos[1]],n.set(d.key,u.concat(u)),i.push(c.key));for(const d of s)i.includes(d.key)||r.set(d.key,d.piece);return{anims:n,fadings:r}}function b2(t,e){const n=t.animation.current;if(n===void 0){t.dom.destroyed||t.dom.redrawNow();return}const i=1-(e-n.start)*n.frequency;if(i<=0)t.animation.current=void 0,t.dom.redrawNow();else{const r=pG(i);for(const s of n.plan.anims.values())s[2]=s[0]*r,s[3]=s[1]*r;t.dom.redrawNow(!0),requestAnimationFrame((s=performance.now())=>b2(t,s))}}function fG(t,e){const n=new Map(e.pieces),i=t(e),r=hG(n,e);if(r.anims.size||r.fadings.size){const s=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:r},s||b2(e,performance.now())}else e.dom.redraw();return i}function pG(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}const mG=["green","red","blue","yellow"];function gG(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?Hi(t):NE(t);const n=dl(e),i=hu(n,lr(t),t.dom.bounds());i&&(t.drawable.current={orig:i,pos:n,brush:bG(e),snapToValidMove:t.drawable.defaultSnapToValidMove},T2(t))}function T2(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const n=hu(e.pos,lr(t),t.dom.bounds());n||(e.snapToValidMove=!1);const i=e.snapToValidMove?aG(e.orig,e.pos,lr(t),t.dom.bounds()):n;i!==e.mouseSq&&(e.mouseSq=i,e.dest=i!==e.orig?i:void 0,t.dom.redrawNow()),T2(t)}})}function vG(t,e){t.drawable.current&&(t.drawable.current.pos=dl(e))}function yG(t){const e=t.drawable.current;e&&(e.mouseSq&&TG(t.drawable,e),S2(t))}function S2(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function _G(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),E2(t.drawable))}function bG(t){var e;const n=(t.shiftKey||t.ctrlKey)&&i2(t),i=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return mG[(n?1:0)+(i?2:0)]}function TG(t,e){const n=r=>r.orig===e.orig&&r.dest===e.dest,i=t.shapes.find(n);i&&(t.shapes=t.shapes.filter(r=>!n(r))),(!i||i.brush!==e.brush)&&t.shapes.push(e),E2(t)}function E2(t){t.onChange&&t.onChange(t.shapes)}function SG(t,e){if(!e.isTrusted||e.button!==void 0&&e.button!==0||e.touches&&e.touches.length>1)return;const n=t.dom.bounds(),i=dl(e),r=hu(i,lr(t),n);if(!r)return;const s=t.pieces.get(r),o=t.selected;!o&&t.drawable.enabled&&(t.drawable.eraseOnClick||!s||s.color!==t.turnColor)&&_G(t),e.cancelable!==!1&&(!e.touches||!t.movable.color||s||o||EG(t,i))&&e.preventDefault();const a=!!t.premovable.current,l=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&DE(t,t.selected,r)?_a(d=>Sb(d,r),t):Sb(t,r);const c=t.selected===r,u=k2(t,r);if(s&&u&&c&&rG(t,r)){t.draggable.current={orig:r,piece:s,origPos:i,pos:i,started:t.draggable.autoDistance&&t.stats.dragged,element:u,previouslySelected:o,originTarget:e.target},u.cgDragging=!0,u.classList.add("dragging");const d=t.dom.elements.ghost;d&&(d.className=`ghost ${s.color} ${s.role}`,kv(d,IE(n)(Pt(r),lr(t))),PE(d,!0)),ME(t)}else a&&Qo(t),l&&Yo(t);t.dom.redraw()}function EG(t,e){const n=lr(t),i=t.dom.bounds(),r=Math.pow(i.width/8,2);for(const s in t.pieces){const o=r2(s,n,i);if(wh(o,e)<=r)return!0}return!1}function CG(t,e,n,i){const r="a0";t.pieces.set(r,e),t.dom.redraw();const s=dl(n);t.draggable.current={orig:r,piece:e,origPos:s,pos:s,started:!0,element:()=>k2(t,r),originTarget:n.target,newPiece:!0,force:!!i},ME(t)}function ME(t){requestAnimationFrame(()=>{var e;const n=t.draggable.current;if(!n)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(n.orig)&&(t.animation.current=void 0);const i=t.pieces.get(n.orig);if(!i||!Tb(i,n.piece))ag(t);else if(!n.started&&wh(n.pos,n.origPos)>=Math.pow(t.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const s=n.element();if(!s)return;s.cgDragging=!0,s.classList.add("dragging"),n.element=s}const r=t.dom.bounds();kv(n.element,[n.pos[0]-r.left-r.width/16,n.pos[1]-r.top-r.height/16])}ME(t)})}function kG(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=dl(e))}function wG(t,e){const n=t.draggable.current;if(!n)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&n.originTarget!==e.target&&!n.newPiece){t.draggable.current=void 0;return}Qo(t),Yo(t);const i=dl(e)||n.pos,r=hu(i,lr(t),t.dom.bounds());r&&n.started&&n.orig!==r?n.newPiece?f2(t,n.orig,r,n.force):(t.stats.ctrlKey=e.ctrlKey,h2(t,n.orig,r)&&(t.stats.dragged=!0)):n.newPiece?t.pieces.delete(n.orig):t.draggable.deleteOnDropOff&&!r&&(t.pieces.delete(n.orig),ci(t.events.change)),n.orig===n.previouslySelected&&(n.orig===r||!r)?Hi(t):t.selectable.enabled||Hi(t),C2(t),t.draggable.current=void 0,t.dom.redraw()}function ag(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,Hi(t),C2(t),t.dom.redraw())}function C2(t){const e=t.dom.elements;e.ghost&&PE(e.ghost,!1)}function k2(t,e){let n=t.dom.elements.board.firstChild;for(;n;){if(n.cgKey===e&&n.tagName==="PIECE")return n;n=n.nextSibling}}function RG(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{kR(t,2),setTimeout(()=>kR(t,void 0),120)},120)}function kR(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function AG(t,e){function n(){QH(t),e()}return{set(i){i.orientation&&i.orientation!==t.orientation&&n(),(i.fen?_a:Gs)(r=>y2(r,i),t)},state:t,getFen:()=>uG(t.pieces),toggleOrientation:n,setPieces(i){_a(r=>YH(r,i),t)},selectSquare(i,r){i?_a(s=>Sb(s,i,r),t):t.selected&&(Hi(t),t.dom.redraw())},move(i,r){_a(s=>u2(s,i,r),t)},newPiece(i,r){_a(s=>xE(s,i,r),t)},playPremove(){if(t.premovable.current){if(_a(sG,t))return!0;t.dom.redraw()}return!1},playPredrop(i){if(t.predroppable.current){const r=oG(t,i);return t.dom.redraw(),r}return!1},cancelPremove(){Gs(Qo,t)},cancelPredrop(){Gs(Yo,t)},cancelMove(){Gs(i=>{NE(i),ag(i)},t)},stop(){Gs(i=>{ER(i),ag(i)},t)},explode(i){RG(t,i)},setAutoShapes(i){Gs(r=>r.drawable.autoShapes=i,t)},setShapes(i){Gs(r=>r.drawable.shapes=i,t)},getKeyAtDomPos(i){return hu(i,lr(t),t.dom.bounds())},redrawAll:e,dragNewPiece(i,r,s){CG(t,i,r,s)},destroy(){ER(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function IG(){return{pieces:v2(g2),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:zH()}}function ji(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function wR(t,e,n){const i=t.drawable,r=i.current,s=r&&r.mouseSq?r:void 0,o=new Map,a=t.dom.bounds();for(const p of i.shapes.concat(i.autoShapes).concat(s?[s]:[]))p.dest&&o.set(p.dest,(o.get(p.dest)||0)+1);const l=i.shapes.concat(i.autoShapes).map(p=>({shape:p,current:!1,hash:AR(p,o,!1,a)}));s&&l.push({shape:s,current:!0,hash:AR(s,o,!0,a)});const c=l.map(p=>p.hash).join(";");if(c===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=c;const u=e.querySelector("defs"),d=e.querySelector("g"),f=n.querySelector("g");PG(i,l,u),RR(t,l.filter(p=>!p.shape.customSvg),i.brushes,o,d),RR(t,l.filter(p=>p.shape.customSvg),i.brushes,o,f)}function PG(t,e,n){const i=new Map;let r;for(const a of e)a.shape.dest&&(r=t.brushes[a.shape.brush],a.shape.modifiers&&(r=w2(r,a.shape.modifiers)),i.set(r.key,r));const s=new Set;let o=n.firstChild;for(;o;)s.add(o.getAttribute("cgKey")),o=o.nextSibling;for(const[a,l]of i.entries())s.has(a)||n.appendChild(FG(l))}function RR(t,e,n,i,r){const s=t.dom.bounds(),o=new Map,a=[];for(const u of e)o.set(u.hash,!1);let l=r.firstChild,c;for(;l;)c=l.getAttribute("cgHash"),o.has(c)?o.set(c,!0):a.push(l),l=l.nextSibling;for(const u of a)r.removeChild(u);for(const u of e)o.get(u.hash)||r.appendChild(NG(t,u,n,i,s))}function AR({orig:t,dest:e,brush:n,piece:i,modifiers:r,customSvg:s},o,a,l){return[l.width,l.height,a,t,e,n,e&&(o.get(e)||0)>1,i&&xG(i),r&&DG(r),s&&OG(s)].filter(c=>c).join(",")}function xG(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function DG(t){return""+(t.lineWidth||"")}function OG(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n)>>>0;return"custom-"+e.toString()}function NG(t,{shape:e,current:n,hash:i},r,s,o){let a;if(e.customSvg){const l=ap(Pt(e.orig),t.orientation);a=MG(e.customSvg,l,o)}else if(e.piece)a=VG(t.drawable.pieces.baseUrl,ap(Pt(e.orig),t.orientation),e.piece,o);else{const l=ap(Pt(e.orig),t.orientation);if(e.dest){let c=r[e.brush];e.modifiers&&(c=w2(c,e.modifiers)),a=UG(c,l,ap(Pt(e.dest),t.orientation),n,(s.get(e.dest)||0)>1,o)}else a=LG(r[e.brush],l,n,o)}return a.setAttribute("cgHash",i),a}function MG(t,e,n){const{width:i,height:r}=n,s=i/8,o=r/8,a=e[0]*s,l=(7-e[1])*o,c=ks(ji("g"),{transform:`translate(${a},${l})`}),u=ks(ji("svg"),{width:s,height:o,viewBox:"0 0 100 100"});return c.appendChild(u),u.innerHTML=t,c}function LG(t,e,n,i){const r=lg(e,i),s=jG(i),o=(i.width+i.height)/32;return ks(ji("circle"),{stroke:t.color,"stroke-width":s[n?0:1],fill:"none",opacity:R2(t,n),cx:r[0],cy:r[1],r:o-s[1]/2})}function UG(t,e,n,i,r,s){const o=qG(s,r&&!i),a=lg(e,s),l=lg(n,s),c=l[0]-a[0],u=l[1]-a[1],d=Math.atan2(u,c),f=Math.cos(d)*o,p=Math.sin(d)*o;return ks(ji("line"),{stroke:t.color,"stroke-width":BG(t,i,s),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+t.key+")",opacity:R2(t,i),x1:a[0],y1:a[1],x2:l[0]-f,y2:l[1]-p})}function VG(t,e,n,i){const r=lg(e,i),s=i.width/8*(n.scale||1),o=n.color[0]+(n.role==="knight"?"n":n.role[0]).toUpperCase();return ks(ji("image"),{className:`${n.role} ${n.color}`,x:r[0]-s/2,y:r[1]-s/2,width:s,height:s,href:t+o+".svg"})}function FG(t){const e=ks(ji("marker"),{id:"arrowhead-"+t.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return e.appendChild(ks(ji("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function ks(t,e){for(const n in e)t.setAttribute(n,e[n]);return t}function ap(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function w2(t,e){return{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(n=>n).join("")}}function jG(t){const e=t.width/512;return[3*e,4*e]}function BG(t,e,n){return(t.lineWidth||10)*(e?.85:1)/512*n.width}function R2(t,e){return(t.opacity||1)*(e?.9:1)}function qG(t,e){return(e?20:10)/512*t.width}function lg(t,e){return[(t[0]+.5)*e.width/8,(7.5-t[1])*e.height/8]}function zG(t,e,n){t.innerHTML="",t.classList.add("cg-wrap");for(const c of jH)t.classList.toggle("orientation-"+c,e.orientation===c);t.classList.toggle("manipulable",!e.viewOnly);const i=ao("cg-helper");t.appendChild(i);const r=ao("cg-container");i.appendChild(r);const s=ao("cg-board");r.appendChild(s);let o,a;if(e.drawable.visible&&!n&&(o=ks(ji("svg"),{class:"cg-shapes"}),o.appendChild(ji("defs")),o.appendChild(ji("g")),a=ks(ji("svg"),{class:"cg-custom-svgs"}),a.appendChild(ji("g")),r.appendChild(o),r.appendChild(a)),e.coordinates){const c=e.orientation==="black"?" black":"";r.appendChild(IR(wE,"ranks"+c)),r.appendChild(IR(kE,"files"+c))}let l;return e.draggable.showGhost&&!n&&(l=ao("piece","ghost"),PE(l,!1),r.appendChild(l)),{board:s,container:r,ghost:l,svg:o,customSvg:a}}function IR(t,e){const n=ao("coords",e);let i;for(const r of t)i=ao("coord"),i.textContent=r,n.appendChild(i);return n}function HG(t,e){if(!t.dropmode.active)return;Qo(t),Yo(t);const n=t.dropmode.piece;if(n){t.pieces.set("a0",n);const i=dl(e),r=i&&hu(i,lr(t),t.dom.bounds());r&&f2(t,"a0",r)}t.dom.redraw()}function GG(t,e){const n=t.dom.elements.board;if(!t.dom.relative&&t.resizable&&"ResizeObserver"in window&&new window.ResizeObserver(e).observe(n),t.viewOnly)return;const i=$G(t);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1}),(t.disableContextMenu||t.drawable.enabled)&&n.addEventListener("contextmenu",r=>r.preventDefault())}function KG(t,e){const n=[];if(!t.dom.relative&&t.resizable&&!("ResizeObserver"in window)&&n.push(Xu(document.body,"chessground.resize",e)),!t.viewOnly){const i=PR(t,kG,vG),r=PR(t,wG,yG);for(const o of["touchmove","mousemove"])n.push(Xu(document,o,i));for(const o of["touchend","mouseup"])n.push(Xu(document,o,r));const s=()=>t.dom.bounds.clear();n.push(Xu(document,"scroll",s,{capture:!0,passive:!0})),n.push(Xu(window,"resize",s,{passive:!0}))}return()=>n.forEach(i=>i())}function Xu(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function $G(t){return e=>{t.draggable.current?ag(t):t.drawable.current?S2(t):e.shiftKey||i2(e)?t.drawable.enabled&&gG(t,e):t.viewOnly||(t.dropmode.active?HG(t,e):SG(t,e))}}function PR(t,e,n){return i=>{t.drawable.current?t.drawable.enabled&&n(t,i):t.viewOnly||e(t,i)}}function WG(t){const e=lr(t),n=t.dom.relative?HH:IE(t.dom.bounds()),i=t.dom.relative?GH:kv,r=t.dom.elements.board,s=t.pieces,o=t.animation.current,a=o?o.plan.anims:new Map,l=o?o.plan.fadings:new Map,c=t.draggable.current,u=YG(t),d=new Set,f=new Set,p=new Map,v=new Map;let g,E,y,T,R,b,w,D,C,k;for(E=r.firstChild;E;){if(g=E.cgKey,A2(E))if(y=s.get(g),R=a.get(g),b=l.get(g),T=E.cgPiece,E.cgDragging&&(!c||c.orig!==g)&&(E.classList.remove("dragging"),i(E,n(Pt(g),e)),E.cgDragging=!1),!b&&E.cgFading&&(E.cgFading=!1,E.classList.remove("fading")),y){if(R&&E.cgAnimating&&T===Zu(y)){const S=Pt(g);S[0]+=R[2],S[1]+=R[3],E.classList.add("anim"),i(E,n(S,e))}else E.cgAnimating&&(E.cgAnimating=!1,E.classList.remove("anim"),i(E,n(Pt(g),e)),t.addPieceZIndex&&(E.style.zIndex=a0(Pt(g),e)));T===Zu(y)&&(!b||!E.cgFading)?d.add(g):b&&T===Zu(b)?(E.classList.add("fading"),E.cgFading=!0):l0(p,T,E)}else l0(p,T,E);else if(I2(E)){const S=E.className;u.get(g)===S?f.add(g):l0(v,S,E)}E=E.nextSibling}for(const[S,A]of u)if(!f.has(S)){C=v.get(A),k=C&&C.pop();const I=n(Pt(S),e);if(k)k.cgKey=S,i(k,I);else{const N=ao("square",A);N.cgKey=S,i(N,I),r.insertBefore(N,r.firstChild)}}for(const[S,A]of s)if(R=a.get(S),!d.has(S))if(w=p.get(Zu(A)),D=w&&w.pop(),D){D.cgKey=S,D.cgFading&&(D.classList.remove("fading"),D.cgFading=!1);const I=Pt(S);t.addPieceZIndex&&(D.style.zIndex=a0(I,e)),R&&(D.cgAnimating=!0,D.classList.add("anim"),I[0]+=R[2],I[1]+=R[3]),i(D,n(I,e))}else{const I=Zu(A),N=ao("piece",I),O=Pt(S);N.cgPiece=I,N.cgKey=S,R&&(N.cgAnimating=!0,O[0]+=R[2],O[1]+=R[3]),i(N,n(O,e)),t.addPieceZIndex&&(N.style.zIndex=a0(O,e)),r.appendChild(N)}for(const S of p.values())xR(t,S);for(const S of v.values())xR(t,S)}function QG(t){if(t.dom.relative)return;const e=lr(t),n=IE(t.dom.bounds());let i=t.dom.elements.board.firstChild;for(;i;)(A2(i)&&!i.cgAnimating||I2(i))&&kv(i,n(Pt(i.cgKey),e)),i=i.nextSibling}function A2(t){return t.tagName==="PIECE"}function I2(t){return t.tagName==="SQUARE"}function xR(t,e){for(const n of e)t.dom.elements.board.removeChild(n)}function a0(t,e){let n=2+t[1]*8+(7-t[0]);return e&&(n=67-n),n+""}function Zu(t){return`${t.color} ${t.role}`}function YG(t){var e;const n=new Map;if(t.lastMove&&t.highlight.lastMove)for(const s of t.lastMove)js(n,s,"last-move");if(t.check&&t.highlight.check&&js(n,t.check,"check"),t.selected&&(js(n,t.selected,"selected"),t.movable.showDests)){const s=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(s)for(const a of s)js(n,a,"move-dest"+(t.pieces.has(a)?" oc":""));const o=t.premovable.dests;if(o)for(const a of o)js(n,a,"premove-dest"+(t.pieces.has(a)?" oc":""))}const i=t.premovable.current;if(i)for(const s of i)js(n,s,"current-premove");else t.predroppable.current&&js(n,t.predroppable.current.key,"current-premove");const r=t.exploding;if(r)for(const s of r.keys)js(n,s,"exploding"+r.stage);return n}function js(t,e,n){const i=t.get(e);i?t.set(e,`${i} ${n}`):t.set(e,n)}function l0(t,e,n){const i=t.get(e);i?i.push(n):t.set(e,[n])}function JG(t,e){const n=IG();y2(n,e||{});function i(){const r="dom"in n?n.dom.unbind:void 0,s=n.viewOnly&&!n.drawable.visible,o=zG(t,n,s),a=qH(()=>o.board.getBoundingClientRect()),l=d=>{WG(u),!d&&o.svg&&wR(u,o.svg,o.customSvg)},c=()=>{a.clear(),QG(u),o.svg&&wR(u,o.svg,o.customSvg)},u=n;return u.dom={elements:o,bounds:a,redraw:XG(l),redrawNow:l,unbind:r,relative:s},u.drawable.prevSvgHash="",l(!1),GG(u,c),r||(u.dom.unbind=KG(u,c)),u.events.insert&&u.events.insert(o),u}return AG(i(),i)}function XG(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}function cg(){return cg=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},cg.apply(this,arguments)}function ZG(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function P2(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var LE=function(t){ZG(e,t);function e(){return t.apply(this,arguments)||this}var n=e.prototype;return n.buildConfigFromProps=function(r){var s={events:{}};return Object.keys(e.propTypes).forEach(function(o){var a=r[o];if(typeof a<"u"){var l=o.match(/^on([A-Z]\S*)/);l?s.events[l[1].toLowerCase()]=a:s[o]=a}}),s},n.componentDidMount=function(){this.cg=JG(this.el,this.buildConfigFromProps(this.props))},n.componentWillReceiveProps=function(r){this.cg.set(this.buildConfigFromProps(r))},n.componentWillUnmount=function(){this.cg.destroy()},n.render=function(){var r=this,s={style:cg({},this.props.style)};return this.props.width&&(s.style.width=this.props.width),this.props.height&&(s.style.height=this.props.height),Na.createElement("div",cg({ref:function(a){return r.el=a}},s))},e}(Na.Component);P2(LE,"propTypes",{width:He.oneOfType([He.string,He.number]),height:He.oneOfType([He.string,He.number]),fen:He.string,orientation:He.string,turnColor:He.string,check:He.string,lastMove:He.array,selected:He.string,coordinates:He.bool,autoCastle:He.bool,viewOnly:He.bool,disableContextMenu:He.bool,resizable:He.bool,addPieceZIndex:He.bool,highlight:He.object,animation:He.object,movable:He.object,premovable:He.object,predroppable:He.object,draggable:He.object,selectable:He.object,onChange:He.func,onMove:He.func,onDropNewPiece:He.func,onSelect:He.func,items:He.object,drawable:He.object});P2(LE,"defaultProps",{coordinates:!0,resizable:!0,highlight:{lastMove:!0,check:!0}});const eK=Object.freeze(Object.defineProperty({__proto__:null,default:LE},Symbol.toStringTag,{value:"Module"})),tK=A4(eK);var nK=tK;const iK=rT(nK);function rK(t){return t!==null?{comment:t,variations:[]}:{variations:[]}}function sK(t,e,n,i,r){const s={move:t,variations:r};return e&&(s.suffix=e),n&&(s.nag=n),i!==null&&(s.comment=i),s}function oK(...t){const[e,...n]=t;let i=e;for(const r of n)r!==null&&(i.variations=[r,...r.variations],r.variations=[],i=r);return e}function aK(t,e){if(e.marker&&e.marker.comment){let n=e.root;for(;;){const i=n.variations[0];if(!i){n.comment=e.marker.comment;break}n=i}}return{headers:t,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function lK(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function qc(t,e,n,i){var r=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(r,qc.prototype),r.expected=e,r.found=n,r.location=i,r.name="SyntaxError",r}lK(qc,Error);function c0(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,n+=n.repeat(e),t+n.slice(0,e))}qc.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n=null,i;for(i=0;i<t.length;i++)if(t[i].source===this.location.source){n=t[i].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,s=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(r):r,o=this.location.source+":"+s.line+":"+s.column;if(n){var a=this.location.end,l=c0("",s.line.toString().length," "),c=n[r.line-1],u=r.line===a.line?a.column:c.length+1,d=u-r.column||1;e+=`
 --> `+o+`
`+l+` |
`+s.line+" | "+c+`
`+l+" | "+c0("",r.column-1," ")+c0("",d,"^")}else e+=`
 at `+o}return e};qc.buildMessage=function(t,e){var n={literal:function(c){return'"'+r(c.text)+'"'},class:function(c){var u=c.parts.map(function(d){return Array.isArray(d)?s(d[0])+"-"+s(d[1]):s(d)});return"["+(c.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function i(c){return c.charCodeAt(0).toString(16).toUpperCase()}function r(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function s(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function o(c){return n[c.type](c)}function a(c){var u=c.map(o),d,f;if(u.sort(),u.length>0){for(d=1,f=1;d<u.length;d++)u[d-1]!==u[d]&&(u[f]=u[d],f++);u.length=f}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}function l(c){return c?'"'+r(c)+'"':"end of input"}return"Expected "+a(t)+" but "+l(e)+" found."};function cK(t,e){e=e!==void 0?e:{};var n={},i=e.grammarSource,r={pgn:Cf},s=Cf,o="[",a='"',l="]",c=".",u="O-O-O",d="O-O",f="0-0-0",p="0-0",v="$",g="{",E="}",y=";",T="(",R=")",b="1-0",w="0-1",D="1/2-1/2",C="*",k=/^[a-zA-Z]/,S=/^[^"]/,A=/^[0-9]/,I=/^[.]/,N=/^[a-zA-Z1-8\-=]/,O=/^[+#]/,he=/^[!?]/,Ye=/^[^}]/,J=/^[^\r\n]/,re=/^[ \t\r\n]/,se=jn("tag pair"),be=gt("[",!1),ze=gt('"',!1),xn=gt("]",!1),Zt=jn("tag name"),gn=Ai([["a","z"],["A","Z"]],!1,!1),en=jn("tag value"),Dn=Ai(['"'],!0,!1),di=jn("move number"),Ze=Ai([["0","9"]],!1,!1),Qn=gt(".",!1),$i=Ai(["."],!1,!1),ml=jn("standard algebraic notation"),Hv=gt("O-O-O",!1),pf=gt("O-O",!1),mu=gt("0-0-0",!1),mf=gt("0-0",!1),gf=Ai([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),gu=Ai(["+","#"],!1,!1),vu=jn("suffix annotation"),yu=Ai(["!","?"],!1,!1),tn=jn("NAG"),vn=gt("$",!1),gl=jn("brace comment"),Gv=gt("{",!1),_u=Ai(["}"],!0,!1),Kv=gt("}",!1),ta=jn("rest of line comment"),vf=gt(";",!1),bu=Ai(["\r",`
`],!0,!1),Tu=jn("variation"),$v=gt("(",!1),Wv=gt(")",!1),yf=jn("game termination marker"),_f=gt("1-0",!1),na=gt("0-1",!1),Su=gt("1/2-1/2",!1),Eu=gt("*",!1),jr=jn("whitespace"),Cu=Ai([" ","	","\r",`
`],!1,!1),vl=function(U,B){return aK(U,B)},bf=function(U){return Object.fromEntries(U)},ia=function(U,B){return[U,B]},Tf=function(U,B){return{root:U,marker:B}},yn=function(U,B){return oK(rK(U),...B.flat())},Sf=function(U,B,j,ae,ce){return sK(U,B,j,ae,ce)},ra=function(U){return U},sa=function(U){return U.replace(/[\r\n]+/g," ")},Qv=function(U){return U.trim()},Yv=function(U){return U},Ds=function(U,B){return{result:U,comment:B}},z=e.peg$currPos|0,Os=[{line:1,column:1}],On=z,oa=e.peg$maxFailExpected||[],ne=e.peg$silentFails|0,Br;if(e.startRule){if(!(e.startRule in r))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');s=r[e.startRule]}function gt(U,B){return{type:"literal",text:U,ignoreCase:B}}function Ai(U,B,j){return{type:"class",parts:U,inverted:B,ignoreCase:j}}function fr(){return{type:"end"}}function jn(U){return{type:"other",description:U}}function ku(U){var B=Os[U],j;if(B)return B;if(U>=Os.length)j=Os.length-1;else for(j=U;!Os[--j];);for(B=Os[j],B={line:B.line,column:B.column};j<U;)t.charCodeAt(j)===10?(B.line++,B.column=1):B.column++,j++;return Os[U]=B,B}function yl(U,B,j){var ae=ku(U),ce=ku(B),Fe={source:i,start:{offset:U,line:ae.line,column:ae.column},end:{offset:B,line:ce.line,column:ce.column}};return Fe}function le(U){z<On||(z>On&&(On=z,oa=[]),oa.push(U))}function Ef(U,B,j){return new qc(qc.buildMessage(U,B),U,B,j)}function Cf(){var U,B,j;return U=z,B=kf(),j=wu(),U=vl(B,j),U}function kf(){var U,B,j;for(U=z,B=[],j=wf();j!==n;)B.push(j),j=wf();return j=nn(),U=bf(B),U}function wf(){var U,B,j,ae,ce,Fe,je;return ne++,U=z,nn(),t.charCodeAt(z)===91?(B=o,z++):(B=n,ne===0&&le(be)),B!==n?(nn(),j=_l(),j!==n?(nn(),t.charCodeAt(z)===34?(ae=a,z++):(ae=n,ne===0&&le(ze)),ae!==n?(ce=Rf(),t.charCodeAt(z)===34?(Fe=a,z++):(Fe=n,ne===0&&le(ze)),Fe!==n?(nn(),t.charCodeAt(z)===93?(je=l,z++):(je=n,ne===0&&le(xn)),je!==n?U=ia(j,ce):(z=U,U=n)):(z=U,U=n)):(z=U,U=n)):(z=U,U=n)):(z=U,U=n),ne--,U===n&&ne===0&&le(se),U}function _l(){var U,B,j;if(ne++,U=z,B=[],j=t.charAt(z),k.test(j)?z++:(j=n,ne===0&&le(gn)),j!==n)for(;j!==n;)B.push(j),j=t.charAt(z),k.test(j)?z++:(j=n,ne===0&&le(gn));else B=n;return B!==n?U=t.substring(U,z):U=B,ne--,U===n&&(B=n,ne===0&&le(Zt)),U}function Rf(){var U,B,j;for(ne++,U=z,B=[],j=t.charAt(z),S.test(j)?z++:(j=n,ne===0&&le(Dn));j!==n;)B.push(j),j=t.charAt(z),S.test(j)?z++:(j=n,ne===0&&le(Dn));return U=t.substring(U,z),ne--,B=n,ne===0&&le(en),U}function wu(){var U,B,j;return U=z,B=Ns(),nn(),j=If(),j===n&&(j=null),nn(),U=Tf(B,j),U}function Ns(){var U,B,j,ae;for(U=z,B=bl(),B===n&&(B=null),j=[],ae=pr();ae!==n;)j.push(ae),ae=pr();return U=yn(B,j),U}function pr(){var U,B,j,ae,ce,Fe,je,qr;if(U=z,nn(),Ru(),nn(),B=Jv(),B!==n){for(j=Af(),j===n&&(j=null),ae=[],ce=Au();ce!==n;)ae.push(ce),ce=Au();for(ce=nn(),Fe=bl(),Fe===n&&(Fe=null),je=[],qr=xu();qr!==n;)je.push(qr),qr=xu();U=Sf(B,j,ae,Fe,je)}else z=U,U=n;return U}function Ru(){var U,B,j,ae,ce,Fe;for(ne++,U=z,B=[],j=t.charAt(z),A.test(j)?z++:(j=n,ne===0&&le(Ze));j!==n;)B.push(j),j=t.charAt(z),A.test(j)?z++:(j=n,ne===0&&le(Ze));if(t.charCodeAt(z)===46?(j=c,z++):(j=n,ne===0&&le(Qn)),j!==n){for(ae=nn(),ce=[],Fe=t.charAt(z),I.test(Fe)?z++:(Fe=n,ne===0&&le($i));Fe!==n;)ce.push(Fe),Fe=t.charAt(z),I.test(Fe)?z++:(Fe=n,ne===0&&le($i));B=[B,j,ae,ce],U=B}else z=U,U=n;return ne--,U===n&&(B=n,ne===0&&le(di)),U}function Jv(){var U,B,j,ae,ce,Fe;if(ne++,U=z,B=z,t.substr(z,5)===u?(j=u,z+=5):(j=n,ne===0&&le(Hv)),j===n&&(t.substr(z,3)===d?(j=d,z+=3):(j=n,ne===0&&le(pf)),j===n&&(t.substr(z,5)===f?(j=f,z+=5):(j=n,ne===0&&le(mu)),j===n&&(t.substr(z,3)===p?(j=p,z+=3):(j=n,ne===0&&le(mf)),j===n))))if(j=z,ae=t.charAt(z),k.test(ae)?z++:(ae=n,ne===0&&le(gn)),ae!==n){if(ce=[],Fe=t.charAt(z),N.test(Fe)?z++:(Fe=n,ne===0&&le(gf)),Fe!==n)for(;Fe!==n;)ce.push(Fe),Fe=t.charAt(z),N.test(Fe)?z++:(Fe=n,ne===0&&le(gf));else ce=n;ce!==n?(ae=[ae,ce],j=ae):(z=j,j=n)}else z=j,j=n;return j!==n?(ae=t.charAt(z),O.test(ae)?z++:(ae=n,ne===0&&le(gu)),ae===n&&(ae=null),j=[j,ae],B=j):(z=B,B=n),B!==n?U=t.substring(U,z):U=B,ne--,U===n&&(B=n,ne===0&&le(ml)),U}function Af(){var U,B,j;for(ne++,U=z,B=[],j=t.charAt(z),he.test(j)?z++:(j=n,ne===0&&le(yu));j!==n;)B.push(j),B.length>=2?j=n:(j=t.charAt(z),he.test(j)?z++:(j=n,ne===0&&le(yu)));return B.length<1?(z=U,U=n):U=B,ne--,U===n&&(B=n,ne===0&&le(vu)),U}function Au(){var U,B,j,ae,ce;if(ne++,U=z,nn(),t.charCodeAt(z)===36?(B=v,z++):(B=n,ne===0&&le(vn)),B!==n){if(j=z,ae=[],ce=t.charAt(z),A.test(ce)?z++:(ce=n,ne===0&&le(Ze)),ce!==n)for(;ce!==n;)ae.push(ce),ce=t.charAt(z),A.test(ce)?z++:(ce=n,ne===0&&le(Ze));else ae=n;ae!==n?j=t.substring(j,z):j=ae,j!==n?U=ra(j):(z=U,U=n)}else z=U,U=n;return ne--,U===n&&ne===0&&le(tn),U}function bl(){var U;return U=Iu(),U===n&&(U=Pu()),U}function Iu(){var U,B,j,ae,ce;if(ne++,U=z,t.charCodeAt(z)===123?(B=g,z++):(B=n,ne===0&&le(Gv)),B!==n){for(j=z,ae=[],ce=t.charAt(z),Ye.test(ce)?z++:(ce=n,ne===0&&le(_u));ce!==n;)ae.push(ce),ce=t.charAt(z),Ye.test(ce)?z++:(ce=n,ne===0&&le(_u));j=t.substring(j,z),t.charCodeAt(z)===125?(ae=E,z++):(ae=n,ne===0&&le(Kv)),ae!==n?U=sa(j):(z=U,U=n)}else z=U,U=n;return ne--,U===n&&(B=n,ne===0&&le(gl)),U}function Pu(){var U,B,j,ae,ce;if(ne++,U=z,t.charCodeAt(z)===59?(B=y,z++):(B=n,ne===0&&le(vf)),B!==n){for(j=z,ae=[],ce=t.charAt(z),J.test(ce)?z++:(ce=n,ne===0&&le(bu));ce!==n;)ae.push(ce),ce=t.charAt(z),J.test(ce)?z++:(ce=n,ne===0&&le(bu));j=t.substring(j,z),U=Qv(j)}else z=U,U=n;return ne--,U===n&&(B=n,ne===0&&le(ta)),U}function xu(){var U,B,j,ae;return ne++,U=z,nn(),t.charCodeAt(z)===40?(B=T,z++):(B=n,ne===0&&le($v)),B!==n?(j=Ns(),j!==n?(nn(),t.charCodeAt(z)===41?(ae=R,z++):(ae=n,ne===0&&le(Wv)),ae!==n?U=Yv(j):(z=U,U=n)):(z=U,U=n)):(z=U,U=n),ne--,U===n&&ne===0&&le(Tu),U}function If(){var U,B,j;return ne++,U=z,t.substr(z,3)===b?(B=b,z+=3):(B=n,ne===0&&le(_f)),B===n&&(t.substr(z,3)===w?(B=w,z+=3):(B=n,ne===0&&le(na)),B===n&&(t.substr(z,7)===D?(B=D,z+=7):(B=n,ne===0&&le(Su)),B===n&&(t.charCodeAt(z)===42?(B=C,z++):(B=n,ne===0&&le(Eu))))),B!==n?(nn(),j=bl(),j===n&&(j=null),U=Ds(B,j)):(z=U,U=n),ne--,U===n&&(B=n,ne===0&&le(yf)),U}function nn(){var U,B;for(ne++,U=[],B=t.charAt(z),re.test(B)?z++:(B=n,ne===0&&le(Cu));B!==n;)U.push(B),B=t.charAt(z),re.test(B)?z++:(B=n,ne===0&&le(Cu));return ne--,B=n,ne===0&&le(jr),U}if(Br=s(),e.peg$library)return{peg$result:Br,peg$currPos:z,peg$FAILED:n,peg$maxFailExpected:oa,peg$maxFailPos:On};if(Br!==n&&z===t.length)return Br;throw Br!==n&&z<t.length&&le(fr()),Ef(oa,On<t.length?t.charAt(On):null,On<t.length?yl(On,On+1):yl(On,On))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const Bp=0xffffffffffffffffn;function u0(t,e){return(t<<e|t>>64n-e)&0xffffffffffffffffn}function DR(t,e){return t*e&Bp}function uK(t){return function(){let e=BigInt(t&Bp),n=BigInt(t>>64n&Bp);const i=DR(u0(DR(e,5n),7n),9n);return n^=e,e=(u0(e,24n)^n^n<<16n)&Bp,n=u0(n,37n),t=n<<64n|e,i}}const wv=uK(0xa187eb39cdcaed8f31c4b365b102e01en),dK=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>wv()))),hK=Array.from({length:8},()=>wv()),fK=Array.from({length:16},()=>wv()),d0=wv(),Mn="w",fi="b",Mt="p",Eb="n",qp="b",vd="r",Qs="q",Gt="k",h0="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class lp{constructor(e,n){vt(this,"color");vt(this,"from");vt(this,"to");vt(this,"piece");vt(this,"captured");vt(this,"promotion");vt(this,"flags");vt(this,"san");vt(this,"lan");vt(this,"before");vt(this,"after");const{color:i,piece:r,from:s,to:o,flags:a,captured:l,promotion:c}=n,u=sn(s),d=sn(o);this.color=i,this.piece=r,this.from=u,this.to=d,this.san=e._moveToSan(n,e._moves({legal:!0})),this.lan=u+d,this.before=e.fen(),e._makeMove(n),this.after=e.fen(),e._undoMove(),this.flags="";for(const f in ve)ve[f]&a&&(this.flags+=da[f]);l&&(this.captured=l),c&&(this.promotion=c,this.lan+=c)}isCapture(){return this.flags.indexOf(da.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(da.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(da.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(da.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(da.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(da.BIG_PAWN)>-1}}const _n=-1,da={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},ve={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Cb={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},pK={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},mK={...Cb,...pK},pe={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},f0={b:[16,32,17,15],w:[-16,-32,-17,-15]},OR={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},gK=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],vK=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],yK={p:1,n:2,b:4,r:8,q:16,k:32},_K="pnbrqkPNBRQK",NR=[Eb,qp,vd,Qs],bK=7,TK=6,SK=1,EK=0,cp={[Gt]:ve.KSIDE_CASTLE,[Qs]:ve.QSIDE_CASTLE},Bs={w:[{square:pe.a1,flag:ve.QSIDE_CASTLE},{square:pe.h1,flag:ve.KSIDE_CASTLE}],b:[{square:pe.a8,flag:ve.QSIDE_CASTLE},{square:pe.h8,flag:ve.KSIDE_CASTLE}]},CK={b:SK,w:TK},p0="--";function xa(t){return t>>4}function Rh(t){return t&15}function x2(t){return"0123456789".indexOf(t)!==-1}function sn(t){const e=Rh(t),n=xa(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function ed(t){return t===Mn?fi:Mn}function kK(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(e[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=e[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<r.length;o++){let a=0,l=!1;for(let c=0;c<r[o].length;c++)if(x2(r[o][c])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(r[o][c],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[o][c]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,l=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:a}of s){if(!a.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((e[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(r[0]+r[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function wK(t,e){const n=t.from,i=t.to,r=t.piece;let s=0,o=0,a=0;for(let l=0,c=e.length;l<c;l++){const u=e[l].from,d=e[l].to,f=e[l].piece;r===f&&n!==u&&i===d&&(s++,xa(n)===xa(u)&&o++,Rh(n)===Rh(u)&&a++)}return s>0?o>0&&a>0?sn(n):a>0?sn(n).charAt(1):sn(n).charAt(0):""}function qs(t,e,n,i,r,s=void 0,o=ve.NORMAL){const a=xa(i);if(r===Mt&&(a===bK||a===EK))for(let l=0;l<NR.length;l++){const c=NR[l];t.push({color:e,from:n,to:i,piece:r,captured:s,promotion:c,flags:o|ve.PROMOTION})}else t.push({color:e,from:n,to:i,piece:r,captured:s,flags:o})}function MR(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:Mt:(e=e.toLowerCase(),e==="o"?Gt:e)}function m0(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class LR{constructor(e=h0,{skipValidation:n=!1}={}){vt(this,"_board",new Array(128));vt(this,"_turn",Mn);vt(this,"_header",{});vt(this,"_kings",{w:_n,b:_n});vt(this,"_epSquare",-1);vt(this,"_halfMoves",0);vt(this,"_moveNumber",0);vt(this,"_history",[]);vt(this,"_comments",{});vt(this,"_castling",{w:0,b:0});vt(this,"_hash",0n);vt(this,"_positionCount",new Map);this.load(e,{skipValidation:n})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:_n,b:_n},this._turn=Mn,this._castling={w:0,b:0},this._epSquare=_n,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...mK},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:n=!1,preserveHeaders:i=!1}={}){let r=e.split(/\s+/);if(r.length>=2&&r.length<6){const a=["-","-","0","1"];e=r.concat(a.slice(-(6-r.length))).join(" ")}if(r=e.split(/\s+/),!n){const{ok:a,error:l}=kK(e);if(!a)throw new Error(l)}const s=r[0];let o=0;this.clear({preserveHeaders:i});for(let a=0;a<s.length;a++){const l=s.charAt(a);if(l==="/")o+=8;else if(x2(l))o+=parseInt(l,10);else{const c=l<"a"?Mn:fi;this._put({type:l.toLowerCase(),color:c},sn(o)),o++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=ve.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=ve.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=ve.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=ve.QSIDE_CASTLE),this._epSquare=r[3]==="-"?_n:pe[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){var o,a;let n=0,i="";for(let l=pe.a8;l<=pe.h1;l++){if(this._board[l]){n>0&&(i+=n,n=0);const{color:c,type:u}=this._board[l];i+=c===Mn?u.toUpperCase():u.toLowerCase()}else n++;l+1&136&&(n>0&&(i+=n),l!==pe.h1&&(i+="/"),n=0,l+=8)}let r="";this._castling[Mn]&ve.KSIDE_CASTLE&&(r+="K"),this._castling[Mn]&ve.QSIDE_CASTLE&&(r+="Q"),this._castling[fi]&ve.KSIDE_CASTLE&&(r+="k"),this._castling[fi]&ve.QSIDE_CASTLE&&(r+="q"),r=r||"-";let s="-";if(this._epSquare!==_n)if(e)s=sn(this._epSquare);else{const l=this._epSquare+(this._turn===Mn?16:-16),c=[l+1,l-1];for(const u of c){if(u&136)continue;const d=this._turn;if(((o=this._board[u])==null?void 0:o.color)===d&&((a=this._board[u])==null?void 0:a.type)===Mt){this._makeMove({color:d,from:u,to:this._epSquare,piece:Mt,captured:Mt,flags:ve.EP_CAPTURE});const f=!this._isKingAttacked(d);if(this._undoMove(),f){s=sn(this._epSquare);break}}}}return[i,this._turn,r,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:n,type:i}=this._board[e],r={w:0,b:1}[n],s={p:0,n:1,b:2,r:3,q:4,k:5}[i];return dK[r][s][e]}_epKey(){return this._epSquare===_n?0n:hK[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return fK[e]}_computeHash(){let e=0n;for(let n=pe.a8;n<=pe.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(e^=this._pieceKey(n))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=d0),e}_updateSetup(e){this._history.length>0||(e!==h0?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(h0)}get(e){return this._board[pe[e]]}findPiece(e){var i;const n=[];for(let r=pe.a8;r<=pe.h1;r++){if(r&136){r+=7;continue}!this._board[r]||((i=this._board[r])==null?void 0:i.color)!==e.color||this._board[r].color===e.color&&this._board[r].type===e.type&&n.push(sn(r))}return n}put({type:e,color:n},i){return this._put({type:e,color:n},i)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,n){this._hash^=this._pieceKey(e),this._board[e]=n,this._hash^=this._pieceKey(e)}_put({type:e,color:n},i){if(_K.indexOf(e.toLowerCase())===-1||!(i in pe))return!1;const r=pe[i];if(e==Gt&&!(this._kings[n]==_n||this._kings[n]==r))return!1;const s=this._board[r];return s&&s.type===Gt&&(this._kings[s.color]=_n),this._set(r,{type:e,color:n}),e===Gt&&(this._kings[n]=r),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const n=this.get(e);return this._clear(pe[e]),n&&n.type===Gt&&(this._kings[n.color]=_n),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var i,r,s,o,a,l,c,u,d,f,p,v;this._hash^=this._castlingKey();const e=((i=this._board[pe.e1])==null?void 0:i.type)===Gt&&((r=this._board[pe.e1])==null?void 0:r.color)===Mn,n=((s=this._board[pe.e8])==null?void 0:s.type)===Gt&&((o=this._board[pe.e8])==null?void 0:o.color)===fi;(!e||((a=this._board[pe.a1])==null?void 0:a.type)!==vd||((l=this._board[pe.a1])==null?void 0:l.color)!==Mn)&&(this._castling.w&=-65),(!e||((c=this._board[pe.h1])==null?void 0:c.type)!==vd||((u=this._board[pe.h1])==null?void 0:u.color)!==Mn)&&(this._castling.w&=-33),(!n||((d=this._board[pe.a8])==null?void 0:d.type)!==vd||((f=this._board[pe.a8])==null?void 0:f.color)!==fi)&&(this._castling.b&=-65),(!n||((p=this._board[pe.h8])==null?void 0:p.type)!==vd||((v=this._board[pe.h8])==null?void 0:v.color)!==fi)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,o;if(this._epSquare===_n)return;const e=this._epSquare+(this._turn===Mn?-16:16),n=this._epSquare+(this._turn===Mn?16:-16),i=[n+1,n-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((s=this._board[n])==null?void 0:s.color)!==ed(this._turn)||((o=this._board[n])==null?void 0:o.type)!==Mt){this._hash^=this._epKey(),this._epSquare=_n;return}const r=a=>{var l,c;return!(a&136)&&((l=this._board[a])==null?void 0:l.color)===this._turn&&((c=this._board[a])==null?void 0:c.type)===Mt};i.some(r)||(this._hash^=this._epKey(),this._epSquare=_n)}_attacked(e,n,i){const r=[];for(let s=pe.a8;s<=pe.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==e)continue;const o=this._board[s],a=s-n;if(a===0)continue;const l=a+119;if(gK[l]&yK[o.type]){if(o.type===Mt){if(a>0&&o.color===Mn||a<=0&&o.color===fi)if(i)r.push(sn(s));else return!0;continue}if(o.type==="n"||o.type==="k")if(i){r.push(sn(s));continue}else return!0;const c=vK[l];let u=s+c,d=!1;for(;u!==n;){if(this._board[u]!=null){d=!0;break}u+=c}if(!d)if(i){r.push(sn(s));continue}else return!0}}return i?r:!1}attackers(e,n){return n?this._attacked(n,pe[e],!0):this._attacked(this._turn,pe[e],!0)}_isKingAttacked(e){const n=this._kings[e];return n===-1?!1:this._attacked(ed(e),n)}hash(){return this._hash.toString(16)}isAttacked(e,n){return this._attacked(n,pe[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let i=0,r=0;for(let s=pe.a8;s<=pe.h1;s++){if(r=(r+1)%2,s&136){s+=7;continue}const o=this._board[s];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===qp&&n.push(r),i++)}if(i===2)return!0;if(i===3&&(e[qp]===1||e[Eb]===1))return!0;if(i===e[qp]+2){let s=0;const o=n.length;for(let a=0;a<o;a++)s+=n[a];if(s===0||s===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:n=void 0,piece:i=void 0}={}){const r=this._moves({square:n,piece:i});return e?r.map(s=>new lp(this,s)):r.map(s=>this._moveToSan(s,r))}_moves({legal:e=!0,piece:n=void 0,square:i=void 0}={}){var p;const r=i?i.toLowerCase():void 0,s=n==null?void 0:n.toLowerCase(),o=[],a=this._turn,l=ed(a);let c=pe.a8,u=pe.h1,d=!1;if(r)if(r in pe)c=u=pe[r],d=!0;else return[];for(let v=c;v<=u;v++){if(v&136){v+=7;continue}if(!this._board[v]||this._board[v].color===l)continue;const{type:g}=this._board[v];let E;if(g===Mt){if(s&&s!==g)continue;E=v+f0[a][0],this._board[E]||(qs(o,a,v,E,Mt),E=v+f0[a][1],CK[a]===xa(v)&&!this._board[E]&&qs(o,a,v,E,Mt,void 0,ve.BIG_PAWN));for(let y=2;y<4;y++)E=v+f0[a][y],!(E&136)&&(((p=this._board[E])==null?void 0:p.color)===l?qs(o,a,v,E,Mt,this._board[E].type,ve.CAPTURE):E===this._epSquare&&qs(o,a,v,E,Mt,Mt,ve.EP_CAPTURE))}else{if(s&&s!==g)continue;for(let y=0,T=OR[g].length;y<T;y++){const R=OR[g][y];for(E=v;E+=R,!(E&136);){if(!this._board[E])qs(o,a,v,E,g);else{if(this._board[E].color===a)break;qs(o,a,v,E,g,this._board[E].type,ve.CAPTURE);break}if(g===Eb||g===Gt)break}}}}if((s===void 0||s===Gt)&&(!d||u===this._kings[a])){if(this._castling[a]&ve.KSIDE_CASTLE){const v=this._kings[a],g=v+2;!this._board[v+1]&&!this._board[g]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,v+1)&&!this._attacked(l,g)&&qs(o,a,this._kings[a],g,Gt,void 0,ve.KSIDE_CASTLE)}if(this._castling[a]&ve.QSIDE_CASTLE){const v=this._kings[a],g=v-2;!this._board[v-1]&&!this._board[v-2]&&!this._board[v-3]&&!this._attacked(l,this._kings[a])&&!this._attacked(l,v-1)&&!this._attacked(l,g)&&qs(o,a,this._kings[a],g,Gt,void 0,ve.QSIDE_CASTLE)}}if(!e||this._kings[a]===-1)return o;const f=[];for(let v=0,g=o.length;v<g;v++)this._makeMove(o[v]),this._isKingAttacked(a)||f.push(o[v]),this._undoMove();return f}move(e,{strict:n=!1}={}){let i=null;if(typeof e=="string")i=this._moveFromSan(e,n);else if(e===null)i=this._moveFromSan(p0,n);else if(typeof e=="object"){const s=this._moves();for(let o=0,a=s.length;o<a;o++)if(e.from===sn(s[o].from)&&e.to===sn(s[o].to)&&(!("promotion"in s[o])||e.promotion===s[o].promotion)){i=s[o];break}}if(!i)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&i.flags&ve.NULL_MOVE)throw new Error("Null move not allowed when in check");const r=new lp(this,i);return this._makeMove(i),this._incPositionCount(),r}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,n){this._hash^=this._pieceKey(e),this._board[n]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(n)}_makeMove(e){var r,s,o,a;const n=this._turn,i=ed(n);if(this._push(e),e.flags&ve.NULL_MOVE){n===fi&&this._moveNumber++,this._halfMoves++,this._turn=i,this._epSquare=_n;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&ve.EP_CAPTURE&&(this._turn===fi?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:n})),this._board[e.to].type===Gt){if(this._kings[n]=e.to,e.flags&ve.KSIDE_CASTLE){const l=e.to-1,c=e.to+1;this._movePiece(c,l)}else if(e.flags&ve.QSIDE_CASTLE){const l=e.to+1,c=e.to-2;this._movePiece(c,l)}this._castling[n]=0}if(this._castling[n]){for(let l=0,c=Bs[n].length;l<c;l++)if(e.from===Bs[n][l].square&&this._castling[n]&Bs[n][l].flag){this._castling[n]^=Bs[n][l].flag;break}}if(this._castling[i]){for(let l=0,c=Bs[i].length;l<c;l++)if(e.to===Bs[i][l].square&&this._castling[i]&Bs[i][l].flag){this._castling[i]^=Bs[i][l].flag;break}}if(this._hash^=this._castlingKey(),e.flags&ve.BIG_PAWN){let l;n===fi?l=e.to-16:l=e.to+16,!(e.to-1&136)&&((r=this._board[e.to-1])==null?void 0:r.type)===Mt&&((s=this._board[e.to-1])==null?void 0:s.color)===i||!(e.to+1&136)&&((o=this._board[e.to+1])==null?void 0:o.type)===Mt&&((a=this._board[e.to+1])==null?void 0:a.color)===i?(this._epSquare=l,this._hash^=this._epKey()):this._epSquare=_n}else this._epSquare=_n;e.piece===Mt?this._halfMoves=0:e.flags&(ve.CAPTURE|ve.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===fi&&this._moveNumber++,this._turn=i,this._hash^=d0}undo(){const e=this._hash,n=this._undoMove();if(n){const i=new lp(this,n);return this._decPositionCount(e),i}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=d0;const i=this._turn,r=ed(i);if(n.flags&ve.NULL_MOVE)return n;if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:i})),n.captured)if(n.flags&ve.EP_CAPTURE){let s;i===fi?s=n.to-16:s=n.to+16,this._set(s,{type:Mt,color:r})}else this._set(n.to,{type:n.captured,color:r});if(n.flags&(ve.KSIDE_CASTLE|ve.QSIDE_CASTLE)){let s,o;n.flags&ve.KSIDE_CASTLE?(s=n.to+1,o=n.to-1):(s=n.to-2,o=n.to+1),this._movePiece(o,s)}return n}pgn({newline:e=`
`,maxWidth:n=0}={}){const i=[];let r=!1;for(const f in this._header)this._header[f]&&i.push(`[${f} "${this._header[f]}"]`+e),r=!0;r&&this._history.length&&i.push(e);const s=f=>{const p=this._comments[this.fen()];if(typeof p<"u"){const v=f.length>0?" ":"";f=`${f}${v}{${p}}`}return f},o=[];for(;this._history.length>0;)o.push(this._undoMove());const a=[];let l="";for(o.length===0&&a.push(s(""));o.length>0;){l=s(l);const f=o.pop();if(!f)break;if(!this._history.length&&f.color==="b"){const p=`${this._moveNumber}. ...`;l=l?`${l} ${p}`:p}else f.color==="w"&&(l.length&&a.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(f,this._moves({legal:!0})),this._makeMove(f)}if(l.length&&a.push(s(l)),a.push(this._header.Result||"*"),n===0)return i.join("")+a.join(" ");const c=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},u=function(f,p){for(const v of p.split(" "))if(v){if(f+v.length>n){for(;c();)f--;i.push(e),f=0}i.push(v),f+=v.length,i.push(" "),f++}return c()&&f--,f};let d=0;for(let f=0;f<a.length;f++){if(d+a[f].length>n&&a[f].includes("{")){d=u(d,a[f]);continue}d+a[f].length>n&&f!==0?(i[i.length-1]===" "&&i.pop(),i.push(e),d=0):f!==0&&(i.push(" "),d++),i.push(a[f]),d+=a[f].length}return i.join("")}header(...e){for(let n=0;n<e.length;n+=2)typeof e[n]=="string"&&typeof e[n+1]=="string"&&(this._header[e[n]]=e[n+1]);return this._header}setHeader(e,n){return this._header[e]=n??Cb[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=Cb[e]||null,!0):!1}getHeaders(){const e={};for(const[n,i]of Object.entries(this._header))i!==null&&(e[n]=i);return e}loadPgn(e,{strict:n=!1,newlineChar:i=`\r?
`}={}){i!==`\r?
`&&(e=e.replace(new RegExp(i,"g"),`
`));const r=cK(e);this.reset();const s=r.headers;let o="";for(const c in s)c.toLowerCase()==="fen"&&(o=s[c]),this.header(c,s[c]);if(!n)o&&this.load(o,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let a=r.root;for(;a;){if(a.move){const c=this._moveFromSan(a.move,n);if(c==null)throw new Error(`Invalid move in PGN: ${a.move}`);this._makeMove(c),this._incPositionCount()}a.comment!==void 0&&(this._comments[this.fen()]=a.comment),a=a.variations[0]}const l=r.result;l&&Object.keys(this._header).length&&this._header.Result!==l&&this.setHeader("Result",l)}_moveToSan(e,n){let i="";if(e.flags&ve.KSIDE_CASTLE)i="O-O";else if(e.flags&ve.QSIDE_CASTLE)i="O-O-O";else{if(e.flags&ve.NULL_MOVE)return p0;if(e.piece!==Mt){const r=wK(e,n);i+=e.piece.toUpperCase()+r}e.flags&(ve.CAPTURE|ve.EP_CAPTURE)&&(e.piece===Mt&&(i+=sn(e.from)[0]),i+="x"),i+=sn(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,n=!1){let i=m0(e);if(n||(i==="0-0"?i="O-O":i==="0-0-0"&&(i="O-O-O")),i==p0)return{color:this._turn,from:0,to:0,piece:"k",flags:ve.NULL_MOVE};let r=MR(i),s=this._moves({legal:!0,piece:r});for(let f=0,p=s.length;f<p;f++)if(i===m0(this._moveToSan(s[f],s)))return s[f];if(n)return null;let o,a,l,c,u,d=!1;if(a=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(o=a[1],l=a[2],c=a[3],u=a[4],l.length==1&&(d=!0)):(a=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(o=a[1],l=a[2],c=a[3],u=a[4],l.length==1&&(d=!0))),r=MR(i),s=this._moves({legal:!0,piece:o||r}),!c)return null;for(let f=0,p=s.length;f<p;f++)if(l){if((!o||o.toLowerCase()==s[f].piece)&&pe[l]==s[f].from&&pe[c]==s[f].to&&(!u||u.toLowerCase()==s[f].promotion))return s[f];if(d){const v=sn(s[f].from);if((!o||o.toLowerCase()==s[f].piece)&&pe[c]==s[f].to&&(l==v[0]||l==v[1])&&(!u||u.toLowerCase()==s[f].promotion))return s[f]}}else if(i===m0(this._moveToSan(s[f],s)).replace("x",""))return s[f];return null}ascii(){let e=`   +------------------------+
`;for(let n=pe.a8;n<=pe.h1;n++){if(Rh(n)===0&&(e+=" "+"87654321"[xa(n)]+" |"),this._board[n]){const i=this._board[n].type,s=this._board[n].color===Mn?i.toUpperCase():i.toLowerCase();e+=" "+s+" "}else e+=" . ";n+1&136&&(e+=`|
`,n+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const n=this._moves({legal:!1});let i=0;const r=this._turn;for(let s=0,o=n.length;s<o;s++)this._makeMove(n[s]),this._isKingAttacked(r)||(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let n=[];for(let i=pe.a8;i<=pe.h1;i++)this._board[i]==null?n.push(null):n.push({square:sn(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(n),n=[],i+=8);return e}squareColor(e){if(e in pe){const n=pe[e];return(xa(n)+Rh(n))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const n=[],i=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const r=n.pop();if(!r)break;e?i.push(new lp(this,r)):i.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return i}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const n=this._positionCount.get(e)??0;n===1?this._positionCount.delete(e):this._positionCount.set(e,n-1)}_pruneComments(){const e=[],n={},i=r=>{r in this._comments&&(n[r]=this._comments[r])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){const r=e.pop();if(!r)break;this._makeMove(r),i(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const n=this._comments[e];return delete this._comments[e],{fen:e,comment:n}})}setCastlingRights(e,n){for(const r of[Gt,Qs])n[r]!==void 0&&(n[r]?this._castling[e]|=cp[r]:this._castling[e]&=~cp[r]);this._updateCastlingRights();const i=this.getCastlingRights(e);return(n[Gt]===void 0||n[Gt]===i[Gt])&&(n[Qs]===void 0||n[Qs]===i[Qs])}getCastlingRights(e){return{[Gt]:(this._castling[e]&cp[Gt])!==0,[Qs]:(this._castling[e]&cp[Qs])!==0}}moveNumber(){return this._moveNumber}}const RK=({teacherId:t})=>{const[e,n]=P.useState(new LR),[i,r]=P.useState("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),[s,o]=P.useState(null),[a,l]=P.useState("white"),{userRole:c,currentUserId:u}=Na.useContext(ff),d=P.useRef(!1);P.useEffect(()=>{const v=bR(SR,`rooms/${t}`),g=SH(v,E=>{const y=E.val();if(y){d.current=!0;const T=new LR(y.fen);n(T),r(y.fen),y.lastMove&&o(y.lastMove),y.orientation&&l(y.orientation),d.current=!1}else c==="teacher"&&u===t&&TR(v,{fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",lastMove:null,orientation:"white"})});return()=>g()},[t,c,u]);const f=P.useCallback((v,g)=>{if(e.move({from:v,to:g,promotion:"q"})){const y=e.fen();r(y),o([v,g]),c==="teacher"&&u===t&&TR(bR(SR,`rooms/${t}`),{fen:y,lastMove:[v,g],orientation:a})}else console.log("Invalid move"),setTimeout(()=>r(e.fen()),100)},[e,t,c,u,a]),p={fen:i,orientation:a,viewOnly:!1,turnColor:e.turn()==="w"?"white":"black",lastMove:s,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!1,color:"both",dests:AK(e),showDests:!0},draggable:{enabled:!0},selectable:{enabled:!0},events:{move:f}};return G.jsx("div",{className:"w-full h-full flex justify-center items-center bg-[#262421] rounded-lg p-1 shadow-2xl",children:G.jsx("div",{style:{width:"100%",height:"100%",minHeight:"500px"},children:G.jsx(iK,{width:"100%",height:"100%",config:p})})})};function AK(t){const e=new Map;return t.SQUARES.forEach(n=>{const i=t.moves({square:n,verbose:!0});i.length&&e.set(n,i.map(r=>r.to))}),e}var UR={};function IK(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var PK=Object.defineProperty,xK=(t,e,n)=>e in t?PK(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,VR=(t,e,n)=>xK(t,typeof e!="symbol"?e+"":e,n);class Gn{constructor(){VR(this,"_locking"),VR(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(r=>e=()=>{this._locks-=1,r()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function kt(t,e){if(!t)throw new Error(e)}const DK=34028234663852886e22,OK=-34028234663852886e22,NK=4294967295,MK=2147483647,LK=-2147483648;function zp(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>MK||t<LK)throw new Error("invalid int 32: "+t)}function kb(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>NK||t<0)throw new Error("invalid uint 32: "+t)}function D2(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>DK||t<OK))throw new Error("invalid float 32: "+t)}const O2=Symbol("@bufbuild/protobuf/enum-type");function UK(t){const e=t[O2];return kt(e,"missing enum type on enum object"),e}function N2(t,e,n,i){t[O2]=M2(e,n.map(r=>({no:r.no,name:r.name,localName:t[r.no]})))}function M2(t,e,n){const i=Object.create(null),r=Object.create(null),s=[];for(const o of e){const a=L2(o);s.push(a),i[o.name]=a,r[o.no]=a}return{typeName:t,values:s,findName(o){return i[o]},findNumber(o){return r[o]}}}function VK(t,e,n){const i={};for(const r of e){const s=L2(r);i[s.localName]=s.no,i[s.no]=s.localName}return N2(i,t,e),i}function L2(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class UE{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),r=i.runtime.bin,s=r.makeReadOptions(n);return r.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),r=i.runtime.json,s=r.makeReadOptions(n);return r.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(r){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(r instanceof Error?r.message:String(r)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,r=i.makeWriteOptions(e),s=r.writerFactory();return i.writeMessage(this,s,r),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,r=i.makeWriteOptions(e);return i.writeMessage(this,r)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function FK(t,e,n,i){var r;const s=(r=i==null?void 0:i.localName)!==null&&r!==void 0?r:e.substring(e.lastIndexOf(".")+1),o={[s]:function(a){t.util.initFields(this),t.util.initPartial(a,this)}}[s];return Object.setPrototypeOf(o.prototype,new UE),Object.assign(o,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(a,l){return new o().fromBinary(a,l)},fromJson(a,l){return new o().fromJson(a,l)},fromJsonString(a,l){return new o().fromJsonString(a,l)},equals(a,l){return t.util.equals(o,a,l)}}),o}function jK(){let t=0,e=0;for(let i=0;i<28;i+=7){let r=this.buf[this.pos++];if(t|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let r=this.buf[this.pos++];if(e|=(r&127)<<i,!(r&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function g0(t,e,n){for(let s=0;s<28;s=s+7){const o=t>>>s,a=!(!(o>>>7)&&e==0),l=(a?o|128:o)&255;if(n.push(l),!a)return}const i=t>>>28&15|(e&7)<<4,r=!!(e>>3);if(n.push((r?i|128:i)&255),!!r){for(let s=3;s<31;s=s+7){const o=e>>>s,a=!!(o>>>7),l=(a?o|128:o)&255;if(n.push(l),!a)return}n.push(e>>>31&1)}}const Hp=4294967296;function FR(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,r=0;function s(o,a){const l=Number(t.slice(o,a));r*=n,i=i*n+l,i>=Hp&&(r=r+(i/Hp|0),i=i%Hp)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?V2(i,r):VE(i,r)}function BK(t,e){let n=VE(t,e);const i=n.hi&2147483648;i&&(n=V2(n.lo,n.hi));const r=U2(n.lo,n.hi);return i?"-"+r:r}function U2(t,e){if({lo:t,hi:e}=qK(t,e),e<=2097151)return String(Hp*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,r=e>>16&65535;let s=n+i*6777216+r*6710656,o=i+r*8147497,a=r*2;const l=1e7;return s>=l&&(o+=Math.floor(s/l),s%=l),o>=l&&(a+=Math.floor(o/l),o%=l),a.toString()+jR(o)+jR(s)}function qK(t,e){return{lo:t>>>0,hi:e>>>0}}function VE(t,e){return{lo:t|0,hi:e|0}}function V2(t,e){return e=~e,t?t=~t+1:e+=1,VE(t,e)}const jR=t=>{const e=String(t);return"0000000".slice(e.length)+e};function BR(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function zK(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function HK(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof UR!="object"||UR.BUF_BIGINT_DISABLE!=="1")){const r=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>s||c<r)throw new Error("int64 invalid: ".concat(l));return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>a||c<o)throw new Error("uint64 invalid: ".concat(l));return c},enc(l){return t.setBigInt64(0,this.parse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(l){return t.setBigInt64(0,this.uParse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigInt64(0,!0)},uDec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigUint64(0,!0)}}}const n=r=>kt(/^-?[0-9]+$/.test(r),"int64 invalid: ".concat(r)),i=r=>kt(/^[0-9]+$/.test(r),"uint64 invalid: ".concat(r));return{zero:"0",supported:!1,parse(r){return typeof r!="string"&&(r=r.toString()),n(r),r},uParse(r){return typeof r!="string"&&(r=r.toString()),i(r),r},enc(r){return typeof r!="string"&&(r=r.toString()),n(r),FR(r)},uEnc(r){return typeof r!="string"&&(r=r.toString()),i(r),FR(r)},dec(r,s){return BK(r,s)},uDec(r,s){return U2(r,s)}}}const _t=HK();var Q;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(Q||(Q={}));var qo;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(qo||(qo={}));function zs(t,e,n){if(e===n)return!0;if(t==Q.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case Q.UINT64:case Q.FIXED64:case Q.INT64:case Q.SFIXED64:case Q.SINT64:return e==n}return!1}function zc(t,e){switch(t){case Q.BOOL:return!1;case Q.UINT64:case Q.FIXED64:case Q.INT64:case Q.SFIXED64:case Q.SINT64:return e==0?_t.zero:"0";case Q.DOUBLE:case Q.FLOAT:return 0;case Q.BYTES:return new Uint8Array(0);case Q.STRING:return"";default:return 0}}function F2(t,e){switch(t){case Q.BOOL:return e===!1;case Q.STRING:return e==="";case Q.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var xt;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(xt||(xt={}));class GK{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let r=0;r<this.chunks.length;r++)e+=this.chunks[r].length;let n=new Uint8Array(e),i=0;for(let r=0;r<this.chunks.length;r++)n.set(this.chunks[r],i),i+=this.chunks[r].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(kb(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return zp(e),BR(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){D2(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){kb(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){zp(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return zp(e),e=(e<<1^e>>31)>>>0,BR(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=_t.enc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),r=_t.uEnc(e);return i.setInt32(0,r.lo,!0),i.setInt32(4,r.hi,!0),this.raw(n)}int64(e){let n=_t.enc(e);return g0(n.lo,n.hi,this.buf),this}sint64(e){let n=_t.enc(e),i=n.hi>>31,r=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return g0(r,s,this.buf),this}uint64(e){let n=_t.uEnc(e);return g0(n.lo,n.hi,this.buf),this}}class KK{constructor(e,n){this.varint64=jK,this.uint32=zK,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case xt.Varint:for(;this.buf[this.pos++]&128;);break;case xt.Bit64:this.pos+=4;case xt.Bit32:this.pos+=4;break;case xt.LengthDelimited:let r=this.uint32();this.pos+=r;break;case xt.StartGroup:for(;;){const[s,o]=this.tag();if(o===xt.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(o,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return _t.dec(...this.varint64())}uint64(){return _t.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,_t.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return _t.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return _t.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function $K(t,e,n,i){let r;return{typeName:e,extendee:n,get field(){if(!r){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),r=t.util.newFieldList([s]).list()[0]}return r},runtime:t}}function j2(t){const e=t.field.localName,n=Object.create(null);return n[e]=WK(t),[n,()=>n[e]]}function WK(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return zc(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function QK(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Zr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Rv=[];for(let t=0;t<Zr.length;t++)Rv[Zr[t].charCodeAt(0)]=t;Rv[45]=Zr.indexOf("+");Rv[95]=Zr.indexOf("/");const B2={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,r=0,s,o=0;for(let a=0;a<t.length;a++){if(s=Rv[t.charCodeAt(a)],s===void 0)switch(t[a]){case"=":r=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(r){case 0:o=s,r=1;break;case 1:n[i++]=o<<2|(s&48)>>4,o=s,r=2;break;case 2:n[i++]=(o&15)<<4|(s&60)>>2,o=s,r=3;break;case 3:n[i++]=(o&3)<<6|s,r=0;break}}if(r==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,r=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=Zr[i>>2],r=(i&3)<<4,n=1;break;case 1:e+=Zr[r|i>>4],r=(i&15)<<2,n=2;break;case 2:e+=Zr[r|i>>6],e+=Zr[i&63],n=0;break}return n&&(e+=Zr[r],e+="=",n==1&&(e+="=")),e}};function YK(t,e,n){z2(e,t);const i=e.runtime.bin.makeReadOptions(n),r=QK(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,o]=j2(e);for(const a of r)e.runtime.bin.readField(s,i.readerFactory(a.data),e.field,a.wireType,i);return o()}function JK(t,e,n,i){z2(e,t);const r=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(q2(t,e)){const c=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of c)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const o=s.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,n,o,s);const l=r.readerFactory(o.finish());for(;l.pos<l.len;){const[c,u]=l.tag(),d=l.skip(u,c);t.getType().runtime.bin.onUnknownField(t,c,u,d)}}function q2(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function z2(t,e){kt(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function H2(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!F2(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function qR(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?zc(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function es(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(UE.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function G2(t,e){return es(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}Q.DOUBLE,Q.FLOAT,Q.INT64,Q.UINT64,Q.INT32,Q.UINT32,Q.BOOL,Q.STRING,Q.BYTES;const zR={ignoreUnknownFields:!1},HR={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function XK(t){return t?Object.assign(Object.assign({},zR),t):zR}function ZK(t){return t?Object.assign(Object.assign({},HR),t):HR}const ug=Symbol(),Gp=Symbol();function e$(){return{makeReadOptions:XK,makeWriteOptions:ZK,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(yr(e)));i=i??new t;const r=new Map,s=n.typeRegistry;for(const[o,a]of Object.entries(e)){const l=t.fields.findJsonName(o);if(l){if(l.oneof){if(a===null&&l.kind=="scalar")continue;const c=r.get(l.oneof);if(c!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(c,'", "').concat(o,'"'));r.set(l.oneof,o)}GR(i,a,l,n,t)}else{let c=!1;if(s!=null&&s.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=s.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==t.typeName){c=!0;const[d,f]=j2(u);GR(d,a,u.field,n,u),JK(i,u,f(),n)}}if(!c&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(o,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let r;try{for(r of n.fields.byNumber()){if(!H2(r,t)){if(r.req)throw"required field not set";if(!e.emitDefaultValues||!n$(r))continue}const o=r.oneof?t[r.oneof.localName].value:t[r.localName],a=KR(r,o,e);a!==void 0&&(i[e.useProtoFieldName?r.name:r.jsonName]=a)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const o of n.runtime.bin.listUnknownFields(t)){const a=s.findExtensionFor(n.typeName,o.no);if(a&&q2(t,a)){const l=YK(t,a,e),c=KR(a.field,l,e);c!==void 0&&(i[a.field.jsonName]=c)}}}catch(s){const o=r?"cannot encode field ".concat(n.typeName,".").concat(r.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),a=s instanceof Error?s.message:String(s);throw new Error(o+(a.length>0?": ".concat(a):""))}return i},readScalar(t,e,n){return Hd(t,e,n??qo.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||F2(t,e)))return Kp(t,e)},debug:yr}}function yr(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function GR(t,e,n,i,r){let s=n.localName;if(n.repeated){if(kt(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(yr(e)));const o=t[s];for(const a of e){if(a===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(yr(a)));switch(n.kind){case"message":o.push(n.T.fromJson(a,i));break;case"enum":const l=v0(n.T,a,i.ignoreUnknownFields,!0);l!==Gp&&o.push(l);break;case"scalar":try{o.push(Hd(n.T,a,n.L,!0))}catch(c){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(yr(a));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(yr(e)));const o=t[s];for(const[a,l]of Object.entries(e)){if(l===null)throw new Error("cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=t$(n.K,a)}catch(u){let d="cannot decode map key for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(yr(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":o[c]=n.V.T.fromJson(l,i);break;case"enum":const u=v0(n.V.T,l,i.ignoreUnknownFields,!0);u!==Gp&&(o[c]=u);break;case"scalar":try{o[c]=Hd(n.V.T,l,qo.BIGINT,!0)}catch(d){let f="cannot decode map value for field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(yr(e));throw d instanceof Error&&d.message.length>0&&(f+=": ".concat(d.message)),new Error(f)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const o=n.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=t[s];es(a)?a.fromJson(e,i):(t[s]=a=o.fromJson(e,i),o.fieldWrapper&&!n.oneof&&(t[s]=o.fieldWrapper.unwrapField(a)));break;case"enum":const l=v0(n.T,e,i.ignoreUnknownFields,!1);switch(l){case ug:qR(n,t);break;case Gp:break;default:t[s]=l;break}break;case"scalar":try{const c=Hd(n.T,e,n.L,!1);switch(c){case ug:qR(n,t);break;default:t[s]=c;break}}catch(c){let u="cannot decode field ".concat(r.typeName,".").concat(n.name," from JSON: ").concat(yr(e));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}function t$(t,e){if(t===Q.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Hd(t,e,qo.BIGINT,!0).toString()}function Hd(t,e,n,i){if(e===null)return i?zc(t,n):ug;switch(t){case Q.DOUBLE:case Q.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const r=Number(e);if(Number.isNaN(r)||!Number.isFinite(r))break;return t==Q.FLOAT&&D2(r),r;case Q.INT32:case Q.FIXED32:case Q.SFIXED32:case Q.SINT32:case Q.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==Q.UINT32||t==Q.FIXED32?kb(s):zp(s),s;case Q.INT64:case Q.SFIXED64:case Q.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=_t.parse(e);return n?o.toString():o;case Q.FIXED64:case Q.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=_t.uParse(e);return n?a.toString():a;case Q.BOOL:if(typeof e!="boolean")break;return e;case Q.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case Q.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return B2.dec(e)}throw new Error}function v0(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:ug;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const r=t.findName(e);if(r!==void 0)return r.no;if(n)return Gp;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(yr(e)))}function n$(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function KR(t,e,n){if(t.kind=="map"){kt(typeof e=="object"&&e!=null);const i={},r=Object.entries(e);switch(t.V.kind){case"scalar":for(const[o,a]of r)i[o.toString()]=Kp(t.V.T,a);break;case"message":for(const[o,a]of r)i[o.toString()]=a.toJson(n);break;case"enum":const s=t.V.T;for(const[o,a]of r)i[o.toString()]=y0(s,a,n.enumAsInteger);break}return n.emitDefaultValues||r.length>0?i:void 0}if(t.repeated){kt(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let r=0;r<e.length;r++)i.push(Kp(t.T,e[r]));break;case"enum":for(let r=0;r<e.length;r++)i.push(y0(t.T,e[r],n.enumAsInteger));break;case"message":for(let r=0;r<e.length;r++)i.push(e[r].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Kp(t.T,e);case"enum":return y0(t.T,e,n.enumAsInteger);case"message":return G2(t.T,e).toJson(n)}}function y0(t,e,n){var i;if(kt(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const r=t.findNumber(e);return(i=r==null?void 0:r.name)!==null&&i!==void 0?i:e}function Kp(t,e){switch(t){case Q.INT32:case Q.SFIXED32:case Q.SINT32:case Q.FIXED32:case Q.UINT32:return kt(typeof e=="number"),e;case Q.FLOAT:case Q.DOUBLE:return kt(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case Q.STRING:return kt(typeof e=="string"),e;case Q.BOOL:return kt(typeof e=="boolean"),e;case Q.UINT64:case Q.FIXED64:case Q.INT64:case Q.SFIXED64:case Q.SINT64:return kt(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case Q.BYTES:return kt(e instanceof Uint8Array),B2.enc(e)}}const wl=Symbol("@bufbuild/protobuf/unknown-fields"),$R={readUnknownFields:!0,readerFactory:t=>new KK(t)},WR={writeUnknownFields:!0,writerFactory:()=>new GK};function i$(t){return t?Object.assign(Object.assign({},$R),t):$R}function r$(t){return t?Object.assign(Object.assign({},WR),t):WR}function s$(){return{makeReadOptions:i$,makeWriteOptions:r$,listUnknownFields(t){var e;return(e=t[wl])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[wl]},writeUnknownFields(t,e){const i=t[wl];if(i)for(const r of i)e.tag(r.no,r.wireType).raw(r.data)},onUnknownField(t,e,n,i){const r=t;Array.isArray(r[wl])||(r[wl]=[]),r[wl].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,r){const s=t.getType(),o=r?e.len:e.pos+n;let a,l;for(;e.pos<o&&([a,l]=e.tag(),!(r===!0&&l==xt.EndGroup));){const c=s.fields.find(a);if(!c){const u=e.skip(l,a);i.readUnknownFields&&this.onUnknownField(t,a,l,u);continue}QR(t,e,c,l,i)}if(r&&(l!=xt.EndGroup||a!==n))throw new Error("invalid end group tag")},readField:QR,writeMessage(t,e,n){const i=t.getType();for(const r of i.fields.byNumber()){if(!H2(r,t)){if(r.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(r.name," to binary: required field not set"));continue}const s=r.oneof?t[r.oneof.localName].value:t[r.localName];YR(r,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&YR(t,e,n,i)}}}function QR(t,e,n,i,r){let{repeated:s,localName:o}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=o&&delete t.value,t.case=o,o="value"),n.kind){case"scalar":case"enum":const a=n.kind=="enum"?Q.INT32:n.T;let l=dg;if(n.kind=="scalar"&&n.L>0&&(l=a$),s){let f=t[o];if(i==xt.LengthDelimited&&a!=Q.STRING&&a!=Q.BYTES){let v=e.uint32()+e.pos;for(;e.pos<v;)f.push(l(e,a))}else f.push(l(e,a))}else t[o]=l(e,a);break;case"message":const c=n.T;s?t[o].push($p(e,new c,r,n)):es(t[o])?$p(e,t[o],r,n):(t[o]=$p(e,new c,r,n),c.fieldWrapper&&!n.oneof&&!n.repeated&&(t[o]=c.fieldWrapper.unwrapField(t[o])));break;case"map":let[u,d]=o$(n,e,r);t[o][u]=d;break}}function $p(t,e,n,i){const r=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return r.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function o$(t,e,n){const i=e.uint32(),r=e.pos+i;let s,o;for(;e.pos<r;){const[a]=e.tag();switch(a){case 1:s=dg(e,t.K);break;case 2:switch(t.V.kind){case"scalar":o=dg(e,t.V.T);break;case"enum":o=e.int32();break;case"message":o=$p(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=zc(t.K,qo.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),o===void 0)switch(t.V.kind){case"scalar":o=zc(t.V.T,qo.BIGINT);break;case"enum":o=t.V.T.values[0].no;break;case"message":o=new t.V.T;break}return[s,o]}function a$(t,e){const n=dg(t,e);return typeof n=="bigint"?n.toString():n}function dg(t,e){switch(e){case Q.STRING:return t.string();case Q.BOOL:return t.bool();case Q.DOUBLE:return t.double();case Q.FLOAT:return t.float();case Q.INT32:return t.int32();case Q.INT64:return t.int64();case Q.UINT64:return t.uint64();case Q.FIXED64:return t.fixed64();case Q.BYTES:return t.bytes();case Q.FIXED32:return t.fixed32();case Q.SFIXED32:return t.sfixed32();case Q.SFIXED64:return t.sfixed64();case Q.SINT64:return t.sint64();case Q.UINT32:return t.uint32();case Q.SINT32:return t.sint32()}}function YR(t,e,n,i){kt(e!==void 0);const r=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?Q.INT32:t.T;if(r)if(kt(Array.isArray(e)),t.packed)c$(n,s,t.no,e);else for(const o of e)Gd(n,s,t.no,o);else Gd(n,s,t.no,e);break;case"message":if(r){kt(Array.isArray(e));for(const o of e)JR(n,i,t,o)}else JR(n,i,t,e);break;case"map":kt(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))l$(n,i,t,o,a);break}}function l$(t,e,n,i,r){t.tag(n.no,xt.LengthDelimited),t.fork();let s=i;switch(n.K){case Q.INT32:case Q.FIXED32:case Q.UINT32:case Q.SFIXED32:case Q.SINT32:s=Number.parseInt(i);break;case Q.BOOL:kt(i=="true"||i=="false"),s=i=="true";break}switch(Gd(t,n.K,1,s),n.V.kind){case"scalar":Gd(t,n.V.T,2,r);break;case"enum":Gd(t,Q.INT32,2,r);break;case"message":kt(r!==void 0),t.tag(2,xt.LengthDelimited).bytes(r.toBinary(e));break}t.join()}function JR(t,e,n,i){const r=G2(n.T,i);n.delimited?t.tag(n.no,xt.StartGroup).raw(r.toBinary(e)).tag(n.no,xt.EndGroup):t.tag(n.no,xt.LengthDelimited).bytes(r.toBinary(e))}function Gd(t,e,n,i){kt(i!==void 0);let[r,s]=K2(e);t.tag(n,r)[s](i)}function c$(t,e,n,i){if(!i.length)return;t.tag(n,xt.LengthDelimited).fork();let[,r]=K2(e);for(let s=0;s<i.length;s++)t[r](i[s]);t.join()}function K2(t){let e=xt.Varint;switch(t){case Q.BYTES:case Q.STRING:e=xt.LengthDelimited;break;case Q.DOUBLE:case Q.FIXED64:case Q.SFIXED64:e=xt.Bit64;break;case Q.FIXED32:case Q.SFIXED32:case Q.FLOAT:e=xt.Bit32;break}const n=Q[t].toLowerCase();return[e,n]}function u$(){return{setEnumType:N2,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const r=i.localName,s=e,o=t;if(o[r]!=null)switch(i.kind){case"oneof":const a=o[r].case;if(a===void 0)continue;const l=i.findField(a);let c=o[r].value;l&&l.kind=="message"&&!es(c,l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===Q.BYTES&&(c=td(c)),s[r]={case:a,value:c};break;case"scalar":case"enum":let u=o[r];i.T===Q.BYTES&&(u=i.repeated?u.map(td):td(u)),s[r]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===Q.BYTES)for(const[p,v]of Object.entries(o[r]))s[r][p]=td(v);else Object.assign(s[r],o[r]);break;case"message":const f=i.V.T;for(const p of Object.keys(o[r])){let v=o[r][p];f.fieldWrapper||(v=new f(v)),s[r][p]=v}break}break;case"message":const d=i.T;if(i.repeated)s[r]=o[r].map(f=>es(f,d)?f:new d(f));else{const f=o[r];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[r]=td(f):s[r]=f:s[r]=es(f,d)?f:new d(f)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const r=e[i.localName],s=n[i.localName];if(i.repeated){if(r.length!==s.length)return!1;switch(i.kind){case"message":return r.every((o,a)=>i.T.equals(o,s[a]));case"scalar":return r.every((o,a)=>zs(i.T,o,s[a]));case"enum":return r.every((o,a)=>zs(Q.INT32,o,s[a]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let o=r,a=s;return i.T.fieldWrapper&&(o!==void 0&&!es(o)&&(o=i.T.fieldWrapper.wrapField(o)),a!==void 0&&!es(a)&&(a=i.T.fieldWrapper.wrapField(a))),i.T.equals(o,a);case"enum":return zs(Q.INT32,r,s);case"scalar":return zs(i.T,r,s);case"oneof":if(r.case!==s.case)return!1;const l=i.findField(r.case);if(l===void 0)return!0;switch(l.kind){case"message":return l.T.equals(r.value,s.value);case"enum":return zs(Q.INT32,r.value,s.value);case"scalar":return zs(l.T,r.value,s.value)}throw new Error("oneof cannot contain ".concat(l.kind));case"map":const c=Object.keys(r).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return c.every(f=>u.equals(r[f],s[f]));case"enum":return c.every(f=>zs(Q.INT32,r[f],s[f]));case"scalar":const d=i.V.T;return c.every(f=>zs(d,r[f],s[f]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const r of e.fields.byMember()){const s=t[r.localName];let o;if(r.repeated)o=s.map(up);else if(r.kind=="map"){o=i[r.localName];for(const[a,l]of Object.entries(s))o[a]=up(l)}else r.kind=="oneof"?o=r.findField(s.case)?{case:s.case,value:up(s.value)}:{case:void 0}:o=up(s);i[r.localName]=o}for(const r of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,r.no,r.wireType,r.data);return n}}}function up(t){if(t===void 0)return t;if(es(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function td(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function d$(t,e,n){return{syntax:t,json:e$(),bin:s$(),util:Object.assign(Object.assign({},u$()),{newFieldList:e,initFields:n}),makeMessageType(i,r,s){return FK(this,i,r,s)},makeEnum:VK,makeEnumType:M2,getEnumType:UK,makeExtension(i,r,s){return $K(this,i,r,s)}}}class h${constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function $2(t,e){const n=W2(t);return e?n:y$(v$(n))}function f$(t){return $2(t,!1)}const p$=W2;function W2(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let r=t.charAt(i);switch(r){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(r),e=!1;break;default:e&&(e=!1,r=r.toUpperCase()),n.push(r);break}}return n.join("")}const m$=new Set(["constructor","toString","toJSON","valueOf"]),g$=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Q2=t=>"".concat(t,"$"),v$=t=>g$.has(t)?Q2(t):t,y$=t=>m$.has(t)?Q2(t):t;class _${constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=f$(e)}addField(e){kt(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function b$(t,e){var n,i,r,s,o,a;const l=[];let c;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=$2(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:p$(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(r=u.L)!==null&&r!==void 0?r:qo.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(o=u.req)!==null&&o!==void 0?o:!1,d.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=Q.BYTES&&u.T!=Q.STRING),u.oneof!==void 0){const f=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!c||c.name!=f)&&(c=new _$(f)),d.oneof=c,c.addField(d)}l.push(d)}return l}const L=d$("proto3",t=>new h$(t,e=>b$(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=zc(e.T,e.L);break}}});class ti extends UE{constructor(e){super(),this.seconds=_t.zero,this.nanos=0,L.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(L.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const r=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(r))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=_t.parse(r/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const r=(this.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?i="."+r.substring(0,3)+"Z":r.substring(6)==="000"?i="."+r.substring(0,6)+"Z":i="."+r+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return ti.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new ti({seconds:_t.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new ti().fromBinary(e,n)}static fromJson(e,n){return new ti().fromJson(e,n)}static fromJsonString(e,n){return new ti().fromJsonString(e,n)}static equals(e,n){return L.util.equals(ti,e,n)}}ti.runtime=L;ti.typeName="google.protobuf.Timestamp";ti.fields=L.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const T$=L.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ti},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:S$,repeated:!0},{no:5,name:"events",kind:"message",T:C$,repeated:!0}]),S$=L.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:E$,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),E$=L.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:ti},{no:3,name:"value",kind:"scalar",T:2}]),C$=L.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:ti},{no:7,name:"normalized_end_timestamp",kind:"message",T:ti,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),Y2=L.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Zi=L.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Ut=L.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),FE=L.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),yd=L.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),Ah=L.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),sr=L.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),ba=L.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),k$=L.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),un=L.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),Av=L.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:hg,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:cL}]),hg=L.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),w$=L.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:L.getEnumType(Ut),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Qa=L.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:L.getEnumType(uc)},{no:4,name:"tracks",kind:"message",T:Wl,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:w$},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:L.getEnumType(Ih)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:L.getEnumType(sr)},{no:18,name:"kind_details",kind:"enum",T:L.getEnumType(R$),repeated:!0},{no:19,name:"data_tracks",kind:"message",T:jE,repeated:!0}]),uc=L.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Ih=L.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"},{no:8,name:"BRIDGE"}]),R$=L.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"},{no:2,name:"CONNECTOR_WHATSAPP"},{no:3,name:"CONNECTOR_TWILIO"},{no:4,name:"BRIDGE_RTSP"}]),Dt=L.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),A$=L.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Ro,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:L.getEnumType(J2)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Wl=L.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:L.getEnumType(Zi)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:L.getEnumType(Ut)},{no:10,name:"layers",kind:"message",T:Ro,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:A$,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:L.getEnumType(Dt)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:cL},{no:19,name:"audio_features",kind:"enum",T:L.getEnumType(un),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:L.getEnumType(Y2)}]),jE=L.makeMessageType("livekit.DataTrackInfo",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"sid",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"encryption",kind:"enum",T:L.getEnumType(Dt)}]),I$=L.makeMessageType("livekit.DataTrackSubscriptionOptions",()=>[{no:1,name:"target_fps",kind:"scalar",T:13,opt:!0}]),Ro=L.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:L.getEnumType(FE)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9},{no:8,name:"repair_ssrc",kind:"scalar",T:13}]),J2=L.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),zn=L.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:L.getEnumType(ke)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:BE,oneof:"value"},{no:3,name:"speaker",kind:"message",T:P$,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:tL,oneof:"value"},{no:7,name:"transcription",kind:"message",T:x$,oneof:"value"},{no:8,name:"metrics",kind:"message",T:T$,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:fg,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:qE,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:zE,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:HE,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:pg,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:mg,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:gg,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:X2,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),ke=L.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),X2=L.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:L.getEnumType(Dt)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),Z2=L.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:BE,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:fg,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:qE,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:zE,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:HE,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:pg,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:mg,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:gg,oneof:"value"}]),P$=L.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:eL,repeated:!0}]),eL=L.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),BE=L.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),tL=L.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),x$=L.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:D$,repeated:!0}]),D$=L.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),fg=L.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),qE=L.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),zE=L.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),HE=L.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:nL,oneof:"value"}]),nL=L.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),iL=L.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),rL=L.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:L.getEnumType(sL)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),sL=L.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),oL=L.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:L.getEnumType(aL)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),aL=L.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),lL=L.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:XR},{no:2,name:"screen",kind:"message",T:XR},{no:3,name:"resume_connection",kind:"enum",T:L.getEnumType(Ah)},{no:4,name:"disabled_codecs",kind:"message",T:O$},{no:5,name:"force_relay",kind:"enum",T:L.getEnumType(Ah)}]),XR=L.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:L.getEnumType(Ah)}]),O$=L.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:hg,repeated:!0},{no:2,name:"publish",kind:"message",T:hg,repeated:!0}]),cL=L.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),wb=L.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),uL=L.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:L.getEnumType(wb)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),dL=L.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),pg=L.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:L.getEnumType(Dt)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:uL,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:dL,oneof:"content_header"}],{localName:"DataStream_Header"}),mg=L.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),gg=L.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),N$=L.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),er=L.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Rb=L.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),M$=L.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),L$=L.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:zo,oneof:"message"},{no:2,name:"answer",kind:"message",T:zo,oneof:"message"},{no:3,name:"trickle",kind:"message",T:Iv,oneof:"message"},{no:4,name:"add_track",kind:"message",T:Ph,oneof:"message"},{no:5,name:"mute",kind:"message",T:Pv,oneof:"message"},{no:6,name:"subscription",kind:"message",T:xv,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:mL,oneof:"message"},{no:8,name:"leave",kind:"message",T:Dv,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:vL,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:bL,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:QE,oneof:"message"},{no:13,name:"simulate",kind:"message",T:gr,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:$E,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:EL,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:KE,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:gL,oneof:"message"},{no:19,name:"publish_data_track_request",kind:"message",T:hL,oneof:"message"},{no:20,name:"unpublish_data_track_request",kind:"message",T:pL,oneof:"message"},{no:21,name:"update_data_subscription",kind:"message",T:H$,oneof:"message"}]),ZR=L.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:j$,oneof:"message"},{no:2,name:"answer",kind:"message",T:zo,oneof:"message"},{no:3,name:"offer",kind:"message",T:zo,oneof:"message"},{no:4,name:"trickle",kind:"message",T:Iv,oneof:"message"},{no:5,name:"update",kind:"message",T:z$,oneof:"message"},{no:6,name:"track_published",kind:"message",T:GE,oneof:"message"},{no:8,name:"leave",kind:"message",T:Dv,oneof:"message"},{no:9,name:"mute",kind:"message",T:Pv,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:K$,oneof:"message"},{no:11,name:"room_update",kind:"message",T:$$,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:Q$,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:J$,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:Z$,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:tW,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:q$,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:B$,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:iW,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:oW,oneof:"message"},{no:22,name:"request_response",kind:"message",T:aW,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:lW,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:nW,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:hW,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:eW,oneof:"message"},{no:27,name:"publish_data_track_response",kind:"message",T:fL,oneof:"message"},{no:28,name:"unpublish_data_track_response",kind:"message",T:U$,oneof:"message"},{no:29,name:"data_track_subscriber_handles",kind:"message",T:V$,oneof:"message"}]),Ab=L.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:Ro,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:L.getEnumType(J2)}]),Ph=L.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:L.getEnumType(Zi)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:L.getEnumType(Ut)},{no:9,name:"layers",kind:"message",T:Ro,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Ab,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:L.getEnumType(Dt)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:L.getEnumType(Y2)},{no:17,name:"audio_features",kind:"enum",T:L.getEnumType(un),repeated:!0}]),hL=L.makeMessageType("livekit.PublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"encryption",kind:"enum",T:L.getEnumType(Dt)}]),fL=L.makeMessageType("livekit.PublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:jE}]),pL=L.makeMessageType("livekit.UnpublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13}]),U$=L.makeMessageType("livekit.UnpublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:jE}]),V$=L.makeMessageType("livekit.DataTrackSubscriberHandles",()=>[{no:1,name:"sub_handles",kind:"map",K:13,V:{kind:"message",T:F$}}]),F$=L.makeMessageType("livekit.DataTrackSubscriberHandles.PublishedDataTrack",()=>[{no:1,name:"publisher_identity",kind:"scalar",T:9},{no:2,name:"publisher_sid",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9}],{localName:"DataTrackSubscriberHandles_PublishedDataTrack"}),Iv=L.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:L.getEnumType(er)},{no:3,name:"final",kind:"scalar",T:8}]),Pv=L.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),j$=L.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:Av},{no:2,name:"participant",kind:"message",T:Qa},{no:3,name:"other_participants",kind:"message",T:Qa,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:yL,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:lL},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:rL},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:hg,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),B$=L.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:yL,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:lL},{no:3,name:"server_info",kind:"message",T:rL},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),GE=L.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Wl}]),q$=L.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),zo=L.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),z$=L.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Qa,repeated:!0}]),xv=L.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:iL,repeated:!0}]),H$=L.makeMessageType("livekit.UpdateDataSubscription",()=>[{no:1,name:"updates",kind:"message",T:G$,repeated:!0}]),G$=L.makeMessageType("livekit.UpdateDataSubscription.Update",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"options",kind:"message",T:I$}],{localName:"UpdateDataSubscription_Update"}),mL=L.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:L.getEnumType(FE)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),KE=L.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:L.getEnumType(un),repeated:!0}]),gL=L.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),Dv=L.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:L.getEnumType(sr)},{no:3,name:"action",kind:"enum",T:L.getEnumType(dc)},{no:4,name:"regions",kind:"message",T:rW}]),dc=L.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),vL=L.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:Ro,repeated:!0}]),$E=L.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),yL=L.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),K$=L.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:eL,repeated:!0}]),$$=L.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:Av}]),W$=L.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:L.getEnumType(yd)},{no:3,name:"score",kind:"scalar",T:2}]),Q$=L.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:W$,repeated:!0}]),Y$=L.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:L.getEnumType(Rb)}]),J$=L.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:Y$,repeated:!0}]),WE=L.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:L.getEnumType(FE)},{no:2,name:"enabled",kind:"scalar",T:8}]),X$=L.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:WE,repeated:!0}]),Z$=L.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:WE,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:X$,repeated:!0}]),eW=L.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:N$,repeated:!0}]),_L=L.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),bL=L.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:_L,repeated:!0}]),tW=L.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),nW=L.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:Av},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Qa},{no:4,name:"other_participants",kind:"message",T:Qa,repeated:!0}]),QE=L.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:zo},{no:2,name:"subscription",kind:"message",T:xv},{no:3,name:"publish_tracks",kind:"message",T:GE,repeated:!0},{no:4,name:"data_channels",kind:"message",T:SL,repeated:!0},{no:5,name:"offer",kind:"message",T:zo},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:TL,repeated:!0},{no:8,name:"publish_data_tracks",kind:"message",T:fL,repeated:!0}]),TL=L.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),SL=L.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:L.getEnumType(er)}]),gr=L.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:L.getEnumType(M$),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),EL=L.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),iW=L.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),rW=L.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:sW,repeated:!0}]),sW=L.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),oW=L.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:L.getEnumType(k$)}]),aW=L.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:L.getEnumType(YE)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:Iv,oneof:"request"},{no:5,name:"add_track",kind:"message",T:Ph,oneof:"request"},{no:6,name:"mute",kind:"message",T:Pv,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:$E,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:KE,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:gL,oneof:"request"},{no:10,name:"publish_data_track",kind:"message",T:hL,oneof:"request"},{no:11,name:"unpublish_data_track",kind:"message",T:pL,oneof:"request"}]),YE=L.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"},{no:7,name:"INVALID_HANDLE"},{no:8,name:"INVALID_NAME"},{no:9,name:"DUPLICATE_HANDLE"},{no:10,name:"DUPLICATE_NAME"}]),lW=L.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),CL=L.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8},{no:5,name:"auto_subscribe_data_track",kind:"scalar",T:8,opt:!0}]),cW=L.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:oL},{no:2,name:"connection_settings",kind:"message",T:CL},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:Ph,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:zo},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:L.getEnumType(ba)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:QE}]),uW=L.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:L.getEnumType(dW)},{no:2,name:"join_request",kind:"scalar",T:12}]),dW=L.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),hW=L.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function fW(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Wp={exports:{}},pW=Wp.exports,eA;function mW(){return eA||(eA=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(pW,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(g,E){var y=g[E];if(typeof y.bind=="function")return y.bind(g);try{return Function.prototype.bind.call(y,g)}catch{return function(){return Function.prototype.apply.apply(y,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&i?l:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),E=0;E<r.length;E++){var y=r[E];this[y]=E<g?e:this.methodFactory(y,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function d(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function f(g,E,y){return c(g)||d.apply(this,arguments)}function p(g,E){var y=this,T,R,b,w="loglevel";typeof g=="string"?w+=":"+g:typeof g=="symbol"&&(w=void 0);function D(I){var N=(r[I]||"silent").toUpperCase();if(!(typeof window===n||!w)){try{window.localStorage[w]=N;return}catch{}try{window.document.cookie=encodeURIComponent(w)+"="+N+";"}catch{}}}function C(){var I;if(!(typeof window===n||!w)){try{I=window.localStorage[w]}catch{}if(typeof I===n)try{var N=window.document.cookie,O=encodeURIComponent(w),he=N.indexOf(O+"=");he!==-1&&(I=/^([^;]+)/.exec(N.slice(he+O.length+1))[1])}catch{}return y.levels[I]===void 0&&(I=void 0),I}}function k(){if(!(typeof window===n||!w)){try{window.localStorage.removeItem(w)}catch{}try{window.document.cookie=encodeURIComponent(w)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function S(I){var N=I;if(typeof N=="string"&&y.levels[N.toUpperCase()]!==void 0&&(N=y.levels[N.toUpperCase()]),typeof N=="number"&&N>=0&&N<=y.levels.SILENT)return N;throw new TypeError("log.setLevel() called with invalid level: "+I)}y.name=g,y.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},y.methodFactory=E||f,y.getLevel=function(){return b??R??T},y.setLevel=function(I,N){return b=S(I),N!==!1&&D(b),u.call(y)},y.setDefaultLevel=function(I){R=S(I),C()||y.setLevel(I,!1)},y.resetLevel=function(){b=null,k(),u.call(y)},y.enableAll=function(I){y.setLevel(y.levels.TRACE,I)},y.disableAll=function(I){y.setLevel(y.levels.SILENT,I)},y.rebuild=function(){if(o!==y&&(T=S(o.getLevel())),u.call(y),o===y)for(var I in s)s[I].rebuild()},T=S(o?o.getLevel():"WARN");var A=C();A!=null&&(b=S(A)),u.call(y)}o=new p,o.getLogger=function(E){if(typeof E!="symbol"&&typeof E!="string"||E==="")throw new TypeError("You must supply a name when creating a logger.");var y=s[E];return y||(y=s[E]=new p(E,o.methodFactory)),y};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(Wp)),Wp.exports}var Ov=mW(),Ib;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Ib||(Ib={}));var cr;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(cr||(cr={}));let Ee=Ov.getLogger("livekit");Object.values(cr).map(t=>Ov.getLogger(t));Ee.setDefaultLevel(Ib.info);function ws(t){const e=Ov.getLogger(t);return e.setDefaultLevel(Ee.getLevel()),e}const gW=Ov.getLogger("lk-e2ee"),nd=7e3,vW=[0,300,2*2*300,3*3*300,4*4*300,nd,nd,nd,nd,nd];class yW{constructor(e){this._retryDelays=e!==void 0?[...e]:vW}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function _W(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n}function M(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}function tA(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ts(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof tA=="function"?tA(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),r(a,l,o.done,o.value)})}}function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}var dp={exports:{}},nA;function bW(){if(nA)return dp.exports;nA=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(w,D,C){return Function.prototype.apply.call(w,D,C)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:n=function(w){return Object.getOwnPropertyNames(w)};function i(b){console&&console.warn&&console.warn(b)}var r=Number.isNaN||function(w){return w!==w};function s(){s.init.call(this)}dp.exports=s,dp.exports.once=y,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(w){if(typeof w!="number"||w<0||r(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this};function l(b){return b._maxListeners===void 0?s.defaultMaxListeners:b._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(w){for(var D=[],C=1;C<arguments.length;C++)D.push(arguments[C]);var k=w==="error",S=this._events;if(S!==void 0)k=k&&S.error===void 0;else if(!k)return!1;if(k){var A;if(D.length>0&&(A=D[0]),A instanceof Error)throw A;var I=new Error("Unhandled error."+(A?" ("+A.message+")":""));throw I.context=A,I}var N=S[w];if(N===void 0)return!1;if(typeof N=="function")e(N,this,D);else for(var O=N.length,he=v(N,O),C=0;C<O;++C)e(he[C],this,D);return!0};function c(b,w,D,C){var k,S,A;if(a(D),S=b._events,S===void 0?(S=b._events=Object.create(null),b._eventsCount=0):(S.newListener!==void 0&&(b.emit("newListener",w,D.listener?D.listener:D),S=b._events),A=S[w]),A===void 0)A=S[w]=D,++b._eventsCount;else if(typeof A=="function"?A=S[w]=C?[D,A]:[A,D]:C?A.unshift(D):A.push(D),k=l(b),k>0&&A.length>k&&!A.warned){A.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=b,I.type=w,I.count=A.length,i(I)}return b}s.prototype.addListener=function(w,D){return c(this,w,D,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(w,D){return c(this,w,D,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(b,w,D){var C={fired:!1,wrapFn:void 0,target:b,type:w,listener:D},k=u.bind(C);return k.listener=D,C.wrapFn=k,k}s.prototype.once=function(w,D){return a(D),this.on(w,d(this,w,D)),this},s.prototype.prependOnceListener=function(w,D){return a(D),this.prependListener(w,d(this,w,D)),this},s.prototype.removeListener=function(w,D){var C,k,S,A,I;if(a(D),k=this._events,k===void 0)return this;if(C=k[w],C===void 0)return this;if(C===D||C.listener===D)--this._eventsCount===0?this._events=Object.create(null):(delete k[w],k.removeListener&&this.emit("removeListener",w,C.listener||D));else if(typeof C!="function"){for(S=-1,A=C.length-1;A>=0;A--)if(C[A]===D||C[A].listener===D){I=C[A].listener,S=A;break}if(S<0)return this;S===0?C.shift():g(C,S),C.length===1&&(k[w]=C[0]),k.removeListener!==void 0&&this.emit("removeListener",w,I||D)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(w){var D,C,k;if(C=this._events,C===void 0)return this;if(C.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):C[w]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete C[w]),this;if(arguments.length===0){var S=Object.keys(C),A;for(k=0;k<S.length;++k)A=S[k],A!=="removeListener"&&this.removeAllListeners(A);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(D=C[w],typeof D=="function")this.removeListener(w,D);else if(D!==void 0)for(k=D.length-1;k>=0;k--)this.removeListener(w,D[k]);return this};function f(b,w,D){var C=b._events;if(C===void 0)return[];var k=C[w];return k===void 0?[]:typeof k=="function"?D?[k.listener||k]:[k]:D?E(k):v(k,k.length)}s.prototype.listeners=function(w){return f(this,w,!0)},s.prototype.rawListeners=function(w){return f(this,w,!1)},s.listenerCount=function(b,w){return typeof b.listenerCount=="function"?b.listenerCount(w):p.call(b,w)},s.prototype.listenerCount=p;function p(b){var w=this._events;if(w!==void 0){var D=w[b];if(typeof D=="function")return 1;if(D!==void 0)return D.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(b,w){for(var D=new Array(w),C=0;C<w;++C)D[C]=b[C];return D}function g(b,w){for(;w+1<b.length;w++)b[w]=b[w+1];b.pop()}function E(b){for(var w=new Array(b.length),D=0;D<w.length;++D)w[D]=b[D].listener||b[D];return w}function y(b,w){return new Promise(function(D,C){function k(A){b.removeListener(w,S),C(A)}function S(){typeof b.removeListener=="function"&&b.removeListener("error",k),D([].slice.call(arguments))}R(b,w,S,{once:!0}),w!=="error"&&T(b,k,{once:!0})})}function T(b,w,D){typeof b.on=="function"&&R(b,"error",w,D)}function R(b,w,D,C){if(typeof b.on=="function")C.once?b.once(w,D):b.on(w,D);else if(typeof b.addEventListener=="function")b.addEventListener(w,function k(S){C.once&&b.removeEventListener(w,k),D(S)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return dp.exports}var Ur=bW();let kL=!0,wL=!0;function _d(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function hl(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(o,a){if(o!==e)return r.apply(this,arguments);const l=c=>{const u=n(c);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,l),r.apply(this,[o,l])};const s=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const l=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function TW(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(kL=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function SW(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(wL=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function RL(){if(typeof window=="object"){if(kL)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function JE(t,e){wL&&console.warn(t+" is deprecated, please use "+e+" instead.")}function EW(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(r=>r.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(_d(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(_d(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(_d(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=_d(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function iA(t){return Object.prototype.toString.call(t)==="[object Object]"}function AL(t){return iA(t)?Object.keys(t).reduce(function(e,n){const i=iA(t[n]),r=i?AL(t[n]):t[n],s=i&&!Object.keys(r).length;return r===void 0||s?e:Object.assign(e,{[n]:r})},{}):t}function Pb(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Pb(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(r=>{Pb(t,t.get(r),n)})}))}function rA(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===i&&a.trackId===o.id&&Pb(t,a,r)})}),r}const sA=RL;function IL(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const l={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof a[c]=="object"?a[c]:{ideal:a[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(u.ideal!==void 0){l.optional=l.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",c)]=u.ideal,l.optional.push(f),f={},f[d("max",c)]=u.ideal,l.optional.push(f)):(f[d("",c)]=u.ideal,l.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(f,c)]=u[f])})}),a.advanced&&(l.optional=(l.optional||[]).concat(a.advanced)),l},r=function(a,l){if(e.version>=61)return l(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(v=>v.kind==="videoinput");let p=f.find(v=>d.some(g=>v.label.toLowerCase().includes(g)));return!p&&f.length&&d.includes("back")&&(p=f[f.length-1]),p&&(a.video.deviceId=c.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),sA("chrome: "+JSON.stringify(a)),l(a)})}a.video=i(a.video)}return sA("chrome: "+JSON.stringify(a)),l(a)},s=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,l,c){r(a,u=>{n.webkitGetUserMedia(u,l,d=>{c&&c(s(d))})})};if(n.getUserMedia=o.bind(n),n.mediaDevices.getUserMedia){const a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return r(l,c=>a(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function PL(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function xL(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.track.id):s={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(r=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(a=>a.track&&a.track.id===r.id):s={track:r};const o=new Event("track");o.track=r,o.receiver=s,o.transceiver={receiver:s},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else hl(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function DL(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=r.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(a,l){let c=r.apply(this,arguments);return c||(c=e(this,a),this._senders.push(c)),c};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(a){s.apply(this,arguments);const l=this._senders.indexOf(a);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(o=>{const a=this._senders.find(l=>l.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function OL(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(o=>o._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>rA(o,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r}),hl(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>rA(s,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let r,s,o;return this.getSenders().forEach(a=>{a.track===i&&(r?o=!0:r=a)}),this.getReceivers().forEach(a=>(a.track===i&&(s?o=!0:s=a),a.track===i)),o||r&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function NL(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(l)===-1&&this._shimmedLocalStreams[a.id].push(l):this._shimmedLocalStreams[a.id]=[a,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const l=this._shimmedLocalStreams[a].indexOf(o);l!==-1&&this._shimmedLocalStreams[a].splice(l,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),r.apply(this,arguments)}}function ML(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return NL(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(p=>p.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[d.id];if(v)v.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[d.id]=g,this._reverseStreams[g.id]=d,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function s(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const p=c._reverseStreams[f],v=c._streams[p.id];d=d.replace(new RegExp(v.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const p=c._reverseStreams[f],v=c._streams[p.id];d=d.replace(new RegExp(p.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],d={[c](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[v=>{const g=s(this,v);f[0].apply(null,[g])},v=>{f[1]&&f[1].apply(null,v)},arguments[2]]):u.apply(this,arguments).then(v=>s(this,v))}};t.RTCPeerConnection.prototype[c]=d[c]});const a=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(g=>u.track===g)&&(f=this._streams[p])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function xb(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],r={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=r[n]})}function LL(t,e){hl(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var oA=Object.freeze({__proto__:null,fixNegotiationNeeded:LL,shimAddTrackRemoveTrack:ML,shimAddTrackRemoveTrackWithNative:NL,shimGetSendersWithDtmf:DL,shimGetUserMedia:IL,shimMediaStream:PL,shimOnTrack:xL,shimPeerConnection:xb,shimSenderReceiverGetStats:OL});function UL(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(r,s,o){JE("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(r).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const r=function(o,a,l){a in o&&!(l in o)&&(o[l]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return r(a,"mozAutoGainControl","autoGainControl"),r(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),r(a,"autoGainControl","mozAutoGainControl"),r(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function CW(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function VL(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Db(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const s=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,o,a]=arguments;return i.apply(this,[s||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return l}).then(o,a)}}function FL(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function jL(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(r=>r._pc=this),i}),hl(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function BL(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){JE("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function qL(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function zL(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const r=i.length>0;r&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(r){const{sender:o}=s,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return s})}function HL(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function GL(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function KL(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var aA=Object.freeze({__proto__:null,shimAddTransceiver:zL,shimCreateAnswer:KL,shimCreateOffer:GL,shimGetDisplayMedia:CW,shimGetParameters:HL,shimGetUserMedia:UL,shimOnTrack:VL,shimPeerConnection:Db,shimRTCDataChannel:qL,shimReceiverGetStats:jL,shimRemoveStream:BL,shimSenderGetStats:FL});function $L(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(r=>e.call(this,r,i)),i.getVideoTracks().forEach(r=>e.call(this,r,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s&&s.forEach(a=>{this._localStreams?this._localStreams.includes(a)||this._localStreams.push(a):this._localStreams=[a]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const r=n.getTracks();this.getSenders().forEach(s=>{r.includes(s.track)&&this.removeTrack(s)})})}}function WL(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,i.dispatchEvent(o)})}),e.apply(i,arguments)}}}function QL(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[d]);return u?(f.then(c,u),Promise.resolve()):f},e.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return u?(f.then(c,u),Promise.resolve()):f};let a=function(l,c,u){const d=r.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(l,c,u){const d=o.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.addIceCandidate=a}function YL(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=r=>i(JL(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,r,s){e.mediaDevices.getUserMedia(i).then(r,s)}).bind(e))}function JL(t){return t&&t.video!==void 0?Object.assign({},t,{video:AL(t.video)}):t}function XL(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,r){if(i&&i.iceServers){const s=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(JE("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,s.push(a)):s.push(i.iceServers[o])}i.iceServers=s}return new e(i,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function ZL(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function e3(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function t3(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var lA=Object.freeze({__proto__:null,shimAudioContext:t3,shimCallbacksAPI:QL,shimConstraints:JL,shimCreateOfferLegacy:e3,shimGetUserMedia:YL,shimLocalStreamsAPI:$L,shimRTCIceServerUrls:XL,shimRemoteStreamsAPI:WL,shimTrackEventTransceiver:ZL}),_0={exports:{}},cA;function kW(){return cA||(cA=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,s)=>(s>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(r=>r.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const r={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":r.relatedAddress=i[s+1];break;case"rport":r.relatedPort=parseInt(i[s+1],10);break;case"tcptype":r.tcpType=i[s+1];break;case"ufrag":r.ufrag=i[s+1],r.usernameFragment=i[s+1];break;default:r[i[s]]===void 0&&(r[i[s]]=i[s+1]);break}return r},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const r=n.component;r==="rtp"?i.push(1):r==="rtcp"?i.push(2):i.push(r),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const r={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),r.name=i[0],r.clockRate=parseInt(i[1],10),r.channels=i.length===3?parseInt(i[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const r=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let r;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)r=s[o].trim().split("="),i[r[0].trim()]=r[1];return i},e.writeFmtp=function(n){let i="",r=n.payloadType;if(n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),i+="a=fmtp:"+r+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",r=n.payloadType;return n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+r+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),r={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(r.attribute=n.substring(i+1,s),r.value=n.substring(s+1)):r.attribute=n.substring(i+1),r},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(r=>parseInt(r,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let r="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{r+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),r},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const r=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let a=3;a<s.length;a++){const l=s[a],c=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(c){const u=e.parseRtpMap(c),d=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(a=>{i.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(l=>{a.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||a.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let r="";r+="m="+n+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let s=0;return i.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(r+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(n){const i=[],r=e.parseRtpParameters(n),s=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),l=a.length>0&&a[0].ssrc;let c;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(v=>parseInt(v,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),r.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let p={ssrc:l,codecPayloadType:parseInt(f.parameters.apt,10)};l&&c&&(p.rtx={ssrc:c}),i.push(p),s&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&l&&i.push({ssrc:l});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(f=>{f.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},r=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return i.mux=o.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const r=e.matchPrefix(n,"a=msid:");if(r.length===1)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),r=e.matchPrefix(n,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const l=a[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let r=[];return n.protocol!=="DTLS/SCTP"?r=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:r=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&r.push("a=max-message-size:"+i.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,r){let s;const o=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const r=e.splitLines(n);for(let s=0;s<r.length;s++)switch(r[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let r=0;r<i.length;r++)if(i[r].length<2||i[r].charAt(1)!=="=")return!1;return!0},t.exports=e}(_0)),_0.exports}var n3=kW(),hc=fW(n3),wW=IK({__proto__:null,default:hc},[n3]);function Qp(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const r=new e(i),s=hc.parseCandidate(i.candidate);for(const o in s)o in r||Object.defineProperty(r,o,{value:s[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,hl(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Ob(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||hl(t,"icecandidate",e=>{if(e.candidate){const n=hc.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Yp(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const l=hc.splitSections(a.sdp);return l.shift(),l.some(c=>{const u=hc.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(a){const l=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},r=function(a){let l=65536;return e.browser==="firefox"&&(e.version<57?a===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},s=function(a,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=hc.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),c=r(l),u=s(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return o.apply(this,arguments)}}function Jp(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,r){const s=i.send;i.send=function(){const a=arguments[0],l=a.length||a.size||a.byteLength;if(i.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},hl(t,"datachannel",i=>(e(i.channel,i.target),i))}function Nb(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const s=r.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",r);s.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Mb(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:s}):r.sdp=s}return n.apply(this,arguments)}}function Xp(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Zp(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>n.apply(this,[o]))})}var RW=Object.freeze({__proto__:null,removeExtmapAllowMixed:Mb,shimAddIceCandidateNullOrEmpty:Xp,shimConnectionState:Nb,shimMaxMessageSize:Yp,shimParameterlessSetLocalDescription:Zp,shimRTCIceCandidate:Qp,shimRTCIceCandidateRelayProtocol:Ob,shimSendThrowTypeError:Jp});function AW(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=RL,i=EW(t),r={browserDetails:i,commonShim:RW,extractVersion:_d,disableLog:TW,disableWarnings:SW,sdp:wW};switch(i.browser){case"chrome":if(!oA||!xb||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),r;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),r;n("adapter.js shimming chrome."),r.browserShim=oA,Xp(t,i),Zp(t),IL(t,i),PL(t),xb(t,i),xL(t),ML(t,i),DL(t),OL(t),LL(t,i),Qp(t),Ob(t),Nb(t),Yp(t,i),Jp(t),Mb(t,i);break;case"firefox":if(!aA||!Db||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),r;n("adapter.js shimming firefox."),r.browserShim=aA,Xp(t,i),Zp(t),UL(t,i),Db(t,i),VL(t),BL(t),FL(t),jL(t),qL(t),zL(t),HL(t),GL(t),KL(t),Qp(t),Nb(t),Yp(t,i),Jp(t);break;case"safari":if(!lA||!e.shimSafari)return n("Safari shim is not included in this adapter release."),r;n("adapter.js shimming safari."),r.browserShim=lA,Xp(t,i),Zp(t),XL(t),e3(t),QL(t),$L(t),WL(t),ZL(t),YL(t),t3(t),Qp(t),Ob(t),Yp(t,i),Jp(t),Mb(t,i);break;default:n("Unsupported browser!");break}return r}AW({window:typeof window>"u"?void 0:window});var Lb,i3;class Fn extends(i3=Promise){constructor(e){super(e)}catch(e){return super.catch(e)}static reject(e){return super.reject(e)}static all(e){return super.all(e)}static race(e){return super.race(e)}}Lb=Fn;Fn.resolve=t=>Reflect.get(i3,"resolve",Lb).call(Lb,t);const IW=/version\/(\d+(\.?_?\d+)+)/i;let b0;function Kn(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(b0===void 0||e){const i=PW.find(r=>{let{test:s}=r;return s.test(n)});b0=i==null?void 0:i.describe(n)}return b0}const PW=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:em(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:T0(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:em(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:T0(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:em(IW,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:T0(t)}}}];function em(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function T0(t){return t.includes("mac os")?em(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var xW="2.17.1";const DW=xW,OW=16;class Jo extends Error{constructor(e,n,i){super(n||"an error has occurred"),this.name="LiveKitError",this.code=e,typeof(i==null?void 0:i.cause)<"u"&&(this.cause=i==null?void 0:i.cause)}}class XE extends Jo{}var st;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket",t[t.ServiceNotFound=7]="ServiceNotFound"})(st||(st={}));class de extends XE{constructor(e,n,i,r){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=r,this.reasonName=st[n]}static notAllowed(e,n,i){return new de(e,st.NotAllowed,n,i)}static timeout(e){return new de(e,st.Timeout)}static leaveRequest(e,n){return new de(e,st.LeaveRequest,void 0,n)}static internal(e,n){return new de(e,st.InternalError,void 0,n)}static cancelled(e){return new de(e,st.Cancelled)}static serverUnreachable(e,n){return new de(e,st.ServerUnreachable,n)}static websocket(e,n,i){return new de(e,st.WebSocket,n,i)}static serviceNotFound(e,n){return new de(e,st.ServiceNotFound,void 0,n)}}class ZE extends Jo{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class ns extends Jo{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class NW extends Jo{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class At extends Jo{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class fc extends Jo{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class uA extends Jo{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class dA extends XE{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:YE[n]}}var qn;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(qn||(qn={}));class Pi extends XE{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=qn[n]}}class Rl extends Jo{constructor(e){super(18,e),this.name="SignalReconnectError"}}var xh;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(xh||(xh={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(xh||(xh={}));class wn{}wn.setTimeout=function(){return setTimeout(...arguments)};wn.setInterval=function(){return setInterval(...arguments)};wn.clearTimeout=function(){return clearTimeout(...arguments)};wn.clearInterval=function(){return clearInterval(...arguments)};var H;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(H||(H={}));var $;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})($||($={}));var te;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(te||(te={}));var X;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(X||(X={}));function MW(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class tt{constructor(e,n,i,r,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:r,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const LW=["vp8","h264"],UW=["vp8","h264","vp9","av1","h265"];function VW(t){return!!LW.find(e=>e===t)}const FW=VW;var hA;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(hA||(hA={}));var Ub;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(Ub||(Ub={}));const Dh={h90:new tt(160,90,9e4,20),h180:new tt(320,180,16e4,20),h216:new tt(384,216,18e4,20),h360:new tt(640,360,45e4,20),h540:new tt(960,540,8e5,25),h720:new tt(1280,720,17e5,30),h1080:new tt(1920,1080,3e6,30),h1440:new tt(2560,1440,5e6,30),h2160:new tt(3840,2160,8e6,30)},Vb={h120:new tt(160,120,7e4,20),h180:new tt(240,180,125e3,20),h240:new tt(320,240,14e4,20),h360:new tt(480,360,33e4,20),h480:new tt(640,480,5e5,20),h540:new tt(720,540,6e5,25),h720:new tt(960,720,13e5,30),h1080:new tt(1440,1080,23e5,30),h1440:new tt(1920,1440,38e5,30)},eC={h360fps3:new tt(640,360,2e5,3,"medium"),h360fps15:new tt(640,360,4e5,15,"medium"),h720fps5:new tt(1280,720,8e5,5,"medium"),h720fps15:new tt(1280,720,15e5,15,"medium"),h720fps30:new tt(1280,720,2e6,30,"medium"),h1080fps15:new tt(1920,1080,25e5,15,"medium"),h1080fps30:new tt(1920,1080,5e6,30,"medium"),original:new tt(0,0,7e6,30,"medium")};function r3(t,e,n){var i,r,s,o;const{optionsWithoutProcessor:a,audioProcessor:l,videoProcessor:c}=a3(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,f=a??{};return f.audio===!0&&(f.audio={}),f.video===!0&&(f.video={}),f.audio&&(Fb(f.audio,e),(i=(s=f.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(l||u)&&(f.audio.processor=l??u)),f.video&&(Fb(f.video,n),(r=(o=f.video).deviceId)!==null&&r!==void 0||(o.deviceId={ideal:"default"}),(c||d)&&(f.video.processor=c??d)),f}function Fb(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function tC(t){var e,n,i,r;const s={};if(t.video)if(typeof t.video=="object"){const o={},a=o,l=t.video;Object.keys(l).forEach(c=>{switch(c){case"resolution":Fb(a,l.resolution);break;default:a[c]=l[c]}}),s.video=o,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(r=s.audio).deviceId)!==null&&n!==void 0||(r.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function s3(t){return M(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=o3();if(i){const r=i.createAnalyser();r.fftSize=2048;const s=r.frequencyBinCount,o=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(r),yield Rn(n),r.getByteTimeDomainData(o);const l=o.some(c=>c!==128&&c!==0);return i.close(),!l}return!1}()})}function o3(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>M(this,void 0,void 0,function*(){var r;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(r=window.document.body)===null||r===void 0||r.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var r;n.state==="closed"&&((r=window.document.body)===null||r===void 0||r.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function jW(t){return t==="audioinput"?F.Source.Microphone:t==="videoinput"?F.Source.Camera:F.Source.Unknown}function jb(t){return t===F.Source.Microphone?"audioinput":t===F.Source.Camera?"videoinput":void 0}function BW(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Ja()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Kd(t){return t.split("/")[1].toLowerCase()}function qW(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new GE({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function Ae(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?Ae(t.track):{})}}function zW(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function HW(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],r={};for(const s of i)t[s]!==e[s]&&(r[s]=(n=e[s])!==null&&n!==void 0?n:"");return r}function a3(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:MW(e)}}function GW(t){switch(t){case Ut.CAMERA:return F.Source.Camera;case Ut.MICROPHONE:return F.Source.Microphone;case Ut.SCREEN_SHARE:return F.Source.ScreenShare;case Ut.SCREEN_SHARE_AUDIO:return F.Source.ScreenShareAudio;default:return F.Source.Unknown}}function fA(t,e){return t.width*t.height<e.width*e.height}function KW(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const $W=5e3,id=[];var _i;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(_i||(_i={}));class F extends Ur.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var r;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=F.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=Ee,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),$W):this.handleAppVisibilityChanged()},this.log=ws((r=i.loggerName)!==null&&r!==void 0?r:cr.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=F.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ae(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===F.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===F.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(id.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&id.splice(id.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Ql(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),r=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(r?X.AudioPlaybackStarted:X.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(r?X.AudioPlaybackFailed:X.VideoPlaybackFailed,s):s.name==="AbortError"?Ee.debug("".concat(r?"audio":"video"," playback aborted, likely due to new play request")):Ee.warn("could not playback ".concat(r?"audio":"video"),s),r&&e&&i.some(o=>o.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(X.ElementAttached,e),e}detach(e){try{if(e){pc(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(X.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{pc(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(X.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=ws(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),id.forEach(i=>{i.parentElement||(n=!1)}),n&&id.push(e)}}handleAppVisibilityChanged(){return M(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===F.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){ri()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){ri()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Ql(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(r=>{n.removeTrack(r)}),n.addTrack(t)),(!Ja()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Ja()||Ya())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function pc(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function r(c){switch(c){case e.Audio:return Zi.AUDIO;case e.Video:return Zi.VIDEO;default:return Zi.DATA}}t.kindToProto=r;function s(c){switch(c){case Zi.AUDIO:return e.Audio;case Zi.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function o(c){switch(c){case n.Camera:return Ut.CAMERA;case n.Microphone:return Ut.MICROPHONE;case n.ScreenShare:return Ut.SCREEN_SHARE;case n.ScreenShareAudio:return Ut.SCREEN_SHARE_AUDIO;default:return Ut.UNKNOWN}}t.sourceToProto=o;function a(c){switch(c){case Ut.CAMERA:return n.Camera;case Ut.MICROPHONE:return n.Microphone;case Ut.SCREEN_SHARE:return n.ScreenShare;case Ut.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=a;function l(c){switch(c){case Rb.ACTIVE:return i.Active;case Rb.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=l})(F||(F={}));const WW="|",pA="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function QW(t){const e=t.split(WW);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Rn(t){return new Fn(e=>wn.setTimeout(e,t))}function Bb(){return"addTransceiver"in RTCPeerConnection.prototype}function qb(){return"addTrack"in RTCPeerConnection.prototype}function YW(){if(!("getCapabilities"in RTCRtpSender)||Ja()||Ya())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function JW(){if(!("getCapabilities"in RTCRtpSender)||Ya())return!1;if(Ja()){const n=Kn();if(n!=null&&n.version&&Dr(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&Dr(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function tr(t){return t==="av1"||t==="vp9"}function zb(t){return!document||Oh()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function XW(){return typeof RTCPeerConnection>"u"?!1:Bb()||qb()}function Ya(){var t;return((t=Kn())===null||t===void 0?void 0:t.name)==="Firefox"}function mA(){const t=Kn();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function Ja(){var t;return((t=Kn())===null||t===void 0?void 0:t.name)==="Safari"}function Oh(){const t=Kn();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function ZW(){const t=Kn();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Dr(t.osVersion,"17")>=0}function eQ(t){return t||(t=Kn()),(t==null?void 0:t.name)==="Safari"&&Dr(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Dr(t.osVersion,"18.3")>0}function l3(){var t,e;return ri()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function tQ(){const t=Kn(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&Dr(t.osVersion,e)>=0?!0:t.name==="Safari"&&Dr(t.version,e)>=0}function ri(){return typeof document<"u"}function xr(){return navigator.product=="ReactNative"}function Hc(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function S0(t){return Hc(t)?t.hostname.split(".")[0]:null}function c3(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function u3(){if(!xr())return;let t=c3();if(t)return t.platform}function gA(){if(ri())return window.devicePixelRatio;if(xr()){let t=c3();if(t)return t.devicePixelRatio}return 1}function Dr(t,e){const n=t.split("."),i=e.split("."),r=Math.min(n.length,i.length);for(let s=0;s<r;++s){const o=parseInt(n[s],10),a=parseInt(i[s],10);if(o>a)return 1;if(o<a)return-1;if(s===r-1&&o===a)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function nQ(t){for(const e of t)e.target.handleResize(e)}function iQ(t){for(const e of t)e.target.handleVisibilityChanged(e)}let E0=null;const vA=()=>(E0||(E0=new ResizeObserver(nQ)),E0);let C0=null;const yA=()=>(C0||(C0=new IntersectionObserver(iQ,{root:null,rootMargin:"0px"})),C0);function rQ(){var t;const e=new oL({sdk:aL.JS,protocol:OW,version:DW});return xr()&&(e.os=(t=u3())!==null&&t!==void 0?t:""),e}function _A(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const r=document.createElement("canvas");r.width=t,r.height=e;const s=r.getContext("2d");s==null||s.fillRect(0,0,r.width,r.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const o=r.captureStream(),[a]=o.getTracks();if(!a)throw Error("Could not get empty media stream video track");return a.enabled=n,a}let rd;function k0(){if(!rd){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[rd]=i.stream.getAudioTracks(),!rd)throw Error("Could not get empty media stream audio track");rd.enabled=!1}return rd.clone()}class Bi{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,r)=>M(this,void 0,void 0,function*(){this.resolve=i,this.reject=r,e&&(yield e(i,r))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function sQ(t){return UW.includes(t)}function Ao(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function oQ(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function Nh(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function aQ(t,e){return t.segments.map(n=>{let{id:i,text:r,language:s,startTime:o,endTime:a,final:l}=n;var c;const u=(c=e.get(i))!==null&&c!==void 0?c:Date.now(),d=Date.now();return l?e.delete(i):e.set(i,u),{id:i,text:r,startTime:Number.parseInt(o.toString()),endTime:Number.parseInt(a.toString()),final:l,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function lQ(t){const{id:e,timestamp:n,message:i,editTimestamp:r}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:r?Number.parseInt(r.toString()):void 0,message:i}}function bA(t){switch(t.reason){case st.LeaveRequest:return t.context;case st.Cancelled:return sr.CLIENT_INITIATED;case st.NotAllowed:return sr.USER_REJECTED;case st.ServerUnreachable:return sr.JOIN_FAILURE;default:return sr.UNKNOWN_REASON}}function tm(t){return t!==void 0?Number(t):void 0}function Ta(t){return t!==void 0?BigInt(t):void 0}function mc(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function wr(t){return!!t&&t.kind==F.Kind.Audio}function Xo(t){return!!t&&t.kind==F.Kind.Video}function Hs(t){return mc(t)&&Xo(t)}function Qr(t){return mc(t)&&wr(t)}function Hb(t){return!!t&&!t.isLocal}function cQ(t){return!!t&&!t.isLocal}function w0(t){return Hb(t)&&Xo(t)}function uQ(t){return t.isLocal}function dQ(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let r=e;for(;r>0;){const s=i[r];if(s!==void 0&&(s&192)!==128)break;r--}n.push(i.slice(0,r)),i=i.slice(r)}return i.length>0&&n.push(i),n}function hQ(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function fQ(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=pQ(t,e);return n?i:nC(i,"v1")}function pQ(t,e){const n=new URL(oQ(t));return e.forEach((i,r)=>{n.searchParams.set(r,i)}),nC(n,"rtc")}function mQ(t){const e=new URL(Nh(t));return nC(e,"validate")}function d3(t){return t.endsWith("/")?t:"".concat(t,"/")}function nC(t,e){return t.pathname="".concat(d3(t.pathname)).concat(e),t}function TA(t){if(typeof t=="string")return ZR.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return ZR.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function gQ(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const vQ=10,sd="lk_e2ee",yQ="LKFrameEncryptionKey",_Q={sharedKey:!1,ratchetSalt:yQ,ratchetWindowSize:8,failureTolerance:vQ,keyringSize:16};var Io;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Io||(Io={}));var SA;(function(t){t.KeyRatcheted="keyRatcheted"})(SA||(SA={}));var lo;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(lo||(lo={}));var EA;(function(t){t.Error="cryptorError"})(EA||(EA={}));function bQ(){return TQ()||Gb()}function Gb(){return typeof window.RTCRtpScriptTransform<"u"}function TQ(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function SQ(t){var e,n,i,r,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new Z2({value:t.value})}class See extends Ur.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,r)=>{Ee.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:r})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},_Q),e),this.on(Io.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const r={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),r),this.emit(Io.SetKey,r)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Io.RatchetRequest,e,n)}}var CA;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(CA||(CA={}));class EQ extends Ur.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var r,s;const{kind:o,data:a}=i.data;switch(o){case"error":if(Ee.error(a.error.message),a.uuid){const u=this.decryptDataRequests.get(a.uuid);if(u!=null&&u.reject){u.reject(a.error);break}const d=this.encryptDataRequests.get(a.uuid);if(d!=null&&d.reject){d.reject(a.error);break}}this.emit(lo.EncryptionError,a.error,a.participantIdentity);break;case"initAck":a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(a.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==a.enabled&&a.participantIdentity===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity))this.emit(lo.ParticipantEncryptionStatusChanged,a.enabled,this.room.localParticipant),this.encryptionEnabled=a.enabled;else if(a.participantIdentity){const u=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(a.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(a.participantIdentity));this.emit(lo.ParticipantEncryptionStatusChanged,a.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(Io.KeyRatcheted,a.ratchetResult,a.participantIdentity,a.keyIndex);break;case"decryptDataResponse":const l=this.decryptDataRequests.get(a.uuid);l!=null&&l.resolve&&l.resolve(a);break;case"encryptDataResponse":const c=this.encryptDataRequests.get(a.uuid);c!=null&&c.resolve&&c.resolve(a);break}},this.onWorkerError=i=>{Ee.error("e2ee worker encountered an error:",{error:i.error}),this.emit(lo.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!bQ())throw new ZE("tried to setup end-to-end encryption on an unsupported browser");if(Ee.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:gW.getLevel()}};this.worker&&(Ee.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){Ee.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?Ee.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(te.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(H.TrackPublished,(i,r)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Dt.NONE,r.identity)),e.on(H.ConnectionStateChanged,i=>{i===qe.Connected&&e.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Dt.NONE,r.identity)})})}).on(H.TrackUnsubscribed,(i,r,s)=>{var o;const a={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(o=this.worker)===null||o===void 0||o.postMessage(a)}).on(H.TrackSubscribed,(i,r,s)=>{this.setupE2EEReceiver(i,s.identity,r.trackInfo)}).on(H.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on($.LocalSenderCreated,(i,r)=>M(this,void 0,void 0,function*(){this.setupE2EESender(r,i)})),e.localParticipant.on($.LocalTrackPublished,i=>{if(!Xo(i.track)||!Oh())return;const r={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Kd(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(r)}),n.on(Io.SetKey,i=>this.postKey(i)).on(Io.RatchetRequest,(i,r)=>this.postRatchetRequest(i,r))}encryptData(e){return M(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},r=new Bi;return r.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,r),this.worker.postMessage(i),r.promise})}handleEncryptedData(e,n,i,r){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),o={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:r}},a=new Bi;return a.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,a),this.worker.postMessage(o),a.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:r}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const o={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:r}};this.worker.postMessage(o)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Kd(i.mimeType):void 0)}}setupE2EESender(e,n){if(!mc(e)||!n){n||Ee.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,r){return M(this,void 0,void 0,function*(){if(this.worker){if(Gb()&&!mA()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:r};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(sd in e&&r){const l={kind:"updateCodec",data:{trackId:n,codec:r,participantIdentity:i}};this.worker.postMessage(l);return}let s=e.writableStream,o=e.readableStream;if(!s||!o){const l=e.createEncodedStreams();e.writableStream=l.writable,s=l.writable,e.readableStream=l.readable,o=l.readable}const a={kind:"decode",data:{readableStream:o,writableStream:s,trackId:n,codec:r,participantIdentity:i,isReuse:sd in e}};this.worker.postMessage(a,[o,s])}e[sd]=!0}})}handleSender(e,n,i){var r;if(!(sd in e||!this.worker)){if(!(!((r=this.room)===null||r===void 0)&&r.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(Gb()&&!mA()){Ee.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{Ee.info("initialize encoded streams");const s=e.createEncodedStreams(),o={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(o,[s.readable,s.writable])}e[sd]=!0}}}const CQ=500,kQ=15e3;class gc{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new gc),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),r=S0(i);if(!r)return;let s=(n=this.failedConnectionAttempts.get(r))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(r,s+1),this.backOffPromises.set(r,Rn(Math.min(CQ*Math.pow(2,s),kQ)))}getBackOffPromise(e){const n=new URL(e),i=n&&S0(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&S0(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}gc._instance=null;const R0="default";class hn{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new hn),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return M(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=hn.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){Ee.debug("awaiting getUserMedia promise");try{n?yield hn.userMediaPromiseMap.get(n):yield Promise.all(hn.userMediaPromiseMap.values())}catch{Ee.warn("error waiting for media permissons")}}let o=yield navigator.mediaDevices.enumerateDevices();if(r&&!(Ja()&&i.hasDeviceInUse(n))&&(o.filter(l=>l.kind===n).length===0||o.some(l=>{const c=l.label==="",u=n?l.kind===n:!0;return c&&u}))){const l={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},c=yield navigator.mediaDevices.getUserMedia(l);o=yield navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=o,n&&(o=o.filter(a=>a.kind===n)),o}()})}normalizeDeviceId(e,n,i){return M(this,void 0,void 0,function*(){if(n!==R0)return n;const r=yield this.getDevices(e),s=r.find(a=>a.deviceId===R0);if(!s){Ee.warn("could not reliably determine default device");return}const o=r.find(a=>a.deviceId!==R0&&a.groupId===(i??s.groupId));if(!o){Ee.warn("could not reliably determine default device");return}return o==null?void 0:o.deviceId})}hasDeviceInUse(e){return e?hn.userMediaPromiseMap.has(e):hn.userMediaPromiseMap.size>0}}hn.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];hn.userMediaPromiseMap=new Map;var $d;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})($d||($d={}));class wQ{constructor(){this.pendingTasks=new Map,this.taskMutex=new Gn,this.nextTaskIndex=0}run(e){return M(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:$d.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=$d.RUNNING,yield e()}finally{n.status=$d.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return M(this,void 0,void 0,function*(){return this.run(()=>M(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class RQ{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,r;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(r=n.protocols)!==null&&r!==void 0?r:[]);s.binaryType="arraybuffer",this.ws=s;const o=function(){let{closeCode:a,reason:l}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(a,l)};this.opened=new Fn((a,l)=>{const c=()=>{l(de.websocket("Encountered websocket error during connection establishment"))};s.onopen=()=>{a({readable:new ReadableStream({start(u){s.onmessage=d=>{let{data:f}=d;return u.enqueue(f)},s.onerror=d=>u.error(d)},cancel:o}),writable:new WritableStream({write(u){s.send(u)},abort(){s.close()},close:o}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),this.closed=new Fn((a,l)=>{const c=()=>M(this,void 0,void 0,function*(){const u=new Fn(f=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",p=>{f(p)},{once:!0})}),d=yield Fn.race([Rn(250),u]);d?a(d):l(de.websocket("Encountered unspecified websocket error without a timely close event"))});s.onclose=u=>{let{code:d,reason:f}=u;a({closeCode:d,reason:f}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=o}}const AQ=["syncState","trickle","offer","answer","simulate","leave"];function IQ(t){const e=AQ.indexOf(t.case)>=0;return Ee.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var rt;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(rt||(rt={}));const PQ=250;class iC{get currentState(){return this.state}get isDisconnected(){return this.state===rt.DISCONNECTING||this.state===rt.DISCONNECTED}get isEstablishingConnection(){return this.state===rt.CONNECTING||this.state===rt.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=rt.DISCONNECTED,this.log=Ee,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=ws((i=n.loggerName)!==null&&i!==void 0?i:cr.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new wQ,this.queuedRequests=[],this.closingLock=new Gn,this.connectionLock=new Gn,this.state=rt.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,r){return M(this,arguments,void 0,function(s,o,a,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){return c.state=rt.CONNECTING,c.options=a,yield c.connect(s,o,a,l,u)}()})}reconnect(e,n,i,r){return M(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=rt.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:r}),void 0,this.useV0SignalPath)})}connect(e,n,i,r){return M(this,arguments,void 0,function(s,o,a,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){const d=yield c.connectionLock.lock();c.connectOptions=a,c.useV0SignalPath=u;const f=rQ(),p=u?xQ(o,f,a):DQ(o,f,a),v=fQ(s,p,u).toString(),g=mQ(v).toString();return new Promise((E,y)=>M(c,void 0,void 0,function*(){var T,R;try{let b=!1;const w=A=>M(this,void 0,void 0,function*(){if(b)return;b=!0;const I=A instanceof Event?A.currentTarget:A,N=gQ(I,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(N)).catch(O=>{this.log.error(O),this.close()}):this.close(),D(),y(de.cancelled(N))});l==null||l.addEventListener("abort",w);const D=()=>{clearTimeout(C),l==null||l.removeEventListener("abort",w)},C=setTimeout(()=>{w(de.timeout("room connection has timed out (signal)"))},a.websocketTimeout),k=(A,I)=>{this.handleSignalConnected(A,C,I)},S=new URL(v);S.searchParams.has("access_token")&&S.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(S),Object.assign({reconnect:a.reconnect,reconnectReason:a.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new RQ(v);try{this.ws.closed.then(J=>{var re;this.isEstablishingConnection&&y(de.internal("Websocket got closed during a (re)connection attempt: ".concat(J.reason))),J.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:J.reason,code:J.closeCode,wasClean:J.closeCode===1e3,state:this.state})),this.state===rt.CONNECTED&&this.handleOnClose((re=J.reason)!==null&&re!==void 0?re:"Unexpected WS error"))}).catch(J=>{this.isEstablishingConnection&&y(de.internal("Websocket error during a (re)connection attempt: ".concat(J)))});const A=yield this.ws.opened.catch(J=>M(this,void 0,void 0,function*(){if(this.state!==rt.CONNECTED){this.state=rt.DISCONNECTED,clearTimeout(C);const re=yield this.handleConnectionError(J,g);y(re);return}this.handleWSError(J),y(J)}));if(clearTimeout(C),!A)return;const I=A.readable.getReader();this.streamWriter=A.writable.getWriter();const N=yield I.read();if(I.releaseLock(),!N.value)throw de.internal("no message received as first message");const O=TA(N.value),he=this.validateFirstMessage(O,(T=a.reconnect)!==null&&T!==void 0?T:!1);if(!he.isValid){y(he.error);return}((R=O.message)===null||R===void 0?void 0:R.case)==="join"&&(this.pingTimeoutDuration=O.message.value.pingTimeout,this.pingIntervalDuration=O.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const Ye=he.shouldProcessFirstMessage?O:void 0;k(A,Ye),E(he.response)}catch(A){y(A)}finally{D()}}finally{d()}}))}()})}startReadingLoop(e,n){return M(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Rn(this.signalLatency));const{done:i,value:r}=yield e.read();if(i)break;const s=TA(r);this.handleSignalResponse(s)}})}close(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([rt.DISCONNECTING||rt.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const r=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=rt.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,Rn(PQ)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=rt.DISCONNECTED),r()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Yl(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Yl(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new Iv({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new Pv({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return M(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const a=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new $E({requestId:a,metadata:i,name:r,attributes:o})}),a}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new vL({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new bL({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:_t.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new EL({timestamp:_t.parse(Date.now()),rtt:_t.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new KE({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new Dv({reason:sr.CLIENT_INITIATED,action:dc.DISCONNECT})})}sendRequest(e){return M(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!r&&!IQ(n)&&i.state===rt.RECONNECTING){i.queuedRequests.push(()=>M(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(r||(yield i.requestQueue.flush()),i.signalLatency&&(yield Rn(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const o=new L$({message:n});try{i.useJSON?yield i.streamWriter.write(o.toJsonString()):yield i.streamWriter.write(o.toBinary())}catch(a){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:a}))}}()})}handleSignalResponse(e){var n,i;const r=e.message;if(r==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(r.case==="answer"){const o=kA(r.value);this.onAnswer&&this.onAnswer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="offer"){const o=kA(r.value);this.onOffer&&this.onOffer(o,r.value.id,r.value.midToTrackId)}else if(r.case==="trickle"){const o=JSON.parse(r.value.candidateInit);this.onTrickle&&this.onTrickle(o,r.value.target)}else r.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=r.value.participants)!==null&&n!==void 0?n:[]):r.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(r.value):r.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=r.value.speakers)!==null&&i!==void 0?i:[]):r.case==="leave"?this.onLeave&&this.onLeave(r.value):r.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(r.value.sid,r.value.muted):r.case==="roomUpdate"?this.onRoomUpdate&&r.value.room&&this.onRoomUpdate(r.value.room):r.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(r.value):r.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(r.value):r.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(r.value):r.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(r.value):r.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(r.value):r.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(r.value):r.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(r.value):r.case==="pong"||(r.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(r.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):r.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(r.value):r.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(r.value.trackSid):r.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(r.value.token),this.onRoomMoved&&this.onRoomMoved(r.value)):r.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(r.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:r.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return M(this,void 0,void 0,function*(){if(this.state===rt.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=wn.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&wn.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=wn.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&wn.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=rt.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,r,s,o,a;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===rt.RECONNECTING&&((r=e.message)===null||r===void 0?void 0:r.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((o=e.message)===null||o===void 0?void 0:o.case)==="leave"?{isValid:!1,error:de.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:de.internal("Unexpected first message")}:{isValid:!1,error:de.internal("did not receive join response, got ".concat((a=e.message)===null||a===void 0?void 0:a.case," instead"))}}handleConnectionError(e,n){return M(this,void 0,void 0,function*(){try{const i=yield fetch(n);switch(i.status){case 404:return de.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const r=yield i.text();return de.notAllowed(r,i.status);default:break}return e instanceof de?e:de.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof de?i:de.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function kA(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Yl(t,e){return new zo({sdp:t.sdp,type:t.type,id:e})}function xQ(t,e,n){var i;const r=new URLSearchParams;return r.set("access_token",t),n.reconnect&&(r.set("reconnect","1"),n.sid&&r.set("sid",n.sid)),r.set("auto_subscribe",n.autoSubscribe?"1":"0"),r.set("sdk",xr()?"reactnative":"js"),r.set("version",e.version),r.set("protocol",e.protocol.toString()),e.deviceModel&&r.set("device_model",e.deviceModel),e.os&&r.set("os",e.os),e.osVersion&&r.set("os_version",e.osVersion),e.browser&&r.set("browser",e.browser),e.browserVersion&&r.set("browser_version",e.browserVersion),n.adaptiveStream&&r.set("adaptive_stream","1"),n.reconnectReason&&r.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&r.set("network",navigator.connection.type),r}function DQ(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const r=new cW({clientInfo:e,connectionSettings:new CL({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(r.reconnectReason=n.reconnectReason);const s=new uW({joinRequest:r.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),i}class wA{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class OQ{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const r=i+this.ttl;return this._map.set(e,{value:n,expiresAt:r}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[r,s]of i.entries())n.push(e(s,r,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Qi={},A0={},I0={exports:{}},RA;function rC(){if(RA)return I0.exports;RA=1;var t=I0.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),I0.exports}var AA;function NQ(){return AA||(AA=1,function(t){var e=function(a){return String(Number(a))===a?Number(a):a},n=function(a,l,c,u){if(u&&!c)l[u]=e(a[1]);else for(var d=0;d<c.length;d+=1)a[d+1]!=null&&(l[c[d]]=e(a[d+1]))},i=function(a,l,c){var u=a.name&&a.names;a.push&&!l[a.push]?l[a.push]=[]:u&&!l[a.name]&&(l[a.name]={});var d=a.push?{}:u?l[a.name]:l;n(c.match(a.reg),d,a.names,a.name),a.push&&l[a.push].push(d)},r=rC(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(a){var l={},c=[],u=l;return a.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var f=d[0],p=d.slice(2);f==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var v=0;v<(r[f]||[]).length;v+=1){var g=r[f][v];if(g.reg.test(p))return i(g,u,p)}}),l.media=c,l};var o=function(a,l){var c=l.split(/=(.+)/,2);return c.length===2?a[c[0]]=e(c[1]):c.length===1&&l.length>1&&(a[c[0]]=void 0),a};t.parseParams=function(a){return a.split(/;\s?/).reduce(o,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(a){return a.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(a){for(var l=[],c=a.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},t.parseImageAttributes=function(a){return a.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(o,{})})},t.parseSimulcastStreamList=function(a){return a.split(";").map(function(l){return l.split(",").map(function(c){var u,d=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),d=!0),{scid:u,paused:d}})})}}(A0)),A0}var P0,IA;function MQ(){if(IA)return P0;IA=1;var t=rC(),e=/%[sdv%]/g,n=function(o){var a=1,l=arguments,c=l.length;return o.replace(e,function(u){if(a>=c)return u;var d=l[a];switch(a+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(o,a,l){var c=a.format instanceof Function?a.format(a.push?l:l[a.name]):a.format,u=[o+"="+c];if(a.names)for(var d=0;d<a.names.length;d+=1){var f=a.names[d];a.name?u.push(l[a.name][f]):u.push(l[a.names[d]])}else u.push(l[a.name]);return n.apply(null,u)},r=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return P0=function(o,a){a=a||{},o.version==null&&(o.version=0),o.name==null&&(o.name=" "),o.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var l=a.outerOrder||r,c=a.innerOrder||s,u=[];return l.forEach(function(d){t[d].forEach(function(f){f.name in o&&o[f.name]!=null?u.push(i(d,f,o)):f.push in o&&o[f.push]!=null&&o[f.push].forEach(function(p){u.push(i(d,f,p))})})}),o.media.forEach(function(d){u.push(i("m",t.m[0],d)),c.forEach(function(f){t[f].forEach(function(p){p.name in d&&d[p.name]!=null?u.push(i(f,p,d)):p.push in d&&d[p.push]!=null&&d[p.push].forEach(function(v){u.push(i(f,p,v))})})})}),u.join(`\r
`)+`\r
`},P0}var PA;function LQ(){if(PA)return Qi;PA=1;var t=NQ(),e=MQ(),n=rC();return Qi.grammar=n,Qi.write=e,Qi.parse=t.parse,Qi.parseParams=t.parseParams,Qi.parseFmtpConfig=t.parseFmtpConfig,Qi.parsePayloads=t.parsePayloads,Qi.parseRemoteCandidates=t.parseRemoteCandidates,Qi.parseImageAttributes=t.parseImageAttributes,Qi.parseSimulcastStreamList=t.parseSimulcastStreamList,Qi}var Ks=LQ();function sC(t,e,n){var i,r,s;e===void 0&&(e=50),n===void 0&&(n={});var o=(i=n.isImmediate)!=null&&i,a=(r=n.callback)!=null&&r,l=n.maxWait,c=Date.now(),u=[];function d(){if(l!==void 0){var p=Date.now()-c;if(p+e>=l)return l-p}return e}var f=function(){var p=[].slice.call(arguments),v=this;return new Promise(function(g,E){var y=o&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,c=Date.now(),!o){var R=t.apply(v,p);a&&a(R),u.forEach(function(b){return(0,b.resolve)(R)}),u=[]}},d()),y){var T=t.apply(v,p);return a&&a(T),g(T)}u.push({resolve:g,reject:E})})};return f.cancel=function(p){s!==void 0&&clearTimeout(s),u.forEach(function(v){return(0,v.reject)(p)}),u=[]},f}const UQ=.7,VQ=20,vc={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class xA extends Ur.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=Ee,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=sC(r=>M(this,void 0,void 0,function*(){this.emit(vc.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(r)r(s);else throw s}}),VQ),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=ws((i=n.loggerName)!==null&&i!==void 0?i:cr.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Gn}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return M(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return M(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let r;if(e.type==="offer"){let{stereoMids:s,nackMids:o}=FQ(e);this.remoteStereoMids=s,this.remoteNackMids=o}else if(e.type==="answer"){const s=Ks.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(o=>{const a=oC(o.mid);o.type==="audio"&&this.trackBitrates.some(l=>{if(!l.transceiver||a!=l.transceiver.mid)return!1;let c=0;if(o.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0)return!0;let u=!1;for(const d of o.fmtp)if(d.payload===c){d.config=d.config.split(";").filter(f=>!f.includes("maxaveragebitrate")).join(";"),l.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(l.maxbr*1e3)),u=!0;break}return u||l.maxbr>0&&o.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(l.maxbr*1e3)}),!0})}),r=Ks.write(s)}return yield this.setMungedSDP(e,r,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(vc.NegotiationComplete),e.sdp&&Ks.parse(e.sdp).media.forEach(o=>{o.type==="video"&&this.emit(vc.RTPVideoPayloadTypes,o.rtp)})),!0})}createAndSendOffer(e){return M(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const a=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&a)yield this._pc.setRemoteDescription(a);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const r=this.latestOfferId+1;this.latestOfferId=r;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const o=Ks.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(o.media.forEach(a=>{OA(a),a.type==="audio"?DA(a,["all"],[]):a.type==="video"&&this.trackBitrates.some(l=>{if(!a.msid||!l.cid||!a.msid.includes(l.cid))return!1;let c=0;if(a.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0||(tr(l.codec)&&!Ja()&&this.ensureVideoDDExtensionForSVC(a,o),!tr(l.codec)))return!0;const u=Math.round(l.maxbr*UQ);for(const d of a.fmtp)if(d.payload===c){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>r){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:r}));return}yield this.setMungedSDP(s,Ks.write(o)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return M(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Ks.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(r=>{OA(r),r.type==="audio"&&DA(r,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Ks.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new At("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new At("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return M(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,r=new Map;if((yield this._pc.getStats()).forEach(a=>{switch(a.type){case"transport":n=a.selectedCandidatePairId;break;case"candidate-pair":n===""&&a.selected&&(n=a.id),i.set(a.id,a);break;case"remote-candidate":r.set(a.id,"".concat(a.address,":").concat(a.port));break}}),n==="")return;const o=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(o!==void 0)return r.get(o)})}setMungedSDP(e,n,i){return M(this,void 0,void 0,function*(){if(n){const r=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=r}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(r){let s="unknown error";r instanceof Error?s=r.message:typeof r=="string"&&(s=r);const o={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(o.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:o})),new fc(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,r;if(!((i=e.ext)===null||i===void 0?void 0:i.some(o=>o.uri===pA))){if(this.ddExtID===0){let o=0;n.media.forEach(a=>{var l;a.type==="video"&&((l=a.ext)===null||l===void 0||l.forEach(c=>{c.value>o&&(o=c.value)}))}),this.ddExtID=o+1}(r=e.ext)===null||r===void 0||r.push({value:this.ddExtID,uri:pA})}}}function DA(t,e,n){const i=oC(t.mid);let r=0;t.rtp.some(s=>s.codec==="opus"?(r=s.payload,!0):!1),r>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===r&&s.type==="nack")&&t.rtcpFb.push({payload:r,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===r?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function FQ(t){var e;const n=[],i=[],r=Ks.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return r.media.forEach(o=>{var a;const l=oC(o.mid);o.type==="audio"&&(o.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((a=o.rtcpFb)===null||a===void 0)&&a.some(c=>c.payload===s&&c.type==="nack")&&i.push(l),o.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(l),!0):!1))}),{stereoMids:n,nackMids:i}}function OA(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function oC(t){return typeof t=="number"?t.toFixed(0):t}const Kb="vp8",jQ={audioPreset:Ub.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:eC.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:Kb,backupCodec:!0,preConnectBuffer:!1},h3={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},f3={deviceId:{ideal:"default"},resolution:Dh.h720.resolution},BQ={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new yW,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},aC={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Et;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Et||(Et={}));class qQ{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(e,n,i){var r;this.peerConnectionTimeout=aC.peerConnectionTimeout,this.log=Ee,this.updateState=()=>{var s,o;const a=this.state,l=this.requiredTransports.map(c=>c.getConnectionState());l.every(c=>c==="connected")?this.state=Et.CONNECTED:l.some(c=>c==="failed")?this.state=Et.FAILED:l.some(c=>c==="connecting")?this.state=Et.CONNECTING:l.every(c=>c==="closed")?this.state=Et.CLOSED:l.some(c=>c==="closed")?this.state=Et.CLOSING:l.every(c=>c==="new")&&(this.state=Et.NEW),a!==this.state&&(this.log.debug("pc state change: from ".concat(Et[a]," to ").concat(Et[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(o=this.subscriber)===null||o===void 0?void 0:o.getConnectionState()))},this.log=ws((r=i.loggerName)!==null&&r!==void 0?r:cr.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new xA(e,i),this._mode=n,n!=="publisher-only"&&(this.subscriber=new xA(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,er.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var o;(o=this.onDataChannel)===null||o===void 0||o.call(this,s)},this.subscriber.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var o;(o=this.onIceCandidate)===null||o===void 0||o.call(this,s,er.PUBLISHER)},this.publisher.onTrack=s=>{var o;(o=this.onTrack)===null||o===void 0||o.call(this,s)},this.publisher.onOffer=(s,o)=>{var a;(a=this.onPublisherOffer)===null||a===void 0||a.call(this,s,o)},this.state=Et.NEW,this.connectionLock=new Gn,this.remoteOfferLock=new Gn}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return M(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(r){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:r}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return M(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return M(this,void 0,void 0,function*(){var i;n===er.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return M(this,void 0,void 0,function*(){var i,r,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const o=yield this.remoteOfferLock.lock();try{return(yield(r=this.subscriber)===null||r===void 0?void 0:r.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{o()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return M(this,void 0,void 0,function*(){var i;const r=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{r()}})}negotiate(e){return M(this,void 0,void 0,function*(){return new Fn((n,i)=>M(this,void 0,void 0,function*(){const r=setTimeout(()=>{i(new fc("negotiation timed out"))},this.peerConnectionTimeout),s=()=>{clearTimeout(r),i(new fc("negotiation aborted"))};e.signal.addEventListener("abort",s),this.publisher.once(vc.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(vc.NegotiationComplete,()=>{clearTimeout(r),n()})}),yield this.publisher.negotiate(o=>{clearTimeout(r),o instanceof Error?i(o):i(new Error(String(o)))})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(r=>r.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===er.PUBLISHER?this.publisher.getConnectedAddress():e===er.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return M(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((l,c)=>M(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),wn.clearTimeout(d),c(de.cancelled("room connection has been cancelled"))};r!=null&&r.signal.aborted&&u(),r==null||r.signal.addEventListener("abort",u);const d=wn.setTimeout(()=>{r==null||r.signal.removeEventListener("abort",u),c(de.internal("could not establish pc connection"))},o);for(;this.state!==Et.CONNECTED;)if(yield Rn(50),r!=null&&r.signal.aborted){c(de.cancelled("room connection has been cancelled"));return}wn.clearTimeout(d),r==null||r.signal.removeEventListener("abort",u),l()}))}()})}}const p3=5e3,zQ=3e4;class Be{static fetchRegionSettings(e,n,i){return M(this,void 0,void 0,function*(){const r=yield Be.fetchLock.lock();try{const s=yield fetch("".concat(HQ(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(s.ok){const o=hQ(s.headers),a=o?o*1e3:p3;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:a}}else throw s.status===401?de.notAllowed("Could not fetch region settings: ".concat(s.statusText),s.status):de.internal("Could not fetch region settings: ".concat(s.statusText))}catch(s){throw s instanceof de?s:i!=null&&i.aborted?de.cancelled("Region fetching was aborted"):de.serverUnreachable("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s))}finally{r()}})}static scheduleRefetch(e,n,i){return M(this,void 0,void 0,function*(){const r=Be.settingsTimeouts.get(e.hostname);clearTimeout(r),Be.settingsTimeouts.set(e.hostname,setTimeout(()=>M(this,void 0,void 0,function*(){try{const s=yield Be.fetchRegionSettings(e,n);Be.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof de&&s.reason===st.NotAllowed){Ee.debug("token is not valid, cancelling auto region refresh");return}Ee.debug("auto refetching of region settings failed",{error:s}),Be.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){Be.cache.set(e.hostname,i),Be.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=Be.settingsTimeouts.get(e);n&&(clearTimeout(n),Be.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=Be.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=Be.connectionTrackers.get(e);i&&i.connectionCount===0&&(Ee.debug("stopping region refetch after disconnect delay",{hostname:e}),Be.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},zQ))}static cancelCleanup(e){const n=Be.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=Be.connectionTrackers.get(e);n||(n={connectionCount:0},Be.connectionTrackers.set(e,n)),n.connectionCount++,Be.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=Be.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&Be.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return Hc(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return M(this,void 0,void 0,function*(){return Be.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return M(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=Be.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),Be.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(r=>!this.attemptedRegions.find(s=>s.url===r.url));if(i.length>0){const r=i[0];return this.attemptedRegions.push(r),Ee.debug("next region: ".concat(r.region)),r.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){Be.updateCachedRegionSettings(this.serverUrl,this.token,e)}}Be.cache=new Map;Be.settingsTimeouts=new Map;Be.connectionTrackers=new Map;Be.fetchLock=new Gn;function HQ(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class wt extends Error{constructor(e,n,i){super(n),this.code=e,this.message=NA(n,wt.MAX_MESSAGE_BYTES),this.data=i?NA(i,wt.MAX_DATA_BYTES):void 0}static fromProto(e){return new wt(e.code,e.message,e.data)}toProto(){return new nL({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new wt(wt.ErrorCode[e],wt.ErrorMessage[e],n)}}wt.MAX_MESSAGE_BYTES=256;wt.MAX_DATA_BYTES=15360;wt.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};wt.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const m3=15360;function lC(t){return new TextEncoder().encode(t).length}function NA(t,e){if(lC(t)<=e)return t;let n=0,i=t.length;const r=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);r.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const cC=2e3;function Nv(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const uC=typeof MediaRecorder<"u";class GQ{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const KQ=uC?MediaRecorder:GQ;class $Q extends KQ{constructor(e,n){if(!uC)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,r;const s=()=>r===void 0,o=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r==null||r.close(),r=void 0},a=l=>{r==null||r.error(l),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",o),this.removeEventListener("error",a),r=void 0};this.byteStream=new ReadableStream({start:l=>{r=l,i=c=>M(this,void 0,void 0,function*(){let u;if(c.data.arrayBuffer){const d=yield c.data.arrayBuffer();u=new Uint8Array(d)}else if(c.data.byteArray)u=c.data.byteArray;else throw new Error("no data available!");s()||l.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{o()}}),this.addEventListener("stop",o),this.addEventListener("error",a)}}function WQ(){return uC}const QQ=1e3,YQ=1e4;class g3 extends F{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=sC(()=>M(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>M(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(X.Ended,this)},this.reacquireTrack=!1,this.providedByUser=r,this.muteLock=new Gn,this.pauseUpstreamLock=new Gn,this.trackChangeLock=new Gn,this.trackChangeLock.lock().then(o=>M(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{o()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==F.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return M(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{pc(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let r;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Ql(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),r=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(r??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{Ql(r??e,s)}))})}waitForDimensions(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:QQ;return function*(){var i;if(e.kind===F.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=Kn())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Rn(10));const r=Date.now();for(;Date.now()-r<n;){const s=e.dimensions;if(s)return s;yield Rn(50)}throw new ns("unable to get track dimensions after timeout")}()})}setDeviceId(e){return M(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===Ao(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),Ao(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===F.Source.ScreenShare)return;const{deviceId:i,groupId:r}=e._mediaStreamTrack.getSettings(),s=e.kind===F.Kind.Audio?"audioinput":"videoinput";return n?hn.getInstance().normalizeDeviceId(s,i,r):i}()})}mute(){return M(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return M(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return M(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new ns("unable to replace an unpublished track");let r,s;return typeof n=="boolean"?r=n:n!==void 0&&(r=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=r??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return M(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:r}=e,s=_W(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const o={audio:!1,video:!1};this.kind===F.Kind.Video?o.video=i||r?{deviceId:i,facingMode:r}:!0:o.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(c=>{pc(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const l=(yield navigator.mediaDevices.getUserMedia(o)).getTracks()[0];return this.kind===F.Kind.Video&&(yield l.applyConstraints(s)),l.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(l),this._constraints=e,this.emit(X.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?X.Muted:X.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return M(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),l3()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return M(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(X.UpstreamPaused,this);const i=Kn();if((i==null?void 0:i.name)==="Safari"&&Dr(i.version,"12.0")<0)throw new ZE("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return M(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(X.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return M(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return M(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const o=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const a=document.createElement(i.kind),l={kind:i.kind,track:i._mediaStreamTrack,element:a,audioContext:i.audioContext};if(yield n.init(l),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Ql(i._mediaStreamTrack,a),a.muted=!0,a.play().catch(c=>{c instanceof DOMException&&c.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:c})),setTimeout(()=>{a.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:c}))}),i.processor=n,i.processorElement=a,i.processor.processedTrack){for(const c of i.attachedElements)c!==i.processorElement&&r&&(pc(i._mediaStreamTrack,c),Ql(i.processor.processedTrack,c));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(X.TrackProcessorUpdate,i.processor)}finally{o()}}()})}getProcessor(){return this.processor}stopProcessor(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,r;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((r=e.processorElement)===null||r===void 0||r.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(X.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!WQ()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new $Q(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},YQ)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class vg extends g3{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,F.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>M(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let o;try{o=yield this.getSenderStats()}catch(a){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:a}));return}o&&this.prevStats&&(this._currentBitrate=Nv(o,this.prevStats)),this.prevStats=o}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(X.AudioTrackFeatureUpdate,this,un.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(X.AudioTrackFeatureUpdate,this,un.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=r,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return M(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===F.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return M(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==Ao(this._constraints.deviceId);return this.source===F.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return M(this,void 0,void 0,function*(){let n;if(e){const i=tC({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return M(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){ri()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},cC)))}setProcessor(e){return M(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!xr()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const r={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(r),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(X.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return M(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(r=>{r.type==="outbound-rtp"&&(i={type:"audio",streamId:r.id,packetsSent:r.packetsSent,packetsLost:r.packetsLost,bytesSent:r.bytesSent,timestamp:r.timestamp,roundTripTime:r.roundTripTime,jitter:r.jitter})}),i})}checkForSilence(){return M(this,void 0,void 0,function*(){const e=yield s3(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(X.AudioSilenceDetected)),e})}}function JQ(t,e,n){switch(t.kind){case"audio":return new vg(t,e,!1,void 0,n);case"video":return new yg(t,e,!1,n);default:throw new ns("unsupported track type: ".concat(t.kind))}}const XQ=Object.values(Dh),ZQ=Object.values(Vb),eY=Object.values(eC),tY=[Dh.h180,Dh.h360],nY=[Vb.h180,Vb.h360],iY=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,r;return new tt(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((r=n.fps)!==null&&r!==void 0?r:30))))),n.fps,t.encoding.priority)}),$b=["q","h","f"];function Wb(t,e,n,i){var r,s;let o=i==null?void 0:i.videoEncoding;t&&(o=i==null?void 0:i.screenShareEncoding);const a=i==null?void 0:i.simulcast,l=i==null?void 0:i.scalabilityMode,c=i==null?void 0:i.videoCodec;if(!o&&!a&&!l||!e||!n)return[{}];o||(o=sY(t,e,n,c),Ee.debug("using video encoding",o));const u=o.maxFramerate,d=new tt(e,n,o.maxBitrate,o.maxFramerate,o.priority);if(l&&tr(c)){const v=new v3(l),g=[];if(v.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const E=Kn();if(Oh()||xr()||(E==null?void 0:E.name)==="Chrome"&&Dr(E==null?void 0:E.version,"113")<0){const y=v.suffix=="h"?2:3,T=eQ(E);for(let R=0;R<v.spatial;R+=1)g.push({rid:$b[2-R],maxBitrate:o.maxBitrate/Math.pow(y,R),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:T?Math.pow(2,R):void 0});g[0].scalabilityMode=l}else g.push({maxBitrate:o.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(g[0].priority=d.encoding.priority,g[0].networkPriority=d.encoding.priority),Ee.debug("using svc encoding",{encodings:g}),g}if(!a)return[o];let f=[];t?f=(r=LA(i==null?void 0:i.screenShareSimulcastLayers))!==null&&r!==void 0?r:MA(t,d):f=(s=LA(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:MA(t,d);let p;if(f.length>0){const v=f[0];f.length>1&&([,p]=f);const g=Math.max(e,n);if(g>=960&&p)return x0(e,n,[v,p,d],u);if(g>=480)return x0(e,n,[v,d],u)}return x0(e,n,[d])}function rY(t,e,n){var i,r,s,o;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&Ee.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const a=t.mediaStreamTrack.getSettings(),l=(i=a.width)!==null&&i!==void 0?i:(r=t.dimensions)===null||r===void 0?void 0:r.width,c=(s=a.height)!==null&&s!==void 0?s:(o=t.dimensions)===null||o===void 0?void 0:o.height;return t.source===F.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),Wb(t.source===F.Source.ScreenShare,l,c,n)}function sY(t,e,n,i){const r=oY(t,e,n);let{encoding:s}=r[0];const o=Math.max(e,n);for(let a=0;a<r.length;a+=1){const l=r[a];if(s=l.encoding,l.width>=o)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function oY(t,e,n){if(t)return eY;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?XQ:ZQ}function MA(t,e){if(t)return iY(e);const{width:n,height:i}=e,r=n>i?n/i:i/n;return Math.abs(r-16/9)<Math.abs(r-4/3)?tY:nY}function x0(t,e,n,i){const r=[];if(n.forEach((s,o)=>{if(o>=$b.length)return;const a=Math.min(t,e),c={rid:$b[o],scaleResolutionDownBy:Math.max(1,a/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(c.maxFramerate=u);const d=Ya()||o===0;s.encoding.priority&&d&&(c.priority=s.encoding.priority,c.networkPriority=s.encoding.priority),r.push(c)}),xr()&&u3()==="ios"){let s;r.forEach(a=>{s?a.maxFramerate&&a.maxFramerate>s&&(s=a.maxFramerate):s=a.maxFramerate});let o=!0;r.forEach(a=>{var l;a.maxFramerate!=s&&(o&&(o=!1,Ee.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),Ee.info('Setting framerate of encoding "'.concat((l=a.rid)!==null&&l!==void 0?l:"",'" to ').concat(s)),a.maxFramerate=s)})}return r}function LA(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:r}=n;return i.maxBitrate>r.maxBitrate?1:i.maxBitrate<r.maxBitrate?-1:i.maxBitrate===r.maxBitrate&&i.maxFramerate&&r.maxFramerate?i.maxFramerate>r.maxFramerate?1:-1:0})}class v3{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function aY(t){return t.source===F.Source.ScreenShare||t.constraints.height&&Ao(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const lY=5e3;class yg extends g3{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,r=arguments.length>3?arguments[3]:void 0;super(e,F.Kind.Video,n,i,r),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>M(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(l){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}const o=new Map(s.map(l=>[l.rid,l])),a=s.some(l=>l.qualityLimitationReason==="cpu");if(a!==this.isCpuConstrained&&(this.isCpuConstrained=a,this.isCpuConstrained&&this.emit(X.CpuConstrained)),this.prevStats){let l=0;o.forEach((c,u)=>{var d;const f=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);l+=Nv(c,f)}),this._currentBitrate=l}this.prevStats=o}),this.senderLock=new Gn}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!ri())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},cC))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return M(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.pauseUpstream.call(this);try{for(var a=!0,l=ts(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0)s=c.value,a=!1,yield(o=s.sender)===null||o===void 0?void 0:o.replaceTrack(null)}catch(u){i={error:u}}finally{try{!a&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return M(this,void 0,void 0,function*(){var n,i,r,s,o;yield e.resumeUpstream.call(this);try{for(var a=!0,l=ts(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;a=!0){s=c.value,a=!1;const u=s;yield(o=u.sender)===null||o===void 0?void 0:o.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!a&&!n&&(r=l.return)&&(yield r.call(l))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return M(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===F.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return M(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===F.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return M(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(r=>{var s;if(r.type==="outbound-rtp"){const o={type:"video",streamId:r.id,frameHeight:r.frameHeight,frameWidth:r.frameWidth,framesPerSecond:r.framesPerSecond,framesSent:r.framesSent,firCount:r.firCount,pliCount:r.pliCount,nackCount:r.nackCount,packetsSent:r.packetsSent,bytesSent:r.bytesSent,qualityLimitationReason:r.qualityLimitationReason,qualityLimitationDurations:r.qualityLimitationDurations,qualityLimitationResolutionChanges:r.qualityLimitationResolutionChanges,rid:(s=r.rid)!==null&&s!==void 0?s:r.id,retransmittedPacketsSent:r.retransmittedPacketsSent,targetBitrate:r.targetBitrate,timestamp:r.timestamp},a=i.get(r.remoteId);a&&(o.jitter=a.jitter,o.packetsLost=a.packetsLost,o.roundTripTime=a.roundTripTime),n.push(o)}}),n.sort((r,s)=>{var o,a;return((o=s.frameWidth)!==null&&o!==void 0?o:0)-((a=r.frameWidth)!==null&&a!==void 0?a:0)}),n})}setPublishingQuality(e){const n=[];for(let i=_i.LOW;i<=_i.HIGH;i+=1)n.push(new WE({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(tr(this.codec),n)}restartTrack(e){return M(this,void 0,void 0,function*(){var n,i,r,s,o;let a;if(e){const d=tC({video:e});typeof d.video!="boolean"&&(a=d.video)}yield this.restart(a),this.isCpuConstrained=!1;try{for(var l=!0,c=ts(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;l=!0){s=u.value,l=!1;const d=s;d.sender&&((o=d.sender.transport)===null||o===void 0?void 0:o.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!l&&!n&&(r=c.return)&&(yield r.call(c))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return M(this,arguments,void 0,function(i){var r=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var o,a,l,c,u,d;if(yield n.setProcessor.call(r,i,s),!((u=r.processor)===null||u===void 0)&&u.processedTrack)try{for(var f=!0,p=ts(r.simulcastCodecs.values()),v;v=yield p.next(),o=v.done,!o;f=!0)c=v.value,f=!1,yield(d=c.sender)===null||d===void 0?void 0:d.replaceTrack(r.processor.processedTrack)}catch(g){a={error:g}}finally{try{!f&&!o&&(l=p.return)&&(yield l.call(p))}finally{if(a)throw a.error}}}()})}setDegradationPreference(e){return M(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},lY))}setPublishingCodecs(e){return M(this,void 0,void 0,function*(){var n,i,r,s,o,a,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(tr(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(n=!0,i=ts(e);r=yield i.next(),s=r.done,!s;n=!0){l=r.value,n=!1;const u=l;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(tr(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const f of u.qualities)if(f.enabled){c.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield UA(d.sender,d.encodings,u.qualities,this.senderLock,tr(u.codec),this.log,this.logContext))}}}catch(u){o={error:u}}finally{try{!n&&!s&&(a=i.return)&&(yield a.call(i))}finally{if(o)throw o.error}}return c})}setPublishingLayers(e,n){return M(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield UA(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return M(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,r)=>{var s;return Object.assign(Object.assign({},i),{active:r===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:r===0&&tr(this.codec)?"L1T3":void 0,maxFramerate:r===0?15:0,maxBitrate:r===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return M(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),l3()&&this.isInBackground&&this.source===F.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function UA(t,e,n,i,r,s,o){return M(this,void 0,void 0,function*(){const a=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},o),{sender:t,qualities:n,senderEncodings:e}));try{const l=t.getParameters(),{encodings:c}=l;if(!c)return;if(c.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},o),{encodings:c,senderEncodings:e}));return}let u=!1;!1&&c[0].scalabilityMode||(r&&n.some(p=>p.enabled)&&n.forEach(p=>p.enabled=!0),c.forEach((f,p)=>{var v;let g=(v=f.rid)!==null&&v!==void 0?v:"";g===""&&(g="q");const E=y3(g),y=n.find(T=>T.quality===E);y&&f.active!==y.enabled&&(u=!0,f.active=y.enabled,s.debug("setting layer ".concat(y.quality," to ").concat(f.active?"enabled":"disabled"),o),Ya()&&(y.enabled?(f.scaleResolutionDownBy=e[p].scaleResolutionDownBy,f.maxBitrate=e[p].maxBitrate,f.maxFrameRate=e[p].maxFrameRate):(f.scaleResolutionDownBy=4,f.maxBitrate=10,f.maxFrameRate=2)))})),u&&(l.encodings=c,s.debug("setting encodings",Object.assign(Object.assign({},o),{encodings:l.encodings})),yield t.setParameters(l))}finally{a()}})}function y3(t){switch(t){case"f":return _i.HIGH;case"h":return _i.MEDIUM;case"q":return _i.LOW;default:return _i.HIGH}}function VA(t,e,n,i){if(!n)return[new Ro({quality:_i.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const r=n[0].scalabilityMode,s=new v3(r),o=[],a=s.suffix=="h"?1.5:2,l=s.suffix=="h"?2:3;for(let c=0;c<s.spatial;c+=1)o.push(new Ro({quality:Math.min(_i.HIGH,s.spatial-1)-c,width:Math.ceil(t/Math.pow(a,c)),height:Math.ceil(e/Math.pow(a,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(l,c)):0,ssrc:0}));return o}return n.map(r=>{var s,o,a;const l=(s=r.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let c=y3((o=r.rid)!==null&&o!==void 0?o:"");return new Ro({quality:c,width:Math.ceil(t/l),height:Math.ceil(e/l),bitrate:(a=r.maxBitrate)!==null&&a!==void 0?a:0,ssrc:0})})}const FA="_lossy",jA="_reliable",cY=2*1e3,D0="leave-reconnect",uY=3e4,dY=8*1024,hY=256*1024;var Ii;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(Ii||(Ii={}));class fY extends Ur.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=aC.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=Ii.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=Ee,this.reliableDataSequence=1,this.reliableMessageBuffer=new wA,this.reliableReceivedState=new OQ(uY),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>M(this,[i],void 0,function(r){var s=this;let{channel:o}=r;return function*(){if(o){if(o.label===jA)s.reliableDCSub=o;else if(o.label===FA)s.lossyDCSub=o;else return;s.log.debug("on data channel ".concat(o.id,", ").concat(o.label),s.logContext),o.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>M(this,void 0,void 0,function*(){var r,s,o,a,l;const c=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const d=zn.fromBinary(new Uint8Array(u));if(d.sequence>0&&d.participantSid!==""){const f=this.reliableReceivedState.get(d.participantSid);if(f&&d.sequence<=f)return;this.reliableReceivedState.set(d.participantSid,d.sequence)}if(((r=d.value)===null||r===void 0?void 0:r.case)==="speaker")this.emit(te.ActiveSpeakersUpdate,d.value.value.speakers);else if(((s=d.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const f=yield(o=this.e2eeManager)===null||o===void 0?void 0:o.handleEncryptedData(d.value.value.encryptedValue,d.value.value.iv,d.participantIdentity,d.value.value.keyIndex),p=Z2.fromBinary(f.payload),v=new zn({value:p.value,participantIdentity:d.participantIdentity,participantSid:d.participantSid});((a=v.value)===null||a===void 0?void 0:a.case)==="user"&&BA(v,v.value.value),this.emit(te.DataPacketReceived,v,d.value.value.encryptionType)}else((l=d.value)===null||l===void 0?void 0:l.case)==="user"&&BA(d,d.value.value),this.emit(te.DataPacketReceived,d,Dt.NONE)}finally{c()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:o}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:o}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?ke.LOSSY:ke.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,r)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(te.Disconnected),this.close()},o=Date.now()-this.reconnectStart;let a=this.getNextRetryDelay({elapsedMs:o,retryCount:this.reconnectAttempts});if(a===null){s(o);return}i===D0&&(a=0),this.log.debug("reconnecting in ".concat(a,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=wn.setTimeout(()=>this.attemptReconnect(r).finally(()=>this.reconnectTimeout=void 0),a)},this.waitForRestarted=()=>new Promise((i,r)=>{this.pcState===Ii.Connected&&i();const s=()=>{this.off(te.Disconnected,o),i()},o=()=>{this.off(te.Restarted,s),r()};this.once(te.Restarted,s),this.once(te.Disconnected,o)}),this.updateAndEmitDCBufferStatus=i=>{if(i===ke.RELIABLE){const s=this.dataChannelForKind(i);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const r=this.isBufferStatusLow(i);typeof r<"u"&&r!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,r),this.emit(te.DCBufferStatusChanged,r,i))},this.isBufferStatusLow=i=>{const r=this.dataChannelForKind(i);if(r)return r.bufferedAmount<=r.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>M(this,void 0,void 0,function*(){!this.url||!(yield fetch(Nh(this.url),{method:"HEAD"}).then(r=>r.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===rt.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===rt.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(ba.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>M(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(Nh(this.url),{method:"HEAD"}),Rn(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=ws((n=e.loggerName)!==null&&n!==void 0?n:cr.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new iC(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Gn,this.dataProcessLock=new Gn,this.dcBufferStatus=new Map([[ke.LOSSY,!0],[ke.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(te.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(te.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(te.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(te.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(te.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(te.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(te.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(te.SignalRequestResponse,i)}get logContext(){var e,n,i,r,s,o;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(r=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||r===void 0?void 0:r.sid,participant:(o=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||o===void 0?void 0:o.identity,pID:this.participantSid}}join(e,n,i,r){return M(this,arguments,void 0,function(s,o,a,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){c.url=s,c.token=o,c.signalOpts=a,c.maxJoinAttempts=a.maxRetries;try{c.joinAttempts+=1,c.setupSignalClientCallbacks();const d=yield c.client.join(s,o,a,l,u);return c._isClosed=!1,c.latestJoinResponse=d,c.subscriberPrimary=d.subscriberPrimary,c.pcManager||(yield c.configure(d,!u)),(!c.subscriberPrimary||d.fastPublish)&&c.negotiate().catch(f=>{Ee.error(f,c.logContext)}),c.registerOnLineListener(),c.clientConfiguration=d.clientConfiguration,c.emit(te.SignalConnected,d),d}catch(d){if(d instanceof de){if(d.reason===st.ServerUnreachable){if(c.log.warn("Couldn't connect to server, attempt ".concat(c.joinAttempts," of ").concat(c.maxJoinAttempts),c.logContext),c.joinAttempts<c.maxJoinAttempts)return c.join(s,o,a,l,u)}else if(d.reason===st.ServiceNotFound)return c.log.warn("Initial connection failed: ".concat(d.message,"  Retrying")),c.join(s,o,a,l,!0)}throw d}}()})}close(){return M(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(te.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return M(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new wA,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return M(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new ns("a track with the same ID has already been published");return new Promise((n,i)=>{const r=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(de.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(r),n(s)},reject:()=>{clearTimeout(r),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return M(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e,n){return M(this,void 0,void 0,function*(){var i,r;if(this.pcManager&&this.pcManager.currentState!==Et.NEW)return;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid;const s=this.makeRTCConfiguration(e);this.pcManager=new qQ(s,n?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(te.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(o,a)=>{this.client.sendIceCandidate(o,a)},this.pcManager.onPublisherOffer=(o,a)=>{this.client.sendOffer(o,a)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(o,a,l)=>M(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(o),this.logContext),["closed","disconnected","failed"].includes(a)&&(this.publisherConnectionPromise=void 0),o===Et.CONNECTED){const d=this.pcState===Ii.New;this.pcState=Ii.Connected,d&&this.emit(te.Connected,e)}else o===Et.FAILED&&(this.pcState===Ii.Connected||this.pcState===Ii.Reconnecting)&&(this.pcState=Ii.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?ba.RR_SUBSCRIBER_FAILED:ba.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===rt.RECONNECTING,u=[Et.FAILED,Et.CLOSING,Et.CLOSED].includes(o);c&&u&&!this._isClosed&&this.emit(te.Offline)}),this.pcManager.onTrack=o=>{o.streams.length!==0&&this.emit(te.MediaTrackAdded,o.track,o.streams[0],o.receiver)},pY((r=e.serverInfo)===null||r===void 0?void 0:r.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>M(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>M(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const r=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);r&&this.client.sendAnswer(r,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(te.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(te.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(te.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(te.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(te.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const r={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",r);for(let s=0;s<e.numVideos;s++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",r);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",ba.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:p3,regionSettings:e.regions})),e.action){case dc.DISCONNECT:this.emit(te.Disconnected,e==null?void 0:e.reason),this.close();break;case dc.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(D0);break;case dc.RESUME:this.handleDisconnect(D0)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const r=[];e.iceServers.forEach(s=>{const o={urls:s.urls};s.username&&(o.username=s.username),s.credential&&(o.credential=s.credential),r.push(o)}),i.iceServers=r}return e.clientConfiguration&&e.clientConfiguration.forceRelay===Ah.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(FA,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(jA,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(ke.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,dY),hY)}},1e3))}createSender(e,n,i){return M(this,void 0,void 0,function*(){if(Bb())return yield this.createTransceiverRTCRtpSender(e,n,i);if(qb())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new At("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,r){return M(this,void 0,void 0,function*(){if(Bb())return this.createSimulcastTransceiverSender(e,n,i,r);if(qb())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new At("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new At("publisher is closed");const r=[];e.mediaStream&&r.push(e.mediaStream),Xo(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:r};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,r){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new At("publisher is closed");const s={direction:"sendonly"};r&&(s.sendEncodings=r);const o=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,o.sender),o.sender})}createRTCRtpSender(e){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new At("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return M(this,void 0,void 0,function*(){var n,i,r;if(!this._isClosed){if(this.attemptingReconnect){Ee.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===Ah.DISABLED||((r=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&r!==void 0?r:Et.NEW)===Et.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let o=!0;s instanceof At?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),o=!1):s instanceof Rl||(this.fullReconnectOnNext=!0),o?this.handleDisconnect("reconnect",ba.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(te.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return M(this,void 0,void 0,function*(){var n,i,r;try{if(!this.url||!this.token)throw new At("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(te.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Rl;s=yield this.join(e??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(o){throw o instanceof de&&o.reason===st.NotAllowed?new At("could not reconnect, token might be expired"):new Rl}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(te.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==rt.CONNECTED)throw new Rl("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(te.Restarted)}catch(s){const o=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(o){yield this.restartConnection(o);return}else throw(r=this.regionUrlProvider)===null||r===void 0||r.resetAttempts(),s}})}resumeConnection(e){return M(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new At("could not reconnect, url or token not saved");if(!this.pcManager)throw new At("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(te.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(r){let s="";throw r instanceof Error&&(s=r.message,this.log.error(r.message,Object.assign(Object.assign({},this.logContext),{error:r}))),r instanceof de&&r.reason===st.NotAllowed?new At("could not reconnect, token might be expired"):r instanceof de&&r.reason===st.LeaveRequest?r:new Rl(s)}if(this.emit(te.SignalResumed),i){const r=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(r),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==rt.CONNECTED)throw new Rl("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(te.Resumed)})}waitForPCInitialConnection(e,n){return M(this,void 0,void 0,function*(){if(!this.pcManager)throw new At("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return M(this,void 0,void 0,function*(){this.pcState=Ii.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Rn(cY),!this.pcManager)throw new At("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=Ii.Connected}catch(e){throw this.pcState=Ii.Disconnected,de.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,r){return M(this,void 0,void 0,function*(){const s=new zn({destinationIdentities:[e],kind:ke.RELIABLE,value:{case:"rpcResponse",value:new HE({requestId:n,value:r?{case:"error",value:r.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,ke.RELIABLE)})}publishRpcAck(e,n){return M(this,void 0,void 0,function*(){const i=new zn({destinationIdentities:[e],kind:ke.RELIABLE,value:{case:"rpcAck",value:new zE({requestId:n})}});yield this.sendDataPacket(i,ke.RELIABLE)})}sendDataPacket(e,n){return M(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=SQ(e);if(s){const o=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new X2({encryptedValue:o.payload,iv:o.iv,keyIndex:o.keyIndex})}}}n===ke.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),r=this.dataChannelForKind(n);if(r){if(n===ke.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;r.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return M(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(ke.RELIABLE);const n=this.dataChannelForKind(ke.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(ke.RELIABLE)})}waitForBufferStatusLow(e){return new Fn((n,i)=>M(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const r=()=>i(new At("engine closed"));for(this.once(te.Closing,r);!this.dcBufferStatus.get(e);)yield Rn(10);this.off(te.Closing,r),n()}}))}ensureDataTransportConnected(e){return M(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new At("PC manager is closed");const o=r?i.pcManager.subscriber:i.pcManager.publisher,a=r?"Subscriber":"Publisher";if(!o)throw de.internal("".concat(a," connection not set"));let l=!1;!r&&!i.dataChannelForKind(n,r)&&(i.createDataChannels(),l=!0),!l&&!r&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&i.negotiate().catch(d=>{Ee.error(d,i.logContext)});const c=i.dataChannelForKind(n,r);if((c==null?void 0:c.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(o.isICEConnected&&((s=i.dataChannelForKind(n,r))===null||s===void 0?void 0:s.readyState)==="open")return;yield Rn(50)}throw de.internal("could not establish ".concat(a," connection, state: ").concat(o.getICEConnectionState()))}()})}ensurePublisherConnected(e){return M(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Et.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return M(this,void 0,void 0,function*(){return new Fn((e,n)=>M(this,void 0,void 0,function*(){if(!this.pcManager){n(new fc("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,r=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n(new fc("cannot negotiate on closed engine")),this.on(te.Closing,r),this.pcManager.publisher.once(vc.RTPVideoPayloadTypes,s=>{const o=new Map;s.forEach(a=>{const l=a.codec.toLowerCase();sQ(l)&&o.set(a.payload,l)}),this.emit(te.RTPVideoMapUpdate,o)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof fc&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",ba.RR_UNKNOWN),s instanceof Error?n(s):n(new Error(String(s)))}finally{this.off(te.Closing,r)}}))})}dataChannelForKind(e,n){if(n){if(e===ke.LOSSY)return this.lossyDCSub;if(e===ke.RELIABLE)return this.reliableDCSub}else{if(e===ke.LOSSY)return this.lossyDC;if(e===ke.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,r,s,o;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const a=this.pcManager.publisher.getLocalDescription(),l=this.pcManager.publisher.getRemoteDescription(),c=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(r=this.pcManager.subscriber)===null||r===void 0?void 0:r.getLocalDescription(),d=(o=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&o!==void 0?o:!0,f=new Array,p=new Array;e.forEach(v=>{v.isDesired!==d&&f.push(v.trackSid),v.isEnabled||p.push(v.trackSid)}),this.client.sendSyncState(new QE({answer:this.pcManager.mode==="publisher-only"?l?Yl({sdp:l.sdp,type:l.type}):void 0:u?Yl({sdp:u.sdp,type:u.type}):void 0,offer:this.pcManager.mode==="publisher-only"?a?Yl({sdp:a.sdp,type:a.type}):void 0:c?Yl({sdp:c.sdp,type:c.type}):void 0,subscription:new xv({trackSids:f,subscribe:!d,participantTracks:[]}),publishTracks:qW(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:p,datachannelReceiveStates:this.reliableReceivedState.map((v,g)=>new TL({publisherSid:g,lastSeq:v}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,r)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new SL({label:i.label,id:i.id,target:r}))};return n(this.dataChannelForKind(ke.LOSSY),er.PUBLISHER),n(this.dataChannelForKind(ke.RELIABLE),er.PUBLISHER),n(this.dataChannelForKind(ke.LOSSY,!0),er.SUBSCRIBER),n(this.dataChannelForKind(ke.RELIABLE,!0),er.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&wn.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){ri()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){ri()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const r=Object.entries(this.midToTrackId).find(s=>{let[o]=s;return o===i});if(r)return r[1]}}}function pY(t){return t!==void 0&&t>13}function BA(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class _3{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new Pi("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),qn.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new Pi("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),qn.LengthExceeded)}}constructor(e,n,i,r){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=r}}class mY extends _3{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new Bi,i=null,r=null;if(this.signal){const o=this.signal;r=()=>{var a;(a=n.reject)===null||a===void 0||a.call(n,o.reason)},o.addEventListener("abort",r),i=o}const s=()=>{e.releaseLock(),i&&r&&i.removeEventListener("abort",r),this.signal=void 0};return{next:()=>M(this,void 0,void 0,function*(){var o,a;try{const{done:l,value:c}=yield Promise.race([e.read(),n.promise,(a=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&a!==void 0?a:new Promise(()=>{})]);return l?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(c),{done:!1,value:c.content})}catch(l){throw s(),l}}),return(){return M(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a=new Set;const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=ts(l),d;d=yield u.next(),i=d.done,!i;c=!0){o=d.value,c=!1;const f=o;a.add(f)}}catch(f){r={error:f}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return Array.from(a)}()})}}class gY extends _3{constructor(e,n,i,r){super(e,n,i,r),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=tm(e.chunkIndex),r=this.receivedChunks.get(i);if(r&&r.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new Bi,r=null,s=null;if(this.signal){const a=this.signal;s=()=>{var l;(l=i.reject)===null||l===void 0||l.call(i,a.reason)},a.addEventListener("abort",s),r=a}const o=()=>{e.releaseLock(),r&&s&&r.removeEventListener("abort",s),this.signal=void 0};return{next:()=>M(this,void 0,void 0,function*(){var a,l;try{const{done:c,value:u}=yield Promise.race([e.read(),i.promise,(l=(a=this.outOfBandFailureRejectingFuture)===null||a===void 0?void 0:a.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);if(c)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(f){throw new Pi("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(f),qn.DecodeFailed)}return{done:!1,value:d}}}catch(c){throw o(),c}}),return(){return M(this,void 0,void 0,function*(){return o(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return M(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,r,s,o;let a="";const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=ts(l),d;d=yield u.next(),i=d.done,!i;c=!0)o=d.value,c=!1,a+=o}catch(f){r={error:f}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(r)throw r.error}}return a}()})}}class vY{constructor(){this.log=Ee,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new Pi('A text stream handler for topic "'.concat(e,'" has already been set.'),qn.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new Pi('A byte stream handler for topic "'.concat(e,'" has already been set.'),qn.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,r,s;const o=Array.from(this.textStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e),a=Array.from(this.byteStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e);if(o.length>0||a.length>0){const l=new Pi("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),qn.AbnormalEnd);for(const[c,u]of a)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,l),this.byteStreamControllers.delete(c);for(const[c,u]of o)(s=(r=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(r,l),this.textStreamControllers.delete(c)}}handleDataStreamPacket(e,n){return M(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return M(this,void 0,void 0,function*(){var r;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let o;const a=new Bi;a.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,name:(r=e.contentHeader.value.name)!==null&&r!==void 0?r:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:tm(e.timestamp),attributes:e.attributes,encryptionType:i},c=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Pi("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),qn.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:l,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new mY(l,c,tm(e.totalLength),a),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let o;const a=new Bi;a.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i,attachedStreamIds:e.contentHeader.value.attachedStreamIds},c=new ReadableStream({start:u=>{if(o=u,this.textStreamControllers.has(e.streamId))throw new Pi("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),qn.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:l,controller:o,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:a})}});s(new gY(l,c,tm(e.totalLength),a),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new Pi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),qn.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const r=this.textStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?(r.controller.error(new Pi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),qn.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&r.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new Pi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),qn.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const r=this.byteStreamControllers.get(e.streamId);r&&(r.info.encryptionType!==n?r.controller.error(new Pi("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(r.info.encryptionType),qn.EncryptionTypeMismatch)):(r.info.attributes=Object.assign(Object.assign({},r.info.attributes),e.attributes),r.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class b3{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return M(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class yY extends b3{}class _Y extends b3{}const qA=15e3;class bY{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return M(this,void 0,void 0,function*(){var i;const r=crypto.randomUUID(),o=new TextEncoder().encode(e).byteLength,a=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),l=new Array(a?a.length+1:1).fill(0),c=(d,f)=>{var p;l[f]=d;const v=l.reduce((g,E)=>g+E,0);(p=n==null?void 0:n.onProgress)===null||p===void 0||p.call(n,v)},u=yield this.streamText({streamId:r,totalSize:o,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:a,attributes:n==null?void 0:n.attributes});return yield u.write(e),c(1,0),yield u.close(),n!=null&&n.attachments&&a&&(yield Promise.all(n.attachments.map((d,f)=>M(this,void 0,void 0,function*(){return this._sendFile(a[f],d,{topic:n.topic,mimeType:d.type,onProgress:p=>{c(p,f+1)}})})))),u.info})}streamText(e){return M(this,void 0,void 0,function*(){var n,i,r;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),o={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Dt.GCM:Dt.NONE,attachedStreamIds:e==null?void 0:e.attachedStreamIds},a=new pg({streamId:s,mimeType:o.mimeType,topic:o.topic,timestamp:Ta(o.timestamp),totalLength:Ta(e==null?void 0:e.totalSize),attributes:o.attributes,contentHeader:{case:"textHeader",value:new uL({version:e==null?void 0:e.version,attachedStreamIds:o.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?wb.UPDATE:wb.CREATE})}}),l=e==null?void 0:e.destinationIdentities,c=new zn({destinationIdentities:l,value:{case:"streamHeader",value:a}});yield this.engine.sendDataPacket(c,ke.RELIABLE);let u=0;const d=this.engine,f=new WritableStream({write(g){return M(this,void 0,void 0,function*(){for(const E of dQ(g,qA)){const y=new mg({content:E,streamId:s,chunkIndex:Ta(u)}),T=new zn({destinationIdentities:l,value:{case:"streamChunk",value:y}});yield d.sendDataPacket(T,ke.RELIABLE),u+=1}})},close(){return M(this,void 0,void 0,function*(){const g=new gg({streamId:s}),E=new zn({destinationIdentities:l,value:{case:"streamTrailer",value:g}});yield d.sendDataPacket(E,ke.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let p=()=>M(this,void 0,void 0,function*(){yield v.close()});d.once(te.Closing,p);const v=new yY(f,o,()=>this.engine.off(te.Closing,p));return v})}sendFile(e,n){return M(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return M(this,void 0,void 0,function*(){var r;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(r=i==null?void 0:i.mimeType)!==null&&r!==void 0?r:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),o=n.stream().getReader();for(;;){const{done:a,value:l}=yield o.read();if(a)break;yield s.write(l)}return yield s.close(),s.info})}streamBytes(e){return M(this,void 0,void 0,function*(){var n,i,r,s,o,a;const l=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,u={id:l,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(r=e==null?void 0:e.topic)!==null&&r!==void 0?r:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((o=this.engine.e2eeManager)===null||o===void 0)&&o.isDataChannelEncryptionEnabled?Dt.GCM:Dt.NONE},d=new pg({totalLength:Ta((a=u.size)!==null&&a!==void 0?a:0),mimeType:u.mimeType,streamId:l,topic:u.topic,timestamp:Ta(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new dL({name:u.name})}}),f=new zn({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(f,ke.RELIABLE);let p=0;const v=new Gn,g=this.engine,E=this.log,y=new WritableStream({write(R){return M(this,void 0,void 0,function*(){const b=yield v.lock();let w=0;try{for(;w<R.byteLength;){const D=R.slice(w,w+qA),C=new zn({destinationIdentities:c,value:{case:"streamChunk",value:new mg({content:D,streamId:l,chunkIndex:Ta(p)})}});yield g.sendDataPacket(C,ke.RELIABLE),p+=1,w+=D.byteLength}}finally{b()}})},close(){return M(this,void 0,void 0,function*(){const R=new gg({streamId:l}),b=new zn({destinationIdentities:c,value:{case:"streamTrailer",value:R}});yield g.sendDataPacket(b,ke.RELIABLE)})},abort(R){E.error("Sink error:",R)}});return new _Y(y,u)})}}class T3 extends F{constructor(e,n,i,r,s){super(e,i,s),this.sid=n,this.receiver=r}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?X.Muted:X.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(X.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return M(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),cC)),zW()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:r,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(X.TimeSyncUpdate,{timestamp:r,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class S3 extends T3{constructor(e,n,i,r,s,o){super(e,n,F.Kind.Audio,i,o),this.monitorReceiver=()=>M(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const a=yield this.getReceiverStats();a&&this.prevStats&&this.receiver&&(this._currentBitrate=Nv(a,this.prevStats)),this.prevStats=a}),this.audioContext=r,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;xr()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(xr())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return M(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(zb(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&zb(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(r=>{i.connect(r),i=r}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(X.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(r=>{this.emit(X.AudioPlaybackFailed,r)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return M(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const O0=100;class TY extends T3{constructor(e,n,i,r,s){super(e,n,F.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>M(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=Nv(o,this.prevStats)),this.prevStats=o}),this.debouncedHandleResize=sC(()=>{this.updateDimensions()},O0),this.adaptiveStreamSettings=r}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===F.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?pc(this._mediaStreamTrack,n):Ql(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new SY(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return M(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",r=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&r.set(s.id,s)}),n&&i!==""&&r.get(i)&&(n.mimeType=r.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return M(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const r=this.elementInfos.reduce((l,c)=>Math.max(l,c.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,o=this.elementInfos.some(l=>l.pictureInPicture),a=this.elementInfos.some(l=>l.visible)&&!s||o;if(!(this.lastVisible===a&&!e)){if(!a&&Date.now()-r<O0){wn.setTimeout(()=>{this.updateVisibility()},O0);return}this.lastVisible=a,this.emit(X.VisibilityChanged,a,this)}}updateDimensions(){var e,n;let i=0,r=0;const s=this.getPixelDensity();for(const o of this.elementInfos){const a=o.width()*s,l=o.height()*s;a+l>i+r&&(i=a,r=l)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===r||(this.lastDimensions={width:i,height:r},this.emit(X.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?gA():n||(gA()>2?2:1)}}class SY{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var r;const{target:s,isIntersecting:o}=i;s===this.element&&(this.isIntersecting=o,this.isPiP=od(this.element),this.visibilityChangedAt=Date.now(),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this))},this.onEnterPiP=()=>{var i,r,s;(r=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||r===void 0||r.addEventListener("pagehide",this.onLeavePiP),this.isPiP=od(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=od(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??Qb(e),this.isPiP=ri()&&od(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=Qb(this.element),this.isPiP=od(this.element),this.element.handleResize=()=>{var r;(r=this.handleResize)===null||r===void 0||r.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,yA().observe(this.element),vA().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,r,s;(e=yA())===null||e===void 0||e.unobserve(this.element),(n=vA())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(r=window.documentPictureInPicture)===null||r===void 0?void 0:r.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function od(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?Qb(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function Qb(t,e){const n=e||window;let i=t.offsetTop,r=t.offsetLeft;const s=t.offsetWidth,o=t.offsetHeight,{hidden:a}=t,{display:l}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,r+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&r<n.pageXOffset+n.innerWidth&&i+o>n.pageYOffset&&r+s>n.pageXOffset&&!a&&l!=="none"}class Jr extends Ur.EventEmitter{constructor(e,n,i,r){var s;super(),this.metadataMuted=!1,this.encryption=Dt.NONE,this.log=Ee,this.handleMuted=()=>{this.emit(X.Muted)},this.handleUnmuted=()=>{this.emit(X.Unmuted)},this.log=ws((s=r==null?void 0:r.loggerName)!==null&&s!==void 0?s:cr.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=F.Source.Unknown}setTrack(e){this.track&&(this.track.off(X.Muted,this.handleMuted),this.track.off(X.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(X.Muted,this.handleMuted),e.on(X.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),Ae(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Dt.NONE}get audioTrack(){if(wr(this.track))return this.track}get videoTrack(){if(Xo(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=F.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===F.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(Jr||(Jr={}));class Yb extends Jr{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.handleTrackEnded=()=>{this.emit(X.Ended)},this.handleCpuConstrained=()=>{this.track&&Xo(this.track)&&this.emit(X.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(X.Ended,this.handleTrackEnded),this.track.off(X.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(X.Ended,this.handleTrackEnded),e.on(X.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return M(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return M(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return M(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return M(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(wr(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(un.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(un.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(un.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(un.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(un.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(un.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function Mv(t,e){return M(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:r,optionsWithoutProcessor:s}=a3(t);let o=s.audio,a=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),r&&typeof s.video=="object"&&(s.video.processor=r),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,a=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const l=r3(s,h3,f3),c=tC(l),u=navigator.mediaDevices.getUserMedia(c);s.audio&&(hn.userMediaPromiseMap.set("audioinput",u),u.catch(()=>hn.userMediaPromiseMap.delete("audioinput"))),s.video&&(hn.userMediaPromiseMap.set("videoinput",u),u.catch(()=>hn.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(f=>M(this,void 0,void 0,function*(){const p=f.kind==="audio";let v=p?l.audio:l.video;(typeof v=="boolean"||!v)&&(v={});let g;const E=p?c.audio:c.video;typeof E!="boolean"&&(g=E);const y=f.getSettings().deviceId;g!=null&&g.deviceId&&Ao(g.deviceId)!==y?g.deviceId=y:g||(g={deviceId:y});const T=JQ(f,g,e);return T.kind===F.Kind.Video?T.source=F.Source.Camera:T.kind===F.Kind.Audio&&(T.source=F.Source.Microphone),T.mediaStream=d,wr(T)&&i?yield T.setProcessor(i):Xo(T)&&r&&(yield T.setProcessor(r)),T})))}catch(d){if(!n)throw d;return Mv(Object.assign(Object.assign({},t),{audio:o,video:a}),e)}})}function EY(t){return M(this,void 0,void 0,function*(){return(yield Mv({audio:!1,video:!0}))[0]})}function CY(t){return M(this,void 0,void 0,function*(){return(yield Mv({audio:!0,video:!1}))[0]})}var eo;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(eo||(eo={}));function kY(t){switch(t){case yd.EXCELLENT:return eo.Excellent;case yd.GOOD:return eo.Good;case yd.POOR:return eo.Poor;case yd.LOST:return eo.Lost;default:return eo.Unknown}}class E3 extends Ur.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Ih.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===uc.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,r,s,o){let a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Ih.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=eo.Unknown,this.log=Ee,this.log=ws((l=o==null?void 0:o.loggerName)!==null&&l!==void 0?l:cr.Participant),this.loggerOptions=o,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=r,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=a,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new Bi,this.once($.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(F.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(F.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(F.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===uc.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==uc.ACTIVE&&this.emit($.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit($.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit($.ParticipantNameChanged,e)}_setAttributes(e){const n=HW(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit($.AttributesChanged,n)}setPermissions(e){var n,i,r,s,o,a;const l=this.permissions,c=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((r=this.permissions)===null||r===void 0?void 0:r.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((o=this.permissions)===null||o===void 0?void 0:o.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var f;return u!==((f=this.permissions)===null||f===void 0?void 0:f.canPublishSources[d])})||e.canSubscribeMetrics!==((a=this.permissions)===null||a===void 0?void 0:a.canSubscribeMetrics);return this.permissions=e,c&&this.emit($.ParticipantPermissionsChanged,l),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit($.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=kY(e),n!==this._connectionQuality&&this.emit($.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>wr(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(X.Muted,()=>{this.emit($.TrackMuted,e)}),e.on(X.Unmuted,()=>{this.emit($.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case F.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case F.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function wY(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new _L({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class RY extends E3{constructor(e,n,i,r,s,o){super(e,n,void 0,void 0,void 0,{loggerName:r.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Dt.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new Bi)},this.handleReconnected=()=>{var a,l;(l=(a=this.reconnectFuture)===null||a===void 0?void 0:a.resolve)===null||l===void 0||l.call(a),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var a,l,c,u,d,f;this.reconnectFuture&&(this.reconnectFuture.promise.catch(p=>this.log.warn(p.message,this.logContext)),(l=(a=this.reconnectFuture)===null||a===void 0?void 0:a.reject)===null||l===void 0||l.call(a,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(c=this.signalConnectedFuture).reject)===null||u===void 0||u.call(c,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(f=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||f===void 0||f.call(d,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=a=>{var l,c;a.participant&&this.updateInfo(a.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new Bi),(c=(l=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(l)},this.handleSignalRequestResponse=a=>{const{requestId:l,reason:c,message:u}=a,d=this.pendingSignalRequests.get(l);d&&(c!==YE.OK&&d.reject(new dA(u,c)),this.pendingSignalRequests.delete(l))},this.handleDataPacket=a=>{switch(a.value.case){case"rpcResponse":let l=a.value.value,c=null,u=null;l.value.case==="payload"?c=l.value.value:l.value.case==="error"&&(u=wt.fromProto(l.value.value)),this.handleIncomingRpcResponse(l.requestId,c,u);break;case"rpcAck":let d=a.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(a=>wY(a)))},this.onTrackUnmuted=a=>{this.onTrackMuted(a,a.isUpstreamPaused)},this.onTrackMuted=(a,l)=>{if(l===void 0&&(l=!0),!a.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),Ae(a)));return}this.engine.updateMuteStatus(a.sid,l)},this.onTrackUpstreamPaused=a=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),Ae(a))),this.onTrackMuted(a,!0)},this.onTrackUpstreamResumed=a=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),Ae(a))),this.onTrackMuted(a,a.isMuted)},this.onTrackFeatureUpdate=a=>{const l=this.audioTrackPublications.get(a.sid);if(!l){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(a.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(l.trackSid,l.getTrackFeatures())},this.onTrackCpuConstrained=(a,l)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),Ae(l))),this.emit($.LocalTrackCpuConstrained,a,l)},this.handleSubscribedQualityUpdate=a=>M(this,void 0,void 0,function*(){var l,c,u,d,f;if(!(!((f=this.roomOptions)===null||f===void 0)&&f.dynacast))return;const p=this.videoTrackPublications.get(a.trackSid);if(!p){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}if(!p.videoTrack)return;const v=yield p.videoTrack.setPublishingCodecs(a.subscribedCodecs);try{for(var g=!0,E=ts(v),y;y=yield E.next(),l=y.done,!l;g=!0){d=y.value,g=!1;const T=d;FW(T)&&(this.log.debug("publish ".concat(T," for ").concat(p.videoTrack.sid),Object.assign(Object.assign({},this.logContext),Ae(p))),yield this.publishAdditionalCodecForTrack(p.videoTrack,T,p.options))}}catch(T){c={error:T}}finally{try{!g&&!l&&(u=E.return)&&(yield u.call(E))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=a=>{const l=this.trackPublications.get(a.trackSid);if(!l){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:a.trackSid}));return}this.unpublishTrack(l.track)},this.handleTrackEnded=a=>M(this,void 0,void 0,function*(){if(a.source===F.Source.ScreenShare||a.source===F.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),Ae(a))),this.unpublishTrack(a);else if(a.isUserProvided)yield a.mute();else if(Qr(a)||Hs(a))try{if(ri())try{const l=yield navigator==null?void 0:navigator.permissions.query({name:a.source===F.Source.Camera?"camera":"microphone"});if(l&&l.state==="denied")throw this.log.warn("user has revoked access to ".concat(a.source),Object.assign(Object.assign({},this.logContext),Ae(a))),l.onchange=()=>{l.state!=="denied"&&(a.isMuted||a.restartTrack(),l.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}a.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),Ae(a))),Qr(a)?yield a.restartTrack({deviceId:"default"}):yield a.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),Ae(a))),yield a.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=r,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=o}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Dt.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(te.RemoteMute,(i,r)=>{const s=this.trackPublications.get(i);!s||!s.track||(r?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(te.Connected,this.handleReconnected).on(te.SignalConnected,this.handleSignalConnected).on(te.SignalRestarted,this.handleReconnected).on(te.SignalResumed,this.handleReconnected).on(te.Restarting,this.handleReconnecting).on(te.Resuming,this.handleReconnecting).on(te.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(te.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(te.Closing,this.handleClosing).on(te.SignalRequestResponse,this.handleSignalRequestResponse).on(te.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return M(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return M(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return M(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return M(this,arguments,void 0,function(n){var i=this;let{metadata:r,name:s,attributes:o}=n;return function*(){return new Fn((a,l)=>M(i,void 0,void 0,function*(){var c,u;try{let d=!1;const f=yield this.engine.client.sendUpdateLocalMetadata((c=r??this.metadata)!==null&&c!==void 0?c:"",(u=s??this.name)!==null&&u!==void 0?u:"",o),p=performance.now();for(this.pendingSignalRequests.set(f,{resolve:a,reject:v=>{l(v),d=!0},values:{name:s,metadata:r,attributes:o}});performance.now()-p<5e3&&!d;){if((!s||this.name===s)&&(!r||this.metadata===r)&&(!o||Object.entries(o).every(v=>{let[g,E]=v;return this.attributes[g]===E||E===""&&!this.attributes[g]}))){this.pendingSignalRequests.delete(f),a();return}yield Rn(50)}l(new dA("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error?l(d):l(new Error(String(d)))}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(F.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(F.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(F.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return M(this,void 0,void 0,function*(){this.encryptionType=e?Dt.GCM:Dt.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,r){return M(this,void 0,void 0,function*(){var s,o;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let a=this.getTrackPublication(e);if(n)if(a)yield a.unmute();else{let l;if(this.pendingPublishing.has(e)){const c=yield this.waitForPendingPublicationOfSource(e);return c||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield c==null?void 0:c.unmute(),c}this.pendingPublishing.add(e);try{switch(e){case F.Source.Camera:l=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case F.Source.Microphone:l=yield this.createTracks({audio:(o=i)!==null&&o!==void 0?o:!0});break;case F.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},i));break;default:throw new ns(e)}}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c instanceof Error&&this.emit($.MediaDevicesError,c,jb(e)),this.pendingPublishing.delete(e),c}for(const c of l){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===F.Source.Microphone&&wr(c)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),c.startPreConnectBuffer())}try{const c=[];for(const d of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),Ae(d))),c.push(this.publishTrack(d,r));[a]=yield Promise.all(c)}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c}finally{this.pendingPublishing.delete(e)}}else if(!(a!=null&&a.track)&&this.pendingPublishing.has(e)&&(a=yield this.waitForPendingPublicationOfSource(e),a||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),a&&a.track)if(e===F.Source.ScreenShare){a=yield this.unpublishTrack(a.track);const l=this.getTrackPublication(F.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield a.mute();return a})}enableCameraAndMicrophone(){return M(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(F.Source.Camera)||this.pendingPublishing.has(F.Source.Microphone))){this.pendingPublishing.add(F.Source.Camera),this.pendingPublishing.add(F.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(F.Source.Camera),this.pendingPublishing.delete(F.Source.Microphone)}}})}createTracks(e){return M(this,void 0,void 0,function*(){var n,i;e??(e={});const r=r3(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield Mv(r,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(a=>(wr(a)&&(this.microphoneError=void 0,a.setAudioContext(this.audioContext),a.source=F.Source.Microphone,this.emit($.AudioStreamAcquired)),Xo(a)&&(this.cameraError=void 0,a.source=F.Source.Camera),a))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return M(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new ZE("getDisplayMedia not supported");e.resolution===void 0&&!ZW()&&(e.resolution=eC.h1080fps30.resolution);const n=BW(e),i=yield navigator.mediaDevices.getDisplayMedia(n),r=i.getVideoTracks();if(r.length===0)throw new ns("no video track found");const s=new yg(r[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=F.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const o=[s];if(i.getAudioTracks().length>0){this.emit($.AudioStreamAcquired);const a=new vg(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});a.source=F.Source.ScreenShareAudio,o.push(a)}return o})}publishTrack(e,n){return M(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return M(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var a,l,c,u;Qr(i)&&i.setAudioContext(s.audioContext),yield(a=s.reconnectFuture)===null||a===void 0?void 0:a.promise,s.republishPromise&&!o&&(yield s.republishPromise),mc(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let y;switch(i.source){case F.Source.Microphone:y="audioinput";break;case F.Source.Camera:y="videoinput"}y&&s.activeDeviceMap.has(y)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(y)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new vg(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new yg(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new ns("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let f;if(s.trackPublications.forEach(y=>{y.track&&y.track===i&&(f=y)}),f)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),Ae(f))),f;const p=Object.assign(Object.assign({},s.roomOptions.publishDefaults),r),v="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(l=p.forceStereo)!==null&&l!==void 0?l:v;g&&(p.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),Ae(i))),p.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(c=p.dtx)!==null&&c!==void 0||(p.dtx=!1),(u=p.red)!==null&&u!==void 0||(p.red=!1)),!tQ()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),p.simulcast=!1),p.source&&(i.source=p.source);const E=new Promise((y,T)=>M(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==rt.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:Ae(i)}));let R=!1;const b=setTimeout(()=>{R=!0,i.stop(),T(new uA("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(b),R)return;const w=yield this.publish(i,p,g);y(w)}else try{const R=yield this.publish(i,p,g);y(R)}catch(R){T(R)}}catch(R){T(R)}}));s.pendingPublishPromises.set(i,E);try{return yield E}catch(y){throw y}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new Bi),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),Ae(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(r=>GW(r)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),Ae(e))),!1)}publish(e,n,i){return M(this,void 0,void 0,function*(){var r,s,o,a,l,c,u,d,f,p;if(!this.hasPermissionsToPublish(e))throw new uA("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(S=>mc(e)&&S.source===e.source)&&e.source!==F.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),Ae(e))),n.stopMicTrackOnMute&&wr(e)&&(e.stopOnMute=!0),e.source===F.Source.ScreenShare&&Ya()&&(n.simulcast=!1),n.videoCodec==="av1"&&!YW()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!JW()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=Kb),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(S=>n.videoCodec===Kd(S.mime))||(n.videoCodec=Kd(this.enabledPublishVideoCodecs[0].mime)));const g=n.videoCodec;e.on(X.Muted,this.onTrackMuted),e.on(X.Unmuted,this.onTrackUnmuted),e.on(X.Ended,this.handleTrackEnded),e.on(X.UpstreamPaused,this.onTrackUpstreamPaused),e.on(X.UpstreamResumed,this.onTrackUpstreamResumed),e.on(X.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const E=[],y=!(!((r=n.dtx)!==null&&r!==void 0)||r),T=e.getSourceTrackSettings();T.autoGainControl&&E.push(un.TF_AUTO_GAIN_CONTROL),T.echoCancellation&&E.push(un.TF_ECHO_CANCELLATION),T.noiseSuppression&&E.push(un.TF_NOISE_SUPPRESSION),T.channelCount&&T.channelCount>1&&E.push(un.TF_STEREO),y&&E.push(un.TF_NO_DTX),Qr(e)&&e.hasPreConnectBuffer&&E.push(un.TF_PRECONNECT_BUFFER);const R=new Ph({cid:e.mediaStreamTrack.id,name:n.name,type:F.kindToProto(e.kind),muted:e.isMuted,source:F.sourceToProto(e.source),disableDtx:y,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:E});let b;if(e.kind===F.Kind.Video){let S={width:0,height:0};try{S=yield e.waitForDimensions()}catch{const I=(a=(o=this.roomOptions.videoCaptureDefaults)===null||o===void 0?void 0:o.resolution)!==null&&a!==void 0?a:Dh.h720.resolution;S={width:I.width,height:I.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),Ae(e)),{dims:S}))}R.width=S.width,R.height=S.height,Hs(e)&&(tr(g)&&(e.source===F.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),Ae(e))))),n.scalabilityMode=(l=n.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),R.simulcastCodecs=[new Ab({codec:g,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:Kb}),n.backupCodec&&g!==n.backupCodec.codec&&R.encryption===Dt.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),R.simulcastCodecs.push(new Ab({codec:n.backupCodec.codec,cid:""})))),b=Wb(e.source===F.Source.ScreenShare,R.width,R.height,n),R.layers=VA(R.width,R.height,b,tr(n.videoCodec))}else e.kind===F.Kind.Audio&&(b=[{maxBitrate:(c=n.audioPreset)===null||c===void 0?void 0:c.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(p=(f=n.audioPreset)===null||f===void 0?void 0:f.priority)!==null&&p!==void 0?p:"high"}]);if(!this.engine||this.engine.isClosed)throw new At("cannot publish track when not connected");const w=()=>M(this,void 0,void 0,function*(){var S,A,I;if(!this.engine.pcManager)throw new At("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,b),this.emit($.LocalSenderCreated,e.sender,e),Hs(e)&&((S=n.degradationPreference)!==null&&S!==void 0||(n.degradationPreference=aY(e)),e.setDegradationPreference(n.degradationPreference)),b)if(Ya()&&e.kind===F.Kind.Audio){let N;for(const O of this.engine.pcManager.publisher.getTransceivers())if(O.sender===e.sender){N=O;break}N&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:N,codec:"opus",maxbr:!((A=b[0])===null||A===void 0)&&A.maxBitrate?b[0].maxBitrate/1e3:0})}else e.codec&&tr(e.codec)&&(!((I=b[0])===null||I===void 0)&&I.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:R.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()});let D;const C=new Promise((S,A)=>M(this,void 0,void 0,function*(){var I;try{D=yield this.engine.addTrack(R),S(D)}catch(N){e.sender&&(!((I=this.engine.pcManager)===null||I===void 0)&&I.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(O=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),Ae(e)),{error:O}))})),A(N)}}));if(this.enabledPublishVideoCodecs.length>0)D=(yield Promise.all([C,w()]))[0];else{D=yield C;let S;if(D.codecs.forEach(A=>{S===void 0&&(S=A.mimeType)}),S&&e.kind===F.Kind.Video){const A=Kd(S);A!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),Ae(e)),{codec:A})),n.videoCodec=A,b=Wb(e.source===F.Source.ScreenShare,R.width,R.height,n))}yield w()}const k=new Yb(e.kind,D,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(k.on(X.CpuConstrained,S=>this.onTrackCpuConstrained(S,k)),k.options=n,e.sid=D.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:D})),Hs(e)?e.startMonitor(this.engine.client):Qr(e)&&e.startMonitor(),this.addTrackPublication(k),this.emit($.LocalTrackPublished,k),Qr(e)&&D.audioFeatures.includes(un.TF_PRECONNECT_BUFFER)){const S=e.getPreConnectBuffer(),A=e.getPreConnectBufferMimeType();this.on($.LocalTrackSubscribed,I=>{if(I.trackSid===D.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),Ae(e))),e.stopPreConnectBuffer()}}),S&&new Promise((N,O)=>M(this,void 0,void 0,function*(){var he,Ye,J,re,se,be;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),Ae(e)));const gn=setTimeout(()=>{O(new Error("agent not active within 10 seconds"))},1e4),en=yield this.waitUntilActiveAgentPresent();clearTimeout(gn),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),Ae(e)));const Dn=yield this.streamBytes({name:"preconnect-buffer",mimeType:A,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[en.identity],attributes:{trackId:k.trackSid,sampleRate:String((se=T.sampleRate)!==null&&se!==void 0?se:"48000"),channels:String((be=T.channelCount)!==null&&be!==void 0?be:"1")}});try{for(var ze=!0,xn=ts(S),Zt;Zt=yield xn.next(),he=Zt.done,!he;ze=!0){re=Zt.value,ze=!1;const di=re;yield Dn.write(di)}}catch(di){Ye={error:di}}finally{try{!ze&&!he&&(J=xn.return)&&(yield J.call(xn))}finally{if(Ye)throw Ye.error}}yield Dn.close(),N()}catch(gn){O(gn)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),Ae(e)))}).catch(N=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),Ae(e)),{error:N}))})}return k})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return M(this,void 0,void 0,function*(){var r;if(this.encryptionType!==Dt.NONE)return;let s;if(this.trackPublications.forEach(p=>{p.track&&p.track===e&&(s=p)}),!s)throw new ns("track is not published");if(!Hs(e))throw new ns("track is not a video track");const o=Object.assign(Object.assign({},(r=this.roomOptions)===null||r===void 0?void 0:r.publishDefaults),i),a=rY(e,n,o);if(!a){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),Ae(e)));return}const l=e.addSimulcastTrack(n,a);if(!l)return;const c=new Ph({cid:l.mediaStreamTrack.id,type:F.kindToProto(e.kind),muted:e.isMuted,source:F.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:o.videoCodec,cid:l.mediaStreamTrack.id}]});if(c.layers=VA(c.width,c.height,a),!this.engine||this.engine.isClosed)throw new At("cannot publish track when not connected");const u=()=>M(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,l,o,a),yield this.engine.negotiate()}),f=(yield Promise.all([this.engine.addTrack(c),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:a,trackInfo:f}))})}unpublishTrack(e,n){return M(this,void 0,void 0,function*(){var i,r;if(mc(e)){const c=this.pendingPublishPromises.get(e);c&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),Ae(e))),yield c)}const s=this.getPublicationForTrack(e),o=s?Ae(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),o)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),o));return}e=s.track,e.off(X.Muted,this.onTrackMuted),e.off(X.Unmuted,this.onTrackUnmuted),e.off(X.Ended,this.handleTrackEnded),e.off(X.UpstreamPaused,this.onTrackUpstreamPaused),e.off(X.UpstreamResumed,this.onTrackUpstreamResumed),e.off(X.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(r=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&r!==void 0?r:!0),n?e.stop():e.stopMonitor();let a=!1;const l=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Et.FAILED&&l)try{for(const c of this.engine.pcManager.publisher.getTransceivers())c.sender===l&&(c.direction="inactive",a=!0);if(this.engine.removeTrack(l)&&(a=!0),Hs(e)){for(const[,c]of e.simulcastCodecs)c.sender&&(this.engine.removeTrack(c.sender)&&(a=!0),c.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),o),{error:c}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case F.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case F.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit($.LocalTrackUnpublished,s),s.setTrack(void 0),a&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return M(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return M(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Fn((s,o)=>M(i,void 0,void 0,function*(){try{const a=[];this.trackPublications.forEach(l=>{l.track&&(n&&(l.options=Object.assign(Object.assign({},l.options),n)),a.push(l))}),yield Promise.all(a.map(l=>M(this,void 0,void 0,function*(){const c=l.track;yield this.unpublishTrack(c,!1),r&&!c.isMuted&&c.source!==F.Source.ScreenShare&&c.source!==F.Source.ScreenShareAudio&&(Qr(c)||Hs(c))&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:l.trackSid})),yield c.restartTrack()),yield this.publishOrRepublishTrack(c,l.options,!0)}))),s()}catch(a){a instanceof Error?o(a):o(new Error(String(a)))}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return M(this,arguments,void 0,function(n){var i=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=r.reliable?ke.RELIABLE:ke.LOSSY,o=r.destinationIdentities,a=r.topic;let l=new BE({participantIdentity:i.identity,payload:n,destinationIdentities:o,topic:a});const c=new zn({kind:s,value:{case:"user",value:l}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return M(this,void 0,void 0,function*(){const i=new zn({kind:ke.RELIABLE,value:{case:"sipDtmf",value:new tL({code:e,digit:n})}});yield this.engine.sendDataPacket(i,ke.RELIABLE)})}sendChatMessage(e,n){return M(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},r=new zn({value:{case:"chatMessage",value:new fg(Object.assign(Object.assign({},i),{timestamp:_t.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(r,ke.RELIABLE),this.emit($.ChatMessage,i),i})}editChatMessage(e,n){return M(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),r=new zn({value:{case:"chatMessage",value:new fg(Object.assign(Object.assign({},i),{timestamp:_t.parse(i.timestamp),editTimestamp:_t.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(r,ke.RELIABLE),this.emit($.ChatMessage,i),i})}sendText(e,n){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return M(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){let{destinationIdentity:n,method:i,payload:r,responseTimeout:s=15e3}=e;const o=7e3,a=o+1e3;return new Fn((l,c)=>M(this,void 0,void 0,function*(){var u,d,f,p;if(lC(r)>m3){c(wt.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((d=(u=this.engine.latestJoinResponse)===null||u===void 0?void 0:u.serverInfo)===null||d===void 0)&&d.version&&Dr((p=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||p===void 0?void 0:p.version,"1.8.0")<0){c(wt.builtIn("UNSUPPORTED_SERVER"));return}const v=Math.max(s,a),g=crypto.randomUUID();yield this.publishRpcRequest(n,g,i,r,v);const E=setTimeout(()=>{this.pendingAcks.delete(g),c(wt.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(g),clearTimeout(y)},o);this.pendingAcks.set(g,{resolve:()=>{clearTimeout(E)},participantIdentity:n});const y=setTimeout(()=>{this.pendingResponses.delete(g),c(wt.builtIn("RESPONSE_TIMEOUT"))},s);this.pendingResponses.set(g,{resolve:(T,R)=>{clearTimeout(y),this.pendingAcks.has(g)&&(this.log.warn("RPC response received before ack",g),this.pendingAcks.delete(g),clearTimeout(E)),R?c(R):l(T??"")},participantIdentity:n})}))}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const r=this.pendingResponses.get(e);r?(r.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,r,s){return M(this,void 0,void 0,function*(){const o=new zn({destinationIdentities:[e],kind:ke.RELIABLE,value:{case:"rpcRequest",value:new qE({id:n,method:i,payload:r,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(o,ke.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:r}]of this.pendingResponses)i===e&&(r(null,wt.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,r;const s=this.trackPublications.get(n.sid);if(s){const o=s.isMuted||((r=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&r!==void 0?r:!1);o!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),Ae(s)),{mutedOnServer:o})),this.engine.client.sendMuteTrack(n.sid,o))}}),!0):!1}setActiveAgent(e){var n,i,r,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(r=this.activeAgentFuture)===null||r===void 0?void 0:r.reject)===null||s===void 0||s.call(r,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new Bi),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const r=i.track;r&&(e instanceof MediaStreamTrack?(Qr(r)||Hs(r))&&r.mediaStreamTrack===e&&(n=i):e===r&&(n=i))}),n}waitForPendingPublicationOfSource(e){return M(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const r=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[o]=s;return o.source===e});if(r)return r[1];yield Rn(20)}})}}class C3 extends Jr{constructor(e,n,i,r){super(e,n.sid,n.name,r),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(X.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const r=new xv({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new iL({participantSid:"",trackSids:[this.trackSid]})]});this.emit(X.UpdateSubscription,r),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?Jr.SubscriptionStatus.Unsubscribed:super.isSubscribed?Jr.SubscriptionStatus.Subscribed:Jr.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?Jr.PermissionStatus.Allowed:Jr.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(w0(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&w0(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:_i.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,r=this.track;r!==e&&(r&&(r.off(X.VideoDimensionsChanged,this.handleVideoDimensionsChange),r.off(X.VisibilityChanged,this.handleVisibilityChange),r.off(X.Ended,this.handleEnded),r.detach(),r.stopMonitor(),this.emit(X.Unsubscribed,r)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(X.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(X.VisibilityChanged,this.handleVisibilityChange),e.on(X.Ended,this.handleEnded),this.emit(X.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(X.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?X.Muted:X.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(X.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(X.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return w0(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new mL({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===F.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)fA(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=KW(this.trackInfo,this.requestedMaxQuality);i&&fA(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:_i.HIGH})),e.quality=_i.HIGH)}this.emit(X.UpdateSettings,e)}}class _g extends E3{static fromParticipantInfo(e,n,i){return new _g(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,r,s,o,a){let l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Ih.STANDARD;super(n,i||"",r,s,o,a,l),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(X.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),Ae(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(X.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(X.SubscriptionPermissionChanged,n=>{this.emit($.TrackSubscriptionPermissionChanged,e,n)}),e.on(X.SubscriptionStatusChanged,n=>{this.emit($.TrackSubscriptionStatusChanged,e,n)}),e.on(X.Subscribed,n=>{this.emit($.TrackSubscribed,n,e)}),e.on(X.Unsubscribed,n=>{this.emit($.TrackUnsubscribed,n,e)}),e.on(X.SubscriptionFailed,n=>{this.emit($.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:F.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:F.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,r,s,o){let a=this.getTrackPublicationBySid(n);if(a||n.startsWith("TR")||this.trackPublications.forEach(u=>{!a&&e.kind===u.kind.toString()&&(a=u)}),!a){if(o===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit($.TrackSubscriptionFailed,n);return}o===void 0&&(o=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,r,s,o-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),Ae(a))),this.emit($.TrackSubscriptionFailed,n);return}const l=e.kind==="video";let c;return l?c=new TY(e,n,r,s):c=new S3(e,n,r,this.audioContext,this.audioOutput),c.source=a.source,c.isMuted=a.isMuted,c.setMediaStream(i),c.start(),a.setTrack(c),this.volumeMap.has(a.source)&&Hb(c)&&wr(c)&&c.setVolume(this.volumeMap.get(a.source)),a}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(r=>{var s,o;let a=this.getTrackPublicationBySid(r.sid);if(a)a.updateInfo(r);else{const l=F.kindFromProto(r.type);if(!l)return;a=new C3(l,r,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(o=this.loggerOptions)===null||o===void 0?void 0:o.loggerName}),a.updateInfo(r),i.set(r.sid,a);const c=Array.from(this.trackPublications.values()).find(u=>u.source===(a==null?void 0:a.source));c&&a.source!==F.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(a.source),Object.assign(Object.assign({},this.logContext),{oldTrack:Ae(c),newTrack:Ae(a)})),this.addTrackPublication(a)}n.set(r.sid,a)}),this.trackPublications.forEach(r=>{n.has(r.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),Ae(r))),this.unpublishTrack(r.trackSid,!0))}),i.forEach(r=>{this.emit($.TrackPublished,r)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:r}=i;switch(r&&(r.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case F.Kind.Audio:this.audioTrackPublications.delete(e);break;case F.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit($.TrackUnpublished,i)}setAudioOutput(e){return M(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var r;wr(i.track)&&Hb(i.track)&&n.push(i.track.setSinkId((r=e.deviceId)!==null&&r!==void 0?r:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var qe;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(qe||(qe={}));const AY=4*1e3;class Rs extends Ur.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,r,s,o;if(super(),n=this,this.state=qe.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=Ee,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(a,l,c)=>M(this,void 0,void 0,function*(){var u;if(!XW())throw xr()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===qe.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(qe.Connecting),((u=this.regionUrlProvider)===null||u===void 0?void 0:u.getServerUrl().toString())!==d3(a)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),Hc(new URL(a))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new Be(a,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(v=>{var g;(g=this.regionUrlProvider)===null||g===void 0||g.setServerReportedRegions(v)}).catch(v=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:v}))}));const f=(v,g,E)=>M(this,void 0,void 0,function*(){var y,T;this.abortController&&this.abortController.abort();const R=new AbortController;this.abortController=R,d==null||d();try{if(yield gc.getInstance().getBackOffPromise(a),R.signal.aborted)throw de.cancelled("Connection attempt aborted");yield this.attemptConnection(E??a,l,c,R),this.abortController=void 0,v()}catch(b){if(this.regionUrlProvider&&b instanceof de&&b.reason!==st.Cancelled&&b.reason!==st.NotAllowed){let w=null;try{this.log.debug("Fetching next region"),w=yield this.regionUrlProvider.getNextBestRegionUrl((y=this.abortController)===null||y===void 0?void 0:y.signal)}catch(D){if(D instanceof de&&(D.status===401||D.reason===st.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),g(D);return}}[st.InternalError,st.ServerUnreachable,st.Timeout].includes(b.reason)&&(this.log.debug("Adding failed connection attempt to back off"),gc.getInstance().addFailedConnectionAttempt(a)),w&&!(!((T=this.abortController)===null||T===void 0)&&T.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(b.message,". Retrying with another region: ").concat(w),this.logContext),this.recreateEngine(),yield f(v,g,w)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,bA(b)),g(b))}else{let w=sr.UNKNOWN_REASON;b instanceof de&&(w=bA(b)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,w),g(b)}}}),p=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new Bi((v,g)=>{f(v,g,p)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(a,l,c,u,d,f)=>M(this,void 0,void 0,function*(){var p,v,g;const E=yield c.join(a,l,{autoSubscribe:u.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:u.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:u.websocketTimeout},f.signal,!d.singlePeerConnection);let y=E.serverInfo;if(y||(y={version:E.serverVersion,region:E.serverRegion}),this.serverInfo=y,this.log.debug("connected to Livekit Server ".concat(Object.entries(y).map(T=>{let[R,b]=T;return"".concat(R,": ").concat(b)}).join(", ")),{room:(p=E.room)===null||p===void 0?void 0:p.name,roomSid:(v=E.room)===null||v===void 0?void 0:v.sid,identity:(g=E.participant)===null||g===void 0?void 0:g.identity}),!y.version)throw new NW("unknown server version");return y.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),E}),this.applyJoinResponse=a=>{const l=a.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(a.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(a.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([l,...a.otherParticipants]),a.room&&this.handleRoomUpdate(a.room)},this.attemptConnection=(a,l,c,u)=>M(this,void 0,void 0,function*(){var d,f;this.state===qe.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((f=this.regionUrlProvider)===null||f===void 0)&&f.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},aC),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const p=yield this.connectSignal(a,l,this.engine,this.connOptions,this.options,u);this.applyJoinResponse(p),this.setupLocalParticipantEvents(),this.emit(H.SignalConnected)}catch(p){yield this.engine.close(),this.recreateEngine();const v=u.signal.aborted?de.cancelled("Signal connection aborted"):de.serverUnreachable("could not establish signal connection");throw p instanceof Error&&(v.message="".concat(v.message,": ").concat(p.message)),p instanceof de&&(v.reason=p.reason,v.status=p.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:p})),v}if(u.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),de.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,u)}catch(p){throw yield this.engine.close(),this.recreateEngine(),p}ri()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),ri()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(qe.Connected),this.emit(H.Connected),gc.getInstance().resetFailedConnectionAttempts(a),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];return M(n,[...l],void 0,function(){var u=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var f,p,v;const g=yield u.disconnectLock.lock();try{if(u.state===qe.Disconnected){u.log.debug("already disconnected",u.logContext);return}if(u.log.info("disconnect from room",Object.assign({},u.logContext)),u.state===qe.Connecting||u.state===qe.Reconnecting||u.isResuming){const E="Abort connection attempt due to user initiated disconnect";u.log.warn(E,u.logContext),(f=u.abortController)===null||f===void 0||f.abort(E),(v=(p=u.connectFuture)===null||p===void 0?void 0:p.reject)===null||v===void 0||v.call(p,de.cancelled("Client initiated disconnect")),u.connectFuture=void 0}u.engine&&(u.engine.client.isDisconnected||(yield u.engine.client.sendLeave()),yield u.engine.close()),u.handleDisconnect(d,sr.CLIENT_INITIATED),u.engine=void 0}finally{g()}}()})},this.onPageLeave=()=>M(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>M(this,void 0,void 0,function*(){const a=[],l=Kn();if(l&&l.os==="iOS"){const c="livekit-dummy-audio-el";let u=document.getElementById(c);if(!u){u=document.createElement("audio"),u.id=c,u.autoplay=!0,u.hidden=!0;const d=k0();d.enabled=!0;const f=new MediaStream([d]);u.srcObject=f,document.addEventListener("visibilitychange",()=>{u&&(u.srcObject=document.hidden?null:f,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(u),this.once(H.Disconnected,()=>{u==null||u.remove(),u=null})}a.push(u)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(u=>{u.track&&u.track.attachedElements.forEach(d=>{a.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...a.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>M(this,void 0,void 0,function*(){const a=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(c=>{var u;(u=c.track)===null||u===void 0||u.attachedElements.forEach(d=>{a.includes(d)||a.push(d)})});yield Promise.all(a.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const a of this.remoteParticipants.values())this.handleParticipantDisconnected(a.identity,a);this.setAndEmitConnectionState(qe.Reconnecting)&&this.emit(H.Reconnecting)},this.handleSignalRestarted=a=>M(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(a.serverRegion),Object.assign(Object.assign({},this.logContext),{region:a.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(a);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:a.serverRegion}))}catch{return}this.setAndEmitConnectionState(qe.Connected),this.emit(H.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=a=>{a.forEach(l=>{var c;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(c=this.sidToIdentity.get(l.sid))!==null&&c!==void 0?c:"");let u=this.remoteParticipants.get(l.identity);l.state===uc.DISCONNECTED?this.handleParticipantDisconnected(l.identity,u):u=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=a=>{const l=[],c={};a.forEach(u=>{if(c[u.sid]=!0,u.sid===this.localParticipant.sid)this.localParticipant.audioLevel=u.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(u.sid);d&&(d.audioLevel=u.level,d.setIsSpeaking(!0),l.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(u=>{c[u.sid]||(u.audioLevel=0,u.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(H.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=a=>{const l=new Map;this.activeSpeakers.forEach(u=>{const d=this.remoteParticipants.get(u.identity);d&&d.sid!==u.sid||l.set(u.sid,u)}),a.forEach(u=>{let d=this.getRemoteParticipantBySid(u.sid);u.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=u.level,d.setIsSpeaking(u.active),u.active?l.set(u.sid,d):l.delete(u.sid))});const c=Array.from(l.values());c.sort((u,d)=>d.audioLevel-u.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(H.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=a=>{a.streamStates.forEach(l=>{const c=this.getRemoteParticipantBySid(l.participantSid);if(!c)return;const u=c.getTrackPublicationBySid(l.trackSid);if(!u||!u.track)return;const d=F.streamStateFromProto(l.state);u.track.setStreamState(d),d!==u.track.streamState&&(c.emit($.TrackStreamStateChanged,u,u.track.streamState),this.emitWhenConnected(H.TrackStreamStateChanged,u,u.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=a=>{const l=this.getRemoteParticipantBySid(a.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setAllowed(a.allowed)},this.handleSubscriptionError=a=>{const l=Array.from(this.remoteParticipants.values()).find(u=>u.trackPublications.has(a.trackSid));if(!l)return;const c=l.getTrackPublicationBySid(a.trackSid);c&&c.setSubscriptionError(a.err)},this.handleDataPacket=(a,l)=>{const c=this.remoteParticipants.get(a.participantIdentity);if(a.value.case==="user")this.handleUserPacket(c,a.value.value,a.kind,l);else if(a.value.case==="transcription")this.handleTranscription(c,a.value.value);else if(a.value.case==="sipDtmf")this.handleSipDtmf(c,a.value.value);else if(a.value.case==="chatMessage")this.handleChatMessage(c,a.value.value);else if(a.value.case==="metrics")this.handleMetrics(a.value.value,c);else if(a.value.case==="streamHeader"||a.value.case==="streamChunk"||a.value.case==="streamTrailer")this.handleDataStream(a,l);else if(a.value.case==="rpcRequest"){const u=a.value.value;this.handleIncomingRpcRequest(a.participantIdentity,u.id,u.method,u.payload,u.responseTimeoutMs,u.version)}},this.handleUserPacket=(a,l,c,u)=>{this.emit(H.DataReceived,l.payload,a,c,l.topic,u),a==null||a.emit($.DataReceived,l.payload,c,u)},this.handleSipDtmf=(a,l)=>{this.emit(H.SipDTMFReceived,l,a),a==null||a.emit($.SipDTMFReceived,l)},this.handleTranscription=(a,l)=>{const c=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),u=c==null?void 0:c.trackPublications.get(l.trackId),d=aQ(l,this.transcriptionReceivedTimes);u==null||u.emit(X.TranscriptionReceived,d),c==null||c.emit($.TranscriptionReceived,d,u),this.emit(H.TranscriptionReceived,d,c,u)},this.handleChatMessage=(a,l)=>{const c=lQ(l);this.emit(H.ChatMessage,c,a)},this.handleMetrics=(a,l)=>{this.emit(H.MetricsReceived,a,l)},this.handleDataStream=(a,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(a,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(H.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=a=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:a})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(H.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(H.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(H.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>M(this,void 0,void 0,function*(){var a;((a=Kn())===null||a===void 0?void 0:a.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(H.MediaDevicesChanged)}),this.handleRoomUpdate=a=>{const l=this.roomInfo;this.roomInfo=a,l&&l.metadata!==a.metadata&&this.emitWhenConnected(H.RoomMetadataChanged,a.metadata),(l==null?void 0:l.activeRecording)!==a.activeRecording&&this.emitWhenConnected(H.RecordingStatusChanged,a.activeRecording)},this.handleConnectionQualityUpdate=a=>{a.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const c=this.getRemoteParticipantBySid(l.participantSid);c&&c.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=a=>{this.emit(H.ParticipantMetadataChanged,a,this.localParticipant)},this.onLocalParticipantNameChanged=a=>{this.emit(H.ParticipantNameChanged,a,this.localParticipant)},this.onLocalAttributesChanged=a=>{this.emit(H.ParticipantAttributesChanged,a,this.localParticipant)},this.onLocalTrackMuted=a=>{this.emit(H.TrackMuted,a,this.localParticipant)},this.onLocalTrackUnmuted=a=>{this.emit(H.TrackUnmuted,a,this.localParticipant)},this.onTrackProcessorUpdate=a=>{var l;(l=a==null?void 0:a.onPublish)===null||l===void 0||l.call(a,this)},this.onLocalTrackPublished=a=>M(this,void 0,void 0,function*(){var l,c,u,d,f,p;(l=a.track)===null||l===void 0||l.on(X.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.on(X.Restarted,this.onLocalTrackRestarted),(f=(d=(u=a.track)===null||u===void 0?void 0:u.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||f===void 0||f.call(d,this),this.emit(H.LocalTrackPublished,a,this.localParticipant),Qr(a.track)&&(yield a.track.checkForSilence())&&this.emit(H.LocalAudioSilenceDetected,a);const v=yield(p=a.track)===null||p===void 0?void 0:p.getDeviceId(!1),g=jb(a.source);g&&v&&v!==this.localParticipant.activeDeviceMap.get(g)&&(this.localParticipant.activeDeviceMap.set(g,v),this.emit(H.ActiveDeviceChanged,g,v))}),this.onLocalTrackUnpublished=a=>{var l,c;(l=a.track)===null||l===void 0||l.off(X.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=a.track)===null||c===void 0||c.off(X.Restarted,this.onLocalTrackRestarted),this.emit(H.LocalTrackUnpublished,a,this.localParticipant)},this.onLocalTrackRestarted=a=>M(this,void 0,void 0,function*(){const l=yield a.getDeviceId(!1),c=jb(a.source);c&&l&&l!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,l),this.emit(H.ActiveDeviceChanged,c,l))}),this.onLocalConnectionQualityChanged=a=>{this.emit(H.ConnectionQualityChanged,a,this.localParticipant)},this.onMediaDevicesError=(a,l)=>{this.emit(H.MediaDevicesError,a,l)},this.onLocalParticipantPermissionsChanged=a=>{this.emit(H.ParticipantPermissionsChanged,a,this.localParticipant)},this.onLocalChatMessageSent=a=>{this.emit(H.ChatMessage,a,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},BQ),e),this.log=ws((i=this.options.loggerName)!==null&&i!==void 0?i:cr.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},h3),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},f3),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},jQ),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new vY,this.outgoingDataStreamManager=new bY(this.engine,this.log),this.disconnectLock=new Gn,this.localParticipant=new RY("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",Ao(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",Ao(this.options.audioCaptureDefaults.deviceId)),!((r=this.options.audioOutput)===null||r===void 0)&&r.deviceId&&this.switchActiveDevice("audiooutput",Ao(this.options.audioOutput.deviceId)).catch(a=>this.log.warn("Could not set audio output: ".concat(a.message),this.logContext)),ri()){const a=new AbortController;(o=(s=navigator.mediaDevices)===null||s===void 0?void 0:s.addEventListener)===null||o===void 0||o.call(s,"devicechange",this.handleDeviceChange,{signal:a.signal}),Rs.cleanupRegistry&&Rs.cleanupRegistry.register(this,()=>{a.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return M(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new EQ(i,n),this.e2eeManager.on(lo.ParticipantEncryptionStatusChanged,(r,s)=>{uQ(s)&&(this.isE2EEEnabled=r),this.emit(H.ParticipantEncryptionStatusChanged,r,s)}),this.e2eeManager.on(lo.EncryptionError,(r,s)=>{const o=s?this.getParticipantByIdentity(s):void 0;this.emit(H.EncryptionError,r,o)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return this.state===qe.Disconnected?Fn.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?Fn.resolve(this.roomInfo.sid):new Fn((e,n)=>{const i=r=>{r.sid!==""&&(this.engine.off(te.RoomUpdate,i),e(r.sid))};this.engine.on(te.RoomUpdate,i),this.once(H.Disconnected,()=>{this.engine.off(te.RoomUpdate,i),n(new At("Room disconnected before room server id was available"))})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new fY(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(te.ParticipantUpdate,this.handleParticipantUpdates).on(te.RoomUpdate,this.handleRoomUpdate).on(te.SpeakersChanged,this.handleSpeakersChanged).on(te.StreamStateChanged,this.handleStreamStateUpdate).on(te.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(te.SubscriptionError,this.handleSubscriptionError).on(te.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(te.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(te.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(te.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(te.DataPacketReceived,this.handleDataPacket).on(te.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(qe.SignalReconnecting)&&this.emit(H.SignalReconnecting)}).on(te.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(qe.Connected)&&this.emit(H.Reconnected)}).on(te.SignalResumed,()=>{this.bufferedEvents=[],(this.state===qe.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(te.Restarting,this.handleRestarting).on(te.SignalRestarted,this.handleSignalRestarted).on(te.Offline,()=>{this.setAndEmitConnectionState(qe.Reconnecting)&&this.emit(H.Reconnecting)}).on(te.DCBufferStatusChanged,(e,n)=>{this.emit(H.DCBufferStatusChanged,e,n)}).on(te.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:r}=i;return r===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit($.LocalTrackSubscribed,n),this.emitWhenConnected(H.LocalTrackSubscribed,n,this.localParticipant)}).on(te.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(H.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return hn.getInstance().getDevices(e,n)}prepareConnection(e,n){return M(this,void 0,void 0,function*(){if(this.state===qe.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(Hc(new URL(e))&&n){this.regionUrlProvider=new Be(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===qe.Disconnected&&(this.regionUrl=i,yield fetch(Nh(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(Nh(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return M(this,void 0,void 0,function*(){let i=()=>M(this,void 0,void 0,function*(){}),r;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":r=new gr({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":r=new gr({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":r=new gr({scenario:{case:"serverLeave",value:!0}});break;case"migration":r=new gr({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>M(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new gr({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>M(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),r=new gr({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":r=new gr({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>M(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new Dv({reason:sr.CLIENT_INITIATED,action:dc.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");r=new gr({scenario:{case:"subscriberBandwidth",value:Ta(n)}});break;case"leave-full-reconnect":r=new gr({scenario:{case:"leaveRequestFullReconnect",value:!0}})}r&&(yield this.engine.client.sendSimulateScenario(r),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return M(this,arguments,void 0,function(i,r){var s=this;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var a,l,c,u,d,f,p;let v=!0,g=!1;const E=o?{exact:r}:r;if(i==="audioinput"){g=s.localParticipant.audioTrackPublications.size===0;const y=(a=s.getActiveDevice(i))!==null&&a!==void 0?a:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=E;const T=Array.from(s.localParticipant.audioTrackPublications.values()).filter(b=>b.source===F.Source.Microphone);try{v=(yield Promise.all(T.map(b=>{var w;return(w=b.audioTrack)===null||w===void 0?void 0:w.setDeviceId(E)}))).every(b=>b===!0)}catch(b){throw s.options.audioCaptureDefaults.deviceId=y,b}const R=T.some(b=>{var w,D;return(D=(w=b.track)===null||w===void 0?void 0:w.isMuted)!==null&&D!==void 0?D:!1});v&&R&&(g=!0)}else if(i==="videoinput"){g=s.localParticipant.videoTrackPublications.size===0;const y=(l=s.getActiveDevice(i))!==null&&l!==void 0?l:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=E;const T=Array.from(s.localParticipant.videoTrackPublications.values()).filter(b=>b.source===F.Source.Camera);try{v=(yield Promise.all(T.map(b=>{var w;return(w=b.videoTrack)===null||w===void 0?void 0:w.setDeviceId(E)}))).every(b=>b===!0)}catch(b){throw s.options.videoCaptureDefaults.deviceId=y,b}const R=T.some(b=>{var w,D;return(D=(w=b.track)===null||w===void 0?void 0:w.isMuted)!==null&&D!==void 0?D:!1});v&&R&&(g=!0)}else if(i==="audiooutput"){if(g=!0,!zb()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(r=(c=yield hn.getInstance().normalizeDeviceId("audiooutput",r))!==null&&c!==void 0?c:""),(u=(p=s.options).audioOutput)!==null&&u!==void 0||(p.audioOutput={});const y=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=r;try{s.options.webAudioMix&&((f=s.audioContext)===null||f===void 0||f.setSinkId(r)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(T=>T.setAudioOutput({deviceId:r})))}catch(T){throw s.options.audioOutput.deviceId=y,T}}return g&&(s.localParticipant.activeDeviceMap.set(i,r),s.emit(H.ActiveDeviceChanged,i,r)),v}()})}setupLocalParticipantEvents(){this.localParticipant.on($.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on($.ParticipantNameChanged,this.onLocalParticipantNameChanged).on($.AttributesChanged,this.onLocalAttributesChanged).on($.TrackMuted,this.onLocalTrackMuted).on($.TrackUnmuted,this.onLocalTrackUnmuted).on($.LocalTrackPublished,this.onLocalTrackPublished).on($.LocalTrackUnpublished,this.onLocalTrackUnpublished).on($.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on($.MediaDevicesError,this.onMediaDevicesError).on($.AudioStreamAcquired,this.startAudio).on($.ChatMessage,this.onLocalChatMessageSent).on($.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===qe.Connecting||this.state===qe.Reconnecting){const d=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(p=>p.id)}),this.onTrackAdded(e,n,i),f()},f=()=>{this.off(H.Reconnected,d),this.off(H.Connected,d),this.off(H.Disconnected,f)};this.once(H.Reconnected,d),this.once(H.Connected,d),this.once(H.Disconnected,f);return}if(this.state===qe.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const r=QW(n.id),s=r[0];let o=r[1],a=e.id;if(o&&o.startsWith("TR")&&(a=o),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!a.startsWith("TR")){const d=this.engine.getTrackIdForReceiver(i);if(!d){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}a=d}a.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(o,", trackId: ").concat(a),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:o,trackId:a}));let c;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?c=this.options.adaptiveStream:c={});const u=l.addSubscribedMediaTrack(e,a,n,i,c);u!=null&&u.isEncrypted&&!this.e2eeManager&&this.emit(H.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(l.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i,r;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==qe.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(s=>{s.trackPublications.forEach(o=>{s.unpublishTrack(o.trackSid)})}),this.localParticipant.trackPublications.forEach(s=>{var o,a,l;s.track&&this.localParticipant.unpublishTrack(s.track,e),e?((o=s.track)===null||o===void 0||o.detach(),(a=s.track)===null||a===void 0||a.stop()):(l=s.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off($.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off($.ParticipantNameChanged,this.onLocalParticipantNameChanged).off($.AttributesChanged,this.onLocalAttributesChanged).off($.TrackMuted,this.onLocalTrackMuted).off($.TrackUnmuted,this.onLocalTrackUnmuted).off($.LocalTrackPublished,this.onLocalTrackPublished).off($.LocalTrackUnpublished,this.onLocalTrackUnpublished).off($.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off($.MediaDevicesError,this.onMediaDevicesError).off($.AudioStreamAcquired,this.startAudio).off($.ChatMessage,this.onLocalChatMessageSent).off($.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),ri()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(r=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||r===void 0||r.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(qe.Disconnected),this.emit(H.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(r=>{n.unpublishTrack(r.trackSid,!0)}),this.emit(H.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,r,s,o){return M(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),o!==1){yield this.engine.publishRpcResponse(e,n,null,wt.builtIn("UNSUPPORTED_VERSION"));return}const a=this.rpcHandlers.get(i);if(!a){yield this.engine.publishRpcResponse(e,n,null,wt.builtIn("UNSUPPORTED_METHOD"));return}let l=null,c=null;try{const u=yield a({requestId:n,callerIdentity:e,payload:r,responseTimeout:s});lC(u)>m3?(l=wt.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):c=u}catch(u){u instanceof wt?l=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),l=wt.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,c,l)})}selectDefaultDevices(){return M(this,void 0,void 0,function*(){var e,n,i;const r=hn.getInstance().previousDevices,s=yield hn.getInstance().getDevices(void 0,!1),o=Kn();if((o==null?void 0:o.name)==="Chrome"&&o.os!=="iOS")for(let l of s){const c=r.find(u=>u.deviceId===l.deviceId);c&&c.label!==""&&c.kind===l.kind&&c.label!==l.label&&this.getActiveDevice(l.kind)==="default"&&this.emit(H.ActiveDeviceChanged,l.kind,l.deviceId)}const a=["audiooutput","audioinput","videoinput"];for(let l of a){const c=jW(l),u=this.localParticipant.getTrackPublication(c);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(p=>p.kind===l),f=this.getActiveDevice(l);if(f===((n=r.filter(p=>p.kind===l)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==f){yield this.switchActiveDevice(l,d[0].deviceId);continue}l==="audioinput"&&!Oh()||l==="videoinput"||d.length>0&&!d.find(p=>p.deviceId===this.getActiveDevice(l))&&(l!=="audiooutput"||!Oh())&&(yield this.switchActiveDevice(l,d[0].deviceId))}})}acquireAudioContext(){return M(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=o3())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(r=>r.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Rn(200)])}catch(r){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:r}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(H.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let r;return n?r=_g.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):r=new _g(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&r.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&r.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),r}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const r=this.remoteParticipants.get(e);return n&&r.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),r}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(H.ParticipantConnected,i),i.on($.TrackPublished,r=>{this.emitWhenConnected(H.TrackPublished,r,i)}).on($.TrackSubscribed,(r,s)=>{r.kind===F.Kind.Audio?(r.on(X.AudioPlaybackStarted,this.handleAudioPlaybackStarted),r.on(X.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):r.kind===F.Kind.Video&&(r.on(X.VideoPlaybackFailed,this.handleVideoPlaybackFailed),r.on(X.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(H.TrackSubscribed,r,s,i)}).on($.TrackUnpublished,r=>{this.emit(H.TrackUnpublished,r,i)}).on($.TrackUnsubscribed,(r,s)=>{this.emit(H.TrackUnsubscribed,r,s,i)}).on($.TrackMuted,r=>{this.emitWhenConnected(H.TrackMuted,r,i)}).on($.TrackUnmuted,r=>{this.emitWhenConnected(H.TrackUnmuted,r,i)}).on($.ParticipantMetadataChanged,r=>{this.emitWhenConnected(H.ParticipantMetadataChanged,r,i)}).on($.ParticipantNameChanged,r=>{this.emitWhenConnected(H.ParticipantNameChanged,r,i)}).on($.AttributesChanged,r=>{this.emitWhenConnected(H.ParticipantAttributesChanged,r,i)}).on($.ConnectionQualityChanged,r=>{this.emitWhenConnected(H.ConnectionQualityChanged,r,i)}).on($.ParticipantPermissionsChanged,r=>{this.emitWhenConnected(H.ParticipantPermissionsChanged,r,i)}).on($.TrackSubscriptionStatusChanged,(r,s)=>{this.emitWhenConnected(H.TrackSubscriptionStatusChanged,r,s,i)}).on($.TrackSubscriptionFailed,(r,s)=>{this.emit(H.TrackSubscriptionFailed,r,i,s)}).on($.TrackSubscriptionPermissionChanged,(r,s)=>{this.emitWhenConnected(H.TrackSubscriptionPermissionChanged,r,s,i)}).on($.Active,()=>{this.emitWhenConnected(H.ParticipantActive,i),i.kind===Ih.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,r)=>(i.push(...r.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&cQ(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=wn.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,sr.STATE_MISMATCH))):e=0},AY)}clearConnectionReconcile(){this.connectionReconcileInterval&&wn.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(H.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(this.state===qe.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===qe.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return M(this,void 0,void 0,function*(){var n,i,r,s;const o=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),a=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new Av({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:_t.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Qa({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(H.SignalConnected),this.emit(H.Connected),this.setAndEmitConnectionState(qe.Connected),o.video){const l=new Yb(F.Kind.Video,new Wl({source:Ut.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Zi.AUDIO,name:"video-dummy"}),new yg(o.useRealTracks&&(!((n=window.navigator.mediaDevices)===null||n===void 0)&&n.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:_A(160*((i=a.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit($.LocalTrackPublished,l)}if(o.audio){const l=new Yb(F.Kind.Audio,new Wl({source:Ut.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Zi.AUDIO}),new vg(o.useRealTracks&&(!((r=navigator.mediaDevices)===null||r===void 0)&&r.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:k0(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit($.LocalTrackPublished,l)}for(let l=0;l<a.count-1;l+=1){let c=new Qa({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(l),state:uc.ACTIVE,tracks:[],joinedAt:_t.parse(Date.now())});const u=this.getOrCreateParticipant(c.identity,c);if(a.video){const d=_A(160*((s=a.aspectRatios[l%a.aspectRatios.length])!==null&&s!==void 0?s:1),160,!1,!0),f=new Wl({source:Ut.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Zi.AUDIO});u.addSubscribedMediaTrack(d,f.sid,new MediaStream([d]),new RTCRtpReceiver),c.tracks=[...c.tracks,f]}if(a.audio){const d=k0(),f=new Wl({source:Ut.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Zi.AUDIO});u.addSubscribedMediaTrack(d,f.sid,new MediaStream([d]),new RTCRtpReceiver),c.tracks=[...c.tracks,f]}u.updateInfo(c)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(e!==H.ActiveSpeakersChanged&&e!==H.TranscriptionReceived){const s=k3(i).filter(o=>o!==void 0);(e===H.TrackSubscribed||e===H.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Rs.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function k3(t){return t.map(e=>{if(e)return Array.isArray(e)?k3(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Ji;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Ji||(Ji={}));class Zo extends Ur.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Ji.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Rs(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return M(this,void 0,void 0,function*(){if(this.status!==Ji.IDLE)throw Error("check is running already");this.setStatus(Ji.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Ji.SKIPPED&&this.setStatus(this.isSuccess()?Ji.SUCCESS:Ji.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return M(this,void 0,void 0,function*(){return this.room.state===qe.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return M(this,void 0,void 0,function*(){this.room&&this.room.state!==qe.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Ji.SKIPPED)}switchProtocol(e){return M(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(H.Reconnecting,()=>{n=!0}),this.room.once(H.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const r=Date.now()+1e4;for(;Date.now()<r;){if(i)return;yield Rn(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class IY extends Zo{get description(){return"Cloud regions"}perform(){return M(this,void 0,void 0,function*(){const e=new Be(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const o=yield e.getNextBestRegionUrl();if(!o)break;if(i.has(o))continue;i.add(o);const a=yield this.checkCloudRegion(o);this.appendMessage("".concat(a.region," RTT: ").concat(a.rtt,"ms, duration: ").concat(a.duration,"ms")),n.push(a)}n.sort((s,o)=>(s.duration-o.duration)*.5+(s.rtt-o.rtt)*.5);const r=n[0];this.bestStats=r,this.appendMessage("best Cloud region: ".concat(r.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return M(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const r=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!r)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),o=1e3,l=1e6/o,c="A".repeat(o),u=Date.now();for(let v=0;v<l;v++)yield s.write(c);yield s.close();const d=Date.now(),f=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),p={region:r,rtt:1e4,duration:d-u};return f==null||f.forEach(v=>{v.type==="candidate-pair"&&v.nominated&&(p.rtt=v.currentRoundTripTime*1e3)}),yield this.disconnect(),p})}}const N0=1e4;class PY extends Zo{get description(){return"Connection via UDP vs TCP"}perform(){return M(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(N0/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(N0/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return M(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let r=0;const s=()=>{r=(r+1)%360,i.fillStyle="hsl(".concat(r,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const a=n.captureStream(30).getVideoTracks()[0],c=(yield this.room.localParticipant.publishTrack(a,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>M(this,void 0,void 0,function*(){const f=yield c.getRTCStatsReport();f==null||f.forEach(p=>{p.type==="outbound-rtp"?(u.packetsSent=p.packetsSent,u.qualityLimitationDurations=p.qualityLimitationDurations,u.bitrateTotal+=p.targetBitrate,u.count++):p.type==="remote-inbound-rtp"&&(u.packetsLost=p.packetsLost,u.rttTotal+=p.roundTripTime,u.jitterTotal+=p.jitter)})}),1e3);return yield new Promise(f=>setTimeout(f,N0)),clearInterval(d),a.stop(),n.remove(),yield this.disconnect(),u})}}class xY extends Zo{get description(){return"Can publish audio"}perform(){return M(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield CY();if(yield s3(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(a=>setTimeout(a,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let o=0;if(s.forEach(a=>{a.type==="outbound-rtp"&&(a.kind==="audio"||!a.kind&&a.mediaType==="audio")&&(o=a.packetsSent)}),o===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(o," audio packets"))})}}class DY extends Zo{get description(){return"Can publish video"}perform(){return M(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield EY();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,5e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="video"||!o.kind&&o.mediaType==="video")&&(s+=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return M(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(r=>{i.onplay=()=>{setTimeout(()=>{var s,o,a,l;const c=document.createElement("canvas"),u=e.getSettings(),d=(o=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&o!==void 0?o:1280,f=(l=(a=u.height)!==null&&a!==void 0?a:i.videoHeight)!==null&&l!==void 0?l:720;c.width=d,c.height=f;const p=c.getContext("2d");p.drawImage(i,0,0);const g=p.getImageData(0,0,c.width,c.height).data;let E=!0;for(let y=0;y<g.length;y+=4)if(g[y]!==0||g[y+1]!==0||g[y+2]!==0){E=!1;break}E?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),r()},1e3)},i.play()}),n.getTracks().forEach(r=>r.stop()),i.remove()})}}class OY extends Zo{get description(){return"Resuming connection after interruption"}perform(){return M(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,r=!1,s;const o=new Promise(c=>{setTimeout(c,5e3),s=c}),a=()=>{i=!0};n.on(H.SignalReconnecting,a).on(H.Reconnecting,a).on(H.Reconnected,()=>{r=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const l=n.engine.client.onClose;if(l&&l(""),yield o,i){if(!r||n.state!==qe.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class NY extends Zo{get description(){return"Can connect via TURN"}perform(){return M(this,void 0,void 0,function*(){var e,n,i;Hc(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new Be(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const r=new iC,s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let o=!1,a=!1,l=!1;for(let c of s.iceServers)for(let u of c.urls)u.startsWith("turn:")?(a=!0,l=!0):u.startsWith("turns:")&&(a=!0,l=!0,o=!0),u.startsWith("stun:")&&(l=!0);l?a&&!o&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield r.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||a?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class MY extends Zo{get description(){return"Establishing WebRTC connection"}perform(){return M(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(H.SignalConnected,()=>{var i;const r=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,o)=>{if(s.candidate){const a=new RTCIceCandidate(s);let l="".concat(a.protocol," ").concat(a.address,":").concat(a.port," ").concat(a.type);a.address&&(LY(a.address)?l+=" (private)":a.protocol==="tcp"&&a.tcpType==="passive"?(e=!0,l+=" (passive)"):a.protocol==="udp"&&(n=!0)),this.appendMessage(l)}r&&r(s,o)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),Ee.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function LY(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class UY extends Zo{get description(){return"Connecting to signal connection via WebSocket"}perform(){return M(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let r=new iC,s;try{s=yield r.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(o){if(Hc(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(o.message,". Retrying with region fallback"));const l=yield new Be(this.url,this.token).getNextBestRegionUrl();l&&(s=yield r.join(l,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}s?(this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===sL.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield r.close()})}}class Eee extends Ur.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Ji.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Ji.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return M(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),r=o=>{this.updateCheck(n,o)};i.on("update",r);const s=yield i.run();return i.off("update",r),s})}checkWebsocket(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(UY)})}checkWebRTC(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(MY)})}checkTURN(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(NY)})}checkReconnect(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(OY)})}checkPublishAudio(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(xY)})}checkPublishVideo(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(DY)})}checkConnectionProtocol(){return M(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(PY);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return M(this,void 0,void 0,function*(){return this.createAndRunCheck(IY)})}}function De(t,e,n){return(e=FY(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function VY(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function FY(t){var e=VY(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Wn extends Error{constructor(e,n){var i;super(e,n),De(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}De(Wn,"code","ERR_JOSE_GENERIC");class jY extends Wn{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),De(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),De(this,"claim",void 0),De(this,"reason",void 0),De(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}De(jY,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class BY extends Wn{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:r,payload:n}}),De(this,"code","ERR_JWT_EXPIRED"),De(this,"claim",void 0),De(this,"reason",void 0),De(this,"payload",void 0),this.claim=i,this.reason=r,this.payload=n}}De(BY,"code","ERR_JWT_EXPIRED");class qY extends Wn{constructor(){super(...arguments),De(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}De(qY,"code","ERR_JOSE_ALG_NOT_ALLOWED");class zY extends Wn{constructor(){super(...arguments),De(this,"code","ERR_JOSE_NOT_SUPPORTED")}}De(zY,"code","ERR_JOSE_NOT_SUPPORTED");class HY extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),De(this,"code","ERR_JWE_DECRYPTION_FAILED")}}De(HY,"code","ERR_JWE_DECRYPTION_FAILED");class GY extends Wn{constructor(){super(...arguments),De(this,"code","ERR_JWE_INVALID")}}De(GY,"code","ERR_JWE_INVALID");class KY extends Wn{constructor(){super(...arguments),De(this,"code","ERR_JWS_INVALID")}}De(KY,"code","ERR_JWS_INVALID");class $Y extends Wn{constructor(){super(...arguments),De(this,"code","ERR_JWT_INVALID")}}De($Y,"code","ERR_JWT_INVALID");class WY extends Wn{constructor(){super(...arguments),De(this,"code","ERR_JWK_INVALID")}}De(WY,"code","ERR_JWK_INVALID");class QY extends Wn{constructor(){super(...arguments),De(this,"code","ERR_JWKS_INVALID")}}De(QY,"code","ERR_JWKS_INVALID");class YY extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),De(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}De(YY,"code","ERR_JWKS_NO_MATCHING_KEY");class JY extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),De(this,Symbol.asyncIterator,void 0),De(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}De(JY,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class XY extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),De(this,"code","ERR_JWKS_TIMEOUT")}}De(XY,"code","ERR_JWKS_TIMEOUT");class ZY extends Wn{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),De(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}De(ZY,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");var zA;(function(t){t[t.Reserved=0]="Reserved",t[t.TooLarge=1]="TooLarge"})(zA||(zA={}));var HA;(function(t){t[t.TooShort=0]="TooShort",t[t.HeaderOverrun=1]="HeaderOverrun",t[t.MissingExtWords=2]="MissingExtWords",t[t.UnsupportedVersion=3]="UnsupportedVersion",t[t.InvalidHandle=4]="InvalidHandle",t[t.MalformedExt=5]="MalformedExt"})(HA||(HA={}));var GA;(function(t){t[t.TooSmallForHeader=0]="TooSmallForHeader",t[t.TooSmallForPayload=1]="TooSmallForPayload"})(GA||(GA={}));var bg;(function(t){t[t.UserTimestamp=2]="UserTimestamp",t[t.E2ee=1]="E2ee"})(bg||(bg={}));bg.UserTimestamp;bg.E2ee;var KA;(function(t){t[t.Start=0]="Start",t[t.Inter=1]="Inter",t[t.Final=2]="Final",t[t.Single=3]="Single"})(KA||(KA={}));const Tg=Math.min,Da=Math.max,Sg=Math.round,hp=Math.floor,Rr=t=>({x:t,y:t}),eJ={left:"right",right:"left",bottom:"top",top:"bottom"},tJ={start:"end",end:"start"};function $A(t,e,n){return Da(t,Tg(e,n))}function Lv(t,e){return typeof t=="function"?t(e):t}function Xa(t){return t.split("-")[0]}function Uv(t){return t.split("-")[1]}function w3(t){return t==="x"?"y":"x"}function R3(t){return t==="y"?"height":"width"}const nJ=new Set(["top","bottom"]);function co(t){return nJ.has(Xa(t))?"y":"x"}function A3(t){return w3(co(t))}function iJ(t,e,n){n===void 0&&(n=!1);const i=Uv(t),r=A3(t),s=R3(r);let o=r==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=Eg(o)),[o,Eg(o)]}function rJ(t){const e=Eg(t);return[Jb(t),e,Jb(e)]}function Jb(t){return t.replace(/start|end/g,e=>tJ[e])}const WA=["left","right"],QA=["right","left"],sJ=["top","bottom"],oJ=["bottom","top"];function aJ(t,e,n){switch(t){case"top":case"bottom":return n?e?QA:WA:e?WA:QA;case"left":case"right":return e?sJ:oJ;default:return[]}}function lJ(t,e,n,i){const r=Uv(t);let s=aJ(Xa(t),n==="start",i);return r&&(s=s.map(o=>o+"-"+r),e&&(s=s.concat(s.map(Jb)))),s}function Eg(t){return t.replace(/left|right|bottom|top/g,e=>eJ[e])}function cJ(t){return{top:0,right:0,bottom:0,left:0,...t}}function uJ(t){return typeof t!="number"?cJ(t):{top:t,right:t,bottom:t,left:t}}function Cg(t){const{x:e,y:n,width:i,height:r}=t;return{width:i,height:r,top:n,left:e,right:e+i,bottom:n+r,x:e,y:n}}function YA(t,e,n){let{reference:i,floating:r}=t;const s=co(e),o=A3(e),a=R3(o),l=Xa(e),c=s==="y",u=i.x+i.width/2-r.width/2,d=i.y+i.height/2-r.height/2,f=i[a]/2-r[a]/2;let p;switch(l){case"top":p={x:u,y:i.y-r.height};break;case"bottom":p={x:u,y:i.y+i.height};break;case"right":p={x:i.x+i.width,y:d};break;case"left":p={x:i.x-r.width,y:d};break;default:p={x:i.x,y:i.y}}switch(Uv(e)){case"start":p[o]-=f*(n&&c?-1:1);break;case"end":p[o]+=f*(n&&c?-1:1);break}return p}const dJ=async(t,e,n)=>{const{placement:i="bottom",strategy:r="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(o.isRTL==null?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:r}),{x:u,y:d}=YA(c,i,l),f=i,p={},v=0;for(let g=0;g<a.length;g++){const{name:E,fn:y}=a[g],{x:T,y:R,data:b,reset:w}=await y({x:u,y:d,initialPlacement:i,placement:f,strategy:r,middlewareData:p,rects:c,platform:o,elements:{reference:t,floating:e}});u=T??u,d=R??d,p={...p,[E]:{...p[E],...b}},w&&v<=50&&(v++,typeof w=="object"&&(w.placement&&(f=w.placement),w.rects&&(c=w.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:r}):w.rects),{x:u,y:d}=YA(c,f,l)),g=-1)}return{x:u,y:d,placement:f,strategy:r,middlewareData:p}};async function I3(t,e){var n;e===void 0&&(e={});const{x:i,y:r,platform:s,rects:o,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=Lv(e,t),v=uJ(p),g=a[f?d==="floating"?"reference":"floating":d],E=Cg(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(g)))==null||n?g:g.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),y=d==="floating"?{x:i,y:r,width:o.floating.width,height:o.floating.height}:o.reference,T=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),R=await(s.isElement==null?void 0:s.isElement(T))?await(s.getScale==null?void 0:s.getScale(T))||{x:1,y:1}:{x:1,y:1},b=Cg(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:y,offsetParent:T,strategy:l}):y);return{top:(E.top-b.top+v.top)/R.y,bottom:(b.bottom-E.bottom+v.bottom)/R.y,left:(E.left-b.left+v.left)/R.x,right:(b.right-E.right+v.right)/R.x}}const hJ=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:r,middlewareData:s,rects:o,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:g=!0,...E}=Lv(t,e);if((n=s.arrow)!=null&&n.alignmentOffset)return{};const y=Xa(r),T=co(a),R=Xa(a)===a,b=await(l.isRTL==null?void 0:l.isRTL(c.floating)),w=f||(R||!g?[Eg(a)]:rJ(a)),D=v!=="none";!f&&D&&w.push(...lJ(a,g,v,b));const C=[a,...w],k=await I3(e,E),S=[];let A=((i=s.flip)==null?void 0:i.overflows)||[];if(u&&S.push(k[y]),d){const he=iJ(r,o,b);S.push(k[he[0]],k[he[1]])}if(A=[...A,{placement:r,overflows:S}],!S.every(he=>he<=0)){var I,N;const he=(((I=s.flip)==null?void 0:I.index)||0)+1,Ye=C[he];if(Ye&&(!(d==="alignment"&&T!==co(Ye))||A.every(re=>co(re.placement)===T?re.overflows[0]>0:!0)))return{data:{index:he,overflows:A},reset:{placement:Ye}};let J=(N=A.filter(re=>re.overflows[0]<=0).sort((re,se)=>re.overflows[1]-se.overflows[1])[0])==null?void 0:N.placement;if(!J)switch(p){case"bestFit":{var O;const re=(O=A.filter(se=>{if(D){const be=co(se.placement);return be===T||be==="y"}return!0}).map(se=>[se.placement,se.overflows.filter(be=>be>0).reduce((be,ze)=>be+ze,0)]).sort((se,be)=>se[1]-be[1])[0])==null?void 0:O[0];re&&(J=re);break}case"initialPlacement":J=a;break}if(r!==J)return{reset:{placement:J}}}return{}}}},fJ=new Set(["left","top"]);async function pJ(t,e){const{placement:n,platform:i,elements:r}=t,s=await(i.isRTL==null?void 0:i.isRTL(r.floating)),o=Xa(n),a=Uv(n),l=co(n)==="y",c=fJ.has(o)?-1:1,u=s&&l?-1:1,d=Lv(e,t);let{mainAxis:f,crossAxis:p,alignmentAxis:v}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return a&&typeof v=="number"&&(p=a==="end"?v*-1:v),l?{x:p*u,y:f*c}:{x:f*c,y:p*u}}const mJ=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:r,y:s,placement:o,middlewareData:a}=e,l=await pJ(e,t);return o===((n=a.offset)==null?void 0:n.placement)&&(i=a.arrow)!=null&&i.alignmentOffset?{}:{x:r+l.x,y:s+l.y,data:{...l,placement:o}}}}},gJ=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:r}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:E=>{let{x:y,y:T}=E;return{x:y,y:T}}},...l}=Lv(t,e),c={x:n,y:i},u=await I3(e,l),d=co(Xa(r)),f=w3(d);let p=c[f],v=c[d];if(s){const E=f==="y"?"top":"left",y=f==="y"?"bottom":"right",T=p+u[E],R=p-u[y];p=$A(T,p,R)}if(o){const E=d==="y"?"top":"left",y=d==="y"?"bottom":"right",T=v+u[E],R=v-u[y];v=$A(T,v,R)}const g=a.fn({...e,[f]:p,[d]:v});return{...g,data:{x:g.x-n,y:g.y-i,enabled:{[f]:s,[d]:o}}}}}};function Vv(){return typeof window<"u"}function fu(t){return P3(t)?(t.nodeName||"").toLowerCase():"#document"}function Ci(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Vr(t){var e;return(e=(P3(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function P3(t){return Vv()?t instanceof Node||t instanceof Ci(t).Node:!1}function ur(t){return Vv()?t instanceof Element||t instanceof Ci(t).Element:!1}function Or(t){return Vv()?t instanceof HTMLElement||t instanceof Ci(t).HTMLElement:!1}function JA(t){return!Vv()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ci(t).ShadowRoot}const vJ=new Set(["inline","contents"]);function uf(t){const{overflow:e,overflowX:n,overflowY:i,display:r}=dr(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!vJ.has(r)}const yJ=new Set(["table","td","th"]);function _J(t){return yJ.has(fu(t))}const bJ=[":popover-open",":modal"];function Fv(t){return bJ.some(e=>{try{return t.matches(e)}catch{return!1}})}const TJ=["transform","translate","scale","rotate","perspective"],SJ=["transform","translate","scale","rotate","perspective","filter"],EJ=["paint","layout","strict","content"];function dC(t){const e=hC(),n=ur(t)?dr(t):t;return TJ.some(i=>n[i]?n[i]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||SJ.some(i=>(n.willChange||"").includes(i))||EJ.some(i=>(n.contain||"").includes(i))}function CJ(t){let e=Ho(t);for(;Or(e)&&!Gc(e);){if(dC(e))return e;if(Fv(e))return null;e=Ho(e)}return null}function hC(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const kJ=new Set(["html","body","#document"]);function Gc(t){return kJ.has(fu(t))}function dr(t){return Ci(t).getComputedStyle(t)}function jv(t){return ur(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Ho(t){if(fu(t)==="html")return t;const e=t.assignedSlot||t.parentNode||JA(t)&&t.host||Vr(t);return JA(e)?e.host:e}function x3(t){const e=Ho(t);return Gc(e)?t.ownerDocument?t.ownerDocument.body:t.body:Or(e)&&uf(e)?e:x3(e)}function Mh(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const r=x3(t),s=r===((i=t.ownerDocument)==null?void 0:i.body),o=Ci(r);if(s){const a=Xb(o);return e.concat(o,o.visualViewport||[],uf(r)?r:[],a&&n?Mh(a):[])}return e.concat(r,Mh(r,[],n))}function Xb(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function D3(t){const e=dr(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const r=Or(t),s=r?t.offsetWidth:n,o=r?t.offsetHeight:i,a=Sg(n)!==s||Sg(i)!==o;return a&&(n=s,i=o),{width:n,height:i,$:a}}function fC(t){return ur(t)?t:t.contextElement}function yc(t){const e=fC(t);if(!Or(e))return Rr(1);const n=e.getBoundingClientRect(),{width:i,height:r,$:s}=D3(e);let o=(s?Sg(n.width):n.width)/i,a=(s?Sg(n.height):n.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const wJ=Rr(0);function O3(t){const e=Ci(t);return!hC()||!e.visualViewport?wJ:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function RJ(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Ci(t)?!1:e}function Za(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const r=t.getBoundingClientRect(),s=fC(t);let o=Rr(1);e&&(i?ur(i)&&(o=yc(i)):o=yc(t));const a=RJ(s,n,i)?O3(s):Rr(0);let l=(r.left+a.x)/o.x,c=(r.top+a.y)/o.y,u=r.width/o.x,d=r.height/o.y;if(s){const f=Ci(s),p=i&&ur(i)?Ci(i):i;let v=f,g=Xb(v);for(;g&&i&&p!==v;){const E=yc(g),y=g.getBoundingClientRect(),T=dr(g),R=y.left+(g.clientLeft+parseFloat(T.paddingLeft))*E.x,b=y.top+(g.clientTop+parseFloat(T.paddingTop))*E.y;l*=E.x,c*=E.y,u*=E.x,d*=E.y,l+=R,c+=b,v=Ci(g),g=Xb(v)}}return Cg({width:u,height:d,x:l,y:c})}function Bv(t,e){const n=jv(t).scrollLeft;return e?e.left+n:Za(Vr(t)).left+n}function N3(t,e){const n=t.getBoundingClientRect(),i=n.left+e.scrollLeft-Bv(t,n),r=n.top+e.scrollTop;return{x:i,y:r}}function AJ(t){let{elements:e,rect:n,offsetParent:i,strategy:r}=t;const s=r==="fixed",o=Vr(i),a=e?Fv(e.floating):!1;if(i===o||a&&s)return n;let l={scrollLeft:0,scrollTop:0},c=Rr(1);const u=Rr(0),d=Or(i);if((d||!d&&!s)&&((fu(i)!=="body"||uf(o))&&(l=jv(i)),Or(i))){const p=Za(i);c=yc(i),u.x=p.x+i.clientLeft,u.y=p.y+i.clientTop}const f=o&&!d&&!s?N3(o,l):Rr(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:n.y*c.y-l.scrollTop*c.y+u.y+f.y}}function IJ(t){return Array.from(t.getClientRects())}function PJ(t){const e=Vr(t),n=jv(t),i=t.ownerDocument.body,r=Da(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),s=Da(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let o=-n.scrollLeft+Bv(t);const a=-n.scrollTop;return dr(i).direction==="rtl"&&(o+=Da(e.clientWidth,i.clientWidth)-r),{width:r,height:s,x:o,y:a}}const XA=25;function xJ(t,e){const n=Ci(t),i=Vr(t),r=n.visualViewport;let s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(r){s=r.width,o=r.height;const u=hC();(!u||u&&e==="fixed")&&(a=r.offsetLeft,l=r.offsetTop)}const c=Bv(i);if(c<=0){const u=i.ownerDocument,d=u.body,f=getComputedStyle(d),p=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,v=Math.abs(i.clientWidth-d.clientWidth-p);v<=XA&&(s-=v)}else c<=XA&&(s+=c);return{width:s,height:o,x:a,y:l}}const DJ=new Set(["absolute","fixed"]);function OJ(t,e){const n=Za(t,!0,e==="fixed"),i=n.top+t.clientTop,r=n.left+t.clientLeft,s=Or(t)?yc(t):Rr(1),o=t.clientWidth*s.x,a=t.clientHeight*s.y,l=r*s.x,c=i*s.y;return{width:o,height:a,x:l,y:c}}function ZA(t,e,n){let i;if(e==="viewport")i=xJ(t,n);else if(e==="document")i=PJ(Vr(t));else if(ur(e))i=OJ(e,n);else{const r=O3(t);i={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return Cg(i)}function M3(t,e){const n=Ho(t);return n===e||!ur(n)||Gc(n)?!1:dr(n).position==="fixed"||M3(n,e)}function NJ(t,e){const n=e.get(t);if(n)return n;let i=Mh(t,[],!1).filter(a=>ur(a)&&fu(a)!=="body"),r=null;const s=dr(t).position==="fixed";let o=s?Ho(t):t;for(;ur(o)&&!Gc(o);){const a=dr(o),l=dC(o);!l&&a.position==="fixed"&&(r=null),(s?!l&&!r:!l&&a.position==="static"&&r&&DJ.has(r.position)||uf(o)&&!l&&M3(t,o))?i=i.filter(c=>c!==o):r=a,o=Ho(o)}return e.set(t,i),i}function MJ(t){let{element:e,boundary:n,rootBoundary:i,strategy:r}=t;const s=[...n==="clippingAncestors"?Fv(e)?[]:NJ(e,this._c):[].concat(n),i],o=s[0],a=s.reduce((l,c)=>{const u=ZA(e,c,r);return l.top=Da(u.top,l.top),l.right=Tg(u.right,l.right),l.bottom=Tg(u.bottom,l.bottom),l.left=Da(u.left,l.left),l},ZA(e,o,r));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function LJ(t){const{width:e,height:n}=D3(t);return{width:e,height:n}}function UJ(t,e,n){const i=Or(e),r=Vr(e),s=n==="fixed",o=Za(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=Rr(0);function c(){l.x=Bv(r)}if(i||!i&&!s)if((fu(e)!=="body"||uf(r))&&(a=jv(e)),i){const p=Za(e,!0,s,e);l.x=p.x+e.clientLeft,l.y=p.y+e.clientTop}else r&&c();s&&!i&&r&&c();const u=r&&!i&&!s?N3(r,a):Rr(0),d=o.left+a.scrollLeft-l.x-u.x,f=o.top+a.scrollTop-l.y-u.y;return{x:d,y:f,width:o.width,height:o.height}}function M0(t){return dr(t).position==="static"}function eI(t,e){if(!Or(t)||dr(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Vr(t)===n&&(n=n.ownerDocument.body),n}function L3(t,e){const n=Ci(t);if(Fv(t))return n;if(!Or(t)){let r=Ho(t);for(;r&&!Gc(r);){if(ur(r)&&!M0(r))return r;r=Ho(r)}return n}let i=eI(t,e);for(;i&&_J(i)&&M0(i);)i=eI(i,e);return i&&Gc(i)&&M0(i)&&!dC(i)?n:i||CJ(t)||n}const VJ=async function(t){const e=this.getOffsetParent||L3,n=this.getDimensions,i=await n(t.floating);return{reference:UJ(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function FJ(t){return dr(t).direction==="rtl"}const jJ={convertOffsetParentRelativeRectToViewportRelativeRect:AJ,getDocumentElement:Vr,getClippingRect:MJ,getOffsetParent:L3,getElementRects:VJ,getClientRects:IJ,getDimensions:LJ,getScale:yc,isElement:ur,isRTL:FJ};function U3(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function BJ(t,e){let n=null,i;const r=Vr(t);function s(){var a;clearTimeout(i),(a=n)==null||a.disconnect(),n=null}function o(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:d,width:f,height:p}=c;if(a||e(),!f||!p)return;const v=hp(d),g=hp(r.clientWidth-(u+f)),E=hp(r.clientHeight-(d+p)),y=hp(u),T={rootMargin:-v+"px "+-g+"px "+-E+"px "+-y+"px",threshold:Da(0,Tg(1,l))||1};let R=!0;function b(w){const D=w[0].intersectionRatio;if(D!==l){if(!R)return o();D?o(!1,D):i=setTimeout(()=>{o(!1,1e-7)},1e3)}D===1&&!U3(c,t.getBoundingClientRect())&&o(),R=!1}try{n=new IntersectionObserver(b,{...T,root:r.ownerDocument})}catch{n=new IntersectionObserver(b,T)}n.observe(t)}return o(!0),s}function qJ(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:r=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,c=fC(t),u=r||s?[...c?Mh(c):[],...Mh(e)]:[];u.forEach(y=>{r&&y.addEventListener("scroll",n,{passive:!0}),s&&y.addEventListener("resize",n)});const d=c&&a?BJ(c,n):null;let f=-1,p=null;o&&(p=new ResizeObserver(y=>{let[T]=y;T&&T.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var R;(R=p)==null||R.observe(e)})),n()}),c&&!l&&p.observe(c),p.observe(e));let v,g=l?Za(t):null;l&&E();function E(){const y=Za(t);g&&!U3(g,y)&&n(),g=y,v=requestAnimationFrame(E)}return n(),()=>{var y;u.forEach(T=>{r&&T.removeEventListener("scroll",n),s&&T.removeEventListener("resize",n)}),d==null||d(),(y=p)==null||y.disconnect(),p=null,l&&cancelAnimationFrame(v)}}const zJ=mJ,HJ=gJ,GJ=hJ,KJ=(t,e,n)=>{const i=new Map,r={platform:jJ,...n},s={...r.platform,_c:i};return dJ(t,e,{...r,platform:s})};var fp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $J(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Zb={exports:{}},WJ=Zb.exports,tI;function QJ(){return tI||(tI=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(WJ,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),r=["trace","debug","info","warn","error"],s={},o=null;function a(g,E){var y=g[E];if(typeof y.bind=="function")return y.bind(g);try{return Function.prototype.bind.call(y,g)}catch{return function(){return Function.prototype.apply.apply(y,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&i?l:console[g]!==void 0?a(console,g):console.log!==void 0?a(console,"log"):e}function u(){for(var g=this.getLevel(),E=0;E<r.length;E++){var y=r[E];this[y]=E<g?e:this.methodFactory(y,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function d(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function f(g,E,y){return c(g)||d.apply(this,arguments)}function p(g,E){var y=this,T,R,b,w="loglevel";typeof g=="string"?w+=":"+g:typeof g=="symbol"&&(w=void 0);function D(I){var N=(r[I]||"silent").toUpperCase();if(!(typeof window===n||!w)){try{window.localStorage[w]=N;return}catch{}try{window.document.cookie=encodeURIComponent(w)+"="+N+";"}catch{}}}function C(){var I;if(!(typeof window===n||!w)){try{I=window.localStorage[w]}catch{}if(typeof I===n)try{var N=window.document.cookie,O=encodeURIComponent(w),he=N.indexOf(O+"=");he!==-1&&(I=/^([^;]+)/.exec(N.slice(he+O.length+1))[1])}catch{}return y.levels[I]===void 0&&(I=void 0),I}}function k(){if(!(typeof window===n||!w)){try{window.localStorage.removeItem(w)}catch{}try{window.document.cookie=encodeURIComponent(w)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function S(I){var N=I;if(typeof N=="string"&&y.levels[N.toUpperCase()]!==void 0&&(N=y.levels[N.toUpperCase()]),typeof N=="number"&&N>=0&&N<=y.levels.SILENT)return N;throw new TypeError("log.setLevel() called with invalid level: "+I)}y.name=g,y.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},y.methodFactory=E||f,y.getLevel=function(){return b??R??T},y.setLevel=function(I,N){return b=S(I),N!==!1&&D(b),u.call(y)},y.setDefaultLevel=function(I){R=S(I),C()||y.setLevel(I,!1)},y.resetLevel=function(){b=null,k(),u.call(y)},y.enableAll=function(I){y.setLevel(y.levels.TRACE,I)},y.disableAll=function(I){y.setLevel(y.levels.SILENT,I)},y.rebuild=function(){if(o!==y&&(T=S(o.getLevel())),u.call(y),o===y)for(var I in s)s[I].rebuild()},T=S(o?o.getLevel():"WARN");var A=C();A!=null&&(b=S(A)),u.call(y)}o=new p,o.getLogger=function(g){if(typeof g!="symbol"&&typeof g!="string"||g==="")throw new TypeError("You must supply a name when creating a logger.");var E=s[g];return E||(E=s[g]=new p(g,o.methodFactory)),E};var v=typeof window!==n?window.log:void 0;return o.noConflict=function(){return typeof window!==n&&window.log===o&&(window.log=v),o},o.getLoggers=function(){return s},o.default=o,o})}(Zb)),Zb.exports}var YJ=QJ();const JJ=$J(YJ);var eT=function(t,e){return eT=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},eT(t,e)};function xs(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");eT(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function XJ(t,e,n,i){function r(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):r(u.value).then(a,l)}c((i=i.apply(t,[])).next())})}function V3(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,r,s,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(n=0)),n;)try{if(i=1,r&&(s=c[0]&2?r.return:c[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,c[1])).done)return s;switch(r=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,r=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){n.label=c[1];break}if(c[0]===6&&n.label<s[1]){n.label=s[1],s=c;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(c);break}s[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],r=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Kc(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function kg(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),r,s=[],o;try{for(;(e===void 0||e-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(a){o={error:a}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function wg(t,e,n){if(arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))}function _c(t){return this instanceof _c?(this.v=t,this):new _c(t)}function ZJ(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),r,s=[];return r=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),r[Symbol.asyncIterator]=function(){return this},r;function o(p){return function(v){return Promise.resolve(v).then(p,d)}}function a(p,v){i[p]&&(r[p]=function(g){return new Promise(function(E,y){s.push([p,g,E,y])>1||l(p,g)})},v&&(r[p]=v(r[p])))}function l(p,v){try{c(i[p](v))}catch(g){f(s[0][3],g)}}function c(p){p.value instanceof _c?Promise.resolve(p.value.v).then(u,d):f(s[0][2],p)}function u(p){l("next",p)}function d(p){l("throw",p)}function f(p,v){p(v),s.shift(),s.length&&l(s[0][0],s[0][1])}}function eX(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Kc=="function"?Kc(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(o){return new Promise(function(a,l){o=t[s](o),r(a,l,o.done,o.value)})}}function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}}function Jt(t){return typeof t=="function"}function pC(t){var e=function(i){Error.call(i),i.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var L0=pC(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Rg(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var df=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,i,r,s;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=Kc(o),l=a.next();!l.done;l=a.next()){var c=l.value;c.remove(this)}}catch(g){e={error:g}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}else o.remove(this);var u=this.initialTeardown;if(Jt(u))try{u()}catch(g){s=g instanceof L0?g.errors:[g]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=Kc(d),p=f.next();!p.done;p=f.next()){var v=p.value;try{nI(v)}catch(g){s=s??[],g instanceof L0?s=wg(wg([],kg(s)),kg(g.errors)):s.push(g)}}}catch(g){i={error:g}}finally{try{p&&!p.done&&(r=f.return)&&r.call(f)}finally{if(i)throw i.error}}}if(s)throw new L0(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)nI(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Rg(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Rg(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),F3=df.EMPTY;function j3(t){return t instanceof df||t&&"closed"in t&&Jt(t.remove)&&Jt(t.add)&&Jt(t.unsubscribe)}function nI(t){Jt(t)?t():t.unsubscribe()}var tX={Promise:void 0},nX={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,wg([t,e],kg(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function B3(t){nX.setTimeout(function(){throw t})}function iI(){}function nm(t){t()}var mC=function(t){xs(e,t);function e(n){var i=t.call(this)||this;return i.isStopped=!1,n?(i.destination=n,j3(n)&&n.add(i)):i.destination=sX,i}return e.create=function(n,i,r){return new tT(n,i,r)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(df),iX=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(i){pp(i)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(i){pp(i)}else pp(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){pp(n)}},t}(),tT=function(t){xs(e,t);function e(n,i,r){var s=t.call(this)||this,o;return Jt(n)||!n?o={next:n??void 0,error:i??void 0,complete:r??void 0}:o=n,s.destination=new iX(o),s}return e}(mC);function pp(t){B3(t)}function rX(t){throw t}var sX={closed:!0,next:iI,error:rX,complete:iI},gC=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function q3(t){return t}function oX(t){return t.length===0?q3:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var Pn=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,i){var r=this,s=lX(e)?e:new tT(e,n,i);return nm(function(){var o=r,a=o.operator,l=o.source;s.add(a?a.call(s,l):l?r._subscribe(s):r._trySubscribe(s))}),s},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var i=this;return n=rI(n),new n(function(r,s){var o=new tT({next:function(a){try{e(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:r});i.subscribe(o)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[gC]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return oX(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=rI(e),new e(function(i,r){var s;n.subscribe(function(o){return s=o},function(o){return r(o)},function(){return i(s)})})},t.create=function(e){return new t(e)},t}();function rI(t){var e;return(e=t??tX.Promise)!==null&&e!==void 0?e:Promise}function aX(t){return t&&Jt(t.next)&&Jt(t.error)&&Jt(t.complete)}function lX(t){return t&&t instanceof mC||aX(t)&&j3(t)}function cX(t){return Jt(t==null?void 0:t.lift)}function pu(t){return function(e){if(cX(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function Lh(t,e,n,i,r){return new uX(t,e,n,i,r)}var uX=function(t){xs(e,t);function e(n,i,r,s,o,a){var l=t.call(this,n)||this;return l.onFinalize=o,l.shouldUnsubscribe=a,l._next=i?function(c){try{i(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=s?function(c){try{s(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=r?function(){try{r()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(mC),dX=pC(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Uh=function(t){xs(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var i=new sI(this,this);return i.operator=n,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new dX},e.prototype.next=function(n){var i=this;nm(function(){var r,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var o=Kc(i.currentObservers),a=o.next();!a.done;a=o.next()){var l=a.value;l.next(n)}}catch(c){r={error:c}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(r)throw r.error}}}})},e.prototype.error=function(n){var i=this;nm(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=n;for(var r=i.observers;r.length;)r.shift().error(n)}})},e.prototype.complete=function(){var n=this;nm(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var i=n.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var i=this,r=this,s=r.hasError,o=r.isStopped,a=r.observers;return s||o?F3:(this.currentObservers=null,a.push(n),new df(function(){i.currentObservers=null,Rg(a,n)}))},e.prototype._checkFinalizedStatuses=function(n){var i=this,r=i.hasError,s=i.thrownError,o=i.isStopped;r?n.error(s):o&&n.complete()},e.prototype.asObservable=function(){var n=new Pn;return n.source=this,n},e.create=function(n,i){return new sI(n,i)},e}(Pn),sI=function(t){xs(e,t);function e(n,i){var r=t.call(this)||this;return r.destination=n,r.source=i,r}return e.prototype.next=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.next)===null||r===void 0||r.call(i,n)},e.prototype.error=function(n){var i,r;(r=(i=this.destination)===null||i===void 0?void 0:i.error)===null||r===void 0||r.call(i,n)},e.prototype.complete=function(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)},e.prototype._subscribe=function(n){var i,r;return(r=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&r!==void 0?r:F3},e}(Uh),hX=function(t){xs(e,t);function e(n){var i=t.call(this)||this;return i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return!i.closed&&n.next(this._value),i},e.prototype.getValue=function(){var n=this,i=n.hasError,r=n.thrownError,s=n._value;if(i)throw r;return this._throwIfClosed(),s},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(Uh),fX={now:function(){return Date.now()}},pX=function(t){xs(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(df),oI={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,wg([t,e],kg(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},mX=function(t){xs(e,t);function e(n,i){var r=t.call(this,n,i)||this;return r.scheduler=n,r.work=i,r.pending=!1,r}return e.prototype.schedule=function(n,i){var r;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var s=this.id,o=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(o,s,i)),this.pending=!0,this.delay=i,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(o,this.id,i),this},e.prototype.requestAsyncId=function(n,i,r){return r===void 0&&(r=0),oI.setInterval(n.flush.bind(n,this),r)},e.prototype.recycleAsyncId=function(n,i,r){if(r===void 0&&(r=0),r!=null&&this.delay===r&&this.pending===!1)return i;i!=null&&oI.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(n,i);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var r=!1,s;try{this.work(n)}catch(o){r=!0,s=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),s},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,r=n.scheduler,s=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Rg(s,this),i!=null&&(this.id=this.recycleAsyncId(r,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(pX),aI=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=fX.now,t}(),gX=function(t){xs(e,t);function e(n,i){i===void 0&&(i=aI.now);var r=t.call(this,n,i)||this;return r.actions=[],r._active=!1,r}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,r){for(;n=i.shift();)n.unsubscribe();throw r}},e}(aI);new gX(mX);function vX(t){return t&&Jt(t.schedule)}function yX(t){return t[t.length-1]}function z3(t){return vX(yX(t))?t.pop():void 0}var H3=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function G3(t){return Jt(t==null?void 0:t.then)}function K3(t){return Jt(t[gC])}function $3(t){return Symbol.asyncIterator&&Jt(t==null?void 0:t[Symbol.asyncIterator])}function W3(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function _X(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Q3=_X();function Y3(t){return Jt(t==null?void 0:t[Q3])}function J3(t){return ZJ(this,arguments,function(){var e,n,i,r;return V3(this,function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,_c(e.read())];case 3:return n=s.sent(),i=n.value,r=n.done,r?[4,_c(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,_c(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function X3(t){return Jt(t==null?void 0:t.getReader)}function hf(t){if(t instanceof Pn)return t;if(t!=null){if(K3(t))return bX(t);if(H3(t))return TX(t);if(G3(t))return SX(t);if($3(t))return Z3(t);if(Y3(t))return EX(t);if(X3(t))return CX(t)}throw W3(t)}function bX(t){return new Pn(function(e){var n=t[gC]();if(Jt(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function TX(t){return new Pn(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function SX(t){return new Pn(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,B3)})}function EX(t){return new Pn(function(e){var n,i;try{for(var r=Kc(t),s=r.next();!s.done;s=r.next()){var o=s.value;if(e.next(o),e.closed)return}}catch(a){n={error:a}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(n)throw n.error}}e.complete()})}function Z3(t){return new Pn(function(e){kX(t,e).catch(function(n){return e.error(n)})})}function CX(t){return Z3(J3(t))}function kX(t,e){var n,i,r,s;return XJ(this,void 0,void 0,function(){var o,a;return V3(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=eX(t),l.label=1;case 1:return[4,n.next()];case 2:if(i=l.sent(),!!i.done)return[3,4];if(o=i.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),r={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),i&&!i.done&&(s=n.return)?[4,s.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(r)throw r.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function Oa(t,e,n,i,r){i===void 0&&(i=0),r===void 0&&(r=!1);var s=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(s),!r)return s}function e4(t,e){return e===void 0&&(e=0),pu(function(n,i){n.subscribe(Lh(i,function(r){return Oa(i,t,function(){return i.next(r)},e)},function(){return Oa(i,t,function(){return i.complete()},e)},function(r){return Oa(i,t,function(){return i.error(r)},e)}))})}function t4(t,e){return e===void 0&&(e=0),pu(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function wX(t,e){return hf(t).pipe(t4(e),e4(e))}function RX(t,e){return hf(t).pipe(t4(e),e4(e))}function AX(t,e){return new Pn(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function IX(t,e){return new Pn(function(n){var i;return Oa(n,e,function(){i=t[Q3](),Oa(n,e,function(){var r,s,o;try{r=i.next(),s=r.value,o=r.done}catch(a){n.error(a);return}o?n.complete():n.next(s)},0,!0)}),function(){return Jt(i==null?void 0:i.return)&&i.return()}})}function n4(t,e){if(!t)throw new Error("Iterable cannot be null");return new Pn(function(n){Oa(n,e,function(){var i=t[Symbol.asyncIterator]();Oa(n,e,function(){i.next().then(function(r){r.done?n.complete():n.next(r.value)})},0,!0)})})}function PX(t,e){return n4(J3(t),e)}function xX(t,e){if(t!=null){if(K3(t))return wX(t,e);if(H3(t))return AX(t,e);if(G3(t))return RX(t,e);if($3(t))return n4(t,e);if(Y3(t))return IX(t,e);if(X3(t))return PX(t,e)}throw W3(t)}function DX(t,e){return e?xX(t,e):hf(t)}pC(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function Fr(t,e){return pu(function(n,i){var r=0;n.subscribe(Lh(i,function(s){i.next(t.call(e,s,r++))}))})}function OX(t,e,n,i,r,s,o,a){var l=[],c=0,u=0,d=!1,f=function(){d&&!l.length&&!c&&e.complete()},p=function(g){return c<i?v(g):l.push(g)},v=function(g){c++;var E=!1;hf(n(g,u++)).subscribe(Lh(e,function(y){e.next(y)},function(){E=!0},void 0,function(){if(E)try{c--;for(var y=function(){var T=l.shift();o||v(T)};l.length&&c<i;)y();f()}catch(T){e.error(T)}}))};return t.subscribe(Lh(e,p,function(){d=!0,f()})),function(){}}function i4(t,e,n){return n===void 0&&(n=1/0),Jt(e)?i4(function(i,r){return Fr(function(s,o){return e(i,s,r,o)})(hf(t(i,r)))},n):(typeof e=="number"&&(n=e),pu(function(i,r){return OX(i,r,t,n)}))}function NX(t){return i4(q3,t)}function MX(){return NX(1)}function nT(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return MX()(DX(t,z3(t)))}function LX(t,e){return pu(function(n,i){var r=0;n.subscribe(Lh(i,function(s){return t.call(e,s,r++)&&i.next(s)}))})}function fl(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=z3(t);return pu(function(i,r){(n?nT(t,i,n):nT(t,i)).subscribe(r)})}var UX=Object.defineProperty,lI=Object.getOwnPropertySymbols,VX=Object.prototype.hasOwnProperty,FX=Object.prototype.propertyIsEnumerable,cI=(t,e,n)=>e in t?UX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,uI=(t,e)=>{for(var n in e||(e={}))VX.call(e,n)&&cI(t,n,e[n]);if(lI)for(var n of lI(e))FX.call(e,n)&&cI(t,n,e[n]);return t},pl=(t,e,n)=>new Promise((i,r)=>{var s=l=>{try{a(n.next(l))}catch(c){r(c)}},o=l=>{try{a(n.throw(l))}catch(c){r(c)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,o);a((n=n.apply(t,e)).next())}),r4="lk";function vC(t){return typeof t>"u"?!1:jX(t)||BX(t)}function jX(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function BX(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function qX(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function zX(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(qX(t))return`${t.participant.identity}_${t.source}_placeholder`;if(vC(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}function HX(t,e,n){return qJ(t,e,()=>pl(this,null,function*(){const{x:i,y:r}=yield KJ(t,e,{placement:"top",middleware:[zJ(6),GJ(),HJ({padding:5})]});n==null||n(i,r)}))}function GX(t,e){return!t.contains(e.target)}var KX=[H.ConnectionStateChanged,H.RoomMetadataChanged,H.ActiveSpeakersChanged,H.ConnectionQualityChanged,H.ParticipantConnected,H.ParticipantDisconnected,H.ParticipantPermissionsChanged,H.ParticipantMetadataChanged,H.ParticipantNameChanged,H.ParticipantAttributesChanged,H.TrackMuted,H.TrackUnmuted,H.TrackPublished,H.TrackUnpublished,H.TrackStreamStateChanged,H.TrackSubscriptionFailed,H.TrackSubscriptionPermissionChanged,H.TrackSubscriptionStatusChanged],$X=[...KX,H.LocalTrackPublished,H.LocalTrackUnpublished];$.TrackPublished,$.TrackUnpublished,$.TrackMuted,$.TrackUnmuted,$.TrackStreamStateChanged,$.TrackSubscribed,$.TrackUnsubscribed,$.TrackSubscriptionPermissionChanged,$.TrackSubscriptionFailed,$.LocalTrackPublished,$.LocalTrackUnpublished;var WX=[$.ConnectionQualityChanged,$.IsSpeakingChanged,$.ParticipantMetadataChanged,$.ParticipantPermissionsChanged,$.TrackMuted,$.TrackUnmuted,$.TrackPublished,$.TrackUnpublished,$.TrackStreamStateChanged,$.TrackSubscriptionFailed,$.TrackSubscriptionPermissionChanged,$.TrackSubscriptionStatusChanged];[...WX,$.LocalTrackPublished,$.LocalTrackUnpublished];var We=JJ.getLogger("lk-components-js");We.setDefaultLevel("WARN");function QX(){return typeof navigator<"u"&&navigator.mediaDevices&&!!navigator.mediaDevices.getDisplayMedia}var s4=(t=>(t.AgentState="lk.agent.state",t.PublishOnBehalf="lk.publish_on_behalf",t.TranscriptionFinal="lk.transcription_final",t.TranscriptionSegmentId="lk.segment_id",t.TranscribedTrackId="lk.transcribed_track_id",t))(s4||{});function o4(t){return typeof t=="object"}function a4(t){return Array.isArray(t)&&t.filter(o4).length>0}function As(t){return`${r4}-${t}`}function YX(t){const e=iT(t),n=c4(t.participant).pipe(Fr(()=>iT(t)),fl(e));return{className:As(t.source===F.Source.Camera||t.source===F.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function iT(t){if(vC(t))return t.publication;{const{source:e,name:n,participant:i}=t;if(e&&n)return i.getTrackPublications().find(r=>r.source===e&&r.trackName===n);if(n)return i.getTrackPublicationByName(n);if(e)return i.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function yC(t,...e){return new Pn(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(fl(t))}function l4(t,e){return new Pn(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function JX(t){return l4(t,H.ConnectionStateChanged).pipe(Fr(([e])=>e),fl(t.state))}function XX(t,e,n=!0){const i=new Pn(s=>{Rs.getLocalDevices(t,n).then(o=>{s.next(o),s.complete()}).catch(o=>{e==null||e(o),s.next([]),s.complete()})}),r=new Pn(s=>{var o;const a=()=>pl(this,null,function*(){try{const l=yield Rs.getLocalDevices(t,n);s.next(l)}catch(l){e==null||e(l)}});if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(o=navigator==null?void 0:navigator.mediaDevices)==null||o.addEventListener("devicechange",a)}return()=>{var l;(l=navigator==null?void 0:navigator.mediaDevices)==null||l.removeEventListener("devicechange",a)}});return nT(i,r)}function ZX(t){return yC(t,H.AudioPlaybackStatusChanged).pipe(Fr(e=>({canPlayAudio:e.canPlaybackAudio})))}function eZ(t){return yC(t,H.VideoPlaybackStatusChanged).pipe(Fr(e=>({canPlayVideo:e.canPlaybackVideo})))}function tZ(t,e){return l4(t,H.ActiveDeviceChanged).pipe(LX(([n])=>n===e),Fr(([n,i])=>(We.debug("activeDeviceObservable | RoomEvent.ActiveDeviceChanged",{kind:n,deviceId:i}),i)))}function nZ(t,...e){return new Pn(n=>{const i=()=>{n.next(t)};return e.forEach(r=>{t.on(r,i)}),()=>{e.forEach(r=>{t.off(r,i)})}}).pipe(fl(t))}function c4(t){return nZ(t,$.TrackMuted,$.TrackUnmuted,$.ParticipantPermissionsChanged,$.TrackPublished,$.TrackUnpublished,$.LocalTrackPublished,$.LocalTrackUnpublished,$.MediaDevicesError,$.TrackSubscriptionStatusChanged).pipe(Fr(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:i,isScreenShareEnabled:r}=e,s=e.getTrackPublication(F.Source.Microphone),o=e.getTrackPublication(F.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:n,isScreenShareEnabled:r,cameraTrack:o,microphoneTrack:s,participant:e}}))}function iZ(t,e){return new Pn(n=>{const i=(...r)=>{n.next(r)};return t.on(e,i),()=>{t.off(e,i)}})}function rZ(t){return iZ(t,$.ParticipantPermissionsChanged).pipe(Fr(()=>t.permissions),fl(t.permissions))}function sZ(t,e,n,i,r){const{localParticipant:s}=e,o=(u,d)=>{let f=!1;switch(u){case F.Source.Camera:f=d.isCameraEnabled;break;case F.Source.Microphone:f=d.isMicrophoneEnabled;break;case F.Source.ScreenShare:f=d.isScreenShareEnabled;break}return f},a=c4(s).pipe(Fr(u=>o(t,u.participant)),fl(o(t,s))),l=new Uh,c=(u,d)=>pl(this,null,function*(){try{switch(d??(d=n),l.next(!0),t){case F.Source.Camera:return yield s.setCameraEnabled(u??!s.isCameraEnabled,d,i),s.isCameraEnabled;case F.Source.Microphone:return yield s.setMicrophoneEnabled(u??!s.isMicrophoneEnabled,d,i),s.isMicrophoneEnabled;case F.Source.ScreenShare:return yield s.setScreenShareEnabled(u??!s.isScreenShareEnabled,d,i),s.isScreenShareEnabled;default:throw new TypeError("Tried to toggle unsupported source")}}catch(f){if(r&&f instanceof Error){r==null||r(f);return}else throw f}finally{l.next(!1)}});return{className:As("button"),toggle:c,enabledObserver:a,pendingObserver:l.asObservable()}}function oZ(){let t=!1;const e=new Uh,n=new Uh,i=r=>pl(this,null,function*(){n.next(!0),t=r??!t,e.next(t),n.next(!1)});return{className:As("button"),toggle:i,enabledObserver:e.asObservable(),pendingObserver:n.asObservable()}}function aZ(t,e,n){const i=new hX(void 0),r=tZ(e,t),s=(o,...a)=>pl(this,[o,...a],function*(l,c={}){var u,d,f;if(e){const p=Kn();if(t==="audiooutput"&&((p==null?void 0:p.name)==="Safari"||(p==null?void 0:p.os)==="iOS")){We.warn("Switching audio output device is not supported on Safari and iOS.");return}We.debug(`Switching active device of kind "${t}" with id ${l}.`),yield e.switchActiveDevice(t,l,c.exact);const v=(u=e.getActiveDevice(t))!=null?u:l;v!==l&&l!=="default"&&We.info(`We tried to select the device with id (${l}), but the browser decided to select the device with id (${v}) instead.`);let g;t==="audioinput"?g=(d=e.localParticipant.getTrackPublication(F.Source.Microphone))==null?void 0:d.track:t==="videoinput"&&(g=(f=e.localParticipant.getTrackPublication(F.Source.Camera))==null?void 0:f.track);const E=l==="default"&&!g||l==="default"&&(g==null?void 0:g.mediaStreamTrack.label.startsWith("Default"));i.next(E?l:v)}});return{className:As("media-device-select"),activeDeviceObservable:r,setActiveMediaDevice:s}}function lZ(t){const e=n=>{t.disconnect(n)};return{className:As("disconnect-button"),disconnect:e}}function cZ(){const t=e=>pl(this,null,function*(){We.info("Start Audio for room: ",e),yield e.startAudio()});return{className:As("start-audio-button"),roomAudioPlaybackAllowedObservable:ZX,handleStartAudioPlayback:t}}function uZ(){const t=e=>pl(this,null,function*(){We.info("Start Video for room: ",e),yield e.startVideo()});return{className:As("start-audio-button"),roomVideoPlaybackAllowedObservable:eZ,handleStartVideoPlayback:t}}function dZ(){return{className:[As("button"),As("chat-toggle")].join(" ")}}function hZ(){return{className:"lk-room-container"}}function dI(t,e,n=!0){const i=[t.localParticipant,...Array.from(t.remoteParticipants.values())],r=[];return i.forEach(s=>{e.forEach(o=>{const a=Array.from(s.trackPublications.values()).filter(l=>l.source===o&&(!n||l.track)).map(l=>({participant:s,publication:l,source:l.source}));r.push(...a)})}),{trackReferences:r,participants:i}}function fZ(t,e,n){var i,r;const s=(i=n.additionalRoomEvents)!=null?i:$X,o=(r=n.onlySubscribed)!=null?r:!0,a=Array.from(new Set([H.ParticipantConnected,H.ParticipantDisconnected,H.ConnectionStateChanged,H.LocalTrackPublished,H.LocalTrackUnpublished,H.TrackPublished,H.TrackUnpublished,H.TrackSubscriptionStatusChanged,...s]).values());return yC(t,...a).pipe(Fr(l=>{const c=dI(l,e,o);return We.debug(`TrackReference[] was updated. (length ${c.trackReferences.length})`,c),c}),fl(dI(t,e,o)))}function pZ(t,e){if(typeof localStorage>"u"){We.error("Local storage is not available.");return}try{if(e){const n=Object.fromEntries(Object.entries(e).filter(([,i])=>i!==""));localStorage.setItem(t,JSON.stringify(n))}}catch(n){We.error(`Error setting item to local storage: ${n}`)}}function mZ(t){if(typeof localStorage>"u"){We.error("Local storage is not available.");return}try{const e=localStorage.getItem(t);if(!e){We.warn(`Item with key ${t} does not exist in local storage.`);return}return JSON.parse(e)}catch(e){We.error(`Error getting item from local storage: ${e}`);return}}function gZ(t){return{load:()=>mZ(t),save:e=>pZ(t,e)}}var vZ=`${r4}-user-choices`,ad={videoEnabled:!0,audioEnabled:!0,videoDeviceId:"default",audioDeviceId:"default",username:""},{load:yZ,save:_Z}=gZ(vZ);function bZ(t,e=!1){e!==!0&&_Z(t)}function TZ(t,e=!1){var n,i,r,s,o;const a={videoEnabled:(n=t==null?void 0:t.videoEnabled)!=null?n:ad.videoEnabled,audioEnabled:(i=t==null?void 0:t.audioEnabled)!=null?i:ad.audioEnabled,videoDeviceId:(r=t==null?void 0:t.videoDeviceId)!=null?r:ad.videoDeviceId,audioDeviceId:(s=t==null?void 0:t.audioDeviceId)!=null?s:ad.audioDeviceId,username:(o=t==null?void 0:t.username)!=null?o:ad.username};if(e)return a;{const l=yZ();return uI(uI({},a),l??{})}}const u4=P.createContext(void 0);function d4(){const t=P.useContext(u4);if(!t)throw Error("Tried to access LayoutContext context outside a LayoutContextProvider provider.");return t}function SZ(){return P.useContext(u4)}const EZ=P.createContext(void 0);function CZ(){return P.useContext(EZ)}function kZ(t){const e=CZ(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}P.createContext(void 0);const _C=P.createContext(void 0);function bC(){const t=P.useContext(_C);if(!t)throw Error("tried to access room context outside of livekit room component");return t}function qv(){return P.useContext(_C)}function zv(t){const e=qv(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}P.createContext(void 0);const wZ=P.createContext(void 0);function h4(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var r=t.length;for(e=0;e<r;e++)t[e]&&(n=h4(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function RZ(){for(var t,e,n=0,i="",r=arguments.length;n<r;n++)(t=arguments[n])&&(e=h4(t))&&(i&&(i+=" "),i+=e);return i}function AZ(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(i){console.error(i)}}}function ea(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const i=t[n];for(const r in i){const s=e[r],o=i[r];typeof s=="function"&&typeof o=="function"&&r[0]==="o"&&r[1]==="n"&&r.charCodeAt(2)>=65&&r.charCodeAt(2)<=90?e[r]=AZ(s,o):(r==="className"||r==="UNSAFE_className")&&typeof s=="string"&&typeof o=="string"?e[r]=RZ(s,o):e[r]=o!==void 0?o:s}}return e}function IZ(t){return t!==void 0}function TC(...t){return ea(...t.filter(IZ))}function PZ(t,e){return t==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:t==="e2ee"&&e?"e2ee-enabled":e}const xZ={connect:!0,audio:!1,video:!1};function DZ(t){const{token:e,serverUrl:n,options:i,room:r,connectOptions:s,connect:o,audio:a,video:l,screen:c,onConnected:u,onDisconnected:d,onError:f,onMediaDeviceFailure:p,onEncryptionError:v,simulateParticipants:g,...E}={...xZ,...t};i&&r&&We.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[y,T]=P.useState(),R=P.useRef(o);P.useEffect(()=>{T(r??new Rs(i))},[r,JSON.stringify(i,PZ)]);const b=P.useMemo(()=>{const{className:w}=hZ();return ea(E,{className:w})},[E]);return P.useEffect(()=>{if(!y)return;const w=()=>{const A=y.localParticipant;We.debug("trying to publish local tracks"),Promise.all([A.setMicrophoneEnabled(!!a,typeof a!="boolean"?a:void 0),A.setCameraEnabled(!!l,typeof l!="boolean"?l:void 0),A.setScreenShareEnabled(!!c,typeof c!="boolean"?c:void 0)]).catch(I=>{We.warn(I),f==null||f(I)})},D=(A,I)=>{const N=xh.getFailure(A);p==null||p(N,I)},C=A=>{v==null||v(A)},k=A=>{d==null||d(A)},S=()=>{u==null||u()};return y.on(H.SignalConnected,w).on(H.MediaDevicesError,D).on(H.EncryptionError,C).on(H.Disconnected,k).on(H.Connected,S),()=>{y.off(H.SignalConnected,w).off(H.MediaDevicesError,D).off(H.EncryptionError,C).off(H.Disconnected,k).off(H.Connected,S)}},[y,a,l,c,f,v,p,u,d]),P.useEffect(()=>{if(y){if(g){y.simulateParticipants({participants:{count:g},publish:{audio:!0,useRealTracks:!0}});return}if(o){if(R.current=!0,We.debug("connecting"),!e){We.debug("no token yet");return}if(!n){We.warn("no livekit url provided"),f==null||f(Error("no livekit url provided"));return}y.connect(n,e,s).catch(w=>{We.warn(w),R.current===!0&&(f==null||f(w))})}else We.debug("disconnecting because connect is false"),R.current=!1,y.disconnect()}},[o,e,JSON.stringify(s),y,f,n,g]),P.useEffect(()=>{if(y)return()=>{We.info("disconnecting on onmount"),y.disconnect()}},[y]),{room:y,htmlProps:b}}const OZ=P.forwardRef(function(t,e){const{room:n,htmlProps:i}=DZ(t);return P.createElement("div",{ref:e,...i},n&&P.createElement(_C.Provider,{value:n},P.createElement(wZ.Provider,{value:t.featureFlags},t.children)))});function el(t,e,n=!0){const[i,r]=P.useState(e);return P.useEffect(()=>{if(n&&r(e),typeof window>"u"||!t)return;const s=t.subscribe(r);return()=>s.unsubscribe()},[t,n]),i}function NZ(t){const e=s=>typeof window<"u"?window.matchMedia(s).matches:!1,[n,i]=P.useState(e(t));function r(){i(e(t))}return P.useEffect(()=>{const s=window.matchMedia(t);return r(),s.addListener?s.addListener(r):s.addEventListener("change",r),()=>{s.removeListener?s.removeListener(r):s.removeEventListener("change",r)}},[t]),n}function MZ(t){const e=zv(t),n=P.useMemo(()=>JX(e),[e]);return el(n,e.state)}function LZ(t){const e=bC(),n=MZ(e);return{buttonProps:P.useMemo(()=>{const{className:i,disconnect:r}=lZ(e);return ea(t,{className:i,onClick:()=>r(t.stopTracks??!0),disabled:n===qe.Disconnected})},[e,t,n])}}function UZ(){const t=bC(),e=P.useMemo(()=>rZ(t.localParticipant),[t]);return el(e,t.localParticipant.permissions)}function VZ({kind:t,room:e,track:n,requestPermissions:i,onError:r}){const s=qv(),o=P.useMemo(()=>e??s??new Rs,[e,s]),a=P.useMemo(()=>XX(t,r,i),[t,i,r]),l=el(a,[]),[c,u]=P.useState((o==null?void 0:o.getActiveDevice(t))??"default"),{className:d,activeDeviceObservable:f,setActiveMediaDevice:p}=P.useMemo(()=>aZ(t,o),[t,o,n]);return P.useEffect(()=>{const v=f.subscribe(g=>{g&&(We.info("setCurrentDeviceId",g),u(g))});return()=>{v==null||v.unsubscribe()}},[f]),{devices:l,className:d,activeDeviceId:c,setActiveMediaDevice:p}}function FZ({room:t,props:e}){const n=zv(t),{className:i,roomAudioPlaybackAllowedObservable:r,handleStartAudioPlayback:s}=P.useMemo(()=>cZ(),[]),o=P.useMemo(()=>r(n),[n,r]),{canPlayAudio:a}=el(o,{canPlayAudio:n.canPlaybackAudio});return{mergedProps:P.useMemo(()=>ea(e,{className:i,onClick:()=>{s(n)},style:{display:a?"none":"block"}}),[e,i,a,s,n]),canPlayAudio:a}}function jZ({room:t,props:e}){const n=zv(t),{className:i,roomVideoPlaybackAllowedObservable:r,handleStartVideoPlayback:s}=P.useMemo(()=>uZ(),[]),o=P.useMemo(()=>r(n),[n,r]),{canPlayVideo:a}=el(o,{canPlayVideo:n.canPlaybackVideo});return{mergedProps:P.useMemo(()=>ea(e,{className:i,onClick:()=>{s(n)},style:{display:a?"none":"block"}}),[e,i,a,s,n]),canPlayVideo:a}}function BZ({props:t}){const{dispatch:e,state:n}=d4().widget,{className:i}=P.useMemo(()=>dZ(),[]);return{mergedProps:P.useMemo(()=>ea(t,{className:i,onClick:()=>{e&&e({msg:"toggle_chat"})},"aria-pressed":n!=null&&n.showChat?"true":"false","data-lk-unread-msgs":n?n.unreadMessages<10?n.unreadMessages.toFixed(0):"9+":"0"}),[t,i,e,n])}}function qZ({source:t,onChange:e,initialState:n,captureOptions:i,publishOptions:r,onDeviceError:s,room:o,...a}){var l;const c=qv(),u=P.useMemo(()=>o??c,[o,c]),d=(l=u==null?void 0:u.localParticipant)==null?void 0:l.getTrackPublication(t),f=P.useRef(!1),{toggle:p,className:v,pendingObserver:g,enabledObserver:E}=P.useMemo(()=>u?sZ(t,u,i,r,s):oZ(),[u,t,JSON.stringify(i),r]),y=el(g,!1),T=el(E,n??!!(d!=null&&d.isEnabled));P.useEffect(()=>{e==null||e(T,f.current),f.current=!1},[T,e]),P.useEffect(()=>{n!==void 0&&(We.debug("forcing initial toggle state",t,n),p(n))},[]);const R=P.useMemo(()=>ea(a,{className:v}),[a,v]),b=P.useCallback(w=>{var D;f.current=!0,p().catch(()=>f.current=!1),(D=a.onClick)==null||D.call(a,w)},[a,p]);return{toggle:p,enabled:T,pending:y,track:d,buttonProps:{...R,"aria-pressed":T,"data-lk-source":t,"data-lk-enabled":T,disabled:y,onClick:b}}}function zZ(t=[F.Source.Camera,F.Source.Microphone,F.Source.ScreenShare,F.Source.ScreenShareAudio,F.Source.Unknown],e={}){const n=zv(e.room),[i,r]=P.useState([]),[s,o]=P.useState([]),a=P.useMemo(()=>t.map(l=>o4(l)?l.source:l),[JSON.stringify(t)]);return P.useEffect(()=>{const l=fZ(n,a,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:c,participants:u})=>{We.debug("setting track bundles",c,u),r(c),o(u)});return()=>l.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),P.useMemo(()=>{if(a4(t)){const l=GZ(t,s),c=Array.from(i);return s.forEach(u=>{l.has(u.identity)&&(l.get(u.identity)??[]).forEach(d=>{if(i.find(({participant:p,publication:v})=>u.identity===p.identity&&v.source===d))return;We.debug(`Add ${d} placeholder for participant ${u.identity}.`);const f={participant:u,source:d};c.push(f)})}),c}else return i},[i,s,t])}function HZ(t,e){const n=new Set(t);for(const i of e)n.delete(i);return n}function GZ(t,e){const n=new Map;if(a4(t)){const i=t.filter(r=>r.withPlaceholder).map(r=>r.source);e.forEach(r=>{const s=r.getTrackPublications().map(a=>{var l;return(l=a.track)==null?void 0:l.source}).filter(a=>a!==void 0),o=Array.from(HZ(new Set(i),new Set(s)));o.length>0&&n.set(r.identity,o)})}return n}function KZ(t={}){const[e,n]=P.useState(TZ(t.defaults,t.preventLoad??!1)),i=P.useCallback(l=>{n(c=>({...c,audioEnabled:l}))},[]),r=P.useCallback(l=>{n(c=>({...c,videoEnabled:l}))},[]),s=P.useCallback(l=>{n(c=>({...c,audioDeviceId:l}))},[]),o=P.useCallback(l=>{n(c=>({...c,videoDeviceId:l}))},[]),a=P.useCallback(l=>{n(c=>({...c,username:l}))},[]);return P.useEffect(()=>{bZ(e,t.preventSave??!1)},[e,t.preventSave]),{userChoices:e,saveAudioInputEnabled:i,saveVideoInputEnabled:r,saveAudioInputDeviceId:s,saveVideoInputDeviceId:o,saveUsername:a}}s4.AgentState;var mp={exports:{}},hI;function $Z(){if(hI)return mp.exports;hI=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(b,w,D){return Function.prototype.apply.call(b,w,D)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(b){return Object.getOwnPropertyNames(b).concat(Object.getOwnPropertySymbols(b))}:n=function(b){return Object.getOwnPropertyNames(b)};function i(b){console&&console.warn&&console.warn(b)}var r=Number.isNaN||function(b){return b!==b};function s(){s.init.call(this)}mp.exports=s,mp.exports.once=y,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function a(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");o=b}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(b){if(typeof b!="number"||b<0||r(b))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+b+".");return this._maxListeners=b,this};function l(b){return b._maxListeners===void 0?s.defaultMaxListeners:b._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(b){for(var w=[],D=1;D<arguments.length;D++)w.push(arguments[D]);var C=b==="error",k=this._events;if(k!==void 0)C=C&&k.error===void 0;else if(!C)return!1;if(C){var S;if(w.length>0&&(S=w[0]),S instanceof Error)throw S;var A=new Error("Unhandled error."+(S?" ("+S.message+")":""));throw A.context=S,A}var I=k[b];if(I===void 0)return!1;if(typeof I=="function")e(I,this,w);else for(var N=I.length,O=v(I,N),D=0;D<N;++D)e(O[D],this,w);return!0};function c(b,w,D,C){var k,S,A;if(a(D),S=b._events,S===void 0?(S=b._events=Object.create(null),b._eventsCount=0):(S.newListener!==void 0&&(b.emit("newListener",w,D.listener?D.listener:D),S=b._events),A=S[w]),A===void 0)A=S[w]=D,++b._eventsCount;else if(typeof A=="function"?A=S[w]=C?[D,A]:[A,D]:C?A.unshift(D):A.push(D),k=l(b),k>0&&A.length>k&&!A.warned){A.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=b,I.type=w,I.count=A.length,i(I)}return b}s.prototype.addListener=function(b,w){return c(this,b,w,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(b,w){return c(this,b,w,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(b,w,D){var C={fired:!1,wrapFn:void 0,target:b,type:w,listener:D},k=u.bind(C);return k.listener=D,C.wrapFn=k,k}s.prototype.once=function(b,w){return a(w),this.on(b,d(this,b,w)),this},s.prototype.prependOnceListener=function(b,w){return a(w),this.prependListener(b,d(this,b,w)),this},s.prototype.removeListener=function(b,w){var D,C,k,S,A;if(a(w),C=this._events,C===void 0)return this;if(D=C[b],D===void 0)return this;if(D===w||D.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete C[b],C.removeListener&&this.emit("removeListener",b,D.listener||w));else if(typeof D!="function"){for(k=-1,S=D.length-1;S>=0;S--)if(D[S]===w||D[S].listener===w){A=D[S].listener,k=S;break}if(k<0)return this;k===0?D.shift():g(D,k),D.length===1&&(C[b]=D[0]),C.removeListener!==void 0&&this.emit("removeListener",b,A||w)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(b){var w,D,C;if(D=this._events,D===void 0)return this;if(D.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):D[b]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete D[b]),this;if(arguments.length===0){var k=Object.keys(D),S;for(C=0;C<k.length;++C)S=k[C],S!=="removeListener"&&this.removeAllListeners(S);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=D[b],typeof w=="function")this.removeListener(b,w);else if(w!==void 0)for(C=w.length-1;C>=0;C--)this.removeListener(b,w[C]);return this};function f(b,w,D){var C=b._events;if(C===void 0)return[];var k=C[w];return k===void 0?[]:typeof k=="function"?D?[k.listener||k]:[k]:D?E(k):v(k,k.length)}s.prototype.listeners=function(b){return f(this,b,!0)},s.prototype.rawListeners=function(b){return f(this,b,!1)},s.listenerCount=function(b,w){return typeof b.listenerCount=="function"?b.listenerCount(w):p.call(b,w)},s.prototype.listenerCount=p;function p(b){var w=this._events;if(w!==void 0){var D=w[b];if(typeof D=="function")return 1;if(D!==void 0)return D.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(b,w){for(var D=new Array(w),C=0;C<w;++C)D[C]=b[C];return D}function g(b,w){for(;w+1<b.length;w++)b[w]=b[w+1];b.pop()}function E(b){for(var w=new Array(b.length),D=0;D<w.length;++D)w[D]=b[D].listener||b[D];return w}function y(b,w){return new Promise(function(D,C){function k(A){b.removeListener(w,S),C(A)}function S(){typeof b.removeListener=="function"&&b.removeListener("error",k),D([].slice.call(arguments))}R(b,w,S,{once:!0}),w!=="error"&&T(b,k,{once:!0})})}function T(b,w,D){typeof b.on=="function"&&R(b,"error",w,D)}function R(b,w,D,C){if(typeof b.on=="function")C.once?b.once(w,D):b.on(w,D);else if(typeof b.addEventListener=="function")b.addEventListener(w,function k(S){C.once&&b.removeEventListener(w,k),D(S)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return mp.exports}$Z();const WZ=P.forwardRef(function(t,e){const{mergedProps:n}=BZ({props:t});return P.createElement("button",{ref:e,...n},t.children)}),QZ=P.forwardRef(function(t,e){const{buttonProps:n}=LZ(t);return P.createElement("button",{ref:e,...n},t.children)}),YZ=t=>P.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},P.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),P.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),JZ=t=>P.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},P.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),XZ=t=>P.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:18,fill:"none",...t},P.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h10.5A2.75 2.75 0 0 1 16 2.75v13.594a.75.75 0 0 1-1.234.572l-3.691-3.12a1.25 1.25 0 0 0-.807-.296H2.75A2.75 2.75 0 0 1 0 10.75v-8ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v8c0 .69.56 1.25 1.25 1.25h7.518c.65 0 1.279.23 1.775.65l2.457 2.077V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),P.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M3 4.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Z",clipRule:"evenodd"})),ZZ=t=>P.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},P.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M8.961.894C8.875-.298 7.125-.298 7.04.894c-.066.912-1.246 1.228-1.76.472-.67-.99-2.186-.115-1.664.96.399.824-.465 1.688-1.288 1.289-1.076-.522-1.95.994-.961 1.665.756.513.44 1.693-.472 1.759-1.192.086-1.192 1.836 0 1.922.912.066 1.228 1.246.472 1.76-.99.67-.115 2.186.96 1.664.824-.399 1.688.465 1.289 1.288-.522 1.076.994 1.95 1.665.961.513-.756 1.693-.44 1.759.472.086 1.192 1.836 1.192 1.922 0 .066-.912 1.246-1.228 1.76-.472.67.99 2.186.115 1.664-.96-.399-.824.465-1.688 1.288-1.289 1.076.522 1.95-.994.961-1.665-.756-.513-.44-1.693.472-1.759 1.192-.086 1.192-1.836 0-1.922-.912-.066-1.228-1.246-.472-1.76.99-.67.115-2.186-.96-1.664-.824.399-1.688-.465-1.289-1.288.522-1.076-.994-1.95-1.665-.961-.513.756-1.693.44-1.759-.472ZM8 13A5 5 0 1 0 8 3a5 5 0 0 0 0 10Z",clipRule:"evenodd"})),eee=t=>P.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},P.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M2 2.75A2.75 2.75 0 0 1 4.75 0h6.5A2.75 2.75 0 0 1 14 2.75v10.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-.5a.75.75 0 0 1 1.5 0v.5c0 .69.56 1.25 1.25 1.25h6.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25h-6.5c-.69 0-1.25.56-1.25 1.25v.5a.75.75 0 0 1-1.5 0v-.5Z",clipRule:"evenodd"}),P.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8.78 7.47a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 1 1-1.06-1.06l.97-.97H1.75a.75.75 0 0 1 0-1.5h4.69l-.97-.97a.75.75 0 0 1 1.06-1.06l2.25 2.25Z",clipRule:"evenodd"})),tee=t=>P.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},P.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),P.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),nee=t=>P.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},P.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),P.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),iee=t=>P.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},P.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),P.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),ree=t=>P.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},P.createElement("g",{fill:"currentColor"},P.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),P.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),U0=P.forwardRef(function({kind:t,initialSelection:e,onActiveDeviceChange:n,onDeviceListChange:i,onDeviceSelectError:r,exactMatch:s,track:o,requestPermissions:a,onError:l,...c},u){const d=qv(),f=P.useRef("default"),p=P.useCallback(D=>{d&&d.emit(H.MediaDevicesError,D),l==null||l(D)},[d,l]),{devices:v,activeDeviceId:g,setActiveMediaDevice:E,className:y}=VZ({kind:t,room:d,track:o,requestPermissions:a,onError:p});P.useEffect(()=>{e!==void 0&&E(e)},[E]),P.useEffect(()=>{typeof i=="function"&&i(v)},[i,v]),P.useEffect(()=>{g!==f.current&&(n==null||n(g)),f.current=g},[g]);const T=async D=>{try{await E(D,{exact:s??!0})}catch(C){if(C instanceof Error)r==null||r(C);else throw C}},R=P.useMemo(()=>TC(c,{className:y},{className:"lk-list"}),[y,c]),b=!!v.find(D=>D.label.toLowerCase().startsWith("default"));function w(D,C,k){return D===C||!b&&k===0&&C==="default"}return P.createElement("ul",{ref:u,...R},v.map((D,C)=>P.createElement("li",{key:D.deviceId,id:D.deviceId,"data-lk-active":w(D.deviceId,g,C),"aria-selected":w(D.deviceId,g,C),role:"option"},P.createElement("button",{className:"lk-button",onClick:()=>T(D.deviceId)},D.label))))}),see=P.forwardRef(function({label:t,...e},n){const i=bC(),{mergedProps:r,canPlayAudio:s}=FZ({room:i,props:e}),{mergedProps:o,canPlayVideo:a}=jZ({room:i,props:r}),{style:l,...c}=o;return l.display=s&&a?"none":"block",P.createElement("button",{ref:n,style:l,...c},t??`Start ${s?"Video":"Audio"}`)});function oee(t,e){switch(t){case F.Source.Microphone:return e?P.createElement(nee,null):P.createElement(tee,null);case F.Source.Camera:return e?P.createElement(JZ,null):P.createElement(YZ,null);case F.Source.ScreenShare:return e?P.createElement(ree,null):P.createElement(iee,null);default:return}}const V0=P.forwardRef(function({showIcon:t,...e},n){const{buttonProps:i,enabled:r}=qZ(e),[s,o]=P.useState(!1);return P.useEffect(()=>{o(!0)},[]),s&&P.createElement("button",{ref:n,...i},(t??!0)&&oee(e.source,r),e.children)});function aee(t,e={}){const[n,i]=P.useState(iT(t)),[r,s]=P.useState(n==null?void 0:n.isMuted),[o,a]=P.useState(n==null?void 0:n.isSubscribed),[l,c]=P.useState(n==null?void 0:n.track),[u,d]=P.useState("landscape"),f=P.useRef(),{className:p,trackObserver:v}=P.useMemo(()=>YX(t),[t.participant.sid??t.participant.identity,t.source,vC(t)&&t.publication.trackSid]);return P.useEffect(()=>{const g=v.subscribe(E=>{We.debug("update track",E),i(E),s(E==null?void 0:E.isMuted),a(E==null?void 0:E.isSubscribed),c(E==null?void 0:E.track)});return()=>g==null?void 0:g.unsubscribe()},[v]),P.useEffect(()=>{var g,E;return l&&(f.current&&l.detach(f.current),(g=e.element)!=null&&g.current&&!(t.participant.isLocal&&(l==null?void 0:l.kind)==="audio")&&l.attach(e.element.current)),f.current=(E=e.element)==null?void 0:E.current,()=>{f.current&&(l==null||l.detach(f.current))}},[l,e.element]),P.useEffect(()=>{var g,E;if(typeof((g=n==null?void 0:n.dimensions)==null?void 0:g.width)=="number"&&typeof((E=n==null?void 0:n.dimensions)==null?void 0:E.height)=="number"){const y=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(y)}},[n]),{publication:n,isMuted:r,isSubscribed:o,track:l,elementProps:TC(e.props,{className:p,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n==null?void 0:n.source,...(n==null?void 0:n.kind)==="video"&&{"data-lk-orientation":u}})}}var F0,fI;function lee(){if(fI)return F0;fI=1;var t="Expected a function",e=NaN,n="[object Symbol]",i=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,l=typeof fp=="object"&&fp&&fp.Object===Object&&fp,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),d=Object.prototype,f=d.toString,p=Math.max,v=Math.min,g=function(){return u.Date.now()};function E(w,D,C){var k,S,A,I,N,O,he=0,Ye=!1,J=!1,re=!0;if(typeof w!="function")throw new TypeError(t);D=b(D)||0,y(C)&&(Ye=!!C.leading,J="maxWait"in C,A=J?p(b(C.maxWait)||0,D):A,re="trailing"in C?!!C.trailing:re);function se(Ze){var Qn=k,$i=S;return k=S=void 0,he=Ze,I=w.apply($i,Qn),I}function be(Ze){return he=Ze,N=setTimeout(Zt,D),Ye?se(Ze):I}function ze(Ze){var Qn=Ze-O,$i=Ze-he,ml=D-Qn;return J?v(ml,A-$i):ml}function xn(Ze){var Qn=Ze-O,$i=Ze-he;return O===void 0||Qn>=D||Qn<0||J&&$i>=A}function Zt(){var Ze=g();if(xn(Ze))return gn(Ze);N=setTimeout(Zt,ze(Ze))}function gn(Ze){return N=void 0,re&&k?se(Ze):(k=S=void 0,I)}function en(){N!==void 0&&clearTimeout(N),he=0,k=O=S=N=void 0}function Dn(){return N===void 0?I:gn(g())}function di(){var Ze=g(),Qn=xn(Ze);if(k=arguments,S=this,O=Ze,Qn){if(N===void 0)return be(O);if(J)return N=setTimeout(Zt,D),se(O)}return N===void 0&&(N=setTimeout(Zt,D)),I}return di.cancel=en,di.flush=Dn,di}function y(w){var D=typeof w;return!!w&&(D=="object"||D=="function")}function T(w){return!!w&&typeof w=="object"}function R(w){return typeof w=="symbol"||T(w)&&f.call(w)==n}function b(w){if(typeof w=="number")return w;if(R(w))return e;if(y(w)){var D=typeof w.valueOf=="function"?w.valueOf():w;w=y(D)?D+"":D}if(typeof w!="string")return w===0?w:+w;w=w.replace(i,"");var C=s.test(w);return C||o.test(w)?a(w.slice(2),C?2:8):r.test(w)?e:+w}return F0=E,F0}lee();const cee=P.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,...i},r){const s=kZ(t),o=P.useRef(null);P.useImperativeHandle(r,()=>o.current);const{elementProps:a,isSubscribed:l,track:c,publication:u}=aee(s,{element:o,props:i});return P.useEffect(()=>{e==null||e(!!l)},[l,e]),P.useEffect(()=>{c===void 0||n===void 0||(c instanceof S3?c.setVolume(n):We.warn("Volume can only be set on remote audio tracks."))},[n,c]),P.useEffect(()=>{u===void 0||i.muted===void 0||(u instanceof C3?u.setEnabled(!i.muted):We.warn("Can only call setEnabled on remote track publications."))},[i.muted,u,c]),P.createElement("audio",{ref:o,...a})});function uee({room:t,volume:e,muted:n}){const i=zZ([F.Source.Microphone,F.Source.ScreenShareAudio,F.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0,room:t}).filter(r=>!r.participant.isLocal&&r.publication.kind===F.Kind.Audio);return P.createElement("div",{style:{display:"none"}},i.map(r=>P.createElement(cee,{key:zX(r),trackRef:r,volume:e,muted:n})))}function pI({kind:t,initialSelection:e,onActiveDeviceChange:n,tracks:i,requestPermissions:r=!1,...s}){const[o,a]=P.useState(!1),[l,c]=P.useState([]),[u,d]=P.useState(!0),[f,p]=P.useState(r),v=(T,R)=>{We.debug("handle device change"),a(!1),n==null||n(T,R)},g=P.useRef(null),E=P.useRef(null);P.useLayoutEffect(()=>{o&&p(!0)},[o]),P.useLayoutEffect(()=>{let T;return g.current&&E.current&&(l||u)&&(T=HX(g.current,E.current,(R,b)=>{E.current&&Object.assign(E.current.style,{left:`${R}px`,top:`${b}px`})})),d(!1),()=>{T==null||T()}},[g,E,l,u]);const y=P.useCallback(T=>{E.current&&T.target!==g.current&&o&&GX(E.current,T)&&a(!1)},[o,E,g]);return P.useEffect(()=>(document.addEventListener("click",y),()=>{document.removeEventListener("click",y)}),[y]),P.createElement(P.Fragment,null,P.createElement("button",{className:"lk-button lk-button-menu","aria-pressed":o,...s,onClick:()=>a(!o),ref:g},s.children),!s.disabled&&P.createElement("div",{className:"lk-device-menu",ref:E,style:{visibility:o?"visible":"hidden"}},t?P.createElement(U0,{initialSelection:e,onActiveDeviceChange:T=>v(t,T),onDeviceListChange:c,kind:t,track:i==null?void 0:i[t],requestPermissions:f}):P.createElement(P.Fragment,null,P.createElement("div",{className:"lk-device-menu-heading"},"Audio inputs"),P.createElement(U0,{kind:"audioinput",onActiveDeviceChange:T=>v("audioinput",T),onDeviceListChange:c,track:i==null?void 0:i.audioinput,requestPermissions:f}),P.createElement("div",{className:"lk-device-menu-heading"},"Video inputs"),P.createElement(U0,{kind:"videoinput",onActiveDeviceChange:T=>v("videoinput",T),onDeviceListChange:c,track:i==null?void 0:i.videoinput,requestPermissions:f}))))}function dee({props:t}){const{dispatch:e,state:n}=d4().widget,i="lk-button lk-settings-toggle";return{mergedProps:P.useMemo(()=>ea(t,{className:i,onClick:()=>{e&&e({msg:"toggle_settings"})},"aria-pressed":n!=null&&n.showSettings?"true":"false"}),[t,i,e,n])}}const hee=P.forwardRef(function(t,e){const{mergedProps:n}=dee({props:t});return P.createElement("button",{ref:e,...n},t.children)}),fee=t=>{switch(t){case F.Source.Camera:return 1;case F.Source.Microphone:return 2;case F.Source.ScreenShare:return 3;default:return 0}};function pee({variation:t,controls:e,saveUserChoices:n=!0,onDeviceError:i,...r}){var s;const[o,a]=P.useState(!1),l=SZ();P.useEffect(()=>{var S,A;((S=l==null?void 0:l.widget.state)==null?void 0:S.showChat)!==void 0&&a((A=l==null?void 0:l.widget.state)==null?void 0:A.showChat)},[(s=l==null?void 0:l.widget.state)==null?void 0:s.showChat]);const c=NZ(`(max-width: ${o?1e3:760}px)`)?"minimal":"verbose";t??(t=c);const u={leave:!0,...e},d=UZ();if(!d)u.camera=!1,u.chat=!1,u.microphone=!1,u.screenShare=!1;else{const S=A=>d.canPublish&&(d.canPublishSources.length===0||d.canPublishSources.includes(fee(A)));u.camera??(u.camera=S(F.Source.Camera)),u.microphone??(u.microphone=S(F.Source.Microphone)),u.screenShare??(u.screenShare=S(F.Source.ScreenShare)),u.chat??(u.chat=d.canPublishData&&(e==null?void 0:e.chat))}const f=P.useMemo(()=>t==="minimal"||t==="verbose",[t]),p=P.useMemo(()=>t==="textOnly"||t==="verbose",[t]),v=QX(),[g,E]=P.useState(!1),y=P.useCallback(S=>{E(S)},[E]),T=TC({className:"lk-control-bar"},r),{saveAudioInputEnabled:R,saveVideoInputEnabled:b,saveAudioInputDeviceId:w,saveVideoInputDeviceId:D}=KZ({preventSave:!n}),C=P.useCallback((S,A)=>A?R(S):null,[R]),k=P.useCallback((S,A)=>A?b(S):null,[b]);return P.createElement("div",{...T},u.microphone&&P.createElement("div",{className:"lk-button-group"},P.createElement(V0,{source:F.Source.Microphone,showIcon:f,onChange:C,onDeviceError:S=>i==null?void 0:i({source:F.Source.Microphone,error:S})},p&&"Microphone"),P.createElement("div",{className:"lk-button-group-menu"},P.createElement(pI,{kind:"audioinput",onActiveDeviceChange:(S,A)=>w(A??"default")}))),u.camera&&P.createElement("div",{className:"lk-button-group"},P.createElement(V0,{source:F.Source.Camera,showIcon:f,onChange:k,onDeviceError:S=>i==null?void 0:i({source:F.Source.Camera,error:S})},p&&"Camera"),P.createElement("div",{className:"lk-button-group-menu"},P.createElement(pI,{kind:"videoinput",onActiveDeviceChange:(S,A)=>D(A??"default")}))),u.screenShare&&v&&P.createElement(V0,{source:F.Source.ScreenShare,captureOptions:{audio:!0,selfBrowserSurface:"include"},showIcon:f,onChange:y,onDeviceError:S=>i==null?void 0:i({source:F.Source.ScreenShare,error:S})},p&&(g?"Stop screen share":"Share screen")),u.chat&&P.createElement(WZ,null,f&&P.createElement(XZ,null),p&&"Chat"),u.settings&&P.createElement(hee,null,f&&P.createElement(ZZ,null),p&&"Settings"),u.leave&&P.createElement(QZ,null,f&&P.createElement(eee,null),p&&"Leave"),P.createElement(see,null))}const mee=()=>{const{teacherId:t}=lV(),[e,n]=P.useState(""),i="wss://your-livekit-server.io";return P.useEffect(()=>{n("ey_MOCK_TOKEN_FOR_MVP_PURPOSES_ONLY_ey")},[]),e?G.jsxs("div",{className:"flex h-[calc(100vh-100px)] gap-4 pt-4",children:[G.jsx("div",{className:"flex-grow bg-[#262421] rounded-lg overflow-hidden flex flex-col shadow-2xl border border-[#302e2b]",children:G.jsx("div",{className:"flex-grow relative p-4",children:G.jsx(RK,{teacherId:t})})}),G.jsxs("div",{className:"w-80 flex flex-col gap-4",children:[G.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-lg overflow-hidden flex flex-col h-1/3",children:[G.jsxs("div",{className:"bg-[#161512] p-3 border-b border-[#302e2b] flex justify-between items-center",children:[G.jsx("h3",{className:"font-bold text-white",children:"Sala de Audio"}),G.jsxs("div",{className:"flex items-center gap-1",children:[G.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),G.jsx("span",{className:"text-xs text-[#bababa]",children:"En lnea"})]})]}),G.jsx("div",{className:"flex-grow flex flex-col justify-center items-center p-4 bg-gradient-to-b from-[#262421] to-[#1a1917]",children:e==="ey_MOCK_TOKEN_FOR_MVP_PURPOSES_ONLY_ey"||i.includes("your-livekit-server")?G.jsxs("div",{className:"h-full flex flex-col justify-center items-center text-center p-4",children:[G.jsx("div",{className:"w-16 h-16 bg-[#363431] rounded-full mx-auto flex items-center justify-center mb-2 border-2 border-[#bf811d] animate-pulse",children:G.jsx("span",{className:"text-2xl",children:""})}),G.jsx("p",{className:"text-sm text-[#bababa] font-bold",children:"Modo Demo (Audio Simulado)"}),G.jsxs("p",{className:"text-xs text-[#666] mt-2",children:["Conectado a: ",t]})]}):G.jsxs(OZ,{video:!1,audio:!0,token:e,serverUrl:i,"data-lk-theme":"default",style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},onError:r=>console.log("LiveKit Error:",r),children:[G.jsxs("div",{className:"mb-4 text-center",children:[G.jsx("div",{className:"w-16 h-16 bg-[#363431] rounded-full mx-auto flex items-center justify-center mb-2 border-2 border-[#bf811d]",children:G.jsx("span",{className:"text-2xl",children:""})}),G.jsxs("p",{className:"text-sm text-[#bababa]",children:["Conectado a: ",t]})]}),G.jsx(uee,{}),G.jsx(pee,{variation:"minimal",controls:{microphone:!0,camera:!1,screenShare:!1,leave:!1}})]})})]}),G.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-lg flex-grow flex flex-col overflow-hidden",children:[G.jsx("div",{className:"bg-[#161512] p-3 border-b border-[#302e2b]",children:G.jsx("h3",{className:"font-bold text-white",children:"Chat"})}),G.jsxs("div",{className:"flex-grow p-4 overflow-y-auto space-y-3",children:[G.jsxs("div",{className:"text-sm",children:[G.jsx("span",{className:"font-bold text-[#bf811d] mr-2",children:"GM Ana:"}),G.jsx("span",{className:"text-[#bababa]",children:"Bienvenidos a la clase de hoy. Vamos a ver la Defensa Siciliana."})]}),G.jsxs("div",{className:"text-sm",children:[G.jsx("span",{className:"font-bold text-blue-400 mr-2",children:"Alumno1:"}),G.jsx("span",{className:"text-[#bababa]",children:"Genial!"})]})]}),G.jsx("div",{className:"p-3 border-t border-[#302e2b] bg-[#161512]",children:G.jsx("input",{type:"text",placeholder:"Enviar mensaje...",className:"w-full bg-[#262421] border border-[#302e2b] rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-[#bf811d]"})})]})]})]}):G.jsx("div",{className:"text-center mt-10",children:"Cargando aula..."})},gee=()=>{const{userRole:t,currentUserId:e}=Na.useContext(ff),[n,i]=P.useState(null),[r,s]=P.useState(!0);P.useEffect(()=>{if(t!=="teacher")return;(async()=>{try{const u=Dw(bb,"teachers",e),d=await m7(u);d.exists()?i(d.data()):(console.log("No teacher data found in DB, using mock."),i({name:"GM Ana Smith",earnings:1250.5,classesGiven:42,price:35}))}catch(u){console.error("Error fetching teacher data:",u),i({name:"GM Ana Smith (Demo)",earnings:0,classesGiven:0,price:35})}finally{s(!1)}})()},[t,e]);const o=c=>c<=20?.6:c<=50?.7:.8,a=async()=>{if(!n)return;o(n.classesGiven+1);const u=n.classesGiven+1;let d=.6;u>50?d=.8:u>20&&(d=.7);const p=n.price*d;try{const v=Dw(bb,"teachers",e);await v7(v,{classesGiven:Lw(1),earnings:Lw(p)}),i(g=>({...g,classesGiven:u,earnings:g.earnings+p})),alert(`Clase terminada! Ganaste $${p.toFixed(2)} (${d*100}%)`)}catch(v){console.error("Error updating stats:",v),alert("Error al terminar la clase")}};if(t!=="teacher")return G.jsxs("div",{className:"text-center mt-10 text-xl",children:["Acceso denegado. ",G.jsx("br",{}),G.jsx("span",{className:"text-sm text-[#bababa]",children:"Debes ser profesor."})]});if(r)return G.jsx("div",{className:"text-center mt-10",children:"Cargando panel..."});if(!n)return G.jsx("div",{className:"text-center mt-10",children:"No se encontraron datos del profesor."});const l=o(n.classesGiven+1);return G.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[G.jsxs("h1",{className:"text-3xl font-bold text-white mb-8",children:["Panel de Profesor (",n.name,")"]}),G.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[G.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b]",children:[G.jsxs("div",{className:"flex items-center gap-3 text-[#bf811d] mb-2",children:[G.jsx(d9,{})," ",G.jsx("span",{className:"font-bold",children:"Ganancias Totales"})]}),G.jsxs("p",{className:"text-3xl text-white",children:["$",n.earnings.toFixed(2)]})]}),G.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b]",children:[G.jsxs("div",{className:"flex items-center gap-3 text-[#bf811d] mb-2",children:[G.jsx(c9,{})," ",G.jsx("span",{className:"font-bold",children:"Clases Dadas"})]}),G.jsx("p",{className:"text-3xl text-white",children:n.classesGiven})]}),G.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b]",children:[G.jsxs("div",{className:"flex items-center gap-3 text-[#bf811d] mb-2",children:[G.jsx(m9,{})," ",G.jsx("span",{className:"font-bold",children:"Nivel de Comisin"})]}),G.jsxs("p",{className:"text-3xl text-white",children:[(l*100).toFixed(0),"%"]}),G.jsx("p",{className:"text-xs text-[#bababa] mt-2",children:n.classesGiven<=20?`Faltan ${21-n.classesGiven} para 70%`:n.classesGiven<=50?`Faltan ${51-n.classesGiven} para 80%`:"Nivel Mximo"})]})]}),G.jsxs("div",{className:"bg-[#262421] p-8 rounded-lg border border-[#302e2b] text-center",children:[G.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Control de Clase"}),G.jsx("p",{className:"mb-6",children:"Al terminar una clase, se registrar y se sumar el saldo a tu cuenta."}),G.jsx("button",{onClick:a,className:"bg-[#bf811d] hover:bg-[#a66f19] text-white font-bold py-3 px-8 rounded-full text-lg transition-all transform hover:scale-105 shadow-lg shadow-orange-900/20",children:"Terminar Clase Actual"})]})]})},ff=Na.createContext();function vee(){const[t,e]=P.useState("student"),n=t==="teacher"?"teacher1":"student1";return G.jsx(ff.Provider,{value:{userRole:t,setUserRole:e,currentUserId:n},children:G.jsx($V,{basename:"/TopChess",children:G.jsxs("div",{className:"min-h-screen bg-[#161512] text-[#bababa] font-sans",children:[G.jsx(yee,{}),G.jsx("main",{className:"container mx-auto p-4",children:G.jsxs(EV,{children:[G.jsx(xp,{path:"/",element:G.jsx(NH,{})}),G.jsx(xp,{path:"/room/:teacherId",element:G.jsx(mee,{})}),G.jsx(xp,{path:"/dashboard",element:G.jsx(gee,{})})]})})]})})})}function yee(){const{userRole:t,setUserRole:e}=Na.useContext(ff),n=ID();return G.jsxs("nav",{className:"bg-[#262421] border-b border-[#302e2b] p-4 flex justify-between items-center",children:[G.jsxs(xc,{to:"/",className:"text-xl font-bold flex items-center gap-2 text-[#bababa] hover:text-white transition-colors",children:[G.jsx("span",{className:"text-2xl",children:""})," AjedrezTopChess"]}),G.jsxs("div",{className:"flex items-center gap-6",children:[G.jsxs("div",{className:"flex bg-[#161512] rounded-lg p-1",children:[G.jsx("button",{onClick:()=>e("student"),className:`px-4 py-1 rounded-md text-sm transition-all ${t==="student"?"bg-[#363431] text-white shadow-sm":"text-[#666] hover:text-[#999]"}`,children:"Soy Alumno"}),G.jsx("button",{onClick:()=>{e("teacher"),n("/dashboard")},className:`px-4 py-1 rounded-md text-sm transition-all ${t==="teacher"?"bg-[#363431] text-white shadow-sm":"text-[#666] hover:text-[#999]"}`,children:"Soy Profesor"})]}),t==="teacher"&&G.jsxs(xc,{to:"/dashboard",className:"flex items-center gap-2 px-4 py-2 rounded bg-[#363431] hover:bg-[#403d39] text-[#bababa] hover:text-white transition-colors",children:[G.jsx(f9,{size:18}),"Panel"]})]})]})}k5.createRoot(document.getElementById("root")).render(G.jsx(P.StrictMode,{children:G.jsx(vee,{})}));
