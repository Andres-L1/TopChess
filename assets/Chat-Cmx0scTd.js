import{c as g,d as A,r,A as E,u as q,j as e,f as d}from"./index-wncQym_1.js";import{D as z}from"./dollar-sign-ks_YsM4A.js";import{C as M}from"./circle-check-big-DcxsI4Pv.js";import{C as $}from"./clock-JB3g5ABY.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=g("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=g("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),H=()=>{const{teacherId:j}=A(),w=r.useContext(E),{userRole:s,currentUserId:n}=w,v=q(),a=j,[x,y]=r.useState([]),[l,m]=r.useState(""),[i,u]=r.useState(null),[o,N]=r.useState(null),h=r.useRef(null),[C,b]=r.useState(!1),[p,S]=r.useState(20);r.useEffect(()=>{let t;return n&&a&&(async()=>{const I=await d.getPublicProfile(a);if(N(I),s==="student"){const c=await d.getRequestStatus(n,a);u(c)}else{const c=await d.getRequestStatus(a,n);u(c)}const D=s==="student"?n:a,P=s==="student"?a:n;t=d.subscribeToChat(D,P,c=>{y(c)})})(),()=>{t&&t()}},[a,n,s]),r.useEffect(()=>{var t;(t=h.current)==null||t.scrollIntoView({behavior:"smooth"})},[x]);const f=async()=>{if(!l.trim())return;const t={studentId:s==="student"?n:a,teacherId:s==="student"?a:n,text:l,sender:s||"student",timestamp:Date.now(),type:"text"};s==="student"&&!i&&(await d.createRequest({id:`req_${Date.now()}`,studentId:n,teacherId:a,status:"pending",timestamp:Date.now(),message:l}),u("pending")),await d.sendMessage(t),m("")},k=async()=>{const t=new Date().toLocaleString("es-ES",{month:"long"});alert("Pago realizado con Ã©xito!"),b(!1),s==="student"&&await d.sendMessage({studentId:n,teacherId:a,text:`ðŸ’° He pagado la mensualidad de ${t} (${p}â‚¬)`,sender:"student",timestamp:Date.now(),type:"payment_request"})};return o?e.jsxs("div",{className:"max-w-2xl mx-auto h-[calc(100vh-100px)] flex flex-col pt-4",children:[e.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-t-lg p-4 flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:o.image,alt:o.name,className:"w-12 h-12 rounded-full object-cover border border-[#403d39]"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-white text-lg",children:o.name}),e.jsx("p",{className:"text-xs text-[#bababa]",children:s==="student"?"Profesor":"Estudiante"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s==="student"&&i==="approved"&&e.jsxs("button",{onClick:()=>b(!0),className:"bg-[#D4AF37]/20 hover:bg-[#D4AF37]/40 text-[#D4AF37] border border-[#D4AF37]/50 px-3 py-2 rounded font-bold flex items-center gap-2 text-xs transition-colors mr-2",children:[e.jsx(z,{size:14})," Pagar Mensualidad"]}),i==="approved"&&e.jsxs("button",{onClick:()=>v(s==="student"?`/classroom/${a}`:`/classroom/${n}`),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold flex items-center gap-2 text-sm transition-colors",children:[e.jsx(M,{size:16})," Ir al Aula"]}),i==="pending"&&e.jsxs("div",{className:"bg-[#bf811d]/20 text-[#bf811d] border border-[#bf811d]/30 px-3 py-1 rounded text-xs flex items-center gap-2 font-bold",children:[e.jsx($,{size:14})," Solicitud Pendiente"]}),!i&&s==="student"&&e.jsxs("div",{className:"bg-gray-700/50 text-gray-400 px-3 py-1 rounded text-xs flex items-center gap-2",children:[e.jsx(R,{size:14})," Sin conexiÃ³n"]})]})]}),e.jsxs("div",{className:"flex-grow bg-[#161512] border-x border-[#302e2b] p-4 overflow-y-auto space-y-3 relative",children:[x.length===0?e.jsx("div",{className:"text-center text-[#666] mt-10",children:e.jsx("p",{className:"mb-2",children:s==="student"?`EnvÃ­a un mensaje para solicitar clases con ${o.name}.`:`Inicio del historial de chat con ${o.name}.`})}):x.map(t=>e.jsx("div",{className:`flex ${t.sender===s?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 text-sm ${t.sender===s?"bg-[#2b5f8f] text-white rounded-br-none":"bg-[#262421] text-[#bababa] border border-[#302e2b] rounded-bl-none"}`,children:[e.jsx("p",{children:t.text}),e.jsx("span",{className:"text-[10px] opacity-50 block text-right mt-1",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},t.id)),e.jsx("div",{ref:h})]}),e.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-b-lg p-3 flex gap-2",children:[e.jsx("input",{type:"text",value:l,onChange:t=>m(t.target.value),onKeyDown:t=>t.key==="Enter"&&f(),placeholder:i==="approved"?"Escribe un mensaje...":"Escribe para solicitar conexiÃ³n...",className:"flex-grow bg-[#161512] border border-[#302e2b] text-white text-sm rounded px-3 focus:outline-none focus:border-[#bf811d] transition-colors"}),e.jsx("button",{onClick:f,disabled:!l.trim(),className:"bg-[#bf811d] text-white p-2 rounded hover:bg-[#a66f19] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(F,{size:18})})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#262421] w-full max-w-sm rounded-2xl border border-white/10 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b border-white/5",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Pagar Mensualidad"}),e.jsxs("p",{className:"text-xs text-[#8b8982]",children:["SuscripciÃ³n con ",o.name]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-xs font-bold text-[#8b8982] uppercase mb-2",children:"Cantidad"}),e.jsx("input",{type:"number",value:p,onChange:t=>S(Number(t.target.value)),className:"w-full bg-[#1a1917] border border-white/10 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-[#D4AF37] font-bold text-lg mb-4"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>b(!1),className:"px-4 py-2 text-[#8b8982] hover:text-white font-bold text-sm",children:"Cancelar"}),e.jsx("button",{onClick:k,className:"px-6 py-2 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-white transition-colors",children:"Confirmar"})]})]})]})})]}):e.jsx("div",{className:"p-8 text-center text-white",children:"Cargando perfil..."})};export{H as default};
