var zn=Object.defineProperty;var Bn=(e,t,r)=>t in e?zn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var O=(e,t,r)=>Bn(e,typeof t!="symbol"?t+"":t,r);import{c as he,r as T,A as fr,j as d,F as Un,z as ot,d as Hn,R as Wn,u as Gn}from"./index-DP2pZohF.js";import{m as $e}from"./mockDatabase-Ca8sFJxX.js";import{C as Vt,L as Zt}from"./Logo-C3MOGyYG.js";import{S as Yt}from"./shield-CwrlDbou.js";import{L as Qn}from"./log-out-DV6TF3FA.js";import{C as at}from"./chevron-right-9d3lIEif.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=he("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vn=he("CircleArrowUp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=he("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xt=he("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yn=he("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xn=he("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=he("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ei=he("ScrollText",[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ti=he("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ri=he("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function ni(e){return e!==null?{comment:e,variations:[]}:{variations:[]}}function ii(e,t,r,n,i){const s={move:e,variations:i};return t&&(s.suffix=t),r&&(s.nag=r),n!==null&&(s.comment=n),s}function si(...e){const[t,...r]=e;let n=t;for(const i of r)i!==null&&(n.variations=[i,...i.variations],i.variations=[],n=i);return t}function oi(e,t){if(t.marker&&t.marker.comment){let r=t.root;for(;;){const n=r.variations[0];if(!n){r.comment=t.marker.comment;break}r=n}}return{headers:e,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function ai(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function Oe(e,t,r,n){var i=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(i,Oe.prototype),i.expected=t,i.found=r,i.location=n,i.name="SyntaxError",i}ai(Oe,Error);function lt(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,r+=r.repeat(t),e+r.slice(0,t))}Oe.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r=null,n;for(n=0;n<e.length;n++)if(e[n].source===this.location.source){r=e[n].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,s=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(i):i,o=this.location.source+":"+s.line+":"+s.column;if(r){var a=this.location.end,c=lt("",s.line.toString().length," "),l=r[i.line-1],m=i.line===a.line?a.column:l.length+1,b=m-i.column||1;t+=`
 --> `+o+`
`+c+` |
`+s.line+" | "+l+`
`+c+" | "+lt("",i.column-1," ")+lt("",b,"^")}else t+=`
 at `+o}return t};Oe.buildMessage=function(e,t){var r={literal:function(l){return'"'+i(l.text)+'"'},class:function(l){var m=l.parts.map(function(b){return Array.isArray(b)?s(b[0])+"-"+s(b[1]):s(b)});return"["+(l.inverted?"^":"")+m.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(l){return l.description}};function n(l){return l.charCodeAt(0).toString(16).toUpperCase()}function i(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+n(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+n(m)})}function s(l){return l.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+n(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+n(m)})}function o(l){return r[l.type](l)}function a(l){var m=l.map(o),b,g;if(m.sort(),m.length>0){for(b=1,g=1;b<m.length;b++)m[b-1]!==m[b]&&(m[g]=m[b],g++);m.length=g}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}function c(l){return l?'"'+i(l)+'"':"end of input"}return"Expected "+a(e)+" but "+c(t)+" found."};function li(e,t){t=t!==void 0?t:{};var r={},n=t.grammarSource,i={pgn:Bt},s=Bt,o="[",a='"',c="]",l=".",m="O-O-O",b="O-O",g="0-0-0",w="0-0",v="$",x="{",E="}",$=";",q="(",X=")",L="1-0",Q="0-1",re="1/2-1/2",le="*",A=/^[a-zA-Z]/,ce=/^[^"]/,I=/^[0-9]/,V=/^[.]/,pe=/^[a-zA-Z1-8\-=]/,ze=/^[+#]/,j=/^[!?]/,P=/^[^}]/,F=/^[^\r\n]/,K=/^[ \t\r\n]/,de=ne("tag pair"),oe=U("[",!1),ke=U('"',!1),Ur=U("]",!1),Hr=ne("tag name"),it=ue([["a","z"],["A","Z"]],!1,!1),Wr=ne("tag value"),Tt=ue(['"'],!0,!1),Gr=ne("move number"),Be=ue([["0","9"]],!1,!1),Qr=U(".",!1),Rt=ue(["."],!1,!1),Vr=ne("standard algebraic notation"),Zr=U("O-O-O",!1),Yr=U("O-O",!1),Xr=U("0-0-0",!1),Jr=U("0-0",!1),qt=ue([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),en=ue(["+","#"],!1,!1),tn=ne("suffix annotation"),Lt=ue(["!","?"],!1,!1),rn=ne("NAG"),nn=U("$",!1),sn=ne("brace comment"),on=U("{",!1),Kt=ue(["}"],!0,!1),an=U("}",!1),ln=ne("rest of line comment"),cn=U(";",!1),Dt=ue(["\r",`
`],!0,!1),dn=ne("variation"),un=U("(",!1),fn=U(")",!1),hn=ne("game termination marker"),pn=U("1-0",!1),gn=U("0-1",!1),mn=U("1/2-1/2",!1),bn=U("*",!1),vn=ne("whitespace"),It=ue([" ","	","\r",`
`],!1,!1),xn=function(u,h){return oi(u,h)},_n=function(u){return Object.fromEntries(u)},wn=function(u,h){return[u,h]},yn=function(u,h){return{root:u,marker:h}},kn=function(u,h){return si(ni(u),...h.flat())},Cn=function(u,h,p,k,C){return ii(u,h,p,k,C)},Sn=function(u){return u},Nn=function(u){return u.replace(/[\r\n]+/g," ")},Pn=function(u){return u.trim()},En=function(u){return u},jn=function(u,h){return{result:u,comment:h}},f=t.peg$currPos|0,Me=[{line:1,column:1}],ae=f,Ue=t.peg$maxFailExpected||[],_=t.peg$silentFails|0,Te;if(t.startRule){if(!(t.startRule in i))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');s=i[t.startRule]}function U(u,h){return{type:"literal",text:u,ignoreCase:h}}function ue(u,h,p){return{type:"class",parts:u,inverted:h,ignoreCase:p}}function An(){return{type:"end"}}function ne(u){return{type:"other",description:u}}function Ft(u){var h=Me[u],p;if(h)return h;if(u>=Me.length)p=Me.length-1;else for(p=u;!Me[--p];);for(h=Me[p],h={line:h.line,column:h.column};p<u;)e.charCodeAt(p)===10?(h.line++,h.column=1):h.column++,p++;return Me[u]=h,h}function zt(u,h,p){var k=Ft(u),C=Ft(h),M={source:n,start:{offset:u,line:k.line,column:k.column},end:{offset:h,line:C.line,column:C.column}};return M}function y(u){f<ae||(f>ae&&(ae=f,Ue=[]),Ue.push(u))}function Mn(u,h,p){return new Oe(Oe.buildMessage(u,h),u,h,p)}function Bt(){var u,h,p;return u=f,h=$n(),p=Rn(),u=xn(h,p),u}function $n(){var u,h,p;for(u=f,h=[],p=Ut();p!==r;)h.push(p),p=Ut();return p=Z(),u=_n(h),u}function Ut(){var u,h,p,k,C,M,Ce;return _++,u=f,Z(),e.charCodeAt(f)===91?(h=o,f++):(h=r,_===0&&y(oe)),h!==r?(Z(),p=On(),p!==r?(Z(),e.charCodeAt(f)===34?(k=a,f++):(k=r,_===0&&y(ke)),k!==r?(C=Tn(),e.charCodeAt(f)===34?(M=a,f++):(M=r,_===0&&y(ke)),M!==r?(Z(),e.charCodeAt(f)===93?(Ce=c,f++):(Ce=r,_===0&&y(Ur)),Ce!==r?u=wn(p,C):(f=u,u=r)):(f=u,u=r)):(f=u,u=r)):(f=u,u=r)):(f=u,u=r),_--,u===r&&_===0&&y(de),u}function On(){var u,h,p;if(_++,u=f,h=[],p=e.charAt(f),A.test(p)?f++:(p=r,_===0&&y(it)),p!==r)for(;p!==r;)h.push(p),p=e.charAt(f),A.test(p)?f++:(p=r,_===0&&y(it));else h=r;return h!==r?u=e.substring(u,f):u=h,_--,u===r&&(h=r,_===0&&y(Hr)),u}function Tn(){var u,h,p;for(_++,u=f,h=[],p=e.charAt(f),ce.test(p)?f++:(p=r,_===0&&y(Tt));p!==r;)h.push(p),p=e.charAt(f),ce.test(p)?f++:(p=r,_===0&&y(Tt));return u=e.substring(u,f),_--,h=r,_===0&&y(Wr),u}function Rn(){var u,h,p;return u=f,h=Ht(),Z(),p=Fn(),p===r&&(p=null),Z(),u=yn(h,p),u}function Ht(){var u,h,p,k;for(u=f,h=st(),h===r&&(h=null),p=[],k=Wt();k!==r;)p.push(k),k=Wt();return u=kn(h,p),u}function Wt(){var u,h,p,k,C,M,Ce,He;if(u=f,Z(),qn(),Z(),h=Ln(),h!==r){for(p=Kn(),p===r&&(p=null),k=[],C=Gt();C!==r;)k.push(C),C=Gt();for(C=Z(),M=st(),M===r&&(M=null),Ce=[],He=Qt();He!==r;)Ce.push(He),He=Qt();u=Cn(h,p,k,M,Ce)}else f=u,u=r;return u}function qn(){var u,h,p,k,C,M;for(_++,u=f,h=[],p=e.charAt(f),I.test(p)?f++:(p=r,_===0&&y(Be));p!==r;)h.push(p),p=e.charAt(f),I.test(p)?f++:(p=r,_===0&&y(Be));if(e.charCodeAt(f)===46?(p=l,f++):(p=r,_===0&&y(Qr)),p!==r){for(k=Z(),C=[],M=e.charAt(f),V.test(M)?f++:(M=r,_===0&&y(Rt));M!==r;)C.push(M),M=e.charAt(f),V.test(M)?f++:(M=r,_===0&&y(Rt));h=[h,p,k,C],u=h}else f=u,u=r;return _--,u===r&&(h=r,_===0&&y(Gr)),u}function Ln(){var u,h,p,k,C,M;if(_++,u=f,h=f,e.substr(f,5)===m?(p=m,f+=5):(p=r,_===0&&y(Zr)),p===r&&(e.substr(f,3)===b?(p=b,f+=3):(p=r,_===0&&y(Yr)),p===r&&(e.substr(f,5)===g?(p=g,f+=5):(p=r,_===0&&y(Xr)),p===r&&(e.substr(f,3)===w?(p=w,f+=3):(p=r,_===0&&y(Jr)),p===r))))if(p=f,k=e.charAt(f),A.test(k)?f++:(k=r,_===0&&y(it)),k!==r){if(C=[],M=e.charAt(f),pe.test(M)?f++:(M=r,_===0&&y(qt)),M!==r)for(;M!==r;)C.push(M),M=e.charAt(f),pe.test(M)?f++:(M=r,_===0&&y(qt));else C=r;C!==r?(k=[k,C],p=k):(f=p,p=r)}else f=p,p=r;return p!==r?(k=e.charAt(f),ze.test(k)?f++:(k=r,_===0&&y(en)),k===r&&(k=null),p=[p,k],h=p):(f=h,h=r),h!==r?u=e.substring(u,f):u=h,_--,u===r&&(h=r,_===0&&y(Vr)),u}function Kn(){var u,h,p;for(_++,u=f,h=[],p=e.charAt(f),j.test(p)?f++:(p=r,_===0&&y(Lt));p!==r;)h.push(p),h.length>=2?p=r:(p=e.charAt(f),j.test(p)?f++:(p=r,_===0&&y(Lt)));return h.length<1?(f=u,u=r):u=h,_--,u===r&&(h=r,_===0&&y(tn)),u}function Gt(){var u,h,p,k,C;if(_++,u=f,Z(),e.charCodeAt(f)===36?(h=v,f++):(h=r,_===0&&y(nn)),h!==r){if(p=f,k=[],C=e.charAt(f),I.test(C)?f++:(C=r,_===0&&y(Be)),C!==r)for(;C!==r;)k.push(C),C=e.charAt(f),I.test(C)?f++:(C=r,_===0&&y(Be));else k=r;k!==r?p=e.substring(p,f):p=k,p!==r?u=Sn(p):(f=u,u=r)}else f=u,u=r;return _--,u===r&&_===0&&y(rn),u}function st(){var u;return u=Dn(),u===r&&(u=In()),u}function Dn(){var u,h,p,k,C;if(_++,u=f,e.charCodeAt(f)===123?(h=x,f++):(h=r,_===0&&y(on)),h!==r){for(p=f,k=[],C=e.charAt(f),P.test(C)?f++:(C=r,_===0&&y(Kt));C!==r;)k.push(C),C=e.charAt(f),P.test(C)?f++:(C=r,_===0&&y(Kt));p=e.substring(p,f),e.charCodeAt(f)===125?(k=E,f++):(k=r,_===0&&y(an)),k!==r?u=Nn(p):(f=u,u=r)}else f=u,u=r;return _--,u===r&&(h=r,_===0&&y(sn)),u}function In(){var u,h,p,k,C;if(_++,u=f,e.charCodeAt(f)===59?(h=$,f++):(h=r,_===0&&y(cn)),h!==r){for(p=f,k=[],C=e.charAt(f),F.test(C)?f++:(C=r,_===0&&y(Dt));C!==r;)k.push(C),C=e.charAt(f),F.test(C)?f++:(C=r,_===0&&y(Dt));p=e.substring(p,f),u=Pn(p)}else f=u,u=r;return _--,u===r&&(h=r,_===0&&y(ln)),u}function Qt(){var u,h,p,k;return _++,u=f,Z(),e.charCodeAt(f)===40?(h=q,f++):(h=r,_===0&&y(un)),h!==r?(p=Ht(),p!==r?(Z(),e.charCodeAt(f)===41?(k=X,f++):(k=r,_===0&&y(fn)),k!==r?u=En(p):(f=u,u=r)):(f=u,u=r)):(f=u,u=r),_--,u===r&&_===0&&y(dn),u}function Fn(){var u,h,p;return _++,u=f,e.substr(f,3)===L?(h=L,f+=3):(h=r,_===0&&y(pn)),h===r&&(e.substr(f,3)===Q?(h=Q,f+=3):(h=r,_===0&&y(gn)),h===r&&(e.substr(f,7)===re?(h=re,f+=7):(h=r,_===0&&y(mn)),h===r&&(e.charCodeAt(f)===42?(h=le,f++):(h=r,_===0&&y(bn))))),h!==r?(Z(),p=st(),p===r&&(p=null),u=jn(h,p)):(f=u,u=r),_--,u===r&&(h=r,_===0&&y(hn)),u}function Z(){var u,h;for(_++,u=[],h=e.charAt(f),K.test(h)?f++:(h=r,_===0&&y(It));h!==r;)u.push(h),h=e.charAt(f),K.test(h)?f++:(h=r,_===0&&y(It));return _--,h=r,_===0&&y(vn),u}if(Te=s(),t.peg$library)return{peg$result:Te,peg$currPos:f,peg$FAILED:r,peg$maxFailExpected:Ue,peg$maxFailPos:ae};if(Te!==r&&f===e.length)return Te;throw Te!==r&&f<e.length&&y(An()),Mn(Ue,ae<e.length?e.charAt(ae):null,ae<e.length?zt(ae,ae+1):zt(ae,ae))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const Ve=0xffffffffffffffffn;function ct(e,t){return(e<<t|e>>64n-t)&0xffffffffffffffffn}function Jt(e,t){return e*t&Ve}function ci(e){return function(){let t=BigInt(e&Ve),r=BigInt(e>>64n&Ve);const n=Jt(ct(Jt(t,5n),7n),9n);return r^=t,t=(ct(t,24n)^r^r<<16n)&Ve,r=ct(r,37n),e=r<<64n|t,n}}const nt=ci(0xa187eb39cdcaed8f31c4b365b102e01en),di=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>nt()))),ui=Array.from({length:8},()=>nt()),fi=Array.from({length:16},()=>nt()),dt=nt(),G="w",te="b",D="p",xt="n",Ze="b",Ke="r",_e="q",z="k",ut="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Ge{constructor(t,r){O(this,"color");O(this,"from");O(this,"to");O(this,"piece");O(this,"captured");O(this,"promotion");O(this,"flags");O(this,"san");O(this,"lan");O(this,"before");O(this,"after");const{color:n,piece:i,from:s,to:o,flags:a,captured:c,promotion:l}=r,m=H(s),b=H(o);this.color=n,this.piece=i,this.from=m,this.to=b,this.san=t._moveToSan(r,t._moves({legal:!0})),this.lan=m+b,this.before=t.fen(),t._makeMove(r),this.after=t.fen(),t._undoMove(),this.flags="";for(const g in N)N[g]&a&&(this.flags+=Se[g]);c&&(this.captured=c),l&&(this.promotion=l,this.lan+=l)}isCapture(){return this.flags.indexOf(Se.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Se.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Se.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Se.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Se.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Se.BIG_PAWN)>-1}}const W=-1,Se={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},N={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},_t={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},hi={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},pi={..._t,...hi},S={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ft={b:[16,32,17,15],w:[-16,-32,-17,-15]},er={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},gi=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],mi=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],bi={p:1,n:2,b:4,r:8,q:16,k:32},vi="pnbrqkPNBRQK",tr=[xt,Ze,Ke,_e],xi=7,_i=6,wi=1,yi=0,Qe={[z]:N.KSIDE_CASTLE,[_e]:N.QSIDE_CASTLE},be={w:[{square:S.a1,flag:N.QSIDE_CASTLE},{square:S.h1,flag:N.KSIDE_CASTLE}],b:[{square:S.a8,flag:N.QSIDE_CASTLE},{square:S.h8,flag:N.KSIDE_CASTLE}]},ki={b:wi,w:_i},ht="--";function Pe(e){return e>>4}function De(e){return e&15}function hr(e){return"0123456789".indexOf(e)!==-1}function H(e){const t=De(e),r=Pe(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function Re(e){return e===G?te:G}function Ci(e){const t=e.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const r=parseInt(t[5],10);if(isNaN(r)||r<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const n=parseInt(t[4],10);if(isNaN(n)||n<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=t[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<i.length;o++){let a=0,c=!1;for(let l=0;l<i[o].length;l++)if(hr(i[o][l])){if(c)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(i[o][l],10),c=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[o][l]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,c=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:a}of s){if(!a.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((t[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(i[0]+i[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Si(e,t){const r=e.from,n=e.to,i=e.piece;let s=0,o=0,a=0;for(let c=0,l=t.length;c<l;c++){const m=t[c].from,b=t[c].to,g=t[c].piece;i===g&&r!==m&&n===b&&(s++,Pe(r)===Pe(m)&&o++,De(r)===De(m)&&a++)}return s>0?o>0&&a>0?H(r):a>0?H(r).charAt(1):H(r).charAt(0):""}function ve(e,t,r,n,i,s=void 0,o=N.NORMAL){const a=Pe(n);if(i===D&&(a===xi||a===yi))for(let c=0;c<tr.length;c++){const l=tr[c];e.push({color:t,from:r,to:n,piece:i,captured:s,promotion:l,flags:o|N.PROMOTION})}else e.push({color:t,from:r,to:n,piece:i,captured:s,flags:o})}function rr(e){let t=e.charAt(0);return t>="a"&&t<="h"?e.match(/[a-h]\d.*[a-h]\d/)?void 0:D:(t=t.toLowerCase(),t==="o"?z:t)}function pt(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Ni{constructor(t=ut,{skipValidation:r=!1}={}){O(this,"_board",new Array(128));O(this,"_turn",G);O(this,"_header",{});O(this,"_kings",{w:W,b:W});O(this,"_epSquare",-1);O(this,"_halfMoves",0);O(this,"_moveNumber",0);O(this,"_history",[]);O(this,"_comments",{});O(this,"_castling",{w:0,b:0});O(this,"_hash",0n);O(this,"_positionCount",new Map);this.load(t,{skipValidation:r})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:W,b:W},this._turn=G,this._castling={w:0,b:0},this._epSquare=W,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...pi},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:r=!1,preserveHeaders:n=!1}={}){let i=t.split(/\s+/);if(i.length>=2&&i.length<6){const a=["-","-","0","1"];t=i.concat(a.slice(-(6-i.length))).join(" ")}if(i=t.split(/\s+/),!r){const{ok:a,error:c}=Ci(t);if(!a)throw new Error(c)}const s=i[0];let o=0;this.clear({preserveHeaders:n});for(let a=0;a<s.length;a++){const c=s.charAt(a);if(c==="/")o+=8;else if(hr(c))o+=parseInt(c,10);else{const l=c<"a"?G:te;this._put({type:c.toLowerCase(),color:l},H(o)),o++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=N.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=N.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=N.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=N.QSIDE_CASTLE),this._epSquare=i[3]==="-"?W:S[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var o,a;let r=0,n="";for(let c=S.a8;c<=S.h1;c++){if(this._board[c]){r>0&&(n+=r,r=0);const{color:l,type:m}=this._board[c];n+=l===G?m.toUpperCase():m.toLowerCase()}else r++;c+1&136&&(r>0&&(n+=r),c!==S.h1&&(n+="/"),r=0,c+=8)}let i="";this._castling[G]&N.KSIDE_CASTLE&&(i+="K"),this._castling[G]&N.QSIDE_CASTLE&&(i+="Q"),this._castling[te]&N.KSIDE_CASTLE&&(i+="k"),this._castling[te]&N.QSIDE_CASTLE&&(i+="q"),i=i||"-";let s="-";if(this._epSquare!==W)if(t)s=H(this._epSquare);else{const c=this._epSquare+(this._turn===G?16:-16),l=[c+1,c-1];for(const m of l){if(m&136)continue;const b=this._turn;if(((o=this._board[m])==null?void 0:o.color)===b&&((a=this._board[m])==null?void 0:a.type)===D){this._makeMove({color:b,from:m,to:this._epSquare,piece:D,captured:D,flags:N.EP_CAPTURE});const g=!this._isKingAttacked(b);if(this._undoMove(),g){s=H(this._epSquare);break}}}}return[n,this._turn,i,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:r,type:n}=this._board[t],i={w:0,b:1}[r],s={p:0,n:1,b:2,r:3,q:4,k:5}[n];return di[i][s][t]}_epKey(){return this._epSquare===W?0n:ui[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return fi[t]}_computeHash(){let t=0n;for(let r=S.a8;r<=S.h1;r++){if(r&136){r+=7;continue}this._board[r]&&(t^=this._pieceKey(r))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=dt),t}_updateSetup(t){this._history.length>0||(t!==ut?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(ut)}get(t){return this._board[S[t]]}findPiece(t){var n;const r=[];for(let i=S.a8;i<=S.h1;i++){if(i&136){i+=7;continue}!this._board[i]||((n=this._board[i])==null?void 0:n.color)!==t.color||this._board[i].color===t.color&&this._board[i].type===t.type&&r.push(H(i))}return r}put({type:t,color:r},n){return this._put({type:t,color:r},n)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,r){this._hash^=this._pieceKey(t),this._board[t]=r,this._hash^=this._pieceKey(t)}_put({type:t,color:r},n){if(vi.indexOf(t.toLowerCase())===-1||!(n in S))return!1;const i=S[n];if(t==z&&!(this._kings[r]==W||this._kings[r]==i))return!1;const s=this._board[i];return s&&s.type===z&&(this._kings[s.color]=W),this._set(i,{type:t,color:r}),t===z&&(this._kings[r]=i),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const r=this.get(t);return this._clear(S[t]),r&&r.type===z&&(this._kings[r.color]=W),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),r}_updateCastlingRights(){var n,i,s,o,a,c,l,m,b,g,w,v;this._hash^=this._castlingKey();const t=((n=this._board[S.e1])==null?void 0:n.type)===z&&((i=this._board[S.e1])==null?void 0:i.color)===G,r=((s=this._board[S.e8])==null?void 0:s.type)===z&&((o=this._board[S.e8])==null?void 0:o.color)===te;(!t||((a=this._board[S.a1])==null?void 0:a.type)!==Ke||((c=this._board[S.a1])==null?void 0:c.color)!==G)&&(this._castling.w&=-65),(!t||((l=this._board[S.h1])==null?void 0:l.type)!==Ke||((m=this._board[S.h1])==null?void 0:m.color)!==G)&&(this._castling.w&=-33),(!r||((b=this._board[S.a8])==null?void 0:b.type)!==Ke||((g=this._board[S.a8])==null?void 0:g.color)!==te)&&(this._castling.b&=-65),(!r||((w=this._board[S.h8])==null?void 0:w.type)!==Ke||((v=this._board[S.h8])==null?void 0:v.color)!==te)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,o;if(this._epSquare===W)return;const t=this._epSquare+(this._turn===G?-16:16),r=this._epSquare+(this._turn===G?16:-16),n=[r+1,r-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((s=this._board[r])==null?void 0:s.color)!==Re(this._turn)||((o=this._board[r])==null?void 0:o.type)!==D){this._hash^=this._epKey(),this._epSquare=W;return}const i=a=>{var c,l;return!(a&136)&&((c=this._board[a])==null?void 0:c.color)===this._turn&&((l=this._board[a])==null?void 0:l.type)===D};n.some(i)||(this._hash^=this._epKey(),this._epSquare=W)}_attacked(t,r,n){const i=[];for(let s=S.a8;s<=S.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==t)continue;const o=this._board[s],a=s-r;if(a===0)continue;const c=a+119;if(gi[c]&bi[o.type]){if(o.type===D){if(a>0&&o.color===G||a<=0&&o.color===te)if(n)i.push(H(s));else return!0;continue}if(o.type==="n"||o.type==="k")if(n){i.push(H(s));continue}else return!0;const l=mi[c];let m=s+l,b=!1;for(;m!==r;){if(this._board[m]!=null){b=!0;break}m+=l}if(!b)if(n){i.push(H(s));continue}else return!0}}return n?i:!1}attackers(t,r){return r?this._attacked(r,S[t],!0):this._attacked(this._turn,S[t],!0)}_isKingAttacked(t){const r=this._kings[t];return r===-1?!1:this._attacked(Re(t),r)}hash(){return this._hash.toString(16)}isAttacked(t,r){return this._attacked(r,S[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},r=[];let n=0,i=0;for(let s=S.a8;s<=S.h1;s++){if(i=(i+1)%2,s&136){s+=7;continue}const o=this._board[s];o&&(t[o.type]=o.type in t?t[o.type]+1:1,o.type===Ze&&r.push(i),n++)}if(n===2)return!0;if(n===3&&(t[Ze]===1||t[xt]===1))return!0;if(n===t[Ze]+2){let s=0;const o=r.length;for(let a=0;a<o;a++)s+=r[a];if(s===0||s===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:r=void 0,piece:n=void 0}={}){const i=this._moves({square:r,piece:n});return t?i.map(s=>new Ge(this,s)):i.map(s=>this._moveToSan(s,i))}_moves({legal:t=!0,piece:r=void 0,square:n=void 0}={}){var w;const i=n?n.toLowerCase():void 0,s=r==null?void 0:r.toLowerCase(),o=[],a=this._turn,c=Re(a);let l=S.a8,m=S.h1,b=!1;if(i)if(i in S)l=m=S[i],b=!0;else return[];for(let v=l;v<=m;v++){if(v&136){v+=7;continue}if(!this._board[v]||this._board[v].color===c)continue;const{type:x}=this._board[v];let E;if(x===D){if(s&&s!==x)continue;E=v+ft[a][0],this._board[E]||(ve(o,a,v,E,D),E=v+ft[a][1],ki[a]===Pe(v)&&!this._board[E]&&ve(o,a,v,E,D,void 0,N.BIG_PAWN));for(let $=2;$<4;$++)E=v+ft[a][$],!(E&136)&&(((w=this._board[E])==null?void 0:w.color)===c?ve(o,a,v,E,D,this._board[E].type,N.CAPTURE):E===this._epSquare&&ve(o,a,v,E,D,D,N.EP_CAPTURE))}else{if(s&&s!==x)continue;for(let $=0,q=er[x].length;$<q;$++){const X=er[x][$];for(E=v;E+=X,!(E&136);){if(!this._board[E])ve(o,a,v,E,x);else{if(this._board[E].color===a)break;ve(o,a,v,E,x,this._board[E].type,N.CAPTURE);break}if(x===xt||x===z)break}}}}if((s===void 0||s===z)&&(!b||m===this._kings[a])){if(this._castling[a]&N.KSIDE_CASTLE){const v=this._kings[a],x=v+2;!this._board[v+1]&&!this._board[x]&&!this._attacked(c,this._kings[a])&&!this._attacked(c,v+1)&&!this._attacked(c,x)&&ve(o,a,this._kings[a],x,z,void 0,N.KSIDE_CASTLE)}if(this._castling[a]&N.QSIDE_CASTLE){const v=this._kings[a],x=v-2;!this._board[v-1]&&!this._board[v-2]&&!this._board[v-3]&&!this._attacked(c,this._kings[a])&&!this._attacked(c,v-1)&&!this._attacked(c,x)&&ve(o,a,this._kings[a],x,z,void 0,N.QSIDE_CASTLE)}}if(!t||this._kings[a]===-1)return o;const g=[];for(let v=0,x=o.length;v<x;v++)this._makeMove(o[v]),this._isKingAttacked(a)||g.push(o[v]),this._undoMove();return g}move(t,{strict:r=!1}={}){let n=null;if(typeof t=="string")n=this._moveFromSan(t,r);else if(t===null)n=this._moveFromSan(ht,r);else if(typeof t=="object"){const s=this._moves();for(let o=0,a=s.length;o<a;o++)if(t.from===H(s[o].from)&&t.to===H(s[o].to)&&(!("promotion"in s[o])||t.promotion===s[o].promotion)){n=s[o];break}}if(!n)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&n.flags&N.NULL_MOVE)throw new Error("Null move not allowed when in check");const i=new Ge(this,n);return this._makeMove(n),this._incPositionCount(),i}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,r){this._hash^=this._pieceKey(t),this._board[r]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(r)}_makeMove(t){var i,s,o,a;const r=this._turn,n=Re(r);if(this._push(t),t.flags&N.NULL_MOVE){r===te&&this._moveNumber++,this._halfMoves++,this._turn=n,this._epSquare=W;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&N.EP_CAPTURE&&(this._turn===te?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:r})),this._board[t.to].type===z){if(this._kings[r]=t.to,t.flags&N.KSIDE_CASTLE){const c=t.to-1,l=t.to+1;this._movePiece(l,c)}else if(t.flags&N.QSIDE_CASTLE){const c=t.to+1,l=t.to-2;this._movePiece(l,c)}this._castling[r]=0}if(this._castling[r]){for(let c=0,l=be[r].length;c<l;c++)if(t.from===be[r][c].square&&this._castling[r]&be[r][c].flag){this._castling[r]^=be[r][c].flag;break}}if(this._castling[n]){for(let c=0,l=be[n].length;c<l;c++)if(t.to===be[n][c].square&&this._castling[n]&be[n][c].flag){this._castling[n]^=be[n][c].flag;break}}if(this._hash^=this._castlingKey(),t.flags&N.BIG_PAWN){let c;r===te?c=t.to-16:c=t.to+16,!(t.to-1&136)&&((i=this._board[t.to-1])==null?void 0:i.type)===D&&((s=this._board[t.to-1])==null?void 0:s.color)===n||!(t.to+1&136)&&((o=this._board[t.to+1])==null?void 0:o.type)===D&&((a=this._board[t.to+1])==null?void 0:a.color)===n?(this._epSquare=c,this._hash^=this._epKey()):this._epSquare=W}else this._epSquare=W;t.piece===D?this._halfMoves=0:t.flags&(N.CAPTURE|N.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,r===te&&this._moveNumber++,this._turn=n,this._hash^=dt}undo(){const t=this._hash,r=this._undoMove();if(r){const n=new Ge(this,r);return this._decPositionCount(t),n}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const r=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=dt;const n=this._turn,i=Re(n);if(r.flags&N.NULL_MOVE)return r;if(this._movePiece(r.to,r.from),r.piece&&(this._clear(r.from),this._set(r.from,{type:r.piece,color:n})),r.captured)if(r.flags&N.EP_CAPTURE){let s;n===te?s=r.to-16:s=r.to+16,this._set(s,{type:D,color:i})}else this._set(r.to,{type:r.captured,color:i});if(r.flags&(N.KSIDE_CASTLE|N.QSIDE_CASTLE)){let s,o;r.flags&N.KSIDE_CASTLE?(s=r.to+1,o=r.to-1):(s=r.to-2,o=r.to+1),this._movePiece(o,s)}return r}pgn({newline:t=`
`,maxWidth:r=0}={}){const n=[];let i=!1;for(const g in this._header)this._header[g]&&n.push(`[${g} "${this._header[g]}"]`+t),i=!0;i&&this._history.length&&n.push(t);const s=g=>{const w=this._comments[this.fen()];if(typeof w<"u"){const v=g.length>0?" ":"";g=`${g}${v}{${w}}`}return g},o=[];for(;this._history.length>0;)o.push(this._undoMove());const a=[];let c="";for(o.length===0&&a.push(s(""));o.length>0;){c=s(c);const g=o.pop();if(!g)break;if(!this._history.length&&g.color==="b"){const w=`${this._moveNumber}. ...`;c=c?`${c} ${w}`:w}else g.color==="w"&&(c.length&&a.push(c),c=this._moveNumber+".");c=c+" "+this._moveToSan(g,this._moves({legal:!0})),this._makeMove(g)}if(c.length&&a.push(s(c)),a.push(this._header.Result||"*"),r===0)return n.join("")+a.join(" ");const l=function(){return n.length>0&&n[n.length-1]===" "?(n.pop(),!0):!1},m=function(g,w){for(const v of w.split(" "))if(v){if(g+v.length>r){for(;l();)g--;n.push(t),g=0}n.push(v),g+=v.length,n.push(" "),g++}return l()&&g--,g};let b=0;for(let g=0;g<a.length;g++){if(b+a[g].length>r&&a[g].includes("{")){b=m(b,a[g]);continue}b+a[g].length>r&&g!==0?(n[n.length-1]===" "&&n.pop(),n.push(t),b=0):g!==0&&(n.push(" "),b++),n.push(a[g]),b+=a[g].length}return n.join("")}header(...t){for(let r=0;r<t.length;r+=2)typeof t[r]=="string"&&typeof t[r+1]=="string"&&(this._header[t[r]]=t[r+1]);return this._header}setHeader(t,r){return this._header[t]=r??_t[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=_t[t]||null,!0):!1}getHeaders(){const t={};for(const[r,n]of Object.entries(this._header))n!==null&&(t[r]=n);return t}loadPgn(t,{strict:r=!1,newlineChar:n=`\r?
`}={}){n!==`\r?
`&&(t=t.replace(new RegExp(n,"g"),`
`));const i=li(t);this.reset();const s=i.headers;let o="";for(const l in s)l.toLowerCase()==="fen"&&(o=s[l]),this.header(l,s[l]);if(!r)o&&this.load(o,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let a=i.root;for(;a;){if(a.move){const l=this._moveFromSan(a.move,r);if(l==null)throw new Error(`Invalid move in PGN: ${a.move}`);this._makeMove(l),this._incPositionCount()}a.comment!==void 0&&(this._comments[this.fen()]=a.comment),a=a.variations[0]}const c=i.result;c&&Object.keys(this._header).length&&this._header.Result!==c&&this.setHeader("Result",c)}_moveToSan(t,r){let n="";if(t.flags&N.KSIDE_CASTLE)n="O-O";else if(t.flags&N.QSIDE_CASTLE)n="O-O-O";else{if(t.flags&N.NULL_MOVE)return ht;if(t.piece!==D){const i=Si(t,r);n+=t.piece.toUpperCase()+i}t.flags&(N.CAPTURE|N.EP_CAPTURE)&&(t.piece===D&&(n+=H(t.from)[0]),n+="x"),n+=H(t.to),t.promotion&&(n+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?n+="#":n+="+"),this._undoMove(),n}_moveFromSan(t,r=!1){let n=pt(t);if(r||(n==="0-0"?n="O-O":n==="0-0-0"&&(n="O-O-O")),n==ht)return{color:this._turn,from:0,to:0,piece:"k",flags:N.NULL_MOVE};let i=rr(n),s=this._moves({legal:!0,piece:i});for(let g=0,w=s.length;g<w;g++)if(n===pt(this._moveToSan(s[g],s)))return s[g];if(r)return null;let o,a,c,l,m,b=!1;if(a=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(o=a[1],c=a[2],l=a[3],m=a[4],c.length==1&&(b=!0)):(a=n.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(o=a[1],c=a[2],l=a[3],m=a[4],c.length==1&&(b=!0))),i=rr(n),s=this._moves({legal:!0,piece:o||i}),!l)return null;for(let g=0,w=s.length;g<w;g++)if(c){if((!o||o.toLowerCase()==s[g].piece)&&S[c]==s[g].from&&S[l]==s[g].to&&(!m||m.toLowerCase()==s[g].promotion))return s[g];if(b){const v=H(s[g].from);if((!o||o.toLowerCase()==s[g].piece)&&S[l]==s[g].to&&(c==v[0]||c==v[1])&&(!m||m.toLowerCase()==s[g].promotion))return s[g]}}else if(n===pt(this._moveToSan(s[g],s)).replace("x",""))return s[g];return null}ascii(){let t=`   +------------------------+
`;for(let r=S.a8;r<=S.h1;r++){if(De(r)===0&&(t+=" "+"87654321"[Pe(r)]+" |"),this._board[r]){const n=this._board[r].type,s=this._board[r].color===G?n.toUpperCase():n.toLowerCase();t+=" "+s+" "}else t+=" . ";r+1&136&&(t+=`|
`,r+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const r=this._moves({legal:!1});let n=0;const i=this._turn;for(let s=0,o=r.length;s<o;s++)this._makeMove(r[s]),this._isKingAttacked(i)||(t-1>0?n+=this.perft(t-1):n++),this._undoMove();return n}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let r=[];for(let n=S.a8;n<=S.h1;n++)this._board[n]==null?r.push(null):r.push({square:H(n),type:this._board[n].type,color:this._board[n].color}),n+1&136&&(t.push(r),r=[],n+=8);return t}squareColor(t){if(t in S){const r=S[t];return(Pe(r)+De(r))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const r=[],n=[];for(;this._history.length>0;)r.push(this._undoMove());for(;;){const i=r.pop();if(!i)break;t?n.push(new Ge(this,i)):n.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return n}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const r=this._positionCount.get(t)??0;r===1?this._positionCount.delete(t):this._positionCount.set(t,r-1)}_pruneComments(){const t=[],r={},n=i=>{i in this._comments&&(r[i]=this._comments[i])};for(;this._history.length>0;)t.push(this._undoMove());for(n(this.fen());;){const i=t.pop();if(!i)break;this._makeMove(i),n(this.fen())}this._comments=r}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const r=this._comments[t];return delete this._comments[t],{fen:t,comment:r}})}setCastlingRights(t,r){for(const i of[z,_e])r[i]!==void 0&&(r[i]?this._castling[t]|=Qe[i]:this._castling[t]&=~Qe[i]);this._updateCastlingRights();const n=this.getCastlingRights(t);return(r[z]===void 0||r[z]===n[z])&&(r[_e]===void 0||r[_e]===n[_e])}getCastlingRights(t){return{[z]:(this._castling[t]&Qe[z])!==0,[_e]:(this._castling[t]&Qe[_e])!==0}}moveNumber(){return this._moveNumber}}const Pi=["white","black"],Ye=["a","b","c","d","e","f","g","h"],Xe=["1","2","3","4","5","6","7","8"],Ei=[...Xe].reverse(),St=Array.prototype.concat(...Ye.map(e=>Xe.map(t=>e+t))),ie=e=>St[8*e[0]+e[1]],R=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],pr=St.map(R);function ji(e){let t;const r=()=>(t===void 0&&(t=e()),t);return r.clear=()=>{t=void 0},r}const Ai=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Nt=e=>e==="white"?"black":"white",Ie=(e,t)=>{const r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n},wt=(e,t)=>e.role===t.role&&e.color===t.color,Fe=e=>(t,r)=>[(r?t[0]:7-t[0])*e.width/8,(r?7-t[1]:t[1])*e.height/8],fe=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},gr=(e,t,r=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${r})`},Pt=(e,t)=>{e.style.visibility=t?"visible":"hidden"},je=e=>{var t;if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(!((t=e.targetTouches)===null||t===void 0)&&t[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},mr=e=>e.button===2,me=(e,t)=>{const r=document.createElement(e);return t&&(r.className=t),r};function br(e,t,r){const n=R(e);return t||(n[0]=7-n[0],n[1]=7-n[1]),[r.left+r.width*n[0]/8+r.width/16,r.top+r.height*(7-n[1])/8+r.height/16]}const Ee=(e,t)=>Math.abs(e-t),Mi=e=>(t,r,n,i)=>Ee(t,n)<2&&(e==="white"?i===r+1||r<=1&&i===r+2&&t===n:i===r-1||r>=6&&i===r-2&&t===n),vr=(e,t,r,n)=>{const i=Ee(e,r),s=Ee(t,n);return i===1&&s===2||i===2&&s===1},xr=(e,t,r,n)=>Ee(e,r)===Ee(t,n),_r=(e,t,r,n)=>e===r||t===n,wr=(e,t,r,n)=>xr(e,t,r,n)||_r(e,t,r,n),$i=(e,t,r)=>(n,i,s,o)=>Ee(n,s)<2&&Ee(i,o)<2||r&&i===o&&i===(e==="white"?0:7)&&(n===4&&(s===2&&t.includes(0)||s===6&&t.includes(7))||t.includes(s));function Oi(e,t){const r=t==="white"?"1":"8",n=[];for(const[i,s]of e)i[1]===r&&s.color===t&&s.role==="rook"&&n.push(R(i)[0]);return n}function yr(e,t,r){const n=e.get(t);if(!n)return[];const i=R(t),s=n.role,o=s==="pawn"?Mi(n.color):s==="knight"?vr:s==="bishop"?xr:s==="rook"?_r:s==="queen"?wr:$i(n.color,Oi(e,n.color),r);return pr.filter(a=>(i[0]!==a[0]||i[1]!==a[1])&&o(i[0],i[1],a[0],a[1])).map(ie)}function J(e,...t){e&&setTimeout(()=>e(...t),1)}function Ti(e){e.orientation=Nt(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Ri(e,t){for(const[r,n]of t)n?e.pieces.set(r,n):e.pieces.delete(r)}function qi(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[r,n]of e.pieces)n.role==="king"&&n.color===t&&(e.check=r)}function Li(e,t,r,n){ye(e),e.premovable.current=[t,r],J(e.premovable.events.set,t,r,n)}function we(e){e.premovable.current&&(e.premovable.current=void 0,J(e.premovable.events.unset))}function Ki(e,t,r){we(e),e.predroppable.current={role:t,key:r},J(e.predroppable.events.set,t,r)}function ye(e){const t=e.predroppable;t.current&&(t.current=void 0,J(t.events.unset))}function Di(e,t,r){if(!e.autoCastle)return!1;const n=e.pieces.get(t);if(!n||n.role!=="king")return!1;const i=R(t),s=R(r);if(i[1]!==0&&i[1]!==7||i[1]!==s[1])return!1;i[0]===4&&!e.pieces.has(r)&&(s[0]===6?r=ie([7,s[1]]):s[0]===2&&(r=ie([0,s[1]])));const o=e.pieces.get(r);return!o||o.color!==n.color||o.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(r),i[0]<s[0]?(e.pieces.set(ie([6,s[1]]),n),e.pieces.set(ie([5,s[1]]),o)):(e.pieces.set(ie([2,s[1]]),n),e.pieces.set(ie([3,s[1]]),o)),!0)}function kr(e,t,r){const n=e.pieces.get(t),i=e.pieces.get(r);if(t===r||!n)return!1;const s=i&&i.color!==n.color?i:void 0;return r===e.selected&&se(e),J(e.events.move,t,r,s),Di(e,t,r)||(e.pieces.set(r,n),e.pieces.delete(t)),e.lastMove=[t,r],e.check=void 0,J(e.events.change),s||!0}function Et(e,t,r,n){if(e.pieces.has(r))if(n)e.pieces.delete(r);else return!1;return J(e.events.dropNewPiece,t,r),e.pieces.set(r,t),e.lastMove=[r],e.check=void 0,J(e.events.change),e.movable.dests=void 0,e.turnColor=Nt(e.turnColor),!0}function Cr(e,t,r){const n=kr(e,t,r);return n&&(e.movable.dests=void 0,e.turnColor=Nt(e.turnColor),e.animation.current=void 0),n}function Sr(e,t,r){if(jt(e,t,r)){const n=Cr(e,t,r);if(n){const i=e.hold.stop();se(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return n!==!0&&(s.captured=n),J(e.movable.events.after,t,r,s),!0}}else if(Fi(e,t,r))return Li(e,t,r,{ctrlKey:e.stats.ctrlKey}),se(e),!0;return se(e),!1}function Nr(e,t,r,n){const i=e.pieces.get(t);i&&(Ii(e,t,r)||n)?(e.pieces.delete(t),Et(e,i,r,n),J(e.movable.events.afterNewPiece,i.role,r,{premove:!1,predrop:!1})):i&&zi(e,t,r)?Ki(e,i.role,r):(we(e),ye(e)),e.pieces.delete(t),se(e)}function yt(e,t,r){if(J(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){se(e),e.hold.cancel();return}else if((e.selectable.enabled||r)&&e.selected!==t&&Sr(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(Er(e,t)||At(e,t))&&(Pr(e,t),e.hold.start())}function Pr(e,t){e.selected=t,At(e,t)?e.premovable.customDests||(e.premovable.dests=yr(e.pieces,t,e.premovable.castle)):e.premovable.dests=void 0}function se(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function Er(e,t){const r=e.pieces.get(t);return!!r&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}const jt=(e,t,r)=>{var n,i;return t!==r&&Er(e,t)&&(e.movable.free||!!(!((i=(n=e.movable.dests)===null||n===void 0?void 0:n.get(t))===null||i===void 0)&&i.includes(r)))};function Ii(e,t,r){const n=e.pieces.get(t);return!!n&&(t===r||!e.pieces.has(r))&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}function At(e,t){const r=e.pieces.get(t);return!!r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function Fi(e,t,r){var n,i;const s=(i=(n=e.premovable.customDests)===null||n===void 0?void 0:n.get(t))!==null&&i!==void 0?i:yr(e.pieces,t,e.premovable.castle);return t!==r&&At(e,t)&&s.includes(r)}function zi(e,t,r){const n=e.pieces.get(t),i=e.pieces.get(r);return!!n&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(n.role!=="pawn"||r[1]!=="1"&&r[1]!=="8")&&e.movable.color===n.color&&e.turnColor!==n.color}function Bi(e,t){const r=e.pieces.get(t);return!!r&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))}function Ui(e){const t=e.premovable.current;if(!t)return!1;const r=t[0],n=t[1];let i=!1;if(jt(e,r,n)){const s=Cr(e,r,n);if(s){const o={premove:!0};s!==!0&&(o.captured=s),J(e.movable.events.after,r,n,o),i=!0}}return we(e),i}function Hi(e,t){const r=e.predroppable.current;let n=!1;if(!r)return!1;if(t(r)){const i={role:r.role,color:e.movable.color};Et(e,i,r.key)&&(J(e.movable.events.afterNewPiece,r.role,r.key,{premove:!1,predrop:!0}),n=!0)}return ye(e),n}function Mt(e){we(e),ye(e),se(e)}function nr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Mt(e)}function Ae(e,t,r){let n=Math.floor(8*(e[0]-r.left)/r.width);t||(n=7-n);let i=7-Math.floor(8*(e[1]-r.top)/r.height);return t||(i=7-i),n>=0&&n<8&&i>=0&&i<8?ie([n,i]):void 0}function Wi(e,t,r,n){const i=R(e),s=pr.filter(l=>wr(i[0],i[1],l[0],l[1])||vr(i[0],i[1],l[0],l[1])),a=s.map(l=>br(ie(l),r,n)).map(l=>Ie(t,l)),[,c]=a.reduce((l,m,b)=>l[0]<m?l:[m,b],[a[0],0]);return ie(s[c])}const ee=e=>e.orientation==="white",jr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Gi={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Qi={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function Ar(e){e==="start"&&(e=jr);const t=new Map;let r=7,n=0;for(const i of e)switch(i){case" ":case"[":return t;case"/":if(--r,r<0)return t;n=0;break;case"~":{const s=t.get(ie([n-1,r]));s&&(s.promoted=!0);break}default:{const s=i.charCodeAt(0);if(s<57)n+=s-48;else{const o=i.toLowerCase();t.set(ie([n,r]),{role:Gi[o],color:i===o?"black":"white"}),++n}}}return t}function Vi(e){return Ei.map(t=>Ye.map(r=>{const n=e.get(r+t);if(n){let i=Qi[n.role];return n.color==="white"&&(i=i.toUpperCase()),n.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function Mr(e,t){t.animation&&($t(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function $r(e,t){var r,n,i;if(!((r=t.movable)===null||r===void 0)&&r.dests&&(e.movable.dests=void 0),!((n=t.drawable)===null||n===void 0)&&n.autoShapes&&(e.drawable.autoShapes=[]),$t(e,t),t.fen&&(e.pieces=Ar(t.fen),e.drawable.shapes=((i=t.drawable)===null||i===void 0?void 0:i.shapes)||[]),"check"in t&&qi(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&Pr(e,e.selected),Mr(e,t),!e.movable.rookCastle&&e.movable.dests){const s=e.movable.color==="white"?"1":"8",o="e"+s,a=e.movable.dests.get(o),c=e.pieces.get(o);if(!a||!c||c.role!=="king")return;e.movable.dests.set(o,a.filter(l=>!(l==="a"+s&&a.includes("c"+s))&&!(l==="h"+s&&a.includes("g"+s))))}}function $t(e,t){for(const r in t)r==="__proto__"||r==="constructor"||!Object.prototype.hasOwnProperty.call(t,r)||(Object.prototype.hasOwnProperty.call(e,r)&&ir(e[r])&&ir(t[r])?$t(e[r],t[r]):e[r]=t[r])}function ir(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const Ne=(e,t)=>t.animation.enabled?Xi(e,t):xe(e,t);function xe(e,t){const r=e(t);return t.dom.redraw(),r}const gt=(e,t)=>({key:e,pos:R(e),piece:t}),Zi=(e,t)=>t.sort((r,n)=>Ie(e.pos,r.pos)-Ie(e.pos,n.pos))[0];function Yi(e,t){const r=new Map,n=[],i=new Map,s=[],o=[],a=new Map;let c,l,m;for(const[b,g]of e)a.set(b,gt(b,g));for(const b of St)c=t.pieces.get(b),l=a.get(b),c?l?wt(c,l.piece)||(s.push(l),o.push(gt(b,c))):o.push(gt(b,c)):l&&s.push(l);for(const b of o)l=Zi(b,s.filter(g=>wt(b.piece,g.piece))),l&&(m=[l.pos[0]-b.pos[0],l.pos[1]-b.pos[1]],r.set(b.key,m.concat(m)),n.push(l.key));for(const b of s)n.includes(b.key)||i.set(b.key,b.piece);return{anims:r,fadings:i}}function Or(e,t){const r=e.animation.current;if(r===void 0){e.dom.destroyed||e.dom.redrawNow();return}const n=1-(t-r.start)*r.frequency;if(n<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=Ji(n);for(const s of r.plan.anims.values())s[2]=s[0]*i,s[3]=s[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((s=performance.now())=>Or(e,s))}}function Xi(e,t){const r=new Map(t.pieces),n=e(t),i=Yi(r,t);if(i.anims.size||i.fadings.size){const s=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},s||Or(t,performance.now())}else t.dom.redraw();return n}const Ji=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,es=["green","red","blue","yellow"];function ts(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?se(e):Mt(e);const r=je(t),n=Ae(r,ee(e),e.dom.bounds());n&&(e.drawable.current={orig:n,pos:r,brush:ss(t),snapToValidMove:e.drawable.defaultSnapToValidMove},Tr(e))}function Tr(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const r=Ae(t.pos,ee(e),e.dom.bounds());r||(t.snapToValidMove=!1);const n=t.snapToValidMove?Wi(t.orig,t.pos,ee(e),e.dom.bounds()):r;n!==t.mouseSq&&(t.mouseSq=n,t.dest=n!==t.orig?n:void 0,e.dom.redrawNow()),Tr(e)}})}function rs(e,t){e.drawable.current&&(e.drawable.current.pos=je(t))}function ns(e){const t=e.drawable.current;t&&(t.mouseSq&&os(e.drawable,t),Rr(e))}function Rr(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function is(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),qr(e.drawable))}function ss(e){var t;const r=(e.shiftKey||e.ctrlKey)&&mr(e),n=e.altKey||e.metaKey||((t=e.getModifierState)===null||t===void 0?void 0:t.call(e,"AltGraph"));return es[(r?1:0)+(n?2:0)]}function os(e,t){const r=i=>i.orig===t.orig&&i.dest===t.dest,n=e.shapes.find(r);n&&(e.shapes=e.shapes.filter(i=>!r(i))),(!n||n.brush!==t.brush)&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),qr(e)}function qr(e){e.onChange&&e.onChange(e.shapes)}function as(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const r=e.dom.bounds(),n=je(t),i=Ae(n,ee(e),r);if(!i)return;const s=e.pieces.get(i),o=e.selected;if(!o&&e.drawable.enabled&&(e.drawable.eraseOnClick||!s||s.color!==e.turnColor)&&is(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||s||o||ls(e,n)))t.preventDefault();else if(t.touches)return;const a=!!e.premovable.current,c=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&jt(e,e.selected,i)?Ne(b=>yt(b,i),e):yt(e,i);const l=e.selected===i,m=Kr(e,i);if(s&&m&&l&&Bi(e,i)){e.draggable.current={orig:i,piece:s,origPos:n,pos:n,started:e.draggable.autoDistance&&e.stats.dragged,element:m,previouslySelected:o,originTarget:t.target,keyHasChanged:!1},m.cgDragging=!0,m.classList.add("dragging");const b=e.dom.elements.ghost;b&&(b.className=`ghost ${s.color} ${s.role}`,fe(b,Fe(r)(R(i),ee(e))),Pt(b,!0)),Ot(e)}else a&&we(e),c&&ye(e);e.dom.redraw()}function ls(e,t){const r=ee(e),n=e.dom.bounds(),i=Math.pow(n.width/8,2);for(const s of e.pieces.keys()){const o=br(s,r,n);if(Ie(o,t)<=i)return!0}return!1}function cs(e,t,r,n){const i="a0";e.pieces.set(i,t),e.dom.redraw();const s=je(r);e.draggable.current={orig:i,piece:t,origPos:s,pos:s,started:!0,element:()=>Kr(e,i),originTarget:r.target,newPiece:!0,force:!!n,keyHasChanged:!1},Ot(e)}function Ot(e){requestAnimationFrame(()=>{var t;const r=e.draggable.current;if(!r)return;!((t=e.animation.current)===null||t===void 0)&&t.plan.anims.has(r.orig)&&(e.animation.current=void 0);const n=e.pieces.get(r.orig);if(!n||!wt(n,r.piece))Je(e);else if(!r.started&&Ie(r.pos,r.origPos)>=Math.pow(e.draggable.distance,2)&&(r.started=!0),r.started){if(typeof r.element=="function"){const s=r.element();if(!s)return;s.cgDragging=!0,s.classList.add("dragging"),r.element=s}const i=e.dom.bounds();fe(r.element,[r.pos[0]-i.left-i.width/16,r.pos[1]-i.top-i.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==Ae(r.pos,ee(e),i))}Ot(e)})}function ds(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=je(t))}function us(e,t){const r=e.draggable.current;if(!r)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&r.originTarget!==t.target&&!r.newPiece){e.draggable.current=void 0;return}we(e),ye(e);const n=je(t)||r.pos,i=Ae(n,ee(e),e.dom.bounds());i&&r.started&&r.orig!==i?r.newPiece?Nr(e,r.orig,i,r.force):(e.stats.ctrlKey=t.ctrlKey,Sr(e,r.orig,i)&&(e.stats.dragged=!0)):r.newPiece?e.pieces.delete(r.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(r.orig),J(e.events.change)),(r.orig===r.previouslySelected||r.keyHasChanged)&&(r.orig===i||!i)?se(e):e.selectable.enabled||se(e),Lr(e),e.draggable.current=void 0,e.dom.redraw()}function Je(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,se(e),Lr(e),e.dom.redraw())}function Lr(e){const t=e.dom.elements;t.ghost&&Pt(t.ghost,!1)}function Kr(e,t){let r=e.dom.elements.board.firstChild;for(;r;){if(r.cgKey===t&&r.tagName==="PIECE")return r;r=r.nextSibling}}function fs(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{sr(e,2),setTimeout(()=>sr(e,void 0),120)},120)}function sr(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function hs(e,t){function r(){Ti(e),t()}return{set(n){n.orientation&&n.orientation!==e.orientation&&r(),Mr(e,n),(n.fen?Ne:xe)(i=>$r(i,n),e)},state:e,getFen:()=>Vi(e.pieces),toggleOrientation:r,setPieces(n){Ne(i=>Ri(i,n),e)},selectSquare(n,i){n?Ne(s=>yt(s,n,i),e):e.selected&&(se(e),e.dom.redraw())},move(n,i){Ne(s=>kr(s,n,i),e)},newPiece(n,i){Ne(s=>Et(s,n,i),e)},playPremove(){if(e.premovable.current){if(Ne(Ui,e))return!0;e.dom.redraw()}return!1},playPredrop(n){if(e.predroppable.current){const i=Hi(e,n);return e.dom.redraw(),i}return!1},cancelPremove(){xe(we,e)},cancelPredrop(){xe(ye,e)},cancelMove(){xe(n=>{Mt(n),Je(n)},e)},stop(){xe(n=>{nr(n),Je(n)},e)},explode(n){fs(e,n)},setAutoShapes(n){xe(i=>i.drawable.autoShapes=n,e)},setShapes(n){xe(i=>i.drawable.shapes=n,e)},getKeyAtDomPos(n){return Ae(n,ee(e),e.dom.bounds())},redrawAll:t,dragNewPiece(n,i,s){cs(e,n,i,s)},destroy(){nr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function ps(){return{pieces:Ar(jr),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10}},prevSvgHash:""},hold:Ai()}}const or={hilitePrimary:{key:"hilitePrimary",color:"#3291ff",opacity:1,lineWidth:1},hiliteWhite:{key:"hiliteWhite",color:"#ffffff",opacity:1,lineWidth:1}};function gs(){const e=B("defs"),t=Y(B("filter"),{id:"cg-filter-blur"});return t.appendChild(Y(B("feGaussianBlur"),{stdDeviation:"0.019"})),e.appendChild(t),e}function ms(e,t,r){var n;const i=e.drawable,s=i.current,o=s&&s.mouseSq?s:void 0,a=new Map,c=e.dom.bounds(),l=i.autoShapes.filter(w=>!w.piece);for(const w of i.shapes.concat(l).concat(o?[o]:[])){if(!w.dest)continue;const v=(n=a.get(w.dest))!==null&&n!==void 0?n:new Set,x=rt(tt(R(w.orig),e.orientation),c),E=rt(tt(R(w.dest),e.orientation),c);v.add(Ct(x,E)),a.set(w.dest,v)}const m=i.shapes.concat(l).map(w=>({shape:w,current:!1,hash:ar(w,kt(w.dest,a),!1,c)}));o&&m.push({shape:o,current:!0,hash:ar(o,kt(o.dest,a),!0,c)});const b=m.map(w=>w.hash).join(";");if(b===e.drawable.prevSvgHash)return;e.drawable.prevSvgHash=b;const g=t.querySelector("defs");bs(i,m,g),vs(m,t.querySelector("g"),r.querySelector("g"),w=>ws(e,w,i.brushes,a,c))}function bs(e,t,r){var n;const i=new Map;let s;for(const c of t.filter(l=>l.shape.dest&&l.shape.brush))s=Dr(e.brushes[c.shape.brush],c.shape.modifiers),!((n=c.shape.modifiers)===null||n===void 0)&&n.hilite&&i.set(et(s).key,et(s)),i.set(s.key,s);const o=new Set;let a=r.firstElementChild;for(;a;)o.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[c,l]of i.entries())o.has(c)||r.appendChild(Cs(l))}function vs(e,t,r,n){const i=new Map;for(const s of e)i.set(s.hash,!1);for(const s of[t,r]){const o=[];let a=s.firstElementChild,c;for(;a;)c=a.getAttribute("cgHash"),i.has(c)?i.set(c,!0):o.push(a),a=a.nextElementSibling;for(const l of o)s.removeChild(l)}for(const s of e.filter(o=>!i.get(o.hash)))for(const o of n(s))o.isCustom?r.appendChild(o.el):t.appendChild(o.el)}function ar({orig:e,dest:t,brush:r,piece:n,modifiers:i,customSvg:s,label:o},a,c,l){var m,b;return[l.width,l.height,c,e,t,r,a&&"-",n&&xs(n),i&&_s(i),s&&`custom-${lr(s.html)},${(b=(m=s.center)===null||m===void 0?void 0:m[0])!==null&&b!==void 0?b:"o"}`,o&&`label-${lr(o.text)}`].filter(g=>g).join(",")}function xs(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function _s(e){return[e.lineWidth,e.hilite&&"*"].filter(t=>t).join(",")}function lr(e){let t=0;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r)>>>0;return t.toString()}function ws(e,{shape:t,current:r,hash:n},i,s,o){var a,c;const l=rt(tt(R(t.orig),e.orientation),o),m=t.dest?rt(tt(R(t.dest),e.orientation),o):l,b=t.brush&&Dr(i[t.brush],t.modifiers),g=s.get(t.dest),w=[];if(b){const v=Y(B("g"),{cgHash:n});w.push({el:v}),l[0]!==m[0]||l[1]!==m[1]?v.appendChild(ks(t,b,l,m,r,kt(t.dest,s))):v.appendChild(ys(i[t.brush],l,r,o))}if(t.label){const v=t.label;(a=v.fill)!==null&&a!==void 0||(v.fill=t.brush&&i[t.brush].color);const x=t.brush?void 0:"tr";w.push({el:Ss(v,n,l,m,g,x),isCustom:!0})}if(t.customSvg){const v=(c=t.customSvg.center)!==null&&c!==void 0?c:"orig",[x,E]=v==="label"?Fr(l,m,g).map(q=>q-.5):v==="dest"?m:l,$=Y(B("g"),{transform:`translate(${x},${E})`,cgHash:n});$.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,w.push({el:$,isCustom:!0})}return w}function ys(e,t,r,n){const i=Ns(),s=(n.width+n.height)/(4*Math.max(n.width,n.height));return Y(B("circle"),{stroke:e.color,"stroke-width":i[r?0:1],fill:"none",opacity:Ir(e,r),cx:t[0],cy:t[1],r:s-i[1]/2})}function et(e){return["#ffffff","#fff","white"].includes(e.color)?or.hilitePrimary:or.hiliteWhite}function ks(e,t,r,n,i,s){var o;function a(m){var b;const g=Es(s&&!i),w=n[0]-r[0],v=n[1]-r[1],x=Math.atan2(v,w),E=Math.cos(x)*g,$=Math.sin(x)*g;return Y(B("line"),{stroke:m?et(t).color:t.color,"stroke-width":Ps(t,i)+(m?.04:0),"stroke-linecap":"round","marker-end":`url(#arrowhead-${m?et(t).key:t.key})`,opacity:!((b=e.modifiers)===null||b===void 0)&&b.hilite?1:Ir(t,i),x1:r[0],y1:r[1],x2:n[0]-E,y2:n[1]-$})}if(!(!((o=e.modifiers)===null||o===void 0)&&o.hilite))return a(!1);const c=B("g"),l=Y(B("g"),{filter:"url(#cg-filter-blur)"});return l.appendChild(js(r,n)),l.appendChild(a(!0)),c.appendChild(l),c.appendChild(a(!1)),c}function Cs(e){const t=Y(B("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(Y(B("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function Ss(e,t,r,n,i,s){var o;const c=.4*.75**e.text.length,l=Fr(r,n,i),m=s==="tr"?.4:0,b=Y(B("g"),{transform:`translate(${l[0]+m},${l[1]-m})`,cgHash:t});b.appendChild(Y(B("circle"),{r:.4/2,"fill-opacity":s?1:.8,"stroke-opacity":s?1:.7,"stroke-width":.03,fill:(o=e.fill)!==null&&o!==void 0?o:"#666",stroke:"white"}));const g=Y(B("text"),{"font-size":c,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return g.innerHTML=e.text,b.appendChild(g),b}function tt(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function kt(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function B(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Y(e,t){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.setAttribute(r,t[r]);return e}function Dr(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(r=>r).join("")}:e}function Ns(){return[3/64,4/64]}function Ps(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function Ir(e,t){return(e.opacity||1)*(t?.9:1)}function Es(e){return(e?20:10)/64}function rt(e,t){const r=Math.min(1,t.width/t.height),n=Math.min(1,t.height/t.width);return[(e[0]-3.5)*r,(3.5-e[1])*n]}function js(e,t){const r={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return Y(B("rect"),{x:r.from[0],y:r.from[1],width:r.to[0]-r.from[0],height:r.to[1]-r.from[1],fill:"none",stroke:"none"})}function Ct(e,t,r=!0){const n=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return r?(Math.round(n*8/Math.PI)+16)%16:n}function As(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((r,n)=>r+n*n,0))}function Fr(e,t,r){let n=As(e,t);const i=Ct(e,t,!1);if(r&&(n-=33/64,r.size>1)){n-=10/64;const s=Ct(e,t);(r.has((s+1)%16)||r.has((s+15)%16))&&s&1&&(n-=.4)}return[e[0]-Math.cos(i)*n,e[1]-Math.sin(i)*n].map(s=>s+.5)}function Ms(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const c of Pi)e.classList.toggle("orientation-"+c,t.orientation===c);e.classList.toggle("manipulable",!t.viewOnly);const r=me("cg-container");e.appendChild(r);const n=me("cg-board");r.appendChild(n);let i,s,o;if(t.drawable.visible&&(i=Y(B("svg"),{class:"cg-shapes",viewBox:"-4 -4 8 8",preserveAspectRatio:"xMidYMid slice"}),i.appendChild(gs()),i.appendChild(B("g")),s=Y(B("svg"),{class:"cg-custom-svgs",viewBox:"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"}),s.appendChild(B("g")),o=me("cg-auto-pieces"),r.appendChild(i),r.appendChild(s),r.appendChild(o)),t.coordinates){const c=t.orientation==="black"?" black":"",l=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const m=t.orientation==="white"?b=>b+1:b=>8-b;Ye.forEach((b,g)=>r.appendChild(mt(Xe.map(w=>b+w),"squares rank"+m(g)+c+l)))}else r.appendChild(mt(Xe,"ranks"+c+l)),r.appendChild(mt(Ye,"files"+c))}let a;return t.draggable.enabled&&t.draggable.showGhost&&(a=me("piece","ghost"),Pt(a,!1),r.appendChild(a)),{board:n,container:r,wrap:e,ghost:a,svg:i,customSvg:s,autoPieces:o}}function mt(e,t){const r=me("coords",t);let n;for(const i of e)n=me("coord"),n.textContent=i,r.appendChild(n);return r}function $s(e,t){if(!e.dropmode.active)return;we(e),ye(e);const r=e.dropmode.piece;if(r){e.pieces.set("a0",r);const n=je(t),i=n&&Ae(n,ee(e),e.dom.bounds());i&&Nr(e,"a0",i)}e.dom.redraw()}function Os(e,t){const r=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&r.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const n=Rs(e);r.addEventListener("touchstart",n,{passive:!1}),r.addEventListener("mousedown",n,{passive:!1})}function Ts(e,t){const r=[];if("ResizeObserver"in window||r.push(qe(document.body,"chessground.resize",t)),!e.viewOnly){const n=cr(e,ds,rs),i=cr(e,us,ns);for(const o of["touchmove","mousemove"])r.push(qe(document,o,n));for(const o of["touchend","mouseup"])r.push(qe(document,o,i));const s=()=>e.dom.bounds.clear();r.push(qe(document,"scroll",s,{capture:!0,passive:!0})),r.push(qe(window,"resize",s,{passive:!0}))}return()=>r.forEach(n=>n())}function qe(e,t,r,n){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r,n)}const Rs=e=>t=>{e.draggable.current?Je(e):e.drawable.current?Rr(e):t.shiftKey||mr(t)?e.drawable.enabled&&ts(e,t):e.viewOnly||(e.dropmode.active?$s(e,t):as(e,t))},cr=(e,t,r)=>n=>{e.drawable.current?e.drawable.enabled&&r(e,n):e.viewOnly||t(e,n)};function qs(e){const t=ee(e),r=Fe(e.dom.bounds()),n=e.dom.elements.board,i=e.pieces,s=e.animation.current,o=s?s.plan.anims:new Map,a=s?s.plan.fadings:new Map,c=e.draggable.current,l=Ks(e),m=new Set,b=new Set,g=new Map,w=new Map;let v,x,E,$,q,X,L,Q,re,le;for(x=n.firstChild;x;){if(v=x.cgKey,zr(x))if(E=i.get(v),q=o.get(v),X=a.get(v),$=x.cgPiece,x.cgDragging&&(!c||c.orig!==v)&&(x.classList.remove("dragging"),fe(x,r(R(v),t)),x.cgDragging=!1),!X&&x.cgFading&&(x.cgFading=!1,x.classList.remove("fading")),E){if(q&&x.cgAnimating&&$===Le(E)){const A=R(v);A[0]+=q[2],A[1]+=q[3],x.classList.add("anim"),fe(x,r(A,t))}else x.cgAnimating&&(x.cgAnimating=!1,x.classList.remove("anim"),fe(x,r(R(v),t)),e.addPieceZIndex&&(x.style.zIndex=bt(R(v),t)));$===Le(E)&&(!X||!x.cgFading)?m.add(v):X&&$===Le(X)?(x.classList.add("fading"),x.cgFading=!0):vt(g,$,x)}else vt(g,$,x);else if(Br(x)){const A=x.className;l.get(v)===A?b.add(v):vt(w,A,x)}x=x.nextSibling}for(const[A,ce]of l)if(!b.has(A)){re=w.get(ce),le=re&&re.pop();const I=r(R(A),t);if(le)le.cgKey=A,fe(le,I);else{const V=me("square",ce);V.cgKey=A,fe(V,I),n.insertBefore(V,n.firstChild)}}for(const[A,ce]of i)if(q=o.get(A),!m.has(A))if(L=g.get(Le(ce)),Q=L&&L.pop(),Q){Q.cgKey=A,Q.cgFading&&(Q.classList.remove("fading"),Q.cgFading=!1);const I=R(A);e.addPieceZIndex&&(Q.style.zIndex=bt(I,t)),q&&(Q.cgAnimating=!0,Q.classList.add("anim"),I[0]+=q[2],I[1]+=q[3]),fe(Q,r(I,t))}else{const I=Le(ce),V=me("piece",I),pe=R(A);V.cgPiece=I,V.cgKey=A,q&&(V.cgAnimating=!0,pe[0]+=q[2],pe[1]+=q[3]),fe(V,r(pe,t)),e.addPieceZIndex&&(V.style.zIndex=bt(pe,t)),n.appendChild(V)}for(const A of g.values())ur(e,A);for(const A of w.values())ur(e,A)}function Ls(e){const t=ee(e),r=Fe(e.dom.bounds());let n=e.dom.elements.board.firstChild;for(;n;)(zr(n)&&!n.cgAnimating||Br(n))&&fe(n,r(R(n.cgKey),t)),n=n.nextSibling}function dr(e){var t,r;const n=e.dom.elements.wrap.getBoundingClientRect(),i=e.dom.elements.container,s=n.height/n.width,o=Math.floor(n.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,a=o*s;i.style.width=o+"px",i.style.height=a+"px",e.dom.bounds.clear(),(t=e.addDimensionsCssVarsTo)===null||t===void 0||t.style.setProperty("---cg-width",o+"px"),(r=e.addDimensionsCssVarsTo)===null||r===void 0||r.style.setProperty("---cg-height",a+"px")}const zr=e=>e.tagName==="PIECE",Br=e=>e.tagName==="SQUARE";function ur(e,t){for(const r of t)e.dom.elements.board.removeChild(r)}function bt(e,t){const n=e[1];return`${t?10-n:3+n}`}const Le=e=>`${e.color} ${e.role}`;function Ks(e){var t,r,n;const i=new Map;if(e.lastMove&&e.highlight.lastMove)for(const a of e.lastMove)ge(i,a,"last-move");if(e.check&&e.highlight.check&&ge(i,e.check,"check"),e.selected&&(ge(i,e.selected,"selected"),e.movable.showDests)){const a=(t=e.movable.dests)===null||t===void 0?void 0:t.get(e.selected);if(a)for(const l of a)ge(i,l,"move-dest"+(e.pieces.has(l)?" oc":""));const c=(n=(r=e.premovable.customDests)===null||r===void 0?void 0:r.get(e.selected))!==null&&n!==void 0?n:e.premovable.dests;if(c)for(const l of c)ge(i,l,"premove-dest"+(e.pieces.has(l)?" oc":""))}const s=e.premovable.current;if(s)for(const a of s)ge(i,a,"current-premove");else e.predroppable.current&&ge(i,e.predroppable.current.key,"current-premove");const o=e.exploding;if(o)for(const a of o.keys)ge(i,a,"exploding"+o.stage);return e.highlight.custom&&e.highlight.custom.forEach((a,c)=>{ge(i,c,a)}),i}function ge(e,t,r){const n=e.get(t);n?e.set(t,`${n} ${r}`):e.set(t,r)}function vt(e,t,r){const n=e.get(t);n?n.push(r):e.set(t,[r])}function Ds(e,t,r){const n=new Map,i=[];for(const a of e)n.set(a.hash,!1);let s=t.firstElementChild,o;for(;s;)o=s.getAttribute("cgHash"),n.has(o)?n.set(o,!0):i.push(s),s=s.nextElementSibling;for(const a of i)t.removeChild(a);for(const a of e)n.get(a.hash)||t.appendChild(r(a))}function Is(e,t){const n=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:Bs(i),current:!1}));Ds(n,t,i=>zs(e,i,e.dom.bounds()))}function Fs(e){var t;const r=ee(e),n=Fe(e.dom.bounds());let i=(t=e.dom.elements.autoPieces)===null||t===void 0?void 0:t.firstChild;for(;i;)gr(i,n(R(i.cgKey),r),i.cgScale),i=i.nextSibling}function zs(e,{shape:t,hash:r},n){var i,s,o;const a=t.orig,c=(i=t.piece)===null||i===void 0?void 0:i.role,l=(s=t.piece)===null||s===void 0?void 0:s.color,m=(o=t.piece)===null||o===void 0?void 0:o.scale,b=me("piece",`${c} ${l}`);return b.setAttribute("cgHash",r),b.cgKey=a,b.cgScale=m,gr(b,Fe(n)(R(a),ee(e)),m),b}const Bs=e=>{var t,r,n;return[e.orig,(t=e.piece)===null||t===void 0?void 0:t.role,(r=e.piece)===null||r===void 0?void 0:r.color,(n=e.piece)===null||n===void 0?void 0:n.scale].join(",")};function Us(e,t){const r=ps();$r(r,t||{});function n(){const i="dom"in r?r.dom.unbind:void 0,s=Ms(e,r),o=ji(()=>s.board.getBoundingClientRect()),a=m=>{qs(l),s.autoPieces&&Is(l,s.autoPieces),!m&&s.svg&&ms(l,s.svg,s.customSvg)},c=()=>{dr(l),Ls(l),s.autoPieces&&Fs(l)},l=r;return l.dom={elements:s,bounds:o,redraw:Hs(a),redrawNow:a,unbind:i},l.drawable.prevSvgHash="",dr(l),a(!1),Os(l,c),i||(l.dom.unbind=Ts(l,c)),l.events.insert&&l.events.insert(s),l}return hs(n(),n)}function Hs(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}const Ws={move:new Audio("https://images.chesscomfiles.com/chess-themes/sounds/_common/default/move-self.mp3"),capture:new Audio("https://images.chesscomfiles.com/chess-themes/sounds/_common/default/capture.mp3"),check:new Audio("https://images.chesscomfiles.com/chess-themes/sounds/_common/default/move-check.mp3"),castle:new Audio("https://images.chesscomfiles.com/chess-themes/sounds/_common/default/castle.mp3"),promote:new Audio("https://images.chesscomfiles.com/chess-themes/sounds/_common/default/promote.mp3"),gameEnd:new Audio("https://images.chesscomfiles.com/chess-themes/sounds/_common/default/game-end.mp3")},Gs=()=>({play:T.useCallback(t=>{try{const r=Ws[t];if(r){r.readyState>=2&&(r.currentTime=0);const n=r.play();n!==void 0&&n.catch(i=>{})}}catch(r){console.error("Audio error",r)}},[])}),Qs=({teacherId:e,onGameStateChange:t})=>{const r=T.useRef(new Ni),[n,i]=T.useState(r.current.fen()),[s,o]=T.useState("white"),[a,c]=T.useState(null),[l,m]=T.useState(null),[b,g]=T.useState(!1),[w,v]=T.useState(!1),[x,E]=T.useState("w"),[$,q]=T.useState([]),X=T.useRef(null),L=T.useRef(null),{userRole:Q}=T.useContext(fr),{play:re}=Gs(),le=j=>{const P=new Map;return j.moves({verbose:!0}).forEach(K=>{P.has(K.from)||P.set(K.from,[]),P.get(K.from).push(K.to)}),P},A=()=>{var j;(j=L.current)==null||j.set({fen:r.current.fen()})},ce=(j,P)=>{const F=r.current,de=F.moves({verbose:!0}).find(oe=>oe.from===j&&oe.to===P&&oe.promotion);if(de){m({from:j,to:P,color:de.color});return}try{const oe=F.move({from:j,to:P});oe?(oe.captured?re("capture"):re("move"),I(F,[j,P])):A()}catch{A()}};T.useEffect(()=>{if(!X.current)return;const j={fen:n,orientation:s,viewOnly:!1,turnColor:"white",check:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:250},movable:{free:!1,color:"white",dests:le(r.current),showDests:!0},draggable:{enabled:!0,showGhost:!0},selectable:{enabled:!0},drawable:{enabled:!0,visible:!0,autoShapes:$,onChange:K=>{q(K),$e.updateRoom(e,{shapes:K})}},events:{move:(K,de)=>ce(K,de)}},P=Us(X.current,j);L.current=P;const F=new ResizeObserver(()=>{L.current&&L.current.redrawAll()});return F.observe(X.current),()=>{P.destroy(),F.disconnect()}},[]);const I=(j,P)=>{const F=j.fen(),K=j.turn()==="w"?"white":"black",de=j.history(),oe=j.pgn();i(F),c(P),E(j.turn()),q([]);const ke=j.isGameOver();g(ke),ke&&v(!0),t&&t({fen:F,history:de,turn:j.turn(),isGameOver:ke}),ke&&(re("gameEnd"),j.isCheckmate()?ot.success("Jaque Mate!",{duration:5e3,icon:""}):j.isDraw()&&ot("Tablas.",{icon:""})),L.current&&L.current.set({fen:F,turnColor:K,check:j.inCheck(),lastMove:P||void 0,drawable:{shapes:[]},movable:{color:K,dests:le(j)}}),$e.updateRoom(e,{fen:F,pgn:oe,history:de,lastMove:P||void 0,orientation:s,shapes:[]})};T.useEffect(()=>{const j=$e.subscribeToRoom(e,P=>{if(P&&(P.shapes&&JSON.stringify(P.shapes)!==JSON.stringify($)&&(q(P.shapes),L.current&&L.current.set({drawable:{shapes:P.shapes}})),P.fen)){const F=r.current.fen();if(P.fen!==F)try{if(P.pgn?r.current.loadPgn(P.pgn):r.current.load(P.fen),i(P.fen),c(P.lastMove||null),E(r.current.turn()),g(r.current.isGameOver()),P.orientation&&o(P.orientation),t&&t({fen:P.fen,history:P.history||r.current.history(),turn:r.current.turn(),isGameOver:r.current.isGameOver()}),L.current){const K=r.current.turn()==="w"?"white":"black";L.current.set({fen:P.fen,lastMove:P.lastMove||void 0,orientation:P.orientation||s,turnColor:K,check:r.current.inCheck(),movable:{color:K,dests:le(r.current)}})}}catch(K){console.error("Remote sync error",K);try{r.current.load(P.fen),i(P.fen),L.current&&L.current.set({fen:P.fen})}catch{}}}});return()=>j()},[e,re,t]);const V=j=>{if(!l)return;const P=r.current;try{P.move({from:l.from,to:l.to,promotion:j})?(re("promote"),I(P,[l.from,l.to])):A()}catch{A()}m(null)},pe=()=>{const j=s==="white"?"black":"white";o(j),L.current&&L.current.set({orientation:j}),$e.updateRoom(e,{orientation:j})},ze=()=>{confirm("Reiniciar partida?")&&(r.current.reset(),I(r.current,null),ot("Tablero reiniciado",{icon:""}))};return d.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center relative select-none",children:[d.jsx(Un,{position:"top-center",toastOptions:{style:{background:"#1A1A1A",color:"#EAEAEA",border:"1px solid #333"}}}),d.jsxs("div",{className:"absolute top-4 -right-16 z-50 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:[d.jsx("button",{onClick:pe,className:"p-3 bg-dark-panel/90 text-white rounded-xl shadow-xl hover:scale-110 hover:bg-gold hover:text-black transition-all border border-white/10 backdrop-blur-sm tooltip-left",title:"Girar Tablero",children:d.jsx(Jn,{size:18})}),(Q==="teacher"||b)&&d.jsx("button",{onClick:ze,className:"p-3 bg-dark-panel/90 text-red-500 rounded-xl shadow-xl hover:scale-110 hover:bg-red-500 hover:text-white transition-all border border-white/10 backdrop-blur-sm",title:"Reiniciar Partida",children:d.jsx(Xn,{size:18})})]}),d.jsxs("div",{className:"w-full aspect-square relative shadow-2xl border-[4px] border-[#1a1a1a] rounded-sm bg-[#111] overflow-hidden",children:[d.jsx("div",{className:"absolute -inset-1 bg-gradient-to-br from-gold/10 to-transparent opacity-20 blur-sm rounded-lg pointer-events-none"}),d.jsx("div",{ref:X,className:"w-full h-full relative z-10"}),l&&d.jsx("div",{className:"absolute inset-0 z-50 bg-black/80 flex items-center justify-center backdrop-blur-sm animate-fade-in",children:d.jsx("div",{className:"bg-dark-panel p-4 rounded-xl border border-gold/30 flex gap-4 shadow-[0_0_30px_rgba(212,175,55,0.1)]",children:["q","r","b","n"].map(j=>d.jsx("button",{onClick:()=>V(j),className:"w-14 h-14 bg-dark-bg hover:bg-gold/10 rounded-lg flex items-center justify-center text-4xl border border-white/10 hover:border-gold/50 transition-all hover:scale-105 active:scale-95 group",children:d.jsx("span",{className:`drop-shadow-lg ${x==="w"?"text-white":"text-gray-400 group-hover:text-gold"}`,children:j==="q"?"":j==="r"?"":j==="b"?"":""})},j))})}),w&&d.jsx("div",{className:"absolute inset-0 z-40 bg-dark-bg/85 flex items-center justify-center backdrop-blur-sm animate-in fade-in duration-500",children:d.jsxs("div",{className:"bg-dark-panel px-10 py-8 rounded-2xl border border-gold/20 text-center shadow-[0_0_50px_rgba(0,0,0,0.8)] relative overflow-hidden",children:[d.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-gold to-transparent"}),d.jsx("h3",{className:"text-3xl font-black text-white uppercase tracking-tighter mb-2",children:"Partida Finalizada"}),d.jsx("div",{className:"text-gold font-bold text-xl uppercase tracking-[0.2em] mb-6 drop-shadow-sm",children:r.current.isCheckmate()?"Jaque Mate":r.current.isDraw()?"Tablas":r.current.isStalemate()?"Ahogado":"Fin"}),d.jsxs("div",{className:"flex gap-4 justify-center",children:[d.jsx("button",{onClick:()=>v(!1),className:"px-6 py-3 bg-white/5 text-gray-300 border border-white/10 rounded-lg font-bold hover:bg-white/10 hover:text-white transition-all uppercase text-xs tracking-widest",children:"Analizar"}),d.jsx("button",{onClick:ze,className:"px-6 py-3 bg-gold/10 text-gold border border-gold/30 rounded-lg font-bold hover:bg-gold hover:text-black transition-all uppercase text-xs tracking-widest shadow-lg hover:shadow-gold/20",children:"Nueva Partida"})]})]})})]})]})},Vs=()=>{const e=[{piece:"Rey (King)",icon:"",value:"",desc:"La pieza ms importante. Mueve una casilla en cualquier direccin. No puede ser capturado, pero el juego termina si no puede escapar de un ataque (Jaque Mate).",lucide:Vt},{piece:"Dama (Queen)",icon:"",value:"9",desc:"La pieza ms poderosa. Combina los movimientos de la torre y el alfil: mueve cualquier nmero de casillas en vertical, horizontal o diagonal.",lucide:ti},{piece:"Torre (Rook)",icon:"",value:"5",desc:"Mueve en lnea recta horizontal o verticalmente. Participa en el enroque junto con el rey.",lucide:Yt},{piece:"Alfil (Bishop)",icon:"",value:"3",desc:"Mueve en diagonal cualquier nmero de casillas. Un alfil siempre permanece en casillas del mismo color durante toda la partida.",lucide:Zn},{piece:"Caballo (Knight)",icon:"",value:"3",desc:'Mueve en forma de "L" (dos casillas en una direccin, luego una en perpendicular). Es la nica pieza que puede saltar sobre otras.',lucide:Vn},{piece:"Pen (Pawn)",icon:"",value:"1",desc:"Mueve hacia adelante. Una casilla por turno (o dos desde su casilla inicial). Captura en diagonal. Al llegar al final, promociona.",lucide:ri}],t=[{name:"Enroque (Castling)",desc:"Movimiento defensivo especial del Rey y una Torre. El Rey mueve dos casillas hacia la Torre, y la Torre salta al otro lado del Rey."},{name:"Al Paso (En Passant)",desc:"Captura especial de pen que ocurre inmediatamente despus de que un pen contrario mueva dos casillas desde su origen."},{name:"Promocin",desc:"Cuando un pen alcanza la ltima fila, se transforma inmediatamente en Dama, Torre, Alfil o Caballo."}];return d.jsxs("div",{className:"flex-grow overflow-y-auto p-4 space-y-8 custom-scrollbar bg-dark-bg/50",children:[d.jsxs("section",{children:[d.jsxs("h3",{className:"text-gold font-bold text-xs uppercase tracking-[0.2em] mb-4 flex items-center gap-2 border-b border-gold/20 pb-2",children:[d.jsx(Vt,{size:14})," Piezas y Valor"]}),d.jsx("div",{className:"space-y-3",children:e.map((r,n)=>d.jsxs("div",{className:"bg-dark-panel p-3 rounded-lg border border-white/5 hover:border-gold/30 transition-all group hover:shadow-lg hover:shadow-gold/5",children:[d.jsxs("div",{className:"flex justify-between items-center mb-2",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("span",{className:"text-2xl text-white drop-shadow-md group-hover:scale-110 transition-transform",children:r.icon}),d.jsx("span",{className:"font-bold text-sm text-text-primary group-hover:text-gold transition-colors",children:r.piece})]}),d.jsxs("span",{className:"text-[10px] text-gold bg-gold/10 px-2 py-0.5 rounded border border-gold/20 font-bold uppercase tracking-wider",children:[r.value," PTS"]})]}),d.jsx("p",{className:"text-xs text-text-secondary leading-relaxed font-light",children:r.desc})]},n))})]}),d.jsxs("section",{children:[d.jsxs("h3",{className:"text-gold font-bold text-xs uppercase tracking-[0.2em] mb-4 flex items-center gap-2 border-b border-gold/20 pb-2",children:[d.jsx(Yt,{size:14})," Movimientos Especiales"]}),d.jsx("div",{className:"grid grid-cols-1 gap-3",children:t.map((r,n)=>d.jsxs("div",{className:"bg-white/5 p-3 rounded-lg border border-white/5 hover:bg-white/10 transition-colors",children:[d.jsx("span",{className:"block text-xs font-bold text-text-primary mb-1",children:r.name}),d.jsx("span",{className:"block text-[10px] text-text-muted leading-snug",children:r.desc})]},n))})]}),d.jsx("div",{className:"text-center p-4 opacity-50",children:d.jsx("p",{className:"text-[9px] text-text-muted uppercase tracking-widest",children:"Reglas FIDE Estndar"})})]})},Zs=({moves:e=[]})=>{const t=T.useRef(null);T.useEffect(()=>{t.current&&(t.current.scrollTop=t.current.scrollHeight)},[e]);const r=[];for(let n=0;n<e.length;n+=2)r.push({num:Math.floor(n/2)+1,white:e[n],black:e[n+1]||""});return d.jsxs("div",{className:"flex flex-col h-full bg-dark-panel border border-white/5 rounded-xl overflow-hidden relative",children:[d.jsxs("div",{className:"bg-white/5 px-4 py-2 border-b border-white/5 text-[10px] uppercase font-bold tracking-widest text-gold shadow-sm flex justify-between items-center",children:[d.jsx("span",{children:"Historial"}),e.length>0&&d.jsxs("span",{className:"text-xs text-text-muted",children:[Math.ceil(e.length/2)," moves"]})]}),d.jsx("div",{ref:t,className:"flex-1 overflow-y-auto custom-scrollbar p-0",children:d.jsx("table",{className:"w-full text-left border-collapse",children:d.jsxs("tbody",{children:[r.map((n,i)=>d.jsxs("tr",{className:`border-b border-white/5 hover:bg-white/5 transition-colors ${i%2===0?"bg-transparent":"bg-white/2"}`,children:[d.jsxs("td",{className:"py-2 pl-4 w-12 text-sm text-text-muted font-mono border-r border-white/5 bg-black/20",children:[n.num,"."]}),d.jsx("td",{className:"py-2 pl-3 text-sm font-bold text-white hover:text-gold cursor-pointer transition-colors w-1/2",children:n.white}),d.jsx("td",{className:"py-2 pl-3 text-sm font-bold text-white hover:text-gold cursor-pointer transition-colors w-1/2",children:n.black})]},i)),r.length===0&&d.jsx("tr",{children:d.jsx("td",{colSpan:3,className:"text-center py-8 text-text-muted text-xs italic",children:"Partida lista para comenzar..."})})]})})})]})},Ys=({fen:e,orientation:t="white"})=>{const r=T.useMemo(()=>{const i={w:{p:0,n:0,b:0,r:0,q:0},b:{p:0,n:0,b:0,r:0,q:0}},s={p:8,n:2,b:2,r:2,q:1},o=e.split(" ")[0];for(const g of o)["P","N","B","R","Q"].includes(g)?i.w[g.toLowerCase()]++:["p","n","b","r","q"].includes(g)&&i.b[g]++;const a=[],c=[];["p","n","b","r","q"].forEach(g=>{const w=i.w[g],v=i.b[g];for(let x=0;x<s[g]-w;x++)a.push(g);for(let x=0;x<s[g]-v;x++)c.push(g)});const l={p:1,n:3,b:3,r:5,q:9},m=Object.keys(i.w).reduce((g,w)=>g+i.w[w]*l[w],0),b=Object.keys(i.b).reduce((g,w)=>g+i.b[w]*l[w],0);return{w:a,b:c,score:m-b}},[e]),n=(i,s)=>d.jsx("div",{className:"flex -space-x-1 h-4 items-center",children:i.map((o,a)=>d.jsx("span",{className:`text-base leading-none ${s} drop-shadow-sm`,children:o==="p"?"":o==="n"?"":o==="b"?"":o==="r"?"":""},a))});return d.jsxs("div",{className:"flex justify-between items-center w-full px-2 py-1 text-xs font-bold bg-black/20 rounded-lg border border-white/5",children:[d.jsxs("div",{className:"flex items-center gap-2",children:[n(r.w,"text-text-secondary"),r.score<0&&d.jsxs("span",{className:"text-gold",children:["+",Math.abs(r.score)]})]}),d.jsxs("div",{className:"flex items-center gap-2",children:[r.score>0&&d.jsxs("span",{className:"text-gold",children:["+",r.score]}),n(r.b,"text-text-secondary")]})]})},so=()=>{const{teacherId:e}=Hn(),t=Wn.useContext(fr),{userRole:r,currentUserId:n}=t,[i,s]=T.useState(""),[o,a]=T.useState("game"),[c,l]=T.useState(!0),[m,b]=T.useState({fen:"start",history:[],turn:"w",isGameOver:!1,orientation:"white"}),g=Gn();T.useEffect(()=>{if(r==="student"&&$e.getRequestStatus(n,e)!=="approved"){alert("Debes solicitar acceso al profesor primero."),g(`/chat/${e}`);return}s("ey_MOCK_TOKEN_FOR_MVP_PURPOSES_ONLY_ey")},[r,n,e,g]);const w=x=>{b(E=>({...E,...x}))};if(!i)return d.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-dark-bg text-gold font-bold uppercase tracking-widest text-xs animate-pulse gap-4",children:[d.jsx(Zt,{className:"w-16 h-16 animate-bounce"}),d.jsx("span",{children:"Conectando..."})]});const v=({id:x,icon:E,label:$})=>d.jsxs("button",{onClick:()=>a(x),className:`flex-1 py-3 md:py-2 flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2 rounded-lg transition-all duration-300 border ${o===x?"bg-gold/10 border-gold/40 text-gold shadow-[0_0_15px_rgba(212,175,55,0.1)]":"border-transparent text-text-muted hover:text-text-primary hover:bg-white/5"}`,children:[d.jsx(E,{size:16,strokeWidth:2}),d.jsx("span",{className:"text-[9px] md:text-[10px] font-bold uppercase tracking-wider",children:$})]});return d.jsxs("div",{className:"flex flex-col h-[100dvh] bg-dark-bg overflow-hidden text-text-primary font-sans selection:bg-gold selection:text-black",children:[d.jsxs("div",{className:"flex-none h-14 bg-dark-bg border-b border-white/5 flex items-center justify-between px-4 md:px-6 z-10 shadow-lg relative",children:[d.jsx("div",{className:"absolute bottom-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-gold/50 to-transparent opacity-50"}),d.jsxs("div",{className:"flex items-center gap-4",children:[d.jsxs("div",{className:"flex items-center gap-2 group cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>g("/"),children:[d.jsx(Zt,{className:"w-8 h-8 text-gold drop-shadow-[0_0_5px_rgba(212,175,55,0.5)]"}),d.jsxs("h1",{className:"hidden md:block font-bold text-lg tracking-tighter text-white",children:["TOP",d.jsx("span",{className:"text-gold font-light",children:"CHESS"})]})]}),d.jsx("div",{className:"h-6 w-[1px] bg-white/10 mx-2"}),d.jsxs("div",{className:"flex items-center gap-2",children:[d.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 shadow-[0_0_8px_#22c55e] animate-pulse"}),d.jsxs("h2",{className:"text-xs font-medium text-text-secondary uppercase tracking-widest",children:["Aula ",d.jsx("span",{className:"text-white font-bold",children:e})]})]})]}),d.jsxs("button",{onClick:()=>g(r==="teacher"?"/dashboard":"/"),className:"flex items-center gap-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 py-1.5 px-3 rounded text-[10px] font-bold uppercase tracking-wider border border-red-500/20 transition-all hover:border-red-500/40",children:[d.jsx(Qn,{size:12}),d.jsx("span",{className:"hidden md:inline",children:"Salir"})]})]}),d.jsxs("div",{className:"flex-grow flex flex-col md:flex-row overflow-hidden relative",children:[d.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center bg-[#0a0a0a] relative md:border-r border-white/5 p-2 md:p-4 transition-all duration-300 overflow-hidden",children:[d.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-indigo-900/10 to-transparent opacity-40 pointer-events-none"}),d.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-10 pointer-events-none"}),d.jsx("button",{onClick:()=>l(!c),className:`absolute right-0 top-1/2 -translate-y-1/2 z-50 bg-dark-panel border-y border-l border-white/10 text-gold p-2 rounded-l-xl shadow-[0_0_15px_rgba(0,0,0,0.5)] hover:bg-gold hover:text-black transition-all duration-300
                            ${c?"translate-x-full opacity-0 pointer-events-none":"translate-x-0"}
                        `,title:"Mostrar Herramientas",children:d.jsx(Xt,{size:20})}),d.jsxs("div",{className:"flex flex-col w-full max-w-[100%] md:max-w-3xl h-full max-h-[calc(100dvh-60px)] justify-center relative z-10 transition-all duration-300 gap-2 md:gap-4",children:[d.jsxs("div",{className:"flex-none flex items-center justify-between px-3 py-2 text-text-secondary bg-black/40 rounded-xl backdrop-blur-sm border border-white/10 shadow-lg w-full",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsxs("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-gradient-to-br from-gold/20 to-gold/5 border border-gold/30 flex items-center justify-center shadow-lg relative",children:[d.jsx("span",{className:"text-gold font-bold text-xs md:text-sm",children:e==null?void 0:e.substring(0,2).toUpperCase()}),d.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 md:w-4 md:h-4 bg-dark-bg border border-white/10 flex items-center justify-center rounded-full",children:d.jsx("div",{className:"w-1.5 h-1.5 md:w-2 md:h-2 bg-green-500 rounded-full animate-pulse"})})]}),d.jsxs("div",{className:"flex flex-col",children:[d.jsxs("span",{className:"text-xs md:text-sm font-bold text-white tracking-wide flex items-center gap-2",children:["GM ",e,d.jsx("span",{className:"px-1 py-0.5 bg-gold/20 text-gold text-[8px] rounded font-black tracking-widest border border-gold/20",children:"PRO"})]}),d.jsxs("span",{className:"text-[10px] text-gold/80 font-mono flex items-center gap-1",children:[d.jsx("span",{className:"w-1.5 h-1.5 rounded-full border border-gold/50"}),"2850 ELO"]})]})]}),d.jsx("div",{className:"text-xs md:text-sm font-mono text-white/90 bg-black/50 px-3 py-1.5 rounded-lg border border-white/5 shadow-inner",children:"10:00"})]}),d.jsx("div",{className:"flex-grow flex items-center justify-center w-full min-h-0",children:d.jsx("div",{className:"aspect-square h-full max-h-full rounded-lg shadow-2xl shadow-black/80 overflow-hidden border border-white/5",children:d.jsx(Qs,{teacherId:e,onGameStateChange:w})})}),d.jsxs("div",{className:"flex-none flex items-center justify-between px-3 py-2 text-text-secondary bg-black/40 rounded-xl backdrop-blur-sm border border-white/10 shadow-lg w-full mt-auto",children:[d.jsxs("div",{className:"flex items-center gap-3",children:[d.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-gradient-to-br from-green-500/20 to-green-500/5 border border-green-500/30 flex items-center justify-center shadow-lg",children:d.jsx("span",{className:"text-green-500 font-bold text-xs md:text-sm",children:n==null?void 0:n.substring(0,2).toUpperCase()})}),d.jsxs("div",{className:"flex flex-col",children:[d.jsx("span",{className:"text-xs md:text-sm font-bold text-white tracking-wide",children:n||"T"}),d.jsx("span",{className:"text-[10px] text-green-400/80 font-mono",children:"1500 ELO"})]})]}),d.jsx("div",{className:"text-xs md:text-sm font-mono text-white bg-black/50 px-3 py-1.5 rounded-lg border-b-2 border-green-500/50 shadow-[0_0_10px_rgba(34,197,94,0.1)]",children:"09:45"})]})]})]}),d.jsxs("div",{className:`flex-none bg-dark-panel/95 backdrop-blur-xl flex flex-col border-t md:border-t-0 md:border-l border-white/5 relative z-20 shadow-2xl transition-all duration-300 ease-in-out
                    ${c?"h-[35vh] md:h-auto md:w-[400px] opacity-100":"h-0 md:h-auto md:w-0 overflow-hidden opacity-0"}
                `,children:[d.jsx("button",{onClick:()=>l(!1),className:"absolute top-2 right-2 text-text-muted hover:text-white p-2 z-50 md:hidden",children:d.jsx(at,{size:20})}),d.jsx("button",{onClick:()=>l(!c),className:"hidden md:flex absolute top-4 -left-4 bg-dark-panel border border-white/5 border-r-0 text-gold p-1.5 rounded-l-lg shadow-lg z-50 hover:bg-white/5 transition-colors items-center justify-center",title:"Ocultar Herramientas",children:d.jsx(at,{size:16})}),d.jsxs("div",{className:"flex p-3 gap-2 bg-dark-bg/50 border-b border-white/5 overflow-x-auto custom-scrollbar",children:[d.jsx(v,{id:"game",icon:ei,label:"Partida"}),d.jsx(v,{id:"chat",icon:Xt,label:"Chat"}),d.jsx(v,{id:"analysis",icon:We,label:"Anlisis"}),d.jsx(v,{id:"tools",icon:We,label:"Herramientas"})]}),d.jsxs("div",{className:"flex-grow overflow-hidden bg-transparent relative",children:[o==="game"&&d.jsxs("div",{className:"h-full flex flex-col p-4 gap-4 animate-fade-in",children:[d.jsxs("div",{className:"flex-none",children:[d.jsx("h3",{className:"text-[10px] font-bold text-gold uppercase tracking-widest mb-2 opacity-80",children:"Material"}),d.jsx(Ys,{fen:m.fen,orientation:m.orientation})]}),d.jsx("div",{className:"flex-grow overflow-hidden relative",children:d.jsx(Zs,{moves:m.history})})]}),o==="analysis"&&d.jsxs("div",{className:"h-full flex flex-col p-4 gap-6 animate-fade-in",children:[d.jsxs("div",{className:"bg-dark-bg p-4 rounded-xl border border-white/5 space-y-4",children:[d.jsxs("h3",{className:"text-gold font-bold text-xs uppercase tracking-widest flex items-center gap-2",children:[d.jsx(We,{size:14})," Importar Estudio"]}),d.jsxs("div",{className:"space-y-2",children:[d.jsx("p",{className:"text-[10px] text-text-muted",children:"Pega la URL de un estudio de Lichess para cargar la partida."}),d.jsxs("div",{className:"flex gap-2",children:[d.jsx("input",{type:"text",id:"lichess-url",placeholder:"https://lichess.org/study/...",className:"flex-1 bg-white/5 border border-white/10 rounded px-2 py-1 text-xs text-white focus:border-gold/50 outline-none"}),d.jsx("button",{onClick:()=>{const x=document.getElementById("lichess-url").value;if(!x)return;const E=x.match(/study\/([a-zA-Z0-9]+)/);if(E){const $=E[1];alert(`Simulando importacin del estudio ${$}... (CORS previene fetch directo en cliente puro)`),$e.updateRoom(e,{pgn:`[Event "Mock Game"]
[Site "Lichess"]
1. e4 e5 2. Nf3 Nc6 3. Bb5 a6`,fen:"r1bqkbnr/1ppp1ppp/p1n5/1B2p3/4P3/5N2/PPPP1PPP/RNBQK2R w KQkq - 0 4"})}else alert("URL invlida")},className:"px-3 py-1 bg-gold/10 text-gold border border-gold/30 rounded text-xs font-bold hover:bg-gold hover:text-black transition-colors",children:"Cargar"})]})]})]}),d.jsxs("div",{className:"bg-dark-bg p-4 rounded-xl border border-white/5 space-y-4",children:[d.jsxs("h3",{className:"text-blue-400 font-bold text-xs uppercase tracking-widest flex items-center gap-2",children:[d.jsx(We,{size:14})," Motor de Anlisis"]}),d.jsxs("div",{className:"p-3 bg-black/20 rounded border border-white/5 flex items-center justify-between",children:[d.jsx("span",{className:"text-xs text-text-secondary",children:"Stockfish 16 Lite"}),d.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),d.jsx("div",{className:"h-24 flex items-center justify-center text-text-muted text-xs italic border border-dashed border-white/10 rounded",children:"Evaluacin: +0.45 (Profundidad 12)"})]})]}),o==="audio"&&d.jsxs("div",{className:"h-full flex flex-col justify-center items-center p-8 text-center animate-fade-in relative",children:[d.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_rgba(212,175,55,0.05)_0%,_transparent_70%)]"}),d.jsxs("div",{className:"w-24 h-24 rounded-full bg-dark-bg border border-gold/20 flex items-center justify-center mb-6 shadow-[0_0_30px_rgba(0,0,0,0.5)] relative group",children:[d.jsx("div",{className:"absolute inset-0 rounded-full border border-gold/10 animate-ping opacity-20"}),d.jsx(Yn,{size:32,className:"text-gold opacity-90 group-hover:scale-110 transition-transform duration-500"})]}),d.jsx("h3",{className:"text-gold font-bold text-lg uppercase tracking-widest mb-2 text-shadow-sm",children:"Canal de Voz"}),d.jsx("p",{className:"text-text-secondary text-xs font-light tracking-wide mb-6",children:"Conexin de alta fidelidad establecida"}),d.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[d.jsx("span",{className:"px-3 py-1 bg-white/5 rounded-full text-[10px] text-text-muted border border-white/5",children:"Opus 48kHz"}),d.jsx("span",{className:"px-3 py-1 bg-white/5 rounded-full text-[10px] text-text-muted border border-white/5",children:"Stereo"})]})]}),o==="chat"&&d.jsxs("div",{className:"h-full flex flex-col animate-fade-in relative bg-dark-bg/30",children:[d.jsxs("div",{className:"flex-grow p-4 overflow-y-auto space-y-4 custom-scrollbar",children:[d.jsxs("div",{className:"text-xs md:text-sm p-3 rounded-lg bg-dark-bg border border-gold/10 shadow-sm relative group hover:border-gold/30 transition-colors",children:[d.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-[2px] bg-gold rounded-l-lg"}),d.jsxs("span",{className:"font-bold text-gold block text-[10px] uppercase mb-1 tracking-wider flex items-center gap-1",children:["GM ",e," ",d.jsx("span",{className:"text-[8px] bg-gold text-black px-1 rounded font-black",children:"PRO"})]}),d.jsx("span",{className:"text-text-secondary leading-relaxed font-light",children:"Bienvenidos a la clase. Hoy analizaremos la estructura de peones en la Siciliana."})]}),d.jsxs("div",{className:"text-xs md:text-sm p-3 rounded-lg bg-white/5 border border-white/5 ml-8 relative",children:[d.jsx("span",{className:"font-bold text-blue-400 block text-[10px] uppercase mb-1 tracking-wider text-right",children:"T"}),d.jsx("span",{className:"text-text-primary block text-right",children:"Podemos ver la variante Najdorf?"})]})]}),d.jsx("div",{className:"p-3 border-t border-white/5 bg-dark-bg/80 backdrop-blur-md",children:d.jsxs("div",{className:"relative",children:[d.jsx("input",{type:"text",placeholder:"Escribe un mensaje...",className:"w-full bg-white/5 border border-white/10 rounded-lg pl-4 pr-10 py-3 text-xs md:text-sm text-white focus:outline-none focus:border-gold/50 focus:bg-white/10 transition-all placeholder-text-muted/50"}),d.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-gold hover:text-white transition-colors",children:d.jsx(at,{size:16})})]})})]}),o==="rules"&&d.jsx("div",{className:"h-full overflow-hidden animate-fade-in",children:d.jsx(Vs,{})})]})]})]})]})};export{so as default};
