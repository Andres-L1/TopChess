import{c as ae,r as o,j as e,X as V,z as h,a as re,u as le,f as n,e as ie,i as $,B as ne}from"./index-DcnL8Cmp.js";import{V as U,a as oe,E as de,C as ce}from"./Calendar-B6GEVw-W.js";import{S as xe}from"./Skeleton-CL6QxXE9.js";import{C as me}from"./credit-card-CaXG1LPR.js";import{S as pe}from"./shield-check-DooPFwmv.js";import{T as he,a as H}from"./trending-up-n_DLL-T9.js";import{T as O}from"./trophy-BzY2EPQ_.js";import{D as ue}from"./dollar-sign-BNR6n_x9.js";import{C as ge}from"./clock-BAyQjXiF.js";import"./check-COoCMQAm.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=ae("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),fe=({isOpen:z,onClose:l,onSuccess:A,teacher:c})=>{const[S,E]=o.useState(!1),[j,v]=o.useState("stripe");if(!z||!c)return null;const p=c.region==="EU",I=p?59:39,q=p?"€":"$",B=p?"":" USD",M=async()=>{E(!0);try{await new Promise(u=>setTimeout(u,800)),await A(j),l()}catch(u){console.error("Payment error:",u),h.error("Error al procesar el pago. Intenta nuevamente.")}finally{E(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-dark-panel border border-white/10 rounded-2xl w-full max-w-md overflow-hidden shadow-2xl relative",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 text-text-muted hover:text-white transition-colors",children:e.jsx(V,{size:24})}),e.jsxs("div",{className:"p-6 border-b border-white/5 bg-gradient-to-r from-gold/10 to-transparent",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-3",children:[e.jsx(me,{className:"text-gold",size:24}),"Plan Mensual (4 Clases)"]}),e.jsxs("p",{className:"text-sm text-text-muted mt-1",children:["Suscripción para clases con ",e.jsx("span",{className:"text-white font-bold",children:c.name})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-black/30 border border-white/5 rounded-2xl p-6 text-center shadow-inner",children:[e.jsx("p",{className:"text-xs font-bold text-text-muted uppercase tracking-wider mb-2",children:"Total a Pagar"}),e.jsxs("div",{className:"text-4xl font-black text-white",children:[q,I,B]}),e.jsx("p",{className:"text-xs text-gold/80 mt-2 font-medium",children:"Equivale a 4 reservas en el calendario"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-text-muted uppercase tracking-wider block",children:"Método de Pago"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>v("stripe"),className:`p-3 rounded-xl border flex flex-col items-center gap-2 transition-all ${j==="stripe"?"bg-white/10 border-gold/50":"bg-white/5 border-white/10 opacity-60 hover:opacity-100"}`,children:[e.jsx("div",{className:"text-white font-bold",children:"Stripe"}),e.jsx("div",{className:"text-[10px] text-text-muted",children:"Tarjeta de Crédito"})]}),e.jsxs("button",{onClick:()=>v("mercadopago"),className:`p-3 rounded-xl border flex flex-col items-center gap-2 transition-all ${j==="mercadopago"?"bg-white/10 border-blue-500/50":"bg-white/5 border-white/10 opacity-60 hover:opacity-100"}`,children:[e.jsx("div",{className:"text-blue-400 font-bold",children:"MercadoPago"}),e.jsx("div",{className:"text-[10px] text-text-muted",children:"Latinoamérica"})]})]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-orange-500/10 border border-orange-500/20 flex gap-3 items-start",children:[e.jsx(be,{className:"text-orange-500 shrink-0",size:18}),e.jsx("p",{className:"text-xs text-orange-200/80",children:"Estás en modo seguro. Los pagos son procesados por proveedores certificados."})]}),e.jsx("button",{onClick:M,disabled:S,className:"w-full bg-gold hover:bg-gold/80 hover:brightness-110 text-black font-black uppercase tracking-widest py-4 rounded-xl transition-all hover:scale-[1.02] active:scale-[0.98] shadow-[0_0_20px_rgba(212,175,55,0.2)] mt-2 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:S?e.jsx("div",{className:"w-5 h-5 border-2 border-black/30 border-t-black rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:18}),"Activar Suscripción"]})})]})]})})},Pe=()=>{var F;const z=re(),{currentUserId:l,logout:A,currentUser:c}=z,S=le(),[E,j]=o.useState(0),[v,p]=o.useState([]),[I,q]=o.useState([]),[B,M]=o.useState([]),[u,W]=o.useState([]),[X,_]=o.useState(!0),[G,R]=o.useState(!1),[m,w]=o.useState(null),[J,K]=o.useState([]),[Q,D]=o.useState(!1);o.useEffect(()=>{if(!l)return;let s=!0,r,x,g;return(async()=>{_(!0);try{const a=await n.getHomeworksForStudent(l);s&&W(a)}catch(a){console.error("Error loading static student data",a)}finally{s&&_(!1)}})(),g=n.observeWallet(l,a=>{s&&j(a.balance)}),r=n.observeRequestsForStudent(l,async a=>{if(!s)return;const N=a.filter(t=>t.status==="approved"),i=new Map;N.forEach(t=>{i.has(t.teacherId)||i.set(t.teacherId,t)});const f=Array.from(i.values()).map(async t=>{const C=await n.getTeacherById(t.teacherId);return C?{...C,classCredits:t.classCredits||0}:null}),y=await Promise.all(f);s&&p(y.filter(t=>t!==null));const L=a.filter(t=>t.status==="pending"),k=new Map;L.forEach(t=>{k.has(t.teacherId)||k.set(t.teacherId,t)});const d=Array.from(k.values()).map(async t=>{const C=await n.getTeacherById(t.teacherId);return C?{...C,requestDate:t.timestamp}:null}),T=await Promise.all(d);s&&q(T.filter(t=>t!==null))}),x=n.observeBookingsForUser(l,"student",a=>{s&&M(a)}),()=>{s=!1,r&&r(),x&&x(),g&&g()}},[l]);const Y=async s=>{const r=await n.getTeacherAvailability(s.id);K(r),w(s),D(!0)},Z=s=>{w(s),R(!0)},ee=async s=>{if(m)try{const r=await n.buySubscription(l,m,s);if(r.success){h.success(r.message),R(!1),w(null);const g=(await n.getRequestsForStudent(l)).filter(i=>i.status==="approved"),b=new Map;g.forEach(i=>{b.has(i.teacherId)||b.set(i.teacherId,i)});const a=Array.from(b.values()).map(async i=>{const f=await n.getTeacherById(i.teacherId);return f?{...f,classCredits:i.classCredits||0}:null}),N=await Promise.all(a);p(N.filter(i=>i!==null))}else h.error(r.message)}catch(r){console.error("Error processing subscription:",r),h.error("Error al procesar la suscripción")}},se=async s=>{`${["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"][s.dayIndex]}`;const x=`${s.dayIndex}-${s.hour}`,b={id:`booking_${Date.now()}`,studentId:l,teacherId:m.id,slotId:x,date:new Date().toISOString().split("T")[0],time:s.hour,status:"confirmed",timestamp:Date.now(),meetingLink:`/classroom/${m.id}`};try{const a=await n.bookClass(l,m.id,b);if(a.success){h.success(a.message),w(null),D(!1);const N=await n.getBookingsForUser(l,"student");M(N);const f=(await n.getRequestsForStudent(l)).filter(d=>d.status==="approved"),y=new Map;f.forEach(d=>{y.has(d.teacherId)||y.set(d.teacherId,d)});const L=Array.from(y.values()).map(async d=>{const T=await n.getTeacherById(d.teacherId);return T?{...T,classCredits:d.classCredits||0}:null}),k=await Promise.all(L);p(k.filter(d=>d!==null))}else h.error(a.message)}catch(a){console.error("Error creating booking",a),h.error("Error al reservar la clase")}},te=()=>{A(),S("/")},P=[...B].filter(s=>s.status!=="cancelled").sort((s,r)=>{const x=s.date.localeCompare(r.date);return x!==0?x:s.time.localeCompare(r.time)})[0]??null;return e.jsxs("div",{className:"p-4 md:p-8 max-w-7xl mx-auto space-y-6 md:space-y-8 animate-fade-in pb-24",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-gold to-orange-500 rounded-full blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"}),e.jsx("div",{className:"relative w-16 h-16 rounded-full bg-dark-panel border-2 border-gold/30 flex items-center justify-center font-bold text-2xl text-gold shadow-2xl",children:((F=c==null?void 0:c.displayName)==null?void 0:F.charAt(0))||"A"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 border-4 border-dark-panel rounded-full"})]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold font-display text-white",children:["Hola, ",e.jsx("span",{className:"text-gold",children:(c==null?void 0:c.displayName)||"Alumno"})," ",e.jsx("span",{className:"text-white/20",children:"."})]}),e.jsxs("p",{className:"text-sm md:text-base text-text-muted flex items-center gap-2",children:[e.jsx(he,{size:14,className:"text-green-400"}),"Tu progreso en TopChess está despegando."]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"flex-1 md:flex-none glass-panel px-4 py-2 rounded-xl flex items-center gap-3 border-gold/10",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gold/10 text-gold",children:e.jsx(O,{size:18})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-text-muted uppercase font-black tracking-widest",children:"Activo"}),e.jsx("p",{className:"text-sm font-bold text-white",children:"TopChess"})]})]}),e.jsx("button",{onClick:te,"aria-label":"Cerrar Sesión",className:"p-3 text-text-muted hover:text-red-400 transition-all rounded-xl border border-white/5 hover:border-red-500/20 bg-white/2",title:"Cerrar Sesión",children:e.jsx(ie,{size:20})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"glass-panel p-5 rounded-2xl bg-gradient-to-br from-dark-panel to-gold/5 border-gold/10 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-gold/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:bg-gold/20 transition-all"}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gold text-black shadow-lg shadow-gold/20",children:e.jsx(O,{size:20})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-black text-gold uppercase tracking-widest",children:"Nivel Actual"}),e.jsx("p",{className:"text-xl font-bold text-white",children:"Aprendiz Bronce"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-[10px] font-bold uppercase tracking-wider",children:[e.jsx("span",{className:"text-text-muted",children:"Progreso al Nivel 5"}),e.jsx("span",{className:"text-gold",children:"750 / 1000 XP"})]}),e.jsx("div",{className:"h-2 w-full bg-black/40 rounded-full overflow-hidden border border-white/5",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gold to-orange-500 rounded-full w-[75%] shadow-[0_0_10px_rgba(255,215,0,0.3)]"})})]})]}),e.jsxs("div",{className:"glass-panel p-5 rounded-2xl border-white/5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-blue-500/10 text-blue-400",children:e.jsx(H,{size:20})}),e.jsx("span",{className:"text-[10px] font-black text-blue-400 uppercase tracking-widest",children:"Misión Diaria"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-white mb-1",children:"Gana 2 partidas tácticas"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1 bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-400 w-1/2"})}),e.jsx("span",{className:"text-[10px] text-text-muted font-mono",children:"1/2"})]})]})]}),e.jsxs("div",{className:"glass-panel p-5 rounded-2xl border-white/5 flex flex-col justify-between",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-purple-500/10 text-purple-400",children:e.jsx(U,{size:20})}),e.jsx("span",{className:"text-[10px] font-black text-purple-400 uppercase tracking-widest",children:"Aprendizaje"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-white mb-2",children:"Total Clases Recibidas"}),e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:"12"}),e.jsx("span",{className:"text-xs text-text-muted",children:"horas de estudio"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs("section",{children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-gold/10",children:e.jsx(O,{className:"text-gold",size:20})}),"Mis Mentores"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:X?[1,2].map(s=>e.jsx(xe,{width:"100%",height:150},s)):e.jsx(e.Fragment,{children:v.length===0?e.jsxs("div",{className:"col-span-1 md:col-span-2 p-12 rounded-3xl border-2 border-dashed border-white/5 bg-white/[0.01] text-center",children:[e.jsx("p",{className:"text-text-muted mb-4 text-sm italic",children:"No tienes mentores activos todavía."}),e.jsx($,{to:"/",className:"btn-secondary py-3 px-8 text-xs",children:"Explorar catálogo"})]}):v.map(s=>e.jsxs("div",{className:"glass-panel p-6 rounded-2xl bg-[#1b1a17] border border-white/5 group hover:border-gold/30 transition-all duration-500",children:[e.jsxs("div",{className:"flex items-center gap-5 mb-6",children:[e.jsx("img",{src:s.image||`https://ui-avatars.com/api/?name=${encodeURIComponent(s.name)}&background=random`,alt:s.name,className:"w-16 h-16 rounded-2xl object-cover border border-white/10",onError:r=>{r.target.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(s.name)}&background=random`}}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-bold text-white text-lg truncate group-hover:text-gold transition-colors",children:s.name}),e.jsxs("p",{className:"text-[10px] text-text-muted font-black uppercase tracking-widest mt-0.5",children:[s.elo," ELO • Mentor"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-4",children:[e.jsxs("div",{className:"col-span-2 flex justify-between items-center bg-black/40 px-4 py-2 rounded-lg border border-white/5 mb-2",children:[e.jsx("span",{className:"text-xs text-text-muted font-bold",children:"Clases Disponibles:"}),e.jsx("span",{className:"text-lg font-black text-gold",children:s.classCredits||0})]}),s.classCredits>0?e.jsxs(e.Fragment,{children:[e.jsxs($,{to:`/classroom/${s.id}`,className:"flex items-center justify-center gap-2 bg-white/5 hover:bg-white/10 text-white text-[10px] font-black uppercase tracking-widest py-3 rounded-xl transition-all border border-white/5",children:[e.jsx(U,{size:14,className:"text-gold"})," Aula"]}),e.jsxs("button",{onClick:()=>Y(s),className:"flex items-center justify-center gap-2 bg-gold hover:bg-white text-black text-[10px] font-black uppercase tracking-widest py-3 rounded-xl transition-all shadow-lg shadow-gold/5",children:[e.jsx(oe,{size:14})," Agendar"]})]}):e.jsxs("button",{onClick:()=>Z(s),className:"col-span-2 flex items-center justify-center gap-2 bg-gold hover:bg-white text-black text-[10px] font-black uppercase tracking-widest py-3 rounded-xl transition-all shadow-lg shadow-gold/5",children:[e.jsx(ue,{size:14})," Pagar Mensualidad"]})]})]},s.id))})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-3xl bg-gradient-to-br from-[#1b1a17] to-green-900/10 border-green-500/20 relative overflow-hidden",children:[e.jsxs("h3",{className:"font-bold text-white mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(H,{className:"text-green-400",size:18})}),"Próxima Clase"]}),P?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-4xl font-bold text-white mb-1 tracking-tighter",children:P.time}),e.jsx("p",{className:"text-xs text-green-400 font-mono mb-8 uppercase tracking-widest",children:P.date}),e.jsx($,{to:P.meetingLink,className:"w-full bg-green-500 hover:bg-green-400 text-black py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all block text-center",children:"Entrar al Aula"})]}):e.jsx("div",{className:"text-center py-10 opacity-20 italic text-sm",children:"No hay clases próximas"})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border-white/5 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-blue-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:bg-blue-500/20 transition-all"}),e.jsxs("h3",{className:"font-bold text-white mb-6 flex items-center gap-3 relative z-10",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(ne,{className:"text-blue-400",size:18})}),"Mis Tareas"]}),e.jsx("div",{className:"space-y-3 relative z-10",children:u.length===0?e.jsx("p",{className:"text-xs text-text-muted italic opacity-50 text-center py-4",children:"No tienes tareas asignadas"}):u.map(s=>e.jsxs("a",{href:s.type==="lichess_study"?s.referenceData:"#",target:"_blank",rel:"noopener noreferrer",className:"block p-4 bg-white/[0.02] hover:bg-white/[0.05] rounded-2xl border border-white/5 hover:border-blue-400/30 transition-all group/item",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest px-2 py-0.5 rounded ${s.status==="completed"?"bg-green-500/10 text-green-400":"bg-yellow-500/10 text-yellow-500"}`,children:s.status==="completed"?"Completado":"Pendiente"}),s.type==="lichess_study"&&e.jsx(de,{size:12,className:"text-text-muted group-hover/item:text-white"})]}),e.jsx("h4",{className:"font-bold text-white text-sm mb-1 truncate",children:s.title}),e.jsx("p",{className:"text-xs text-text-muted line-clamp-1",children:s.description||"Sin descripción"})]},s.id))})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-3xl border-white/5",children:[e.jsxs("h3",{className:"font-bold text-white mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(ge,{className:"text-blue-400",size:18})}),"Solicitudes"]}),e.jsx("div",{className:"space-y-4",children:I.length===0?e.jsx("p",{className:"text-xs text-text-muted italic opacity-50 text-center py-4",children:"Sin solicitudes pendientes"}):I.map(s=>e.jsxs("div",{className:"p-4 bg-white/[0.02] rounded-2xl border border-white/5 flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-xs font-bold text-white/20 border border-white/10 uppercase",children:s.name.substring(0,2)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-white font-bold truncate",children:s.name}),e.jsx("p",{className:"text-[10px] text-blue-400/80 font-black uppercase tracking-widest",children:"Enviada"})]})]},s.id))})]})]})]}),m&&Q&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-dark-panel border border-white/10 rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl relative",children:[e.jsx("button",{onClick:()=>{w(null),D(!1)},className:"absolute top-4 right-4 text-text-muted hover:text-white","aria-label":"Cerrar Modal",children:e.jsx(V,{size:24})}),e.jsxs("div",{className:"p-6 border-b border-white/5",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Reservar Clase"}),e.jsxs("p",{className:"text-sm text-text-muted",children:["con ",e.jsx("span",{className:"text-gold",children:m.name})]})]}),e.jsx("div",{className:"p-6",children:e.jsx(ce,{mode:"view",availability:J,onSlotClick:se})})]})}),e.jsx(fe,{isOpen:G,onClose:()=>R(!1),onSuccess:ee,teacher:m})]})};export{Pe as default};
