var G_=Object.defineProperty;var Y_=(t,e,n)=>e in t?G_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ue=(t,e,n)=>Y_(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();function wm(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Q_(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var a=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:function(){return t[i]}})}),n}var vy={exports:{}},Lu={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J_=Symbol.for("react.transitional.element"),X_=Symbol.for("react.fragment");function by(t,e,n){var i=null;if(n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),"key"in e){n={};for(var a in e)a!=="key"&&(n[a]=e[a])}else n=e;return e=n.ref,{$$typeof:J_,type:t,key:i,ref:e!==void 0?e:null,props:n}}Lu.Fragment=X_;Lu.jsx=by;Lu.jsxs=by;vy.exports=Lu;var x=vy.exports,yy={exports:{}},ne={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rm=Symbol.for("react.transitional.element"),$_=Symbol.for("react.portal"),Z_=Symbol.for("react.fragment"),W_=Symbol.for("react.strict_mode"),ew=Symbol.for("react.profiler"),tw=Symbol.for("react.consumer"),nw=Symbol.for("react.context"),iw=Symbol.for("react.forward_ref"),aw=Symbol.for("react.suspense"),rw=Symbol.for("react.memo"),Sy=Symbol.for("react.lazy"),sw=Symbol.for("react.activity"),Vg=Symbol.iterator;function ow(t){return t===null||typeof t!="object"?null:(t=Vg&&t[Vg]||t["@@iterator"],typeof t=="function"?t:null)}var Ty={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Cy=Object.assign,ky={};function Ps(t,e,n){this.props=t,this.context=e,this.refs=ky,this.updater=n||Ty}Ps.prototype.isReactComponent={};Ps.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ps.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Ey(){}Ey.prototype=Ps.prototype;function xm(t,e,n){this.props=t,this.context=e,this.refs=ky,this.updater=n||Ty}var Om=xm.prototype=new Ey;Om.constructor=xm;Cy(Om,Ps.prototype);Om.isPureReactComponent=!0;var Hg=Array.isArray;function Kf(){}var Ne={H:null,A:null,T:null,S:null},_y=Object.prototype.hasOwnProperty;function Am(t,e,n){var i=n.ref;return{$$typeof:Rm,type:t,key:e,ref:i!==void 0?i:null,props:n}}function lw(t,e){return Am(t.type,e,t.props)}function Mm(t){return typeof t=="object"&&t!==null&&t.$$typeof===Rm}function cw(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Kg=/\/+/g;function kd(t,e){return typeof t=="object"&&t!==null&&t.key!=null?cw(""+t.key):e.toString(36)}function uw(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Kf,Kf):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function Ir(t,e,n,i,a){var r=typeof t;(r==="undefined"||r==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(r){case"bigint":case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case Rm:case $_:s=!0;break;case Sy:return s=t._init,Ir(s(t._payload),e,n,i,a)}}if(s)return a=a(t),s=i===""?"."+kd(t,0):i,Hg(a)?(n="",s!=null&&(n=s.replace(Kg,"$&/")+"/"),Ir(a,e,n,"",function(c){return c})):a!=null&&(Mm(a)&&(a=lw(a,n+(a.key==null||t&&t.key===a.key?"":(""+a.key).replace(Kg,"$&/")+"/")+s)),e.push(a)),1;s=0;var o=i===""?".":i+":";if(Hg(t))for(var l=0;l<t.length;l++)i=t[l],r=o+kd(i,l),s+=Ir(i,e,n,r,a);else if(l=ow(t),typeof l=="function")for(t=l.call(t),l=0;!(i=t.next()).done;)i=i.value,r=o+kd(i,l++),s+=Ir(i,e,n,r,a);else if(r==="object"){if(typeof t.then=="function")return Ir(uw(t),e,n,i,a);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return s}function Pl(t,e,n){if(t==null)return t;var i=[],a=0;return Ir(t,i,"","",function(r){return e.call(n,r,a++)}),i}function dw(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Gg=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},fw={map:Pl,forEach:function(t,e,n){Pl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Pl(t,function(){e++}),e},toArray:function(t){return Pl(t,function(e){return e})||[]},only:function(t){if(!Mm(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ne.Activity=sw;ne.Children=fw;ne.Component=Ps;ne.Fragment=Z_;ne.Profiler=ew;ne.PureComponent=xm;ne.StrictMode=W_;ne.Suspense=aw;ne.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Ne;ne.__COMPILER_RUNTIME={__proto__:null,c:function(t){return Ne.H.useMemoCache(t)}};ne.cache=function(t){return function(){return t.apply(null,arguments)}};ne.cacheSignal=function(){return null};ne.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var i=Cy({},t.props),a=t.key;if(e!=null)for(r in e.key!==void 0&&(a=""+e.key),e)!_y.call(e,r)||r==="key"||r==="__self"||r==="__source"||r==="ref"&&e.ref===void 0||(i[r]=e[r]);var r=arguments.length-2;if(r===1)i.children=n;else if(1<r){for(var s=Array(r),o=0;o<r;o++)s[o]=arguments[o+2];i.children=s}return Am(t.type,a,i)};ne.createContext=function(t){return t={$$typeof:nw,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:tw,_context:t},t};ne.createElement=function(t,e,n){var i,a={},r=null;if(e!=null)for(i in e.key!==void 0&&(r=""+e.key),e)_y.call(e,i)&&i!=="key"&&i!=="__self"&&i!=="__source"&&(a[i]=e[i]);var s=arguments.length-2;if(s===1)a.children=n;else if(1<s){for(var o=Array(s),l=0;l<s;l++)o[l]=arguments[l+2];a.children=o}if(t&&t.defaultProps)for(i in s=t.defaultProps,s)a[i]===void 0&&(a[i]=s[i]);return Am(t,r,a)};ne.createRef=function(){return{current:null}};ne.forwardRef=function(t){return{$$typeof:iw,render:t}};ne.isValidElement=Mm;ne.lazy=function(t){return{$$typeof:Sy,_payload:{_status:-1,_result:t},_init:dw}};ne.memo=function(t,e){return{$$typeof:rw,type:t,compare:e===void 0?null:e}};ne.startTransition=function(t){var e=Ne.T,n={};Ne.T=n;try{var i=t(),a=Ne.S;a!==null&&a(n,i),typeof i=="object"&&i!==null&&typeof i.then=="function"&&i.then(Kf,Gg)}catch(r){Gg(r)}finally{e!==null&&n.types!==null&&(e.types=n.types),Ne.T=e}};ne.unstable_useCacheRefresh=function(){return Ne.H.useCacheRefresh()};ne.use=function(t){return Ne.H.use(t)};ne.useActionState=function(t,e,n){return Ne.H.useActionState(t,e,n)};ne.useCallback=function(t,e){return Ne.H.useCallback(t,e)};ne.useContext=function(t){return Ne.H.useContext(t)};ne.useDebugValue=function(){};ne.useDeferredValue=function(t,e){return Ne.H.useDeferredValue(t,e)};ne.useEffect=function(t,e){return Ne.H.useEffect(t,e)};ne.useEffectEvent=function(t){return Ne.H.useEffectEvent(t)};ne.useId=function(){return Ne.H.useId()};ne.useImperativeHandle=function(t,e,n){return Ne.H.useImperativeHandle(t,e,n)};ne.useInsertionEffect=function(t,e){return Ne.H.useInsertionEffect(t,e)};ne.useLayoutEffect=function(t,e){return Ne.H.useLayoutEffect(t,e)};ne.useMemo=function(t,e){return Ne.H.useMemo(t,e)};ne.useOptimistic=function(t,e){return Ne.H.useOptimistic(t,e)};ne.useReducer=function(t,e,n){return Ne.H.useReducer(t,e,n)};ne.useRef=function(t){return Ne.H.useRef(t)};ne.useState=function(t){return Ne.H.useState(t)};ne.useSyncExternalStore=function(t,e,n){return Ne.H.useSyncExternalStore(t,e,n)};ne.useTransition=function(){return Ne.H.useTransition()};ne.version="19.2.4";yy.exports=ne;var T=yy.exports;const Di=wm(T);var wy={exports:{}},Iu={},Ry={exports:{}},xy={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(F,G){var Y=F.length;F.push(G);e:for(;0<Y;){var re=Y-1>>>1,Te=F[re];if(0<a(Te,G))F[re]=G,F[Y]=Te,Y=re;else break e}}function n(F){return F.length===0?null:F[0]}function i(F){if(F.length===0)return null;var G=F[0],Y=F.pop();if(Y!==G){F[0]=Y;e:for(var re=0,Te=F.length,Qt=Te>>>1;re<Qt;){var Rt=2*(re+1)-1,Ut=F[Rt],Jt=Rt+1,un=F[Jt];if(0>a(Ut,Y))Jt<Te&&0>a(un,Ut)?(F[re]=un,F[Jt]=Y,re=Jt):(F[re]=Ut,F[Rt]=Y,re=Rt);else if(Jt<Te&&0>a(un,Y))F[re]=un,F[Jt]=Y,re=Jt;else break e}}return G}function a(F,G){var Y=F.sortIndex-G.sortIndex;return Y!==0?Y:F.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var s=Date,o=s.now();t.unstable_now=function(){return s.now()-o}}var l=[],c=[],u=1,d=null,f=3,h=!1,v=!1,g=!1,C=!1,m=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;function p(F){for(var G=n(c);G!==null;){if(G.callback===null)i(c);else if(G.startTime<=F)i(c),G.sortIndex=G.expirationTime,e(l,G);else break;G=n(c)}}function y(F){if(g=!1,p(F),!v)if(n(l)!==null)v=!0,k||(k=!0,z());else{var G=n(c);G!==null&&Ge(y,G.startTime-F)}}var k=!1,_=-1,O=5,w=-1;function R(){return C?!0:!(t.unstable_now()-w<O)}function N(){if(C=!1,k){var F=t.unstable_now();w=F;var G=!0;try{e:{v=!1,g&&(g=!1,b(_),_=-1),h=!0;var Y=f;try{t:{for(p(F),d=n(l);d!==null&&!(d.expirationTime>F&&R());){var re=d.callback;if(typeof re=="function"){d.callback=null,f=d.priorityLevel;var Te=re(d.expirationTime<=F);if(F=t.unstable_now(),typeof Te=="function"){d.callback=Te,p(F),G=!0;break t}d===n(l)&&i(l),p(F)}else i(l);d=n(l)}if(d!==null)G=!0;else{var Qt=n(c);Qt!==null&&Ge(y,Qt.startTime-F),G=!1}}break e}finally{d=null,f=Y,h=!1}G=void 0}}finally{G?z():k=!1}}}var z;if(typeof S=="function")z=function(){S(N)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,fe=Z.port2;Z.port1.onmessage=N,z=function(){fe.postMessage(null)}}else z=function(){m(N,0)};function Ge(F,G){_=m(function(){F(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(F){switch(f){case 1:case 2:case 3:var G=3;break;default:G=f}var Y=f;f=G;try{return F()}finally{f=Y}},t.unstable_requestPaint=function(){C=!0},t.unstable_runWithPriority=function(F,G){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var Y=f;f=F;try{return G()}finally{f=Y}},t.unstable_scheduleCallback=function(F,G,Y){var re=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?re+Y:re):Y=re,F){case 1:var Te=-1;break;case 2:Te=250;break;case 5:Te=1073741823;break;case 4:Te=1e4;break;default:Te=5e3}return Te=Y+Te,F={id:u++,callback:G,priorityLevel:F,startTime:Y,expirationTime:Te,sortIndex:-1},Y>re?(F.sortIndex=Y,e(c,F),n(l)===null&&F===n(c)&&(g?(b(_),_=-1):g=!0,Ge(y,Y-re))):(F.sortIndex=Te,e(l,F),v||h||(v=!0,k||(k=!0,z()))),F},t.unstable_shouldYield=R,t.unstable_wrapCallback=function(F){var G=f;return function(){var Y=f;f=G;try{return F.apply(this,arguments)}finally{f=Y}}}})(xy);Ry.exports=xy;var hw=Ry.exports,Oy={exports:{}},Lt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mw=T;function Ay(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Gi(){}var Dt={d:{f:Gi,r:function(){throw Error(Ay(522))},D:Gi,C:Gi,L:Gi,m:Gi,X:Gi,S:Gi,M:Gi},p:0,findDOMNode:null},pw=Symbol.for("react.portal");function gw(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pw,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}var To=mw.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Uu(t,e){if(t==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}Lt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Dt;Lt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(Ay(299));return gw(t,e,null,n)};Lt.flushSync=function(t){var e=To.T,n=Dt.p;try{if(To.T=null,Dt.p=2,t)return t()}finally{To.T=e,Dt.p=n,Dt.d.f()}};Lt.preconnect=function(t,e){typeof t=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,Dt.d.C(t,e))};Lt.prefetchDNS=function(t){typeof t=="string"&&Dt.d.D(t)};Lt.preinit=function(t,e){if(typeof t=="string"&&e&&typeof e.as=="string"){var n=e.as,i=Uu(n,e.crossOrigin),a=typeof e.integrity=="string"?e.integrity:void 0,r=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;n==="style"?Dt.d.S(t,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:i,integrity:a,fetchPriority:r}):n==="script"&&Dt.d.X(t,{crossOrigin:i,integrity:a,fetchPriority:r,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};Lt.preinitModule=function(t,e){if(typeof t=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var n=Uu(e.as,e.crossOrigin);Dt.d.M(t,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&Dt.d.M(t)};Lt.preload=function(t,e){if(typeof t=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var n=e.as,i=Uu(n,e.crossOrigin);Dt.d.L(t,n,{crossOrigin:i,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};Lt.preloadModule=function(t,e){if(typeof t=="string")if(e){var n=Uu(e.as,e.crossOrigin);Dt.d.m(t,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else Dt.d.m(t)};Lt.requestFormReset=function(t){Dt.d.r(t)};Lt.unstable_batchedUpdates=function(t,e){return t(e)};Lt.useFormState=function(t,e,n){return To.H.useFormState(t,e,n)};Lt.useFormStatus=function(){return To.H.useHostTransitionStatus()};Lt.version="19.2.4";function My(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(My)}catch(t){console.error(t)}}My(),Oy.exports=Lt;var vw=Oy.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lt=hw,Dy=T,bw=vw;function j(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Py(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function fl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Ny(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Ly(t){if(t.tag===31){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Yg(t){if(fl(t)!==t)throw Error(j(188))}function yw(t){var e=t.alternate;if(!e){if(e=fl(t),e===null)throw Error(j(188));return e!==t?null:t}for(var n=t,i=e;;){var a=n.return;if(a===null)break;var r=a.alternate;if(r===null){if(i=a.return,i!==null){n=i;continue}break}if(a.child===r.child){for(r=a.child;r;){if(r===n)return Yg(a),t;if(r===i)return Yg(a),e;r=r.sibling}throw Error(j(188))}if(n.return!==i.return)n=a,i=r;else{for(var s=!1,o=a.child;o;){if(o===n){s=!0,n=a,i=r;break}if(o===i){s=!0,i=a,n=r;break}o=o.sibling}if(!s){for(o=r.child;o;){if(o===n){s=!0,n=r,i=a;break}if(o===i){s=!0,i=r,n=a;break}o=o.sibling}if(!s)throw Error(j(189))}}if(n.alternate!==i)throw Error(j(190))}if(n.tag!==3)throw Error(j(188));return n.stateNode.current===n?t:e}function Iy(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t;for(t=t.child;t!==null;){if(e=Iy(t),e!==null)return e;t=t.sibling}return null}var Le=Object.assign,Sw=Symbol.for("react.element"),Nl=Symbol.for("react.transitional.element"),fo=Symbol.for("react.portal"),Br=Symbol.for("react.fragment"),Uy=Symbol.for("react.strict_mode"),Gf=Symbol.for("react.profiler"),jy=Symbol.for("react.consumer"),_i=Symbol.for("react.context"),Dm=Symbol.for("react.forward_ref"),Yf=Symbol.for("react.suspense"),Qf=Symbol.for("react.suspense_list"),Pm=Symbol.for("react.memo"),ea=Symbol.for("react.lazy"),Jf=Symbol.for("react.activity"),Tw=Symbol.for("react.memo_cache_sentinel"),Qg=Symbol.iterator;function Ys(t){return t===null||typeof t!="object"?null:(t=Qg&&t[Qg]||t["@@iterator"],typeof t=="function"?t:null)}var Cw=Symbol.for("react.client.reference");function Xf(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===Cw?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Br:return"Fragment";case Gf:return"Profiler";case Uy:return"StrictMode";case Yf:return"Suspense";case Qf:return"SuspenseList";case Jf:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case fo:return"Portal";case _i:return t.displayName||"Context";case jy:return(t._context.displayName||"Context")+".Consumer";case Dm:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Pm:return e=t.displayName||null,e!==null?e:Xf(t.type)||"Memo";case ea:e=t._payload,t=t._init;try{return Xf(t(e))}catch{}}return null}var ho=Array.isArray,ee=Dy.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ye=bw.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,er={pending:!1,data:null,method:null,action:null},$f=[],qr=-1;function ai(t){return{current:t}}function pt(t){0>qr||(t.current=$f[qr],$f[qr]=null,qr--)}function Me(t,e){qr++,$f[qr]=t.current,t.current=e}var $n=ai(null),Bo=ai(null),ga=ai(null),jc=ai(null);function Bc(t,e){switch(Me(ga,e),Me(Bo,t),Me($n,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?e0(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)e=e0(e),t=aC(e,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}pt($n),Me($n,t)}function vs(){pt($n),pt(Bo),pt(ga)}function Zf(t){t.memoizedState!==null&&Me(jc,t);var e=$n.current,n=aC(e,t.type);e!==n&&(Me(Bo,t),Me($n,n))}function qc(t){Bo.current===t&&(pt($n),pt(Bo)),jc.current===t&&(pt(jc),Xo._currentValue=er)}var Ed,Jg;function Ya(t){if(Ed===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Ed=e&&e[1]||"",Jg=-1<n.stack.indexOf(`
    at`)?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ed+t+Jg}var _d=!1;function wd(t,e){if(!t||_d)return"";_d=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(e){var d=function(){throw Error()};if(Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(h){var f=h}Reflect.construct(t,[],d)}else{try{d.call()}catch(h){f=h}t.call(d.prototype)}}else{try{throw Error()}catch(h){f=h}(d=t())&&typeof d.catch=="function"&&d.catch(function(){})}}catch(h){if(h&&f&&typeof h.stack=="string")return[h.stack,f.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=i.DetermineComponentFrameRoot(),s=r[0],o=r[1];if(s&&o){var l=s.split(`
`),c=o.split(`
`);for(a=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;a<c.length&&!c[a].includes("DetermineComponentFrameRoot");)a++;if(i===l.length||a===c.length)for(i=l.length-1,a=c.length-1;1<=i&&0<=a&&l[i]!==c[a];)a--;for(;1<=i&&0<=a;i--,a--)if(l[i]!==c[a]){if(i!==1||a!==1)do if(i--,a--,0>a||l[i]!==c[a]){var u=`
`+l[i].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=i&&0<=a);break}}}finally{_d=!1,Error.prepareStackTrace=n}return(n=t?t.displayName||t.name:"")?Ya(n):""}function kw(t,e){switch(t.tag){case 26:case 27:case 5:return Ya(t.type);case 16:return Ya("Lazy");case 13:return t.child!==e&&e!==null?Ya("Suspense Fallback"):Ya("Suspense");case 19:return Ya("SuspenseList");case 0:case 15:return wd(t.type,!1);case 11:return wd(t.type.render,!1);case 1:return wd(t.type,!0);case 31:return Ya("Activity");default:return""}}function Xg(t){try{var e="",n=null;do e+=kw(t,n),n=t,t=t.return;while(t);return e}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}var Wf=Object.prototype.hasOwnProperty,Nm=lt.unstable_scheduleCallback,Rd=lt.unstable_cancelCallback,Ew=lt.unstable_shouldYield,_w=lt.unstable_requestPaint,nn=lt.unstable_now,ww=lt.unstable_getCurrentPriorityLevel,By=lt.unstable_ImmediatePriority,qy=lt.unstable_UserBlockingPriority,zc=lt.unstable_NormalPriority,Rw=lt.unstable_LowPriority,zy=lt.unstable_IdlePriority,xw=lt.log,Ow=lt.unstable_setDisableYieldValue,hl=null,an=null;function la(t){if(typeof xw=="function"&&Ow(t),an&&typeof an.setStrictMode=="function")try{an.setStrictMode(hl,t)}catch{}}var rn=Math.clz32?Math.clz32:Dw,Aw=Math.log,Mw=Math.LN2;function Dw(t){return t>>>=0,t===0?32:31-(Aw(t)/Mw|0)|0}var Ll=256,Il=262144,Ul=4194304;function Qa(t){var e=t&42;if(e!==0)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function ju(t,e,n){var i=t.pendingLanes;if(i===0)return 0;var a=0,r=t.suspendedLanes,s=t.pingedLanes;t=t.warmLanes;var o=i&134217727;return o!==0?(i=o&~r,i!==0?a=Qa(i):(s&=o,s!==0?a=Qa(s):n||(n=o&~t,n!==0&&(a=Qa(n))))):(o=i&~r,o!==0?a=Qa(o):s!==0?a=Qa(s):n||(n=i&~t,n!==0&&(a=Qa(n)))),a===0?0:e!==0&&e!==a&&!(e&r)&&(r=a&-a,n=e&-e,r>=n||r===32&&(n&4194048)!==0)?e:a}function ml(t,e){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)===0}function Pw(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Fy(){var t=Ul;return Ul<<=1,!(Ul&62914560)&&(Ul=4194304),t}function xd(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function pl(t,e){t.pendingLanes|=e,e!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Nw(t,e,n,i,a,r){var s=t.pendingLanes;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=n,t.entangledLanes&=n,t.errorRecoveryDisabledLanes&=n,t.shellSuspendCounter=0;var o=t.entanglements,l=t.expirationTimes,c=t.hiddenUpdates;for(n=s&~n;0<n;){var u=31-rn(n),d=1<<u;o[u]=0,l[u]=-1;var f=c[u];if(f!==null)for(c[u]=null,u=0;u<f.length;u++){var h=f[u];h!==null&&(h.lane&=-536870913)}n&=~d}i!==0&&Vy(t,i,0),r!==0&&a===0&&t.tag!==0&&(t.suspendedLanes|=r&~(s&~e))}function Vy(t,e,n){t.pendingLanes|=e,t.suspendedLanes&=~e;var i=31-rn(e);t.entangledLanes|=e,t.entanglements[i]=t.entanglements[i]|1073741824|n&261930}function Hy(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-rn(n),a=1<<i;a&e|t[i]&e&&(t[i]|=e),n&=~a}}function Ky(t,e){var n=e&-e;return n=n&42?1:Lm(n),n&(t.suspendedLanes|e)?0:n}function Lm(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Im(t){return t&=-t,2<t?8<t?t&134217727?32:268435456:8:2}function Gy(){var t=ye.p;return t!==0?t:(t=window.event,t===void 0?32:pC(t.type))}function $g(t,e){var n=ye.p;try{return ye.p=t,e()}finally{ye.p=n}}var Ia=Math.random().toString(36).slice(2),bt="__reactFiber$"+Ia,Kt="__reactProps$"+Ia,Ns="__reactContainer$"+Ia,eh="__reactEvents$"+Ia,Lw="__reactListeners$"+Ia,Iw="__reactHandles$"+Ia,Zg="__reactResources$"+Ia,gl="__reactMarker$"+Ia;function Um(t){delete t[bt],delete t[Kt],delete t[eh],delete t[Lw],delete t[Iw]}function zr(t){var e=t[bt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ns]||n[bt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=r0(t);t!==null;){if(n=t[bt])return n;t=r0(t)}return e}t=n,n=t.parentNode}return null}function Ls(t){if(t=t[bt]||t[Ns]){var e=t.tag;if(e===5||e===6||e===13||e===31||e===26||e===27||e===3)return t}return null}function mo(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t.stateNode;throw Error(j(33))}function es(t){var e=t[Zg];return e||(e=t[Zg]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function ht(t){t[gl]=!0}var Yy=new Set,Qy={};function Sr(t,e){bs(t,e),bs(t+"Capture",e)}function bs(t,e){for(Qy[t]=e,t=0;t<e.length;t++)Yy.add(e[t])}var Uw=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Wg={},ev={};function jw(t){return Wf.call(ev,t)?!0:Wf.call(Wg,t)?!1:Uw.test(t)?ev[t]=!0:(Wg[t]=!0,!1)}function rc(t,e,n){if(jw(e))if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":t.removeAttribute(e);return;case"boolean":var i=e.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){t.removeAttribute(e);return}}t.setAttribute(e,""+n)}}function jl(t,e,n){if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(e);return}t.setAttribute(e,""+n)}}function di(t,e,n,i){if(i===null)t.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttributeNS(e,n,""+i)}}function pn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Jy(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Bw(t,e,n){var i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e);if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var a=i.get,r=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return a.call(this)},set:function(s){n=""+s,r.call(this,s)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(s){n=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function th(t){if(!t._valueTracker){var e=Jy(t)?"checked":"value";t._valueTracker=Bw(t,e,""+t[e])}}function Xy(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=Jy(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function Fc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var qw=/[\n"\\]/g;function yn(t){return t.replace(qw,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function nh(t,e,n,i,a,r,s,o){t.name="",s!=null&&typeof s!="function"&&typeof s!="symbol"&&typeof s!="boolean"?t.type=s:t.removeAttribute("type"),e!=null?s==="number"?(e===0&&t.value===""||t.value!=e)&&(t.value=""+pn(e)):t.value!==""+pn(e)&&(t.value=""+pn(e)):s!=="submit"&&s!=="reset"||t.removeAttribute("value"),e!=null?ih(t,s,pn(e)):n!=null?ih(t,s,pn(n)):i!=null&&t.removeAttribute("value"),a==null&&r!=null&&(t.defaultChecked=!!r),a!=null&&(t.checked=a&&typeof a!="function"&&typeof a!="symbol"),o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"?t.name=""+pn(o):t.removeAttribute("name")}function $y(t,e,n,i,a,r,s,o){if(r!=null&&typeof r!="function"&&typeof r!="symbol"&&typeof r!="boolean"&&(t.type=r),e!=null||n!=null){if(!(r!=="submit"&&r!=="reset"||e!=null)){th(t);return}n=n!=null?""+pn(n):"",e=e!=null?""+pn(e):n,o||e===t.value||(t.value=e),t.defaultValue=e}i=i??a,i=typeof i!="function"&&typeof i!="symbol"&&!!i,t.checked=o?t.checked:!!i,t.defaultChecked=!!i,s!=null&&typeof s!="function"&&typeof s!="symbol"&&typeof s!="boolean"&&(t.name=s),th(t)}function ih(t,e,n){e==="number"&&Fc(t.ownerDocument)===t||t.defaultValue===""+n||(t.defaultValue=""+n)}function ts(t,e,n,i){if(t=t.options,e){e={};for(var a=0;a<n.length;a++)e["$"+n[a]]=!0;for(n=0;n<t.length;n++)a=e.hasOwnProperty("$"+t[n].value),t[n].selected!==a&&(t[n].selected=a),a&&i&&(t[n].defaultSelected=!0)}else{for(n=""+pn(n),e=null,a=0;a<t.length;a++){if(t[a].value===n){t[a].selected=!0,i&&(t[a].defaultSelected=!0);return}e!==null||t[a].disabled||(e=t[a])}e!==null&&(e.selected=!0)}}function Zy(t,e,n){if(e!=null&&(e=""+pn(e),e!==t.value&&(t.value=e),n==null)){t.defaultValue!==e&&(t.defaultValue=e);return}t.defaultValue=n!=null?""+pn(n):""}function Wy(t,e,n,i){if(e==null){if(i!=null){if(n!=null)throw Error(j(92));if(ho(i)){if(1<i.length)throw Error(j(93));i=i[0]}n=i}n==null&&(n=""),e=n}n=pn(e),t.defaultValue=n,i=t.textContent,i===n&&i!==""&&i!==null&&(t.value=i),th(t)}function ys(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var zw=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function tv(t,e,n){var i=e.indexOf("--")===0;n==null||typeof n=="boolean"||n===""?i?t.setProperty(e,""):e==="float"?t.cssFloat="":t[e]="":i?t.setProperty(e,n):typeof n!="number"||n===0||zw.has(e)?e==="float"?t.cssFloat=n:t[e]=(""+n).trim():t[e]=n+"px"}function eS(t,e,n){if(e!=null&&typeof e!="object")throw Error(j(62));if(t=t.style,n!=null){for(var i in n)!n.hasOwnProperty(i)||e!=null&&e.hasOwnProperty(i)||(i.indexOf("--")===0?t.setProperty(i,""):i==="float"?t.cssFloat="":t[i]="");for(var a in e)i=e[a],e.hasOwnProperty(a)&&n[a]!==i&&tv(t,a,i)}else for(var r in e)e.hasOwnProperty(r)&&tv(t,r,e[r])}function jm(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fw=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Vw=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function sc(t){return Vw.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function wi(){}var ah=null;function Bm(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Fr=null,ns=null;function nv(t){var e=Ls(t);if(e&&(t=e.stateNode)){var n=t[Kt]||null;e:switch(t=e.stateNode,e.type){case"input":if(nh(t,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+yn(""+e)+'"][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var a=i[Kt]||null;if(!a)throw Error(j(90));nh(i,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(e=0;e<n.length;e++)i=n[e],i.form===t.form&&Xy(i)}break e;case"textarea":Zy(t,n.value,n.defaultValue);break e;case"select":e=n.value,e!=null&&ts(t,!!n.multiple,e,!1)}}}var Od=!1;function tS(t,e,n){if(Od)return t(e,n);Od=!0;try{var i=t(e);return i}finally{if(Od=!1,(Fr!==null||ns!==null)&&(Xu(),Fr&&(e=Fr,t=ns,ns=Fr=null,nv(e),t)))for(e=0;e<t.length;e++)nv(t[e])}}function qo(t,e){var n=t.stateNode;if(n===null)return null;var i=n[Kt]||null;if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(j(231,e,typeof n));return n}var Pi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),rh=!1;if(Pi)try{var Qs={};Object.defineProperty(Qs,"passive",{get:function(){rh=!0}}),window.addEventListener("test",Qs,Qs),window.removeEventListener("test",Qs,Qs)}catch{rh=!1}var ca=null,qm=null,oc=null;function nS(){if(oc)return oc;var t,e=qm,n=e.length,i,a="value"in ca?ca.value:ca.textContent,r=a.length;for(t=0;t<n&&e[t]===a[t];t++);var s=n-t;for(i=1;i<=s&&e[n-i]===a[r-i];i++);return oc=a.slice(t,1<i?1-i:void 0)}function lc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Bl(){return!0}function iv(){return!1}function Yt(t){function e(n,i,a,r,s){this._reactName=n,this._targetInst=a,this.type=i,this.nativeEvent=r,this.target=s,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(r):r[o]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?Bl:iv,this.isPropagationStopped=iv,this}return Le(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Bl)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Bl)},persist:function(){},isPersistent:Bl}),e}var Tr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bu=Yt(Tr),vl=Le({},Tr,{view:0,detail:0}),Hw=Yt(vl),Ad,Md,Js,qu=Le({},vl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zm,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Js&&(Js&&t.type==="mousemove"?(Ad=t.screenX-Js.screenX,Md=t.screenY-Js.screenY):Md=Ad=0,Js=t),Ad)},movementY:function(t){return"movementY"in t?t.movementY:Md}}),av=Yt(qu),Kw=Le({},qu,{dataTransfer:0}),Gw=Yt(Kw),Yw=Le({},vl,{relatedTarget:0}),Dd=Yt(Yw),Qw=Le({},Tr,{animationName:0,elapsedTime:0,pseudoElement:0}),Jw=Yt(Qw),Xw=Le({},Tr,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),$w=Yt(Xw),Zw=Le({},Tr,{data:0}),rv=Yt(Zw),Ww={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function nR(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=tR[t])?!!e[t]:!1}function zm(){return nR}var iR=Le({},vl,{key:function(t){if(t.key){var e=Ww[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=lc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?eR[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zm,charCode:function(t){return t.type==="keypress"?lc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?lc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),aR=Yt(iR),rR=Le({},qu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sv=Yt(rR),sR=Le({},vl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zm}),oR=Yt(sR),lR=Le({},Tr,{propertyName:0,elapsedTime:0,pseudoElement:0}),cR=Yt(lR),uR=Le({},qu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),dR=Yt(uR),fR=Le({},Tr,{newState:0,oldState:0}),hR=Yt(fR),mR=[9,13,27,32],Fm=Pi&&"CompositionEvent"in window,Co=null;Pi&&"documentMode"in document&&(Co=document.documentMode);var pR=Pi&&"TextEvent"in window&&!Co,iS=Pi&&(!Fm||Co&&8<Co&&11>=Co),ov=" ",lv=!1;function aS(t,e){switch(t){case"keyup":return mR.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function rS(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Vr=!1;function gR(t,e){switch(t){case"compositionend":return rS(e);case"keypress":return e.which!==32?null:(lv=!0,ov);case"textInput":return t=e.data,t===ov&&lv?null:t;default:return null}}function vR(t,e){if(Vr)return t==="compositionend"||!Fm&&aS(t,e)?(t=nS(),oc=qm=ca=null,Vr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return iS&&e.locale!=="ko"?null:e.data;default:return null}}var bR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!bR[t.type]:e==="textarea"}function sS(t,e,n,i){Fr?ns?ns.push(i):ns=[i]:Fr=i,e=su(e,"onChange"),0<e.length&&(n=new Bu("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var ko=null,zo=null;function yR(t){tC(t,0)}function zu(t){var e=mo(t);if(Xy(e))return t}function uv(t,e){if(t==="change")return e}var oS=!1;if(Pi){var Pd;if(Pi){var Nd="oninput"in document;if(!Nd){var dv=document.createElement("div");dv.setAttribute("oninput","return;"),Nd=typeof dv.oninput=="function"}Pd=Nd}else Pd=!1;oS=Pd&&(!document.documentMode||9<document.documentMode)}function fv(){ko&&(ko.detachEvent("onpropertychange",lS),zo=ko=null)}function lS(t){if(t.propertyName==="value"&&zu(zo)){var e=[];sS(e,zo,t,Bm(t)),tS(yR,e)}}function SR(t,e,n){t==="focusin"?(fv(),ko=e,zo=n,ko.attachEvent("onpropertychange",lS)):t==="focusout"&&fv()}function TR(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return zu(zo)}function CR(t,e){if(t==="click")return zu(e)}function kR(t,e){if(t==="input"||t==="change")return zu(e)}function ER(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ln=typeof Object.is=="function"?Object.is:ER;function Fo(t,e){if(ln(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var a=n[i];if(!Wf.call(e,a)||!ln(t[a],e[a]))return!1}return!0}function hv(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function mv(t,e){var n=hv(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=hv(n)}}function cS(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?cS(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function uS(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var e=Fc(t.document);e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Fc(t.document)}return e}function Vm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var _R=Pi&&"documentMode"in document&&11>=document.documentMode,Hr=null,sh=null,Eo=null,oh=!1;function pv(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;oh||Hr==null||Hr!==Fc(i)||(i=Hr,"selectionStart"in i&&Vm(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Eo&&Fo(Eo,i)||(Eo=i,i=su(sh,"onSelect"),0<i.length&&(e=new Bu("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=Hr)))}function Ka(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Kr={animationend:Ka("Animation","AnimationEnd"),animationiteration:Ka("Animation","AnimationIteration"),animationstart:Ka("Animation","AnimationStart"),transitionrun:Ka("Transition","TransitionRun"),transitionstart:Ka("Transition","TransitionStart"),transitioncancel:Ka("Transition","TransitionCancel"),transitionend:Ka("Transition","TransitionEnd")},Ld={},dS={};Pi&&(dS=document.createElement("div").style,"AnimationEvent"in window||(delete Kr.animationend.animation,delete Kr.animationiteration.animation,delete Kr.animationstart.animation),"TransitionEvent"in window||delete Kr.transitionend.transition);function Cr(t){if(Ld[t])return Ld[t];if(!Kr[t])return t;var e=Kr[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in dS)return Ld[t]=e[n];return t}var fS=Cr("animationend"),hS=Cr("animationiteration"),mS=Cr("animationstart"),wR=Cr("transitionrun"),RR=Cr("transitionstart"),xR=Cr("transitioncancel"),pS=Cr("transitionend"),gS=new Map,lh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");lh.push("scrollEnd");function Vn(t,e){gS.set(t,e),Sr(e,[t])}var Vc=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},mn=[],Gr=0,Hm=0;function Fu(){for(var t=Gr,e=Hm=Gr=0;e<t;){var n=mn[e];mn[e++]=null;var i=mn[e];mn[e++]=null;var a=mn[e];mn[e++]=null;var r=mn[e];if(mn[e++]=null,i!==null&&a!==null){var s=i.pending;s===null?a.next=a:(a.next=s.next,s.next=a),i.pending=a}r!==0&&vS(n,a,r)}}function Vu(t,e,n,i){mn[Gr++]=t,mn[Gr++]=e,mn[Gr++]=n,mn[Gr++]=i,Hm|=i,t.lanes|=i,t=t.alternate,t!==null&&(t.lanes|=i)}function Km(t,e,n,i){return Vu(t,e,n,i),Hc(t)}function kr(t,e){return Vu(t,null,null,e),Hc(t)}function vS(t,e,n){t.lanes|=n;var i=t.alternate;i!==null&&(i.lanes|=n);for(var a=!1,r=t.return;r!==null;)r.childLanes|=n,i=r.alternate,i!==null&&(i.childLanes|=n),r.tag===22&&(t=r.stateNode,t===null||t._visibility&1||(a=!0)),t=r,r=r.return;return t.tag===3?(r=t.stateNode,a&&e!==null&&(a=31-rn(n),t=r.hiddenUpdates,i=t[a],i===null?t[a]=[e]:i.push(e),e.lane=n|536870912),r):null}function Hc(t){if(50<Po)throw Po=0,Oh=null,Error(j(185));for(var e=t.return;e!==null;)t=e,e=t.return;return t.tag===3?t.stateNode:null}var Yr={};function OR(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wt(t,e,n,i){return new OR(t,e,n,i)}function Gm(t){return t=t.prototype,!(!t||!t.isReactComponent)}function xi(t,e){var n=t.alternate;return n===null?(n=Wt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&65011712,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n.refCleanup=t.refCleanup,n}function bS(t,e){t.flags&=65011714;var n=t.alternate;return n===null?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,t.type=n.type,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function cc(t,e,n,i,a,r){var s=0;if(i=t,typeof t=="function")Gm(t)&&(s=1);else if(typeof t=="string")s=Nx(t,n,$n.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case Jf:return t=Wt(31,n,e,a),t.elementType=Jf,t.lanes=r,t;case Br:return tr(n.children,a,r,e);case Uy:s=8,a|=24;break;case Gf:return t=Wt(12,n,e,a|2),t.elementType=Gf,t.lanes=r,t;case Yf:return t=Wt(13,n,e,a),t.elementType=Yf,t.lanes=r,t;case Qf:return t=Wt(19,n,e,a),t.elementType=Qf,t.lanes=r,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case _i:s=10;break e;case jy:s=9;break e;case Dm:s=11;break e;case Pm:s=14;break e;case ea:s=16,i=null;break e}s=29,n=Error(j(130,t===null?"null":typeof t,"")),i=null}return e=Wt(s,n,e,a),e.elementType=t,e.type=i,e.lanes=r,e}function tr(t,e,n,i){return t=Wt(7,t,i,e),t.lanes=n,t}function Id(t,e,n){return t=Wt(6,t,null,e),t.lanes=n,t}function yS(t){var e=Wt(18,null,null,0);return e.stateNode=t,e}function Ud(t,e,n){return e=Wt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var gv=new WeakMap;function Sn(t,e){if(typeof t=="object"&&t!==null){var n=gv.get(t);return n!==void 0?n:(e={value:t,source:e,stack:Xg(e)},gv.set(t,e),e)}return{value:t,source:e,stack:Xg(e)}}var Qr=[],Jr=0,Kc=null,Vo=0,gn=[],vn=0,xa=null,Qn=1,Jn="";function bi(t,e){Qr[Jr++]=Vo,Qr[Jr++]=Kc,Kc=t,Vo=e}function SS(t,e,n){gn[vn++]=Qn,gn[vn++]=Jn,gn[vn++]=xa,xa=t;var i=Qn;t=Jn;var a=32-rn(i)-1;i&=~(1<<a),n+=1;var r=32-rn(e)+a;if(30<r){var s=a-a%5;r=(i&(1<<s)-1).toString(32),i>>=s,a-=s,Qn=1<<32-rn(e)+a|n<<a|i,Jn=r+t}else Qn=1<<r|n<<a|i,Jn=t}function Ym(t){t.return!==null&&(bi(t,1),SS(t,1,0))}function Qm(t){for(;t===Kc;)Kc=Qr[--Jr],Qr[Jr]=null,Vo=Qr[--Jr],Qr[Jr]=null;for(;t===xa;)xa=gn[--vn],gn[vn]=null,Jn=gn[--vn],gn[vn]=null,Qn=gn[--vn],gn[vn]=null}function TS(t,e){gn[vn++]=Qn,gn[vn++]=Jn,gn[vn++]=xa,Qn=e.id,Jn=e.overflow,xa=t}var yt=null,Pe=null,he=!1,va=null,Tn=!1,ch=Error(j(519));function Oa(t){var e=Error(j(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ho(Sn(e,t)),ch}function vv(t){var e=t.stateNode,n=t.type,i=t.memoizedProps;switch(e[bt]=t,e[Kt]=i,n){case"dialog":le("cancel",e),le("close",e);break;case"iframe":case"object":case"embed":le("load",e);break;case"video":case"audio":for(n=0;n<Qo.length;n++)le(Qo[n],e);break;case"source":le("error",e);break;case"img":case"image":case"link":le("error",e),le("load",e);break;case"details":le("toggle",e);break;case"input":le("invalid",e),$y(e,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0);break;case"select":le("invalid",e);break;case"textarea":le("invalid",e),Wy(e,i.value,i.defaultValue,i.children)}n=i.children,typeof n!="string"&&typeof n!="number"&&typeof n!="bigint"||e.textContent===""+n||i.suppressHydrationWarning===!0||iC(e.textContent,n)?(i.popover!=null&&(le("beforetoggle",e),le("toggle",e)),i.onScroll!=null&&le("scroll",e),i.onScrollEnd!=null&&le("scrollend",e),i.onClick!=null&&(e.onclick=wi),e=!0):e=!1,e||Oa(t,!0)}function bv(t){for(yt=t.return;yt;)switch(yt.tag){case 5:case 31:case 13:Tn=!1;return;case 27:case 3:Tn=!0;return;default:yt=yt.return}}function Dr(t){if(t!==yt)return!1;if(!he)return bv(t),he=!0,!1;var e=t.tag,n;if((n=e!==3&&e!==27)&&((n=e===5)&&(n=t.type,n=!(n!=="form"&&n!=="button")||Nh(t.type,t.memoizedProps)),n=!n),n&&Pe&&Oa(t),bv(t),e===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(j(317));Pe=a0(t)}else if(e===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(j(317));Pe=a0(t)}else e===27?(e=Pe,Ua(t.type)?(t=jh,jh=null,Pe=t):Pe=e):Pe=yt?_n(t.stateNode.nextSibling):null;return!0}function lr(){Pe=yt=null,he=!1}function jd(){var t=va;return t!==null&&(zt===null?zt=t:zt.push.apply(zt,t),va=null),t}function Ho(t){va===null?va=[t]:va.push(t)}var uh=ai(null),Er=null,Ri=null;function ia(t,e,n){Me(uh,e._currentValue),e._currentValue=n}function Oi(t){t._currentValue=uh.current,pt(uh)}function dh(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function fh(t,e,n,i){var a=t.child;for(a!==null&&(a.return=t);a!==null;){var r=a.dependencies;if(r!==null){var s=a.child;r=r.firstContext;e:for(;r!==null;){var o=r;r=a;for(var l=0;l<e.length;l++)if(o.context===e[l]){r.lanes|=n,o=r.alternate,o!==null&&(o.lanes|=n),dh(r.return,n,t),i||(s=null);break e}r=o.next}}else if(a.tag===18){if(s=a.return,s===null)throw Error(j(341));s.lanes|=n,r=s.alternate,r!==null&&(r.lanes|=n),dh(s,n,t),s=null}else s=a.child;if(s!==null)s.return=a;else for(s=a;s!==null;){if(s===t){s=null;break}if(a=s.sibling,a!==null){a.return=s.return,s=a;break}s=s.return}a=s}}function Is(t,e,n,i){t=null;for(var a=e,r=!1;a!==null;){if(!r){if(a.flags&524288)r=!0;else if(a.flags&262144)break}if(a.tag===10){var s=a.alternate;if(s===null)throw Error(j(387));if(s=s.memoizedProps,s!==null){var o=a.type;ln(a.pendingProps.value,s.value)||(t!==null?t.push(o):t=[o])}}else if(a===jc.current){if(s=a.alternate,s===null)throw Error(j(387));s.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(t!==null?t.push(Xo):t=[Xo])}a=a.return}t!==null&&fh(e,t,n,i),e.flags|=262144}function Gc(t){for(t=t.firstContext;t!==null;){if(!ln(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function cr(t){Er=t,Ri=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function St(t){return CS(Er,t)}function ql(t,e){return Er===null&&cr(t),CS(t,e)}function CS(t,e){var n=e._currentValue;if(e={context:e,memoizedValue:n,next:null},Ri===null){if(t===null)throw Error(j(308));Ri=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else Ri=Ri.next=e;return n}var AR=typeof AbortController<"u"?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(n,i){t.push(i)}};this.abort=function(){e.aborted=!0,t.forEach(function(n){return n()})}},MR=lt.unstable_scheduleCallback,DR=lt.unstable_NormalPriority,it={$$typeof:_i,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Jm(){return{controller:new AR,data:new Map,refCount:0}}function bl(t){t.refCount--,t.refCount===0&&MR(DR,function(){t.controller.abort()})}var _o=null,hh=0,Ss=0,is=null;function PR(t,e){if(_o===null){var n=_o=[];hh=0,Ss=Sp(),is={status:"pending",value:void 0,then:function(i){n.push(i)}}}return hh++,e.then(yv,yv),e}function yv(){if(--hh===0&&_o!==null){is!==null&&(is.status="fulfilled");var t=_o;_o=null,Ss=0,is=null;for(var e=0;e<t.length;e++)(0,t[e])()}}function NR(t,e){var n=[],i={status:"pending",value:null,reason:null,then:function(a){n.push(a)}};return t.then(function(){i.status="fulfilled",i.value=e;for(var a=0;a<n.length;a++)(0,n[a])(e)},function(a){for(i.status="rejected",i.reason=a,a=0;a<n.length;a++)(0,n[a])(void 0)}),i}var Sv=ee.S;ee.S=function(t,e){IT=nn(),typeof e=="object"&&e!==null&&typeof e.then=="function"&&PR(t,e),Sv!==null&&Sv(t,e)};var nr=ai(null);function Xm(){var t=nr.current;return t!==null?t:Ae.pooledCache}function uc(t,e){e===null?Me(nr,nr.current):Me(nr,e.pool)}function kS(){var t=Xm();return t===null?null:{parent:it._currentValue,pool:t}}var Us=Error(j(460)),$m=Error(j(474)),Hu=Error(j(542)),Yc={then:function(){}};function Tv(t){return t=t.status,t==="fulfilled"||t==="rejected"}function ES(t,e,n){switch(n=t[n],n===void 0?t.push(e):n!==e&&(e.then(wi,wi),e=n),e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,kv(t),t;default:if(typeof e.status=="string")e.then(wi,wi);else{if(t=Ae,t!==null&&100<t.shellSuspendCounter)throw Error(j(482));t=e,t.status="pending",t.then(function(i){if(e.status==="pending"){var a=e;a.status="fulfilled",a.value=i}},function(i){if(e.status==="pending"){var a=e;a.status="rejected",a.reason=i}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,kv(t),t}throw ir=e,Us}}function Ja(t){try{var e=t._init;return e(t._payload)}catch(n){throw n!==null&&typeof n=="object"&&typeof n.then=="function"?(ir=n,Us):n}}var ir=null;function Cv(){if(ir===null)throw Error(j(459));var t=ir;return ir=null,t}function kv(t){if(t===Us||t===Hu)throw Error(j(483))}var as=null,Ko=0;function zl(t){var e=Ko;return Ko+=1,as===null&&(as=[]),ES(as,t,e)}function Xs(t,e){e=e.props.ref,t.ref=e!==void 0?e:null}function Fl(t,e){throw e.$$typeof===Sw?Error(j(525)):(t=Object.prototype.toString.call(e),Error(j(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)))}function _S(t){function e(m,b){if(t){var S=m.deletions;S===null?(m.deletions=[b],m.flags|=16):S.push(b)}}function n(m,b){if(!t)return null;for(;b!==null;)e(m,b),b=b.sibling;return null}function i(m){for(var b=new Map;m!==null;)m.key!==null?b.set(m.key,m):b.set(m.index,m),m=m.sibling;return b}function a(m,b){return m=xi(m,b),m.index=0,m.sibling=null,m}function r(m,b,S){return m.index=S,t?(S=m.alternate,S!==null?(S=S.index,S<b?(m.flags|=67108866,b):S):(m.flags|=67108866,b)):(m.flags|=1048576,b)}function s(m){return t&&m.alternate===null&&(m.flags|=67108866),m}function o(m,b,S,p){return b===null||b.tag!==6?(b=Id(S,m.mode,p),b.return=m,b):(b=a(b,S),b.return=m,b)}function l(m,b,S,p){var y=S.type;return y===Br?u(m,b,S.props.children,p,S.key):b!==null&&(b.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===ea&&Ja(y)===b.type)?(b=a(b,S.props),Xs(b,S),b.return=m,b):(b=cc(S.type,S.key,S.props,null,m.mode,p),Xs(b,S),b.return=m,b)}function c(m,b,S,p){return b===null||b.tag!==4||b.stateNode.containerInfo!==S.containerInfo||b.stateNode.implementation!==S.implementation?(b=Ud(S,m.mode,p),b.return=m,b):(b=a(b,S.children||[]),b.return=m,b)}function u(m,b,S,p,y){return b===null||b.tag!==7?(b=tr(S,m.mode,p,y),b.return=m,b):(b=a(b,S),b.return=m,b)}function d(m,b,S){if(typeof b=="string"&&b!==""||typeof b=="number"||typeof b=="bigint")return b=Id(""+b,m.mode,S),b.return=m,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Nl:return S=cc(b.type,b.key,b.props,null,m.mode,S),Xs(S,b),S.return=m,S;case fo:return b=Ud(b,m.mode,S),b.return=m,b;case ea:return b=Ja(b),d(m,b,S)}if(ho(b)||Ys(b))return b=tr(b,m.mode,S,null),b.return=m,b;if(typeof b.then=="function")return d(m,zl(b),S);if(b.$$typeof===_i)return d(m,ql(m,b),S);Fl(m,b)}return null}function f(m,b,S,p){var y=b!==null?b.key:null;if(typeof S=="string"&&S!==""||typeof S=="number"||typeof S=="bigint")return y!==null?null:o(m,b,""+S,p);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Nl:return S.key===y?l(m,b,S,p):null;case fo:return S.key===y?c(m,b,S,p):null;case ea:return S=Ja(S),f(m,b,S,p)}if(ho(S)||Ys(S))return y!==null?null:u(m,b,S,p,null);if(typeof S.then=="function")return f(m,b,zl(S),p);if(S.$$typeof===_i)return f(m,b,ql(m,S),p);Fl(m,S)}return null}function h(m,b,S,p,y){if(typeof p=="string"&&p!==""||typeof p=="number"||typeof p=="bigint")return m=m.get(S)||null,o(b,m,""+p,y);if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Nl:return m=m.get(p.key===null?S:p.key)||null,l(b,m,p,y);case fo:return m=m.get(p.key===null?S:p.key)||null,c(b,m,p,y);case ea:return p=Ja(p),h(m,b,S,p,y)}if(ho(p)||Ys(p))return m=m.get(S)||null,u(b,m,p,y,null);if(typeof p.then=="function")return h(m,b,S,zl(p),y);if(p.$$typeof===_i)return h(m,b,S,ql(b,p),y);Fl(b,p)}return null}function v(m,b,S,p){for(var y=null,k=null,_=b,O=b=0,w=null;_!==null&&O<S.length;O++){_.index>O?(w=_,_=null):w=_.sibling;var R=f(m,_,S[O],p);if(R===null){_===null&&(_=w);break}t&&_&&R.alternate===null&&e(m,_),b=r(R,b,O),k===null?y=R:k.sibling=R,k=R,_=w}if(O===S.length)return n(m,_),he&&bi(m,O),y;if(_===null){for(;O<S.length;O++)_=d(m,S[O],p),_!==null&&(b=r(_,b,O),k===null?y=_:k.sibling=_,k=_);return he&&bi(m,O),y}for(_=i(_);O<S.length;O++)w=h(_,m,O,S[O],p),w!==null&&(t&&w.alternate!==null&&_.delete(w.key===null?O:w.key),b=r(w,b,O),k===null?y=w:k.sibling=w,k=w);return t&&_.forEach(function(N){return e(m,N)}),he&&bi(m,O),y}function g(m,b,S,p){if(S==null)throw Error(j(151));for(var y=null,k=null,_=b,O=b=0,w=null,R=S.next();_!==null&&!R.done;O++,R=S.next()){_.index>O?(w=_,_=null):w=_.sibling;var N=f(m,_,R.value,p);if(N===null){_===null&&(_=w);break}t&&_&&N.alternate===null&&e(m,_),b=r(N,b,O),k===null?y=N:k.sibling=N,k=N,_=w}if(R.done)return n(m,_),he&&bi(m,O),y;if(_===null){for(;!R.done;O++,R=S.next())R=d(m,R.value,p),R!==null&&(b=r(R,b,O),k===null?y=R:k.sibling=R,k=R);return he&&bi(m,O),y}for(_=i(_);!R.done;O++,R=S.next())R=h(_,m,O,R.value,p),R!==null&&(t&&R.alternate!==null&&_.delete(R.key===null?O:R.key),b=r(R,b,O),k===null?y=R:k.sibling=R,k=R);return t&&_.forEach(function(z){return e(m,z)}),he&&bi(m,O),y}function C(m,b,S,p){if(typeof S=="object"&&S!==null&&S.type===Br&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case Nl:e:{for(var y=S.key;b!==null;){if(b.key===y){if(y=S.type,y===Br){if(b.tag===7){n(m,b.sibling),p=a(b,S.props.children),p.return=m,m=p;break e}}else if(b.elementType===y||typeof y=="object"&&y!==null&&y.$$typeof===ea&&Ja(y)===b.type){n(m,b.sibling),p=a(b,S.props),Xs(p,S),p.return=m,m=p;break e}n(m,b);break}else e(m,b);b=b.sibling}S.type===Br?(p=tr(S.props.children,m.mode,p,S.key),p.return=m,m=p):(p=cc(S.type,S.key,S.props,null,m.mode,p),Xs(p,S),p.return=m,m=p)}return s(m);case fo:e:{for(y=S.key;b!==null;){if(b.key===y)if(b.tag===4&&b.stateNode.containerInfo===S.containerInfo&&b.stateNode.implementation===S.implementation){n(m,b.sibling),p=a(b,S.children||[]),p.return=m,m=p;break e}else{n(m,b);break}else e(m,b);b=b.sibling}p=Ud(S,m.mode,p),p.return=m,m=p}return s(m);case ea:return S=Ja(S),C(m,b,S,p)}if(ho(S))return v(m,b,S,p);if(Ys(S)){if(y=Ys(S),typeof y!="function")throw Error(j(150));return S=y.call(S),g(m,b,S,p)}if(typeof S.then=="function")return C(m,b,zl(S),p);if(S.$$typeof===_i)return C(m,b,ql(m,S),p);Fl(m,S)}return typeof S=="string"&&S!==""||typeof S=="number"||typeof S=="bigint"?(S=""+S,b!==null&&b.tag===6?(n(m,b.sibling),p=a(b,S),p.return=m,m=p):(n(m,b),p=Id(S,m.mode,p),p.return=m,m=p),s(m)):n(m,b)}return function(m,b,S,p){try{Ko=0;var y=C(m,b,S,p);return as=null,y}catch(_){if(_===Us||_===Hu)throw _;var k=Wt(29,_,null,m.mode);return k.lanes=p,k.return=m,k}finally{}}}var ur=_S(!0),wS=_S(!1),ta=!1;function Zm(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function mh(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function ba(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function ya(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,be&2){var a=i.pending;return a===null?e.next=e:(e.next=a.next,a.next=e),i.pending=e,e=Hc(t),vS(t,null,n),e}return Vu(t,i,e,n),Hc(t)}function wo(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194048)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Hy(t,n)}}function Bd(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var a=null,r=null;if(n=n.firstBaseUpdate,n!==null){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};r===null?a=r=s:r=r.next=s,n=n.next}while(n!==null);r===null?a=r=e:r=r.next=e}else a=r=e;n={baseState:i.baseState,firstBaseUpdate:a,lastBaseUpdate:r,shared:i.shared,callbacks:i.callbacks},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}var ph=!1;function Ro(){if(ph){var t=is;if(t!==null)throw t}}function xo(t,e,n,i){ph=!1;var a=t.updateQueue;ta=!1;var r=a.firstBaseUpdate,s=a.lastBaseUpdate,o=a.shared.pending;if(o!==null){a.shared.pending=null;var l=o,c=l.next;l.next=null,s===null?r=c:s.next=c,s=l;var u=t.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==s&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(r!==null){var d=a.baseState;s=0,u=c=l=null,o=r;do{var f=o.lane&-536870913,h=f!==o.lane;if(h?(de&f)===f:(i&f)===f){f!==0&&f===Ss&&(ph=!0),u!==null&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var v=t,g=o;f=e;var C=n;switch(g.tag){case 1:if(v=g.payload,typeof v=="function"){d=v.call(C,d,f);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=g.payload,f=typeof v=="function"?v.call(C,d,f):v,f==null)break e;d=Le({},d,f);break e;case 2:ta=!0}}f=o.callback,f!==null&&(t.flags|=64,h&&(t.flags|=8192),h=a.callbacks,h===null?a.callbacks=[f]:h.push(f))}else h={lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=h,l=d):u=u.next=h,s|=f;if(o=o.next,o===null){if(o=a.shared.pending,o===null)break;h=o,o=h.next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}while(!0);u===null&&(l=d),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,r===null&&(a.shared.lanes=0),Ma|=s,t.lanes=s,t.memoizedState=d}}function RS(t,e){if(typeof t!="function")throw Error(j(191,t));t.call(e)}function xS(t,e){var n=t.callbacks;if(n!==null)for(t.callbacks=null,t=0;t<n.length;t++)RS(n[t],e)}var Ts=ai(null),Qc=ai(0);function Ev(t,e){t=Ui,Me(Qc,t),Me(Ts,e),Ui=t|e.baseLanes}function gh(){Me(Qc,Ui),Me(Ts,Ts.current)}function Wm(){Ui=Qc.current,pt(Ts),pt(Qc)}var cn=ai(null),En=null;function aa(t){var e=t.alternate;Me($e,$e.current&1),Me(cn,t),En===null&&(e===null||Ts.current!==null||e.memoizedState!==null)&&(En=t)}function vh(t){Me($e,$e.current),Me(cn,t),En===null&&(En=t)}function OS(t){t.tag===22?(Me($e,$e.current),Me(cn,t),En===null&&(En=t)):ra()}function ra(){Me($e,$e.current),Me(cn,cn.current)}function Zt(t){pt(cn),En===t&&(En=null),pt($e)}var $e=ai(0);function Jc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||Ih(n)||Uh(n)))return e}else if(e.tag===19&&(e.memoizedProps.revealOrder==="forwards"||e.memoizedProps.revealOrder==="backwards"||e.memoizedProps.revealOrder==="unstable_legacy-backwards"||e.memoizedProps.revealOrder==="together")){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ni=0,ie=null,Re=null,tt=null,Xc=!1,rs=!1,dr=!1,$c=0,Go=0,ss=null,LR=0;function ze(){throw Error(j(321))}function ep(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ln(t[n],e[n]))return!1;return!0}function tp(t,e,n,i,a,r){return Ni=r,ie=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ee.H=t===null||t.memoizedState===null?sT:fp,dr=!1,r=n(i,a),dr=!1,rs&&(r=MS(e,n,i,a)),AS(t),r}function AS(t){ee.H=Yo;var e=Re!==null&&Re.next!==null;if(Ni=0,tt=Re=ie=null,Xc=!1,Go=0,ss=null,e)throw Error(j(300));t===null||at||(t=t.dependencies,t!==null&&Gc(t)&&(at=!0))}function MS(t,e,n,i){ie=t;var a=0;do{if(rs&&(ss=null),Go=0,rs=!1,25<=a)throw Error(j(301));if(a+=1,tt=Re=null,t.updateQueue!=null){var r=t.updateQueue;r.lastEffect=null,r.events=null,r.stores=null,r.memoCache!=null&&(r.memoCache.index=0)}ee.H=oT,r=e(n,i)}while(rs);return r}function IR(){var t=ee.H,e=t.useState()[0];return e=typeof e.then=="function"?yl(e):e,t=t.useState()[0],(Re!==null?Re.memoizedState:null)!==t&&(ie.flags|=1024),e}function np(){var t=$c!==0;return $c=0,t}function ip(t,e,n){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n}function ap(t){if(Xc){for(t=t.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}Xc=!1}Ni=0,tt=Re=ie=null,rs=!1,Go=$c=0,ss=null}function Ot(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return tt===null?ie.memoizedState=tt=t:tt=tt.next=t,tt}function Ze(){if(Re===null){var t=ie.alternate;t=t!==null?t.memoizedState:null}else t=Re.next;var e=tt===null?ie.memoizedState:tt.next;if(e!==null)tt=e,Re=t;else{if(t===null)throw ie.alternate===null?Error(j(467)):Error(j(310));Re=t,t={memoizedState:Re.memoizedState,baseState:Re.baseState,baseQueue:Re.baseQueue,queue:Re.queue,next:null},tt===null?ie.memoizedState=tt=t:tt=tt.next=t}return tt}function Ku(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function yl(t){var e=Go;return Go+=1,ss===null&&(ss=[]),t=ES(ss,t,e),e=ie,(tt===null?e.memoizedState:tt.next)===null&&(e=e.alternate,ee.H=e===null||e.memoizedState===null?sT:fp),t}function Gu(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return yl(t);if(t.$$typeof===_i)return St(t)}throw Error(j(438,String(t)))}function rp(t){var e=null,n=ie.updateQueue;if(n!==null&&(e=n.memoCache),e==null){var i=ie.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(e={data:i.data.map(function(a){return a.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),n===null&&(n=Ku(),ie.updateQueue=n),n.memoCache=e,n=e.data[e.index],n===void 0)for(n=e.data[e.index]=Array(t),i=0;i<t;i++)n[i]=Tw;return e.index++,n}function Li(t,e){return typeof e=="function"?e(t):e}function dc(t){var e=Ze();return sp(e,Re,t)}function sp(t,e,n){var i=t.queue;if(i===null)throw Error(j(311));i.lastRenderedReducer=n;var a=t.baseQueue,r=i.pending;if(r!==null){if(a!==null){var s=a.next;a.next=r.next,r.next=s}e.baseQueue=a=r,i.pending=null}if(r=t.baseState,a===null)t.memoizedState=r;else{e=a.next;var o=s=null,l=null,c=e,u=!1;do{var d=c.lane&-536870913;if(d!==c.lane?(de&d)===d:(Ni&d)===d){var f=c.revertLane;if(f===0)l!==null&&(l=l.next={lane:0,revertLane:0,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===Ss&&(u=!0);else if((Ni&f)===f){c=c.next,f===Ss&&(u=!0);continue}else d={lane:0,revertLane:c.revertLane,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},l===null?(o=l=d,s=r):l=l.next=d,ie.lanes|=f,Ma|=f;d=c.action,dr&&n(r,d),r=c.hasEagerState?c.eagerState:n(r,d)}else f={lane:d,revertLane:c.revertLane,gesture:c.gesture,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},l===null?(o=l=f,s=r):l=l.next=f,ie.lanes|=d,Ma|=d;c=c.next}while(c!==null&&c!==e);if(l===null?s=r:l.next=o,!ln(r,t.memoizedState)&&(at=!0,u&&(n=is,n!==null)))throw n;t.memoizedState=r,t.baseState=s,t.baseQueue=l,i.lastRenderedState=r}return a===null&&(i.lanes=0),[t.memoizedState,i.dispatch]}function qd(t){var e=Ze(),n=e.queue;if(n===null)throw Error(j(311));n.lastRenderedReducer=t;var i=n.dispatch,a=n.pending,r=e.memoizedState;if(a!==null){n.pending=null;var s=a=a.next;do r=t(r,s.action),s=s.next;while(s!==a);ln(r,e.memoizedState)||(at=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),n.lastRenderedState=r}return[r,i]}function DS(t,e,n){var i=ie,a=Ze(),r=he;if(r){if(n===void 0)throw Error(j(407));n=n()}else n=e();var s=!ln((Re||a).memoizedState,n);if(s&&(a.memoizedState=n,at=!0),a=a.queue,op(LS.bind(null,i,a,t),[t]),a.getSnapshot!==e||s||tt!==null&&tt.memoizedState.tag&1){if(i.flags|=2048,Cs(9,{destroy:void 0},NS.bind(null,i,a,n,e),null),Ae===null)throw Error(j(349));r||Ni&127||PS(i,e,n)}return n}function PS(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ie.updateQueue,e===null?(e=Ku(),ie.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function NS(t,e,n,i){e.value=n,e.getSnapshot=i,IS(e)&&US(t)}function LS(t,e,n){return n(function(){IS(e)&&US(t)})}function IS(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ln(t,n)}catch{return!0}}function US(t){var e=kr(t,2);e!==null&&Ht(e,t,2)}function bh(t){var e=Ot();if(typeof t=="function"){var n=t;if(t=n(),dr){la(!0);try{n()}finally{la(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Li,lastRenderedState:t},e}function jS(t,e,n,i){return t.baseState=n,sp(t,Re,typeof i=="function"?i:Li)}function UR(t,e,n,i,a){if(Qu(t))throw Error(j(485));if(t=e.action,t!==null){var r={payload:a,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(s){r.listeners.push(s)}};ee.T!==null?n(!0):r.isTransition=!1,i(r),n=e.pending,n===null?(r.next=e.pending=r,BS(e,r)):(r.next=n.next,e.pending=n.next=r)}}function BS(t,e){var n=e.action,i=e.payload,a=t.state;if(e.isTransition){var r=ee.T,s={};ee.T=s;try{var o=n(a,i),l=ee.S;l!==null&&l(s,o),_v(t,e,o)}catch(c){yh(t,e,c)}finally{r!==null&&s.types!==null&&(r.types=s.types),ee.T=r}}else try{r=n(a,i),_v(t,e,r)}catch(c){yh(t,e,c)}}function _v(t,e,n){n!==null&&typeof n=="object"&&typeof n.then=="function"?n.then(function(i){wv(t,e,i)},function(i){return yh(t,e,i)}):wv(t,e,n)}function wv(t,e,n){e.status="fulfilled",e.value=n,qS(e),t.state=n,e=t.pending,e!==null&&(n=e.next,n===e?t.pending=null:(n=n.next,e.next=n,BS(t,n)))}function yh(t,e,n){var i=t.pending;if(t.pending=null,i!==null){i=i.next;do e.status="rejected",e.reason=n,qS(e),e=e.next;while(e!==i)}t.action=null}function qS(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function zS(t,e){return e}function Rv(t,e){if(he){var n=Ae.formState;if(n!==null){e:{var i=ie;if(he){if(Pe){t:{for(var a=Pe,r=Tn;a.nodeType!==8;){if(!r){a=null;break t}if(a=_n(a.nextSibling),a===null){a=null;break t}}r=a.data,a=r==="F!"||r==="F"?a:null}if(a){Pe=_n(a.nextSibling),i=a.data==="F!";break e}}Oa(i)}i=!1}i&&(e=n[0])}}return n=Ot(),n.memoizedState=n.baseState=e,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:zS,lastRenderedState:e},n.queue=i,n=iT.bind(null,ie,i),i.dispatch=n,i=bh(!1),r=dp.bind(null,ie,!1,i.queue),i=Ot(),a={state:e,dispatch:null,action:t,pending:null},i.queue=a,n=UR.bind(null,ie,a,r,n),a.dispatch=n,i.memoizedState=t,[e,n,!1]}function xv(t){var e=Ze();return FS(e,Re,t)}function FS(t,e,n){if(e=sp(t,e,zS)[0],t=dc(Li)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var i=yl(e)}catch(s){throw s===Us?Hu:s}else i=e;e=Ze();var a=e.queue,r=a.dispatch;return n!==e.memoizedState&&(ie.flags|=2048,Cs(9,{destroy:void 0},jR.bind(null,a,n),null)),[i,r,t]}function jR(t,e){t.action=e}function Ov(t){var e=Ze(),n=Re;if(n!==null)return FS(e,n,t);Ze(),e=e.memoizedState,n=Ze();var i=n.queue.dispatch;return n.memoizedState=t,[e,i,!1]}function Cs(t,e,n,i){return t={tag:t,create:n,deps:i,inst:e,next:null},e=ie.updateQueue,e===null&&(e=Ku(),ie.updateQueue=e),n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function VS(){return Ze().memoizedState}function fc(t,e,n,i){var a=Ot();ie.flags|=t,a.memoizedState=Cs(1|e,{destroy:void 0},n,i===void 0?null:i)}function Yu(t,e,n,i){var a=Ze();i=i===void 0?null:i;var r=a.memoizedState.inst;Re!==null&&i!==null&&ep(i,Re.memoizedState.deps)?a.memoizedState=Cs(e,r,n,i):(ie.flags|=t,a.memoizedState=Cs(1|e,r,n,i))}function Av(t,e){fc(8390656,8,t,e)}function op(t,e){Yu(2048,8,t,e)}function BR(t){ie.flags|=4;var e=ie.updateQueue;if(e===null)e=Ku(),ie.updateQueue=e,e.events=[t];else{var n=e.events;n===null?e.events=[t]:n.push(t)}}function HS(t){var e=Ze().memoizedState;return BR({ref:e,nextImpl:t}),function(){if(be&2)throw Error(j(440));return e.impl.apply(void 0,arguments)}}function KS(t,e){return Yu(4,2,t,e)}function GS(t,e){return Yu(4,4,t,e)}function YS(t,e){if(typeof e=="function"){t=t();var n=e(t);return function(){typeof n=="function"?n():e(null)}}if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function QS(t,e,n){n=n!=null?n.concat([t]):null,Yu(4,4,YS.bind(null,e,t),n)}function lp(){}function JS(t,e){var n=Ze();e=e===void 0?null:e;var i=n.memoizedState;return e!==null&&ep(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function XS(t,e){var n=Ze();e=e===void 0?null:e;var i=n.memoizedState;if(e!==null&&ep(e,i[1]))return i[0];if(i=t(),dr){la(!0);try{t()}finally{la(!1)}}return n.memoizedState=[i,e],i}function cp(t,e,n){return n===void 0||Ni&1073741824&&!(de&261930)?t.memoizedState=e:(t.memoizedState=n,t=jT(),ie.lanes|=t,Ma|=t,n)}function $S(t,e,n,i){return ln(n,e)?n:Ts.current!==null?(t=cp(t,n,i),ln(t,e)||(at=!0),t):!(Ni&42)||Ni&1073741824&&!(de&261930)?(at=!0,t.memoizedState=n):(t=jT(),ie.lanes|=t,Ma|=t,e)}function ZS(t,e,n,i,a){var r=ye.p;ye.p=r!==0&&8>r?r:8;var s=ee.T,o={};ee.T=o,dp(t,!1,e,n);try{var l=a(),c=ee.S;if(c!==null&&c(o,l),l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=NR(l,i);Oo(t,e,u,sn(t))}else Oo(t,e,i,sn(t))}catch(d){Oo(t,e,{then:function(){},status:"rejected",reason:d},sn())}finally{ye.p=r,s!==null&&o.types!==null&&(s.types=o.types),ee.T=s}}function qR(){}function Sh(t,e,n,i){if(t.tag!==5)throw Error(j(476));var a=WS(t).queue;ZS(t,a,e,er,n===null?qR:function(){return eT(t),n(i)})}function WS(t){var e=t.memoizedState;if(e!==null)return e;e={memoizedState:er,baseState:er,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Li,lastRenderedState:er},next:null};var n={};return e.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Li,lastRenderedState:n},next:null},t.memoizedState=e,t=t.alternate,t!==null&&(t.memoizedState=e),e}function eT(t){var e=WS(t);e.next===null&&(e=t.alternate.memoizedState),Oo(t,e.next.queue,{},sn())}function up(){return St(Xo)}function tT(){return Ze().memoizedState}function nT(){return Ze().memoizedState}function zR(t){for(var e=t.return;e!==null;){switch(e.tag){case 24:case 3:var n=sn();t=ba(n);var i=ya(e,t,n);i!==null&&(Ht(i,e,n),wo(i,e,n)),e={cache:Jm()},t.payload=e;return}e=e.return}}function FR(t,e,n){var i=sn();n={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},Qu(t)?aT(e,n):(n=Km(t,e,n,i),n!==null&&(Ht(n,t,i),rT(n,e,i)))}function iT(t,e,n){var i=sn();Oo(t,e,n,i)}function Oo(t,e,n,i){var a={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qu(t))aT(e,a);else{var r=t.alternate;if(t.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var s=e.lastRenderedState,o=r(s,n);if(a.hasEagerState=!0,a.eagerState=o,ln(o,s))return Vu(t,e,a,0),Ae===null&&Fu(),!1}catch{}finally{}if(n=Km(t,e,a,i),n!==null)return Ht(n,t,i),rT(n,e,i),!0}return!1}function dp(t,e,n,i){if(i={lane:2,revertLane:Sp(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},Qu(t)){if(e)throw Error(j(479))}else e=Km(t,n,i,2),e!==null&&Ht(e,t,2)}function Qu(t){var e=t.alternate;return t===ie||e!==null&&e===ie}function aT(t,e){rs=Xc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function rT(t,e,n){if(n&4194048){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,Hy(t,n)}}var Yo={readContext:St,use:Gu,useCallback:ze,useContext:ze,useEffect:ze,useImperativeHandle:ze,useLayoutEffect:ze,useInsertionEffect:ze,useMemo:ze,useReducer:ze,useRef:ze,useState:ze,useDebugValue:ze,useDeferredValue:ze,useTransition:ze,useSyncExternalStore:ze,useId:ze,useHostTransitionStatus:ze,useFormState:ze,useActionState:ze,useOptimistic:ze,useMemoCache:ze,useCacheRefresh:ze};Yo.useEffectEvent=ze;var sT={readContext:St,use:Gu,useCallback:function(t,e){return Ot().memoizedState=[t,e===void 0?null:e],t},useContext:St,useEffect:Av,useImperativeHandle:function(t,e,n){n=n!=null?n.concat([t]):null,fc(4194308,4,YS.bind(null,e,t),n)},useLayoutEffect:function(t,e){return fc(4194308,4,t,e)},useInsertionEffect:function(t,e){fc(4,2,t,e)},useMemo:function(t,e){var n=Ot();e=e===void 0?null:e;var i=t();if(dr){la(!0);try{t()}finally{la(!1)}}return n.memoizedState=[i,e],i},useReducer:function(t,e,n){var i=Ot();if(n!==void 0){var a=n(e);if(dr){la(!0);try{n(e)}finally{la(!1)}}}else a=e;return i.memoizedState=i.baseState=a,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:a},i.queue=t,t=t.dispatch=FR.bind(null,ie,t),[i.memoizedState,t]},useRef:function(t){var e=Ot();return t={current:t},e.memoizedState=t},useState:function(t){t=bh(t);var e=t.queue,n=iT.bind(null,ie,e);return e.dispatch=n,[t.memoizedState,n]},useDebugValue:lp,useDeferredValue:function(t,e){var n=Ot();return cp(n,t,e)},useTransition:function(){var t=bh(!1);return t=ZS.bind(null,ie,t.queue,!0,!1),Ot().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,n){var i=ie,a=Ot();if(he){if(n===void 0)throw Error(j(407));n=n()}else{if(n=e(),Ae===null)throw Error(j(349));de&127||PS(i,e,n)}a.memoizedState=n;var r={value:n,getSnapshot:e};return a.queue=r,Av(LS.bind(null,i,r,t),[t]),i.flags|=2048,Cs(9,{destroy:void 0},NS.bind(null,i,r,n,e),null),n},useId:function(){var t=Ot(),e=Ae.identifierPrefix;if(he){var n=Jn,i=Qn;n=(i&~(1<<32-rn(i)-1)).toString(32)+n,e="_"+e+"R_"+n,n=$c++,0<n&&(e+="H"+n.toString(32)),e+="_"}else n=LR++,e="_"+e+"r_"+n.toString(32)+"_";return t.memoizedState=e},useHostTransitionStatus:up,useFormState:Rv,useActionState:Rv,useOptimistic:function(t){var e=Ot();e.memoizedState=e.baseState=t;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=n,e=dp.bind(null,ie,!0,n),n.dispatch=e,[t,e]},useMemoCache:rp,useCacheRefresh:function(){return Ot().memoizedState=zR.bind(null,ie)},useEffectEvent:function(t){var e=Ot(),n={impl:t};return e.memoizedState=n,function(){if(be&2)throw Error(j(440));return n.impl.apply(void 0,arguments)}}},fp={readContext:St,use:Gu,useCallback:JS,useContext:St,useEffect:op,useImperativeHandle:QS,useInsertionEffect:KS,useLayoutEffect:GS,useMemo:XS,useReducer:dc,useRef:VS,useState:function(){return dc(Li)},useDebugValue:lp,useDeferredValue:function(t,e){var n=Ze();return $S(n,Re.memoizedState,t,e)},useTransition:function(){var t=dc(Li)[0],e=Ze().memoizedState;return[typeof t=="boolean"?t:yl(t),e]},useSyncExternalStore:DS,useId:tT,useHostTransitionStatus:up,useFormState:xv,useActionState:xv,useOptimistic:function(t,e){var n=Ze();return jS(n,Re,t,e)},useMemoCache:rp,useCacheRefresh:nT};fp.useEffectEvent=HS;var oT={readContext:St,use:Gu,useCallback:JS,useContext:St,useEffect:op,useImperativeHandle:QS,useInsertionEffect:KS,useLayoutEffect:GS,useMemo:XS,useReducer:qd,useRef:VS,useState:function(){return qd(Li)},useDebugValue:lp,useDeferredValue:function(t,e){var n=Ze();return Re===null?cp(n,t,e):$S(n,Re.memoizedState,t,e)},useTransition:function(){var t=qd(Li)[0],e=Ze().memoizedState;return[typeof t=="boolean"?t:yl(t),e]},useSyncExternalStore:DS,useId:tT,useHostTransitionStatus:up,useFormState:Ov,useActionState:Ov,useOptimistic:function(t,e){var n=Ze();return Re!==null?jS(n,Re,t,e):(n.baseState=t,[t,n.queue.dispatch])},useMemoCache:rp,useCacheRefresh:nT};oT.useEffectEvent=HS;function zd(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Le({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Th={enqueueSetState:function(t,e,n){t=t._reactInternals;var i=sn(),a=ba(i);a.payload=e,n!=null&&(a.callback=n),e=ya(t,a,i),e!==null&&(Ht(e,t,i),wo(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=sn(),a=ba(i);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=ya(t,a,i),e!==null&&(Ht(e,t,i),wo(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=sn(),i=ba(n);i.tag=2,e!=null&&(i.callback=e),e=ya(t,i,n),e!==null&&(Ht(e,t,n),wo(e,t,n))}};function Mv(t,e,n,i,a,r,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,r,s):e.prototype&&e.prototype.isPureReactComponent?!Fo(n,i)||!Fo(a,r):!0}function Dv(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&Th.enqueueReplaceState(e,e.state,null)}function fr(t,e){var n=e;if("ref"in e){n={};for(var i in e)i!=="ref"&&(n[i]=e[i])}if(t=t.defaultProps){n===e&&(n=Le({},n));for(var a in t)n[a]===void 0&&(n[a]=t[a])}return n}function lT(t){Vc(t)}function cT(t){console.error(t)}function uT(t){Vc(t)}function Zc(t,e){try{var n=t.onUncaughtError;n(e.value,{componentStack:e.stack})}catch(i){setTimeout(function(){throw i})}}function Pv(t,e,n){try{var i=t.onCaughtError;i(n.value,{componentStack:n.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function Ch(t,e,n){return n=ba(n),n.tag=3,n.payload={element:null},n.callback=function(){Zc(t,e)},n}function dT(t){return t=ba(t),t.tag=3,t}function fT(t,e,n,i){var a=n.type.getDerivedStateFromError;if(typeof a=="function"){var r=i.value;t.payload=function(){return a(r)},t.callback=function(){Pv(e,n,i)}}var s=n.stateNode;s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){Pv(e,n,i),typeof a!="function"&&(Sa===null?Sa=new Set([this]):Sa.add(this));var o=i.stack;this.componentDidCatch(i.value,{componentStack:o!==null?o:""})})}function VR(t,e,n,i,a){if(n.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(e=n.alternate,e!==null&&Is(e,n,a,!0),n=cn.current,n!==null){switch(n.tag){case 31:case 13:return En===null?iu():n.alternate===null&&Ve===0&&(Ve=3),n.flags&=-257,n.flags|=65536,n.lanes=a,i===Yc?n.flags|=16384:(e=n.updateQueue,e===null?n.updateQueue=new Set([i]):e.add(i),Zd(t,i,a)),!1;case 22:return n.flags|=65536,i===Yc?n.flags|=16384:(e=n.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=e):(n=e.retryQueue,n===null?e.retryQueue=new Set([i]):n.add(i)),Zd(t,i,a)),!1}throw Error(j(435,n.tag))}return Zd(t,i,a),iu(),!1}if(he)return e=cn.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=a,i!==ch&&(t=Error(j(422),{cause:i}),Ho(Sn(t,n)))):(i!==ch&&(e=Error(j(423),{cause:i}),Ho(Sn(e,n))),t=t.current.alternate,t.flags|=65536,a&=-a,t.lanes|=a,i=Sn(i,n),a=Ch(t.stateNode,i,a),Bd(t,a),Ve!==4&&(Ve=2)),!1;var r=Error(j(520),{cause:i});if(r=Sn(r,n),Do===null?Do=[r]:Do.push(r),Ve!==4&&(Ve=2),e===null)return!0;i=Sn(i,n),n=e;do{switch(n.tag){case 3:return n.flags|=65536,t=a&-a,n.lanes|=t,t=Ch(n.stateNode,i,t),Bd(n,t),!1;case 1:if(e=n.type,r=n.stateNode,(n.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||r!==null&&typeof r.componentDidCatch=="function"&&(Sa===null||!Sa.has(r))))return n.flags|=65536,a&=-a,n.lanes|=a,a=dT(a),fT(a,t,n,i),Bd(n,a),!1}n=n.return}while(n!==null);return!1}var hp=Error(j(461)),at=!1;function vt(t,e,n,i){e.child=t===null?wS(e,null,n,i):ur(e,t.child,n,i)}function Nv(t,e,n,i,a){n=n.render;var r=e.ref;if("ref"in i){var s={};for(var o in i)o!=="ref"&&(s[o]=i[o])}else s=i;return cr(e),i=tp(t,e,n,s,r,a),o=np(),t!==null&&!at?(ip(t,e,a),Ii(t,e,a)):(he&&o&&Ym(e),e.flags|=1,vt(t,e,i,a),e.child)}function Lv(t,e,n,i,a){if(t===null){var r=n.type;return typeof r=="function"&&!Gm(r)&&r.defaultProps===void 0&&n.compare===null?(e.tag=15,e.type=r,hT(t,e,r,i,a)):(t=cc(n.type,null,i,e,e.mode,a),t.ref=e.ref,t.return=e,e.child=t)}if(r=t.child,!mp(t,a)){var s=r.memoizedProps;if(n=n.compare,n=n!==null?n:Fo,n(s,i)&&t.ref===e.ref)return Ii(t,e,a)}return e.flags|=1,t=xi(r,i),t.ref=e.ref,t.return=e,e.child=t}function hT(t,e,n,i,a){if(t!==null){var r=t.memoizedProps;if(Fo(r,i)&&t.ref===e.ref)if(at=!1,e.pendingProps=i=r,mp(t,a))t.flags&131072&&(at=!0);else return e.lanes=t.lanes,Ii(t,e,a)}return kh(t,e,n,i,a)}function mT(t,e,n,i){var a=i.children,r=t!==null?t.memoizedState:null;if(t===null&&e.stateNode===null&&(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.mode==="hidden"){if(e.flags&128){if(r=r!==null?r.baseLanes|n:n,t!==null){for(i=e.child=t.child,a=0;i!==null;)a=a|i.lanes|i.childLanes,i=i.sibling;i=a&~r}else i=0,e.child=null;return Iv(t,e,r,n,i)}if(n&536870912)e.memoizedState={baseLanes:0,cachePool:null},t!==null&&uc(e,r!==null?r.cachePool:null),r!==null?Ev(e,r):gh(),OS(e);else return i=e.lanes=536870912,Iv(t,e,r!==null?r.baseLanes|n:n,n,i)}else r!==null?(uc(e,r.cachePool),Ev(e,r),ra(),e.memoizedState=null):(t!==null&&uc(e,null),gh(),ra());return vt(t,e,a,n),e.child}function po(t,e){return t!==null&&t.tag===22||e.stateNode!==null||(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),e.sibling}function Iv(t,e,n,i,a){var r=Xm();return r=r===null?null:{parent:it._currentValue,pool:r},e.memoizedState={baseLanes:n,cachePool:r},t!==null&&uc(e,null),gh(),OS(e),t!==null&&Is(t,e,i,!0),e.childLanes=a,null}function hc(t,e){return e=Wc({mode:e.mode,children:e.children},t.mode),e.ref=t.ref,t.child=e,e.return=t,e}function Uv(t,e,n){return ur(e,t.child,null,n),t=hc(e,e.pendingProps),t.flags|=2,Zt(e),e.memoizedState=null,t}function HR(t,e,n){var i=e.pendingProps,a=(e.flags&128)!==0;if(e.flags&=-129,t===null){if(he){if(i.mode==="hidden")return t=hc(e,i),e.lanes=536870912,po(null,t);if(vh(e),(t=Pe)?(t=sC(t,Tn),t=t!==null&&t.data==="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:xa!==null?{id:Qn,overflow:Jn}:null,retryLane:536870912,hydrationErrors:null},n=yS(t),n.return=e,e.child=n,yt=e,Pe=null)):t=null,t===null)throw Oa(e);return e.lanes=536870912,null}return hc(e,i)}var r=t.memoizedState;if(r!==null){var s=r.dehydrated;if(vh(e),a)if(e.flags&256)e.flags&=-257,e=Uv(t,e,n);else if(e.memoizedState!==null)e.child=t.child,e.flags|=128,e=null;else throw Error(j(558));else if(at||Is(t,e,n,!1),a=(n&t.childLanes)!==0,at||a){if(i=Ae,i!==null&&(s=Ky(i,n),s!==0&&s!==r.retryLane))throw r.retryLane=s,kr(t,s),Ht(i,t,s),hp;iu(),e=Uv(t,e,n)}else t=r.treeContext,Pe=_n(s.nextSibling),yt=e,he=!0,va=null,Tn=!1,t!==null&&TS(e,t),e=hc(e,i),e.flags|=4096;return e}return t=xi(t.child,{mode:i.mode,children:i.children}),t.ref=e.ref,e.child=t,t.return=e,t}function mc(t,e){var n=e.ref;if(n===null)t!==null&&t.ref!==null&&(e.flags|=4194816);else{if(typeof n!="function"&&typeof n!="object")throw Error(j(284));(t===null||t.ref!==n)&&(e.flags|=4194816)}}function kh(t,e,n,i,a){return cr(e),n=tp(t,e,n,i,void 0,a),i=np(),t!==null&&!at?(ip(t,e,a),Ii(t,e,a)):(he&&i&&Ym(e),e.flags|=1,vt(t,e,n,a),e.child)}function jv(t,e,n,i,a,r){return cr(e),e.updateQueue=null,n=MS(e,i,n,a),AS(t),i=np(),t!==null&&!at?(ip(t,e,r),Ii(t,e,r)):(he&&i&&Ym(e),e.flags|=1,vt(t,e,n,r),e.child)}function Bv(t,e,n,i,a){if(cr(e),e.stateNode===null){var r=Yr,s=n.contextType;typeof s=="object"&&s!==null&&(r=St(s)),r=new n(i,r),e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Th,e.stateNode=r,r._reactInternals=e,r=e.stateNode,r.props=i,r.state=e.memoizedState,r.refs={},Zm(e),s=n.contextType,r.context=typeof s=="object"&&s!==null?St(s):Yr,r.state=e.memoizedState,s=n.getDerivedStateFromProps,typeof s=="function"&&(zd(e,n,s,i),r.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(s=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),s!==r.state&&Th.enqueueReplaceState(r,r.state,null),xo(e,i,r,a),Ro(),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308),i=!0}else if(t===null){r=e.stateNode;var o=e.memoizedProps,l=fr(n,o);r.props=l;var c=r.context,u=n.contextType;s=Yr,typeof u=="object"&&u!==null&&(s=St(u));var d=n.getDerivedStateFromProps;u=typeof d=="function"||typeof r.getSnapshotBeforeUpdate=="function",o=e.pendingProps!==o,u||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(o||c!==s)&&Dv(e,r,i,s),ta=!1;var f=e.memoizedState;r.state=f,xo(e,i,r,a),Ro(),c=e.memoizedState,o||f!==c||ta?(typeof d=="function"&&(zd(e,n,d,i),c=e.memoizedState),(l=ta||Mv(e,n,l,i,f,c,s))?(u||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount()),typeof r.componentDidMount=="function"&&(e.flags|=4194308)):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),r.props=i,r.state=c,r.context=s,i=l):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{r=e.stateNode,mh(t,e),s=e.memoizedProps,u=fr(n,s),r.props=u,d=e.pendingProps,f=r.context,c=n.contextType,l=Yr,typeof c=="object"&&c!==null&&(l=St(c)),o=n.getDerivedStateFromProps,(c=typeof o=="function"||typeof r.getSnapshotBeforeUpdate=="function")||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(s!==d||f!==l)&&Dv(e,r,i,l),ta=!1,f=e.memoizedState,r.state=f,xo(e,i,r,a),Ro();var h=e.memoizedState;s!==d||f!==h||ta||t!==null&&t.dependencies!==null&&Gc(t.dependencies)?(typeof o=="function"&&(zd(e,n,o,i),h=e.memoizedState),(u=ta||Mv(e,n,u,i,f,h,l)||t!==null&&t.dependencies!==null&&Gc(t.dependencies))?(c||typeof r.UNSAFE_componentWillUpdate!="function"&&typeof r.componentWillUpdate!="function"||(typeof r.componentWillUpdate=="function"&&r.componentWillUpdate(i,h,l),typeof r.UNSAFE_componentWillUpdate=="function"&&r.UNSAFE_componentWillUpdate(i,h,l)),typeof r.componentDidUpdate=="function"&&(e.flags|=4),typeof r.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof r.componentDidUpdate!="function"||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=h),r.props=i,r.state=h,r.context=l,i=u):(typeof r.componentDidUpdate!="function"||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||s===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return r=i,mc(t,e),i=(e.flags&128)!==0,r||i?(r=e.stateNode,n=i&&typeof n.getDerivedStateFromError!="function"?null:r.render(),e.flags|=1,t!==null&&i?(e.child=ur(e,t.child,null,a),e.child=ur(e,null,n,a)):vt(t,e,n,a),e.memoizedState=r.state,t=e.child):t=Ii(t,e,a),t}function qv(t,e,n,i){return lr(),e.flags|=256,vt(t,e,n,i),e.child}var Fd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Vd(t){return{baseLanes:t,cachePool:kS()}}function Hd(t,e,n){return t=t!==null?t.childLanes&~n:0,e&&(t|=en),t}function pT(t,e,n){var i=e.pendingProps,a=!1,r=(e.flags&128)!==0,s;if((s=r)||(s=t!==null&&t.memoizedState===null?!1:($e.current&2)!==0),s&&(a=!0,e.flags&=-129),s=(e.flags&32)!==0,e.flags&=-33,t===null){if(he){if(a?aa(e):ra(),(t=Pe)?(t=sC(t,Tn),t=t!==null&&t.data!=="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:xa!==null?{id:Qn,overflow:Jn}:null,retryLane:536870912,hydrationErrors:null},n=yS(t),n.return=e,e.child=n,yt=e,Pe=null)):t=null,t===null)throw Oa(e);return Uh(t)?e.lanes=32:e.lanes=536870912,null}var o=i.children;return i=i.fallback,a?(ra(),a=e.mode,o=Wc({mode:"hidden",children:o},a),i=tr(i,a,n,null),o.return=e,i.return=e,o.sibling=i,e.child=o,i=e.child,i.memoizedState=Vd(n),i.childLanes=Hd(t,s,n),e.memoizedState=Fd,po(null,i)):(aa(e),Eh(e,o))}var l=t.memoizedState;if(l!==null&&(o=l.dehydrated,o!==null)){if(r)e.flags&256?(aa(e),e.flags&=-257,e=Kd(t,e,n)):e.memoizedState!==null?(ra(),e.child=t.child,e.flags|=128,e=null):(ra(),o=i.fallback,a=e.mode,i=Wc({mode:"visible",children:i.children},a),o=tr(o,a,n,null),o.flags|=2,i.return=e,o.return=e,i.sibling=o,e.child=i,ur(e,t.child,null,n),i=e.child,i.memoizedState=Vd(n),i.childLanes=Hd(t,s,n),e.memoizedState=Fd,e=po(null,i));else if(aa(e),Uh(o)){if(s=o.nextSibling&&o.nextSibling.dataset,s)var c=s.dgst;s=c,i=Error(j(419)),i.stack="",i.digest=s,Ho({value:i,source:null,stack:null}),e=Kd(t,e,n)}else if(at||Is(t,e,n,!1),s=(n&t.childLanes)!==0,at||s){if(s=Ae,s!==null&&(i=Ky(s,n),i!==0&&i!==l.retryLane))throw l.retryLane=i,kr(t,i),Ht(s,t,i),hp;Ih(o)||iu(),e=Kd(t,e,n)}else Ih(o)?(e.flags|=192,e.child=t.child,e=null):(t=l.treeContext,Pe=_n(o.nextSibling),yt=e,he=!0,va=null,Tn=!1,t!==null&&TS(e,t),e=Eh(e,i.children),e.flags|=4096);return e}return a?(ra(),o=i.fallback,a=e.mode,l=t.child,c=l.sibling,i=xi(l,{mode:"hidden",children:i.children}),i.subtreeFlags=l.subtreeFlags&65011712,c!==null?o=xi(c,o):(o=tr(o,a,n,null),o.flags|=2),o.return=e,i.return=e,i.sibling=o,e.child=i,po(null,i),i=e.child,o=t.child.memoizedState,o===null?o=Vd(n):(a=o.cachePool,a!==null?(l=it._currentValue,a=a.parent!==l?{parent:l,pool:l}:a):a=kS(),o={baseLanes:o.baseLanes|n,cachePool:a}),i.memoizedState=o,i.childLanes=Hd(t,s,n),e.memoizedState=Fd,po(t.child,i)):(aa(e),n=t.child,t=n.sibling,n=xi(n,{mode:"visible",children:i.children}),n.return=e,n.sibling=null,t!==null&&(s=e.deletions,s===null?(e.deletions=[t],e.flags|=16):s.push(t)),e.child=n,e.memoizedState=null,n)}function Eh(t,e){return e=Wc({mode:"visible",children:e},t.mode),e.return=t,t.child=e}function Wc(t,e){return t=Wt(22,t,null,e),t.lanes=0,t}function Kd(t,e,n){return ur(e,t.child,null,n),t=Eh(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function zv(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),dh(t.return,e,n)}function Gd(t,e,n,i,a,r){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:a,treeForkCount:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=n,s.tailMode=a,s.treeForkCount=r)}function gT(t,e,n){var i=e.pendingProps,a=i.revealOrder,r=i.tail;i=i.children;var s=$e.current,o=(s&2)!==0;if(o?(s=s&1|2,e.flags|=128):s&=1,Me($e,s),vt(t,e,i,n),i=he?Vo:0,!o&&t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&zv(t,n,e);else if(t.tag===19)zv(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(a){case"forwards":for(n=e.child,a=null;n!==null;)t=n.alternate,t!==null&&Jc(t)===null&&(a=n),n=n.sibling;n=a,n===null?(a=e.child,e.child=null):(a=n.sibling,n.sibling=null),Gd(e,!1,a,n,r,i);break;case"backwards":case"unstable_legacy-backwards":for(n=null,a=e.child,e.child=null;a!==null;){if(t=a.alternate,t!==null&&Jc(t)===null){e.child=a;break}t=a.sibling,a.sibling=n,n=a,a=t}Gd(e,!0,n,null,r,i);break;case"together":Gd(e,!1,null,null,void 0,i);break;default:e.memoizedState=null}return e.child}function Ii(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ma|=e.lanes,!(n&e.childLanes))if(t!==null){if(Is(t,e,n,!1),(n&e.childLanes)===0)return null}else return null;if(t!==null&&e.child!==t.child)throw Error(j(153));if(e.child!==null){for(t=e.child,n=xi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=xi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function mp(t,e){return t.lanes&e?!0:(t=t.dependencies,!!(t!==null&&Gc(t)))}function KR(t,e,n){switch(e.tag){case 3:Bc(e,e.stateNode.containerInfo),ia(e,it,t.memoizedState.cache),lr();break;case 27:case 5:Zf(e);break;case 4:Bc(e,e.stateNode.containerInfo);break;case 10:ia(e,e.type,e.memoizedProps.value);break;case 31:if(e.memoizedState!==null)return e.flags|=128,vh(e),null;break;case 13:var i=e.memoizedState;if(i!==null)return i.dehydrated!==null?(aa(e),e.flags|=128,null):n&e.child.childLanes?pT(t,e,n):(aa(e),t=Ii(t,e,n),t!==null?t.sibling:null);aa(e);break;case 19:var a=(t.flags&128)!==0;if(i=(n&e.childLanes)!==0,i||(Is(t,e,n,!1),i=(n&e.childLanes)!==0),a){if(i)return gT(t,e,n);e.flags|=128}if(a=e.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Me($e,$e.current),i)break;return null;case 22:return e.lanes=0,mT(t,e,n,e.pendingProps);case 24:ia(e,it,t.memoizedState.cache)}return Ii(t,e,n)}function vT(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps)at=!0;else{if(!mp(t,n)&&!(e.flags&128))return at=!1,KR(t,e,n);at=!!(t.flags&131072)}else at=!1,he&&e.flags&1048576&&SS(e,Vo,e.index);switch(e.lanes=0,e.tag){case 16:e:{var i=e.pendingProps;if(t=Ja(e.elementType),e.type=t,typeof t=="function")Gm(t)?(i=fr(t,i),e.tag=1,e=Bv(null,e,t,i,n)):(e.tag=0,e=kh(null,e,t,i,n));else{if(t!=null){var a=t.$$typeof;if(a===Dm){e.tag=11,e=Nv(null,e,t,i,n);break e}else if(a===Pm){e.tag=14,e=Lv(null,e,t,i,n);break e}}throw e=Xf(t)||t,Error(j(306,e,""))}}return e;case 0:return kh(t,e,e.type,e.pendingProps,n);case 1:return i=e.type,a=fr(i,e.pendingProps),Bv(t,e,i,a,n);case 3:e:{if(Bc(e,e.stateNode.containerInfo),t===null)throw Error(j(387));i=e.pendingProps;var r=e.memoizedState;a=r.element,mh(t,e),xo(e,i,null,n);var s=e.memoizedState;if(i=s.cache,ia(e,it,i),i!==r.cache&&fh(e,[it],n,!0),Ro(),i=s.element,r.isDehydrated)if(r={element:i,isDehydrated:!1,cache:s.cache},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){e=qv(t,e,i,n);break e}else if(i!==a){a=Sn(Error(j(424)),e),Ho(a),e=qv(t,e,i,n);break e}else{switch(t=e.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Pe=_n(t.firstChild),yt=e,he=!0,va=null,Tn=!0,n=wS(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(lr(),i===a){e=Ii(t,e,n);break e}vt(t,e,i,n)}e=e.child}return e;case 26:return mc(t,e),t===null?(n=o0(e.type,null,e.pendingProps,null))?e.memoizedState=n:he||(n=e.type,t=e.pendingProps,i=ou(ga.current).createElement(n),i[bt]=e,i[Kt]=t,kt(i,n,t),ht(i),e.stateNode=i):e.memoizedState=o0(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return Zf(e),t===null&&he&&(i=e.stateNode=oC(e.type,e.pendingProps,ga.current),yt=e,Tn=!0,a=Pe,Ua(e.type)?(jh=a,Pe=_n(i.firstChild)):Pe=a),vt(t,e,e.pendingProps.children,n),mc(t,e),t===null&&(e.flags|=4194304),e.child;case 5:return t===null&&he&&((a=i=Pe)&&(i=Tx(i,e.type,e.pendingProps,Tn),i!==null?(e.stateNode=i,yt=e,Pe=_n(i.firstChild),Tn=!1,a=!0):a=!1),a||Oa(e)),Zf(e),a=e.type,r=e.pendingProps,s=t!==null?t.memoizedProps:null,i=r.children,Nh(a,r)?i=null:s!==null&&Nh(a,s)&&(e.flags|=32),e.memoizedState!==null&&(a=tp(t,e,IR,null,null,n),Xo._currentValue=a),mc(t,e),vt(t,e,i,n),e.child;case 6:return t===null&&he&&((t=n=Pe)&&(n=Cx(n,e.pendingProps,Tn),n!==null?(e.stateNode=n,yt=e,Pe=null,t=!0):t=!1),t||Oa(e)),null;case 13:return pT(t,e,n);case 4:return Bc(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=ur(e,null,i,n):vt(t,e,i,n),e.child;case 11:return Nv(t,e,e.type,e.pendingProps,n);case 7:return vt(t,e,e.pendingProps,n),e.child;case 8:return vt(t,e,e.pendingProps.children,n),e.child;case 12:return vt(t,e,e.pendingProps.children,n),e.child;case 10:return i=e.pendingProps,ia(e,e.type,i.value),vt(t,e,i.children,n),e.child;case 9:return a=e.type._context,i=e.pendingProps.children,cr(e),a=St(a),i=i(a),e.flags|=1,vt(t,e,i,n),e.child;case 14:return Lv(t,e,e.type,e.pendingProps,n);case 15:return hT(t,e,e.type,e.pendingProps,n);case 19:return gT(t,e,n);case 31:return HR(t,e,n);case 22:return mT(t,e,n,e.pendingProps);case 24:return cr(e),i=St(it),t===null?(a=Xm(),a===null&&(a=Ae,r=Jm(),a.pooledCache=r,r.refCount++,r!==null&&(a.pooledCacheLanes|=n),a=r),e.memoizedState={parent:i,cache:a},Zm(e),ia(e,it,a)):(t.lanes&n&&(mh(t,e),xo(e,null,null,n),Ro()),a=t.memoizedState,r=e.memoizedState,a.parent!==i?(a={parent:i,cache:i},e.memoizedState=a,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=a),ia(e,it,i)):(i=r.cache,ia(e,it,i),i!==a.cache&&fh(e,[it],n,!0))),vt(t,e,e.pendingProps.children,n),e.child;case 29:throw e.pendingProps}throw Error(j(156,e.tag))}function fi(t){t.flags|=4}function Yd(t,e,n,i,a){if((e=(t.mode&32)!==0)&&(e=!1),e){if(t.flags|=16777216,(a&335544128)===a)if(t.stateNode.complete)t.flags|=8192;else if(zT())t.flags|=8192;else throw ir=Yc,$m}else t.flags&=-16777217}function Fv(t,e){if(e.type!=="stylesheet"||e.state.loading&4)t.flags&=-16777217;else if(t.flags|=16777216,!uC(e))if(zT())t.flags|=8192;else throw ir=Yc,$m}function Vl(t,e){e!==null&&(t.flags|=4),t.flags&16384&&(e=t.tag!==22?Fy():536870912,t.lanes|=e,ks|=e)}function $s(t,e){if(!he)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function De(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var a=t.child;a!==null;)n|=a.lanes|a.childLanes,i|=a.subtreeFlags&65011712,i|=a.flags&65011712,a.return=t,a=a.sibling;else for(a=t.child;a!==null;)n|=a.lanes|a.childLanes,i|=a.subtreeFlags,i|=a.flags,a.return=t,a=a.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function GR(t,e,n){var i=e.pendingProps;switch(Qm(e),e.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return De(e),null;case 1:return De(e),null;case 3:return n=e.stateNode,i=null,t!==null&&(i=t.memoizedState.cache),e.memoizedState.cache!==i&&(e.flags|=2048),Oi(it),vs(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(Dr(e)?fi(e):t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,jd())),De(e),null;case 26:var a=e.type,r=e.memoizedState;return t===null?(fi(e),r!==null?(De(e),Fv(e,r)):(De(e),Yd(e,a,null,i,n))):r?r!==t.memoizedState?(fi(e),De(e),Fv(e,r)):(De(e),e.flags&=-16777217):(t=t.memoizedProps,t!==i&&fi(e),De(e),Yd(e,a,t,i,n)),null;case 27:if(qc(e),n=ga.current,a=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==i&&fi(e);else{if(!i){if(e.stateNode===null)throw Error(j(166));return De(e),null}t=$n.current,Dr(e)?vv(e):(t=oC(a,i,n),e.stateNode=t,fi(e))}return De(e),null;case 5:if(qc(e),a=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==i&&fi(e);else{if(!i){if(e.stateNode===null)throw Error(j(166));return De(e),null}if(r=$n.current,Dr(e))vv(e);else{var s=ou(ga.current);switch(r){case 1:r=s.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:r=s.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":r=s.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":r=s.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":r=s.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof i.is=="string"?s.createElement("select",{is:i.is}):s.createElement("select"),i.multiple?r.multiple=!0:i.size&&(r.size=i.size);break;default:r=typeof i.is=="string"?s.createElement(a,{is:i.is}):s.createElement(a)}}r[bt]=e,r[Kt]=i;e:for(s=e.child;s!==null;){if(s.tag===5||s.tag===6)r.appendChild(s.stateNode);else if(s.tag!==4&&s.tag!==27&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}e.stateNode=r;e:switch(kt(r,a,i),a){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&fi(e)}}return De(e),Yd(e,e.type,t===null?null:t.memoizedProps,e.pendingProps,n),null;case 6:if(t&&e.stateNode!=null)t.memoizedProps!==i&&fi(e);else{if(typeof i!="string"&&e.stateNode===null)throw Error(j(166));if(t=ga.current,Dr(e)){if(t=e.stateNode,n=e.memoizedProps,i=null,a=yt,a!==null)switch(a.tag){case 27:case 5:i=a.memoizedProps}t[bt]=e,t=!!(t.nodeValue===n||i!==null&&i.suppressHydrationWarning===!0||iC(t.nodeValue,n)),t||Oa(e,!0)}else t=ou(t).createTextNode(i),t[bt]=e,e.stateNode=t}return De(e),null;case 31:if(n=e.memoizedState,t===null||t.memoizedState!==null){if(i=Dr(e),n!==null){if(t===null){if(!i)throw Error(j(318));if(t=e.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(j(557));t[bt]=e}else lr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;De(e),t=!1}else n=jd(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=n),t=!0;if(!t)return e.flags&256?(Zt(e),e):(Zt(e),null);if(e.flags&128)throw Error(j(558))}return De(e),null;case 13:if(i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(a=Dr(e),i!==null&&i.dehydrated!==null){if(t===null){if(!a)throw Error(j(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(j(317));a[bt]=e}else lr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;De(e),a=!1}else a=jd(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=a),a=!0;if(!a)return e.flags&256?(Zt(e),e):(Zt(e),null)}return Zt(e),e.flags&128?(e.lanes=n,e):(n=i!==null,t=t!==null&&t.memoizedState!==null,n&&(i=e.child,a=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(a=i.alternate.memoizedState.cachePool.pool),r=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(r=i.memoizedState.cachePool.pool),r!==a&&(i.flags|=2048)),n!==t&&n&&(e.child.flags|=8192),Vl(e,e.updateQueue),De(e),null);case 4:return vs(),t===null&&Tp(e.stateNode.containerInfo),De(e),null;case 10:return Oi(e.type),De(e),null;case 19:if(pt($e),i=e.memoizedState,i===null)return De(e),null;if(a=(e.flags&128)!==0,r=i.rendering,r===null)if(a)$s(i,!1);else{if(Ve!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(r=Jc(t),r!==null){for(e.flags|=128,$s(i,!1),t=r.updateQueue,e.updateQueue=t,Vl(e,t),e.subtreeFlags=0,t=n,n=e.child;n!==null;)bS(n,t),n=n.sibling;return Me($e,$e.current&1|2),he&&bi(e,i.treeForkCount),e.child}t=t.sibling}i.tail!==null&&nn()>tu&&(e.flags|=128,a=!0,$s(i,!1),e.lanes=4194304)}else{if(!a)if(t=Jc(r),t!==null){if(e.flags|=128,a=!0,t=t.updateQueue,e.updateQueue=t,Vl(e,t),$s(i,!0),i.tail===null&&i.tailMode==="hidden"&&!r.alternate&&!he)return De(e),null}else 2*nn()-i.renderingStartTime>tu&&n!==536870912&&(e.flags|=128,a=!0,$s(i,!1),e.lanes=4194304);i.isBackwards?(r.sibling=e.child,e.child=r):(t=i.last,t!==null?t.sibling=r:e.child=r,i.last=r)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=nn(),t.sibling=null,n=$e.current,Me($e,a?n&1|2:n&1),he&&bi(e,i.treeForkCount),t):(De(e),null);case 22:case 23:return Zt(e),Wm(),i=e.memoizedState!==null,t!==null?t.memoizedState!==null!==i&&(e.flags|=8192):i&&(e.flags|=8192),i?n&536870912&&!(e.flags&128)&&(De(e),e.subtreeFlags&6&&(e.flags|=8192)):De(e),n=e.updateQueue,n!==null&&Vl(e,n.retryQueue),n=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),i=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),i!==n&&(e.flags|=2048),t!==null&&pt(nr),null;case 24:return n=null,t!==null&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),Oi(it),De(e),null;case 25:return null;case 30:return null}throw Error(j(156,e.tag))}function YR(t,e){switch(Qm(e),e.tag){case 1:return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Oi(it),vs(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 26:case 27:case 5:return qc(e),null;case 31:if(e.memoizedState!==null){if(Zt(e),e.alternate===null)throw Error(j(340));lr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 13:if(Zt(e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(j(340));lr()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return pt($e),null;case 4:return vs(),null;case 10:return Oi(e.type),null;case 22:case 23:return Zt(e),Wm(),t!==null&&pt(nr),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 24:return Oi(it),null;case 25:return null;default:return null}}function bT(t,e){switch(Qm(e),e.tag){case 3:Oi(it),vs();break;case 26:case 27:case 5:qc(e);break;case 4:vs();break;case 31:e.memoizedState!==null&&Zt(e);break;case 13:Zt(e);break;case 19:pt($e);break;case 10:Oi(e.type);break;case 22:case 23:Zt(e),Wm(),t!==null&&pt(nr);break;case 24:Oi(it)}}function Sl(t,e){try{var n=e.updateQueue,i=n!==null?n.lastEffect:null;if(i!==null){var a=i.next;n=a;do{if((n.tag&t)===t){i=void 0;var r=n.create,s=n.inst;i=r(),s.destroy=i}n=n.next}while(n!==a)}}catch(o){Ee(e,e.return,o)}}function Aa(t,e,n){try{var i=e.updateQueue,a=i!==null?i.lastEffect:null;if(a!==null){var r=a.next;i=r;do{if((i.tag&t)===t){var s=i.inst,o=s.destroy;if(o!==void 0){s.destroy=void 0,a=e;var l=n,c=o;try{c()}catch(u){Ee(a,l,u)}}}i=i.next}while(i!==r)}}catch(u){Ee(e,e.return,u)}}function yT(t){var e=t.updateQueue;if(e!==null){var n=t.stateNode;try{xS(e,n)}catch(i){Ee(t,t.return,i)}}}function ST(t,e,n){n.props=fr(t.type,t.memoizedProps),n.state=t.memoizedState;try{n.componentWillUnmount()}catch(i){Ee(t,e,i)}}function Ao(t,e){try{var n=t.ref;if(n!==null){switch(t.tag){case 26:case 27:case 5:var i=t.stateNode;break;case 30:i=t.stateNode;break;default:i=t.stateNode}typeof n=="function"?t.refCleanup=n(i):n.current=i}}catch(a){Ee(t,e,a)}}function Xn(t,e){var n=t.ref,i=t.refCleanup;if(n!==null)if(typeof i=="function")try{i()}catch(a){Ee(t,e,a)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof n=="function")try{n(null)}catch(a){Ee(t,e,a)}else n.current=null}function TT(t){var e=t.type,n=t.memoizedProps,i=t.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(a){Ee(t,t.return,a)}}function Qd(t,e,n){try{var i=t.stateNode;px(i,t.type,n,e),i[Kt]=e}catch(a){Ee(t,t.return,a)}}function CT(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Ua(t.type)||t.tag===4}function Jd(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||CT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Ua(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function _h(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n).insertBefore(t,e):(e=n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,e.appendChild(t),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=wi));else if(i!==4&&(i===27&&Ua(t.type)&&(n=t.stateNode,e=null),t=t.child,t!==null))for(_h(t,e,n),t=t.sibling;t!==null;)_h(t,e,n),t=t.sibling}function eu(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(i===27&&Ua(t.type)&&(n=t.stateNode),t=t.child,t!==null))for(eu(t,e,n),t=t.sibling;t!==null;)eu(t,e,n),t=t.sibling}function kT(t){var e=t.stateNode,n=t.memoizedProps;try{for(var i=t.type,a=e.attributes;a.length;)e.removeAttributeNode(a[0]);kt(e,i,n),e[bt]=t,e[Kt]=n}catch(r){Ee(t,t.return,r)}}var Si=!1,nt=!1,Xd=!1,Vv=typeof WeakSet=="function"?WeakSet:Set,dt=null;function QR(t,e){if(t=t.containerInfo,Dh=du,t=uS(t),Vm(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var a=i.anchorOffset,r=i.focusNode;i=i.focusOffset;try{n.nodeType,r.nodeType}catch{n=null;break e}var s=0,o=-1,l=-1,c=0,u=0,d=t,f=null;t:for(;;){for(var h;d!==n||a!==0&&d.nodeType!==3||(o=s+a),d!==r||i!==0&&d.nodeType!==3||(l=s+i),d.nodeType===3&&(s+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===t)break t;if(f===n&&++c===a&&(o=s),f===r&&++u===i&&(l=s),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}n=o===-1||l===-1?null:{start:o,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ph={focusedElem:t,selectionRange:n},du=!1,dt=e;dt!==null;)if(e=dt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,dt=t;else for(;dt!==null;){switch(e=dt,r=e.alternate,t=e.flags,e.tag){case 0:if(t&4&&(t=e.updateQueue,t=t!==null?t.events:null,t!==null))for(n=0;n<t.length;n++)a=t[n],a.ref.impl=a.nextImpl;break;case 11:case 15:break;case 1:if(t&1024&&r!==null){t=void 0,n=e,a=r.memoizedProps,r=r.memoizedState,i=n.stateNode;try{var v=fr(n.type,a);t=i.getSnapshotBeforeUpdate(v,r),i.__reactInternalSnapshotBeforeUpdate=t}catch(g){Ee(n,n.return,g)}}break;case 3:if(t&1024){if(t=e.stateNode.containerInfo,n=t.nodeType,n===9)Lh(t);else if(n===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Lh(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(t&1024)throw Error(j(163))}if(t=e.sibling,t!==null){t.return=e.return,dt=t;break}dt=e.return}}function ET(t,e,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:mi(t,n),i&4&&Sl(5,n);break;case 1:if(mi(t,n),i&4)if(t=n.stateNode,e===null)try{t.componentDidMount()}catch(s){Ee(n,n.return,s)}else{var a=fr(n.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(a,e,t.__reactInternalSnapshotBeforeUpdate)}catch(s){Ee(n,n.return,s)}}i&64&&yT(n),i&512&&Ao(n,n.return);break;case 3:if(mi(t,n),i&64&&(t=n.updateQueue,t!==null)){if(e=null,n.child!==null)switch(n.child.tag){case 27:case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}try{xS(t,e)}catch(s){Ee(n,n.return,s)}}break;case 27:e===null&&i&4&&kT(n);case 26:case 5:mi(t,n),e===null&&i&4&&TT(n),i&512&&Ao(n,n.return);break;case 12:mi(t,n);break;case 31:mi(t,n),i&4&&RT(t,n);break;case 13:mi(t,n),i&4&&xT(t,n),i&64&&(t=n.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(n=ix.bind(null,n),kx(t,n))));break;case 22:if(i=n.memoizedState!==null||Si,!i){e=e!==null&&e.memoizedState!==null||nt,a=Si;var r=nt;Si=i,(nt=e)&&!r?gi(t,n,(n.subtreeFlags&8772)!==0):mi(t,n),Si=a,nt=r}break;case 30:break;default:mi(t,n)}}function _T(t){var e=t.alternate;e!==null&&(t.alternate=null,_T(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&Um(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var je=null,qt=!1;function hi(t,e,n){for(n=n.child;n!==null;)wT(t,e,n),n=n.sibling}function wT(t,e,n){if(an&&typeof an.onCommitFiberUnmount=="function")try{an.onCommitFiberUnmount(hl,n)}catch{}switch(n.tag){case 26:nt||Xn(n,e),hi(t,e,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:nt||Xn(n,e);var i=je,a=qt;Ua(n.type)&&(je=n.stateNode,qt=!1),hi(t,e,n),No(n.stateNode),je=i,qt=a;break;case 5:nt||Xn(n,e);case 6:if(i=je,a=qt,je=null,hi(t,e,n),je=i,qt=a,je!==null)if(qt)try{(je.nodeType===9?je.body:je.nodeName==="HTML"?je.ownerDocument.body:je).removeChild(n.stateNode)}catch(r){Ee(n,e,r)}else try{je.removeChild(n.stateNode)}catch(r){Ee(n,e,r)}break;case 18:je!==null&&(qt?(t=je,n0(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,n.stateNode),Rs(t)):n0(je,n.stateNode));break;case 4:i=je,a=qt,je=n.stateNode.containerInfo,qt=!0,hi(t,e,n),je=i,qt=a;break;case 0:case 11:case 14:case 15:Aa(2,n,e),nt||Aa(4,n,e),hi(t,e,n);break;case 1:nt||(Xn(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"&&ST(n,e,i)),hi(t,e,n);break;case 21:hi(t,e,n);break;case 22:nt=(i=nt)||n.memoizedState!==null,hi(t,e,n),nt=i;break;default:hi(t,e,n)}}function RT(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{Rs(t)}catch(n){Ee(e,e.return,n)}}}function xT(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Rs(t)}catch(n){Ee(e,e.return,n)}}function JR(t){switch(t.tag){case 31:case 13:case 19:var e=t.stateNode;return e===null&&(e=t.stateNode=new Vv),e;case 22:return t=t.stateNode,e=t._retryCache,e===null&&(e=t._retryCache=new Vv),e;default:throw Error(j(435,t.tag))}}function Hl(t,e){var n=JR(t);e.forEach(function(i){if(!n.has(i)){n.add(i);var a=ax.bind(null,t,i);i.then(a,a)}})}function jt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var a=n[i],r=t,s=e,o=s;e:for(;o!==null;){switch(o.tag){case 27:if(Ua(o.type)){je=o.stateNode,qt=!1;break e}break;case 5:je=o.stateNode,qt=!1;break e;case 3:case 4:je=o.stateNode.containerInfo,qt=!0;break e}o=o.return}if(je===null)throw Error(j(160));wT(r,s,a),je=null,qt=!1,r=a.alternate,r!==null&&(r.return=null),a.return=null}if(e.subtreeFlags&13886)for(e=e.child;e!==null;)OT(e,t),e=e.sibling}var Pn=null;function OT(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:jt(e,t),Bt(t),i&4&&(Aa(3,t,t.return),Sl(3,t),Aa(5,t,t.return));break;case 1:jt(e,t),Bt(t),i&512&&(nt||n===null||Xn(n,n.return)),i&64&&Si&&(t=t.updateQueue,t!==null&&(i=t.callbacks,i!==null&&(n=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=n===null?i:n.concat(i))));break;case 26:var a=Pn;if(jt(e,t),Bt(t),i&512&&(nt||n===null||Xn(n,n.return)),i&4){var r=n!==null?n.memoizedState:null;if(i=t.memoizedState,n===null)if(i===null)if(t.stateNode===null){e:{i=t.type,n=t.memoizedProps,a=a.ownerDocument||a;t:switch(i){case"title":r=a.getElementsByTagName("title")[0],(!r||r[gl]||r[bt]||r.namespaceURI==="http://www.w3.org/2000/svg"||r.hasAttribute("itemprop"))&&(r=a.createElement(i),a.head.insertBefore(r,a.querySelector("head > title"))),kt(r,i,n),r[bt]=t,ht(r),i=r;break e;case"link":var s=c0("link","href",a).get(i+(n.href||""));if(s){for(var o=0;o<s.length;o++)if(r=s[o],r.getAttribute("href")===(n.href==null||n.href===""?null:n.href)&&r.getAttribute("rel")===(n.rel==null?null:n.rel)&&r.getAttribute("title")===(n.title==null?null:n.title)&&r.getAttribute("crossorigin")===(n.crossOrigin==null?null:n.crossOrigin)){s.splice(o,1);break t}}r=a.createElement(i),kt(r,i,n),a.head.appendChild(r);break;case"meta":if(s=c0("meta","content",a).get(i+(n.content||""))){for(o=0;o<s.length;o++)if(r=s[o],r.getAttribute("content")===(n.content==null?null:""+n.content)&&r.getAttribute("name")===(n.name==null?null:n.name)&&r.getAttribute("property")===(n.property==null?null:n.property)&&r.getAttribute("http-equiv")===(n.httpEquiv==null?null:n.httpEquiv)&&r.getAttribute("charset")===(n.charSet==null?null:n.charSet)){s.splice(o,1);break t}}r=a.createElement(i),kt(r,i,n),a.head.appendChild(r);break;default:throw Error(j(468,i))}r[bt]=t,ht(r),i=r}t.stateNode=i}else u0(a,t.type,t.stateNode);else t.stateNode=l0(a,i,t.memoizedProps);else r!==i?(r===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):r.count--,i===null?u0(a,t.type,t.stateNode):l0(a,i,t.memoizedProps)):i===null&&t.stateNode!==null&&Qd(t,t.memoizedProps,n.memoizedProps)}break;case 27:jt(e,t),Bt(t),i&512&&(nt||n===null||Xn(n,n.return)),n!==null&&i&4&&Qd(t,t.memoizedProps,n.memoizedProps);break;case 5:if(jt(e,t),Bt(t),i&512&&(nt||n===null||Xn(n,n.return)),t.flags&32){a=t.stateNode;try{ys(a,"")}catch(v){Ee(t,t.return,v)}}i&4&&t.stateNode!=null&&(a=t.memoizedProps,Qd(t,a,n!==null?n.memoizedProps:a)),i&1024&&(Xd=!0);break;case 6:if(jt(e,t),Bt(t),i&4){if(t.stateNode===null)throw Error(j(162));i=t.memoizedProps,n=t.stateNode;try{n.nodeValue=i}catch(v){Ee(t,t.return,v)}}break;case 3:if(vc=null,a=Pn,Pn=lu(e.containerInfo),jt(e,t),Pn=a,Bt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Rs(e.containerInfo)}catch(v){Ee(t,t.return,v)}Xd&&(Xd=!1,AT(t));break;case 4:i=Pn,Pn=lu(t.stateNode.containerInfo),jt(e,t),Bt(t),Pn=i;break;case 12:jt(e,t),Bt(t);break;case 31:jt(e,t),Bt(t),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,Hl(t,i)));break;case 13:jt(e,t),Bt(t),t.child.flags&8192&&t.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(Ju=nn()),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,Hl(t,i)));break;case 22:a=t.memoizedState!==null;var l=n!==null&&n.memoizedState!==null,c=Si,u=nt;if(Si=c||a,nt=u||l,jt(e,t),nt=u,Si=c,Bt(t),i&8192)e:for(e=t.stateNode,e._visibility=a?e._visibility&-2:e._visibility|1,a&&(n===null||l||Si||nt||Xa(t)),n=null,e=t;;){if(e.tag===5||e.tag===26){if(n===null){l=n=e;try{if(r=l.stateNode,a)s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none";else{o=l.stateNode;var d=l.memoizedProps.style,f=d!=null&&d.hasOwnProperty("display")?d.display:null;o.style.display=f==null||typeof f=="boolean"?"":(""+f).trim()}}catch(v){Ee(l,l.return,v)}}}else if(e.tag===6){if(n===null){l=e;try{l.stateNode.nodeValue=a?"":l.memoizedProps}catch(v){Ee(l,l.return,v)}}}else if(e.tag===18){if(n===null){l=e;try{var h=l.stateNode;a?i0(h,!0):i0(l.stateNode,!1)}catch(v){Ee(l,l.return,v)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===t)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;n===e&&(n=null),e=e.return}n===e&&(n=null),e.sibling.return=e.return,e=e.sibling}i&4&&(i=t.updateQueue,i!==null&&(n=i.retryQueue,n!==null&&(i.retryQueue=null,Hl(t,n))));break;case 19:jt(e,t),Bt(t),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,Hl(t,i)));break;case 30:break;case 21:break;default:jt(e,t),Bt(t)}}function Bt(t){var e=t.flags;if(e&2){try{for(var n,i=t.return;i!==null;){if(CT(i)){n=i;break}i=i.return}if(n==null)throw Error(j(160));switch(n.tag){case 27:var a=n.stateNode,r=Jd(t);eu(t,r,a);break;case 5:var s=n.stateNode;n.flags&32&&(ys(s,""),n.flags&=-33);var o=Jd(t);eu(t,o,s);break;case 3:case 4:var l=n.stateNode.containerInfo,c=Jd(t);_h(t,c,l);break;default:throw Error(j(161))}}catch(u){Ee(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function AT(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var e=t;AT(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),t=t.sibling}}function mi(t,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)ET(t,e.alternate,e),e=e.sibling}function Xa(t){for(t=t.child;t!==null;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:Aa(4,e,e.return),Xa(e);break;case 1:Xn(e,e.return);var n=e.stateNode;typeof n.componentWillUnmount=="function"&&ST(e,e.return,n),Xa(e);break;case 27:No(e.stateNode);case 26:case 5:Xn(e,e.return),Xa(e);break;case 22:e.memoizedState===null&&Xa(e);break;case 30:Xa(e);break;default:Xa(e)}t=t.sibling}}function gi(t,e,n){for(n=n&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var i=e.alternate,a=t,r=e,s=r.flags;switch(r.tag){case 0:case 11:case 15:gi(a,r,n),Sl(4,r);break;case 1:if(gi(a,r,n),i=r,a=i.stateNode,typeof a.componentDidMount=="function")try{a.componentDidMount()}catch(c){Ee(i,i.return,c)}if(i=r,a=i.updateQueue,a!==null){var o=i.stateNode;try{var l=a.shared.hiddenCallbacks;if(l!==null)for(a.shared.hiddenCallbacks=null,a=0;a<l.length;a++)RS(l[a],o)}catch(c){Ee(i,i.return,c)}}n&&s&64&&yT(r),Ao(r,r.return);break;case 27:kT(r);case 26:case 5:gi(a,r,n),n&&i===null&&s&4&&TT(r),Ao(r,r.return);break;case 12:gi(a,r,n);break;case 31:gi(a,r,n),n&&s&4&&RT(a,r);break;case 13:gi(a,r,n),n&&s&4&&xT(a,r);break;case 22:r.memoizedState===null&&gi(a,r,n),Ao(r,r.return);break;case 30:break;default:gi(a,r,n)}e=e.sibling}}function pp(t,e){var n=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),t=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(t=e.memoizedState.cachePool.pool),t!==n&&(t!=null&&t.refCount++,n!=null&&bl(n))}function gp(t,e){t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&bl(t))}function Mn(t,e,n,i){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)MT(t,e,n,i),e=e.sibling}function MT(t,e,n,i){var a=e.flags;switch(e.tag){case 0:case 11:case 15:Mn(t,e,n,i),a&2048&&Sl(9,e);break;case 1:Mn(t,e,n,i);break;case 3:Mn(t,e,n,i),a&2048&&(t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&bl(t)));break;case 12:if(a&2048){Mn(t,e,n,i),t=e.stateNode;try{var r=e.memoizedProps,s=r.id,o=r.onPostCommit;typeof o=="function"&&o(s,e.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(l){Ee(e,e.return,l)}}else Mn(t,e,n,i);break;case 31:Mn(t,e,n,i);break;case 13:Mn(t,e,n,i);break;case 23:break;case 22:r=e.stateNode,s=e.alternate,e.memoizedState!==null?r._visibility&2?Mn(t,e,n,i):Mo(t,e):r._visibility&2?Mn(t,e,n,i):(r._visibility|=2,Ur(t,e,n,i,(e.subtreeFlags&10256)!==0||!1)),a&2048&&pp(s,e);break;case 24:Mn(t,e,n,i),a&2048&&gp(e.alternate,e);break;default:Mn(t,e,n,i)}}function Ur(t,e,n,i,a){for(a=a&&((e.subtreeFlags&10256)!==0||!1),e=e.child;e!==null;){var r=t,s=e,o=n,l=i,c=s.flags;switch(s.tag){case 0:case 11:case 15:Ur(r,s,o,l,a),Sl(8,s);break;case 23:break;case 22:var u=s.stateNode;s.memoizedState!==null?u._visibility&2?Ur(r,s,o,l,a):Mo(r,s):(u._visibility|=2,Ur(r,s,o,l,a)),a&&c&2048&&pp(s.alternate,s);break;case 24:Ur(r,s,o,l,a),a&&c&2048&&gp(s.alternate,s);break;default:Ur(r,s,o,l,a)}e=e.sibling}}function Mo(t,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var n=t,i=e,a=i.flags;switch(i.tag){case 22:Mo(n,i),a&2048&&pp(i.alternate,i);break;case 24:Mo(n,i),a&2048&&gp(i.alternate,i);break;default:Mo(n,i)}e=e.sibling}}var go=8192;function Pr(t,e,n){if(t.subtreeFlags&go)for(t=t.child;t!==null;)DT(t,e,n),t=t.sibling}function DT(t,e,n){switch(t.tag){case 26:Pr(t,e,n),t.flags&go&&t.memoizedState!==null&&Lx(n,Pn,t.memoizedState,t.memoizedProps);break;case 5:Pr(t,e,n);break;case 3:case 4:var i=Pn;Pn=lu(t.stateNode.containerInfo),Pr(t,e,n),Pn=i;break;case 22:t.memoizedState===null&&(i=t.alternate,i!==null&&i.memoizedState!==null?(i=go,go=16777216,Pr(t,e,n),go=i):Pr(t,e,n));break;default:Pr(t,e,n)}}function PT(t){var e=t.alternate;if(e!==null&&(t=e.child,t!==null)){e.child=null;do e=t.sibling,t.sibling=null,t=e;while(t!==null)}}function Zs(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var i=e[n];dt=i,LT(i,t)}PT(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)NT(t),t=t.sibling}function NT(t){switch(t.tag){case 0:case 11:case 15:Zs(t),t.flags&2048&&Aa(9,t,t.return);break;case 3:Zs(t);break;case 12:Zs(t);break;case 22:var e=t.stateNode;t.memoizedState!==null&&e._visibility&2&&(t.return===null||t.return.tag!==13)?(e._visibility&=-3,pc(t)):Zs(t);break;default:Zs(t)}}function pc(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var i=e[n];dt=i,LT(i,t)}PT(t)}for(t=t.child;t!==null;){switch(e=t,e.tag){case 0:case 11:case 15:Aa(8,e,e.return),pc(e);break;case 22:n=e.stateNode,n._visibility&2&&(n._visibility&=-3,pc(e));break;default:pc(e)}t=t.sibling}}function LT(t,e){for(;dt!==null;){var n=dt;switch(n.tag){case 0:case 11:case 15:Aa(8,n,e);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var i=n.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:bl(n.memoizedState.cache)}if(i=n.child,i!==null)i.return=n,dt=i;else e:for(n=t;dt!==null;){i=dt;var a=i.sibling,r=i.return;if(_T(i),i===n){dt=null;break e}if(a!==null){a.return=r,dt=a;break e}dt=r}}}var XR={getCacheForType:function(t){var e=St(it),n=e.data.get(t);return n===void 0&&(n=t(),e.data.set(t,n)),n},cacheSignal:function(){return St(it).controller.signal}},$R=typeof WeakMap=="function"?WeakMap:Map,be=0,Ae=null,ce=null,de=0,ke=0,$t=null,ua=!1,js=!1,vp=!1,Ui=0,Ve=0,Ma=0,ar=0,bp=0,en=0,ks=0,Do=null,zt=null,wh=!1,Ju=0,IT=0,tu=1/0,nu=null,Sa=null,st=0,Ta=null,Es=null,Ai=0,Rh=0,xh=null,UT=null,Po=0,Oh=null;function sn(){return be&2&&de!==0?de&-de:ee.T!==null?Sp():Gy()}function jT(){if(en===0)if(!(de&536870912)||he){var t=Il;Il<<=1,!(Il&3932160)&&(Il=262144),en=t}else en=536870912;return t=cn.current,t!==null&&(t.flags|=32),en}function Ht(t,e,n){(t===Ae&&(ke===2||ke===9)||t.cancelPendingCommit!==null)&&(_s(t,0),da(t,de,en,!1)),pl(t,n),(!(be&2)||t!==Ae)&&(t===Ae&&(!(be&2)&&(ar|=n),Ve===4&&da(t,de,en,!1)),ri(t))}function BT(t,e,n){if(be&6)throw Error(j(327));var i=!n&&(e&127)===0&&(e&t.expiredLanes)===0||ml(t,e),a=i?ex(t,e):$d(t,e,!0),r=i;do{if(a===0){js&&!i&&da(t,e,0,!1);break}else{if(n=t.current.alternate,r&&!ZR(n)){a=$d(t,e,!1),r=!1;continue}if(a===2){if(r=e,t.errorRecoveryDisabledLanes&r)var s=0;else s=t.pendingLanes&-536870913,s=s!==0?s:s&536870912?536870912:0;if(s!==0){e=s;e:{var o=t;a=Do;var l=o.current.memoizedState.isDehydrated;if(l&&(_s(o,s).flags|=256),s=$d(o,s,!1),s!==2){if(vp&&!l){o.errorRecoveryDisabledLanes|=r,ar|=r,a=4;break e}r=zt,zt=a,r!==null&&(zt===null?zt=r:zt.push.apply(zt,r))}a=s}if(r=!1,a!==2)continue}}if(a===1){_s(t,0),da(t,e,0,!0);break}e:{switch(i=t,r=a,r){case 0:case 1:throw Error(j(345));case 4:if((e&4194048)!==e)break;case 6:da(i,e,en,!ua);break e;case 2:zt=null;break;case 3:case 5:break;default:throw Error(j(329))}if((e&62914560)===e&&(a=Ju+300-nn(),10<a)){if(da(i,e,en,!ua),ju(i,0,!0)!==0)break e;Ai=e,i.timeoutHandle=rC(Hv.bind(null,i,n,zt,nu,wh,e,en,ar,ks,ua,r,"Throttled",-0,0),a);break e}Hv(i,n,zt,nu,wh,e,en,ar,ks,ua,r,null,-0,0)}}break}while(!0);ri(t)}function Hv(t,e,n,i,a,r,s,o,l,c,u,d,f,h){if(t.timeoutHandle=-1,d=e.subtreeFlags,d&8192||(d&16785408)===16785408){d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:wi},DT(e,r,d);var v=(r&62914560)===r?Ju-nn():(r&4194048)===r?IT-nn():0;if(v=Ix(d,v),v!==null){Ai=r,t.cancelPendingCommit=v(Gv.bind(null,t,e,r,n,i,a,s,o,l,u,d,null,f,h)),da(t,r,s,!c);return}}Gv(t,e,r,n,i,a,s,o,l)}function ZR(t){for(var e=t;;){var n=e.tag;if((n===0||n===11||n===15)&&e.flags&16384&&(n=e.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var i=0;i<n.length;i++){var a=n[i],r=a.getSnapshot;a=a.value;try{if(!ln(r(),a))return!1}catch{return!1}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function da(t,e,n,i){e&=~bp,e&=~ar,t.suspendedLanes|=e,t.pingedLanes&=~e,i&&(t.warmLanes|=e),i=t.expirationTimes;for(var a=e;0<a;){var r=31-rn(a),s=1<<r;i[r]=-1,a&=~s}n!==0&&Vy(t,n,e)}function Xu(){return be&6?!0:(Tl(0),!1)}function yp(){if(ce!==null){if(ke===0)var t=ce.return;else t=ce,Ri=Er=null,ap(t),as=null,Ko=0,t=ce;for(;t!==null;)bT(t.alternate,t),t=t.return;ce=null}}function _s(t,e){var n=t.timeoutHandle;n!==-1&&(t.timeoutHandle=-1,bx(n)),n=t.cancelPendingCommit,n!==null&&(t.cancelPendingCommit=null,n()),Ai=0,yp(),Ae=t,ce=n=xi(t.current,null),de=e,ke=0,$t=null,ua=!1,js=ml(t,e),vp=!1,ks=en=bp=ar=Ma=Ve=0,zt=Do=null,wh=!1,e&8&&(e|=e&32);var i=t.entangledLanes;if(i!==0)for(t=t.entanglements,i&=e;0<i;){var a=31-rn(i),r=1<<a;e|=t[a],i&=~r}return Ui=e,Fu(),n}function qT(t,e){ie=null,ee.H=Yo,e===Us||e===Hu?(e=Cv(),ke=3):e===$m?(e=Cv(),ke=4):ke=e===hp?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,$t=e,ce===null&&(Ve=1,Zc(t,Sn(e,t.current)))}function zT(){var t=cn.current;return t===null?!0:(de&4194048)===de?En===null:(de&62914560)===de||de&536870912?t===En:!1}function FT(){var t=ee.H;return ee.H=Yo,t===null?Yo:t}function VT(){var t=ee.A;return ee.A=XR,t}function iu(){Ve=4,ua||(de&4194048)!==de&&cn.current!==null||(js=!0),!(Ma&134217727)&&!(ar&134217727)||Ae===null||da(Ae,de,en,!1)}function $d(t,e,n){var i=be;be|=2;var a=FT(),r=VT();(Ae!==t||de!==e)&&(nu=null,_s(t,e)),e=!1;var s=Ve;e:do try{if(ke!==0&&ce!==null){var o=ce,l=$t;switch(ke){case 8:yp(),s=6;break e;case 3:case 2:case 9:case 6:cn.current===null&&(e=!0);var c=ke;if(ke=0,$t=null,Xr(t,o,l,c),n&&js){s=0;break e}break;default:c=ke,ke=0,$t=null,Xr(t,o,l,c)}}WR(),s=Ve;break}catch(u){qT(t,u)}while(!0);return e&&t.shellSuspendCounter++,Ri=Er=null,be=i,ee.H=a,ee.A=r,ce===null&&(Ae=null,de=0,Fu()),s}function WR(){for(;ce!==null;)HT(ce)}function ex(t,e){var n=be;be|=2;var i=FT(),a=VT();Ae!==t||de!==e?(nu=null,tu=nn()+500,_s(t,e)):js=ml(t,e);e:do try{if(ke!==0&&ce!==null){e=ce;var r=$t;t:switch(ke){case 1:ke=0,$t=null,Xr(t,e,r,1);break;case 2:case 9:if(Tv(r)){ke=0,$t=null,Kv(e);break}e=function(){ke!==2&&ke!==9||Ae!==t||(ke=7),ri(t)},r.then(e,e);break e;case 3:ke=7;break e;case 4:ke=5;break e;case 7:Tv(r)?(ke=0,$t=null,Kv(e)):(ke=0,$t=null,Xr(t,e,r,7));break;case 5:var s=null;switch(ce.tag){case 26:s=ce.memoizedState;case 5:case 27:var o=ce;if(s?uC(s):o.stateNode.complete){ke=0,$t=null;var l=o.sibling;if(l!==null)ce=l;else{var c=o.return;c!==null?(ce=c,$u(c)):ce=null}break t}}ke=0,$t=null,Xr(t,e,r,5);break;case 6:ke=0,$t=null,Xr(t,e,r,6);break;case 8:yp(),Ve=6;break e;default:throw Error(j(462))}}tx();break}catch(u){qT(t,u)}while(!0);return Ri=Er=null,ee.H=i,ee.A=a,be=n,ce!==null?0:(Ae=null,de=0,Fu(),Ve)}function tx(){for(;ce!==null&&!Ew();)HT(ce)}function HT(t){var e=vT(t.alternate,t,Ui);t.memoizedProps=t.pendingProps,e===null?$u(t):ce=e}function Kv(t){var e=t,n=e.alternate;switch(e.tag){case 15:case 0:e=jv(n,e,e.pendingProps,e.type,void 0,de);break;case 11:e=jv(n,e,e.pendingProps,e.type.render,e.ref,de);break;case 5:ap(e);default:bT(n,e),e=ce=bS(e,Ui),e=vT(n,e,Ui)}t.memoizedProps=t.pendingProps,e===null?$u(t):ce=e}function Xr(t,e,n,i){Ri=Er=null,ap(e),as=null,Ko=0;var a=e.return;try{if(VR(t,a,e,n,de)){Ve=1,Zc(t,Sn(n,t.current)),ce=null;return}}catch(r){if(a!==null)throw ce=a,r;Ve=1,Zc(t,Sn(n,t.current)),ce=null;return}e.flags&32768?(he||i===1?t=!0:js||de&536870912?t=!1:(ua=t=!0,(i===2||i===9||i===3||i===6)&&(i=cn.current,i!==null&&i.tag===13&&(i.flags|=16384))),KT(e,t)):$u(e)}function $u(t){var e=t;do{if(e.flags&32768){KT(e,ua);return}t=e.return;var n=GR(e.alternate,e,Ui);if(n!==null){ce=n;return}if(e=e.sibling,e!==null){ce=e;return}ce=e=t}while(e!==null);Ve===0&&(Ve=5)}function KT(t,e){do{var n=YR(t.alternate,t);if(n!==null){n.flags&=32767,ce=n;return}if(n=t.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!e&&(t=t.sibling,t!==null)){ce=t;return}ce=t=n}while(t!==null);Ve=6,ce=null}function Gv(t,e,n,i,a,r,s,o,l){t.cancelPendingCommit=null;do Zu();while(st!==0);if(be&6)throw Error(j(327));if(e!==null){if(e===t.current)throw Error(j(177));if(r=e.lanes|e.childLanes,r|=Hm,Nw(t,n,r,s,o,l),t===Ae&&(ce=Ae=null,de=0),Es=e,Ta=t,Ai=n,Rh=r,xh=a,UT=i,e.subtreeFlags&10256||e.flags&10256?(t.callbackNode=null,t.callbackPriority=0,rx(zc,function(){return XT(),null})):(t.callbackNode=null,t.callbackPriority=0),i=(e.flags&13878)!==0,e.subtreeFlags&13878||i){i=ee.T,ee.T=null,a=ye.p,ye.p=2,s=be,be|=4;try{QR(t,e,n)}finally{be=s,ye.p=a,ee.T=i}}st=1,GT(),YT(),QT()}}function GT(){if(st===1){st=0;var t=Ta,e=Es,n=(e.flags&13878)!==0;if(e.subtreeFlags&13878||n){n=ee.T,ee.T=null;var i=ye.p;ye.p=2;var a=be;be|=4;try{OT(e,t);var r=Ph,s=uS(t.containerInfo),o=r.focusedElem,l=r.selectionRange;if(s!==o&&o&&o.ownerDocument&&cS(o.ownerDocument.documentElement,o)){if(l!==null&&Vm(o)){var c=l.start,u=l.end;if(u===void 0&&(u=c),"selectionStart"in o)o.selectionStart=c,o.selectionEnd=Math.min(u,o.value.length);else{var d=o.ownerDocument||document,f=d&&d.defaultView||window;if(f.getSelection){var h=f.getSelection(),v=o.textContent.length,g=Math.min(l.start,v),C=l.end===void 0?g:Math.min(l.end,v);!h.extend&&g>C&&(s=C,C=g,g=s);var m=mv(o,g),b=mv(o,C);if(m&&b&&(h.rangeCount!==1||h.anchorNode!==m.node||h.anchorOffset!==m.offset||h.focusNode!==b.node||h.focusOffset!==b.offset)){var S=d.createRange();S.setStart(m.node,m.offset),h.removeAllRanges(),g>C?(h.addRange(S),h.extend(b.node,b.offset)):(S.setEnd(b.node,b.offset),h.addRange(S))}}}}for(d=[],h=o;h=h.parentNode;)h.nodeType===1&&d.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<d.length;o++){var p=d[o];p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}du=!!Dh,Ph=Dh=null}finally{be=a,ye.p=i,ee.T=n}}t.current=e,st=2}}function YT(){if(st===2){st=0;var t=Ta,e=Es,n=(e.flags&8772)!==0;if(e.subtreeFlags&8772||n){n=ee.T,ee.T=null;var i=ye.p;ye.p=2;var a=be;be|=4;try{ET(t,e.alternate,e)}finally{be=a,ye.p=i,ee.T=n}}st=3}}function QT(){if(st===4||st===3){st=0,_w();var t=Ta,e=Es,n=Ai,i=UT;e.subtreeFlags&10256||e.flags&10256?st=5:(st=0,Es=Ta=null,JT(t,t.pendingLanes));var a=t.pendingLanes;if(a===0&&(Sa=null),Im(n),e=e.stateNode,an&&typeof an.onCommitFiberRoot=="function")try{an.onCommitFiberRoot(hl,e,void 0,(e.current.flags&128)===128)}catch{}if(i!==null){e=ee.T,a=ye.p,ye.p=2,ee.T=null;try{for(var r=t.onRecoverableError,s=0;s<i.length;s++){var o=i[s];r(o.value,{componentStack:o.stack})}}finally{ee.T=e,ye.p=a}}Ai&3&&Zu(),ri(t),a=t.pendingLanes,n&261930&&a&42?t===Oh?Po++:(Po=0,Oh=t):Po=0,Tl(0)}}function JT(t,e){(t.pooledCacheLanes&=e)===0&&(e=t.pooledCache,e!=null&&(t.pooledCache=null,bl(e)))}function Zu(){return GT(),YT(),QT(),XT()}function XT(){if(st!==5)return!1;var t=Ta,e=Rh;Rh=0;var n=Im(Ai),i=ee.T,a=ye.p;try{ye.p=32>n?32:n,ee.T=null,n=xh,xh=null;var r=Ta,s=Ai;if(st=0,Es=Ta=null,Ai=0,be&6)throw Error(j(331));var o=be;if(be|=4,NT(r.current),MT(r,r.current,s,n),be=o,Tl(0,!1),an&&typeof an.onPostCommitFiberRoot=="function")try{an.onPostCommitFiberRoot(hl,r)}catch{}return!0}finally{ye.p=a,ee.T=i,JT(t,e)}}function Yv(t,e,n){e=Sn(n,e),e=Ch(t.stateNode,e,2),t=ya(t,e,2),t!==null&&(pl(t,2),ri(t))}function Ee(t,e,n){if(t.tag===3)Yv(t,t,n);else for(;e!==null;){if(e.tag===3){Yv(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Sa===null||!Sa.has(i))){t=Sn(n,t),n=dT(2),i=ya(e,n,2),i!==null&&(fT(n,i,e,t),pl(i,2),ri(i));break}}e=e.return}}function Zd(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new $R;var a=new Set;i.set(e,a)}else a=i.get(e),a===void 0&&(a=new Set,i.set(e,a));a.has(n)||(vp=!0,a.add(n),t=nx.bind(null,t,e,n),e.then(t,t))}function nx(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),t.pingedLanes|=t.suspendedLanes&n,t.warmLanes&=~n,Ae===t&&(de&n)===n&&(Ve===4||Ve===3&&(de&62914560)===de&&300>nn()-Ju?!(be&2)&&_s(t,0):bp|=n,ks===de&&(ks=0)),ri(t)}function $T(t,e){e===0&&(e=Fy()),t=kr(t,e),t!==null&&(pl(t,e),ri(t))}function ix(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),$T(t,n)}function ax(t,e){var n=0;switch(t.tag){case 31:case 13:var i=t.stateNode,a=t.memoizedState;a!==null&&(n=a.retryLane);break;case 19:i=t.stateNode;break;case 22:i=t.stateNode._retryCache;break;default:throw Error(j(314))}i!==null&&i.delete(e),$T(t,n)}function rx(t,e){return Nm(t,e)}var au=null,jr=null,Ah=!1,ru=!1,Wd=!1,fa=0;function ri(t){t!==jr&&t.next===null&&(jr===null?au=jr=t:jr=jr.next=t),ru=!0,Ah||(Ah=!0,ox())}function Tl(t,e){if(!Wd&&ru){Wd=!0;do for(var n=!1,i=au;i!==null;){if(t!==0){var a=i.pendingLanes;if(a===0)var r=0;else{var s=i.suspendedLanes,o=i.pingedLanes;r=(1<<31-rn(42|t)+1)-1,r&=a&~(s&~o),r=r&201326741?r&201326741|1:r?r|2:0}r!==0&&(n=!0,Qv(i,r))}else r=de,r=ju(i,i===Ae?r:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),!(r&3)||ml(i,r)||(n=!0,Qv(i,r));i=i.next}while(n);Wd=!1}}function sx(){ZT()}function ZT(){ru=Ah=!1;var t=0;fa!==0&&vx()&&(t=fa);for(var e=nn(),n=null,i=au;i!==null;){var a=i.next,r=WT(i,e);r===0?(i.next=null,n===null?au=a:n.next=a,a===null&&(jr=n)):(n=i,(t!==0||r&3)&&(ru=!0)),i=a}st!==0&&st!==5||Tl(t),fa!==0&&(fa=0)}function WT(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,a=t.expirationTimes,r=t.pendingLanes&-62914561;0<r;){var s=31-rn(r),o=1<<s,l=a[s];l===-1?(!(o&n)||o&i)&&(a[s]=Pw(o,e)):l<=e&&(t.expiredLanes|=o),r&=~o}if(e=Ae,n=de,n=ju(t,t===e?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),i=t.callbackNode,n===0||t===e&&(ke===2||ke===9)||t.cancelPendingCommit!==null)return i!==null&&i!==null&&Rd(i),t.callbackNode=null,t.callbackPriority=0;if(!(n&3)||ml(t,n)){if(e=n&-n,e===t.callbackPriority)return e;switch(i!==null&&Rd(i),Im(n)){case 2:case 8:n=qy;break;case 32:n=zc;break;case 268435456:n=zy;break;default:n=zc}return i=eC.bind(null,t),n=Nm(n,i),t.callbackPriority=e,t.callbackNode=n,e}return i!==null&&i!==null&&Rd(i),t.callbackPriority=2,t.callbackNode=null,2}function eC(t,e){if(st!==0&&st!==5)return t.callbackNode=null,t.callbackPriority=0,null;var n=t.callbackNode;if(Zu()&&t.callbackNode!==n)return null;var i=de;return i=ju(t,t===Ae?i:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),i===0?null:(BT(t,i,e),WT(t,nn()),t.callbackNode!=null&&t.callbackNode===n?eC.bind(null,t):null)}function Qv(t,e){if(Zu())return null;BT(t,e,!0)}function ox(){yx(function(){be&6?Nm(By,sx):ZT()})}function Sp(){if(fa===0){var t=Ss;t===0&&(t=Ll,Ll<<=1,!(Ll&261888)&&(Ll=256)),fa=t}return fa}function Jv(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:sc(""+t)}function Xv(t,e){var n=e.ownerDocument.createElement("input");return n.name=e.name,n.value=e.value,t.id&&n.setAttribute("form",t.id),e.parentNode.insertBefore(n,e),t=new FormData(t),n.parentNode.removeChild(n),t}function lx(t,e,n,i,a){if(e==="submit"&&n&&n.stateNode===a){var r=Jv((a[Kt]||null).action),s=i.submitter;s&&(e=(e=s[Kt]||null)?Jv(e.formAction):s.getAttribute("formAction"),e!==null&&(r=e,s=null));var o=new Bu("action","action",null,i,a);t.push({event:o,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(fa!==0){var l=s?Xv(a,s):new FormData(a);Sh(n,{pending:!0,data:l,method:a.method,action:r},null,l)}}else typeof r=="function"&&(o.preventDefault(),l=s?Xv(a,s):new FormData(a),Sh(n,{pending:!0,data:l,method:a.method,action:r},r,l))},currentTarget:a}]})}}for(var ef=0;ef<lh.length;ef++){var tf=lh[ef],cx=tf.toLowerCase(),ux=tf[0].toUpperCase()+tf.slice(1);Vn(cx,"on"+ux)}Vn(fS,"onAnimationEnd");Vn(hS,"onAnimationIteration");Vn(mS,"onAnimationStart");Vn("dblclick","onDoubleClick");Vn("focusin","onFocus");Vn("focusout","onBlur");Vn(wR,"onTransitionRun");Vn(RR,"onTransitionStart");Vn(xR,"onTransitionCancel");Vn(pS,"onTransitionEnd");bs("onMouseEnter",["mouseout","mouseover"]);bs("onMouseLeave",["mouseout","mouseover"]);bs("onPointerEnter",["pointerout","pointerover"]);bs("onPointerLeave",["pointerout","pointerover"]);Sr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Sr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Sr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Sr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Sr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Sr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dx=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Qo));function tC(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],a=i.event;i=i.listeners;e:{var r=void 0;if(e)for(var s=i.length-1;0<=s;s--){var o=i[s],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==r&&a.isPropagationStopped())break e;r=o,a.currentTarget=c;try{r(a)}catch(u){Vc(u)}a.currentTarget=null,r=l}else for(s=0;s<i.length;s++){if(o=i[s],l=o.instance,c=o.currentTarget,o=o.listener,l!==r&&a.isPropagationStopped())break e;r=o,a.currentTarget=c;try{r(a)}catch(u){Vc(u)}a.currentTarget=null,r=l}}}}function le(t,e){var n=e[eh];n===void 0&&(n=e[eh]=new Set);var i=t+"__bubble";n.has(i)||(nC(e,t,2,!1),n.add(i))}function nf(t,e,n){var i=0;e&&(i|=4),nC(n,t,i,e)}var Kl="_reactListening"+Math.random().toString(36).slice(2);function Tp(t){if(!t[Kl]){t[Kl]=!0,Yy.forEach(function(n){n!=="selectionchange"&&(dx.has(n)||nf(n,!1,t),nf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Kl]||(e[Kl]=!0,nf("selectionchange",!1,e))}}function nC(t,e,n,i){switch(pC(e)){case 2:var a=Bx;break;case 8:a=qx;break;default:a=_p}n=a.bind(null,e,n,t),a=void 0,!rh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(a=!0),i?a!==void 0?t.addEventListener(e,n,{capture:!0,passive:a}):t.addEventListener(e,n,!0):a!==void 0?t.addEventListener(e,n,{passive:a}):t.addEventListener(e,n,!1)}function af(t,e,n,i,a){var r=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var s=i.tag;if(s===3||s===4){var o=i.stateNode.containerInfo;if(o===a)break;if(s===4)for(s=i.return;s!==null;){var l=s.tag;if((l===3||l===4)&&s.stateNode.containerInfo===a)return;s=s.return}for(;o!==null;){if(s=zr(o),s===null)return;if(l=s.tag,l===5||l===6||l===26||l===27){i=r=s;continue e}o=o.parentNode}}i=i.return}tS(function(){var c=r,u=Bm(n),d=[];e:{var f=gS.get(t);if(f!==void 0){var h=Bu,v=t;switch(t){case"keypress":if(lc(n)===0)break e;case"keydown":case"keyup":h=aR;break;case"focusin":v="focus",h=Dd;break;case"focusout":v="blur",h=Dd;break;case"beforeblur":case"afterblur":h=Dd;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=av;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=Gw;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=oR;break;case fS:case hS:case mS:h=Jw;break;case pS:h=cR;break;case"scroll":case"scrollend":h=Hw;break;case"wheel":h=dR;break;case"copy":case"cut":case"paste":h=$w;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=sv;break;case"toggle":case"beforetoggle":h=hR}var g=(e&4)!==0,C=!g&&(t==="scroll"||t==="scrollend"),m=g?f!==null?f+"Capture":null:f;g=[];for(var b=c,S;b!==null;){var p=b;if(S=p.stateNode,p=p.tag,p!==5&&p!==26&&p!==27||S===null||m===null||(p=qo(b,m),p!=null&&g.push(Jo(b,p,S))),C)break;b=b.return}0<g.length&&(f=new h(f,v,null,n,u),d.push({event:f,listeners:g}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",f&&n!==ah&&(v=n.relatedTarget||n.fromElement)&&(zr(v)||v[Ns]))break e;if((h||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,h?(v=n.relatedTarget||n.toElement,h=c,v=v?zr(v):null,v!==null&&(C=fl(v),g=v.tag,v!==C||g!==5&&g!==27&&g!==6)&&(v=null)):(h=null,v=c),h!==v)){if(g=av,p="onMouseLeave",m="onMouseEnter",b="mouse",(t==="pointerout"||t==="pointerover")&&(g=sv,p="onPointerLeave",m="onPointerEnter",b="pointer"),C=h==null?f:mo(h),S=v==null?f:mo(v),f=new g(p,b+"leave",h,n,u),f.target=C,f.relatedTarget=S,p=null,zr(u)===c&&(g=new g(m,b+"enter",v,n,u),g.target=S,g.relatedTarget=C,p=g),C=p,h&&v)t:{for(g=fx,m=h,b=v,S=0,p=m;p;p=g(p))S++;p=0;for(var y=b;y;y=g(y))p++;for(;0<S-p;)m=g(m),S--;for(;0<p-S;)b=g(b),p--;for(;S--;){if(m===b||b!==null&&m===b.alternate){g=m;break t}m=g(m),b=g(b)}g=null}else g=null;h!==null&&$v(d,f,h,g,!1),v!==null&&C!==null&&$v(d,C,v,g,!0)}}e:{if(f=c?mo(c):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var k=uv;else if(cv(f))if(oS)k=kR;else{k=TR;var _=SR}else h=f.nodeName,!h||h.toLowerCase()!=="input"||f.type!=="checkbox"&&f.type!=="radio"?c&&jm(c.elementType)&&(k=uv):k=CR;if(k&&(k=k(t,c))){sS(d,k,n,u);break e}_&&_(t,f,c),t==="focusout"&&c&&f.type==="number"&&c.memoizedProps.value!=null&&ih(f,"number",f.value)}switch(_=c?mo(c):window,t){case"focusin":(cv(_)||_.contentEditable==="true")&&(Hr=_,sh=c,Eo=null);break;case"focusout":Eo=sh=Hr=null;break;case"mousedown":oh=!0;break;case"contextmenu":case"mouseup":case"dragend":oh=!1,pv(d,n,u);break;case"selectionchange":if(_R)break;case"keydown":case"keyup":pv(d,n,u)}var O;if(Fm)e:{switch(t){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Vr?aS(t,n)&&(w="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(w="onCompositionStart");w&&(iS&&n.locale!=="ko"&&(Vr||w!=="onCompositionStart"?w==="onCompositionEnd"&&Vr&&(O=nS()):(ca=u,qm="value"in ca?ca.value:ca.textContent,Vr=!0)),_=su(c,w),0<_.length&&(w=new rv(w,t,null,n,u),d.push({event:w,listeners:_}),O?w.data=O:(O=rS(n),O!==null&&(w.data=O)))),(O=pR?gR(t,n):vR(t,n))&&(w=su(c,"onBeforeInput"),0<w.length&&(_=new rv("onBeforeInput","beforeinput",null,n,u),d.push({event:_,listeners:w}),_.data=O)),lx(d,t,c,n,u)}tC(d,e)})}function Jo(t,e,n){return{instance:t,listener:e,currentTarget:n}}function su(t,e){for(var n=e+"Capture",i=[];t!==null;){var a=t,r=a.stateNode;if(a=a.tag,a!==5&&a!==26&&a!==27||r===null||(a=qo(t,n),a!=null&&i.unshift(Jo(t,a,r)),a=qo(t,e),a!=null&&i.push(Jo(t,a,r))),t.tag===3)return i;t=t.return}return[]}function fx(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function $v(t,e,n,i,a){for(var r=e._reactName,s=[];n!==null&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(o=o.tag,l!==null&&l===i)break;o!==5&&o!==26&&o!==27||c===null||(l=c,a?(c=qo(n,r),c!=null&&s.unshift(Jo(n,c,l))):a||(c=qo(n,r),c!=null&&s.push(Jo(n,c,l)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var hx=/\r\n?/g,mx=/\u0000|\uFFFD/g;function Zv(t){return(typeof t=="string"?t:""+t).replace(hx,`
`).replace(mx,"")}function iC(t,e){return e=Zv(e),Zv(t)===e}function _e(t,e,n,i,a,r){switch(n){case"children":typeof i=="string"?e==="body"||e==="textarea"&&i===""||ys(t,i):(typeof i=="number"||typeof i=="bigint")&&e!=="body"&&ys(t,""+i);break;case"className":jl(t,"class",i);break;case"tabIndex":jl(t,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":jl(t,n,i);break;case"style":eS(t,i,r);break;case"data":if(e!=="object"){jl(t,"data",i);break}case"src":case"href":if(i===""&&(e!=="a"||n!=="href")){t.removeAttribute(n);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){t.removeAttribute(n);break}i=sc(""+i),t.setAttribute(n,i);break;case"action":case"formAction":if(typeof i=="function"){t.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof r=="function"&&(n==="formAction"?(e!=="input"&&_e(t,e,"name",a.name,a,null),_e(t,e,"formEncType",a.formEncType,a,null),_e(t,e,"formMethod",a.formMethod,a,null),_e(t,e,"formTarget",a.formTarget,a,null)):(_e(t,e,"encType",a.encType,a,null),_e(t,e,"method",a.method,a,null),_e(t,e,"target",a.target,a,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){t.removeAttribute(n);break}i=sc(""+i),t.setAttribute(n,i);break;case"onClick":i!=null&&(t.onclick=wi);break;case"onScroll":i!=null&&le("scroll",t);break;case"onScrollEnd":i!=null&&le("scrollend",t);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(j(61));if(n=i.__html,n!=null){if(a.children!=null)throw Error(j(60));t.innerHTML=n}}break;case"multiple":t.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":t.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){t.removeAttribute("xlink:href");break}n=sc(""+i),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,""+i):t.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,""):t.removeAttribute(n);break;case"capture":case"download":i===!0?t.setAttribute(n,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,i):t.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?t.setAttribute(n,i):t.removeAttribute(n);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?t.removeAttribute(n):t.setAttribute(n,i);break;case"popover":le("beforetoggle",t),le("toggle",t),rc(t,"popover",i);break;case"xlinkActuate":di(t,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":di(t,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":di(t,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":di(t,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":di(t,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":di(t,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":di(t,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":di(t,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":di(t,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":rc(t,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(n=Fw.get(n)||n,rc(t,n,i))}}function Mh(t,e,n,i,a,r){switch(n){case"style":eS(t,i,r);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(j(61));if(n=i.__html,n!=null){if(a.children!=null)throw Error(j(60));t.innerHTML=n}}break;case"children":typeof i=="string"?ys(t,i):(typeof i=="number"||typeof i=="bigint")&&ys(t,""+i);break;case"onScroll":i!=null&&le("scroll",t);break;case"onScrollEnd":i!=null&&le("scrollend",t);break;case"onClick":i!=null&&(t.onclick=wi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Qy.hasOwnProperty(n))e:{if(n[0]==="o"&&n[1]==="n"&&(a=n.endsWith("Capture"),e=n.slice(2,a?n.length-7:void 0),r=t[Kt]||null,r=r!=null?r[n]:null,typeof r=="function"&&t.removeEventListener(e,r,a),typeof i=="function")){typeof r!="function"&&r!==null&&(n in t?t[n]=null:t.hasAttribute(n)&&t.removeAttribute(n)),t.addEventListener(e,i,a);break e}n in t?t[n]=i:i===!0?t.setAttribute(n,""):rc(t,n,i)}}}function kt(t,e,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":le("error",t),le("load",t);var i=!1,a=!1,r;for(r in n)if(n.hasOwnProperty(r)){var s=n[r];if(s!=null)switch(r){case"src":i=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(j(137,e));default:_e(t,e,r,s,n,null)}}a&&_e(t,e,"srcSet",n.srcSet,n,null),i&&_e(t,e,"src",n.src,n,null);return;case"input":le("invalid",t);var o=r=s=a=null,l=null,c=null;for(i in n)if(n.hasOwnProperty(i)){var u=n[i];if(u!=null)switch(i){case"name":a=u;break;case"type":s=u;break;case"checked":l=u;break;case"defaultChecked":c=u;break;case"value":r=u;break;case"defaultValue":o=u;break;case"children":case"dangerouslySetInnerHTML":if(u!=null)throw Error(j(137,e));break;default:_e(t,e,i,u,n,null)}}$y(t,r,o,l,c,s,a,!1);return;case"select":le("invalid",t),i=s=r=null;for(a in n)if(n.hasOwnProperty(a)&&(o=n[a],o!=null))switch(a){case"value":r=o;break;case"defaultValue":s=o;break;case"multiple":i=o;default:_e(t,e,a,o,n,null)}e=r,n=s,t.multiple=!!i,e!=null?ts(t,!!i,e,!1):n!=null&&ts(t,!!i,n,!0);return;case"textarea":le("invalid",t),r=a=i=null;for(s in n)if(n.hasOwnProperty(s)&&(o=n[s],o!=null))switch(s){case"value":i=o;break;case"defaultValue":a=o;break;case"children":r=o;break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(j(91));break;default:_e(t,e,s,o,n,null)}Wy(t,i,a,r);return;case"option":for(l in n)if(n.hasOwnProperty(l)&&(i=n[l],i!=null))switch(l){case"selected":t.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:_e(t,e,l,i,n,null)}return;case"dialog":le("beforetoggle",t),le("toggle",t),le("cancel",t),le("close",t);break;case"iframe":case"object":le("load",t);break;case"video":case"audio":for(i=0;i<Qo.length;i++)le(Qo[i],t);break;case"image":le("error",t),le("load",t);break;case"details":le("toggle",t);break;case"embed":case"source":case"link":le("error",t),le("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in n)if(n.hasOwnProperty(c)&&(i=n[c],i!=null))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(j(137,e));default:_e(t,e,c,i,n,null)}return;default:if(jm(e)){for(u in n)n.hasOwnProperty(u)&&(i=n[u],i!==void 0&&Mh(t,e,u,i,n,void 0));return}}for(o in n)n.hasOwnProperty(o)&&(i=n[o],i!=null&&_e(t,e,o,i,n,null))}function px(t,e,n,i){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,r=null,s=null,o=null,l=null,c=null,u=null;for(h in n){var d=n[h];if(n.hasOwnProperty(h)&&d!=null)switch(h){case"checked":break;case"value":break;case"defaultValue":l=d;default:i.hasOwnProperty(h)||_e(t,e,h,null,i,d)}}for(var f in i){var h=i[f];if(d=n[f],i.hasOwnProperty(f)&&(h!=null||d!=null))switch(f){case"type":r=h;break;case"name":a=h;break;case"checked":c=h;break;case"defaultChecked":u=h;break;case"value":s=h;break;case"defaultValue":o=h;break;case"children":case"dangerouslySetInnerHTML":if(h!=null)throw Error(j(137,e));break;default:h!==d&&_e(t,e,f,h,i,d)}}nh(t,s,o,l,c,u,r,a);return;case"select":h=s=o=f=null;for(r in n)if(l=n[r],n.hasOwnProperty(r)&&l!=null)switch(r){case"value":break;case"multiple":h=l;default:i.hasOwnProperty(r)||_e(t,e,r,null,i,l)}for(a in i)if(r=i[a],l=n[a],i.hasOwnProperty(a)&&(r!=null||l!=null))switch(a){case"value":f=r;break;case"defaultValue":o=r;break;case"multiple":s=r;default:r!==l&&_e(t,e,a,r,i,l)}e=o,n=s,i=h,f!=null?ts(t,!!n,f,!1):!!i!=!!n&&(e!=null?ts(t,!!n,e,!0):ts(t,!!n,n?[]:"",!1));return;case"textarea":h=f=null;for(o in n)if(a=n[o],n.hasOwnProperty(o)&&a!=null&&!i.hasOwnProperty(o))switch(o){case"value":break;case"children":break;default:_e(t,e,o,null,i,a)}for(s in i)if(a=i[s],r=n[s],i.hasOwnProperty(s)&&(a!=null||r!=null))switch(s){case"value":f=a;break;case"defaultValue":h=a;break;case"children":break;case"dangerouslySetInnerHTML":if(a!=null)throw Error(j(91));break;default:a!==r&&_e(t,e,s,a,i,r)}Zy(t,f,h);return;case"option":for(var v in n)if(f=n[v],n.hasOwnProperty(v)&&f!=null&&!i.hasOwnProperty(v))switch(v){case"selected":t.selected=!1;break;default:_e(t,e,v,null,i,f)}for(l in i)if(f=i[l],h=n[l],i.hasOwnProperty(l)&&f!==h&&(f!=null||h!=null))switch(l){case"selected":t.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:_e(t,e,l,f,i,h)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in n)f=n[g],n.hasOwnProperty(g)&&f!=null&&!i.hasOwnProperty(g)&&_e(t,e,g,null,i,f);for(c in i)if(f=i[c],h=n[c],i.hasOwnProperty(c)&&f!==h&&(f!=null||h!=null))switch(c){case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(j(137,e));break;default:_e(t,e,c,f,i,h)}return;default:if(jm(e)){for(var C in n)f=n[C],n.hasOwnProperty(C)&&f!==void 0&&!i.hasOwnProperty(C)&&Mh(t,e,C,void 0,i,f);for(u in i)f=i[u],h=n[u],!i.hasOwnProperty(u)||f===h||f===void 0&&h===void 0||Mh(t,e,u,f,i,h);return}}for(var m in n)f=n[m],n.hasOwnProperty(m)&&f!=null&&!i.hasOwnProperty(m)&&_e(t,e,m,null,i,f);for(d in i)f=i[d],h=n[d],!i.hasOwnProperty(d)||f===h||f==null&&h==null||_e(t,e,d,f,i,h)}function Wv(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function gx(){if(typeof performance.getEntriesByType=="function"){for(var t=0,e=0,n=performance.getEntriesByType("resource"),i=0;i<n.length;i++){var a=n[i],r=a.transferSize,s=a.initiatorType,o=a.duration;if(r&&o&&Wv(s)){for(s=0,o=a.responseEnd,i+=1;i<n.length;i++){var l=n[i],c=l.startTime;if(c>o)break;var u=l.transferSize,d=l.initiatorType;u&&Wv(d)&&(l=l.responseEnd,s+=u*(l<o?1:(o-c)/(l-c)))}if(--i,e+=8*(r+s)/(a.duration/1e3),t++,10<t)break}}if(0<t)return e/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Dh=null,Ph=null;function ou(t){return t.nodeType===9?t:t.ownerDocument}function e0(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function aC(t,e){if(t===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&e==="foreignObject"?0:t}function Nh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var rf=null;function vx(){var t=window.event;return t&&t.type==="popstate"?t===rf?!1:(rf=t,!0):(rf=null,!1)}var rC=typeof setTimeout=="function"?setTimeout:void 0,bx=typeof clearTimeout=="function"?clearTimeout:void 0,t0=typeof Promise=="function"?Promise:void 0,yx=typeof queueMicrotask=="function"?queueMicrotask:typeof t0<"u"?function(t){return t0.resolve(null).then(t).catch(Sx)}:rC;function Sx(t){setTimeout(function(){throw t})}function Ua(t){return t==="head"}function n0(t,e){var n=e,i=0;do{var a=n.nextSibling;if(t.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"||n==="/&"){if(i===0){t.removeChild(a),Rs(e);return}i--}else if(n==="$"||n==="$?"||n==="$~"||n==="$!"||n==="&")i++;else if(n==="html")No(t.ownerDocument.documentElement);else if(n==="head"){n=t.ownerDocument.head,No(n);for(var r=n.firstChild;r;){var s=r.nextSibling,o=r.nodeName;r[gl]||o==="SCRIPT"||o==="STYLE"||o==="LINK"&&r.rel.toLowerCase()==="stylesheet"||n.removeChild(r),r=s}}else n==="body"&&No(t.ownerDocument.body);n=a}while(n);Rs(e)}function i0(t,e){var n=t;t=0;do{var i=n.nextSibling;if(n.nodeType===1?e?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",n.getAttribute("style")===""&&n.removeAttribute("style")):n.nodeType===3&&(e?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(t===0)break;t--}else n!=="$"&&n!=="$?"&&n!=="$~"&&n!=="$!"||t++;n=i}while(n)}function Lh(t){var e=t.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var n=e;switch(e=e.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Lh(n),Um(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(n.rel.toLowerCase()==="stylesheet")continue}t.removeChild(n)}}function Tx(t,e,n,i){for(;t.nodeType===1;){var a=n;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!i&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(i){if(!t[gl])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(r=t.getAttribute("rel"),r==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(r!==a.rel||t.getAttribute("href")!==(a.href==null||a.href===""?null:a.href)||t.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin)||t.getAttribute("title")!==(a.title==null?null:a.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(r=t.getAttribute("src"),(r!==(a.src==null?null:a.src)||t.getAttribute("type")!==(a.type==null?null:a.type)||t.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin))&&r&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(e==="input"&&t.type==="hidden"){var r=a.name==null?null:""+a.name;if(a.type==="hidden"&&t.getAttribute("name")===r)return t}else return t;if(t=_n(t.nextSibling),t===null)break}return null}function Cx(t,e,n){if(e==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=_n(t.nextSibling),t===null))return null;return t}function sC(t,e){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!e||(t=_n(t.nextSibling),t===null))return null;return t}function Ih(t){return t.data==="$?"||t.data==="$~"}function Uh(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function kx(t,e){var n=t.ownerDocument;if(t.data==="$~")t._reactRetry=e;else if(t.data!=="$?"||n.readyState!=="loading")e();else{var i=function(){e(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),t._reactRetry=i}}function _n(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?"||e==="$~"||e==="&"||e==="F!"||e==="F")break;if(e==="/$"||e==="/&")return null}}return t}var jh=null;function a0(t){t=t.nextSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"||n==="/&"){if(e===0)return _n(t.nextSibling);e--}else n!=="$"&&n!=="$!"&&n!=="$?"&&n!=="$~"&&n!=="&"||e++}t=t.nextSibling}return null}function r0(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"){if(e===0)return t;e--}else n!=="/$"&&n!=="/&"||e++}t=t.previousSibling}return null}function oC(t,e,n){switch(e=ou(n),t){case"html":if(t=e.documentElement,!t)throw Error(j(452));return t;case"head":if(t=e.head,!t)throw Error(j(453));return t;case"body":if(t=e.body,!t)throw Error(j(454));return t;default:throw Error(j(451))}}function No(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);Um(t)}var Rn=new Map,s0=new Set;function lu(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Vi=ye.d;ye.d={f:Ex,r:_x,D:wx,C:Rx,L:xx,m:Ox,X:Mx,S:Ax,M:Dx};function Ex(){var t=Vi.f(),e=Xu();return t||e}function _x(t){var e=Ls(t);e!==null&&e.tag===5&&e.type==="form"?eT(e):Vi.r(t)}var Bs=typeof document>"u"?null:document;function lC(t,e,n){var i=Bs;if(i&&typeof e=="string"&&e){var a=yn(e);a='link[rel="'+t+'"][href="'+a+'"]',typeof n=="string"&&(a+='[crossorigin="'+n+'"]'),s0.has(a)||(s0.add(a),t={rel:t,crossOrigin:n,href:e},i.querySelector(a)===null&&(e=i.createElement("link"),kt(e,"link",t),ht(e),i.head.appendChild(e)))}}function wx(t){Vi.D(t),lC("dns-prefetch",t,null)}function Rx(t,e){Vi.C(t,e),lC("preconnect",t,e)}function xx(t,e,n){Vi.L(t,e,n);var i=Bs;if(i&&t&&e){var a='link[rel="preload"][as="'+yn(e)+'"]';e==="image"&&n&&n.imageSrcSet?(a+='[imagesrcset="'+yn(n.imageSrcSet)+'"]',typeof n.imageSizes=="string"&&(a+='[imagesizes="'+yn(n.imageSizes)+'"]')):a+='[href="'+yn(t)+'"]';var r=a;switch(e){case"style":r=ws(t);break;case"script":r=qs(t)}Rn.has(r)||(t=Le({rel:"preload",href:e==="image"&&n&&n.imageSrcSet?void 0:t,as:e},n),Rn.set(r,t),i.querySelector(a)!==null||e==="style"&&i.querySelector(Cl(r))||e==="script"&&i.querySelector(kl(r))||(e=i.createElement("link"),kt(e,"link",t),ht(e),i.head.appendChild(e)))}}function Ox(t,e){Vi.m(t,e);var n=Bs;if(n&&t){var i=e&&typeof e.as=="string"?e.as:"script",a='link[rel="modulepreload"][as="'+yn(i)+'"][href="'+yn(t)+'"]',r=a;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=qs(t)}if(!Rn.has(r)&&(t=Le({rel:"modulepreload",href:t},e),Rn.set(r,t),n.querySelector(a)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(kl(r)))return}i=n.createElement("link"),kt(i,"link",t),ht(i),n.head.appendChild(i)}}}function Ax(t,e,n){Vi.S(t,e,n);var i=Bs;if(i&&t){var a=es(i).hoistableStyles,r=ws(t);e=e||"default";var s=a.get(r);if(!s){var o={loading:0,preload:null};if(s=i.querySelector(Cl(r)))o.loading=5;else{t=Le({rel:"stylesheet",href:t,"data-precedence":e},n),(n=Rn.get(r))&&Cp(t,n);var l=s=i.createElement("link");ht(l),kt(l,"link",t),l._p=new Promise(function(c,u){l.onload=c,l.onerror=u}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,gc(s,e,i)}s={type:"stylesheet",instance:s,count:1,state:o},a.set(r,s)}}}function Mx(t,e){Vi.X(t,e);var n=Bs;if(n&&t){var i=es(n).hoistableScripts,a=qs(t),r=i.get(a);r||(r=n.querySelector(kl(a)),r||(t=Le({src:t,async:!0},e),(e=Rn.get(a))&&kp(t,e),r=n.createElement("script"),ht(r),kt(r,"link",t),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},i.set(a,r))}}function Dx(t,e){Vi.M(t,e);var n=Bs;if(n&&t){var i=es(n).hoistableScripts,a=qs(t),r=i.get(a);r||(r=n.querySelector(kl(a)),r||(t=Le({src:t,async:!0,type:"module"},e),(e=Rn.get(a))&&kp(t,e),r=n.createElement("script"),ht(r),kt(r,"link",t),n.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},i.set(a,r))}}function o0(t,e,n,i){var a=(a=ga.current)?lu(a):null;if(!a)throw Error(j(446));switch(t){case"meta":case"title":return null;case"style":return typeof n.precedence=="string"&&typeof n.href=="string"?(e=ws(n.href),n=es(a).hoistableStyles,i=n.get(e),i||(i={type:"style",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(n.rel==="stylesheet"&&typeof n.href=="string"&&typeof n.precedence=="string"){t=ws(n.href);var r=es(a).hoistableStyles,s=r.get(t);if(s||(a=a.ownerDocument||a,s={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},r.set(t,s),(r=a.querySelector(Cl(t)))&&!r._p&&(s.instance=r,s.state.loading=5),Rn.has(t)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},Rn.set(t,n),r||Px(a,t,n,s.state))),e&&i===null)throw Error(j(528,""));return s}if(e&&i!==null)throw Error(j(529,""));return null;case"script":return e=n.async,n=n.src,typeof n=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=qs(n),n=es(a).hoistableScripts,i=n.get(e),i||(i={type:"script",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(j(444,t))}}function ws(t){return'href="'+yn(t)+'"'}function Cl(t){return'link[rel="stylesheet"]['+t+"]"}function cC(t){return Le({},t,{"data-precedence":t.precedence,precedence:null})}function Px(t,e,n,i){t.querySelector('link[rel="preload"][as="style"]['+e+"]")?i.loading=1:(e=t.createElement("link"),i.preload=e,e.addEventListener("load",function(){return i.loading|=1}),e.addEventListener("error",function(){return i.loading|=2}),kt(e,"link",n),ht(e),t.head.appendChild(e))}function qs(t){return'[src="'+yn(t)+'"]'}function kl(t){return"script[async]"+t}function l0(t,e,n){if(e.count++,e.instance===null)switch(e.type){case"style":var i=t.querySelector('style[data-href~="'+yn(n.href)+'"]');if(i)return e.instance=i,ht(i),i;var a=Le({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return i=(t.ownerDocument||t).createElement("style"),ht(i),kt(i,"style",a),gc(i,n.precedence,t),e.instance=i;case"stylesheet":a=ws(n.href);var r=t.querySelector(Cl(a));if(r)return e.state.loading|=4,e.instance=r,ht(r),r;i=cC(n),(a=Rn.get(a))&&Cp(i,a),r=(t.ownerDocument||t).createElement("link"),ht(r);var s=r;return s._p=new Promise(function(o,l){s.onload=o,s.onerror=l}),kt(r,"link",i),e.state.loading|=4,gc(r,n.precedence,t),e.instance=r;case"script":return r=qs(n.src),(a=t.querySelector(kl(r)))?(e.instance=a,ht(a),a):(i=n,(a=Rn.get(r))&&(i=Le({},n),kp(i,a)),t=t.ownerDocument||t,a=t.createElement("script"),ht(a),kt(a,"link",i),t.head.appendChild(a),e.instance=a);case"void":return null;default:throw Error(j(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(i=e.instance,e.state.loading|=4,gc(i,n.precedence,t));return e.instance}function gc(t,e,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),a=i.length?i[i.length-1]:null,r=a,s=0;s<i.length;s++){var o=i[s];if(o.dataset.precedence===e)r=o;else if(r!==a)break}r?r.parentNode.insertBefore(t,r.nextSibling):(e=n.nodeType===9?n.head:n,e.insertBefore(t,e.firstChild))}function Cp(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.title==null&&(t.title=e.title)}function kp(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.integrity==null&&(t.integrity=e.integrity)}var vc=null;function c0(t,e,n){if(vc===null){var i=new Map,a=vc=new Map;a.set(n,i)}else a=vc,i=a.get(n),i||(i=new Map,a.set(n,i));if(i.has(t))return i;for(i.set(t,null),n=n.getElementsByTagName(t),a=0;a<n.length;a++){var r=n[a];if(!(r[gl]||r[bt]||t==="link"&&r.getAttribute("rel")==="stylesheet")&&r.namespaceURI!=="http://www.w3.org/2000/svg"){var s=r.getAttribute(e)||"";s=t+s;var o=i.get(s);o?o.push(r):i.set(s,[r])}}return i}function u0(t,e,n){t=t.ownerDocument||t,t.head.insertBefore(n,e==="title"?t.querySelector("head > title"):null)}function Nx(t,e,n){if(n===1||e.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return t=e.disabled,typeof e.precedence=="string"&&t==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function uC(t){return!(t.type==="stylesheet"&&!(t.state.loading&3))}function Lx(t,e,n,i){if(n.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&!(n.state.loading&4)){if(n.instance===null){var a=ws(i.href),r=e.querySelector(Cl(a));if(r){e=r._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(t.count++,t=cu.bind(t),e.then(t,t)),n.state.loading|=4,n.instance=r,ht(r);return}r=e.ownerDocument||e,i=cC(i),(a=Rn.get(a))&&Cp(i,a),r=r.createElement("link"),ht(r);var s=r;s._p=new Promise(function(o,l){s.onload=o,s.onerror=l}),kt(r,"link",i),n.instance=r}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(n,e),(e=n.state.preload)&&!(n.state.loading&3)&&(t.count++,n=cu.bind(t),e.addEventListener("load",n),e.addEventListener("error",n))}}var sf=0;function Ix(t,e){return t.stylesheets&&t.count===0&&bc(t,t.stylesheets),0<t.count||0<t.imgCount?function(n){var i=setTimeout(function(){if(t.stylesheets&&bc(t,t.stylesheets),t.unsuspend){var r=t.unsuspend;t.unsuspend=null,r()}},6e4+e);0<t.imgBytes&&sf===0&&(sf=62500*gx());var a=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&bc(t,t.stylesheets),t.unsuspend)){var r=t.unsuspend;t.unsuspend=null,r()}},(t.imgBytes>sf?50:800)+e);return t.unsuspend=n,function(){t.unsuspend=null,clearTimeout(i),clearTimeout(a)}}:null}function cu(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)bc(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var uu=null;function bc(t,e){t.stylesheets=null,t.unsuspend!==null&&(t.count++,uu=new Map,e.forEach(Ux,t),uu=null,cu.call(t))}function Ux(t,e){if(!(e.state.loading&4)){var n=uu.get(t);if(n)var i=n.get(null);else{n=new Map,uu.set(t,n);for(var a=t.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<a.length;r++){var s=a[r];(s.nodeName==="LINK"||s.getAttribute("media")!=="not all")&&(n.set(s.dataset.precedence,s),i=s)}i&&n.set(null,i)}a=e.instance,s=a.getAttribute("data-precedence"),r=n.get(s)||i,r===i&&n.set(null,a),n.set(s,a),this.count++,i=cu.bind(this),a.addEventListener("load",i),a.addEventListener("error",i),r?r.parentNode.insertBefore(a,r.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(a,t.firstChild)),e.state.loading|=4}}var Xo={$$typeof:_i,Provider:null,Consumer:null,_currentValue:er,_currentValue2:er,_threadCount:0};function jx(t,e,n,i,a,r,s,o,l){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=xd(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xd(0),this.hiddenUpdates=xd(null),this.identifierPrefix=i,this.onUncaughtError=a,this.onCaughtError=r,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function dC(t,e,n,i,a,r,s,o,l,c,u,d){return t=new jx(t,e,n,s,l,c,u,d,o),e=1,r===!0&&(e|=24),r=Wt(3,null,null,e),t.current=r,r.stateNode=t,e=Jm(),e.refCount++,t.pooledCache=e,e.refCount++,r.memoizedState={element:i,isDehydrated:n,cache:e},Zm(r),t}function fC(t){return t?(t=Yr,t):Yr}function hC(t,e,n,i,a,r){a=fC(a),i.context===null?i.context=a:i.pendingContext=a,i=ba(e),i.payload={element:n},r=r===void 0?null:r,r!==null&&(i.callback=r),n=ya(t,i,e),n!==null&&(Ht(n,t,e),wo(n,t,e))}function d0(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ep(t,e){d0(t,e),(t=t.alternate)&&d0(t,e)}function mC(t){if(t.tag===13||t.tag===31){var e=kr(t,67108864);e!==null&&Ht(e,t,67108864),Ep(t,67108864)}}function f0(t){if(t.tag===13||t.tag===31){var e=sn();e=Lm(e);var n=kr(t,e);n!==null&&Ht(n,t,e),Ep(t,e)}}var du=!0;function Bx(t,e,n,i){var a=ee.T;ee.T=null;var r=ye.p;try{ye.p=2,_p(t,e,n,i)}finally{ye.p=r,ee.T=a}}function qx(t,e,n,i){var a=ee.T;ee.T=null;var r=ye.p;try{ye.p=8,_p(t,e,n,i)}finally{ye.p=r,ee.T=a}}function _p(t,e,n,i){if(du){var a=Bh(i);if(a===null)af(t,e,i,fu,n),h0(t,i);else if(Fx(a,t,e,n,i))i.stopPropagation();else if(h0(t,i),e&4&&-1<zx.indexOf(t)){for(;a!==null;){var r=Ls(a);if(r!==null)switch(r.tag){case 3:if(r=r.stateNode,r.current.memoizedState.isDehydrated){var s=Qa(r.pendingLanes);if(s!==0){var o=r;for(o.pendingLanes|=2,o.entangledLanes|=2;s;){var l=1<<31-rn(s);o.entanglements[1]|=l,s&=~l}ri(r),!(be&6)&&(tu=nn()+500,Tl(0))}}break;case 31:case 13:o=kr(r,2),o!==null&&Ht(o,r,2),Xu(),Ep(r,2)}if(r=Bh(i),r===null&&af(t,e,i,fu,n),r===a)break;a=r}a!==null&&i.stopPropagation()}else af(t,e,i,null,n)}}function Bh(t){return t=Bm(t),wp(t)}var fu=null;function wp(t){if(fu=null,t=zr(t),t!==null){var e=fl(t);if(e===null)t=null;else{var n=e.tag;if(n===13){if(t=Ny(e),t!==null)return t;t=null}else if(n===31){if(t=Ly(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return fu=t,null}function pC(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ww()){case By:return 2;case qy:return 8;case zc:case Rw:return 32;case zy:return 268435456;default:return 32}default:return 32}}var qh=!1,Ca=null,ka=null,Ea=null,$o=new Map,Zo=new Map,sa=[],zx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function h0(t,e){switch(t){case"focusin":case"focusout":Ca=null;break;case"dragenter":case"dragleave":ka=null;break;case"mouseover":case"mouseout":Ea=null;break;case"pointerover":case"pointerout":$o.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zo.delete(e.pointerId)}}function Ws(t,e,n,i,a,r){return t===null||t.nativeEvent!==r?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:r,targetContainers:[a]},e!==null&&(e=Ls(e),e!==null&&mC(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,a!==null&&e.indexOf(a)===-1&&e.push(a),t)}function Fx(t,e,n,i,a){switch(e){case"focusin":return Ca=Ws(Ca,t,e,n,i,a),!0;case"dragenter":return ka=Ws(ka,t,e,n,i,a),!0;case"mouseover":return Ea=Ws(Ea,t,e,n,i,a),!0;case"pointerover":var r=a.pointerId;return $o.set(r,Ws($o.get(r)||null,t,e,n,i,a)),!0;case"gotpointercapture":return r=a.pointerId,Zo.set(r,Ws(Zo.get(r)||null,t,e,n,i,a)),!0}return!1}function gC(t){var e=zr(t.target);if(e!==null){var n=fl(e);if(n!==null){if(e=n.tag,e===13){if(e=Ny(n),e!==null){t.blockedOn=e,$g(t.priority,function(){f0(n)});return}}else if(e===31){if(e=Ly(n),e!==null){t.blockedOn=e,$g(t.priority,function(){f0(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function yc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Bh(t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);ah=i,n.target.dispatchEvent(i),ah=null}else return e=Ls(n),e!==null&&mC(e),t.blockedOn=n,!1;e.shift()}return!0}function m0(t,e,n){yc(t)&&n.delete(e)}function Vx(){qh=!1,Ca!==null&&yc(Ca)&&(Ca=null),ka!==null&&yc(ka)&&(ka=null),Ea!==null&&yc(Ea)&&(Ea=null),$o.forEach(m0),Zo.forEach(m0)}function Gl(t,e){t.blockedOn===e&&(t.blockedOn=null,qh||(qh=!0,lt.unstable_scheduleCallback(lt.unstable_NormalPriority,Vx)))}var Yl=null;function p0(t){Yl!==t&&(Yl=t,lt.unstable_scheduleCallback(lt.unstable_NormalPriority,function(){Yl===t&&(Yl=null);for(var e=0;e<t.length;e+=3){var n=t[e],i=t[e+1],a=t[e+2];if(typeof i!="function"){if(wp(i||n)===null)continue;break}var r=Ls(n);r!==null&&(t.splice(e,3),e-=3,Sh(r,{pending:!0,data:a,method:n.method,action:i},i,a))}}))}function Rs(t){function e(l){return Gl(l,t)}Ca!==null&&Gl(Ca,t),ka!==null&&Gl(ka,t),Ea!==null&&Gl(Ea,t),$o.forEach(e),Zo.forEach(e);for(var n=0;n<sa.length;n++){var i=sa[n];i.blockedOn===t&&(i.blockedOn=null)}for(;0<sa.length&&(n=sa[0],n.blockedOn===null);)gC(n),n.blockedOn===null&&sa.shift();if(n=(t.ownerDocument||t).$$reactFormReplay,n!=null)for(i=0;i<n.length;i+=3){var a=n[i],r=n[i+1],s=a[Kt]||null;if(typeof r=="function")s||p0(n);else if(s){var o=null;if(r&&r.hasAttribute("formAction")){if(a=r,s=r[Kt]||null)o=s.formAction;else if(wp(a)!==null)continue}else o=s.action;typeof o=="function"?n[i+1]=o:(n.splice(i,3),i-=3),p0(n)}}}function vC(){function t(r){r.canIntercept&&r.info==="react-transition"&&r.intercept({handler:function(){return new Promise(function(s){return a=s})},focusReset:"manual",scroll:"manual"})}function e(){a!==null&&(a(),a=null),i||setTimeout(n,20)}function n(){if(!i&&!navigation.transition){var r=navigation.currentEntry;r&&r.url!=null&&navigation.navigate(r.url,{state:r.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var i=!1,a=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",e),navigation.addEventListener("navigateerror",e),setTimeout(n,100),function(){i=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",e),navigation.removeEventListener("navigateerror",e),a!==null&&(a(),a=null)}}}function Rp(t){this._internalRoot=t}Wu.prototype.render=Rp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(j(409));var n=e.current,i=sn();hC(n,i,t,e,null,null)};Wu.prototype.unmount=Rp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;hC(t.current,2,null,t,null,null),Xu(),e[Ns]=null}};function Wu(t){this._internalRoot=t}Wu.prototype.unstable_scheduleHydration=function(t){if(t){var e=Gy();t={blockedOn:null,target:t,priority:e};for(var n=0;n<sa.length&&e!==0&&e<sa[n].priority;n++);sa.splice(n,0,t),n===0&&gC(t)}};var g0=Dy.version;if(g0!=="19.2.4")throw Error(j(527,g0,"19.2.4"));ye.findDOMNode=function(t){var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(j(188)):(t=Object.keys(t).join(","),Error(j(268,t)));return t=yw(e),t=t!==null?Iy(t):null,t=t===null?null:t.stateNode,t};var Hx={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:ee,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ql=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ql.isDisabled&&Ql.supportsFiber)try{hl=Ql.inject(Hx),an=Ql}catch{}}Iu.createRoot=function(t,e){if(!Py(t))throw Error(j(299));var n=!1,i="",a=lT,r=cT,s=uT;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onUncaughtError!==void 0&&(a=e.onUncaughtError),e.onCaughtError!==void 0&&(r=e.onCaughtError),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=dC(t,1,!1,null,null,n,i,null,a,r,s,vC),t[Ns]=e.current,Tp(t),new Rp(e)};Iu.hydrateRoot=function(t,e,n){if(!Py(t))throw Error(j(299));var i=!1,a="",r=lT,s=cT,o=uT,l=null;return n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onUncaughtError!==void 0&&(r=n.onUncaughtError),n.onCaughtError!==void 0&&(s=n.onCaughtError),n.onRecoverableError!==void 0&&(o=n.onRecoverableError),n.formState!==void 0&&(l=n.formState)),e=dC(t,1,!0,e,n??null,i,a,l,r,s,o,vC),e.context=fC(null),n=e.current,i=sn(),i=Lm(i),a=ba(i),a.callback=null,ya(n,a,i),n=i,e.current.lanes=n,pl(e,n),ri(e),t[Ns]=e.current,Tp(t),new Wu(e)};Iu.version="19.2.4";function bC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(bC)}catch(t){console.error(t)}}bC(),wy.exports=Iu;var Kx=wy.exports;/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var v0="popstate";function Gx(t={}){function e(i,a){let{pathname:r,search:s,hash:o}=i.location;return zh("",{pathname:r,search:s,hash:o},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(i,a){return typeof a=="string"?a:Wo(a)}return Qx(e,n,null,t)}function qe(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function ei(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Yx(){return Math.random().toString(36).substring(2,10)}function b0(t,e){return{usr:t.state,key:t.key,idx:e}}function zh(t,e,n=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?zs(e):e,state:n,key:e&&e.key||i||Yx()}}function Wo({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function zs(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substring(i),t=t.substring(0,i)),t&&(e.pathname=t)}return e}function Qx(t,e,n,i={}){let{window:a=document.defaultView,v5Compat:r=!1}=i,s=a.history,o="POP",l=null,c=u();c==null&&(c=0,s.replaceState({...s.state,idx:c},""));function u(){return(s.state||{idx:null}).idx}function d(){o="POP";let C=u(),m=C==null?null:C-c;c=C,l&&l({action:o,location:g.location,delta:m})}function f(C,m){o="PUSH";let b=zh(g.location,C,m);c=u()+1;let S=b0(b,c),p=g.createHref(b);try{s.pushState(S,"",p)}catch(y){if(y instanceof DOMException&&y.name==="DataCloneError")throw y;a.location.assign(p)}r&&l&&l({action:o,location:g.location,delta:1})}function h(C,m){o="REPLACE";let b=zh(g.location,C,m);c=u();let S=b0(b,c),p=g.createHref(b);s.replaceState(S,"",p),r&&l&&l({action:o,location:g.location,delta:0})}function v(C){return Jx(C)}let g={get action(){return o},get location(){return t(a,s)},listen(C){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(v0,d),l=C,()=>{a.removeEventListener(v0,d),l=null}},createHref(C){return e(a,C)},createURL:v,encodeLocation(C){let m=v(C);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:f,replace:h,go(C){return s.go(C)}};return g}function Jx(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),qe(n,"No window.location.(origin|href) available to create URL");let i=typeof t=="string"?t:Wo(t);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=n+i),new URL(i,n)}function yC(t,e,n="/"){return Xx(t,e,n,!1)}function Xx(t,e,n,i){let a=typeof e=="string"?zs(e):e,r=ji(a.pathname||"/",n);if(r==null)return null;let s=SC(t);$x(s);let o=null;for(let l=0;o==null&&l<s.length;++l){let c=lO(r);o=sO(s[l],c,i)}return o}function SC(t,e=[],n=[],i="",a=!1){let r=(s,o,l=a,c)=>{let u={relativePath:c===void 0?s.path||"":c,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(i)&&l)return;qe(u.relativePath.startsWith(i),`Absolute route path "${u.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(i.length)}let d=Mi([i,u.relativePath]),f=n.concat(u);s.children&&s.children.length>0&&(qe(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${d}".`),SC(s.children,e,f,d,l)),!(s.path==null&&!s.index)&&e.push({path:d,score:aO(d,s.index),routesMeta:f})};return t.forEach((s,o)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))r(s,o);else for(let c of TC(s.path))r(s,o,!0,c)}),e}function TC(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,a=n.endsWith("?"),r=n.replace(/\?$/,"");if(i.length===0)return a?[r,""]:[r];let s=TC(i.join("/")),o=[];return o.push(...s.map(l=>l===""?r:[r,l].join("/"))),a&&o.push(...s),o.map(l=>t.startsWith("/")&&l===""?"/":l)}function $x(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:rO(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var Zx=/^:[\w-]+$/,Wx=3,eO=2,tO=1,nO=10,iO=-2,y0=t=>t==="*";function aO(t,e){let n=t.split("/"),i=n.length;return n.some(y0)&&(i+=iO),e&&(i+=eO),n.filter(a=>!y0(a)).reduce((a,r)=>a+(Zx.test(r)?Wx:r===""?tO:nO),i)}function rO(t,e){return t.length===e.length&&t.slice(0,-1).every((i,a)=>i===e[a])?t[t.length-1]-e[e.length-1]:0}function sO(t,e,n=!1){let{routesMeta:i}=t,a={},r="/",s=[];for(let o=0;o<i.length;++o){let l=i[o],c=o===i.length-1,u=r==="/"?e:e.slice(r.length)||"/",d=hu({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!d&&c&&n&&!i[i.length-1].route.index&&(d=hu({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(a,d.params),s.push({params:a,pathname:Mi([r,d.pathname]),pathnameBase:fO(Mi([r,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(r=Mi([r,d.pathnameBase]))}return s}function hu(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=oO(t.path,t.caseSensitive,t.end),a=e.match(n);if(!a)return null;let r=a[0],s=r.replace(/(.)\/+$/,"$1"),o=a.slice(1);return{params:i.reduce((c,{paramName:u,isOptional:d},f)=>{if(u==="*"){let v=o[f]||"";s=r.slice(0,r.length-v.length).replace(/(.)\/+$/,"$1")}const h=o[f];return d&&!h?c[u]=void 0:c[u]=(h||"").replace(/%2F/g,"/"),c},{}),pathname:r,pathnameBase:s,pattern:t}}function oO(t,e=!1,n=!0){ei(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,o,l)=>(i.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(i.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),i]}function lO(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ei(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function ji(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}var cO=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function uO(t,e="/"){let{pathname:n,search:i="",hash:a=""}=typeof t=="string"?zs(t):t,r;return n?(n=n.replace(/\/\/+/g,"/"),n.startsWith("/")?r=S0(n.substring(1),"/"):r=S0(n,e)):r=e,{pathname:r,search:hO(i),hash:mO(a)}}function S0(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function of(t,e,n,i){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function dO(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function CC(t){let e=dO(t);return e.map((n,i)=>i===e.length-1?n.pathname:n.pathnameBase)}function kC(t,e,n,i=!1){let a;typeof t=="string"?a=zs(t):(a={...t},qe(!a.pathname||!a.pathname.includes("?"),of("?","pathname","search",a)),qe(!a.pathname||!a.pathname.includes("#"),of("#","pathname","hash",a)),qe(!a.search||!a.search.includes("#"),of("#","search","hash",a)));let r=t===""||a.pathname==="",s=r?"/":a.pathname,o;if(s==null)o=n;else{let d=e.length-1;if(!i&&s.startsWith("..")){let f=s.split("/");for(;f[0]==="..";)f.shift(),d-=1;a.pathname=f.join("/")}o=d>=0?e[d]:"/"}let l=uO(a,o),c=s&&s!=="/"&&s.endsWith("/"),u=(r||s===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var Mi=t=>t.join("/").replace(/\/\/+/g,"/"),fO=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),hO=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,mO=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,pO=class{constructor(t,e,n,i=!1){this.status=t,this.statusText=e||"",this.internal=i,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function gO(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function vO(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var EC=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function _C(t,e){let n=t;if(typeof n!="string"||!cO.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let i=n,a=!1;if(EC)try{let r=new URL(window.location.href),s=n.startsWith("//")?new URL(r.protocol+n):new URL(n),o=ji(s.pathname,e);s.origin===r.origin&&o!=null?n=o+s.search+s.hash:a=!0}catch{ei(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:i,isExternal:a,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var wC=["POST","PUT","PATCH","DELETE"];new Set(wC);var bO=["GET",...wC];new Set(bO);var Fs=T.createContext(null);Fs.displayName="DataRouter";var ed=T.createContext(null);ed.displayName="DataRouterState";var yO=T.createContext(!1),RC=T.createContext({isTransitioning:!1});RC.displayName="ViewTransition";var SO=T.createContext(new Map);SO.displayName="Fetchers";var TO=T.createContext(null);TO.displayName="Await";var xn=T.createContext(null);xn.displayName="Navigation";var El=T.createContext(null);El.displayName="Location";var si=T.createContext({outlet:null,matches:[],isDataRoute:!1});si.displayName="Route";var xp=T.createContext(null);xp.displayName="RouteError";var xC="REACT_ROUTER_ERROR",CO="REDIRECT",kO="ROUTE_ERROR_RESPONSE";function EO(t){if(t.startsWith(`${xC}:${CO}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function _O(t){if(t.startsWith(`${xC}:${kO}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new pO(e.status,e.statusText,e.data)}catch{}}function wO(t,{relative:e}={}){qe(_l(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=T.useContext(xn),{hash:a,pathname:r,search:s}=wl(t,{relative:e}),o=r;return n!=="/"&&(o=r==="/"?n:Mi([n,r])),i.createHref({pathname:o,search:s,hash:a})}function _l(){return T.useContext(El)!=null}function _r(){return qe(_l(),"useLocation() may be used only in the context of a <Router> component."),T.useContext(El).location}var OC="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function AC(t){T.useContext(xn).static||T.useLayoutEffect(t)}function td(){let{isDataRoute:t}=T.useContext(si);return t?BO():RO()}function RO(){qe(_l(),"useNavigate() may be used only in the context of a <Router> component.");let t=T.useContext(Fs),{basename:e,navigator:n}=T.useContext(xn),{matches:i}=T.useContext(si),{pathname:a}=_r(),r=JSON.stringify(CC(i)),s=T.useRef(!1);return AC(()=>{s.current=!0}),T.useCallback((l,c={})=>{if(ei(s.current,OC),!s.current)return;if(typeof l=="number"){n.go(l);return}let u=kC(l,JSON.parse(r),a,c.relative==="path");t==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:Mi([e,u.pathname])),(c.replace?n.replace:n.push)(u,c.state,c)},[e,n,r,a,t])}T.createContext(null);function MC(){let{matches:t}=T.useContext(si),e=t[t.length-1];return e?e.params:{}}function wl(t,{relative:e}={}){let{matches:n}=T.useContext(si),{pathname:i}=_r(),a=JSON.stringify(CC(n));return T.useMemo(()=>kC(t,JSON.parse(a),i,e==="path"),[t,a,i,e])}function xO(t,e){return DC(t,e)}function DC(t,e,n,i,a){var b;qe(_l(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=T.useContext(xn),{matches:s}=T.useContext(si),o=s[s.length-1],l=o?o.params:{},c=o?o.pathname:"/",u=o?o.pathnameBase:"/",d=o&&o.route;{let S=d&&d.path||"";NC(c,!d||S.endsWith("*")||S.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${S}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${S}"> to <Route path="${S==="/"?"*":`${S}/*`}">.`)}let f=_r(),h;if(e){let S=typeof e=="string"?zs(e):e;qe(u==="/"||((b=S.pathname)==null?void 0:b.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${S.pathname}" was given in the \`location\` prop.`),h=S}else h=f;let v=h.pathname||"/",g=v;if(u!=="/"){let S=u.replace(/^\//,"").split("/");g="/"+v.replace(/^\//,"").split("/").slice(S.length).join("/")}let C=yC(t,{pathname:g});ei(d||C!=null,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),ei(C==null||C[C.length-1].route.element!==void 0||C[C.length-1].route.Component!==void 0||C[C.length-1].route.lazy!==void 0,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let m=PO(C&&C.map(S=>Object.assign({},S,{params:Object.assign({},l,S.params),pathname:Mi([u,r.encodeLocation?r.encodeLocation(S.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:S.pathname]),pathnameBase:S.pathnameBase==="/"?u:Mi([u,r.encodeLocation?r.encodeLocation(S.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:S.pathnameBase])})),s,n,i,a);return e&&m?T.createElement(El.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...h},navigationType:"POP"}},m):m}function OO(){let t=jO(),e=gO(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:i},r={padding:"2px 4px",backgroundColor:i},s=null;return console.error("Error handled by React Router default ErrorBoundary:",t),s=T.createElement(T.Fragment,null,T.createElement("p",null," Hey developer "),T.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",T.createElement("code",{style:r},"ErrorBoundary")," or"," ",T.createElement("code",{style:r},"errorElement")," prop on your route.")),T.createElement(T.Fragment,null,T.createElement("h2",null,"Unexpected Application Error!"),T.createElement("h3",{style:{fontStyle:"italic"}},e),n?T.createElement("pre",{style:a},n):null,s)}var AO=T.createElement(OO,null),PC=class extends T.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=_O(t.digest);n&&(t=n)}let e=t!==void 0?T.createElement(si.Provider,{value:this.props.routeContext},T.createElement(xp.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?T.createElement(MO,{error:t},e):e}};PC.contextType=yO;var lf=new WeakMap;function MO({children:t,error:e}){let{basename:n}=T.useContext(xn);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let i=EO(e.digest);if(i){let a=lf.get(e);if(a)throw a;let r=_C(i.location,n);if(EC&&!lf.get(e))if(r.isExternal||i.reloadDocument)window.location.href=r.absoluteURL||r.to;else{const s=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(r.to,{replace:i.replace}));throw lf.set(e,s),s}return T.createElement("meta",{httpEquiv:"refresh",content:`0;url=${r.absoluteURL||r.to}`})}}return t}function DO({routeContext:t,match:e,children:n}){let i=T.useContext(Fs);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),T.createElement(si.Provider,{value:t},n)}function PO(t,e=[],n=null,i=null,a=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let r=t,s=n==null?void 0:n.errors;if(s!=null){let u=r.findIndex(d=>d.route.id&&(s==null?void 0:s[d.route.id])!==void 0);qe(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),r=r.slice(0,Math.min(r.length,u+1))}let o=!1,l=-1;if(n)for(let u=0;u<r.length;u++){let d=r[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=u),d.route.id){let{loaderData:f,errors:h}=n,v=d.route.loader&&!f.hasOwnProperty(d.route.id)&&(!h||h[d.route.id]===void 0);if(d.route.lazy||v){o=!0,l>=0?r=r.slice(0,l+1):r=[r[0]];break}}}let c=n&&i?(u,d)=>{var f,h;i(u,{location:n.location,params:((h=(f=n.matches)==null?void 0:f[0])==null?void 0:h.params)??{},unstable_pattern:vO(n.matches),errorInfo:d})}:void 0;return r.reduceRight((u,d,f)=>{let h,v=!1,g=null,C=null;n&&(h=s&&d.route.id?s[d.route.id]:void 0,g=d.route.errorElement||AO,o&&(l<0&&f===0?(NC("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,C=null):l===f&&(v=!0,C=d.route.hydrateFallbackElement||null)));let m=e.concat(r.slice(0,f+1)),b=()=>{let S;return h?S=g:v?S=C:d.route.Component?S=T.createElement(d.route.Component,null):d.route.element?S=d.route.element:S=u,T.createElement(DO,{match:d,routeContext:{outlet:u,matches:m,isDataRoute:n!=null},children:S})};return n&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?T.createElement(PC,{location:n.location,revalidation:n.revalidation,component:g,error:h,children:b(),routeContext:{outlet:null,matches:m,isDataRoute:!0},onError:c}):b()},null)}function Op(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function NO(t){let e=T.useContext(Fs);return qe(e,Op(t)),e}function LO(t){let e=T.useContext(ed);return qe(e,Op(t)),e}function IO(t){let e=T.useContext(si);return qe(e,Op(t)),e}function Ap(t){let e=IO(t),n=e.matches[e.matches.length-1];return qe(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function UO(){return Ap("useRouteId")}function jO(){var i;let t=T.useContext(xp),e=LO("useRouteError"),n=Ap("useRouteError");return t!==void 0?t:(i=e.errors)==null?void 0:i[n]}function BO(){let{router:t}=NO("useNavigate"),e=Ap("useNavigate"),n=T.useRef(!1);return AC(()=>{n.current=!0}),T.useCallback(async(a,r={})=>{ei(n.current,OC),n.current&&(typeof a=="number"?await t.navigate(a):await t.navigate(a,{fromRouteId:e,...r}))},[t,e])}var T0={};function NC(t,e,n){!e&&!T0[t]&&(T0[t]=!0,ei(!1,n))}T.memo(qO);function qO({routes:t,future:e,state:n,onError:i}){return DC(t,void 0,n,i,e)}function vo(t){qe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function zO({basename:t="/",children:e=null,location:n,navigationType:i="POP",navigator:a,static:r=!1,unstable_useTransitions:s}){qe(!_l(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),l=T.useMemo(()=>({basename:o,navigator:a,static:r,unstable_useTransitions:s,future:{}}),[o,a,r,s]);typeof n=="string"&&(n=zs(n));let{pathname:c="/",search:u="",hash:d="",state:f=null,key:h="default"}=n,v=T.useMemo(()=>{let g=ji(c,o);return g==null?null:{location:{pathname:g,search:u,hash:d,state:f,key:h},navigationType:i}},[o,c,u,d,f,h,i]);return ei(v!=null,`<Router basename="${o}"> is not able to match the URL "${c}${u}${d}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:T.createElement(xn.Provider,{value:l},T.createElement(El.Provider,{children:e,value:v}))}function FO({children:t,location:e}){return xO(Fh(t),e)}function Fh(t,e=[]){let n=[];return T.Children.forEach(t,(i,a)=>{if(!T.isValidElement(i))return;let r=[...e,a];if(i.type===T.Fragment){n.push.apply(n,Fh(i.props.children,r));return}qe(i.type===vo,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),qe(!i.props.index||!i.props.children,"An index route cannot have child routes.");let s={id:i.props.id||r.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(s.children=Fh(i.props.children,r)),n.push(s)}),n}var Sc="get",Tc="application/x-www-form-urlencoded";function nd(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function VO(t){return nd(t)&&t.tagName.toLowerCase()==="button"}function HO(t){return nd(t)&&t.tagName.toLowerCase()==="form"}function KO(t){return nd(t)&&t.tagName.toLowerCase()==="input"}function GO(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function YO(t,e){return t.button===0&&(!e||e==="_self")&&!GO(t)}var Jl=null;function QO(){if(Jl===null)try{new FormData(document.createElement("form"),0),Jl=!1}catch{Jl=!0}return Jl}var JO=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function cf(t){return t!=null&&!JO.has(t)?(ei(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Tc}"`),null):t}function XO(t,e){let n,i,a,r,s;if(HO(t)){let o=t.getAttribute("action");i=o?ji(o,e):null,n=t.getAttribute("method")||Sc,a=cf(t.getAttribute("enctype"))||Tc,r=new FormData(t)}else if(VO(t)||KO(t)&&(t.type==="submit"||t.type==="image")){let o=t.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||o.getAttribute("action");if(i=l?ji(l,e):null,n=t.getAttribute("formmethod")||o.getAttribute("method")||Sc,a=cf(t.getAttribute("formenctype"))||cf(o.getAttribute("enctype"))||Tc,r=new FormData(o,t),!QO()){let{name:c,type:u,value:d}=t;if(u==="image"){let f=c?`${c}.`:"";r.append(`${f}x`,"0"),r.append(`${f}y`,"0")}else c&&r.append(c,d)}}else{if(nd(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Sc,i=null,a=Tc,s=t}return r&&a==="text/plain"&&(s=r,r=void 0),{action:i,method:n.toLowerCase(),encType:a,formData:r,body:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Mp(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function $O(t,e,n,i){let a=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n?a.pathname.endsWith("/")?a.pathname=`${a.pathname}_.${i}`:a.pathname=`${a.pathname}.${i}`:a.pathname==="/"?a.pathname=`_root.${i}`:e&&ji(a.pathname,e)==="/"?a.pathname=`${e.replace(/\/$/,"")}/_root.${i}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${i}`,a}async function ZO(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function WO(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function eA(t,e,n){let i=await Promise.all(t.map(async a=>{let r=e.routes[a.route.id];if(r){let s=await ZO(r,n);return s.links?s.links():[]}return[]}));return aA(i.flat(1).filter(WO).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function C0(t,e,n,i,a,r){let s=(l,c)=>n[c]?l.route.id!==n[c].route.id:!0,o=(l,c)=>{var u;return n[c].pathname!==l.pathname||((u=n[c].route.path)==null?void 0:u.endsWith("*"))&&n[c].params["*"]!==l.params["*"]};return r==="assets"?e.filter((l,c)=>s(l,c)||o(l,c)):r==="data"?e.filter((l,c)=>{var d;let u=i.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(s(l,c)||o(l,c))return!0;if(l.route.shouldRevalidate){let f=l.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:((d=n[0])==null?void 0:d.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function tA(t,e,{includeHydrateFallback:n}={}){return nA(t.map(i=>{let a=e.routes[i.route.id];if(!a)return[];let r=[a.module];return a.clientActionModule&&(r=r.concat(a.clientActionModule)),a.clientLoaderModule&&(r=r.concat(a.clientLoaderModule)),n&&a.hydrateFallbackModule&&(r=r.concat(a.hydrateFallbackModule)),a.imports&&(r=r.concat(a.imports)),r}).flat(1))}function nA(t){return[...new Set(t)]}function iA(t){let e={},n=Object.keys(t).sort();for(let i of n)e[i]=t[i];return e}function aA(t,e){let n=new Set;return new Set(e),t.reduce((i,a)=>{let r=JSON.stringify(iA(a));return n.has(r)||(n.add(r),i.push({key:r,link:a})),i},[])}function LC(){let t=T.useContext(Fs);return Mp(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function rA(){let t=T.useContext(ed);return Mp(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var Dp=T.createContext(void 0);Dp.displayName="FrameworkContext";function IC(){let t=T.useContext(Dp);return Mp(t,"You must render this element inside a <HydratedRouter> element"),t}function sA(t,e){let n=T.useContext(Dp),[i,a]=T.useState(!1),[r,s]=T.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:d}=e,f=T.useRef(null);T.useEffect(()=>{if(t==="render"&&s(!0),t==="viewport"){let g=m=>{m.forEach(b=>{s(b.isIntersecting)})},C=new IntersectionObserver(g,{threshold:.5});return f.current&&C.observe(f.current),()=>{C.disconnect()}}},[t]),T.useEffect(()=>{if(i){let g=setTimeout(()=>{s(!0)},100);return()=>{clearTimeout(g)}}},[i]);let h=()=>{a(!0)},v=()=>{a(!1),s(!1)};return n?t!=="intent"?[r,f,{}]:[r,f,{onFocus:eo(o,h),onBlur:eo(l,v),onMouseEnter:eo(c,h),onMouseLeave:eo(u,v),onTouchStart:eo(d,h)}]:[!1,f,{}]}function eo(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function oA({page:t,...e}){let{router:n}=LC(),i=T.useMemo(()=>yC(n.routes,t,n.basename),[n.routes,t,n.basename]);return i?T.createElement(cA,{page:t,matches:i,...e}):null}function lA(t){let{manifest:e,routeModules:n}=IC(),[i,a]=T.useState([]);return T.useEffect(()=>{let r=!1;return eA(t,e,n).then(s=>{r||a(s)}),()=>{r=!0}},[t,e,n]),i}function cA({page:t,matches:e,...n}){let i=_r(),{future:a,manifest:r,routeModules:s}=IC(),{basename:o}=LC(),{loaderData:l,matches:c}=rA(),u=T.useMemo(()=>C0(t,e,c,r,i,"data"),[t,e,c,r,i]),d=T.useMemo(()=>C0(t,e,c,r,i,"assets"),[t,e,c,r,i]),f=T.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let g=new Set,C=!1;if(e.forEach(b=>{var p;let S=r.routes[b.route.id];!S||!S.hasLoader||(!u.some(y=>y.route.id===b.route.id)&&b.route.id in l&&((p=s[b.route.id])!=null&&p.shouldRevalidate)||S.hasClientLoader?C=!0:g.add(b.route.id))}),g.size===0)return[];let m=$O(t,o,a.unstable_trailingSlashAwareDataRequests,"data");return C&&g.size>0&&m.searchParams.set("_routes",e.filter(b=>g.has(b.route.id)).map(b=>b.route.id).join(",")),[m.pathname+m.search]},[o,a.unstable_trailingSlashAwareDataRequests,l,i,r,u,e,t,s]),h=T.useMemo(()=>tA(d,r),[d,r]),v=lA(d);return T.createElement(T.Fragment,null,f.map(g=>T.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...n})),h.map(g=>T.createElement("link",{key:g,rel:"modulepreload",href:g,...n})),v.map(({key:g,link:C})=>T.createElement("link",{key:g,nonce:n.nonce,...C,crossOrigin:C.crossOrigin??n.crossOrigin})))}function uA(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var dA=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{dA&&(window.__reactRouterVersion="7.13.0")}catch{}function fA({basename:t,children:e,unstable_useTransitions:n,window:i}){let a=T.useRef();a.current==null&&(a.current=Gx({window:i,v5Compat:!0}));let r=a.current,[s,o]=T.useState({action:r.action,location:r.location}),l=T.useCallback(c=>{n===!1?o(c):T.startTransition(()=>o(c))},[n]);return T.useLayoutEffect(()=>r.listen(l),[r,l]),T.createElement(zO,{basename:t,children:e,location:s.location,navigationType:s.action,navigator:r,unstable_useTransitions:n})}var UC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Da=T.forwardRef(function({onClick:e,discover:n="render",prefetch:i="none",relative:a,reloadDocument:r,replace:s,state:o,target:l,to:c,preventScrollReset:u,viewTransition:d,unstable_defaultShouldRevalidate:f,...h},v){let{basename:g,unstable_useTransitions:C}=T.useContext(xn),m=typeof c=="string"&&UC.test(c),b=_C(c,g);c=b.to;let S=wO(c,{relative:a}),[p,y,k]=sA(i,h),_=gA(c,{replace:s,state:o,target:l,preventScrollReset:u,relative:a,viewTransition:d,unstable_defaultShouldRevalidate:f,unstable_useTransitions:C});function O(R){e&&e(R),R.defaultPrevented||_(R)}let w=T.createElement("a",{...h,...k,href:b.absoluteURL||S,onClick:b.isExternal||r?e:O,ref:uA(v,y),target:l,"data-discover":!m&&n==="render"?"true":void 0});return p&&!m?T.createElement(T.Fragment,null,w,T.createElement(oA,{page:S})):w});Da.displayName="Link";var hA=T.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:i="",end:a=!1,style:r,to:s,viewTransition:o,children:l,...c},u){let d=wl(s,{relative:c.relative}),f=_r(),h=T.useContext(ed),{navigator:v,basename:g}=T.useContext(xn),C=h!=null&&TA(d)&&o===!0,m=v.encodeLocation?v.encodeLocation(d).pathname:d.pathname,b=f.pathname,S=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;n||(b=b.toLowerCase(),S=S?S.toLowerCase():null,m=m.toLowerCase()),S&&g&&(S=ji(S,g)||S);const p=m!=="/"&&m.endsWith("/")?m.length-1:m.length;let y=b===m||!a&&b.startsWith(m)&&b.charAt(p)==="/",k=S!=null&&(S===m||!a&&S.startsWith(m)&&S.charAt(m.length)==="/"),_={isActive:y,isPending:k,isTransitioning:C},O=y?e:void 0,w;typeof i=="function"?w=i(_):w=[i,y?"active":null,k?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let R=typeof r=="function"?r(_):r;return T.createElement(Da,{...c,"aria-current":O,className:w,ref:u,style:R,to:s,viewTransition:o},typeof l=="function"?l(_):l)});hA.displayName="NavLink";var mA=T.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:i,replace:a,state:r,method:s=Sc,action:o,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:d,unstable_defaultShouldRevalidate:f,...h},v)=>{let{unstable_useTransitions:g}=T.useContext(xn),C=yA(),m=SA(o,{relative:c}),b=s.toLowerCase()==="get"?"get":"post",S=typeof o=="string"&&UC.test(o),p=y=>{if(l&&l(y),y.defaultPrevented)return;y.preventDefault();let k=y.nativeEvent.submitter,_=(k==null?void 0:k.getAttribute("formmethod"))||s,O=()=>C(k||y.currentTarget,{fetcherKey:e,method:_,navigate:n,replace:a,state:r,relative:c,preventScrollReset:u,viewTransition:d,unstable_defaultShouldRevalidate:f});g&&n!==!1?T.startTransition(()=>O()):O()};return T.createElement("form",{ref:v,method:b,action:m,onSubmit:i?l:p,...h,"data-discover":!S&&t==="render"?"true":void 0})});mA.displayName="Form";function pA(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function jC(t){let e=T.useContext(Fs);return qe(e,pA(t)),e}function gA(t,{target:e,replace:n,state:i,preventScrollReset:a,relative:r,viewTransition:s,unstable_defaultShouldRevalidate:o,unstable_useTransitions:l}={}){let c=td(),u=_r(),d=wl(t,{relative:r});return T.useCallback(f=>{if(YO(f,e)){f.preventDefault();let h=n!==void 0?n:Wo(u)===Wo(d),v=()=>c(t,{replace:h,state:i,preventScrollReset:a,relative:r,viewTransition:s,unstable_defaultShouldRevalidate:o});l?T.startTransition(()=>v()):v()}},[u,c,d,n,i,e,t,a,r,s,o,l])}var vA=0,bA=()=>`__${String(++vA)}__`;function yA(){let{router:t}=jC("useSubmit"),{basename:e}=T.useContext(xn),n=UO(),i=t.fetch,a=t.navigate;return T.useCallback(async(r,s={})=>{let{action:o,method:l,encType:c,formData:u,body:d}=XO(r,e);if(s.navigate===!1){let f=s.fetcherKey||bA();await i(f,n,s.action||o,{unstable_defaultShouldRevalidate:s.unstable_defaultShouldRevalidate,preventScrollReset:s.preventScrollReset,formData:u,body:d,formMethod:s.method||l,formEncType:s.encType||c,flushSync:s.flushSync})}else await a(s.action||o,{unstable_defaultShouldRevalidate:s.unstable_defaultShouldRevalidate,preventScrollReset:s.preventScrollReset,formData:u,body:d,formMethod:s.method||l,formEncType:s.encType||c,replace:s.replace,state:s.state,fromRouteId:n,flushSync:s.flushSync,viewTransition:s.viewTransition})},[i,a,e,n])}function SA(t,{relative:e}={}){let{basename:n}=T.useContext(xn),i=T.useContext(si);qe(i,"useFormAction must be used inside a RouteContext");let[a]=i.matches.slice(-1),r={...wl(t||".",{relative:e})},s=_r();if(t==null){r.search=s.search;let o=new URLSearchParams(r.search),l=o.getAll("index");if(l.some(u=>u==="")){o.delete("index"),l.filter(d=>d).forEach(d=>o.append("index",d));let u=o.toString();r.search=u?`?${u}`:""}}return(!t||t===".")&&a.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(r.pathname=r.pathname==="/"?n:Mi([n,r.pathname])),Wo(r)}function TA(t,{relative:e}={}){let n=T.useContext(RC);qe(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=jC("useViewTransitionState"),a=wl(t,{relative:e});if(!n.isTransitioning)return!1;let r=ji(n.currentLocation.pathname,i)||n.currentLocation.pathname,s=ji(n.nextLocation.pathname,i)||n.nextLocation.pathname;return hu(a.pathname,s)!=null||hu(a.pathname,r)!=null}/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC=(...t)=>t.filter((e,n,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===n).join(" ").trim();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CA=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kA=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,i)=>i?i.toUpperCase():n.toLowerCase());/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=t=>{const e=kA(t);return e.charAt(0).toUpperCase()+e.slice(1)};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var EA={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _A=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0;return!1};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wA=T.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:a="",children:r,iconNode:s,...o},l)=>T.createElement("svg",{ref:l,...EA,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:BC("lucide",a),...!r&&!_A(o)&&{"aria-hidden":"true"},...o},[...s.map(([c,u])=>T.createElement(c,u)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=(t,e)=>{const n=T.forwardRef(({className:i,...a},r)=>T.createElement(wA,{ref:r,iconNode:e,className:BC(`lucide-${CA(k0(t))}`,`lucide-${t}`,i),...a}));return n.displayName=k0(t),n};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RA=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],xA=On("book-open",RA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OA=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],AA=On("check",OA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MA=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],DA=On("circle-check-big",MA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PA=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],NA=On("clock",PA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LA=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],IA=On("dollar-sign",LA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UA=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],jA=On("layout-dashboard",UA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BA=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],qA=On("lock",BA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zA=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],FA=On("message-circle",zA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VA=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],HA=On("send",VA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KA=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],GA=On("trending-up",KA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YA=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],E0=On("user-plus",YA);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QA=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],JA=On("x",QA),_0=[{id:"teacher1",name:"GM Ana Smith",elo:2450,price:35,classesGiven:42,earnings:1250.5,description:"Especialista en defensa siciliana y finales.",image:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher2",name:"IM Carlos Ruiz",elo:2310,price:25,classesGiven:18,earnings:450,description:"Entrenador tctico para jugadores de club.",image:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher3",name:"WGM Sarah Polgar",elo:2505,price:50,classesGiven:156,earnings:7800,description:"Ex-campeona mundial juvenil. Clases avanzadas.",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"}],pi={TEACHERS:"topchess_teachers",ROOMS:"topchess_rooms"},pe={initialize:()=>{localStorage.getItem(pi.TEACHERS)||localStorage.setItem(pi.TEACHERS,JSON.stringify(_0)),localStorage.getItem(pi.ROOMS)||localStorage.setItem(pi.ROOMS,JSON.stringify({}))},getTeachers:()=>{const t=localStorage.getItem(pi.TEACHERS);return t?JSON.parse(t):_0},getTeacherById:t=>pe.getTeachers().find(n=>n.id===t)||null,updateTeacher:(t,e)=>{const n=pe.getTeachers(),i=n.findIndex(a=>a.id===t);return i!==-1?(n[i]={...n[i],...e},localStorage.setItem(pi.TEACHERS,JSON.stringify(n)),n[i]):null},getRoom:t=>JSON.parse(localStorage.getItem(pi.ROOMS)||"{}")[t]||null,updateRoom:(t,e)=>{const n=JSON.parse(localStorage.getItem(pi.ROOMS)||"{}");n[t]={...n[t],...e},localStorage.setItem(pi.ROOMS,JSON.stringify(n)),window.dispatchEvent(new CustomEvent("room-update",{detail:{teacherId:t,data:n[t]}}))},subscribeToRoom:(t,e)=>{const n=a=>{a.detail.teacherId===t&&e(a.detail.data)};window.addEventListener("room-update",n);const i=pe.getRoom(t);return i&&e(i),()=>window.removeEventListener("room-update",n)},createRequest:(t,e,n)=>{const i=JSON.parse(localStorage.getItem("topchess_requests")||"[]"),a=i.find(s=>s.studentId===t&&s.teacherId===e);if(a)return pe.sendMessage(t,e,n,"student"),a;const r={id:Date.now().toString(),studentId:t,teacherId:e,status:"pending",timestamp:Date.now()};return i.push(r),localStorage.setItem("topchess_requests",JSON.stringify(i)),n&&pe.sendMessage(t,e,n,"student"),r},getRequestStatus:(t,e)=>{const i=JSON.parse(localStorage.getItem("topchess_requests")||"[]").find(a=>a.studentId===t&&a.teacherId===e);return i?i.status:null},getRequestsForTeacher:t=>JSON.parse(localStorage.getItem("topchess_requests")||"[]").filter(n=>n.teacherId===t&&n.status==="pending"),updateRequestStatus:(t,e,n)=>{const i=JSON.parse(localStorage.getItem("topchess_requests")||"[]"),a=i.findIndex(r=>r.studentId===t&&r.teacherId===e);return a!==-1?(i[a].status=n,localStorage.setItem("topchess_requests",JSON.stringify(i)),!0):!1},sendMessage:(t,e,n,i)=>{const a=JSON.parse(localStorage.getItem("topchess_messages")||"[]"),r={id:Date.now().toString()+Math.random(),studentId:t,teacherId:e,text:n,sender:i,timestamp:Date.now()};a.push(r),localStorage.setItem("topchess_messages",JSON.stringify(a)),window.dispatchEvent(new CustomEvent("chat-update",{detail:{studentId:t,teacherId:e}}))},getMessages:(t,e)=>JSON.parse(localStorage.getItem("topchess_messages")||"[]").filter(i=>i.studentId===t&&i.teacherId===e).sort((i,a)=>i.timestamp-a.timestamp),subscribeToChat:(t,e,n)=>{const i=a=>{a.detail.studentId===t&&a.detail.teacherId===e&&n(pe.getMessages(t,e))};return window.addEventListener("chat-update",i),()=>window.removeEventListener("chat-update",i)}},XA=()=>{const[t,e]=T.useState([]),{userRole:n}=Di.useContext(Ar),[i,a]=T.useState(!0),r=[{id:"teacher1",name:"GM Ana Smith",elo:2450,price:35,classesGiven:42,description:"Especialista en defensa siciliana y finales.",image:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher2",name:"IM Carlos Ruiz",elo:2310,price:25,classesGiven:18,description:"Entrenador tctico para jugadores de club.",image:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher3",name:"WGM Sarah Polgar",elo:2505,price:50,classesGiven:156,description:"Ex-campeona mundial juvenil. Clases avanzadas.",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"}];return T.useEffect(()=>{(async()=>{try{const o=pe.getTeachers();!o||o.length===0?(pe.initialize(),e(pe.getTeachers())):e(o)}catch(o){console.error("Error fetching teachers:",o),e(r)}finally{a(!1)}})()},[]),x.jsxs("div",{className:"min-h-screen",children:[x.jsxs("section",{className:"relative py-20 px-4 mb-16 overflow-hidden",children:[x.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-br from-[#161512] via-[#201e1b] to-[#262421] z-0"}),x.jsxs("div",{className:"relative z-10 max-w-5xl mx-auto text-center",children:[x.jsx("div",{className:"inline-block px-4 py-1.5 mb-6 rounded-full bg-[#bf811d]/10 border border-[#bf811d]/20 text-[#bf811d] text-sm font-semibold tracking-wide uppercase",children:"La Escuela de Ajedrez del Futuro"}),x.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Domina el Tablero ",x.jsx("br",{}),x.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-[#bf811d] to-[#f0d9b5]",children:"Sin Lmites"})]}),x.jsx("p",{className:"text-xl text-[#bababa] max-w-2xl mx-auto mb-10 leading-relaxed",children:"Conectamos a estudiantes apasionados con grandes maestros en aulas virtuales con audio en tiempo real."}),x.jsx("div",{className:"flex gap-4 justify-center",children:x.jsx("button",{className:"bg-[#bf811d] hover:bg-[#a66f19] text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg shadow-orange-900/20",children:"Buscar Profesor"})})]})]}),x.jsxs("div",{className:"max-w-6xl mx-auto px-4 pb-20",children:[x.jsx("h2",{className:"text-3xl font-bold text-white mb-8",children:"Maestros Recomendados"}),i?x.jsx("div",{className:"text-center py-20 text-[#666]",children:"Cargando maestros..."}):x.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map(s=>x.jsxs("div",{className:"bg-[#21201d] border border-[#302e2b] rounded-2xl p-6 hover:border-[#bf811d]/50 transition-all",children:[x.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[x.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-800 overflow-hidden",children:x.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"})}),x.jsxs("div",{children:[x.jsx("h3",{className:"text-xl font-bold text-white",children:s.name}),x.jsxs("div",{className:"text-[#bf811d] font-bold text-sm",children:[s.elo," ELO"]})]})]}),x.jsx("p",{className:"text-[#bababa] text-sm mb-4 h-12 overflow-hidden",children:s.description}),x.jsxs("div",{className:"flex justify-between items-center mb-6",children:[x.jsx("span",{className:"text-white font-bold text-lg",children:"Plan Mensual"}),x.jsxs("div",{className:"text-right",children:[x.jsx("div",{className:"text-[#bf811d] font-bold",children:"59 EUR"}),x.jsx("div",{className:"text-xs text-[#666]",children:"$39 USD"})]})]}),n==="student"?x.jsx(Da,{to:`/chat/${s.id}`,className:"block w-full text-center py-3 bg-[#bf811d] text-white font-bold rounded-xl hover:bg-[#a66f19] transition-all shadow-lg hover:shadow-orange-900/40",children:"Contactar Profesor"}):s.id==="teacher1"&&x.jsx(Da,{to:`/room/${s.id}`,className:"block w-full text-center py-3 bg-[#363431] text-white font-bold rounded-xl border border-[#403d39]",children:"Ir al Aula"})]},s.id))})]})]})};var qC={exports:{}},$A="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ZA=$A,WA=ZA;function zC(){}function FC(){}FC.resetWarningCache=zC;var e2=function(){function t(i,a,r,s,o,l){if(l!==WA){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:FC,resetWarningCache:zC};return n.PropTypes=n,n};qC.exports=e2();var t2=qC.exports;const ve=wm(t2),n2=["white","black"],Pp=["a","b","c","d","e","f","g","h"],Np=["1","2","3","4","5","6","7","8"],i2=[...Np].reverse(),Lp=Array.prototype.concat(...Pp.map(t=>Np.map(e=>t+e))),bn=t=>Lp[8*t[0]+t[1]],Qe=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],VC=Lp.map(Qe);function a2(t){let e;const n=()=>(e===void 0&&(e=t()),e);return n.clear=()=>{e=void 0},n}const r2=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},Ip=t=>t==="white"?"black":"white",el=(t,e)=>{const n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i},Vh=(t,e)=>t.role===e.role&&t.color===e.color,HC=(t,e,n,i)=>[(e?t[0]:7-t[0])*n,(e?7-t[1]:t[1])*i],Up=t=>{const e=t.width/8,n=t.height/8;return(i,a)=>HC(i,a,e,n)},s2=(t,e)=>HC(t,e,100,100),id=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},o2=(t,e)=>{t.style.transform=`translate(${e[0]}%,${e[1]}%)`},jp=(t,e)=>{t.style.visibility=e?"visible":"hidden"},wr=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},KC=t=>t.buttons===2||t.button===2,ha=(t,e)=>{const n=document.createElement(t);return e&&(n.className=e),n};function GC(t,e,n){const i=Qe(t);return e||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}function hr(t,e){return Math.abs(t-e)}function l2(t){return(e,n,i,a)=>hr(e,i)<2&&(t==="white"?a===n+1||n<=1&&a===n+2&&e===i:a===n-1||n>=6&&a===n-2&&e===i)}const YC=(t,e,n,i)=>{const a=hr(t,n),r=hr(e,i);return a===1&&r===2||a===2&&r===1},QC=(t,e,n,i)=>hr(t,n)===hr(e,i),JC=(t,e,n,i)=>t===n||e===i,XC=(t,e,n,i)=>QC(t,e,n,i)||JC(t,e,n,i);function c2(t,e,n){return(i,a,r,s)=>hr(i,r)<2&&hr(a,s)<2||n&&a===s&&a===(t==="white"?0:7)&&(i===4&&(r===2&&e.includes(0)||r===6&&e.includes(7))||e.includes(r))}function u2(t,e){const n=e==="white"?"1":"8",i=[];for(const[a,r]of t)a[1]===n&&r.color===e&&r.role==="rook"&&i.push(Qe(a)[0]);return i}function $C(t,e,n){const i=t.get(e);if(!i)return[];const a=Qe(e),r=i.role,s=r==="pawn"?l2(i.color):r==="knight"?YC:r==="bishop"?QC:r==="rook"?JC:r==="queen"?XC:c2(i.color,u2(t,i.color),n);return VC.filter(o=>(a[0]!==o[0]||a[1]!==o[1])&&s(a[0],a[1],o[0],o[1])).map(bn)}function Gt(t,...e){t&&setTimeout(()=>t(...e),1)}function d2(t){t.orientation=Ip(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function f2(t,e){for(const[n,i]of e)i?t.pieces.set(n,i):t.pieces.delete(n)}function h2(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[n,i]of t.pieces)i.role==="king"&&i.color===e&&(t.check=n)}function m2(t,e,n,i){Ba(t),t.premovable.current=[e,n],Gt(t.premovable.events.set,e,n,i)}function ja(t){t.premovable.current&&(t.premovable.current=void 0,Gt(t.premovable.events.unset))}function p2(t,e,n){ja(t),t.predroppable.current={role:e,key:n},Gt(t.predroppable.events.set,e,n)}function Ba(t){const e=t.predroppable;e.current&&(e.current=void 0,Gt(e.events.unset))}function g2(t,e,n){if(!t.autoCastle)return!1;const i=t.pieces.get(e);if(!i||i.role!=="king")return!1;const a=Qe(e),r=Qe(n);if(a[1]!==0&&a[1]!==7||a[1]!==r[1])return!1;a[0]===4&&!t.pieces.has(n)&&(r[0]===6?n=bn([7,r[1]]):r[0]===2&&(n=bn([0,r[1]])));const s=t.pieces.get(n);return!s||s.color!==i.color||s.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(n),a[0]<r[0]?(t.pieces.set(bn([6,r[1]]),i),t.pieces.set(bn([5,r[1]]),s)):(t.pieces.set(bn([2,r[1]]),i),t.pieces.set(bn([3,r[1]]),s)),!0)}function ZC(t,e,n){const i=t.pieces.get(e),a=t.pieces.get(n);if(e===n||!i)return!1;const r=a&&a.color!==i.color?a:void 0;return n===t.selected&&wn(t),Gt(t.events.move,e,n,r),g2(t,e,n)||(t.pieces.set(n,i),t.pieces.delete(e)),t.lastMove=[e,n],t.check=void 0,Gt(t.events.change),r||!0}function Bp(t,e,n,i){if(t.pieces.has(n))if(i)t.pieces.delete(n);else return!1;return Gt(t.events.dropNewPiece,e,n),t.pieces.set(n,e),t.lastMove=[n],t.check=void 0,Gt(t.events.change),t.movable.dests=void 0,t.turnColor=Ip(t.turnColor),!0}function WC(t,e,n){const i=ZC(t,e,n);return i&&(t.movable.dests=void 0,t.turnColor=Ip(t.turnColor),t.animation.current=void 0),i}function e1(t,e,n){if(qp(t,e,n)){const i=WC(t,e,n);if(i){const a=t.hold.stop();wn(t);const r={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:a};return i!==!0&&(r.captured=i),Gt(t.movable.events.after,e,n,r),!0}}else if(b2(t,e,n))return m2(t,e,n,{ctrlKey:t.stats.ctrlKey}),wn(t),!0;return wn(t),!1}function t1(t,e,n,i){const a=t.pieces.get(e);a&&(v2(t,e,n)||i)?(t.pieces.delete(e),Bp(t,a,n,i),Gt(t.movable.events.afterNewPiece,a.role,n,{premove:!1,predrop:!1})):a&&y2(t,e,n)?p2(t,a.role,n):(ja(t),Ba(t)),t.pieces.delete(e),wn(t)}function Hh(t,e,n){if(Gt(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){wn(t),t.hold.cancel();return}else if((t.selectable.enabled||n)&&t.selected!==e&&e1(t,t.selected,e)){t.stats.dragged=!1;return}}(i1(t,e)||zp(t,e))&&(n1(t,e),t.hold.start())}function n1(t,e){t.selected=e,zp(t,e)?t.premovable.dests=$C(t.pieces,e,t.premovable.castle):t.premovable.dests=void 0}function wn(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function i1(t,e){const n=t.pieces.get(e);return!!n&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}function qp(t,e,n){var i,a;return e!==n&&i1(t,e)&&(t.movable.free||!!(!((a=(i=t.movable.dests)===null||i===void 0?void 0:i.get(e))===null||a===void 0)&&a.includes(n)))}function v2(t,e,n){const i=t.pieces.get(e);return!!i&&(e===n||!t.pieces.has(n))&&(t.movable.color==="both"||t.movable.color===i.color&&t.turnColor===i.color)}function zp(t,e){const n=t.pieces.get(e);return!!n&&t.premovable.enabled&&t.movable.color===n.color&&t.turnColor!==n.color}function b2(t,e,n){return e!==n&&zp(t,e)&&$C(t.pieces,e,t.premovable.castle).includes(n)}function y2(t,e,n){const i=t.pieces.get(e),a=t.pieces.get(n);return!!i&&(!a||a.color!==t.movable.color)&&t.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&t.movable.color===i.color&&t.turnColor!==i.color}function S2(t,e){const n=t.pieces.get(e);return!!n&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===n.color&&(t.turnColor===n.color||t.premovable.enabled))}function T2(t){const e=t.premovable.current;if(!e)return!1;const n=e[0],i=e[1];let a=!1;if(qp(t,n,i)){const r=WC(t,n,i);if(r){const s={premove:!0};r!==!0&&(s.captured=r),Gt(t.movable.events.after,n,i,s),a=!0}}return ja(t),a}function C2(t,e){const n=t.predroppable.current;let i=!1;if(!n)return!1;if(e(n)){const a={role:n.role,color:t.movable.color};Bp(t,a,n.key)&&(Gt(t.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return Ba(t),i}function Fp(t){ja(t),Ba(t),wn(t)}function w0(t){t.movable.color=t.movable.dests=t.animation.current=void 0,Fp(t)}function Vs(t,e,n){let i=Math.floor(8*(t[0]-n.left)/n.width);e||(i=7-i);let a=7-Math.floor(8*(t[1]-n.top)/n.height);return e||(a=7-a),i>=0&&i<8&&a>=0&&a<8?bn([i,a]):void 0}function k2(t,e,n,i){const a=Qe(t),r=VC.filter(c=>XC(a[0],a[1],c[0],c[1])||YC(a[0],a[1],c[0],c[1])),o=r.map(c=>GC(bn(c),n,i)).map(c=>el(e,c)),[,l]=o.reduce((c,u,d)=>c[0]<u?c:[u,d],[o[0],0]);return bn(r[l])}function Bn(t){return t.orientation==="white"}const a1="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",E2={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},_2={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function r1(t){t==="start"&&(t=a1);const e=new Map;let n=7,i=0;for(const a of t)switch(a){case" ":return e;case"/":if(--n,n<0)return e;i=0;break;case"~":{const r=e.get(bn([i,n]));r&&(r.promoted=!0);break}default:{const r=a.charCodeAt(0);if(r<57)i+=r-48;else{const s=a.toLowerCase();e.set(bn([i,n]),{role:E2[s],color:a===s?"black":"white"}),++i}}}return e}function w2(t){return i2.map(e=>Pp.map(n=>{const i=t.get(n+e);if(i){const a=_2[i.role];return i.color==="white"?a.toUpperCase():a}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function s1(t,e){var n,i;if(!((n=e.movable)===null||n===void 0)&&n.dests&&(t.movable.dests=void 0),!((i=e.drawable)===null||i===void 0)&&i.autoShapes&&(t.drawable.autoShapes=[]),o1(t,e),e.fen&&(t.pieces=r1(e.fen),t.drawable.shapes=[]),"check"in e&&h2(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&n1(t,t.selected),(!t.animation.duration||t.animation.duration<100)&&(t.animation.enabled=!1),!t.movable.rookCastle&&t.movable.dests){const a=t.movable.color==="white"?"1":"8",r="e"+a,s=t.movable.dests.get(r),o=t.pieces.get(r);if(!s||!o||o.role!=="king")return;t.movable.dests.set(r,s.filter(l=>!(l==="a"+a&&s.includes("c"+a))&&!(l==="h"+a&&s.includes("g"+a))))}}function o1(t,e){for(const n in e)R0(t[n])&&R0(e[n])?o1(t[n],e[n]):t[n]=e[n]}function R0(t){return typeof t=="object"}function $a(t,e){return e.animation.enabled?O2(t,e):Zi(t,e)}function Zi(t,e){const n=t(e);return e.dom.redraw(),n}function uf(t,e){return{key:t,pos:Qe(t),piece:e}}function R2(t,e){return e.sort((n,i)=>el(t.pos,n.pos)-el(t.pos,i.pos))[0]}function x2(t,e){const n=new Map,i=[],a=new Map,r=[],s=[],o=new Map;let l,c,u;for(const[d,f]of t)o.set(d,uf(d,f));for(const d of Lp)l=e.pieces.get(d),c=o.get(d),l?c?Vh(l,c.piece)||(r.push(c),s.push(uf(d,l))):s.push(uf(d,l)):c&&r.push(c);for(const d of s)c=R2(d,r.filter(f=>Vh(d.piece,f.piece))),c&&(u=[c.pos[0]-d.pos[0],c.pos[1]-d.pos[1]],n.set(d.key,u.concat(u)),i.push(c.key));for(const d of r)i.includes(d.key)||a.set(d.key,d.piece);return{anims:n,fadings:a}}function l1(t,e){const n=t.animation.current;if(n===void 0){t.dom.destroyed||t.dom.redrawNow();return}const i=1-(e-n.start)*n.frequency;if(i<=0)t.animation.current=void 0,t.dom.redrawNow();else{const a=A2(i);for(const r of n.plan.anims.values())r[2]=r[0]*a,r[3]=r[1]*a;t.dom.redrawNow(!0),requestAnimationFrame((r=performance.now())=>l1(t,r))}}function O2(t,e){const n=new Map(e.pieces),i=t(e),a=x2(n,e);if(a.anims.size||a.fadings.size){const r=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:a},r||l1(e,performance.now())}else e.dom.redraw();return i}function A2(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}const M2=["green","red","blue","yellow"];function D2(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?wn(t):Fp(t);const n=wr(e),i=Vs(n,Bn(t),t.dom.bounds());i&&(t.drawable.current={orig:i,pos:n,brush:I2(e),snapToValidMove:t.drawable.defaultSnapToValidMove},c1(t))}function c1(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const n=Vs(e.pos,Bn(t),t.dom.bounds());n||(e.snapToValidMove=!1);const i=e.snapToValidMove?k2(e.orig,e.pos,Bn(t),t.dom.bounds()):n;i!==e.mouseSq&&(e.mouseSq=i,e.dest=i!==e.orig?i:void 0,t.dom.redrawNow()),c1(t)}})}function P2(t,e){t.drawable.current&&(t.drawable.current.pos=wr(e))}function N2(t){const e=t.drawable.current;e&&(e.mouseSq&&U2(t.drawable,e),u1(t))}function u1(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function L2(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),d1(t.drawable))}function I2(t){var e;const n=(t.shiftKey||t.ctrlKey)&&KC(t),i=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return M2[(n?1:0)+(i?2:0)]}function U2(t,e){const n=a=>a.orig===e.orig&&a.dest===e.dest,i=t.shapes.find(n);i&&(t.shapes=t.shapes.filter(a=>!n(a))),(!i||i.brush!==e.brush)&&t.shapes.push(e),d1(t)}function d1(t){t.onChange&&t.onChange(t.shapes)}function j2(t,e){if(!e.isTrusted||e.button!==void 0&&e.button!==0||e.touches&&e.touches.length>1)return;const n=t.dom.bounds(),i=wr(e),a=Vs(i,Bn(t),n);if(!a)return;const r=t.pieces.get(a),s=t.selected;!s&&t.drawable.enabled&&(t.drawable.eraseOnClick||!r||r.color!==t.turnColor)&&L2(t),e.cancelable!==!1&&(!e.touches||!t.movable.color||r||s||B2(t,i))&&e.preventDefault();const o=!!t.premovable.current,l=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&qp(t,t.selected,a)?$a(d=>Hh(d,a),t):Hh(t,a);const c=t.selected===a,u=h1(t,a);if(r&&u&&c&&S2(t,a)){t.draggable.current={orig:a,piece:r,origPos:i,pos:i,started:t.draggable.autoDistance&&t.stats.dragged,element:u,previouslySelected:s,originTarget:e.target},u.cgDragging=!0,u.classList.add("dragging");const d=t.dom.elements.ghost;d&&(d.className=`ghost ${r.color} ${r.role}`,id(d,Up(n)(Qe(a),Bn(t))),jp(d,!0)),Vp(t)}else o&&ja(t),l&&Ba(t);t.dom.redraw()}function B2(t,e){const n=Bn(t),i=t.dom.bounds(),a=Math.pow(i.width/8,2);for(const r in t.pieces){const s=GC(r,n,i);if(el(s,e)<=a)return!0}return!1}function q2(t,e,n,i){const a="a0";t.pieces.set(a,e),t.dom.redraw();const r=wr(n);t.draggable.current={orig:a,piece:e,origPos:r,pos:r,started:!0,element:()=>h1(t,a),originTarget:n.target,newPiece:!0,force:!!i},Vp(t)}function Vp(t){requestAnimationFrame(()=>{var e;const n=t.draggable.current;if(!n)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(n.orig)&&(t.animation.current=void 0);const i=t.pieces.get(n.orig);if(!i||!Vh(i,n.piece))mu(t);else if(!n.started&&el(n.pos,n.origPos)>=Math.pow(t.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const r=n.element();if(!r)return;r.cgDragging=!0,r.classList.add("dragging"),n.element=r}const a=t.dom.bounds();id(n.element,[n.pos[0]-a.left-a.width/16,n.pos[1]-a.top-a.height/16])}Vp(t)})}function z2(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=wr(e))}function F2(t,e){const n=t.draggable.current;if(!n)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&n.originTarget!==e.target&&!n.newPiece){t.draggable.current=void 0;return}ja(t),Ba(t);const i=wr(e)||n.pos,a=Vs(i,Bn(t),t.dom.bounds());a&&n.started&&n.orig!==a?n.newPiece?t1(t,n.orig,a,n.force):(t.stats.ctrlKey=e.ctrlKey,e1(t,n.orig,a)&&(t.stats.dragged=!0)):n.newPiece?t.pieces.delete(n.orig):t.draggable.deleteOnDropOff&&!a&&(t.pieces.delete(n.orig),Gt(t.events.change)),n.orig===n.previouslySelected&&(n.orig===a||!a)?wn(t):t.selectable.enabled||wn(t),f1(t),t.draggable.current=void 0,t.dom.redraw()}function mu(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,wn(t),f1(t),t.dom.redraw())}function f1(t){const e=t.dom.elements;e.ghost&&jp(e.ghost,!1)}function h1(t,e){let n=t.dom.elements.board.firstChild;for(;n;){if(n.cgKey===e&&n.tagName==="PIECE")return n;n=n.nextSibling}}function V2(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{x0(t,2),setTimeout(()=>x0(t,void 0),120)},120)}function x0(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function H2(t,e){function n(){d2(t),e()}return{set(i){i.orientation&&i.orientation!==t.orientation&&n(),(i.fen?$a:Zi)(a=>s1(a,i),t)},state:t,getFen:()=>w2(t.pieces),toggleOrientation:n,setPieces(i){$a(a=>f2(a,i),t)},selectSquare(i,a){i?$a(r=>Hh(r,i,a),t):t.selected&&(wn(t),t.dom.redraw())},move(i,a){$a(r=>ZC(r,i,a),t)},newPiece(i,a){$a(r=>Bp(r,i,a),t)},playPremove(){if(t.premovable.current){if($a(T2,t))return!0;t.dom.redraw()}return!1},playPredrop(i){if(t.predroppable.current){const a=C2(t,i);return t.dom.redraw(),a}return!1},cancelPremove(){Zi(ja,t)},cancelPredrop(){Zi(Ba,t)},cancelMove(){Zi(i=>{Fp(i),mu(i)},t)},stop(){Zi(i=>{w0(i),mu(i)},t)},explode(i){V2(t,i)},setAutoShapes(i){Zi(a=>a.drawable.autoShapes=i,t)},setShapes(i){Zi(a=>a.drawable.shapes=i,t)},getKeyAtDomPos(i){return Vs(i,Bn(t),t.dom.bounds())},redrawAll:e,dragNewPiece(i,a,r){q2(t,i,a,r)},destroy(){w0(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function K2(){return{pieces:r1(a1),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:r2()}}function Cn(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function O0(t,e,n){const i=t.drawable,a=i.current,r=a&&a.mouseSq?a:void 0,s=new Map,o=t.dom.bounds();for(const h of i.shapes.concat(i.autoShapes).concat(r?[r]:[]))h.dest&&s.set(h.dest,(s.get(h.dest)||0)+1);const l=i.shapes.concat(i.autoShapes).map(h=>({shape:h,current:!1,hash:M0(h,s,!1,o)}));r&&l.push({shape:r,current:!0,hash:M0(r,s,!0,o)});const c=l.map(h=>h.hash).join(";");if(c===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=c;const u=e.querySelector("defs"),d=e.querySelector("g"),f=n.querySelector("g");G2(i,l,u),A0(t,l.filter(h=>!h.shape.customSvg),i.brushes,s,d),A0(t,l.filter(h=>h.shape.customSvg),i.brushes,s,f)}function G2(t,e,n){const i=new Map;let a;for(const o of e)o.shape.dest&&(a=t.brushes[o.shape.brush],o.shape.modifiers&&(a=m1(a,o.shape.modifiers)),i.set(a.key,a));const r=new Set;let s=n.firstChild;for(;s;)r.add(s.getAttribute("cgKey")),s=s.nextSibling;for(const[o,l]of i.entries())r.has(o)||n.appendChild(tM(l))}function A0(t,e,n,i,a){const r=t.dom.bounds(),s=new Map,o=[];for(const u of e)s.set(u.hash,!1);let l=a.firstChild,c;for(;l;)c=l.getAttribute("cgHash"),s.has(c)?s.set(c,!0):o.push(l),l=l.nextSibling;for(const u of o)a.removeChild(u);for(const u of e)s.get(u.hash)||a.appendChild(X2(t,u,n,i,r))}function M0({orig:t,dest:e,brush:n,piece:i,modifiers:a,customSvg:r},s,o,l){return[l.width,l.height,o,t,e,n,e&&(s.get(e)||0)>1,i&&Y2(i),a&&Q2(a),r&&J2(r)].filter(c=>c).join(",")}function Y2(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function Q2(t){return""+(t.lineWidth||"")}function J2(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n)>>>0;return"custom-"+e.toString()}function X2(t,{shape:e,current:n,hash:i},a,r,s){let o;if(e.customSvg){const l=Xl(Qe(e.orig),t.orientation);o=$2(e.customSvg,l,s)}else if(e.piece)o=eM(t.drawable.pieces.baseUrl,Xl(Qe(e.orig),t.orientation),e.piece,s);else{const l=Xl(Qe(e.orig),t.orientation);if(e.dest){let c=a[e.brush];e.modifiers&&(c=m1(c,e.modifiers)),o=W2(c,l,Xl(Qe(e.dest),t.orientation),n,(r.get(e.dest)||0)>1,s)}else o=Z2(a[e.brush],l,n,s)}return o.setAttribute("cgHash",i),o}function $2(t,e,n){const{width:i,height:a}=n,r=i/8,s=a/8,o=e[0]*r,l=(7-e[1])*s,c=Bi(Cn("g"),{transform:`translate(${o},${l})`}),u=Bi(Cn("svg"),{width:r,height:s,viewBox:"0 0 100 100"});return c.appendChild(u),u.innerHTML=t,c}function Z2(t,e,n,i){const a=pu(e,i),r=nM(i),s=(i.width+i.height)/32;return Bi(Cn("circle"),{stroke:t.color,"stroke-width":r[n?0:1],fill:"none",opacity:p1(t,n),cx:a[0],cy:a[1],r:s-r[1]/2})}function W2(t,e,n,i,a,r){const s=aM(r,a&&!i),o=pu(e,r),l=pu(n,r),c=l[0]-o[0],u=l[1]-o[1],d=Math.atan2(u,c),f=Math.cos(d)*s,h=Math.sin(d)*s;return Bi(Cn("line"),{stroke:t.color,"stroke-width":iM(t,i,r),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+t.key+")",opacity:p1(t,i),x1:o[0],y1:o[1],x2:l[0]-f,y2:l[1]-h})}function eM(t,e,n,i){const a=pu(e,i),r=i.width/8*(n.scale||1),s=n.color[0]+(n.role==="knight"?"n":n.role[0]).toUpperCase();return Bi(Cn("image"),{className:`${n.role} ${n.color}`,x:a[0]-r/2,y:a[1]-r/2,width:r,height:r,href:t+s+".svg"})}function tM(t){const e=Bi(Cn("marker"),{id:"arrowhead-"+t.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return e.appendChild(Bi(Cn("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function Bi(t,e){for(const n in e)t.setAttribute(n,e[n]);return t}function Xl(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function m1(t,e){return{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(n=>n).join("")}}function nM(t){const e=t.width/512;return[3*e,4*e]}function iM(t,e,n){return(t.lineWidth||10)*(e?.85:1)/512*n.width}function p1(t,e){return(t.opacity||1)*(e?.9:1)}function aM(t,e){return(e?20:10)/512*t.width}function pu(t,e){return[(t[0]+.5)*e.width/8,(7.5-t[1])*e.height/8]}function rM(t,e,n){t.innerHTML="",t.classList.add("cg-wrap");for(const c of n2)t.classList.toggle("orientation-"+c,e.orientation===c);t.classList.toggle("manipulable",!e.viewOnly);const i=ha("cg-helper");t.appendChild(i);const a=ha("cg-container");i.appendChild(a);const r=ha("cg-board");a.appendChild(r);let s,o;if(e.drawable.visible&&!n&&(s=Bi(Cn("svg"),{class:"cg-shapes"}),s.appendChild(Cn("defs")),s.appendChild(Cn("g")),o=Bi(Cn("svg"),{class:"cg-custom-svgs"}),o.appendChild(Cn("g")),a.appendChild(s),a.appendChild(o)),e.coordinates){const c=e.orientation==="black"?" black":"";a.appendChild(D0(Np,"ranks"+c)),a.appendChild(D0(Pp,"files"+c))}let l;return e.draggable.showGhost&&!n&&(l=ha("piece","ghost"),jp(l,!1),a.appendChild(l)),{board:r,container:a,ghost:l,svg:s,customSvg:o}}function D0(t,e){const n=ha("coords",e);let i;for(const a of t)i=ha("coord"),i.textContent=a,n.appendChild(i);return n}function sM(t,e){if(!t.dropmode.active)return;ja(t),Ba(t);const n=t.dropmode.piece;if(n){t.pieces.set("a0",n);const i=wr(e),a=i&&Vs(i,Bn(t),t.dom.bounds());a&&t1(t,"a0",a)}t.dom.redraw()}function oM(t,e){const n=t.dom.elements.board;if(!t.dom.relative&&t.resizable&&"ResizeObserver"in window&&new window.ResizeObserver(e).observe(n),t.viewOnly)return;const i=cM(t);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1}),(t.disableContextMenu||t.drawable.enabled)&&n.addEventListener("contextmenu",a=>a.preventDefault())}function lM(t,e){const n=[];if(!t.dom.relative&&t.resizable&&!("ResizeObserver"in window)&&n.push(to(document.body,"chessground.resize",e)),!t.viewOnly){const i=P0(t,z2,P2),a=P0(t,F2,N2);for(const s of["touchmove","mousemove"])n.push(to(document,s,i));for(const s of["touchend","mouseup"])n.push(to(document,s,a));const r=()=>t.dom.bounds.clear();n.push(to(document,"scroll",r,{capture:!0,passive:!0})),n.push(to(window,"resize",r,{passive:!0}))}return()=>n.forEach(i=>i())}function to(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function cM(t){return e=>{t.draggable.current?mu(t):t.drawable.current?u1(t):e.shiftKey||KC(e)?t.drawable.enabled&&D2(t,e):t.viewOnly||(t.dropmode.active?sM(t,e):j2(t,e))}}function P0(t,e,n){return i=>{t.drawable.current?t.drawable.enabled&&n(t,i):t.viewOnly||e(t,i)}}function uM(t){const e=Bn(t),n=t.dom.relative?s2:Up(t.dom.bounds()),i=t.dom.relative?o2:id,a=t.dom.elements.board,r=t.pieces,s=t.animation.current,o=s?s.plan.anims:new Map,l=s?s.plan.fadings:new Map,c=t.draggable.current,u=fM(t),d=new Set,f=new Set,h=new Map,v=new Map;let g,C,m,b,S,p,y,k,_,O;for(C=a.firstChild;C;){if(g=C.cgKey,g1(C))if(m=r.get(g),S=o.get(g),p=l.get(g),b=C.cgPiece,C.cgDragging&&(!c||c.orig!==g)&&(C.classList.remove("dragging"),i(C,n(Qe(g),e)),C.cgDragging=!1),!p&&C.cgFading&&(C.cgFading=!1,C.classList.remove("fading")),m){if(S&&C.cgAnimating&&b===no(m)){const w=Qe(g);w[0]+=S[2],w[1]+=S[3],C.classList.add("anim"),i(C,n(w,e))}else C.cgAnimating&&(C.cgAnimating=!1,C.classList.remove("anim"),i(C,n(Qe(g),e)),t.addPieceZIndex&&(C.style.zIndex=df(Qe(g),e)));b===no(m)&&(!p||!C.cgFading)?d.add(g):p&&b===no(p)?(C.classList.add("fading"),C.cgFading=!0):ff(h,b,C)}else ff(h,b,C);else if(v1(C)){const w=C.className;u.get(g)===w?f.add(g):ff(v,w,C)}C=C.nextSibling}for(const[w,R]of u)if(!f.has(w)){_=v.get(R),O=_&&_.pop();const N=n(Qe(w),e);if(O)O.cgKey=w,i(O,N);else{const z=ha("square",R);z.cgKey=w,i(z,N),a.insertBefore(z,a.firstChild)}}for(const[w,R]of r)if(S=o.get(w),!d.has(w))if(y=h.get(no(R)),k=y&&y.pop(),k){k.cgKey=w,k.cgFading&&(k.classList.remove("fading"),k.cgFading=!1);const N=Qe(w);t.addPieceZIndex&&(k.style.zIndex=df(N,e)),S&&(k.cgAnimating=!0,k.classList.add("anim"),N[0]+=S[2],N[1]+=S[3]),i(k,n(N,e))}else{const N=no(R),z=ha("piece",N),Z=Qe(w);z.cgPiece=N,z.cgKey=w,S&&(z.cgAnimating=!0,Z[0]+=S[2],Z[1]+=S[3]),i(z,n(Z,e)),t.addPieceZIndex&&(z.style.zIndex=df(Z,e)),a.appendChild(z)}for(const w of h.values())N0(t,w);for(const w of v.values())N0(t,w)}function dM(t){if(t.dom.relative)return;const e=Bn(t),n=Up(t.dom.bounds());let i=t.dom.elements.board.firstChild;for(;i;)(g1(i)&&!i.cgAnimating||v1(i))&&id(i,n(Qe(i.cgKey),e)),i=i.nextSibling}function g1(t){return t.tagName==="PIECE"}function v1(t){return t.tagName==="SQUARE"}function N0(t,e){for(const n of e)t.dom.elements.board.removeChild(n)}function df(t,e){let n=2+t[1]*8+(7-t[0]);return e&&(n=67-n),n+""}function no(t){return`${t.color} ${t.role}`}function fM(t){var e;const n=new Map;if(t.lastMove&&t.highlight.lastMove)for(const r of t.lastMove)Yi(n,r,"last-move");if(t.check&&t.highlight.check&&Yi(n,t.check,"check"),t.selected&&(Yi(n,t.selected,"selected"),t.movable.showDests)){const r=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(r)for(const o of r)Yi(n,o,"move-dest"+(t.pieces.has(o)?" oc":""));const s=t.premovable.dests;if(s)for(const o of s)Yi(n,o,"premove-dest"+(t.pieces.has(o)?" oc":""))}const i=t.premovable.current;if(i)for(const r of i)Yi(n,r,"current-premove");else t.predroppable.current&&Yi(n,t.predroppable.current.key,"current-premove");const a=t.exploding;if(a)for(const r of a.keys)Yi(n,r,"exploding"+a.stage);return n}function Yi(t,e,n){const i=t.get(e);i?t.set(e,`${i} ${n}`):t.set(e,n)}function ff(t,e,n){const i=t.get(e);i?i.push(n):t.set(e,[n])}function hM(t,e){const n=K2();s1(n,e||{});function i(){const a="dom"in n?n.dom.unbind:void 0,r=n.viewOnly&&!n.drawable.visible,s=rM(t,n,r),o=a2(()=>s.board.getBoundingClientRect()),l=d=>{uM(u),!d&&s.svg&&O0(u,s.svg,s.customSvg)},c=()=>{o.clear(),dM(u),s.svg&&O0(u,s.svg,s.customSvg)},u=n;return u.dom={elements:s,bounds:o,redraw:mM(l),redrawNow:l,unbind:a,relative:r},u.drawable.prevSvgHash="",l(!1),oM(u,c),a||(u.dom.unbind=lM(u,c)),u.events.insert&&u.events.insert(s),u}return H2(i(),i)}function mM(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}function gu(){return gu=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},gu.apply(this,arguments)}function pM(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function b1(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Hp=function(t){pM(e,t);function e(){return t.apply(this,arguments)||this}var n=e.prototype;return n.buildConfigFromProps=function(a){var r={events:{}};return Object.keys(e.propTypes).forEach(function(s){var o=a[s];if(typeof o<"u"){var l=s.match(/^on([A-Z]\S*)/);l?r.events[l[1].toLowerCase()]=o:r[s]=o}}),r},n.componentDidMount=function(){this.cg=hM(this.el,this.buildConfigFromProps(this.props))},n.componentWillReceiveProps=function(a){this.cg.set(this.buildConfigFromProps(a))},n.componentWillUnmount=function(){this.cg.destroy()},n.render=function(){var a=this,r={style:gu({},this.props.style)};return this.props.width&&(r.style.width=this.props.width),this.props.height&&(r.style.height=this.props.height),Di.createElement("div",gu({ref:function(o){return a.el=o}},r))},e}(Di.Component);b1(Hp,"propTypes",{width:ve.oneOfType([ve.string,ve.number]),height:ve.oneOfType([ve.string,ve.number]),fen:ve.string,orientation:ve.string,turnColor:ve.string,check:ve.string,lastMove:ve.array,selected:ve.string,coordinates:ve.bool,autoCastle:ve.bool,viewOnly:ve.bool,disableContextMenu:ve.bool,resizable:ve.bool,addPieceZIndex:ve.bool,highlight:ve.object,animation:ve.object,movable:ve.object,premovable:ve.object,predroppable:ve.object,draggable:ve.object,selectable:ve.object,onChange:ve.func,onMove:ve.func,onDropNewPiece:ve.func,onSelect:ve.func,items:ve.object,drawable:ve.object});b1(Hp,"defaultProps",{coordinates:!0,resizable:!0,highlight:{lastMove:!0,check:!0}});const gM=Object.freeze(Object.defineProperty({__proto__:null,default:Hp},Symbol.toStringTag,{value:"Module"})),vM=Q_(gM);var bM=vM;const yM=wm(bM);function SM(t){return t!==null?{comment:t,variations:[]}:{variations:[]}}function TM(t,e,n,i,a){const r={move:t,variations:a};return e&&(r.suffix=e),n&&(r.nag=n),i!==null&&(r.comment=i),r}function CM(...t){const[e,...n]=t;let i=e;for(const a of n)a!==null&&(i.variations=[a,...a.variations],a.variations=[],i=a);return e}function kM(t,e){if(e.marker&&e.marker.comment){let n=e.root;for(;;){const i=n.variations[0];if(!i){n.comment=e.marker.comment;break}n=i}}return{headers:t,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function EM(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function xs(t,e,n,i){var a=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(a,xs.prototype),a.expected=e,a.found=n,a.location=i,a.name="SyntaxError",a}EM(xs,Error);function hf(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,n+=n.repeat(e),t+n.slice(0,e))}xs.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n=null,i;for(i=0;i<t.length;i++)if(t[i].source===this.location.source){n=t[i].text.split(/\r\n|\n|\r/g);break}var a=this.location.start,r=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(a):a,s=this.location.source+":"+r.line+":"+r.column;if(n){var o=this.location.end,l=hf("",r.line.toString().length," "),c=n[a.line-1],u=a.line===o.line?o.column:c.length+1,d=u-a.column||1;e+=`
 --> `+s+`
`+l+` |
`+r.line+" | "+c+`
`+l+" | "+hf("",a.column-1," ")+hf("",d,"^")}else e+=`
 at `+s}return e};xs.buildMessage=function(t,e){var n={literal:function(c){return'"'+a(c.text)+'"'},class:function(c){var u=c.parts.map(function(d){return Array.isArray(d)?r(d[0])+"-"+r(d[1]):r(d)});return"["+(c.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function i(c){return c.charCodeAt(0).toString(16).toUpperCase()}function a(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function r(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function s(c){return n[c.type](c)}function o(c){var u=c.map(s),d,f;if(u.sort(),u.length>0){for(d=1,f=1;d<u.length;d++)u[d-1]!==u[d]&&(u[f]=u[d],f++);u.length=f}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}function l(c){return c?'"'+a(c)+'"':"end of input"}return"Expected "+o(t)+" but "+l(e)+" found."};function _M(t,e){e=e!==void 0?e:{};var n={},i=e.grammarSource,a={pgn:Ug},r=Ug,s="[",o='"',l="]",c=".",u="O-O-O",d="O-O",f="0-0-0",h="0-0",v="$",g="{",C="}",m=";",b="(",S=")",p="1-0",y="0-1",k="1/2-1/2",_="*",O=/^[a-zA-Z]/,w=/^[^"]/,R=/^[0-9]/,N=/^[.]/,z=/^[a-zA-Z1-8\-=]/,Z=/^[+#]/,fe=/^[!?]/,Ge=/^[^}]/,F=/^[^\r\n]/,G=/^[ \t\r\n]/,Y=dn("tag pair"),re=ct("[",!1),Te=ct('"',!1),Qt=ct("]",!1),Rt=dn("tag name"),Ut=Kn([["a","z"],["A","Z"]],!1,!1),Jt=dn("tag value"),un=Kn(['"'],!0,!1),ui=dn("move number"),Ie=Kn([["0","9"]],!1,!1),Hn=ct(".",!1),Ki=Kn(["."],!1,!1),Al=dn("standard algebraic notation"),t_=ct("O-O-O",!1),n_=ct("O-O",!1),i_=ct("0-0-0",!1),a_=ct("0-0",!1),Ag=Kn([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),r_=Kn(["+","#"],!1,!1),s_=dn("suffix annotation"),Mg=Kn(["!","?"],!1,!1),o_=dn("NAG"),l_=ct("$",!1),c_=dn("brace comment"),u_=ct("{",!1),Dg=Kn(["}"],!0,!1),d_=ct("}",!1),f_=dn("rest of line comment"),h_=ct(";",!1),Pg=Kn(["\r",`
`],!0,!1),m_=dn("variation"),p_=ct("(",!1),g_=ct(")",!1),v_=dn("game termination marker"),b_=ct("1-0",!1),y_=ct("0-1",!1),S_=ct("1/2-1/2",!1),T_=ct("*",!1),C_=dn("whitespace"),Ng=Kn([" ","	","\r",`
`],!1,!1),k_=function(M,I){return kM(M,I)},E_=function(M){return Object.fromEntries(M)},__=function(M,I){return[M,I]},w_=function(M,I){return{root:M,marker:I}},R_=function(M,I){return CM(SM(M),...I.flat())},x_=function(M,I,U,J,X){return TM(M,I,U,J,X)},O_=function(M){return M},A_=function(M){return M.replace(/[\r\n]+/g," ")},M_=function(M){return M.trim()},D_=function(M){return M},P_=function(M,I){return{result:M,comment:I}},P=e.peg$currPos|0,Mr=[{line:1,column:1}],An=P,Ml=e.peg$maxFailExpected||[],K=e.peg$silentFails|0,Gs;if(e.startRule){if(!(e.startRule in a))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');r=a[e.startRule]}function ct(M,I){return{type:"literal",text:M,ignoreCase:I}}function Kn(M,I,U){return{type:"class",parts:M,inverted:I,ignoreCase:U}}function N_(){return{type:"end"}}function dn(M){return{type:"other",description:M}}function Lg(M){var I=Mr[M],U;if(I)return I;if(M>=Mr.length)U=Mr.length-1;else for(U=M;!Mr[--U];);for(I=Mr[U],I={line:I.line,column:I.column};U<M;)t.charCodeAt(U)===10?(I.line++,I.column=1):I.column++,U++;return Mr[M]=I,I}function Ig(M,I,U){var J=Lg(M),X=Lg(I),Ce={source:i,start:{offset:M,line:J.line,column:J.column},end:{offset:I,line:X.line,column:X.column}};return Ce}function Q(M){P<An||(P>An&&(An=P,Ml=[]),Ml.push(M))}function L_(M,I,U){return new xs(xs.buildMessage(M,I),M,I,U)}function Ug(){var M,I,U;return M=P,I=I_(),U=B_(),M=k_(I,U),M}function I_(){var M,I,U;for(M=P,I=[],U=jg();U!==n;)I.push(U),U=jg();return U=xt(),M=E_(I),M}function jg(){var M,I,U,J,X,Ce,Ha;return K++,M=P,xt(),t.charCodeAt(P)===91?(I=s,P++):(I=n,K===0&&Q(re)),I!==n?(xt(),U=U_(),U!==n?(xt(),t.charCodeAt(P)===34?(J=o,P++):(J=n,K===0&&Q(Te)),J!==n?(X=j_(),t.charCodeAt(P)===34?(Ce=o,P++):(Ce=n,K===0&&Q(Te)),Ce!==n?(xt(),t.charCodeAt(P)===93?(Ha=l,P++):(Ha=n,K===0&&Q(Qt)),Ha!==n?M=__(U,X):(P=M,M=n)):(P=M,M=n)):(P=M,M=n)):(P=M,M=n)):(P=M,M=n),K--,M===n&&K===0&&Q(Y),M}function U_(){var M,I,U;if(K++,M=P,I=[],U=t.charAt(P),O.test(U)?P++:(U=n,K===0&&Q(Ut)),U!==n)for(;U!==n;)I.push(U),U=t.charAt(P),O.test(U)?P++:(U=n,K===0&&Q(Ut));else I=n;return I!==n?M=t.substring(M,P):M=I,K--,M===n&&(I=n,K===0&&Q(Rt)),M}function j_(){var M,I,U;for(K++,M=P,I=[],U=t.charAt(P),w.test(U)?P++:(U=n,K===0&&Q(un));U!==n;)I.push(U),U=t.charAt(P),w.test(U)?P++:(U=n,K===0&&Q(un));return M=t.substring(M,P),K--,I=n,K===0&&Q(Jt),M}function B_(){var M,I,U;return M=P,I=Bg(),xt(),U=K_(),U===n&&(U=null),xt(),M=w_(I,U),M}function Bg(){var M,I,U,J;for(M=P,I=Cd(),I===n&&(I=null),U=[],J=qg();J!==n;)U.push(J),J=qg();return M=R_(I,U),M}function qg(){var M,I,U,J,X,Ce,Ha,Dl;if(M=P,xt(),q_(),xt(),I=z_(),I!==n){for(U=F_(),U===n&&(U=null),J=[],X=zg();X!==n;)J.push(X),X=zg();for(X=xt(),Ce=Cd(),Ce===n&&(Ce=null),Ha=[],Dl=Fg();Dl!==n;)Ha.push(Dl),Dl=Fg();M=x_(I,U,J,Ce,Ha)}else P=M,M=n;return M}function q_(){var M,I,U,J,X,Ce;for(K++,M=P,I=[],U=t.charAt(P),R.test(U)?P++:(U=n,K===0&&Q(Ie));U!==n;)I.push(U),U=t.charAt(P),R.test(U)?P++:(U=n,K===0&&Q(Ie));if(t.charCodeAt(P)===46?(U=c,P++):(U=n,K===0&&Q(Hn)),U!==n){for(J=xt(),X=[],Ce=t.charAt(P),N.test(Ce)?P++:(Ce=n,K===0&&Q(Ki));Ce!==n;)X.push(Ce),Ce=t.charAt(P),N.test(Ce)?P++:(Ce=n,K===0&&Q(Ki));I=[I,U,J,X],M=I}else P=M,M=n;return K--,M===n&&(I=n,K===0&&Q(ui)),M}function z_(){var M,I,U,J,X,Ce;if(K++,M=P,I=P,t.substr(P,5)===u?(U=u,P+=5):(U=n,K===0&&Q(t_)),U===n&&(t.substr(P,3)===d?(U=d,P+=3):(U=n,K===0&&Q(n_)),U===n&&(t.substr(P,5)===f?(U=f,P+=5):(U=n,K===0&&Q(i_)),U===n&&(t.substr(P,3)===h?(U=h,P+=3):(U=n,K===0&&Q(a_)),U===n))))if(U=P,J=t.charAt(P),O.test(J)?P++:(J=n,K===0&&Q(Ut)),J!==n){if(X=[],Ce=t.charAt(P),z.test(Ce)?P++:(Ce=n,K===0&&Q(Ag)),Ce!==n)for(;Ce!==n;)X.push(Ce),Ce=t.charAt(P),z.test(Ce)?P++:(Ce=n,K===0&&Q(Ag));else X=n;X!==n?(J=[J,X],U=J):(P=U,U=n)}else P=U,U=n;return U!==n?(J=t.charAt(P),Z.test(J)?P++:(J=n,K===0&&Q(r_)),J===n&&(J=null),U=[U,J],I=U):(P=I,I=n),I!==n?M=t.substring(M,P):M=I,K--,M===n&&(I=n,K===0&&Q(Al)),M}function F_(){var M,I,U;for(K++,M=P,I=[],U=t.charAt(P),fe.test(U)?P++:(U=n,K===0&&Q(Mg));U!==n;)I.push(U),I.length>=2?U=n:(U=t.charAt(P),fe.test(U)?P++:(U=n,K===0&&Q(Mg)));return I.length<1?(P=M,M=n):M=I,K--,M===n&&(I=n,K===0&&Q(s_)),M}function zg(){var M,I,U,J,X;if(K++,M=P,xt(),t.charCodeAt(P)===36?(I=v,P++):(I=n,K===0&&Q(l_)),I!==n){if(U=P,J=[],X=t.charAt(P),R.test(X)?P++:(X=n,K===0&&Q(Ie)),X!==n)for(;X!==n;)J.push(X),X=t.charAt(P),R.test(X)?P++:(X=n,K===0&&Q(Ie));else J=n;J!==n?U=t.substring(U,P):U=J,U!==n?M=O_(U):(P=M,M=n)}else P=M,M=n;return K--,M===n&&K===0&&Q(o_),M}function Cd(){var M;return M=V_(),M===n&&(M=H_()),M}function V_(){var M,I,U,J,X;if(K++,M=P,t.charCodeAt(P)===123?(I=g,P++):(I=n,K===0&&Q(u_)),I!==n){for(U=P,J=[],X=t.charAt(P),Ge.test(X)?P++:(X=n,K===0&&Q(Dg));X!==n;)J.push(X),X=t.charAt(P),Ge.test(X)?P++:(X=n,K===0&&Q(Dg));U=t.substring(U,P),t.charCodeAt(P)===125?(J=C,P++):(J=n,K===0&&Q(d_)),J!==n?M=A_(U):(P=M,M=n)}else P=M,M=n;return K--,M===n&&(I=n,K===0&&Q(c_)),M}function H_(){var M,I,U,J,X;if(K++,M=P,t.charCodeAt(P)===59?(I=m,P++):(I=n,K===0&&Q(h_)),I!==n){for(U=P,J=[],X=t.charAt(P),F.test(X)?P++:(X=n,K===0&&Q(Pg));X!==n;)J.push(X),X=t.charAt(P),F.test(X)?P++:(X=n,K===0&&Q(Pg));U=t.substring(U,P),M=M_(U)}else P=M,M=n;return K--,M===n&&(I=n,K===0&&Q(f_)),M}function Fg(){var M,I,U,J;return K++,M=P,xt(),t.charCodeAt(P)===40?(I=b,P++):(I=n,K===0&&Q(p_)),I!==n?(U=Bg(),U!==n?(xt(),t.charCodeAt(P)===41?(J=S,P++):(J=n,K===0&&Q(g_)),J!==n?M=D_(U):(P=M,M=n)):(P=M,M=n)):(P=M,M=n),K--,M===n&&K===0&&Q(m_),M}function K_(){var M,I,U;return K++,M=P,t.substr(P,3)===p?(I=p,P+=3):(I=n,K===0&&Q(b_)),I===n&&(t.substr(P,3)===y?(I=y,P+=3):(I=n,K===0&&Q(y_)),I===n&&(t.substr(P,7)===k?(I=k,P+=7):(I=n,K===0&&Q(S_)),I===n&&(t.charCodeAt(P)===42?(I=_,P++):(I=n,K===0&&Q(T_))))),I!==n?(xt(),U=Cd(),U===n&&(U=null),M=P_(I,U)):(P=M,M=n),K--,M===n&&(I=n,K===0&&Q(v_)),M}function xt(){var M,I;for(K++,M=[],I=t.charAt(P),G.test(I)?P++:(I=n,K===0&&Q(Ng));I!==n;)M.push(I),I=t.charAt(P),G.test(I)?P++:(I=n,K===0&&Q(Ng));return K--,I=n,K===0&&Q(C_),M}if(Gs=r(),e.peg$library)return{peg$result:Gs,peg$currPos:P,peg$FAILED:n,peg$maxFailExpected:Ml,peg$maxFailPos:An};if(Gs!==n&&P===t.length)return Gs;throw Gs!==n&&P<t.length&&Q(N_()),L_(Ml,An<t.length?t.charAt(An):null,An<t.length?Ig(An,An+1):Ig(An,An))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const Cc=0xffffffffffffffffn;function mf(t,e){return(t<<e|t>>64n-e)&0xffffffffffffffffn}function L0(t,e){return t*e&Cc}function wM(t){return function(){let e=BigInt(t&Cc),n=BigInt(t>>64n&Cc);const i=L0(mf(L0(e,5n),7n),9n);return n^=e,e=(mf(e,24n)^n^n<<16n)&Cc,n=mf(n,37n),t=n<<64n|e,i}}const ad=wM(0xa187eb39cdcaed8f31c4b365b102e01en),RM=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>ad()))),xM=Array.from({length:8},()=>ad()),OM=Array.from({length:16},()=>ad()),pf=ad(),_t="w",Xt="b",We="p",Kh="n",kc="b",bo="r",na="q",rt="k",gf="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class $l{constructor(e,n){Ue(this,"color");Ue(this,"from");Ue(this,"to");Ue(this,"piece");Ue(this,"captured");Ue(this,"promotion");Ue(this,"flags");Ue(this,"san");Ue(this,"lan");Ue(this,"before");Ue(this,"after");const{color:i,piece:a,from:r,to:s,flags:o,captured:l,promotion:c}=n,u=ut(r),d=ut(s);this.color=i,this.piece=a,this.from=u,this.to=d,this.san=e._moveToSan(n,e._moves({legal:!0})),this.lan=u+d,this.before=e.fen(),e._makeMove(n),this.after=e.fen(),e._undoMove(),this.flags="";for(const f in te)te[f]&o&&(this.flags+=Ga[f]);l&&(this.captured=l),c&&(this.promotion=c,this.lan+=c)}isCapture(){return this.flags.indexOf(Ga.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Ga.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Ga.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Ga.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Ga.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Ga.BIG_PAWN)>-1}}const gt=-1,Ga={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},te={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Gh={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},AM={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},MM={...Gh,...AM},W={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},vf={b:[16,32,17,15],w:[-16,-32,-17,-15]},I0={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},DM=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],PM=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],NM={p:1,n:2,b:4,r:8,q:16,k:32},LM="pnbrqkPNBRQK",U0=[Kh,kc,bo,na],IM=7,UM=6,jM=1,BM=0,Zl={[rt]:te.KSIDE_CASTLE,[na]:te.QSIDE_CASTLE},Qi={w:[{square:W.a1,flag:te.QSIDE_CASTLE},{square:W.h1,flag:te.KSIDE_CASTLE}],b:[{square:W.a8,flag:te.QSIDE_CASTLE},{square:W.h8,flag:te.KSIDE_CASTLE}]},qM={b:jM,w:UM},bf="--";function rr(t){return t>>4}function tl(t){return t&15}function y1(t){return"0123456789".indexOf(t)!==-1}function ut(t){const e=tl(t),n=rr(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function io(t){return t===_t?Xt:_t}function zM(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(e[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const a=e[0].split("/");if(a.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let s=0;s<a.length;s++){let o=0,l=!1;for(let c=0;c<a[s].length;c++)if(y1(a[s][c])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};o+=parseInt(a[s][c],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(a[s][c]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};o+=1,l=!1}if(o!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const r=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:s,regex:o}of r){if(!o.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${s} king`};if((e[0].match(o)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${s} kings`}}return Array.from(a[0]+a[7]).some(s=>s.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function FM(t,e){const n=t.from,i=t.to,a=t.piece;let r=0,s=0,o=0;for(let l=0,c=e.length;l<c;l++){const u=e[l].from,d=e[l].to,f=e[l].piece;a===f&&n!==u&&i===d&&(r++,rr(n)===rr(u)&&s++,tl(n)===tl(u)&&o++)}return r>0?s>0&&o>0?ut(n):o>0?ut(n).charAt(1):ut(n).charAt(0):""}function Ji(t,e,n,i,a,r=void 0,s=te.NORMAL){const o=rr(i);if(a===We&&(o===IM||o===BM))for(let l=0;l<U0.length;l++){const c=U0[l];t.push({color:e,from:n,to:i,piece:a,captured:r,promotion:c,flags:s|te.PROMOTION})}else t.push({color:e,from:n,to:i,piece:a,captured:r,flags:s})}function j0(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:We:(e=e.toLowerCase(),e==="o"?rt:e)}function yf(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Sf{constructor(e=gf,{skipValidation:n=!1}={}){Ue(this,"_board",new Array(128));Ue(this,"_turn",_t);Ue(this,"_header",{});Ue(this,"_kings",{w:gt,b:gt});Ue(this,"_epSquare",-1);Ue(this,"_halfMoves",0);Ue(this,"_moveNumber",0);Ue(this,"_history",[]);Ue(this,"_comments",{});Ue(this,"_castling",{w:0,b:0});Ue(this,"_hash",0n);Ue(this,"_positionCount",new Map);this.load(e,{skipValidation:n})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:gt,b:gt},this._turn=_t,this._castling={w:0,b:0},this._epSquare=gt,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...MM},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:n=!1,preserveHeaders:i=!1}={}){let a=e.split(/\s+/);if(a.length>=2&&a.length<6){const o=["-","-","0","1"];e=a.concat(o.slice(-(6-a.length))).join(" ")}if(a=e.split(/\s+/),!n){const{ok:o,error:l}=zM(e);if(!o)throw new Error(l)}const r=a[0];let s=0;this.clear({preserveHeaders:i});for(let o=0;o<r.length;o++){const l=r.charAt(o);if(l==="/")s+=8;else if(y1(l))s+=parseInt(l,10);else{const c=l<"a"?_t:Xt;this._put({type:l.toLowerCase(),color:c},ut(s)),s++}}this._turn=a[1],a[2].indexOf("K")>-1&&(this._castling.w|=te.KSIDE_CASTLE),a[2].indexOf("Q")>-1&&(this._castling.w|=te.QSIDE_CASTLE),a[2].indexOf("k")>-1&&(this._castling.b|=te.KSIDE_CASTLE),a[2].indexOf("q")>-1&&(this._castling.b|=te.QSIDE_CASTLE),this._epSquare=a[3]==="-"?gt:W[a[3]],this._halfMoves=parseInt(a[4],10),this._moveNumber=parseInt(a[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){var s,o;let n=0,i="";for(let l=W.a8;l<=W.h1;l++){if(this._board[l]){n>0&&(i+=n,n=0);const{color:c,type:u}=this._board[l];i+=c===_t?u.toUpperCase():u.toLowerCase()}else n++;l+1&136&&(n>0&&(i+=n),l!==W.h1&&(i+="/"),n=0,l+=8)}let a="";this._castling[_t]&te.KSIDE_CASTLE&&(a+="K"),this._castling[_t]&te.QSIDE_CASTLE&&(a+="Q"),this._castling[Xt]&te.KSIDE_CASTLE&&(a+="k"),this._castling[Xt]&te.QSIDE_CASTLE&&(a+="q"),a=a||"-";let r="-";if(this._epSquare!==gt)if(e)r=ut(this._epSquare);else{const l=this._epSquare+(this._turn===_t?16:-16),c=[l+1,l-1];for(const u of c){if(u&136)continue;const d=this._turn;if(((s=this._board[u])==null?void 0:s.color)===d&&((o=this._board[u])==null?void 0:o.type)===We){this._makeMove({color:d,from:u,to:this._epSquare,piece:We,captured:We,flags:te.EP_CAPTURE});const f=!this._isKingAttacked(d);if(this._undoMove(),f){r=ut(this._epSquare);break}}}}return[i,this._turn,a,r,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:n,type:i}=this._board[e],a={w:0,b:1}[n],r={p:0,n:1,b:2,r:3,q:4,k:5}[i];return RM[a][r][e]}_epKey(){return this._epSquare===gt?0n:xM[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return OM[e]}_computeHash(){let e=0n;for(let n=W.a8;n<=W.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(e^=this._pieceKey(n))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=pf),e}_updateSetup(e){this._history.length>0||(e!==gf?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(gf)}get(e){return this._board[W[e]]}findPiece(e){var i;const n=[];for(let a=W.a8;a<=W.h1;a++){if(a&136){a+=7;continue}!this._board[a]||((i=this._board[a])==null?void 0:i.color)!==e.color||this._board[a].color===e.color&&this._board[a].type===e.type&&n.push(ut(a))}return n}put({type:e,color:n},i){return this._put({type:e,color:n},i)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,n){this._hash^=this._pieceKey(e),this._board[e]=n,this._hash^=this._pieceKey(e)}_put({type:e,color:n},i){if(LM.indexOf(e.toLowerCase())===-1||!(i in W))return!1;const a=W[i];if(e==rt&&!(this._kings[n]==gt||this._kings[n]==a))return!1;const r=this._board[a];return r&&r.type===rt&&(this._kings[r.color]=gt),this._set(a,{type:e,color:n}),e===rt&&(this._kings[n]=a),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const n=this.get(e);return this._clear(W[e]),n&&n.type===rt&&(this._kings[n.color]=gt),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var i,a,r,s,o,l,c,u,d,f,h,v;this._hash^=this._castlingKey();const e=((i=this._board[W.e1])==null?void 0:i.type)===rt&&((a=this._board[W.e1])==null?void 0:a.color)===_t,n=((r=this._board[W.e8])==null?void 0:r.type)===rt&&((s=this._board[W.e8])==null?void 0:s.color)===Xt;(!e||((o=this._board[W.a1])==null?void 0:o.type)!==bo||((l=this._board[W.a1])==null?void 0:l.color)!==_t)&&(this._castling.w&=-65),(!e||((c=this._board[W.h1])==null?void 0:c.type)!==bo||((u=this._board[W.h1])==null?void 0:u.color)!==_t)&&(this._castling.w&=-33),(!n||((d=this._board[W.a8])==null?void 0:d.type)!==bo||((f=this._board[W.a8])==null?void 0:f.color)!==Xt)&&(this._castling.b&=-65),(!n||((h=this._board[W.h8])==null?void 0:h.type)!==bo||((v=this._board[W.h8])==null?void 0:v.color)!==Xt)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var r,s;if(this._epSquare===gt)return;const e=this._epSquare+(this._turn===_t?-16:16),n=this._epSquare+(this._turn===_t?16:-16),i=[n+1,n-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((r=this._board[n])==null?void 0:r.color)!==io(this._turn)||((s=this._board[n])==null?void 0:s.type)!==We){this._hash^=this._epKey(),this._epSquare=gt;return}const a=o=>{var l,c;return!(o&136)&&((l=this._board[o])==null?void 0:l.color)===this._turn&&((c=this._board[o])==null?void 0:c.type)===We};i.some(a)||(this._hash^=this._epKey(),this._epSquare=gt)}_attacked(e,n,i){const a=[];for(let r=W.a8;r<=W.h1;r++){if(r&136){r+=7;continue}if(this._board[r]===void 0||this._board[r].color!==e)continue;const s=this._board[r],o=r-n;if(o===0)continue;const l=o+119;if(DM[l]&NM[s.type]){if(s.type===We){if(o>0&&s.color===_t||o<=0&&s.color===Xt)if(i)a.push(ut(r));else return!0;continue}if(s.type==="n"||s.type==="k")if(i){a.push(ut(r));continue}else return!0;const c=PM[l];let u=r+c,d=!1;for(;u!==n;){if(this._board[u]!=null){d=!0;break}u+=c}if(!d)if(i){a.push(ut(r));continue}else return!0}}return i?a:!1}attackers(e,n){return n?this._attacked(n,W[e],!0):this._attacked(this._turn,W[e],!0)}_isKingAttacked(e){const n=this._kings[e];return n===-1?!1:this._attacked(io(e),n)}hash(){return this._hash.toString(16)}isAttacked(e,n){return this._attacked(n,W[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let i=0,a=0;for(let r=W.a8;r<=W.h1;r++){if(a=(a+1)%2,r&136){r+=7;continue}const s=this._board[r];s&&(e[s.type]=s.type in e?e[s.type]+1:1,s.type===kc&&n.push(a),i++)}if(i===2)return!0;if(i===3&&(e[kc]===1||e[Kh]===1))return!0;if(i===e[kc]+2){let r=0;const s=n.length;for(let o=0;o<s;o++)r+=n[o];if(r===0||r===s)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:n=void 0,piece:i=void 0}={}){const a=this._moves({square:n,piece:i});return e?a.map(r=>new $l(this,r)):a.map(r=>this._moveToSan(r,a))}_moves({legal:e=!0,piece:n=void 0,square:i=void 0}={}){var h;const a=i?i.toLowerCase():void 0,r=n==null?void 0:n.toLowerCase(),s=[],o=this._turn,l=io(o);let c=W.a8,u=W.h1,d=!1;if(a)if(a in W)c=u=W[a],d=!0;else return[];for(let v=c;v<=u;v++){if(v&136){v+=7;continue}if(!this._board[v]||this._board[v].color===l)continue;const{type:g}=this._board[v];let C;if(g===We){if(r&&r!==g)continue;C=v+vf[o][0],this._board[C]||(Ji(s,o,v,C,We),C=v+vf[o][1],qM[o]===rr(v)&&!this._board[C]&&Ji(s,o,v,C,We,void 0,te.BIG_PAWN));for(let m=2;m<4;m++)C=v+vf[o][m],!(C&136)&&(((h=this._board[C])==null?void 0:h.color)===l?Ji(s,o,v,C,We,this._board[C].type,te.CAPTURE):C===this._epSquare&&Ji(s,o,v,C,We,We,te.EP_CAPTURE))}else{if(r&&r!==g)continue;for(let m=0,b=I0[g].length;m<b;m++){const S=I0[g][m];for(C=v;C+=S,!(C&136);){if(!this._board[C])Ji(s,o,v,C,g);else{if(this._board[C].color===o)break;Ji(s,o,v,C,g,this._board[C].type,te.CAPTURE);break}if(g===Kh||g===rt)break}}}}if((r===void 0||r===rt)&&(!d||u===this._kings[o])){if(this._castling[o]&te.KSIDE_CASTLE){const v=this._kings[o],g=v+2;!this._board[v+1]&&!this._board[g]&&!this._attacked(l,this._kings[o])&&!this._attacked(l,v+1)&&!this._attacked(l,g)&&Ji(s,o,this._kings[o],g,rt,void 0,te.KSIDE_CASTLE)}if(this._castling[o]&te.QSIDE_CASTLE){const v=this._kings[o],g=v-2;!this._board[v-1]&&!this._board[v-2]&&!this._board[v-3]&&!this._attacked(l,this._kings[o])&&!this._attacked(l,v-1)&&!this._attacked(l,g)&&Ji(s,o,this._kings[o],g,rt,void 0,te.QSIDE_CASTLE)}}if(!e||this._kings[o]===-1)return s;const f=[];for(let v=0,g=s.length;v<g;v++)this._makeMove(s[v]),this._isKingAttacked(o)||f.push(s[v]),this._undoMove();return f}move(e,{strict:n=!1}={}){let i=null;if(typeof e=="string")i=this._moveFromSan(e,n);else if(e===null)i=this._moveFromSan(bf,n);else if(typeof e=="object"){const r=this._moves();for(let s=0,o=r.length;s<o;s++)if(e.from===ut(r[s].from)&&e.to===ut(r[s].to)&&(!("promotion"in r[s])||e.promotion===r[s].promotion)){i=r[s];break}}if(!i)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&i.flags&te.NULL_MOVE)throw new Error("Null move not allowed when in check");const a=new $l(this,i);return this._makeMove(i),this._incPositionCount(),a}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,n){this._hash^=this._pieceKey(e),this._board[n]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(n)}_makeMove(e){var a,r,s,o;const n=this._turn,i=io(n);if(this._push(e),e.flags&te.NULL_MOVE){n===Xt&&this._moveNumber++,this._halfMoves++,this._turn=i,this._epSquare=gt;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&te.EP_CAPTURE&&(this._turn===Xt?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:n})),this._board[e.to].type===rt){if(this._kings[n]=e.to,e.flags&te.KSIDE_CASTLE){const l=e.to-1,c=e.to+1;this._movePiece(c,l)}else if(e.flags&te.QSIDE_CASTLE){const l=e.to+1,c=e.to-2;this._movePiece(c,l)}this._castling[n]=0}if(this._castling[n]){for(let l=0,c=Qi[n].length;l<c;l++)if(e.from===Qi[n][l].square&&this._castling[n]&Qi[n][l].flag){this._castling[n]^=Qi[n][l].flag;break}}if(this._castling[i]){for(let l=0,c=Qi[i].length;l<c;l++)if(e.to===Qi[i][l].square&&this._castling[i]&Qi[i][l].flag){this._castling[i]^=Qi[i][l].flag;break}}if(this._hash^=this._castlingKey(),e.flags&te.BIG_PAWN){let l;n===Xt?l=e.to-16:l=e.to+16,!(e.to-1&136)&&((a=this._board[e.to-1])==null?void 0:a.type)===We&&((r=this._board[e.to-1])==null?void 0:r.color)===i||!(e.to+1&136)&&((s=this._board[e.to+1])==null?void 0:s.type)===We&&((o=this._board[e.to+1])==null?void 0:o.color)===i?(this._epSquare=l,this._hash^=this._epKey()):this._epSquare=gt}else this._epSquare=gt;e.piece===We?this._halfMoves=0:e.flags&(te.CAPTURE|te.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===Xt&&this._moveNumber++,this._turn=i,this._hash^=pf}undo(){const e=this._hash,n=this._undoMove();if(n){const i=new $l(this,n);return this._decPositionCount(e),i}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=pf;const i=this._turn,a=io(i);if(n.flags&te.NULL_MOVE)return n;if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:i})),n.captured)if(n.flags&te.EP_CAPTURE){let r;i===Xt?r=n.to-16:r=n.to+16,this._set(r,{type:We,color:a})}else this._set(n.to,{type:n.captured,color:a});if(n.flags&(te.KSIDE_CASTLE|te.QSIDE_CASTLE)){let r,s;n.flags&te.KSIDE_CASTLE?(r=n.to+1,s=n.to-1):(r=n.to-2,s=n.to+1),this._movePiece(s,r)}return n}pgn({newline:e=`
`,maxWidth:n=0}={}){const i=[];let a=!1;for(const f in this._header)this._header[f]&&i.push(`[${f} "${this._header[f]}"]`+e),a=!0;a&&this._history.length&&i.push(e);const r=f=>{const h=this._comments[this.fen()];if(typeof h<"u"){const v=f.length>0?" ":"";f=`${f}${v}{${h}}`}return f},s=[];for(;this._history.length>0;)s.push(this._undoMove());const o=[];let l="";for(s.length===0&&o.push(r(""));s.length>0;){l=r(l);const f=s.pop();if(!f)break;if(!this._history.length&&f.color==="b"){const h=`${this._moveNumber}. ...`;l=l?`${l} ${h}`:h}else f.color==="w"&&(l.length&&o.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(f,this._moves({legal:!0})),this._makeMove(f)}if(l.length&&o.push(r(l)),o.push(this._header.Result||"*"),n===0)return i.join("")+o.join(" ");const c=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},u=function(f,h){for(const v of h.split(" "))if(v){if(f+v.length>n){for(;c();)f--;i.push(e),f=0}i.push(v),f+=v.length,i.push(" "),f++}return c()&&f--,f};let d=0;for(let f=0;f<o.length;f++){if(d+o[f].length>n&&o[f].includes("{")){d=u(d,o[f]);continue}d+o[f].length>n&&f!==0?(i[i.length-1]===" "&&i.pop(),i.push(e),d=0):f!==0&&(i.push(" "),d++),i.push(o[f]),d+=o[f].length}return i.join("")}header(...e){for(let n=0;n<e.length;n+=2)typeof e[n]=="string"&&typeof e[n+1]=="string"&&(this._header[e[n]]=e[n+1]);return this._header}setHeader(e,n){return this._header[e]=n??Gh[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=Gh[e]||null,!0):!1}getHeaders(){const e={};for(const[n,i]of Object.entries(this._header))i!==null&&(e[n]=i);return e}loadPgn(e,{strict:n=!1,newlineChar:i=`\r?
`}={}){i!==`\r?
`&&(e=e.replace(new RegExp(i,"g"),`
`));const a=_M(e);this.reset();const r=a.headers;let s="";for(const c in r)c.toLowerCase()==="fen"&&(s=r[c]),this.header(c,r[c]);if(!n)s&&this.load(s,{preserveHeaders:!0});else if(r.SetUp==="1"){if(!("FEN"in r))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(r.FEN,{preserveHeaders:!0})}let o=a.root;for(;o;){if(o.move){const c=this._moveFromSan(o.move,n);if(c==null)throw new Error(`Invalid move in PGN: ${o.move}`);this._makeMove(c),this._incPositionCount()}o.comment!==void 0&&(this._comments[this.fen()]=o.comment),o=o.variations[0]}const l=a.result;l&&Object.keys(this._header).length&&this._header.Result!==l&&this.setHeader("Result",l)}_moveToSan(e,n){let i="";if(e.flags&te.KSIDE_CASTLE)i="O-O";else if(e.flags&te.QSIDE_CASTLE)i="O-O-O";else{if(e.flags&te.NULL_MOVE)return bf;if(e.piece!==We){const a=FM(e,n);i+=e.piece.toUpperCase()+a}e.flags&(te.CAPTURE|te.EP_CAPTURE)&&(e.piece===We&&(i+=ut(e.from)[0]),i+="x"),i+=ut(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,n=!1){let i=yf(e);if(n||(i==="0-0"?i="O-O":i==="0-0-0"&&(i="O-O-O")),i==bf)return{color:this._turn,from:0,to:0,piece:"k",flags:te.NULL_MOVE};let a=j0(i),r=this._moves({legal:!0,piece:a});for(let f=0,h=r.length;f<h;f++)if(i===yf(this._moveToSan(r[f],r)))return r[f];if(n)return null;let s,o,l,c,u,d=!1;if(o=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),o?(s=o[1],l=o[2],c=o[3],u=o[4],l.length==1&&(d=!0)):(o=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),o&&(s=o[1],l=o[2],c=o[3],u=o[4],l.length==1&&(d=!0))),a=j0(i),r=this._moves({legal:!0,piece:s||a}),!c)return null;for(let f=0,h=r.length;f<h;f++)if(l){if((!s||s.toLowerCase()==r[f].piece)&&W[l]==r[f].from&&W[c]==r[f].to&&(!u||u.toLowerCase()==r[f].promotion))return r[f];if(d){const v=ut(r[f].from);if((!s||s.toLowerCase()==r[f].piece)&&W[c]==r[f].to&&(l==v[0]||l==v[1])&&(!u||u.toLowerCase()==r[f].promotion))return r[f]}}else if(i===yf(this._moveToSan(r[f],r)).replace("x",""))return r[f];return null}ascii(){let e=`   +------------------------+
`;for(let n=W.a8;n<=W.h1;n++){if(tl(n)===0&&(e+=" "+"87654321"[rr(n)]+" |"),this._board[n]){const i=this._board[n].type,r=this._board[n].color===_t?i.toUpperCase():i.toLowerCase();e+=" "+r+" "}else e+=" . ";n+1&136&&(e+=`|
`,n+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const n=this._moves({legal:!1});let i=0;const a=this._turn;for(let r=0,s=n.length;r<s;r++)this._makeMove(n[r]),this._isKingAttacked(a)||(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let n=[];for(let i=W.a8;i<=W.h1;i++)this._board[i]==null?n.push(null):n.push({square:ut(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(n),n=[],i+=8);return e}squareColor(e){if(e in W){const n=W[e];return(rr(n)+tl(n))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const n=[],i=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const a=n.pop();if(!a)break;e?i.push(new $l(this,a)):i.push(this._moveToSan(a,this._moves())),this._makeMove(a)}return i}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const n=this._positionCount.get(e)??0;n===1?this._positionCount.delete(e):this._positionCount.set(e,n-1)}_pruneComments(){const e=[],n={},i=a=>{a in this._comments&&(n[a]=this._comments[a])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){const a=e.pop();if(!a)break;this._makeMove(a),i(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const n=this._comments[e];return delete this._comments[e],{fen:e,comment:n}})}setCastlingRights(e,n){for(const a of[rt,na])n[a]!==void 0&&(n[a]?this._castling[e]|=Zl[a]:this._castling[e]&=~Zl[a]);this._updateCastlingRights();const i=this.getCastlingRights(e);return(n[rt]===void 0||n[rt]===i[rt])&&(n[na]===void 0||n[na]===i[na])}getCastlingRights(e){return{[rt]:(this._castling[e]&Zl[rt])!==0,[na]:(this._castling[e]&Zl[na])!==0}}moveNumber(){return this._moveNumber}}function VM(t){const e=new Map;return t.SQUARES.forEach(n=>{const i=t.moves({square:n,verbose:!0});i.length&&e.set(n,i.map(a=>a.to))}),e}const HM=({onReset:t})=>x.jsx("div",{className:"absolute top-2 left-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity",children:x.jsx("button",{onClick:t,className:"bg-red-600 text-white text-xs px-2 py-1 rounded shadow hover:bg-red-700",children:"Reset Tablero"})}),KM=({teacherId:t})=>{const[e,n]=T.useState(new Sf),[i,a]=T.useState("rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"),[r,s]=T.useState(null),[o,l]=T.useState("white"),{userRole:c,currentUserId:u}=Di.useContext(Ar),d=T.useRef(!1);T.useEffect(()=>{const g=pe.subscribeToRoom(t,m=>{if(m){d.current=!0;try{const b=new Sf(m.fen);n(b),a(m.fen),m.lastMove&&s(m.lastMove),m.orientation&&l(m.orientation)}catch{console.error("Invalid FEN from DB:",m.fen)}d.current=!1}});return!pe.getRoom(t)&&c==="teacher"&&u===t&&pe.updateRoom(t,{fen:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",lastMove:null,orientation:"white"}),()=>g()},[t,c,u]);const f=T.useCallback((g,C)=>{if(e.move({from:g,to:C,promotion:"q"})){const b=e.fen();a(b),s([g,C]),c==="teacher"&&u===t&&pe.updateRoom(t,{fen:b,lastMove:[g,C],orientation:o})}else console.log("Invalid move"),setTimeout(()=>a(e.fen()),100)},[e,t,c,u,o]),h=()=>{if(window.confirm("Reiniciar tablero a la posicin inicial?")){const g="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";a(g),n(new Sf),s(null),pe.updateRoom(t,{fen:g,lastMove:null,orientation:"white"})}},v={fen:i,orientation:o,viewOnly:!1,turnColor:e.turn()==="w"?"white":"black",lastMove:r,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!1,color:"both",dests:VM(e),showDests:!0},draggable:{enabled:!0},selectable:{enabled:!0},events:{move:f}};return x.jsxs("div",{className:"w-full h-full flex justify-center items-center bg-[#262421] rounded-lg p-4 shadow-2xl relative group",children:[c==="teacher"&&u===t&&x.jsx(HM,{onReset:h}),x.jsx("div",{style:{width:"100%",height:"100%",minHeight:"400px",display:"flex",justifyContent:"center"},children:x.jsx(yM,{width:"100%",height:"100%",config:v})})]})};var B0={};function GM(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var a=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var YM=Object.defineProperty,QM=(t,e,n)=>e in t?YM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,q0=(t,e,n)=>QM(t,typeof e!="symbol"?e+"":e,n);class Pt{constructor(){q0(this,"_locking"),q0(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(a=>e=()=>{this._locks-=1,a()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function He(t,e){if(!t)throw new Error(e)}const JM=34028234663852886e22,XM=-34028234663852886e22,$M=4294967295,ZM=2147483647,WM=-2147483648;function Ec(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>ZM||t<WM)throw new Error("invalid int 32: "+t)}function Yh(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>$M||t<0)throw new Error("invalid uint 32: "+t)}function S1(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>JM||t<XM))throw new Error("invalid float 32: "+t)}const T1=Symbol("@bufbuild/protobuf/enum-type");function eD(t){const e=t[T1];return He(e,"missing enum type on enum object"),e}function C1(t,e,n,i){t[T1]=k1(e,n.map(a=>({no:a.no,name:a.name,localName:t[a.no]})))}function k1(t,e,n){const i=Object.create(null),a=Object.create(null),r=[];for(const s of e){const o=E1(s);r.push(o),i[s.name]=o,a[s.no]=o}return{typeName:t,values:r,findName(s){return i[s]},findNumber(s){return a[s]}}}function tD(t,e,n){const i={};for(const a of e){const r=E1(a);i[r.localName]=r.no,i[r.no]=r.localName}return C1(i,t,e),i}function E1(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Kp{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),a=i.runtime.bin,r=a.makeReadOptions(n);return a.readMessage(this,r.readerFactory(e),e.byteLength,r),this}fromJson(e,n){const i=this.getType(),a=i.runtime.json,r=a.makeReadOptions(n);return a.readMessage(i,e,r,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(a){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(a instanceof Error?a.message:String(a)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,a=i.makeWriteOptions(e),r=a.writerFactory();return i.writeMessage(this,r,a),r.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,a=i.makeWriteOptions(e);return i.writeMessage(this,a)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function nD(t,e,n,i){var a;const r=(a=i==null?void 0:i.localName)!==null&&a!==void 0?a:e.substring(e.lastIndexOf(".")+1),s={[r]:function(o){t.util.initFields(this),t.util.initPartial(o,this)}}[r];return Object.setPrototypeOf(s.prototype,new Kp),Object.assign(s,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(o,l){return new s().fromBinary(o,l)},fromJson(o,l){return new s().fromJson(o,l)},fromJsonString(o,l){return new s().fromJsonString(o,l)},equals(o,l){return t.util.equals(s,o,l)}}),s}function iD(){let t=0,e=0;for(let i=0;i<28;i+=7){let a=this.buf[this.pos++];if(t|=(a&127)<<i,!(a&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let a=this.buf[this.pos++];if(e|=(a&127)<<i,!(a&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function Tf(t,e,n){for(let r=0;r<28;r=r+7){const s=t>>>r,o=!(!(s>>>7)&&e==0),l=(o?s|128:s)&255;if(n.push(l),!o)return}const i=t>>>28&15|(e&7)<<4,a=!!(e>>3);if(n.push((a?i|128:i)&255),!!a){for(let r=3;r<31;r=r+7){const s=e>>>r,o=!!(s>>>7),l=(o?s|128:s)&255;if(n.push(l),!o)return}n.push(e>>>31&1)}}const _c=4294967296;function z0(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,a=0;function r(s,o){const l=Number(t.slice(s,o));a*=n,i=i*n+l,i>=_c&&(a=a+(i/_c|0),i=i%_c)}return r(-24,-18),r(-18,-12),r(-12,-6),r(-6),e?w1(i,a):Gp(i,a)}function aD(t,e){let n=Gp(t,e);const i=n.hi&2147483648;i&&(n=w1(n.lo,n.hi));const a=_1(n.lo,n.hi);return i?"-"+a:a}function _1(t,e){if({lo:t,hi:e}=rD(t,e),e<=2097151)return String(_c*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,a=e>>16&65535;let r=n+i*6777216+a*6710656,s=i+a*8147497,o=a*2;const l=1e7;return r>=l&&(s+=Math.floor(r/l),r%=l),s>=l&&(o+=Math.floor(s/l),s%=l),o.toString()+F0(s)+F0(r)}function rD(t,e){return{lo:t>>>0,hi:e>>>0}}function Gp(t,e){return{lo:t|0,hi:e|0}}function w1(t,e){return e=~e,t?t=~t+1:e+=1,Gp(t,e)}const F0=t=>{const e=String(t);return"0000000".slice(e.length)+e};function V0(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function sD(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function oD(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof B0!="object"||B0.BUF_BIGINT_DISABLE!=="1")){const a=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),s=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>r||c<a)throw new Error("int64 invalid: ".concat(l));return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>o||c<s)throw new Error("uint64 invalid: ".concat(l));return c},enc(l){return t.setBigInt64(0,this.parse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(l){return t.setBigInt64(0,this.uParse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigInt64(0,!0)},uDec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigUint64(0,!0)}}}const n=a=>He(/^-?[0-9]+$/.test(a),"int64 invalid: ".concat(a)),i=a=>He(/^[0-9]+$/.test(a),"uint64 invalid: ".concat(a));return{zero:"0",supported:!1,parse(a){return typeof a!="string"&&(a=a.toString()),n(a),a},uParse(a){return typeof a!="string"&&(a=a.toString()),i(a),a},enc(a){return typeof a!="string"&&(a=a.toString()),n(a),z0(a)},uEnc(a){return typeof a!="string"&&(a=a.toString()),i(a),z0(a)},dec(a,r){return aD(a,r)},uDec(a,r){return _1(a,r)}}}const Be=oD();var q;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(q||(q={}));var Pa;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(Pa||(Pa={}));function Xi(t,e,n){if(e===n)return!0;if(t==q.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case q.UINT64:case q.FIXED64:case q.INT64:case q.SFIXED64:case q.SINT64:return e==n}return!1}function Os(t,e){switch(t){case q.BOOL:return!1;case q.UINT64:case q.FIXED64:case q.INT64:case q.SFIXED64:case q.SINT64:return e==0?Be.zero:"0";case q.DOUBLE:case q.FLOAT:return 0;case q.BYTES:return new Uint8Array(0);case q.STRING:return"";default:return 0}}function R1(t,e){switch(t){case q.BOOL:return e===!1;case q.STRING:return e==="";case q.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Je;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Je||(Je={}));class lD{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let a=0;a<this.chunks.length;a++)e+=this.chunks[a].length;let n=new Uint8Array(e),i=0;for(let a=0;a<this.chunks.length;a++)n.set(this.chunks[a],i),i+=this.chunks[a].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(Yh(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Ec(e),V0(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){S1(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){Yh(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Ec(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Ec(e),e=(e<<1^e>>31)>>>0,V0(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),a=Be.enc(e);return i.setInt32(0,a.lo,!0),i.setInt32(4,a.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),a=Be.uEnc(e);return i.setInt32(0,a.lo,!0),i.setInt32(4,a.hi,!0),this.raw(n)}int64(e){let n=Be.enc(e);return Tf(n.lo,n.hi,this.buf),this}sint64(e){let n=Be.enc(e),i=n.hi>>31,a=n.lo<<1^i,r=(n.hi<<1|n.lo>>>31)^i;return Tf(a,r,this.buf),this}uint64(e){let n=Be.uEnc(e);return Tf(n.lo,n.hi,this.buf),this}}class cD{constructor(e,n){this.varint64=iD,this.uint32=sD,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Je.Varint:for(;this.buf[this.pos++]&128;);break;case Je.Bit64:this.pos+=4;case Je.Bit32:this.pos+=4;break;case Je.LengthDelimited:let a=this.uint32();this.pos+=a;break;case Je.StartGroup:for(;;){const[r,s]=this.tag();if(s===Je.EndGroup){if(n!==void 0&&r!==n)throw new Error("invalid end group tag");break}this.skip(s,r)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Be.dec(...this.varint64())}uint64(){return Be.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,Be.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Be.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Be.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function uD(t,e,n,i){let a;return{typeName:e,extendee:n,get field(){if(!a){const r=typeof i=="function"?i():i;r.name=e.split(".").pop(),r.jsonName="[".concat(e,"]"),a=t.util.newFieldList([r]).list()[0]}return a},runtime:t}}function x1(t){const e=t.field.localName,n=Object.create(null);return n[e]=dD(t),[n,()=>n[e]]}function dD(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Os(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function fD(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let Ti="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),rd=[];for(let t=0;t<Ti.length;t++)rd[Ti[t].charCodeAt(0)]=t;rd[45]=Ti.indexOf("+");rd[95]=Ti.indexOf("/");const O1={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,a=0,r,s=0;for(let o=0;o<t.length;o++){if(r=rd[t.charCodeAt(o)],r===void 0)switch(t[o]){case"=":a=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:s=r,a=1;break;case 1:n[i++]=s<<2|(r&48)>>4,s=r,a=2;break;case 2:n[i++]=(s&15)<<4|(r&60)>>2,s=r,a=3;break;case 3:n[i++]=(s&3)<<6|r,a=0;break}}if(a==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,a=0;for(let r=0;r<t.length;r++)switch(i=t[r],n){case 0:e+=Ti[i>>2],a=(i&3)<<4,n=1;break;case 1:e+=Ti[a|i>>4],a=(i&15)<<2,n=2;break;case 2:e+=Ti[a|i>>6],e+=Ti[i&63],n=0;break}return n&&(e+=Ti[a],e+="=",n==1&&(e+="=")),e}};function hD(t,e,n){M1(e,t);const i=e.runtime.bin.makeReadOptions(n),a=fD(t.getType().runtime.bin.listUnknownFields(t),e.field),[r,s]=x1(e);for(const o of a)e.runtime.bin.readField(r,i.readerFactory(o.data),e.field,o.wireType,i);return s()}function mD(t,e,n,i){M1(e,t);const a=e.runtime.bin.makeReadOptions(i),r=e.runtime.bin.makeWriteOptions(i);if(A1(t,e)){const c=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of c)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const s=r.writerFactory();let o=e.field;!o.opt&&!o.repeated&&(o.kind=="enum"||o.kind=="scalar")&&(o=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(o,n,s,r);const l=a.readerFactory(s.finish());for(;l.pos<l.len;){const[c,u]=l.tag(),d=l.skip(u,c);t.getType().runtime.bin.onUnknownField(t,c,u,d)}}function A1(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function M1(t,e){He(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function D1(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!R1(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function H0(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?Os(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function Ci(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Kp.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function P1(t,e){return Ci(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}q.DOUBLE,q.FLOAT,q.INT64,q.UINT64,q.INT32,q.UINT32,q.BOOL,q.STRING,q.BYTES;const K0={ignoreUnknownFields:!1},G0={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function pD(t){return t?Object.assign(Object.assign({},K0),t):K0}function gD(t){return t?Object.assign(Object.assign({},G0),t):G0}const vu=Symbol(),wc=Symbol();function vD(){return{makeReadOptions:pD,makeWriteOptions:gD,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Yn(e)));i=i??new t;const a=new Map,r=n.typeRegistry;for(const[s,o]of Object.entries(e)){const l=t.fields.findJsonName(s);if(l){if(l.oneof){if(o===null&&l.kind=="scalar")continue;const c=a.get(l.oneof);if(c!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(c,'", "').concat(s,'"'));a.set(l.oneof,s)}Y0(i,o,l,n,t)}else{let c=!1;if(r!=null&&r.findExtension&&s.startsWith("[")&&s.endsWith("]")){const u=r.findExtension(s.substring(1,s.length-1));if(u&&u.extendee.typeName==t.typeName){c=!0;const[d,f]=x1(u);Y0(d,o,u.field,n,u),mD(i,u,f(),n)}}if(!c&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(s,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let a;try{for(a of n.fields.byNumber()){if(!D1(a,t)){if(a.req)throw"required field not set";if(!e.emitDefaultValues||!yD(a))continue}const s=a.oneof?t[a.oneof.localName].value:t[a.localName],o=Q0(a,s,e);o!==void 0&&(i[e.useProtoFieldName?a.name:a.jsonName]=o)}const r=e.typeRegistry;if(r!=null&&r.findExtensionFor)for(const s of n.runtime.bin.listUnknownFields(t)){const o=r.findExtensionFor(n.typeName,s.no);if(o&&A1(t,o)){const l=hD(t,o,e),c=Q0(o.field,l,e);c!==void 0&&(i[o.field.jsonName]=c)}}}catch(r){const s=a?"cannot encode field ".concat(n.typeName,".").concat(a.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),o=r instanceof Error?r.message:String(r);throw new Error(s+(o.length>0?": ".concat(o):""))}return i},readScalar(t,e,n){return Lo(t,e,n??Pa.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||R1(t,e)))return Rc(t,e)},debug:Yn}}function Yn(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Y0(t,e,n,i,a){let r=n.localName;if(n.repeated){if(He(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Yn(e)));const s=t[r];for(const o of e){if(o===null)throw new Error("cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Yn(o)));switch(n.kind){case"message":s.push(n.T.fromJson(o,i));break;case"enum":const l=Cf(n.T,o,i.ignoreUnknownFields,!0);l!==wc&&s.push(l);break;case"scalar":try{s.push(Lo(n.T,o,n.L,!0))}catch(c){let u="cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Yn(o));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Yn(e)));const s=t[r];for(const[o,l]of Object.entries(e)){if(l===null)throw new Error("cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=bD(n.K,o)}catch(u){let d="cannot decode map key for field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Yn(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":s[c]=n.V.T.fromJson(l,i);break;case"enum":const u=Cf(n.V.T,l,i.ignoreUnknownFields,!0);u!==wc&&(s[c]=u);break;case"scalar":try{s[c]=Lo(n.V.T,l,Pa.BIGINT,!0)}catch(d){let f="cannot decode map value for field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Yn(e));throw d instanceof Error&&d.message.length>0&&(f+=": ".concat(d.message)),new Error(f)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:r},r="value"),n.kind){case"message":const s=n.T;if(e===null&&s.typeName!="google.protobuf.Value")return;let o=t[r];Ci(o)?o.fromJson(e,i):(t[r]=o=s.fromJson(e,i),s.fieldWrapper&&!n.oneof&&(t[r]=s.fieldWrapper.unwrapField(o)));break;case"enum":const l=Cf(n.T,e,i.ignoreUnknownFields,!1);switch(l){case vu:H0(n,t);break;case wc:break;default:t[r]=l;break}break;case"scalar":try{const c=Lo(n.T,e,n.L,!1);switch(c){case vu:H0(n,t);break;default:t[r]=c;break}}catch(c){let u="cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Yn(e));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}function bD(t,e){if(t===q.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return Lo(t,e,Pa.BIGINT,!0).toString()}function Lo(t,e,n,i){if(e===null)return i?Os(t,n):vu;switch(t){case q.DOUBLE:case q.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const a=Number(e);if(Number.isNaN(a)||!Number.isFinite(a))break;return t==q.FLOAT&&S1(a),a;case q.INT32:case q.FIXED32:case q.SFIXED32:case q.SINT32:case q.UINT32:let r;if(typeof e=="number"?r=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(r=Number(e)),r===void 0)break;return t==q.UINT32||t==q.FIXED32?Yh(r):Ec(r),r;case q.INT64:case q.SFIXED64:case q.SINT64:if(typeof e!="number"&&typeof e!="string")break;const s=Be.parse(e);return n?s.toString():s;case q.FIXED64:case q.UINT64:if(typeof e!="number"&&typeof e!="string")break;const o=Be.uParse(e);return n?o.toString():o;case q.BOOL:if(typeof e!="boolean")break;return e;case q.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case q.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return O1.dec(e)}throw new Error}function Cf(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:vu;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const a=t.findName(e);if(a!==void 0)return a.no;if(n)return wc;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Yn(e)))}function yD(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Q0(t,e,n){if(t.kind=="map"){He(typeof e=="object"&&e!=null);const i={},a=Object.entries(e);switch(t.V.kind){case"scalar":for(const[s,o]of a)i[s.toString()]=Rc(t.V.T,o);break;case"message":for(const[s,o]of a)i[s.toString()]=o.toJson(n);break;case"enum":const r=t.V.T;for(const[s,o]of a)i[s.toString()]=kf(r,o,n.enumAsInteger);break}return n.emitDefaultValues||a.length>0?i:void 0}if(t.repeated){He(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let a=0;a<e.length;a++)i.push(Rc(t.T,e[a]));break;case"enum":for(let a=0;a<e.length;a++)i.push(kf(t.T,e[a],n.enumAsInteger));break;case"message":for(let a=0;a<e.length;a++)i.push(e[a].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Rc(t.T,e);case"enum":return kf(t.T,e,n.enumAsInteger);case"message":return P1(t.T,e).toJson(n)}}function kf(t,e,n){var i;if(He(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const a=t.findNumber(e);return(i=a==null?void 0:a.name)!==null&&i!==void 0?i:e}function Rc(t,e){switch(t){case q.INT32:case q.SFIXED32:case q.SINT32:case q.FIXED32:case q.UINT32:return He(typeof e=="number"),e;case q.FLOAT:case q.DOUBLE:return He(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case q.STRING:return He(typeof e=="string"),e;case q.BOOL:return He(typeof e=="boolean"),e;case q.UINT64:case q.FIXED64:case q.INT64:case q.SFIXED64:case q.SINT64:return He(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case q.BYTES:return He(e instanceof Uint8Array),O1.enc(e)}}const Nr=Symbol("@bufbuild/protobuf/unknown-fields"),J0={readUnknownFields:!0,readerFactory:t=>new cD(t)},X0={writeUnknownFields:!0,writerFactory:()=>new lD};function SD(t){return t?Object.assign(Object.assign({},J0),t):J0}function TD(t){return t?Object.assign(Object.assign({},X0),t):X0}function CD(){return{makeReadOptions:SD,makeWriteOptions:TD,listUnknownFields(t){var e;return(e=t[Nr])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[Nr]},writeUnknownFields(t,e){const i=t[Nr];if(i)for(const a of i)e.tag(a.no,a.wireType).raw(a.data)},onUnknownField(t,e,n,i){const a=t;Array.isArray(a[Nr])||(a[Nr]=[]),a[Nr].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,a){const r=t.getType(),s=a?e.len:e.pos+n;let o,l;for(;e.pos<s&&([o,l]=e.tag(),!(a===!0&&l==Je.EndGroup));){const c=r.fields.find(o);if(!c){const u=e.skip(l,o);i.readUnknownFields&&this.onUnknownField(t,o,l,u);continue}$0(t,e,c,l,i)}if(a&&(l!=Je.EndGroup||o!==n))throw new Error("invalid end group tag")},readField:$0,writeMessage(t,e,n){const i=t.getType();for(const a of i.fields.byNumber()){if(!D1(a,t)){if(a.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(a.name," to binary: required field not set"));continue}const r=a.oneof?t[a.oneof.localName].value:t[a.localName];Z0(a,r,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Z0(t,e,n,i)}}}function $0(t,e,n,i,a){let{repeated:r,localName:s}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=s&&delete t.value,t.case=s,s="value"),n.kind){case"scalar":case"enum":const o=n.kind=="enum"?q.INT32:n.T;let l=bu;if(n.kind=="scalar"&&n.L>0&&(l=ED),r){let f=t[s];if(i==Je.LengthDelimited&&o!=q.STRING&&o!=q.BYTES){let v=e.uint32()+e.pos;for(;e.pos<v;)f.push(l(e,o))}else f.push(l(e,o))}else t[s]=l(e,o);break;case"message":const c=n.T;r?t[s].push(xc(e,new c,a,n)):Ci(t[s])?xc(e,t[s],a,n):(t[s]=xc(e,new c,a,n),c.fieldWrapper&&!n.oneof&&!n.repeated&&(t[s]=c.fieldWrapper.unwrapField(t[s])));break;case"map":let[u,d]=kD(n,e,a);t[s][u]=d;break}}function xc(t,e,n,i){const a=e.getType().runtime.bin,r=i==null?void 0:i.delimited;return a.readMessage(e,t,r?i.no:t.uint32(),n,r),e}function kD(t,e,n){const i=e.uint32(),a=e.pos+i;let r,s;for(;e.pos<a;){const[o]=e.tag();switch(o){case 1:r=bu(e,t.K);break;case 2:switch(t.V.kind){case"scalar":s=bu(e,t.V.T);break;case"enum":s=e.int32();break;case"message":s=xc(e,new t.V.T,n,void 0);break}break}}if(r===void 0&&(r=Os(t.K,Pa.BIGINT)),typeof r!="string"&&typeof r!="number"&&(r=r.toString()),s===void 0)switch(t.V.kind){case"scalar":s=Os(t.V.T,Pa.BIGINT);break;case"enum":s=t.V.T.values[0].no;break;case"message":s=new t.V.T;break}return[r,s]}function ED(t,e){const n=bu(t,e);return typeof n=="bigint"?n.toString():n}function bu(t,e){switch(e){case q.STRING:return t.string();case q.BOOL:return t.bool();case q.DOUBLE:return t.double();case q.FLOAT:return t.float();case q.INT32:return t.int32();case q.INT64:return t.int64();case q.UINT64:return t.uint64();case q.FIXED64:return t.fixed64();case q.BYTES:return t.bytes();case q.FIXED32:return t.fixed32();case q.SFIXED32:return t.sfixed32();case q.SFIXED64:return t.sfixed64();case q.SINT64:return t.sint64();case q.UINT32:return t.uint32();case q.SINT32:return t.sint32()}}function Z0(t,e,n,i){He(e!==void 0);const a=t.repeated;switch(t.kind){case"scalar":case"enum":let r=t.kind=="enum"?q.INT32:t.T;if(a)if(He(Array.isArray(e)),t.packed)wD(n,r,t.no,e);else for(const s of e)Io(n,r,t.no,s);else Io(n,r,t.no,e);break;case"message":if(a){He(Array.isArray(e));for(const s of e)W0(n,i,t,s)}else W0(n,i,t,e);break;case"map":He(typeof e=="object"&&e!=null);for(const[s,o]of Object.entries(e))_D(n,i,t,s,o);break}}function _D(t,e,n,i,a){t.tag(n.no,Je.LengthDelimited),t.fork();let r=i;switch(n.K){case q.INT32:case q.FIXED32:case q.UINT32:case q.SFIXED32:case q.SINT32:r=Number.parseInt(i);break;case q.BOOL:He(i=="true"||i=="false"),r=i=="true";break}switch(Io(t,n.K,1,r),n.V.kind){case"scalar":Io(t,n.V.T,2,a);break;case"enum":Io(t,q.INT32,2,a);break;case"message":He(a!==void 0),t.tag(2,Je.LengthDelimited).bytes(a.toBinary(e));break}t.join()}function W0(t,e,n,i){const a=P1(n.T,i);n.delimited?t.tag(n.no,Je.StartGroup).raw(a.toBinary(e)).tag(n.no,Je.EndGroup):t.tag(n.no,Je.LengthDelimited).bytes(a.toBinary(e))}function Io(t,e,n,i){He(i!==void 0);let[a,r]=N1(e);t.tag(n,a)[r](i)}function wD(t,e,n,i){if(!i.length)return;t.tag(n,Je.LengthDelimited).fork();let[,a]=N1(e);for(let r=0;r<i.length;r++)t[a](i[r]);t.join()}function N1(t){let e=Je.Varint;switch(t){case q.BYTES:case q.STRING:e=Je.LengthDelimited;break;case q.DOUBLE:case q.FIXED64:case q.SFIXED64:e=Je.Bit64;break;case q.FIXED32:case q.SFIXED32:case q.FLOAT:e=Je.Bit32;break}const n=q[t].toLowerCase();return[e,n]}function RD(){return{setEnumType:C1,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const a=i.localName,r=e,s=t;if(s[a]!=null)switch(i.kind){case"oneof":const o=s[a].case;if(o===void 0)continue;const l=i.findField(o);let c=s[a].value;l&&l.kind=="message"&&!Ci(c,l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===q.BYTES&&(c=ao(c)),r[a]={case:o,value:c};break;case"scalar":case"enum":let u=s[a];i.T===q.BYTES&&(u=i.repeated?u.map(ao):ao(u)),r[a]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===q.BYTES)for(const[h,v]of Object.entries(s[a]))r[a][h]=ao(v);else Object.assign(r[a],s[a]);break;case"message":const f=i.V.T;for(const h of Object.keys(s[a])){let v=s[a][h];f.fieldWrapper||(v=new f(v)),r[a][h]=v}break}break;case"message":const d=i.T;if(i.repeated)r[a]=s[a].map(f=>Ci(f,d)?f:new d(f));else{const f=s[a];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?r[a]=ao(f):r[a]=f:r[a]=Ci(f,d)?f:new d(f)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const a=e[i.localName],r=n[i.localName];if(i.repeated){if(a.length!==r.length)return!1;switch(i.kind){case"message":return a.every((s,o)=>i.T.equals(s,r[o]));case"scalar":return a.every((s,o)=>Xi(i.T,s,r[o]));case"enum":return a.every((s,o)=>Xi(q.INT32,s,r[o]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let s=a,o=r;return i.T.fieldWrapper&&(s!==void 0&&!Ci(s)&&(s=i.T.fieldWrapper.wrapField(s)),o!==void 0&&!Ci(o)&&(o=i.T.fieldWrapper.wrapField(o))),i.T.equals(s,o);case"enum":return Xi(q.INT32,a,r);case"scalar":return Xi(i.T,a,r);case"oneof":if(a.case!==r.case)return!1;const l=i.findField(a.case);if(l===void 0)return!0;switch(l.kind){case"message":return l.T.equals(a.value,r.value);case"enum":return Xi(q.INT32,a.value,r.value);case"scalar":return Xi(l.T,a.value,r.value)}throw new Error("oneof cannot contain ".concat(l.kind));case"map":const c=Object.keys(a).concat(Object.keys(r));switch(i.V.kind){case"message":const u=i.V.T;return c.every(f=>u.equals(a[f],r[f]));case"enum":return c.every(f=>Xi(q.INT32,a[f],r[f]));case"scalar":const d=i.V.T;return c.every(f=>Xi(d,a[f],r[f]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const a of e.fields.byMember()){const r=t[a.localName];let s;if(a.repeated)s=r.map(Wl);else if(a.kind=="map"){s=i[a.localName];for(const[o,l]of Object.entries(r))s[o]=Wl(l)}else a.kind=="oneof"?s=a.findField(r.case)?{case:r.case,value:Wl(r.value)}:{case:void 0}:s=Wl(r);i[a.localName]=s}for(const a of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,a.no,a.wireType,a.data);return n}}}function Wl(t){if(t===void 0)return t;if(Ci(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function ao(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function xD(t,e,n){return{syntax:t,json:vD(),bin:CD(),util:Object.assign(Object.assign({},RD()),{newFieldList:e,initFields:n}),makeMessageType(i,a,r){return nD(this,i,a,r)},makeEnum:tD,makeEnumType:k1,getEnumType:eD,makeExtension(i,a,r){return uD(this,i,a,r)}}}class OD{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function L1(t,e){const n=I1(t);return e?n:LD(ND(n))}function AD(t){return L1(t,!1)}const MD=I1;function I1(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let a=t.charAt(i);switch(a){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(a),e=!1;break;default:e&&(e=!1,a=a.toUpperCase()),n.push(a);break}}return n.join("")}const DD=new Set(["constructor","toString","toJSON","valueOf"]),PD=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),U1=t=>"".concat(t,"$"),ND=t=>PD.has(t)?U1(t):t,LD=t=>DD.has(t)?U1(t):t;class ID{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=AD(e)}addField(e){He(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function UD(t,e){var n,i,a,r,s,o;const l=[];let c;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=L1(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:MD(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(a=u.L)!==null&&a!==void 0?a:Pa.BIGINT),d.delimited=(r=u.delimited)!==null&&r!==void 0?r:!1,d.req=(s=u.req)!==null&&s!==void 0?s:!1,d.opt=(o=u.opt)!==null&&o!==void 0?o:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=q.BYTES&&u.T!=q.STRING),u.oneof!==void 0){const f=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!c||c.name!=f)&&(c=new ID(f)),d.oneof=c,c.addField(d)}l.push(d)}return l}const A=xD("proto3",t=>new OD(t,e=>UD(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=Os(e.T,e.L);break}}});class Ft extends Kp{constructor(e){super(),this.seconds=Be.zero,this.nanos=0,A.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(A.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const a=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(a))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(a<Date.parse("0001-01-01T00:00:00Z")||a>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Be.parse(a/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const a=(this.nanos+1e9).toString().substring(1);a.substring(3)==="000000"?i="."+a.substring(0,3)+"Z":a.substring(6)==="000"?i="."+a.substring(0,6)+"Z":i="."+a+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Ft.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Ft({seconds:Be.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Ft().fromBinary(e,n)}static fromJson(e,n){return new Ft().fromJson(e,n)}static fromJsonString(e,n){return new Ft().fromJsonString(e,n)}static equals(e,n){return A.util.equals(Ft,e,n)}}Ft.runtime=A;Ft.typeName="google.protobuf.Timestamp";Ft.fields=A.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const jD=A.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ft},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:BD,repeated:!0},{no:5,name:"events",kind:"message",T:zD,repeated:!0}]),BD=A.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:qD,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),qD=A.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Ft},{no:3,name:"value",kind:"scalar",T:2}]),zD=A.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Ft},{no:7,name:"normalized_end_timestamp",kind:"message",T:Ft,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),j1=A.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),Ln=A.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),et=A.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Yp=A.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),yo=A.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),nl=A.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),jn=A.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Za=A.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),FD=A.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),ft=A.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),sd=A.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:yu,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:$1}]),yu=A.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),VD=A.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:A.getEnumType(et),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),mr=A.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:A.getEnumType(os)},{no:4,name:"tracks",kind:"message",T:$r,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:VD},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:A.getEnumType(il)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:A.getEnumType(jn)},{no:18,name:"kind_details",kind:"enum",T:A.getEnumType(HD),repeated:!0},{no:19,name:"data_tracks",kind:"message",T:Qp,repeated:!0}]),os=A.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),il=A.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"},{no:8,name:"BRIDGE"}]),HD=A.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"},{no:2,name:"CONNECTOR_WHATSAPP"},{no:3,name:"CONNECTOR_TWILIO"},{no:4,name:"BRIDGE_RTSP"}]),Xe=A.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),KD=A.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:_a,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:A.getEnumType(B1)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),$r=A.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:A.getEnumType(Ln)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:A.getEnumType(et)},{no:10,name:"layers",kind:"message",T:_a,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:KD,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:A.getEnumType(Xe)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:$1},{no:19,name:"audio_features",kind:"enum",T:A.getEnumType(ft),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:A.getEnumType(j1)}]),Qp=A.makeMessageType("livekit.DataTrackInfo",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"sid",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"encryption",kind:"enum",T:A.getEnumType(Xe)}]),GD=A.makeMessageType("livekit.DataTrackSubscriptionOptions",()=>[{no:1,name:"target_fps",kind:"scalar",T:13,opt:!0}]),_a=A.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:A.getEnumType(Yp)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9},{no:8,name:"repair_ssrc",kind:"scalar",T:13}]),B1=A.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),Mt=A.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:A.getEnumType(se)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Jp,oneof:"value"},{no:3,name:"speaker",kind:"message",T:YD,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:V1,oneof:"value"},{no:7,name:"transcription",kind:"message",T:QD,oneof:"value"},{no:8,name:"metrics",kind:"message",T:jD,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Su,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Xp,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:$p,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Zp,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Tu,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Cu,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:ku,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:q1,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),se=A.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),q1=A.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:A.getEnumType(Xe)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),z1=A.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Jp,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Su,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Xp,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:$p,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Zp,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Tu,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Cu,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:ku,oneof:"value"}]),YD=A.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:F1,repeated:!0}]),F1=A.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Jp=A.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),V1=A.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),QD=A.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:JD,repeated:!0}]),JD=A.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Su=A.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Xp=A.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),$p=A.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Zp=A.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:H1,oneof:"value"}]),H1=A.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),K1=A.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),G1=A.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:A.getEnumType(Y1)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),Y1=A.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),Q1=A.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:A.getEnumType(J1)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),J1=A.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),X1=A.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:eb},{no:2,name:"screen",kind:"message",T:eb},{no:3,name:"resume_connection",kind:"enum",T:A.getEnumType(nl)},{no:4,name:"disabled_codecs",kind:"message",T:XD},{no:5,name:"force_relay",kind:"enum",T:A.getEnumType(nl)}]),eb=A.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:A.getEnumType(nl)}]),XD=A.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:yu,repeated:!0},{no:2,name:"publish",kind:"message",T:yu,repeated:!0}]),$1=A.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Qh=A.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),Z1=A.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:A.getEnumType(Qh)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),W1=A.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Tu=A.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:A.getEnumType(Xe)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:Z1,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:W1,oneof:"content_header"}],{localName:"DataStream_Header"}),Cu=A.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),ku=A.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),$D=A.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),In=A.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),Jh=A.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),ZD=A.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),WD=A.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:Na,oneof:"message"},{no:2,name:"answer",kind:"message",T:Na,oneof:"message"},{no:3,name:"trickle",kind:"message",T:od,oneof:"message"},{no:4,name:"add_track",kind:"message",T:al,oneof:"message"},{no:5,name:"mute",kind:"message",T:ld,oneof:"message"},{no:6,name:"subscription",kind:"message",T:cd,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:ik,oneof:"message"},{no:8,name:"leave",kind:"message",T:ud,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:rk,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:lk,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:ig,oneof:"message"},{no:13,name:"simulate",kind:"message",T:Gn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:tg,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:dk,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:eg,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:ak,oneof:"message"},{no:19,name:"publish_data_track_request",kind:"message",T:ek,oneof:"message"},{no:20,name:"unpublish_data_track_request",kind:"message",T:nk,oneof:"message"},{no:21,name:"update_data_subscription",kind:"message",T:oP,oneof:"message"}]),tb=A.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:iP,oneof:"message"},{no:2,name:"answer",kind:"message",T:Na,oneof:"message"},{no:3,name:"offer",kind:"message",T:Na,oneof:"message"},{no:4,name:"trickle",kind:"message",T:od,oneof:"message"},{no:5,name:"update",kind:"message",T:sP,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Wp,oneof:"message"},{no:8,name:"leave",kind:"message",T:ud,oneof:"message"},{no:9,name:"mute",kind:"message",T:ld,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:cP,oneof:"message"},{no:11,name:"room_update",kind:"message",T:uP,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:fP,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:mP,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:gP,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:bP,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:rP,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:aP,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:SP,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:kP,oneof:"message"},{no:22,name:"request_response",kind:"message",T:EP,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:_P,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:yP,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:OP,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:vP,oneof:"message"},{no:27,name:"publish_data_track_response",kind:"message",T:tk,oneof:"message"},{no:28,name:"unpublish_data_track_response",kind:"message",T:eP,oneof:"message"},{no:29,name:"data_track_subscriber_handles",kind:"message",T:tP,oneof:"message"}]),Xh=A.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:_a,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:A.getEnumType(B1)}]),al=A.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:A.getEnumType(Ln)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:A.getEnumType(et)},{no:9,name:"layers",kind:"message",T:_a,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:Xh,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:A.getEnumType(Xe)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:A.getEnumType(j1)},{no:17,name:"audio_features",kind:"enum",T:A.getEnumType(ft),repeated:!0}]),ek=A.makeMessageType("livekit.PublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"encryption",kind:"enum",T:A.getEnumType(Xe)}]),tk=A.makeMessageType("livekit.PublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:Qp}]),nk=A.makeMessageType("livekit.UnpublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13}]),eP=A.makeMessageType("livekit.UnpublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:Qp}]),tP=A.makeMessageType("livekit.DataTrackSubscriberHandles",()=>[{no:1,name:"sub_handles",kind:"map",K:13,V:{kind:"message",T:nP}}]),nP=A.makeMessageType("livekit.DataTrackSubscriberHandles.PublishedDataTrack",()=>[{no:1,name:"publisher_identity",kind:"scalar",T:9},{no:2,name:"publisher_sid",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9}],{localName:"DataTrackSubscriberHandles_PublishedDataTrack"}),od=A.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:A.getEnumType(In)},{no:3,name:"final",kind:"scalar",T:8}]),ld=A.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),iP=A.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:sd},{no:2,name:"participant",kind:"message",T:mr},{no:3,name:"other_participants",kind:"message",T:mr,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:sk,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:X1},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:G1},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:yu,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),aP=A.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:sk,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:X1},{no:3,name:"server_info",kind:"message",T:G1},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Wp=A.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:$r}]),rP=A.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),Na=A.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),sP=A.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:mr,repeated:!0}]),cd=A.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:K1,repeated:!0}]),oP=A.makeMessageType("livekit.UpdateDataSubscription",()=>[{no:1,name:"updates",kind:"message",T:lP,repeated:!0}]),lP=A.makeMessageType("livekit.UpdateDataSubscription.Update",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"options",kind:"message",T:GD}],{localName:"UpdateDataSubscription_Update"}),ik=A.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:A.getEnumType(Yp)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),eg=A.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:A.getEnumType(ft),repeated:!0}]),ak=A.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),ud=A.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:A.getEnumType(jn)},{no:3,name:"action",kind:"enum",T:A.getEnumType(ls)},{no:4,name:"regions",kind:"message",T:TP}]),ls=A.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),rk=A.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:_a,repeated:!0}]),tg=A.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),sk=A.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),cP=A.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:F1,repeated:!0}]),uP=A.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:sd}]),dP=A.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:A.getEnumType(yo)},{no:3,name:"score",kind:"scalar",T:2}]),fP=A.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:dP,repeated:!0}]),hP=A.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:A.getEnumType(Jh)}]),mP=A.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:hP,repeated:!0}]),ng=A.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:A.getEnumType(Yp)},{no:2,name:"enabled",kind:"scalar",T:8}]),pP=A.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:ng,repeated:!0}]),gP=A.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:ng,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:pP,repeated:!0}]),vP=A.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:$D,repeated:!0}]),ok=A.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),lk=A.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:ok,repeated:!0}]),bP=A.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),yP=A.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:sd},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:mr},{no:4,name:"other_participants",kind:"message",T:mr,repeated:!0}]),ig=A.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:Na},{no:2,name:"subscription",kind:"message",T:cd},{no:3,name:"publish_tracks",kind:"message",T:Wp,repeated:!0},{no:4,name:"data_channels",kind:"message",T:uk,repeated:!0},{no:5,name:"offer",kind:"message",T:Na},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:ck,repeated:!0},{no:8,name:"publish_data_tracks",kind:"message",T:tk,repeated:!0}]),ck=A.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),uk=A.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:A.getEnumType(In)}]),Gn=A.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:A.getEnumType(ZD),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),dk=A.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),SP=A.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),TP=A.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:CP,repeated:!0}]),CP=A.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),kP=A.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:A.getEnumType(FD)}]),EP=A.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:A.getEnumType(ag)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:od,oneof:"request"},{no:5,name:"add_track",kind:"message",T:al,oneof:"request"},{no:6,name:"mute",kind:"message",T:ld,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:tg,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:eg,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:ak,oneof:"request"},{no:10,name:"publish_data_track",kind:"message",T:ek,oneof:"request"},{no:11,name:"unpublish_data_track",kind:"message",T:nk,oneof:"request"}]),ag=A.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"},{no:7,name:"INVALID_HANDLE"},{no:8,name:"INVALID_NAME"},{no:9,name:"DUPLICATE_HANDLE"},{no:10,name:"DUPLICATE_NAME"}]),_P=A.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),fk=A.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8},{no:5,name:"auto_subscribe_data_track",kind:"scalar",T:8,opt:!0}]),wP=A.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:Q1},{no:2,name:"connection_settings",kind:"message",T:fk},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:al,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:Na},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:A.getEnumType(Za)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:ig}]),RP=A.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:A.getEnumType(xP)},{no:2,name:"join_request",kind:"scalar",T:12}]),xP=A.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),OP=A.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function AP(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Oc={exports:{}},MP=Oc.exports,nb;function DP(){return nb||(nb=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(MP,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],r={},s=null;function o(g,C){var m=g[C];if(typeof m.bind=="function")return m.bind(g);try{return Function.prototype.bind.call(m,g)}catch{return function(){return Function.prototype.apply.apply(m,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&i?l:console[g]!==void 0?o(console,g):console.log!==void 0?o(console,"log"):e}function u(){for(var g=this.getLevel(),C=0;C<a.length;C++){var m=a[C];this[m]=C<g?e:this.methodFactory(m,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function d(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function f(g,C,m){return c(g)||d.apply(this,arguments)}function h(g,C){var m=this,b,S,p,y="loglevel";typeof g=="string"?y+=":"+g:typeof g=="symbol"&&(y=void 0);function k(N){var z=(a[N]||"silent").toUpperCase();if(!(typeof window===n||!y)){try{window.localStorage[y]=z;return}catch{}try{window.document.cookie=encodeURIComponent(y)+"="+z+";"}catch{}}}function _(){var N;if(!(typeof window===n||!y)){try{N=window.localStorage[y]}catch{}if(typeof N===n)try{var z=window.document.cookie,Z=encodeURIComponent(y),fe=z.indexOf(Z+"=");fe!==-1&&(N=/^([^;]+)/.exec(z.slice(fe+Z.length+1))[1])}catch{}return m.levels[N]===void 0&&(N=void 0),N}}function O(){if(!(typeof window===n||!y)){try{window.localStorage.removeItem(y)}catch{}try{window.document.cookie=encodeURIComponent(y)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function w(N){var z=N;if(typeof z=="string"&&m.levels[z.toUpperCase()]!==void 0&&(z=m.levels[z.toUpperCase()]),typeof z=="number"&&z>=0&&z<=m.levels.SILENT)return z;throw new TypeError("log.setLevel() called with invalid level: "+N)}m.name=g,m.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},m.methodFactory=C||f,m.getLevel=function(){return p??S??b},m.setLevel=function(N,z){return p=w(N),z!==!1&&k(p),u.call(m)},m.setDefaultLevel=function(N){S=w(N),_()||m.setLevel(N,!1)},m.resetLevel=function(){p=null,O(),u.call(m)},m.enableAll=function(N){m.setLevel(m.levels.TRACE,N)},m.disableAll=function(N){m.setLevel(m.levels.SILENT,N)},m.rebuild=function(){if(s!==m&&(b=w(s.getLevel())),u.call(m),s===m)for(var N in r)r[N].rebuild()},b=w(s?s.getLevel():"WARN");var R=_();R!=null&&(p=w(R)),u.call(m)}s=new h,s.getLogger=function(C){if(typeof C!="symbol"&&typeof C!="string"||C==="")throw new TypeError("You must supply a name when creating a logger.");var m=r[C];return m||(m=r[C]=new h(C,s.methodFactory)),m};var v=typeof window!==n?window.log:void 0;return s.noConflict=function(){return typeof window!==n&&window.log===s&&(window.log=v),s},s.getLoggers=function(){return r},s.default=s,s})}(Oc)),Oc.exports}var dd=DP(),$h;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})($h||($h={}));var qn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(qn||(qn={}));let ae=dd.getLogger("livekit");Object.values(qn).map(t=>dd.getLogger(t));ae.setDefaultLevel($h.info);function qi(t){const e=dd.getLogger(t);return e.setDefaultLevel(ae.getLevel()),e}const PP=dd.getLogger("lk-e2ee"),ro=7e3,NP=[0,300,2*2*300,3*3*300,4*4*300,ro,ro,ro,ro,ro];class LP{constructor(e){this._retryDelays=e!==void 0?[...e]:NP}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function IP(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(t);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(t,i[a])&&(n[i[a]]=t[i[a]]);return n}function E(t,e,n,i){function a(r){return r instanceof n?r:new n(function(s){s(r)})}return new(n||(n=Promise))(function(r,s){function o(u){try{c(i.next(u))}catch(d){s(d)}}function l(u){try{c(i.throw(u))}catch(d){s(d)}}function c(u){u.done?r(u.value):a(u.value).then(o,l)}c((i=i.apply(t,e||[])).next())})}function ib(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ki(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof ib=="function"?ib(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(r){n[r]=t[r]&&function(s){return new Promise(function(o,l){s=t[r](s),a(o,l,s.done,s.value)})}}function a(r,s,o,l){Promise.resolve(l).then(function(c){r({value:c,done:o})},s)}}var ec={exports:{}},ab;function UP(){if(ab)return ec.exports;ab=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(y,k,_){return Function.prototype.apply.call(y,k,_)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:n=function(y){return Object.getOwnPropertyNames(y)};function i(p){console&&console.warn&&console.warn(p)}var a=Number.isNaN||function(y){return y!==y};function r(){r.init.call(this)}ec.exports=r,ec.exports.once=m,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var s=10;function o(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(p){if(typeof p!="number"||p<0||a(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");s=p}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||a(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this};function l(p){return p._maxListeners===void 0?r.defaultMaxListeners:p._maxListeners}r.prototype.getMaxListeners=function(){return l(this)},r.prototype.emit=function(y){for(var k=[],_=1;_<arguments.length;_++)k.push(arguments[_]);var O=y==="error",w=this._events;if(w!==void 0)O=O&&w.error===void 0;else if(!O)return!1;if(O){var R;if(k.length>0&&(R=k[0]),R instanceof Error)throw R;var N=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw N.context=R,N}var z=w[y];if(z===void 0)return!1;if(typeof z=="function")e(z,this,k);else for(var Z=z.length,fe=v(z,Z),_=0;_<Z;++_)e(fe[_],this,k);return!0};function c(p,y,k,_){var O,w,R;if(o(k),w=p._events,w===void 0?(w=p._events=Object.create(null),p._eventsCount=0):(w.newListener!==void 0&&(p.emit("newListener",y,k.listener?k.listener:k),w=p._events),R=w[y]),R===void 0)R=w[y]=k,++p._eventsCount;else if(typeof R=="function"?R=w[y]=_?[k,R]:[R,k]:_?R.unshift(k):R.push(k),O=l(p),O>0&&R.length>O&&!R.warned){R.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=p,N.type=y,N.count=R.length,i(N)}return p}r.prototype.addListener=function(y,k){return c(this,y,k,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(y,k){return c(this,y,k,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(p,y,k){var _={fired:!1,wrapFn:void 0,target:p,type:y,listener:k},O=u.bind(_);return O.listener=k,_.wrapFn=O,O}r.prototype.once=function(y,k){return o(k),this.on(y,d(this,y,k)),this},r.prototype.prependOnceListener=function(y,k){return o(k),this.prependListener(y,d(this,y,k)),this},r.prototype.removeListener=function(y,k){var _,O,w,R,N;if(o(k),O=this._events,O===void 0)return this;if(_=O[y],_===void 0)return this;if(_===k||_.listener===k)--this._eventsCount===0?this._events=Object.create(null):(delete O[y],O.removeListener&&this.emit("removeListener",y,_.listener||k));else if(typeof _!="function"){for(w=-1,R=_.length-1;R>=0;R--)if(_[R]===k||_[R].listener===k){N=_[R].listener,w=R;break}if(w<0)return this;w===0?_.shift():g(_,w),_.length===1&&(O[y]=_[0]),O.removeListener!==void 0&&this.emit("removeListener",y,N||k)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(y){var k,_,O;if(_=this._events,_===void 0)return this;if(_.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):_[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete _[y]),this;if(arguments.length===0){var w=Object.keys(_),R;for(O=0;O<w.length;++O)R=w[O],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(k=_[y],typeof k=="function")this.removeListener(y,k);else if(k!==void 0)for(O=k.length-1;O>=0;O--)this.removeListener(y,k[O]);return this};function f(p,y,k){var _=p._events;if(_===void 0)return[];var O=_[y];return O===void 0?[]:typeof O=="function"?k?[O.listener||O]:[O]:k?C(O):v(O,O.length)}r.prototype.listeners=function(y){return f(this,y,!0)},r.prototype.rawListeners=function(y){return f(this,y,!1)},r.listenerCount=function(p,y){return typeof p.listenerCount=="function"?p.listenerCount(y):h.call(p,y)},r.prototype.listenerCount=h;function h(p){var y=this._events;if(y!==void 0){var k=y[p];if(typeof k=="function")return 1;if(k!==void 0)return k.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(p,y){for(var k=new Array(y),_=0;_<y;++_)k[_]=p[_];return k}function g(p,y){for(;y+1<p.length;y++)p[y]=p[y+1];p.pop()}function C(p){for(var y=new Array(p.length),k=0;k<y.length;++k)y[k]=p[k].listener||p[k];return y}function m(p,y){return new Promise(function(k,_){function O(R){p.removeListener(y,w),_(R)}function w(){typeof p.removeListener=="function"&&p.removeListener("error",O),k([].slice.call(arguments))}S(p,y,w,{once:!0}),y!=="error"&&b(p,O,{once:!0})})}function b(p,y,k){typeof p.on=="function"&&S(p,"error",y,k)}function S(p,y,k,_){if(typeof p.on=="function")_.once?p.once(y,k):p.on(y,k);else if(typeof p.addEventListener=="function")p.addEventListener(y,function O(w){_.once&&p.removeEventListener(y,O),k(w)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}return ec.exports}var oi=UP();let hk=!0,mk=!0;function So(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function Rr(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,a=i.addEventListener;i.addEventListener=function(s,o){if(s!==e)return a.apply(this,arguments);const l=c=>{const u=n(c);u&&(o.handleEvent?o.handleEvent(u):o(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(o,l),a.apply(this,[s,l])};const r=i.removeEventListener;i.removeEventListener=function(s,o){if(s!==e||!this._eventMap||!this._eventMap[e])return r.apply(this,arguments);if(!this._eventMap[e].has(o))return r.apply(this,arguments);const l=this._eventMap[e].get(o);return this._eventMap[e].delete(o),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[s,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(s){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),s&&this.addEventListener(e,this["_on"+e]=s)},enumerable:!0,configurable:!0})}function jP(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(hk=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function BP(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(mk=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function pk(){if(typeof window=="object"){if(hk)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function rg(t,e){mk&&console.warn(t+" is deprecated, please use "+e+" instead.")}function qP(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(a=>a.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(So(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(So(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(So(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=So(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function rb(t){return Object.prototype.toString.call(t)==="[object Object]"}function gk(t){return rb(t)?Object.keys(t).reduce(function(e,n){const i=rb(t[n]),a=i?gk(t[n]):t[n],r=i&&!Object.keys(a).length;return a===void 0||r?e:Object.assign(e,{[n]:a})},{}):t}function Zh(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Zh(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(a=>{Zh(t,t.get(a),n)})}))}function sb(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",a=new Map;if(e===null)return a;const r=[];return t.forEach(s=>{s.type==="track"&&s.trackIdentifier===e.id&&r.push(s)}),r.forEach(s=>{t.forEach(o=>{o.type===i&&o.trackId===s.id&&Zh(t,o,a)})}),a}const ob=pk;function vk(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const l={};return Object.keys(o).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof o[c]=="object"?o[c]:{ideal:o[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,h){return f?f+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(u.ideal!==void 0){l.optional=l.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",c)]=u.ideal,l.optional.push(f),f={},f[d("max",c)]=u.ideal,l.optional.push(f)):(f[d("",c)]=u.ideal,l.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(f,c)]=u[f])})}),o.advanced&&(l.optional=(l.optional||[]).concat(o.advanced)),l},a=function(o,l){if(e.version>=61)return l(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const c=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};o=JSON.parse(JSON.stringify(o)),c(o.audio,"autoGainControl","googAutoGainControl"),c(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=i(o.audio)}if(o&&typeof o.video=="object"){let c=o.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete o.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(v=>v.kind==="videoinput");let h=f.find(v=>d.some(g=>v.label.toLowerCase().includes(g)));return!h&&f.length&&d.includes("back")&&(h=f[f.length-1]),h&&(o.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),o.video=i(o.video),ob("chrome: "+JSON.stringify(o)),l(o)})}o.video=i(o.video)}return ob("chrome: "+JSON.stringify(o)),l(o)},r=function(o){return e.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},s=function(o,l,c){a(o,u=>{n.webkitGetUserMedia(u,l,d=>{c&&c(r(d))})})};if(n.getUserMedia=s.bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return a(l,c=>o(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(r(u))))}}}function bk(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function yk(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",a=>{let r;t.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(o=>o.track&&o.track.id===a.track.id):r={track:a.track};const s=new Event("track");s.track=a.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[i.stream],this.dispatchEvent(s)}),i.stream.getTracks().forEach(a=>{let r;t.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(o=>o.track&&o.track.id===a.id):r={track:a};const s=new Event("track");s.track=a,s.receiver=r,s.transceiver={receiver:r},s.streams=[i.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Rr(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Sk(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(a,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=a.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:a}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){let c=a.apply(this,arguments);return c||(c=e(this,o),this._senders.push(c)),c};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){r.apply(this,arguments);const l=this._senders.indexOf(o);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],n.apply(this,[r]),r.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(s=>{const o=this._senders.find(l=>l.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Tk(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=n.apply(this,[]);return r.forEach(s=>s._pc=this),r});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(s=>sb(s,r.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=n.apply(this,[]);return a.forEach(r=>r._pc=this),a}),Rr(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(r=>sb(r,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let a,r,s;return this.getSenders().forEach(o=>{o.track===i&&(a?s=!0:a=o)}),this.getReceivers().forEach(o=>(o.track===i&&(r?s=!0:r=o),o.track===i)),s||a&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Ck(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(l)===-1&&this._shimmedLocalStreams[o.id].push(l):this._shimmedLocalStreams[o.id]=[o,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[s.id]=[s].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],i.apply(this,arguments)};const a=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const l=this._shimmedLocalStreams[o].indexOf(s);l!==-1&&this._shimmedLocalStreams[o].splice(l,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),a.apply(this,arguments)}}function kk(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Ck(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(g=>g===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const v=this._streams[d.id];if(v)v.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([u]);this._streams[d.id]=g,this._reverseStreams[g.id]=d,this.addStream(g)}return this.getSenders().find(g=>g.track===u)};function r(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const h=c._reverseStreams[f],v=c._streams[h.id];d=d.replace(new RegExp(v.id,"g"),h.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function s(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const h=c._reverseStreams[f],v=c._streams[h.id];d=d.replace(new RegExp(h.id,"g"),v.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],d={[c](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[v=>{const g=r(this,v);f[0].apply(null,[g])},v=>{f[1]&&f[1].apply(null,v)},arguments[2]]):u.apply(this,arguments).then(v=>r(this,v))}};t.RTCPeerConnection.prototype[c]=d[c]});const o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=s(this,arguments[0]),o.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:r(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(g=>u.track===g)&&(f=this._streams[h])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wh(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=a[n]})}function Ek(t,e){Rr(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var lb=Object.freeze({__proto__:null,fixNegotiationNeeded:Ek,shimAddTrackRemoveTrack:kk,shimAddTrackRemoveTrackWithNative:Ck,shimGetSendersWithDtmf:Sk,shimGetUserMedia:vk,shimMediaStream:bk,shimOnTrack:yk,shimPeerConnection:Wh,shimSenderReceiverGetStats:Tk});function _k(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(a,r,s){rg("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(a).then(r,s)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const a=function(s,o,l){o in s&&!(l in s)&&(s[l]=s[o],delete s[o])},r=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),a(s.audio,"autoGainControl","mozAutoGainControl"),a(s.audio,"noiseSuppression","mozNoiseSuppression")),r(s)},i&&i.prototype.getSettings){const s=i.prototype.getSettings;i.prototype.getSettings=function(){const o=s.apply(this,arguments);return a(o,"mozAutoGainControl","autoGainControl"),a(o,"mozNoiseSuppression","noiseSuppression"),o}}if(i&&i.prototype.applyConstraints){const s=i.prototype.applyConstraints;i.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),a(o,"autoGainControl","mozAutoGainControl"),a(o,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[o])}}}}function zP(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function wk(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function em(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const r=t.RTCPeerConnection.prototype[a],s={[a](){return arguments[0]=new(a==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[a]=s[a]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[r,s,o]=arguments;return i.apply(this,[r||null]).then(l=>{if(e.version<53&&!s)try{l.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return l}).then(s,o)}}function Rk(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=e.apply(this,[]);return a.forEach(r=>r._pc=this),a});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=n.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function xk(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i}),Rr(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Ok(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){rg("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function Ak(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function Mk(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const a=i.length>0;a&&i.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=e.apply(this,arguments);if(a){const{sender:s}=r,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=i,s.sendEncodings=i,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return r})}function Dk(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function Pk(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Nk(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var cb=Object.freeze({__proto__:null,shimAddTransceiver:Mk,shimCreateAnswer:Nk,shimCreateOffer:Pk,shimGetDisplayMedia:zP,shimGetParameters:Dk,shimGetUserMedia:_k,shimOnTrack:wk,shimPeerConnection:em,shimRTCDataChannel:Ak,shimReceiverGetStats:xk,shimRemoveStream:Ok,shimSenderGetStats:Rk});function Lk(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(a=>e.call(this,a,i)),i.getVideoTracks().forEach(a=>e.call(this,a,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var a=arguments.length,r=new Array(a>1?a-1:0),s=1;s<a;s++)r[s-1]=arguments[s];return r&&r.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const a=n.getTracks();this.getSenders().forEach(r=>{a.includes(r.track)&&this.removeTrack(r)})})}}function Ik(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);const r=new Event("addstream");r.stream=a,this.dispatchEvent(r)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const s=new Event("addstream");s.stream=r,i.dispatchEvent(s)})}),e.apply(i,arguments)}}}function Uk(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,a=e.setLocalDescription,r=e.setRemoteDescription,s=e.addIceCandidate;e.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[d]);return u?(f.then(c,u),Promise.resolve()):f},e.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return u?(f.then(c,u),Promise.resolve()):f};let o=function(l,c,u){const d=a.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};e.setLocalDescription=o,o=function(l,c,u){const d=r.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.setRemoteDescription=o,o=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.addIceCandidate=o}function jk(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=a=>i(Bk(a))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,a,r){e.mediaDevices.getUserMedia(i).then(a,r)}).bind(e))}function Bk(t){return t&&t.video!==void 0?Object.assign({},t,{video:gk(t.video)}):t}function qk(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,a){if(i&&i.iceServers){const r=[];for(let s=0;s<i.iceServers.length;s++){let o=i.iceServers[s];o.urls===void 0&&o.url?(rg("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,r.push(o)):r.push(i.iceServers[s])}i.iceServers=r}return new e(i,a)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function zk(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Fk(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const a=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):i.offerToReceiveAudio===!0&&!a&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Vk(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var ub=Object.freeze({__proto__:null,shimAudioContext:Vk,shimCallbacksAPI:Uk,shimConstraints:Bk,shimCreateOfferLegacy:Fk,shimGetUserMedia:jk,shimLocalStreamsAPI:Lk,shimRTCIceServerUrls:qk,shimRemoteStreamsAPI:Ik,shimTrackEventTransceiver:zk}),Ef={exports:{}},db;function FP(){return db||(db=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((a,r)=>(r>0?"m="+a:a).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(a=>a.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const a={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let r=8;r<i.length;r+=2)switch(i[r]){case"raddr":a.relatedAddress=i[r+1];break;case"rport":a.relatedPort=parseInt(i[r+1],10);break;case"tcptype":a.tcpType=i[r+1];break;case"ufrag":a.ufrag=i[r+1],a.usernameFragment=i[r+1];break;default:a[i[r]]===void 0&&(a[i[r]]=i[r+1]);break}return a},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const a=n.component;a==="rtp"?i.push(1):a==="rtcp"?i.push(2):i.push(a),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const r=n.type;return i.push("typ"),i.push(r),r!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=i.length===3?parseInt(i[2],10):1,a.numChannels=a.channels,a},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const a=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let a;const r=n.substring(n.indexOf(" ")+1).split(";");for(let s=0;s<r.length;s++)a=r[s].trim().split("="),i[a[0].trim()]=a[1];return i},e.writeFmtp=function(n){let i="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const r=[];Object.keys(n.parameters).forEach(s=>{n.parameters[s]!==void 0?r.push(s+"="+n.parameters[s]):r.push(s)}),i+="a=fmtp:"+a+" "+r.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(r=>{i+="a=rtcp-fb:"+a+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),a={ssrc:parseInt(n.substring(7,i),10)},r=n.indexOf(":",i);return r>-1?(a.attribute=n.substring(i+1,r),a.value=n.substring(r+1)):a.attribute=n.substring(i+1),a},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(a=>parseInt(a,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let a="a=setup:"+i+`\r
`;return n.fingerprints.forEach(r=>{a+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),a},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const a=e.matchPrefix(n+i,"a=ice-ufrag:")[0],r=e.matchPrefix(n+i,"a=ice-pwd:")[0];return a&&r?{usernameFragment:a.substring(12),password:r.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=e.splitLines(n)[0].split(" ");i.profile=r[2];for(let o=3;o<r.length;o++){const l=r[o],c=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(c){const u=e.parseRtpMap(c),d=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(o=>{i.headerExtensions.push(e.parseExtmap(o))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(o=>{s.forEach(l=>{o.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||o.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let a="";a+="m="+n+" ",a+=i.codecs.length>0?"9":"0",a+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=i.codecs.map(s=>s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(s=>{a+=e.writeRtpMap(s),a+=e.writeFmtp(s),a+=e.writeRtcpFb(s)});let r=0;return i.codecs.forEach(s=>{s.maxptime>r&&(r=s.maxptime)}),r>0&&(a+="a=maxptime:"+r+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(s=>{a+=e.writeExtmap(s)}),a},e.parseRtpEncodingParameters=function(n){const i=[],a=e.parseRtpParameters(n),r=a.fecMechanisms.indexOf("RED")!==-1,s=a.fecMechanisms.indexOf("ULPFEC")!==-1,o=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),l=o.length>0&&o[0].ssrc;let c;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(v=>parseInt(v,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),a.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let h={ssrc:l,codecPayloadType:parseInt(f.parameters.apt,10)};l&&c&&(h.rtx={ssrc:c}),i.push(h),r&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:l,mechanism:s?"red+ulpfec":"red"},i.push(h))}}),i.length===0&&l&&i.push({ssrc:l});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(f=>{f.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},a=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);const r=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;const s=e.matchPrefix(n,"a=rtcp-mux");return i.mux=s.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const a=e.matchPrefix(n,"a=msid:");if(a.length===1)return i=a[0].substring(7).split(" "),{stream:i[0],track:i[1]};const r=e.matchPrefix(n,"a=ssrc:").map(s=>e.parseSsrcMedia(s)).filter(s=>s.attribute==="msid");if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),a=e.matchPrefix(n,"a=max-message-size:");let r;a.length>0&&(r=parseInt(a[0].substring(19),10)),isNaN(r)&&(r=65536);const s=e.matchPrefix(n,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};const o=e.matchPrefix(n,"a=sctpmap:");if(o.length>0){const l=o[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:r}}},e.writeSctpDescription=function(n,i){let a=[];return n.protocol!=="DTLS/SCTP"?a=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:a=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&a.push("a=max-message-size:"+i.maxMessageSize+`\r
`),a.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,a){let r;const s=i!==void 0?i:2;return n?r=n:r=e.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+r+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const a=e.splitLines(n);for(let r=0;r<a.length;r++)switch(a[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[r].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const a=e.splitLines(n)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},e.parseOLine=function(n){const a=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let a=0;a<i.length;a++)if(i[a].length<2||i[a].charAt(1)!=="=")return!1;return!0},t.exports=e}(Ef)),Ef.exports}var Hk=FP(),cs=AP(Hk),VP=GM({__proto__:null,default:cs},[Hk]);function Ac(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const a=new e(i),r=cs.parseCandidate(i.candidate);for(const s in r)s in a||Object.defineProperty(a,s,{value:r[s]});return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,Rr(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function tm(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Rr(t,"icecandidate",e=>{if(e.candidate){const n=cs.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Mc(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(o){if(!o||!o.sdp)return!1;const l=cs.splitSections(o.sdp);return l.shift(),l.some(c=>{const u=cs.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(o){const l=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},a=function(o){let l=65536;return e.browser==="firefox"&&(e.version<57?o===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},r=function(o,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=cs.matchPrefix(o.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),c=a(l),u=r(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return s.apply(this,arguments)}}function Dc(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,a){const r=i.send;i.send=function(){const o=arguments[0],l=o.length||o.size||o.byteLength;if(i.readyState==="open"&&a.sctp&&l>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=n.apply(this,arguments);return e(a,this),a},Rr(t,"datachannel",i=>(e(i.channel,i.target),i))}function nm(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const r=a.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const s=new Event("connectionstatechange",a);r.dispatchEvent(s)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function im(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=a.sdp.split(`
`).filter(s=>s.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:r}):a.sdp=r}return n.apply(this,arguments)}}function Pc(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Nc(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return n.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}return a.sdp||a.type!=="offer"&&a.type!=="answer"?n.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>n.apply(this,[s]))})}var HP=Object.freeze({__proto__:null,removeExtmapAllowMixed:im,shimAddIceCandidateNullOrEmpty:Pc,shimConnectionState:nm,shimMaxMessageSize:Mc,shimParameterlessSetLocalDescription:Nc,shimRTCIceCandidate:Ac,shimRTCIceCandidateRelayProtocol:tm,shimSendThrowTypeError:Dc});function KP(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=pk,i=qP(t),a={browserDetails:i,commonShim:HP,extractVersion:So,disableLog:jP,disableWarnings:BP,sdp:VP};switch(i.browser){case"chrome":if(!lb||!Wh||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=lb,Pc(t,i),Nc(t),vk(t,i),bk(t),Wh(t,i),yk(t),kk(t,i),Sk(t),Tk(t),Ek(t,i),Ac(t),tm(t),nm(t),Mc(t,i),Dc(t),im(t,i);break;case"firefox":if(!cb||!em||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=cb,Pc(t,i),Nc(t),_k(t,i),em(t,i),wk(t),Ok(t),Rk(t),xk(t),Ak(t),Mk(t),Dk(t),Pk(t),Nk(t),Ac(t),nm(t),Mc(t,i),Dc(t);break;case"safari":if(!ub||!e.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=ub,Pc(t,i),Nc(t),qk(t),Fk(t),Uk(t),Lk(t),Ik(t),zk(t),jk(t),Vk(t),Ac(t),tm(t),Mc(t,i),Dc(t),im(t,i);break;default:n("Unsupported browser!");break}return a}KP({window:typeof window>"u"?void 0:window});var am,Kk;class wt extends(Kk=Promise){constructor(e){super(e)}catch(e){return super.catch(e)}static reject(e){return super.reject(e)}static all(e){return super.all(e)}static race(e){return super.race(e)}}am=wt;wt.resolve=t=>Reflect.get(Kk,"resolve",am).call(am,t);const GP=/version\/(\d+(\.?_?\d+)+)/i;let _f;function Nt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(_f===void 0||e){const i=YP.find(a=>{let{test:r}=a;return r.test(n)});_f=i==null?void 0:i.describe(n)}return _f}const YP=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Lc(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:wf(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Lc(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:wf(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Lc(GP,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:wf(t)}}}];function Lc(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function wf(t){return t.includes("mac os")?Lc(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var QP="2.17.1";const JP=QP,XP=16;class qa extends Error{constructor(e,n,i){super(n||"an error has occurred"),this.name="LiveKitError",this.code=e,typeof(i==null?void 0:i.cause)<"u"&&(this.cause=i==null?void 0:i.cause)}}class sg extends qa{}var Oe;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket",t[t.ServiceNotFound=7]="ServiceNotFound"})(Oe||(Oe={}));class $ extends sg{constructor(e,n,i,a){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=a,this.reasonName=Oe[n]}static notAllowed(e,n,i){return new $(e,Oe.NotAllowed,n,i)}static timeout(e){return new $(e,Oe.Timeout)}static leaveRequest(e,n){return new $(e,Oe.LeaveRequest,void 0,n)}static internal(e,n){return new $(e,Oe.InternalError,void 0,n)}static cancelled(e){return new $(e,Oe.Cancelled)}static serverUnreachable(e,n){return new $(e,Oe.ServerUnreachable,n)}static websocket(e,n,i){return new $(e,Oe.WebSocket,n,i)}static serviceNotFound(e,n){return new $(e,Oe.ServiceNotFound,void 0,n)}}class og extends qa{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class Ei extends qa{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class $P extends qa{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Ye extends qa{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class us extends qa{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class fb extends qa{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class hb extends sg{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:ag[n]}}var At;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(At||(At={}));class hn extends sg{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=At[n]}}class Lr extends qa{constructor(e){super(18,e),this.name="SignalReconnectError"}}var rl;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(rl||(rl={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(rl||(rl={}));class Tt{}Tt.setTimeout=function(){return setTimeout(...arguments)};Tt.setInterval=function(){return setInterval(...arguments)};Tt.clearTimeout=function(){return clearTimeout(...arguments)};Tt.clearInterval=function(){return clearInterval(...arguments)};var L;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(L||(L={}));var B;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(B||(B={}));var H;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(H||(H={}));var V;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(V||(V={}));function ZP(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class we{constructor(e,n,i,a,r){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:a,priority:r};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const WP=["vp8","h264"],eN=["vp8","h264","vp9","av1","h265"];function tN(t){return!!WP.find(e=>e===t)}const nN=tN;var mb;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(mb||(mb={}));var rm;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(rm||(rm={}));const sl={h90:new we(160,90,9e4,20),h180:new we(320,180,16e4,20),h216:new we(384,216,18e4,20),h360:new we(640,360,45e4,20),h540:new we(960,540,8e5,25),h720:new we(1280,720,17e5,30),h1080:new we(1920,1080,3e6,30),h1440:new we(2560,1440,5e6,30),h2160:new we(3840,2160,8e6,30)},sm={h120:new we(160,120,7e4,20),h180:new we(240,180,125e3,20),h240:new we(320,240,14e4,20),h360:new we(480,360,33e4,20),h480:new we(640,480,5e5,20),h540:new we(720,540,6e5,25),h720:new we(960,720,13e5,30),h1080:new we(1440,1080,23e5,30),h1440:new we(1920,1440,38e5,30)},lg={h360fps3:new we(640,360,2e5,3,"medium"),h360fps15:new we(640,360,4e5,15,"medium"),h720fps5:new we(1280,720,8e5,5,"medium"),h720fps15:new we(1280,720,15e5,15,"medium"),h720fps30:new we(1280,720,2e6,30,"medium"),h1080fps15:new we(1920,1080,25e5,15,"medium"),h1080fps30:new we(1920,1080,5e6,30,"medium"),original:new we(0,0,7e6,30,"medium")};function Gk(t,e,n){var i,a,r,s;const{optionsWithoutProcessor:o,audioProcessor:l,videoProcessor:c}=Jk(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,f=o??{};return f.audio===!0&&(f.audio={}),f.video===!0&&(f.video={}),f.audio&&(om(f.audio,e),(i=(r=f.audio).deviceId)!==null&&i!==void 0||(r.deviceId={ideal:"default"}),(l||u)&&(f.audio.processor=l??u)),f.video&&(om(f.video,n),(a=(s=f.video).deviceId)!==null&&a!==void 0||(s.deviceId={ideal:"default"}),(c||d)&&(f.video.processor=c??d)),f}function om(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function cg(t){var e,n,i,a;const r={};if(t.video)if(typeof t.video=="object"){const s={},o=s,l=t.video;Object.keys(l).forEach(c=>{switch(c){case"resolution":om(o,l.resolution);break;default:o[c]=l[c]}}),r.video=s,(e=(i=r.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else r.video=t.video?{deviceId:{ideal:"default"}}:!1;else r.video=!1;return t.audio?typeof t.audio=="object"?(r.audio=t.audio,(n=(a=r.audio).deviceId)!==null&&n!==void 0||(a.deviceId={ideal:"default"})):r.audio={deviceId:{ideal:"default"}}:r.audio=!1,r}function Yk(t){return E(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=Qk();if(i){const a=i.createAnalyser();a.fftSize=2048;const r=a.frequencyBinCount,s=new Uint8Array(r);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(a),yield Ct(n),a.getByteTimeDomainData(s);const l=s.some(c=>c!==128&&c!==0);return i.close(),!l}return!1}()})}function Qk(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>E(this,void 0,void 0,function*(){var a;try{n.state==="suspended"&&(yield n.resume())}catch(r){console.warn("Error trying to auto-resume audio context",r)}finally{(a=window.document.body)===null||a===void 0||a.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var a;n.state==="closed"&&((a=window.document.body)===null||a===void 0||a.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function iN(t){return t==="audioinput"?D.Source.Microphone:t==="videoinput"?D.Source.Camera:D.Source.Unknown}function lm(t){return t===D.Source.Microphone?"audioinput":t===D.Source.Camera?"videoinput":void 0}function aN(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,gr()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function Uo(t){return t.split("/")[1].toLowerCase()}function rN(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Wp({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function oe(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?oe(t.track):{})}}function sN(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function oN(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],a={};for(const r of i)t[r]!==e[r]&&(a[r]=(n=e[r])!==null&&n!==void 0?n:"");return a}function Jk(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:ZP(e)}}function lN(t){switch(t){case et.CAMERA:return D.Source.Camera;case et.MICROPHONE:return D.Source.Microphone;case et.SCREEN_SHARE:return D.Source.ScreenShare;case et.SCREEN_SHARE_AUDIO:return D.Source.ScreenShareAudio;default:return D.Source.Unknown}}function pb(t,e){return t.width*t.height<e.width*e.height}function cN(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const uN=5e3,so=[];var tn;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(tn||(tn={}));class D extends oi.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var a;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=D.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=ae,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),uN):this.handleAppVisibilityChanged()},this.log=qi((a=i.loggerName)!==null&&a!==void 0?a:qn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=D.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),oe(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===D.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===D.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(so.forEach(r=>{r.parentElement===null&&!e&&(e=r)}),e&&so.splice(so.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),Zr(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),a=i.some(r=>r.kind==="audio");return e.play().then(()=>{this.emit(a?V.AudioPlaybackStarted:V.VideoPlaybackStarted)}).catch(r=>{r.name==="NotAllowedError"?this.emit(a?V.AudioPlaybackFailed:V.VideoPlaybackFailed,r):r.name==="AbortError"?ae.debug("".concat(a?"audio":"video"," playback aborted, likely due to new play request")):ae.warn("could not playback ".concat(a?"audio":"video"),r),a&&e&&i.some(s=>s.kind==="video")&&r.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(V.ElementAttached,e),e}detach(e){try{if(e){ds(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(V.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{ds(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(V.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=qi(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),so.forEach(i=>{i.parentElement||(n=!1)}),n&&so.push(e)}}handleAppVisibilityChanged(){return E(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===D.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Vt()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Vt()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function Zr(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(a=>{n.removeTrack(a)}),n.addTrack(t)),(!gr()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(gr()||pr())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function ds(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function a(c){switch(c){case e.Audio:return Ln.AUDIO;case e.Video:return Ln.VIDEO;default:return Ln.DATA}}t.kindToProto=a;function r(c){switch(c){case Ln.AUDIO:return e.Audio;case Ln.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=r;function s(c){switch(c){case n.Camera:return et.CAMERA;case n.Microphone:return et.MICROPHONE;case n.ScreenShare:return et.SCREEN_SHARE;case n.ScreenShareAudio:return et.SCREEN_SHARE_AUDIO;default:return et.UNKNOWN}}t.sourceToProto=s;function o(c){switch(c){case et.CAMERA:return n.Camera;case et.MICROPHONE:return n.Microphone;case et.SCREEN_SHARE:return n.ScreenShare;case et.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=o;function l(c){switch(c){case Jh.ACTIVE:return i.Active;case Jh.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=l})(D||(D={}));const dN="|",gb="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function fN(t){const e=t.split(dN);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function Ct(t){return new wt(e=>Tt.setTimeout(e,t))}function cm(){return"addTransceiver"in RTCPeerConnection.prototype}function um(){return"addTrack"in RTCPeerConnection.prototype}function hN(){if(!("getCapabilities"in RTCRtpSender)||gr()||pr())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function mN(){if(!("getCapabilities"in RTCRtpSender)||pr())return!1;if(gr()){const n=Nt();if(n!=null&&n.version&&ni(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&ni(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function Un(t){return t==="av1"||t==="vp9"}function dm(t){return!document||ol()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function pN(){return typeof RTCPeerConnection>"u"?!1:cm()||um()}function pr(){var t;return((t=Nt())===null||t===void 0?void 0:t.name)==="Firefox"}function vb(){const t=Nt();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function gr(){var t;return((t=Nt())===null||t===void 0?void 0:t.name)==="Safari"}function ol(){const t=Nt();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function gN(){const t=Nt();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&ni(t.osVersion,"17")>=0}function vN(t){return t||(t=Nt()),(t==null?void 0:t.name)==="Safari"&&ni(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&ni(t.osVersion,"18.3")>0}function Xk(){var t,e;return Vt()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function bN(){const t=Nt(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&ni(t.osVersion,e)>=0?!0:t.name==="Safari"&&ni(t.version,e)>=0}function Vt(){return typeof document<"u"}function ti(){return navigator.product=="ReactNative"}function As(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Rf(t){return As(t)?t.hostname.split(".")[0]:null}function $k(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function Zk(){if(!ti())return;let t=$k();if(t)return t.platform}function bb(){if(Vt())return window.devicePixelRatio;if(ti()){let t=$k();if(t)return t.devicePixelRatio}return 1}function ni(t,e){const n=t.split("."),i=e.split("."),a=Math.min(n.length,i.length);for(let r=0;r<a;++r){const s=parseInt(n[r],10),o=parseInt(i[r],10);if(s>o)return 1;if(s<o)return-1;if(r===a-1&&s===o)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function yN(t){for(const e of t)e.target.handleResize(e)}function SN(t){for(const e of t)e.target.handleVisibilityChanged(e)}let xf=null;const yb=()=>(xf||(xf=new ResizeObserver(yN)),xf);let Of=null;const Sb=()=>(Of||(Of=new IntersectionObserver(SN,{root:null,rootMargin:"0px"})),Of);function TN(){var t;const e=new Q1({sdk:J1.JS,protocol:XP,version:JP});return ti()&&(e.os=(t=Zk())!==null&&t!==void 0?t:""),e}function Tb(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const a=document.createElement("canvas");a.width=t,a.height=e;const r=a.getContext("2d");r==null||r.fillRect(0,0,a.width,a.height),i&&r&&(r.beginPath(),r.arc(t/2,e/2,50,0,Math.PI*2,!0),r.closePath(),r.fillStyle="grey",r.fill());const s=a.captureStream(),[o]=s.getTracks();if(!o)throw Error("Could not get empty media stream video track");return o.enabled=n,o}let oo;function Af(){if(!oo){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[oo]=i.stream.getAudioTracks(),!oo)throw Error("Could not get empty media stream audio track");oo.enabled=!1}return oo.clone()}class kn{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,a)=>E(this,void 0,void 0,function*(){this.resolve=i,this.reject=a,e&&(yield e(i,a))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function CN(t){return eN.includes(t)}function wa(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function kN(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function ll(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function EN(t,e){return t.segments.map(n=>{let{id:i,text:a,language:r,startTime:s,endTime:o,final:l}=n;var c;const u=(c=e.get(i))!==null&&c!==void 0?c:Date.now(),d=Date.now();return l?e.delete(i):e.set(i,u),{id:i,text:a,startTime:Number.parseInt(s.toString()),endTime:Number.parseInt(o.toString()),final:l,language:r,firstReceivedTime:u,lastReceivedTime:d}})}function _N(t){const{id:e,timestamp:n,message:i,editTimestamp:a}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:a?Number.parseInt(a.toString()):void 0,message:i}}function Cb(t){switch(t.reason){case Oe.LeaveRequest:return t.context;case Oe.Cancelled:return jn.CLIENT_INITIATED;case Oe.NotAllowed:return jn.USER_REJECTED;case Oe.ServerUnreachable:return jn.JOIN_FAILURE;default:return jn.UNKNOWN_REASON}}function Ic(t){return t!==void 0?Number(t):void 0}function Wa(t){return t!==void 0?BigInt(t):void 0}function fs(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Zn(t){return!!t&&t.kind==D.Kind.Audio}function za(t){return!!t&&t.kind==D.Kind.Video}function $i(t){return fs(t)&&za(t)}function vi(t){return fs(t)&&Zn(t)}function fm(t){return!!t&&!t.isLocal}function wN(t){return!!t&&!t.isLocal}function Mf(t){return fm(t)&&za(t)}function RN(t){return t.isLocal}function xN(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let a=e;for(;a>0;){const r=i[a];if(r!==void 0&&(r&192)!==128)break;a--}n.push(i.slice(0,a)),i=i.slice(a)}return i.length>0&&n.push(i),n}function ON(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function AN(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=MN(t,e);return n?i:ug(i,"v1")}function MN(t,e){const n=new URL(kN(t));return e.forEach((i,a)=>{n.searchParams.set(a,i)}),ug(n,"rtc")}function DN(t){const e=new URL(ll(t));return ug(e,"validate")}function Wk(t){return t.endsWith("/")?t:"".concat(t,"/")}function ug(t,e){return t.pathname="".concat(Wk(t.pathname)).concat(e),t}function kb(t){if(typeof t=="string")return tb.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return tb.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function PN(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const NN=10,lo="lk_e2ee",LN="LKFrameEncryptionKey",IN={sharedKey:!1,ratchetSalt:LN,ratchetWindowSize:8,failureTolerance:NN,keyringSize:16};var Ra;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(Ra||(Ra={}));var Eb;(function(t){t.KeyRatcheted="keyRatcheted"})(Eb||(Eb={}));var ma;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(ma||(ma={}));var _b;(function(t){t.Error="cryptorError"})(_b||(_b={}));function UN(){return jN()||hm()}function hm(){return typeof window.RTCRtpScriptTransform<"u"}function jN(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function BN(t){var e,n,i,a,r;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((a=t.value)===null||a===void 0?void 0:a.case)!=="transcription"&&((r=t.value)===null||r===void 0?void 0:r.case)!=="encryptedPacket")return new z1({value:t.value})}class B5 extends oi.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,a)=>{ae.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:a})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},IN),e),this.on(Ra.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const a={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),a),this.emit(Ra.SetKey,a)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(Ra.RatchetRequest,e,n)}}var wb;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(wb||(wb={}));class qN extends oi.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var a,r;const{kind:s,data:o}=i.data;switch(s){case"error":if(ae.error(o.error.message),o.uuid){const u=this.decryptDataRequests.get(o.uuid);if(u!=null&&u.reject){u.reject(o.error);break}const d=this.encryptDataRequests.get(o.uuid);if(d!=null&&d.reject){d.reject(o.error);break}}this.emit(ma.EncryptionError,o.error,o.participantIdentity);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((a=this.room)===null||a===void 0?void 0:a.localParticipant.identity))this.emit(ma.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const u=(r=this.room)===null||r===void 0?void 0:r.getParticipantByIdentity(o.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(ma.ParticipantEncryptionStatusChanged,o.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(Ra.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break;case"decryptDataResponse":const l=this.decryptDataRequests.get(o.uuid);l!=null&&l.resolve&&l.resolve(o);break;case"encryptDataResponse":const c=this.encryptDataRequests.get(o.uuid);c!=null&&c.resolve&&c.resolve(o);break}},this.onWorkerError=i=>{ae.error("e2ee worker encountered an error:",{error:i.error}),this.emit(ma.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!UN())throw new og("tried to setup end-to-end encryption on an unsupported browser");if(ae.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:PP.getLevel()}};this.worker&&(ae.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){ae.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?ae.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(H.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(L.TrackPublished,(i,a)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Xe.NONE,a.identity)),e.on(L.ConnectionStateChanged,i=>{i===ge.Connected&&e.remoteParticipants.forEach(a=>{a.trackPublications.forEach(r=>{this.setParticipantCryptorEnabled(r.trackInfo.encryption!==Xe.NONE,a.identity)})})}).on(L.TrackUnsubscribed,(i,a,r)=>{var s;const o={kind:"removeTransform",data:{participantIdentity:r.identity,trackId:i.mediaStreamID}};(s=this.worker)===null||s===void 0||s.postMessage(o)}).on(L.TrackSubscribed,(i,a,r)=>{this.setupE2EEReceiver(i,r.identity,a.trackInfo)}).on(L.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(B.LocalSenderCreated,(i,a)=>E(this,void 0,void 0,function*(){this.setupE2EESender(a,i)})),e.localParticipant.on(B.LocalTrackPublished,i=>{if(!za(i.track)||!ol())return;const a={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:Uo(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}),n.on(Ra.SetKey,i=>this.postKey(i)).on(Ra.RatchetRequest,(i,a)=>this.postRatchetRequest(i,a))}encryptData(e){return E(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},a=new kn;return a.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,a),this.worker.postMessage(i),a.promise})}handleEncryptedData(e,n,i,a){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const r=crypto.randomUUID(),s={kind:"decryptDataRequest",data:{uuid:r,payload:e,iv:n,participantIdentity:i,keyIndex:a}},o=new kn;return o.onFinally=()=>{this.decryptDataRequests.delete(r)},this.decryptDataRequests.set(r,o),this.worker.postMessage(s),o.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:a}=e;var r;if(!this.worker)throw Error("could not set key, worker is missing");const s={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((r=this.room)===null||r===void 0?void 0:r.localParticipant.identity),key:n,keyIndex:a}};this.worker.postMessage(s)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?Uo(i.mimeType):void 0)}}setupE2EESender(e,n){if(!fs(e)||!n){n||ae.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,a){return E(this,void 0,void 0,function*(){if(this.worker){if(hm()&&!vb()){const r={kind:"decode",participantIdentity:i,trackId:n,codec:a};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{if(lo in e&&a){const l={kind:"updateCodec",data:{trackId:n,codec:a,participantIdentity:i}};this.worker.postMessage(l);return}let r=e.writableStream,s=e.readableStream;if(!r||!s){const l=e.createEncodedStreams();e.writableStream=l.writable,r=l.writable,e.readableStream=l.readable,s=l.readable}const o={kind:"decode",data:{readableStream:s,writableStream:r,trackId:n,codec:a,participantIdentity:i,isReuse:lo in e}};this.worker.postMessage(o,[s,r])}e[lo]=!0}})}handleSender(e,n,i){var a;if(!(lo in e||!this.worker)){if(!(!((a=this.room)===null||a===void 0)&&a.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(hm()&&!vb()){ae.info("initialize script transform");const r={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,r)}else{ae.info("initialize encoded streams");const r=e.createEncodedStreams(),s={kind:"encode",data:{readableStream:r.readable,writableStream:r.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(s,[r.readable,r.writable])}e[lo]=!0}}}const zN=500,FN=15e3;class hs{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new hs),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),a=Rf(i);if(!a)return;let r=(n=this.failedConnectionAttempts.get(a))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(a,r+1),this.backOffPromises.set(a,Ct(Math.min(zN*Math.pow(2,r),FN)))}getBackOffPromise(e){const n=new URL(e),i=n&&Rf(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&Rf(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}hs._instance=null;const Df="default";class mt{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new mt),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return E(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var r;if(((r=mt.userMediaPromiseMap)===null||r===void 0?void 0:r.size)>0){ae.debug("awaiting getUserMedia promise");try{n?yield mt.userMediaPromiseMap.get(n):yield Promise.all(mt.userMediaPromiseMap.values())}catch{ae.warn("error waiting for media permissons")}}let s=yield navigator.mediaDevices.enumerateDevices();if(a&&!(gr()&&i.hasDeviceInUse(n))&&(s.filter(l=>l.kind===n).length===0||s.some(l=>{const c=l.label==="",u=n?l.kind===n:!0;return c&&u}))){const l={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},c=yield navigator.mediaDevices.getUserMedia(l);s=yield navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=s,n&&(s=s.filter(o=>o.kind===n)),s}()})}normalizeDeviceId(e,n,i){return E(this,void 0,void 0,function*(){if(n!==Df)return n;const a=yield this.getDevices(e),r=a.find(o=>o.deviceId===Df);if(!r){ae.warn("could not reliably determine default device");return}const s=a.find(o=>o.deviceId!==Df&&o.groupId===(i??r.groupId));if(!s){ae.warn("could not reliably determine default device");return}return s==null?void 0:s.deviceId})}hasDeviceInUse(e){return e?mt.userMediaPromiseMap.has(e):mt.userMediaPromiseMap.size>0}}mt.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];mt.userMediaPromiseMap=new Map;var jo;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(jo||(jo={}));class VN{constructor(){this.pendingTasks=new Map,this.taskMutex=new Pt,this.nextTaskIndex=0}run(e){return E(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:jo.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=jo.RUNNING,yield e()}finally{n.status=jo.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return E(this,void 0,void 0,function*(){return this.run(()=>E(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class HN{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,a;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const r=new WebSocket(e,(a=n.protocols)!==null&&a!==void 0?a:[]);r.binaryType="arraybuffer",this.ws=r;const s=function(){let{closeCode:o,reason:l}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return r.close(o,l)};this.opened=new wt((o,l)=>{const c=()=>{l($.websocket("Encountered websocket error during connection establishment"))};r.onopen=()=>{o({readable:new ReadableStream({start(u){r.onmessage=d=>{let{data:f}=d;return u.enqueue(f)},r.onerror=d=>u.error(d)},cancel:s}),writable:new WritableStream({write(u){r.send(u)},abort(){r.close()},close:s}),protocol:r.protocol,extensions:r.extensions}),r.removeEventListener("error",c)},r.addEventListener("error",c)}),this.closed=new wt((o,l)=>{const c=()=>E(this,void 0,void 0,function*(){const u=new wt(f=>{r.readyState!==WebSocket.CLOSED&&r.addEventListener("close",h=>{f(h)},{once:!0})}),d=yield wt.race([Ct(250),u]);d?o(d):l($.websocket("Encountered unspecified websocket error without a timely close event"))});r.onclose=u=>{let{code:d,reason:f}=u;o({closeCode:d,reason:f}),r.removeEventListener("error",c)},r.addEventListener("error",c)}),n.signal&&(n.signal.onabort=()=>r.close()),this.close=s}}const KN=["syncState","trickle","offer","answer","simulate","leave"];function GN(t){const e=KN.indexOf(t.case)>=0;return ae.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var xe;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(xe||(xe={}));const YN=250;class dg{get currentState(){return this.state}get isDisconnected(){return this.state===xe.DISCONNECTING||this.state===xe.DISCONNECTED}get isEstablishingConnection(){return this.state===xe.CONNECTING||this.state===xe.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=xe.DISCONNECTED,this.log=ae,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=qi((i=n.loggerName)!==null&&i!==void 0?i:qn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new VN,this.queuedRequests=[],this.closingLock=new Pt,this.connectionLock=new Pt,this.state=xe.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,a){return E(this,arguments,void 0,function(r,s,o,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){return c.state=xe.CONNECTING,c.options=o,yield c.connect(r,s,o,l,u)}()})}reconnect(e,n,i,a){return E(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=xe.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:a}),void 0,this.useV0SignalPath)})}connect(e,n,i,a){return E(this,arguments,void 0,function(r,s,o,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){const d=yield c.connectionLock.lock();c.connectOptions=o,c.useV0SignalPath=u;const f=TN(),h=u?QN(s,f,o):JN(s,f,o),v=AN(r,h,u).toString(),g=DN(v).toString();return new Promise((C,m)=>E(c,void 0,void 0,function*(){var b,S;try{let p=!1;const y=R=>E(this,void 0,void 0,function*(){if(p)return;p=!0;const N=R instanceof Event?R.currentTarget:R,z=PN(N,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(z)).catch(Z=>{this.log.error(Z),this.close()}):this.close(),k(),m($.cancelled(z))});l==null||l.addEventListener("abort",y);const k=()=>{clearTimeout(_),l==null||l.removeEventListener("abort",y)},_=setTimeout(()=>{y($.timeout("room connection has timed out (signal)"))},o.websocketTimeout),O=(R,N)=>{this.handleSignalConnected(R,_,N)},w=new URL(v);w.searchParams.has("access_token")&&w.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(w),Object.assign({reconnect:o.reconnect,reconnectReason:o.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new HN(v);try{this.ws.closed.then(F=>{var G;this.isEstablishingConnection&&m($.internal("Websocket got closed during a (re)connection attempt: ".concat(F.reason))),F.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:F.reason,code:F.closeCode,wasClean:F.closeCode===1e3,state:this.state})),this.state===xe.CONNECTED&&this.handleOnClose((G=F.reason)!==null&&G!==void 0?G:"Unexpected WS error"))}).catch(F=>{this.isEstablishingConnection&&m($.internal("Websocket error during a (re)connection attempt: ".concat(F)))});const R=yield this.ws.opened.catch(F=>E(this,void 0,void 0,function*(){if(this.state!==xe.CONNECTED){this.state=xe.DISCONNECTED,clearTimeout(_);const G=yield this.handleConnectionError(F,g);m(G);return}this.handleWSError(F),m(F)}));if(clearTimeout(_),!R)return;const N=R.readable.getReader();this.streamWriter=R.writable.getWriter();const z=yield N.read();if(N.releaseLock(),!z.value)throw $.internal("no message received as first message");const Z=kb(z.value),fe=this.validateFirstMessage(Z,(b=o.reconnect)!==null&&b!==void 0?b:!1);if(!fe.isValid){m(fe.error);return}((S=Z.message)===null||S===void 0?void 0:S.case)==="join"&&(this.pingTimeoutDuration=Z.message.value.pingTimeout,this.pingIntervalDuration=Z.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const Ge=fe.shouldProcessFirstMessage?Z:void 0;O(R,Ge),C(fe.response)}catch(R){m(R)}finally{k()}}finally{d()}}))}()})}startReadingLoop(e,n){return E(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield Ct(this.signalLatency));const{done:i,value:a}=yield e.read();if(i)break;const r=kb(a);this.handleSignalResponse(r)}})}close(){return E(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([xe.DISCONNECTING||xe.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const a=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=xe.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const r=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([r,Ct(YN)])}}catch(r){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:r}))}finally{n&&(e.state=xe.DISCONNECTED),a()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Wr(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Wr(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new od({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new ld({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return E(this,arguments,void 0,function(i,a){var r=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const o=r.getNextRequestId();return yield r.sendRequest({case:"updateMetadata",value:new tg({requestId:o,metadata:i,name:a,attributes:s})}),o}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new rk({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new lk({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Be.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new dk({timestamp:Be.parse(Date.now()),rtt:Be.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new eg({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new ud({reason:jn.CLIENT_INITIATED,action:ls.DISCONNECT})})}sendRequest(e){return E(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!a&&!GN(n)&&i.state===xe.RECONNECTING){i.queuedRequests.push(()=>E(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(a||(yield i.requestQueue.flush()),i.signalLatency&&(yield Ct(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const s=new WD({message:n});try{i.useJSON?yield i.streamWriter.write(s.toJsonString()):yield i.streamWriter.write(s.toBinary())}catch(o){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:o}))}}()})}handleSignalResponse(e){var n,i;const a=e.message;if(a==null){this.log.debug("received unsupported message",this.logContext);return}let r=!1;if(a.case==="answer"){const s=Rb(a.value);this.onAnswer&&this.onAnswer(s,a.value.id,a.value.midToTrackId)}else if(a.case==="offer"){const s=Rb(a.value);this.onOffer&&this.onOffer(s,a.value.id,a.value.midToTrackId)}else if(a.case==="trickle"){const s=JSON.parse(a.value.candidateInit);this.onTrickle&&this.onTrickle(s,a.value.target)}else a.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=a.value.participants)!==null&&n!==void 0?n:[]):a.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(a.value):a.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=a.value.speakers)!==null&&i!==void 0?i:[]):a.case==="leave"?this.onLeave&&this.onLeave(a.value):a.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(a.value.sid,a.value.muted):a.case==="roomUpdate"?this.onRoomUpdate&&a.value.room&&this.onRoomUpdate(a.value.room):a.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(a.value):a.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(a.value):a.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(a.value):a.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(a.value):a.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(a.value):a.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(a.value):a.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(a.value):a.case==="pong"||(a.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(a.value.lastPingTimestamp.toString()),this.resetPingTimeout(),r=!0):a.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(a.value):a.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(a.value.trackSid):a.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(a.value.token),this.onRoomMoved&&this.onRoomMoved(a.value)):a.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(a.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:a.case})));r||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return E(this,void 0,void 0,function*(){if(this.state===xe.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=Tt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&Tt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=Tt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&Tt.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=xe.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,a,r,s,o;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===xe.RECONNECTING&&((a=e.message)===null||a===void 0?void 0:a.case)!=="leave"?((r=e.message)===null||r===void 0?void 0:r.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((s=e.message)===null||s===void 0?void 0:s.case)==="leave"?{isValid:!1,error:$.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:$.internal("Unexpected first message")}:{isValid:!1,error:$.internal("did not receive join response, got ".concat((o=e.message)===null||o===void 0?void 0:o.case," instead"))}}handleConnectionError(e,n){return E(this,void 0,void 0,function*(){try{const i=yield fetch(n);switch(i.status){case 404:return $.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const a=yield i.text();return $.notAllowed(a,i.status);default:break}return e instanceof $?e:$.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof $?i:$.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function Rb(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Wr(t,e){return new Na({sdp:t.sdp,type:t.type,id:e})}function QN(t,e,n){var i;const a=new URLSearchParams;return a.set("access_token",t),n.reconnect&&(a.set("reconnect","1"),n.sid&&a.set("sid",n.sid)),a.set("auto_subscribe",n.autoSubscribe?"1":"0"),a.set("sdk",ti()?"reactnative":"js"),a.set("version",e.version),a.set("protocol",e.protocol.toString()),e.deviceModel&&a.set("device_model",e.deviceModel),e.os&&a.set("os",e.os),e.osVersion&&a.set("os_version",e.osVersion),e.browser&&a.set("browser",e.browser),e.browserVersion&&a.set("browser_version",e.browserVersion),n.adaptiveStream&&a.set("adaptive_stream","1"),n.reconnectReason&&a.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&a.set("network",navigator.connection.type),a}function JN(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const a=new wP({clientInfo:e,connectionSettings:new fk({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(a.reconnectReason=n.reconnectReason);const r=new RP({joinRequest:a.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(r.toBinary()))),i}class xb{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class XN{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const a=i+this.ttl;return this._map.set(e,{value:n,expiresAt:a}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[a,r]of i.entries())n.push(e(r,a,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var Dn={},Pf={},Nf={exports:{}},Ob;function fg(){if(Ob)return Nf.exports;Ob=1;var t=Nf.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Nf.exports}var Ab;function $N(){return Ab||(Ab=1,function(t){var e=function(o){return String(Number(o))===o?Number(o):o},n=function(o,l,c,u){if(u&&!c)l[u]=e(o[1]);else for(var d=0;d<c.length;d+=1)o[d+1]!=null&&(l[c[d]]=e(o[d+1]))},i=function(o,l,c){var u=o.name&&o.names;o.push&&!l[o.push]?l[o.push]=[]:u&&!l[o.name]&&(l[o.name]={});var d=o.push?{}:u?l[o.name]:l;n(c.match(o.reg),d,o.names,o.name),o.push&&l[o.push].push(d)},a=fg(),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(o){var l={},c=[],u=l;return o.split(/(\r\n|\r|\n)/).filter(r).forEach(function(d){var f=d[0],h=d.slice(2);f==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var v=0;v<(a[f]||[]).length;v+=1){var g=a[f][v];if(g.reg.test(h))return i(g,u,h)}}),l.media=c,l};var s=function(o,l){var c=l.split(/=(.+)/,2);return c.length===2?o[c[0]]=e(c[1]):c.length===1&&l.length>1&&(o[c[0]]=void 0),o};t.parseParams=function(o){return o.split(/;\s?/).reduce(s,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(o){return o.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(o){for(var l=[],c=o.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},t.parseImageAttributes=function(o){return o.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(s,{})})},t.parseSimulcastStreamList=function(o){return o.split(";").map(function(l){return l.split(",").map(function(c){var u,d=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),d=!0),{scid:u,paused:d}})})}}(Pf)),Pf}var Lf,Mb;function ZN(){if(Mb)return Lf;Mb=1;var t=fg(),e=/%[sdv%]/g,n=function(s){var o=1,l=arguments,c=l.length;return s.replace(e,function(u){if(o>=c)return u;var d=l[o];switch(o+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(s,o,l){var c=o.format instanceof Function?o.format(o.push?l:l[o.name]):o.format,u=[s+"="+c];if(o.names)for(var d=0;d<o.names.length;d+=1){var f=o.names[d];o.name?u.push(l[o.name][f]):u.push(l[o.names[d]])}else u.push(l[o.name]);return n.apply(null,u)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],r=["i","c","b","a"];return Lf=function(s,o){o=o||{},s.version==null&&(s.version=0),s.name==null&&(s.name=" "),s.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var l=o.outerOrder||a,c=o.innerOrder||r,u=[];return l.forEach(function(d){t[d].forEach(function(f){f.name in s&&s[f.name]!=null?u.push(i(d,f,s)):f.push in s&&s[f.push]!=null&&s[f.push].forEach(function(h){u.push(i(d,f,h))})})}),s.media.forEach(function(d){u.push(i("m",t.m[0],d)),c.forEach(function(f){t[f].forEach(function(h){h.name in d&&d[h.name]!=null?u.push(i(f,h,d)):h.push in d&&d[h.push]!=null&&d[h.push].forEach(function(v){u.push(i(f,h,v))})})})}),u.join(`\r
`)+`\r
`},Lf}var Db;function WN(){if(Db)return Dn;Db=1;var t=$N(),e=ZN(),n=fg();return Dn.grammar=n,Dn.write=e,Dn.parse=t.parse,Dn.parseParams=t.parseParams,Dn.parseFmtpConfig=t.parseFmtpConfig,Dn.parsePayloads=t.parsePayloads,Dn.parseRemoteCandidates=t.parseRemoteCandidates,Dn.parseImageAttributes=t.parseImageAttributes,Dn.parseSimulcastStreamList=t.parseSimulcastStreamList,Dn}var Wi=WN();function hg(t,e,n){var i,a,r;e===void 0&&(e=50),n===void 0&&(n={});var s=(i=n.isImmediate)!=null&&i,o=(a=n.callback)!=null&&a,l=n.maxWait,c=Date.now(),u=[];function d(){if(l!==void 0){var h=Date.now()-c;if(h+e>=l)return l-h}return e}var f=function(){var h=[].slice.call(arguments),v=this;return new Promise(function(g,C){var m=s&&r===void 0;if(r!==void 0&&clearTimeout(r),r=setTimeout(function(){if(r=void 0,c=Date.now(),!s){var S=t.apply(v,h);o&&o(S),u.forEach(function(p){return(0,p.resolve)(S)}),u=[]}},d()),m){var b=t.apply(v,h);return o&&o(b),g(b)}u.push({resolve:g,reject:C})})};return f.cancel=function(h){r!==void 0&&clearTimeout(r),u.forEach(function(v){return(0,v.reject)(h)}),u=[]},f}const e3=.7,t3=20,ms={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class Pb extends oi.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=ae,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=hg(a=>E(this,void 0,void 0,function*(){this.emit(ms.NegotiationStarted);try{yield this.createAndSendOffer()}catch(r){if(a)a(r);else throw r}}),t3),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=qi((i=n.loggerName)!==null&&i!==void 0?i:qn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new Pt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return E(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return E(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let a;if(e.type==="offer"){let{stereoMids:r,nackMids:s}=n3(e);this.remoteStereoMids=r,this.remoteNackMids=s}else if(e.type==="answer"){const r=Wi.parse((i=e.sdp)!==null&&i!==void 0?i:"");r.media.forEach(s=>{const o=mg(s.mid);s.type==="audio"&&this.trackBitrates.some(l=>{if(!l.transceiver||o!=l.transceiver.mid)return!1;let c=0;if(s.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0)return!0;let u=!1;for(const d of s.fmtp)if(d.payload===c){d.config=d.config.split(";").filter(f=>!f.includes("maxaveragebitrate")).join(";"),l.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(l.maxbr*1e3)),u=!0;break}return u||l.maxbr>0&&s.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(l.maxbr*1e3)}),!0})}),a=Wi.write(r)}return yield this.setMungedSDP(e,a,!0),this.pendingCandidates.forEach(r=>{this.pc.addIceCandidate(r)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(ms.NegotiationComplete),e.sdp&&Wi.parse(e.sdp).media.forEach(s=>{s.type==="video"&&this.emit(ms.RTPVideoPayloadTypes,s.rtp)})),!0})}createAndSendOffer(e){return E(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const o=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&o)yield this._pc.setRemoteDescription(o);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const a=this.latestOfferId+1;this.latestOfferId=a;const r=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:r.sdp},this.logContext));const s=Wi.parse((n=r.sdp)!==null&&n!==void 0?n:"");if(s.media.forEach(o=>{Lb(o),o.type==="audio"?Nb(o,["all"],[]):o.type==="video"&&this.trackBitrates.some(l=>{if(!o.msid||!l.cid||!o.msid.includes(l.cid))return!1;let c=0;if(o.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0||(Un(l.codec)&&!gr()&&this.ensureVideoDDExtensionForSVC(o,s),!Un(l.codec)))return!0;const u=Math.round(l.maxbr*e3);for(const d of o.fmtp)if(d.payload===c){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>a){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:a}));return}yield this.setMungedSDP(r,Wi.write(s)),this.onOffer(r,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return E(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Wi.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(a=>{Lb(a),a.type==="audio"&&Nb(a,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Wi.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Ye("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Ye("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return E(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,a=new Map;if((yield this._pc.getStats()).forEach(o=>{switch(o.type){case"transport":n=o.selectedCandidatePairId;break;case"candidate-pair":n===""&&o.selected&&(n=o.id),i.set(o.id,o);break;case"remote-candidate":a.set(o.id,"".concat(o.address,":").concat(o.port));break}}),n==="")return;const s=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(s!==void 0)return a.get(s)})}setMungedSDP(e,n,i){return E(this,void 0,void 0,function*(){if(n){const a=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(r){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:r,sdp:n})),e.sdp=a}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(a){let r="unknown error";a instanceof Error?r=a.message:typeof a=="string"&&(r=a);const s={error:r,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(s.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:s})),new us(r)}})}ensureVideoDDExtensionForSVC(e,n){var i,a;if(!((i=e.ext)===null||i===void 0?void 0:i.some(s=>s.uri===gb))){if(this.ddExtID===0){let s=0;n.media.forEach(o=>{var l;o.type==="video"&&((l=o.ext)===null||l===void 0||l.forEach(c=>{c.value>s&&(s=c.value)}))}),this.ddExtID=s+1}(a=e.ext)===null||a===void 0||a.push({value:this.ddExtID,uri:gb})}}}function Nb(t,e,n){const i=mg(t.mid);let a=0;t.rtp.some(r=>r.codec==="opus"?(a=r.payload,!0):!1),a>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(r=>r.payload===a&&r.type==="nack")&&t.rtcpFb.push({payload:a,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(r=>r.payload===a?(r.config.includes("stereo=1")||(r.config+=";stereo=1"),!0):!1))}function n3(t){var e;const n=[],i=[],a=Wi.parse((e=t.sdp)!==null&&e!==void 0?e:"");let r=0;return a.media.forEach(s=>{var o;const l=mg(s.mid);s.type==="audio"&&(s.rtp.some(c=>c.codec==="opus"?(r=c.payload,!0):!1),!((o=s.rtcpFb)===null||o===void 0)&&o.some(c=>c.payload===r&&c.type==="nack")&&i.push(l),s.fmtp.some(c=>c.payload===r?(c.config.includes("sprop-stereo=1")&&n.push(l),!0):!1))}),{stereoMids:n,nackMids:i}}function Lb(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function mg(t){return typeof t=="number"?t.toFixed(0):t}const mm="vp8",i3={audioPreset:rm.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:lg.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:mm,backupCodec:!0,preConnectBuffer:!1},eE={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},tE={deviceId:{ideal:"default"},resolution:sl.h720.resolution},a3={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new LP,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},pg={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Fe;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Fe||(Fe={}));class r3{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(e,n,i){var a;this.peerConnectionTimeout=pg.peerConnectionTimeout,this.log=ae,this.updateState=()=>{var r,s;const o=this.state,l=this.requiredTransports.map(c=>c.getConnectionState());l.every(c=>c==="connected")?this.state=Fe.CONNECTED:l.some(c=>c==="failed")?this.state=Fe.FAILED:l.some(c=>c==="connecting")?this.state=Fe.CONNECTING:l.every(c=>c==="closed")?this.state=Fe.CLOSED:l.some(c=>c==="closed")?this.state=Fe.CLOSING:l.every(c=>c==="new")&&(this.state=Fe.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(Fe[o]," to ").concat(Fe[this.state]),this.logContext),(r=this.onStateChange)===null||r===void 0||r.call(this,this.state,this.publisher.getConnectionState(),(s=this.subscriber)===null||s===void 0?void 0:s.getConnectionState()))},this.log=qi((a=i.loggerName)!==null&&a!==void 0?a:qn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new Pb(e,i),this._mode=n,n!=="publisher-only"&&(this.subscriber=new Pb(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=r=>{var s;(s=this.onIceCandidate)===null||s===void 0||s.call(this,r,In.SUBSCRIBER)},this.subscriber.onDataChannel=r=>{var s;(s=this.onDataChannel)===null||s===void 0||s.call(this,r)},this.subscriber.onTrack=r=>{var s;(s=this.onTrack)===null||s===void 0||s.call(this,r)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=r=>{var s;(s=this.onIceCandidate)===null||s===void 0||s.call(this,r,In.PUBLISHER)},this.publisher.onTrack=r=>{var s;(s=this.onTrack)===null||s===void 0||s.call(this,r)},this.publisher.onOffer=(r,s)=>{var o;(o=this.onPublisherOffer)===null||o===void 0||o.call(this,r,s)},this.state=Fe.NEW,this.connectionLock=new Pt,this.remoteOfferLock=new Pt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return E(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(a){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:a}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return E(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return E(this,void 0,void 0,function*(){var i;n===In.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return E(this,void 0,void 0,function*(){var i,a,r;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const s=yield this.remoteOfferLock.lock();try{return(yield(a=this.subscriber)===null||a===void 0?void 0:a.setRemoteDescription(e,n))?yield(r=this.subscriber)===null||r===void 0?void 0:r.createAndSetAnswer():void 0}finally{s()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return E(this,void 0,void 0,function*(){var i;const a=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(r=>this.ensureTransportConnected(r,e,n)))}finally{a()}})}negotiate(e){return E(this,void 0,void 0,function*(){return new wt((n,i)=>E(this,void 0,void 0,function*(){const a=setTimeout(()=>{i(new us("negotiation timed out"))},this.peerConnectionTimeout),r=()=>{clearTimeout(a),i(new us("negotiation aborted"))};e.signal.addEventListener("abort",r),this.publisher.once(ms.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(ms.NegotiationComplete,()=>{clearTimeout(a),n()})}),yield this.publisher.negotiate(s=>{clearTimeout(a),s instanceof Error?i(s):i(new Error(String(s)))})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(a=>a.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===In.PUBLISHER?this.publisher.getConnectedAddress():e===In.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return E(this,arguments,void 0,function(i,a){var r=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((l,c)=>E(r,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),Tt.clearTimeout(d),c($.cancelled("room connection has been cancelled"))};a!=null&&a.signal.aborted&&u(),a==null||a.signal.addEventListener("abort",u);const d=Tt.setTimeout(()=>{a==null||a.signal.removeEventListener("abort",u),c($.internal("could not establish pc connection"))},s);for(;this.state!==Fe.CONNECTED;)if(yield Ct(50),a!=null&&a.signal.aborted){c($.cancelled("room connection has been cancelled"));return}Tt.clearTimeout(d),a==null||a.signal.removeEventListener("abort",u),l()}))}()})}}const nE=5e3,s3=3e4;class me{static fetchRegionSettings(e,n,i){return E(this,void 0,void 0,function*(){const a=yield me.fetchLock.lock();try{const r=yield fetch("".concat(o3(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(r.ok){const s=ON(r.headers),o=s?s*1e3:nE;return{regionSettings:yield r.json(),updatedAtInMs:Date.now(),maxAgeInMs:o}}else throw r.status===401?$.notAllowed("Could not fetch region settings: ".concat(r.statusText),r.status):$.internal("Could not fetch region settings: ".concat(r.statusText))}catch(r){throw r instanceof $?r:i!=null&&i.aborted?$.cancelled("Region fetching was aborted"):$.serverUnreachable("Could not fetch region settings, ".concat(r instanceof Error?"".concat(r.name,": ").concat(r.message):r))}finally{a()}})}static scheduleRefetch(e,n,i){return E(this,void 0,void 0,function*(){const a=me.settingsTimeouts.get(e.hostname);clearTimeout(a),me.settingsTimeouts.set(e.hostname,setTimeout(()=>E(this,void 0,void 0,function*(){try{const r=yield me.fetchRegionSettings(e,n);me.updateCachedRegionSettings(e,n,r)}catch(r){if(r instanceof $&&r.reason===Oe.NotAllowed){ae.debug("token is not valid, cancelling auto region refresh");return}ae.debug("auto refetching of region settings failed",{error:r}),me.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){me.cache.set(e.hostname,i),me.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=me.settingsTimeouts.get(e);n&&(clearTimeout(n),me.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=me.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=me.connectionTrackers.get(e);i&&i.connectionCount===0&&(ae.debug("stopping region refetch after disconnect delay",{hostname:e}),me.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},s3))}static cancelCleanup(e){const n=me.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=me.connectionTrackers.get(e);n||(n={connectionCount:0},me.connectionTrackers.set(e,n)),n.connectionCount++,me.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=me.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&me.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return As(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return E(this,void 0,void 0,function*(){return me.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return E(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=me.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),me.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(a=>!this.attemptedRegions.find(r=>r.url===a.url));if(i.length>0){const a=i[0];return this.attemptedRegions.push(a),ae.debug("next region: ".concat(a.region)),a.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){me.updateCachedRegionSettings(this.serverUrl,this.token,e)}}me.cache=new Map;me.settingsTimeouts=new Map;me.connectionTrackers=new Map;me.fetchLock=new Pt;function o3(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Ke extends Error{constructor(e,n,i){super(n),this.code=e,this.message=Ib(n,Ke.MAX_MESSAGE_BYTES),this.data=i?Ib(i,Ke.MAX_DATA_BYTES):void 0}static fromProto(e){return new Ke(e.code,e.message,e.data)}toProto(){return new H1({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Ke(Ke.ErrorCode[e],Ke.ErrorMessage[e],n)}}Ke.MAX_MESSAGE_BYTES=256;Ke.MAX_DATA_BYTES=15360;Ke.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Ke.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const iE=15360;function gg(t){return new TextEncoder().encode(t).length}function Ib(t,e){if(gg(t)<=e)return t;let n=0,i=t.length;const a=new TextEncoder;for(;n<i;){const r=Math.floor((n+i+1)/2);a.encode(t.slice(0,r)).length<=e?n=r:i=r-1}return t.slice(0,n)}const vg=2e3;function fd(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const bg=typeof MediaRecorder<"u";class l3{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const c3=bg?MediaRecorder:l3;class u3 extends c3{constructor(e,n){if(!bg)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,a;const r=()=>a===void 0,s=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",s),this.removeEventListener("error",o),a==null||a.close(),a=void 0},o=l=>{a==null||a.error(l),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",s),this.removeEventListener("error",o),a=void 0};this.byteStream=new ReadableStream({start:l=>{a=l,i=c=>E(this,void 0,void 0,function*(){let u;if(c.data.arrayBuffer){const d=yield c.data.arrayBuffer();u=new Uint8Array(d)}else if(c.data.byteArray)u=c.data.byteArray;else throw new Error("no data available!");r()||l.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{s()}}),this.addEventListener("stop",s),this.addEventListener("error",o)}}function d3(){return bg}const f3=1e3,h3=1e4;class aE extends D{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,r=arguments.length>4?arguments[4]:void 0;super(e,n,r),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=hg(()=>E(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>E(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(V.Ended,this)},this.reacquireTrack=!1,this.providedByUser=a,this.muteLock=new Pt,this.pauseUpstreamLock=new Pt,this.trackChangeLock=new Pt,this.trackChangeLock.lock().then(s=>E(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{s()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==D.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return E(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(r=>{ds(this._mediaStreamTrack,r)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let a;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(Zr(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),a=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(a??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(r=>{Zr(a??e,r)}))})}waitForDimensions(){return E(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:f3;return function*(){var i;if(e.kind===D.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=Nt())===null||i===void 0?void 0:i.os)==="iOS"&&(yield Ct(10));const a=Date.now();for(;Date.now()-a<n;){const r=e.dimensions;if(r)return r;yield Ct(50)}throw new Ei("unable to get track dimensions after timeout")}()})}setDeviceId(e){return E(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===wa(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),wa(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return E(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===D.Source.ScreenShare)return;const{deviceId:i,groupId:a}=e._mediaStreamTrack.getSettings(),r=e.kind===D.Kind.Audio?"audioinput":"videoinput";return n?mt.getInstance().normalizeDeviceId(r,i,a):i}()})}mute(){return E(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return E(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return E(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new Ei("unable to replace an unpublished track");let a,r;return typeof n=="boolean"?a=n:n!==void 0&&(a=n.userProvidedTrack,r=n.stopProcessor),this.providedByUser=a??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),r&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return E(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:a}=e,r=IP(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const s={audio:!1,video:!1};this.kind===D.Kind.Video?s.video=i||a?{deviceId:i,facingMode:a}:!0:s.audio=i?Object.assign({deviceId:i},r):!0,this.attachedElements.forEach(c=>{ds(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const l=(yield navigator.mediaDevices.getUserMedia(s)).getTracks()[0];return this.kind===D.Kind.Video&&(yield l.applyConstraints(r)),l.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(l),this._constraints=e,this.emit(V.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?V.Muted:V.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return E(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Xk()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return E(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(V.UpstreamPaused,this);const i=Nt();if((i==null?void 0:i.name)==="Safari"&&ni(i.version,"12.0")<0)throw new og("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return E(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(V.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return E(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return E(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var r;const s=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const o=document.createElement(i.kind),l={kind:i.kind,track:i._mediaStreamTrack,element:o,audioContext:i.audioContext};if(yield n.init(l),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(Zr(i._mediaStreamTrack,o),o.muted=!0,o.play().catch(c=>{c instanceof DOMException&&c.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:c})),setTimeout(()=>{o.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:c}))}),i.processor=n,i.processorElement=o,i.processor.processedTrack){for(const c of i.attachedElements)c!==i.processorElement&&a&&(ds(i._mediaStreamTrack,c),Zr(i.processor.processedTrack,c));yield(r=i.sender)===null||r===void 0?void 0:r.replaceTrack(i.processor.processedTrack)}i.emit(V.TrackProcessorUpdate,i.processor)}finally{s()}}()})}getProcessor(){return this.processor}stopProcessor(){return E(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return E(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,a;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((a=e.processorElement)===null||a===void 0||a.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(V.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!d3()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new u3(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},h3)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Eu extends aE{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;super(e,D.Kind.Audio,n,i,r),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>E(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(o){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:o}));return}s&&this.prevStats&&(this._currentBitrate=fd(s,this.prevStats)),this.prevStats=s}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(V.AudioTrackFeatureUpdate,this,ft.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(V.AudioTrackFeatureUpdate,this,ft.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=a,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return E(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===D.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return E(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==wa(this._constraints.deviceId);return this.source===D.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return E(this,void 0,void 0,function*(){let n;if(e){const i=cg({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return E(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){Vt()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},vg)))}setProcessor(e){return E(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!ti()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const a={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(a),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(V.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return E(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(a=>{a.type==="outbound-rtp"&&(i={type:"audio",streamId:a.id,packetsSent:a.packetsSent,packetsLost:a.packetsLost,bytesSent:a.bytesSent,timestamp:a.timestamp,roundTripTime:a.roundTripTime,jitter:a.jitter})}),i})}checkForSilence(){return E(this,void 0,void 0,function*(){const e=yield Yk(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(V.AudioSilenceDetected)),e})}}function m3(t,e,n){switch(t.kind){case"audio":return new Eu(t,e,!1,void 0,n);case"video":return new _u(t,e,!1,n);default:throw new Ei("unsupported track type: ".concat(t.kind))}}const p3=Object.values(sl),g3=Object.values(sm),v3=Object.values(lg),b3=[sl.h180,sl.h360],y3=[sm.h180,sm.h360],S3=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,a;return new we(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((a=n.fps)!==null&&a!==void 0?a:30))))),n.fps,t.encoding.priority)}),pm=["q","h","f"];function gm(t,e,n,i){var a,r;let s=i==null?void 0:i.videoEncoding;t&&(s=i==null?void 0:i.screenShareEncoding);const o=i==null?void 0:i.simulcast,l=i==null?void 0:i.scalabilityMode,c=i==null?void 0:i.videoCodec;if(!s&&!o&&!l||!e||!n)return[{}];s||(s=C3(t,e,n,c),ae.debug("using video encoding",s));const u=s.maxFramerate,d=new we(e,n,s.maxBitrate,s.maxFramerate,s.priority);if(l&&Un(c)){const v=new rE(l),g=[];if(v.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const C=Nt();if(ol()||ti()||(C==null?void 0:C.name)==="Chrome"&&ni(C==null?void 0:C.version,"113")<0){const m=v.suffix=="h"?2:3,b=vN(C);for(let S=0;S<v.spatial;S+=1)g.push({rid:pm[2-S],maxBitrate:s.maxBitrate/Math.pow(m,S),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:b?Math.pow(2,S):void 0});g[0].scalabilityMode=l}else g.push({maxBitrate:s.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(g[0].priority=d.encoding.priority,g[0].networkPriority=d.encoding.priority),ae.debug("using svc encoding",{encodings:g}),g}if(!o)return[s];let f=[];t?f=(a=jb(i==null?void 0:i.screenShareSimulcastLayers))!==null&&a!==void 0?a:Ub(t,d):f=(r=jb(i==null?void 0:i.videoSimulcastLayers))!==null&&r!==void 0?r:Ub(t,d);let h;if(f.length>0){const v=f[0];f.length>1&&([,h]=f);const g=Math.max(e,n);if(g>=960&&h)return If(e,n,[v,h,d],u);if(g>=480)return If(e,n,[v,d],u)}return If(e,n,[d])}function T3(t,e,n){var i,a,r,s;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&ae.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const o=t.mediaStreamTrack.getSettings(),l=(i=o.width)!==null&&i!==void 0?i:(a=t.dimensions)===null||a===void 0?void 0:a.width,c=(r=o.height)!==null&&r!==void 0?r:(s=t.dimensions)===null||s===void 0?void 0:s.height;return t.source===D.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),gm(t.source===D.Source.ScreenShare,l,c,n)}function C3(t,e,n,i){const a=k3(t,e,n);let{encoding:r}=a[0];const s=Math.max(e,n);for(let o=0;o<a.length;o+=1){const l=a[o];if(r=l.encoding,l.width>=s)break}if(i)switch(i){case"av1":case"h265":r=Object.assign({},r),r.maxBitrate=r.maxBitrate*.7;break;case"vp9":r=Object.assign({},r),r.maxBitrate=r.maxBitrate*.85;break}return r}function k3(t,e,n){if(t)return v3;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?p3:g3}function Ub(t,e){if(t)return S3(e);const{width:n,height:i}=e,a=n>i?n/i:i/n;return Math.abs(a-16/9)<Math.abs(a-4/3)?b3:y3}function If(t,e,n,i){const a=[];if(n.forEach((r,s)=>{if(s>=pm.length)return;const o=Math.min(t,e),c={rid:pm[s],scaleResolutionDownBy:Math.max(1,o/Math.min(r.width,r.height)),maxBitrate:r.encoding.maxBitrate},u=i&&r.encoding.maxFramerate?Math.min(i,r.encoding.maxFramerate):r.encoding.maxFramerate;u&&(c.maxFramerate=u);const d=pr()||s===0;r.encoding.priority&&d&&(c.priority=r.encoding.priority,c.networkPriority=r.encoding.priority),a.push(c)}),ti()&&Zk()==="ios"){let r;a.forEach(o=>{r?o.maxFramerate&&o.maxFramerate>r&&(r=o.maxFramerate):r=o.maxFramerate});let s=!0;a.forEach(o=>{var l;o.maxFramerate!=r&&(s&&(s=!1,ae.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ae.info('Setting framerate of encoding "'.concat((l=o.rid)!==null&&l!==void 0?l:"",'" to ').concat(r)),o.maxFramerate=r)})}return a}function jb(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:a}=n;return i.maxBitrate>a.maxBitrate?1:i.maxBitrate<a.maxBitrate?-1:i.maxBitrate===a.maxBitrate&&i.maxFramerate&&a.maxFramerate?i.maxFramerate>a.maxFramerate?1:-1:0})}class rE{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function E3(t){return t.source===D.Source.ScreenShare||t.constraints.height&&wa(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const _3=5e3;class _u extends aE{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0;super(e,D.Kind.Video,n,i,a),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>E(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let r;try{r=yield this.getSenderStats()}catch(l){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}const s=new Map(r.map(l=>[l.rid,l])),o=r.some(l=>l.qualityLimitationReason==="cpu");if(o!==this.isCpuConstrained&&(this.isCpuConstrained=o,this.isCpuConstrained&&this.emit(V.CpuConstrained)),this.prevStats){let l=0;s.forEach((c,u)=>{var d;const f=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);l+=fd(c,f)}),this._currentBitrate=l}this.prevStats=s}),this.senderLock=new Pt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Vt())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},vg))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return E(this,void 0,void 0,function*(){var n,i,a,r,s;yield e.pauseUpstream.call(this);try{for(var o=!0,l=ki(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;o=!0)r=c.value,o=!1,yield(s=r.sender)===null||s===void 0?void 0:s.replaceTrack(null)}catch(u){i={error:u}}finally{try{!o&&!n&&(a=l.return)&&(yield a.call(l))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return E(this,void 0,void 0,function*(){var n,i,a,r,s;yield e.resumeUpstream.call(this);try{for(var o=!0,l=ki(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;o=!0){r=c.value,o=!1;const u=r;yield(s=u.sender)===null||s===void 0?void 0:s.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!o&&!n&&(a=l.return)&&(yield a.call(l))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return E(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===D.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return E(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===D.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return E(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(a=>{var r;if(a.type==="outbound-rtp"){const s={type:"video",streamId:a.id,frameHeight:a.frameHeight,frameWidth:a.frameWidth,framesPerSecond:a.framesPerSecond,framesSent:a.framesSent,firCount:a.firCount,pliCount:a.pliCount,nackCount:a.nackCount,packetsSent:a.packetsSent,bytesSent:a.bytesSent,qualityLimitationReason:a.qualityLimitationReason,qualityLimitationDurations:a.qualityLimitationDurations,qualityLimitationResolutionChanges:a.qualityLimitationResolutionChanges,rid:(r=a.rid)!==null&&r!==void 0?r:a.id,retransmittedPacketsSent:a.retransmittedPacketsSent,targetBitrate:a.targetBitrate,timestamp:a.timestamp},o=i.get(a.remoteId);o&&(s.jitter=o.jitter,s.packetsLost=o.packetsLost,s.roundTripTime=o.roundTripTime),n.push(s)}}),n.sort((a,r)=>{var s,o;return((s=r.frameWidth)!==null&&s!==void 0?s:0)-((o=a.frameWidth)!==null&&o!==void 0?o:0)}),n})}setPublishingQuality(e){const n=[];for(let i=tn.LOW;i<=tn.HIGH;i+=1)n.push(new ng({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(Un(this.codec),n)}restartTrack(e){return E(this,void 0,void 0,function*(){var n,i,a,r,s;let o;if(e){const d=cg({video:e});typeof d.video!="boolean"&&(o=d.video)}yield this.restart(o),this.isCpuConstrained=!1;try{for(var l=!0,c=ki(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;l=!0){r=u.value,l=!1;const d=r;d.sender&&((s=d.sender.transport)===null||s===void 0?void 0:s.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!l&&!n&&(a=c.return)&&(yield a.call(c))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return E(this,arguments,void 0,function(i){var a=this;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s,o,l,c,u,d;if(yield n.setProcessor.call(a,i,r),!((u=a.processor)===null||u===void 0)&&u.processedTrack)try{for(var f=!0,h=ki(a.simulcastCodecs.values()),v;v=yield h.next(),s=v.done,!s;f=!0)c=v.value,f=!1,yield(d=c.sender)===null||d===void 0?void 0:d.replaceTrack(a.processor.processedTrack)}catch(g){o={error:g}}finally{try{!f&&!s&&(l=h.return)&&(yield l.call(h))}finally{if(o)throw o.error}}}()})}setDegradationPreference(e){return E(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},_3))}setPublishingCodecs(e){return E(this,void 0,void 0,function*(){var n,i,a,r,s,o,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(Un(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(n=!0,i=ki(e);a=yield i.next(),r=a.done,!r;n=!0){l=a.value,n=!1;const u=l;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(Un(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const f of u.qualities)if(f.enabled){c.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield Bb(d.sender,d.encodings,u.qualities,this.senderLock,Un(u.codec),this.log,this.logContext))}}}catch(u){s={error:u}}finally{try{!n&&!r&&(o=i.return)&&(yield o.call(i))}finally{if(s)throw s.error}}return c})}setPublishingLayers(e,n){return E(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield Bb(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return E(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,a)=>{var r;return Object.assign(Object.assign({},i),{active:a===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((r=this.mediaStreamTrack.getSettings().height)!==null&&r!==void 0?r:360)/360)),scalabilityMode:a===0&&Un(this.codec)?"L1T3":void 0,maxFramerate:a===0?15:0,maxBitrate:a===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return E(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),Xk()&&this.isInBackground&&this.source===D.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function Bb(t,e,n,i,a,r,s){return E(this,void 0,void 0,function*(){const o=yield i.lock();r.debug("setPublishingLayersForSender",Object.assign(Object.assign({},s),{sender:t,qualities:n,senderEncodings:e}));try{const l=t.getParameters(),{encodings:c}=l;if(!c)return;if(c.length!==e.length){r.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},s),{encodings:c,senderEncodings:e}));return}let u=!1;!1&&c[0].scalabilityMode||(a&&n.some(h=>h.enabled)&&n.forEach(h=>h.enabled=!0),c.forEach((f,h)=>{var v;let g=(v=f.rid)!==null&&v!==void 0?v:"";g===""&&(g="q");const C=sE(g),m=n.find(b=>b.quality===C);m&&f.active!==m.enabled&&(u=!0,f.active=m.enabled,r.debug("setting layer ".concat(m.quality," to ").concat(f.active?"enabled":"disabled"),s),pr()&&(m.enabled?(f.scaleResolutionDownBy=e[h].scaleResolutionDownBy,f.maxBitrate=e[h].maxBitrate,f.maxFrameRate=e[h].maxFrameRate):(f.scaleResolutionDownBy=4,f.maxBitrate=10,f.maxFrameRate=2)))})),u&&(l.encodings=c,r.debug("setting encodings",Object.assign(Object.assign({},s),{encodings:l.encodings})),yield t.setParameters(l))}finally{o()}})}function sE(t){switch(t){case"f":return tn.HIGH;case"h":return tn.MEDIUM;case"q":return tn.LOW;default:return tn.HIGH}}function qb(t,e,n,i){if(!n)return[new _a({quality:tn.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const a=n[0].scalabilityMode,r=new rE(a),s=[],o=r.suffix=="h"?1.5:2,l=r.suffix=="h"?2:3;for(let c=0;c<r.spatial;c+=1)s.push(new _a({quality:Math.min(tn.HIGH,r.spatial-1)-c,width:Math.ceil(t/Math.pow(o,c)),height:Math.ceil(e/Math.pow(o,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(l,c)):0,ssrc:0}));return s}return n.map(a=>{var r,s,o;const l=(r=a.scaleResolutionDownBy)!==null&&r!==void 0?r:1;let c=sE((s=a.rid)!==null&&s!==void 0?s:"");return new _a({quality:c,width:Math.ceil(t/l),height:Math.ceil(e/l),bitrate:(o=a.maxBitrate)!==null&&o!==void 0?o:0,ssrc:0})})}const zb="_lossy",Fb="_reliable",w3=2*1e3,Uf="leave-reconnect",R3=3e4,x3=8*1024,O3=256*1024;var fn;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(fn||(fn={}));class A3 extends oi.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=pg.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=fn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=ae,this.reliableDataSequence=1,this.reliableMessageBuffer=new xb,this.reliableReceivedState=new XN(R3),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>E(this,[i],void 0,function(a){var r=this;let{channel:s}=a;return function*(){if(s){if(s.label===Fb)r.reliableDCSub=s;else if(s.label===zb)r.lossyDCSub=s;else return;r.log.debug("on data channel ".concat(s.id,", ").concat(s.label),r.logContext),s.onmessage=r.handleDataMessage}}()}),this.handleDataMessage=i=>E(this,void 0,void 0,function*(){var a,r,s,o,l;const c=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const d=Mt.fromBinary(new Uint8Array(u));if(d.sequence>0&&d.participantSid!==""){const f=this.reliableReceivedState.get(d.participantSid);if(f&&d.sequence<=f)return;this.reliableReceivedState.set(d.participantSid,d.sequence)}if(((a=d.value)===null||a===void 0?void 0:a.case)==="speaker")this.emit(H.ActiveSpeakersUpdate,d.value.value.speakers);else if(((r=d.value)===null||r===void 0?void 0:r.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const f=yield(s=this.e2eeManager)===null||s===void 0?void 0:s.handleEncryptedData(d.value.value.encryptedValue,d.value.value.iv,d.participantIdentity,d.value.value.keyIndex),h=z1.fromBinary(f.payload),v=new Mt({value:h.value,participantIdentity:d.participantIdentity,participantSid:d.participantSid});((o=v.value)===null||o===void 0?void 0:o.case)==="user"&&Vb(v,v.value.value),this.emit(H.DataPacketReceived,v,d.value.value.encryptionType)}else((l=d.value)===null||l===void 0?void 0:l.case)==="user"&&Vb(d,d.value.value),this.emit(H.DataPacketReceived,d,Xe.NONE)}finally{c()}}),this.handleDataError=i=>{const r=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:s}=i.error;this.log.error("DataChannel error on ".concat(r,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:s}))}else this.log.error("Unknown DataChannel error on ".concat(r),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const r=i.currentTarget.maxRetransmits===0?se.LOSSY:se.RELIABLE;this.updateAndEmitDCBufferStatus(r)},this.handleDisconnect=(i,a)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const r=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(H.Disconnected),this.close()},s=Date.now()-this.reconnectStart;let o=this.getNextRetryDelay({elapsedMs:s,retryCount:this.reconnectAttempts});if(o===null){r(s);return}i===Uf&&(o=0),this.log.debug("reconnecting in ".concat(o,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=Tt.setTimeout(()=>this.attemptReconnect(a).finally(()=>this.reconnectTimeout=void 0),o)},this.waitForRestarted=()=>new Promise((i,a)=>{this.pcState===fn.Connected&&i();const r=()=>{this.off(H.Disconnected,s),i()},s=()=>{this.off(H.Restarted,r),a()};this.once(H.Restarted,r),this.once(H.Disconnected,s)}),this.updateAndEmitDCBufferStatus=i=>{if(i===se.RELIABLE){const r=this.dataChannelForKind(i);r&&this.reliableMessageBuffer.alignBufferedAmount(r.bufferedAmount)}const a=this.isBufferStatusLow(i);typeof a<"u"&&a!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,a),this.emit(H.DCBufferStatusChanged,a,i))},this.isBufferStatusLow=i=>{const a=this.dataChannelForKind(i);if(a)return a.bufferedAmount<=a.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>E(this,void 0,void 0,function*(){!this.url||!(yield fetch(ll(this.url),{method:"HEAD"}).then(a=>a.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===xe.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===xe.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Za.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>E(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(ll(this.url),{method:"HEAD"}),Ct(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=qi((n=e.loggerName)!==null&&n!==void 0?n:qn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new dg(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new Pt,this.dataProcessLock=new Pt,this.dcBufferStatus=new Map([[se.LOSSY,!0],[se.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(H.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(H.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(H.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(H.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(H.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(H.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(H.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(H.SignalRequestResponse,i)}get logContext(){var e,n,i,a,r,s;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(a=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||a===void 0?void 0:a.sid,participant:(s=(r=this.latestJoinResponse)===null||r===void 0?void 0:r.participant)===null||s===void 0?void 0:s.identity,pID:this.participantSid}}join(e,n,i,a){return E(this,arguments,void 0,function(r,s,o,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){c.url=r,c.token=s,c.signalOpts=o,c.maxJoinAttempts=o.maxRetries;try{c.joinAttempts+=1,c.setupSignalClientCallbacks();const d=yield c.client.join(r,s,o,l,u);return c._isClosed=!1,c.latestJoinResponse=d,c.subscriberPrimary=d.subscriberPrimary,c.pcManager||(yield c.configure(d,!u)),(!c.subscriberPrimary||d.fastPublish)&&c.negotiate().catch(f=>{ae.error(f,c.logContext)}),c.registerOnLineListener(),c.clientConfiguration=d.clientConfiguration,c.emit(H.SignalConnected,d),d}catch(d){if(d instanceof $){if(d.reason===Oe.ServerUnreachable){if(c.log.warn("Couldn't connect to server, attempt ".concat(c.joinAttempts," of ").concat(c.maxJoinAttempts),c.logContext),c.joinAttempts<c.maxJoinAttempts)return c.join(r,s,o,l,u)}else if(d.reason===Oe.ServiceNotFound)return c.log.warn("Initial connection failed: ".concat(d.message,"  Retrying")),c.join(r,s,o,l,!0)}throw d}}()})}close(){return E(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(H.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return E(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new xb,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return E(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new Ei("a track with the same ID has already been published");return new Promise((n,i)=>{const a=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i($.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:r=>{clearTimeout(a),n(r)},reject:()=>{clearTimeout(a),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return E(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e,n){return E(this,void 0,void 0,function*(){var i,a;if(this.pcManager&&this.pcManager.currentState!==Fe.NEW)return;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid;const r=this.makeRTCConfiguration(e);this.pcManager=new r3(r,n?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(H.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(s,o)=>{this.client.sendIceCandidate(s,o)},this.pcManager.onPublisherOffer=(s,o)=>{this.client.sendOffer(s,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(s,o,l)=>E(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(s),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),s===Fe.CONNECTED){const d=this.pcState===fn.New;this.pcState=fn.Connected,d&&this.emit(H.Connected,e)}else s===Fe.FAILED&&(this.pcState===fn.Connected||this.pcState===fn.Reconnecting)&&(this.pcState=fn.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?Za.RR_SUBSCRIBER_FAILED:Za.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===xe.RECONNECTING,u=[Fe.FAILED,Fe.CLOSING,Fe.CLOSED].includes(s);c&&u&&!this._isClosed&&this.emit(H.Offline)}),this.pcManager.onTrack=s=>{s.streams.length!==0&&this.emit(H.MediaTrackAdded,s.track,s.streams[0],s.receiver)},M3((a=e.serverInfo)===null||a===void 0?void 0:a.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>E(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>E(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const a=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);a&&this.client.sendAnswer(a,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(H.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(H.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(H.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(H.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(H.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const a={direction:"recvonly"};for(let r=0;r<e.numAudios;r++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",a);for(let r=0;r<e.numVideos;r++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",a);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Za.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:nE,regionSettings:e.regions})),e.action){case ls.DISCONNECT:this.emit(H.Disconnected,e==null?void 0:e.reason),this.close();break;case ls.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Uf);break;case ls.RESUME:this.handleDisconnect(Uf)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const a=[];e.iceServers.forEach(r=>{const s={urls:r.urls};r.username&&(s.username=r.username),r.credential&&(s.credential=r.credential),a.push(s)}),i.iceServers=a}return e.clientConfiguration&&e.clientConfiguration.forceRelay===nl.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(zb,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(Fb,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(se.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,x3),O3)}},1e3))}createSender(e,n,i){return E(this,void 0,void 0,function*(){if(cm())return yield this.createTransceiverRTCRtpSender(e,n,i);if(um())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Ye("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,a){return E(this,void 0,void 0,function*(){if(cm())return this.createSimulcastTransceiverSender(e,n,i,a);if(um())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Ye("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return E(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ye("publisher is closed");const a=[];e.mediaStream&&a.push(e.mediaStream),za(e)&&(e.codec=n.videoCodec);const r={direction:"sendonly",streams:a};return i&&(r.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,r)).sender})}createSimulcastTransceiverSender(e,n,i,a){return E(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ye("publisher is closed");const r={direction:"sendonly"};a&&(r.sendEncodings=a);const s=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,r);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,s.sender),s.sender})}createRTCRtpSender(e){return E(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ye("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return E(this,void 0,void 0,function*(){var n,i,a;if(!this._isClosed){if(this.attemptingReconnect){ae.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===nl.DISABLED||((a=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&a!==void 0?a:Fe.NEW)===Fe.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(r){this.reconnectAttempts+=1;let s=!0;r instanceof Ye?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:r})),s=!1):r instanceof Lr||(this.fullReconnectOnNext=!0),s?this.handleDisconnect("reconnect",Za.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(H.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return E(this,void 0,void 0,function*(){var n,i,a;try{if(!this.url||!this.token)throw new Ye("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(H.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let r;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new Lr;r=yield this.join(e??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(s){throw s instanceof $&&s.reason===Oe.NotAllowed?new Ye("could not reconnect, token might be expired"):new Lr}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(H.SignalRestarted,r),yield this.waitForPCReconnected(),this.client.currentState!==xe.CONNECTED)throw new Lr("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(H.Restarted)}catch(r){const s=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(s){yield this.restartConnection(s);return}else throw(a=this.regionUrlProvider)===null||a===void 0||a.resetAttempts(),r}})}resumeConnection(e){return E(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Ye("could not reconnect, url or token not saved");if(!this.pcManager)throw new Ye("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(H.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(a){let r="";throw a instanceof Error&&(r=a.message,this.log.error(a.message,Object.assign(Object.assign({},this.logContext),{error:a}))),a instanceof $&&a.reason===Oe.NotAllowed?new Ye("could not reconnect, token might be expired"):a instanceof $&&a.reason===Oe.LeaveRequest?a:new Lr(r)}if(this.emit(H.SignalResumed),i){const a=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(a),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==xe.CONNECTED)throw new Lr("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(H.Resumed)})}waitForPCInitialConnection(e,n){return E(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ye("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return E(this,void 0,void 0,function*(){this.pcState=fn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield Ct(w3),!this.pcManager)throw new Ye("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=fn.Connected}catch(e){throw this.pcState=fn.Disconnected,$.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,a){return E(this,void 0,void 0,function*(){const r=new Mt({destinationIdentities:[e],kind:se.RELIABLE,value:{case:"rpcResponse",value:new Zp({requestId:n,value:a?{case:"error",value:a.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(r,se.RELIABLE)})}publishRpcAck(e,n){return E(this,void 0,void 0,function*(){const i=new Mt({destinationIdentities:[e],kind:se.RELIABLE,value:{case:"rpcAck",value:new $p({requestId:n})}});yield this.sendDataPacket(i,se.RELIABLE)})}sendDataPacket(e,n){return E(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const r=BN(e);if(r){const s=yield this.e2eeManager.encryptData(r.toBinary());e.value={case:"encryptedPacket",value:new q1({encryptedValue:s.payload,iv:s.iv,keyIndex:s.keyIndex})}}}n===se.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),a=this.dataChannelForKind(n);if(a){if(n===se.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;a.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return E(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(se.RELIABLE);const n=this.dataChannelForKind(se.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(se.RELIABLE)})}waitForBufferStatusLow(e){return new wt((n,i)=>E(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const a=()=>i(new Ye("engine closed"));for(this.once(H.Closing,a);!this.dcBufferStatus.get(e);)yield Ct(10);this.off(H.Closing,a),n()}}))}ensureDataTransportConnected(e){return E(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var r;if(!i.pcManager)throw new Ye("PC manager is closed");const s=a?i.pcManager.subscriber:i.pcManager.publisher,o=a?"Subscriber":"Publisher";if(!s)throw $.internal("".concat(o," connection not set"));let l=!1;!a&&!i.dataChannelForKind(n,a)&&(i.createDataChannels(),l=!0),!l&&!a&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&i.negotiate().catch(d=>{ae.error(d,i.logContext)});const c=i.dataChannelForKind(n,a);if((c==null?void 0:c.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(s.isICEConnected&&((r=i.dataChannelForKind(n,a))===null||r===void 0?void 0:r.readyState)==="open")return;yield Ct(50)}throw $.internal("could not establish ".concat(o," connection, state: ").concat(s.getICEConnectionState()))}()})}ensurePublisherConnected(e){return E(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Fe.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return E(this,void 0,void 0,function*(){return new wt((e,n)=>E(this,void 0,void 0,function*(){if(!this.pcManager){n(new us("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,a=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n(new us("cannot negotiate on closed engine")),this.on(H.Closing,a),this.pcManager.publisher.once(ms.RTPVideoPayloadTypes,r=>{const s=new Map;r.forEach(o=>{const l=o.codec.toLowerCase();CN(l)&&s.set(o.payload,l)}),this.emit(H.RTPVideoMapUpdate,s)});try{yield this.pcManager.negotiate(i),e()}catch(r){r instanceof us&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Za.RR_UNKNOWN),r instanceof Error?n(r):n(new Error(String(r)))}finally{this.off(H.Closing,a)}}))})}dataChannelForKind(e,n){if(n){if(e===se.LOSSY)return this.lossyDCSub;if(e===se.RELIABLE)return this.reliableDCSub}else{if(e===se.LOSSY)return this.lossyDC;if(e===se.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,a,r,s;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const o=this.pcManager.publisher.getLocalDescription(),l=this.pcManager.publisher.getRemoteDescription(),c=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(a=this.pcManager.subscriber)===null||a===void 0?void 0:a.getLocalDescription(),d=(s=(r=this.signalOpts)===null||r===void 0?void 0:r.autoSubscribe)!==null&&s!==void 0?s:!0,f=new Array,h=new Array;e.forEach(v=>{v.isDesired!==d&&f.push(v.trackSid),v.isEnabled||h.push(v.trackSid)}),this.client.sendSyncState(new ig({answer:this.pcManager.mode==="publisher-only"?l?Wr({sdp:l.sdp,type:l.type}):void 0:u?Wr({sdp:u.sdp,type:u.type}):void 0,offer:this.pcManager.mode==="publisher-only"?o?Wr({sdp:o.sdp,type:o.type}):void 0:c?Wr({sdp:c.sdp,type:c.type}):void 0,subscription:new cd({trackSids:f,subscribe:!d,participantTracks:[]}),publishTracks:rN(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:h,datachannelReceiveStates:this.reliableReceivedState.map((v,g)=>new ck({publisherSid:g,lastSeq:v}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,a)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new uk({label:i.label,id:i.id,target:a}))};return n(this.dataChannelForKind(se.LOSSY),In.PUBLISHER),n(this.dataChannelForKind(se.RELIABLE),In.PUBLISHER),n(this.dataChannelForKind(se.LOSSY,!0),In.SUBSCRIBER),n(this.dataChannelForKind(se.RELIABLE,!0),In.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&Tt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Vt()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Vt()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const a=Object.entries(this.midToTrackId).find(r=>{let[s]=r;return s===i});if(a)return a[1]}}}function M3(t){return t!==void 0&&t>13}function Vb(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class oE{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new hn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),At.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new hn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),At.LengthExceeded)}}constructor(e,n,i,a){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=a}}class D3 extends oE{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new kn,i=null,a=null;if(this.signal){const s=this.signal;a=()=>{var o;(o=n.reject)===null||o===void 0||o.call(n,s.reason)},s.addEventListener("abort",a),i=s}const r=()=>{e.releaseLock(),i&&a&&i.removeEventListener("abort",a),this.signal=void 0};return{next:()=>E(this,void 0,void 0,function*(){var s,o;try{const{done:l,value:c}=yield Promise.race([e.read(),n.promise,(o=(s=this.outOfBandFailureRejectingFuture)===null||s===void 0?void 0:s.promise)!==null&&o!==void 0?o:new Promise(()=>{})]);return l?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(c),{done:!1,value:c.content})}catch(l){throw r(),l}}),return(){return E(this,void 0,void 0,function*(){return r(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return E(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,a,r,s;let o=new Set;const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=ki(l),d;d=yield u.next(),i=d.done,!i;c=!0){s=d.value,c=!1;const f=s;o.add(f)}}catch(f){a={error:f}}finally{try{!c&&!i&&(r=u.return)&&(yield r.call(u))}finally{if(a)throw a.error}}return Array.from(o)}()})}}class P3 extends oE{constructor(e,n,i,a){super(e,n,i,a),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Ic(e.chunkIndex),a=this.receivedChunks.get(i);if(a&&a.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const r=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,r)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new kn,a=null,r=null;if(this.signal){const o=this.signal;r=()=>{var l;(l=i.reject)===null||l===void 0||l.call(i,o.reason)},o.addEventListener("abort",r),a=o}const s=()=>{e.releaseLock(),a&&r&&a.removeEventListener("abort",r),this.signal=void 0};return{next:()=>E(this,void 0,void 0,function*(){var o,l;try{const{done:c,value:u}=yield Promise.race([e.read(),i.promise,(l=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);if(c)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(f){throw new hn("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(f),At.DecodeFailed)}return{done:!1,value:d}}}catch(c){throw s(),c}}),return(){return E(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return E(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,a,r,s;let o="";const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=ki(l),d;d=yield u.next(),i=d.done,!i;c=!0)s=d.value,c=!1,o+=s}catch(f){a={error:f}}finally{try{!c&&!i&&(r=u.return)&&(yield r.call(u))}finally{if(a)throw a.error}}return o}()})}}class N3{constructor(){this.log=ae,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new hn('A text stream handler for topic "'.concat(e,'" has already been set.'),At.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new hn('A byte stream handler for topic "'.concat(e,'" has already been set.'),At.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,a,r;const s=Array.from(this.textStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e),o=Array.from(this.byteStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e);if(s.length>0||o.length>0){const l=new hn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),At.AbnormalEnd);for(const[c,u]of o)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,l),this.byteStreamControllers.delete(c);for(const[c,u]of s)(r=(a=u.outOfBandFailureRejectingFuture).reject)===null||r===void 0||r.call(a,l),this.textStreamControllers.delete(c)}}handleDataStreamPacket(e,n){return E(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return E(this,void 0,void 0,function*(){var a;if(e.contentHeader.case==="byteHeader"){const r=this.byteStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let s;const o=new kn;o.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,name:(a=e.contentHeader.value.name)!==null&&a!==void 0?a:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Ic(e.timestamp),attributes:e.attributes,encryptionType:i},c=new ReadableStream({start:u=>{if(s=u,this.textStreamControllers.has(e.streamId))throw new hn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),At.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:l,controller:s,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:o})}});r(new D3(l,c,Ic(e.totalLength),o),{identity:n})}else if(e.contentHeader.case==="textHeader"){const r=this.textStreamHandlers.get(e.topic);if(!r){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let s;const o=new kn;o.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i,attachedStreamIds:e.contentHeader.value.attachedStreamIds},c=new ReadableStream({start:u=>{if(s=u,this.textStreamControllers.has(e.streamId))throw new hn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),At.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:l,controller:s,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:o})}});r(new P3(l,c,Ic(e.totalLength),o),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new hn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),At.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const a=this.textStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==n?(a.controller.error(new hn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(a.info.encryptionType),At.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&a.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new hn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),At.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const a=this.byteStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==n?a.controller.error(new hn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(a.info.encryptionType),At.EncryptionTypeMismatch)):(a.info.attributes=Object.assign(Object.assign({},a.info.attributes),e.attributes),a.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class lE{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return E(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class L3 extends lE{}class I3 extends lE{}const Hb=15e3;class U3{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return E(this,void 0,void 0,function*(){var i;const a=crypto.randomUUID(),s=new TextEncoder().encode(e).byteLength,o=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),l=new Array(o?o.length+1:1).fill(0),c=(d,f)=>{var h;l[f]=d;const v=l.reduce((g,C)=>g+C,0);(h=n==null?void 0:n.onProgress)===null||h===void 0||h.call(n,v)},u=yield this.streamText({streamId:a,totalSize:s,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:o,attributes:n==null?void 0:n.attributes});return yield u.write(e),c(1,0),yield u.close(),n!=null&&n.attachments&&o&&(yield Promise.all(n.attachments.map((d,f)=>E(this,void 0,void 0,function*(){return this._sendFile(o[f],d,{topic:n.topic,mimeType:d.type,onProgress:h=>{c(h,f+1)}})})))),u.info})}streamText(e){return E(this,void 0,void 0,function*(){var n,i,a;const r=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),s={id:r,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?Xe.GCM:Xe.NONE,attachedStreamIds:e==null?void 0:e.attachedStreamIds},o=new Tu({streamId:r,mimeType:s.mimeType,topic:s.topic,timestamp:Wa(s.timestamp),totalLength:Wa(e==null?void 0:e.totalSize),attributes:s.attributes,contentHeader:{case:"textHeader",value:new Z1({version:e==null?void 0:e.version,attachedStreamIds:s.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Qh.UPDATE:Qh.CREATE})}}),l=e==null?void 0:e.destinationIdentities,c=new Mt({destinationIdentities:l,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,se.RELIABLE);let u=0;const d=this.engine,f=new WritableStream({write(g){return E(this,void 0,void 0,function*(){for(const C of xN(g,Hb)){const m=new Cu({content:C,streamId:r,chunkIndex:Wa(u)}),b=new Mt({destinationIdentities:l,value:{case:"streamChunk",value:m}});yield d.sendDataPacket(b,se.RELIABLE),u+=1}})},close(){return E(this,void 0,void 0,function*(){const g=new ku({streamId:r}),C=new Mt({destinationIdentities:l,value:{case:"streamTrailer",value:g}});yield d.sendDataPacket(C,se.RELIABLE)})},abort(g){console.log("Sink error:",g)}});let h=()=>E(this,void 0,void 0,function*(){yield v.close()});d.once(H.Closing,h);const v=new L3(f,s,()=>this.engine.off(H.Closing,h));return v})}sendFile(e,n){return E(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return E(this,void 0,void 0,function*(){var a;const r=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(a=i==null?void 0:i.mimeType)!==null&&a!==void 0?a:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),s=n.stream().getReader();for(;;){const{done:o,value:l}=yield s.read();if(o)break;yield r.write(l)}return yield r.close(),r.info})}streamBytes(e){return E(this,void 0,void 0,function*(){var n,i,a,r,s,o;const l=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,u={id:l,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(a=e==null?void 0:e.topic)!==null&&a!==void 0?a:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(r=e==null?void 0:e.name)!==null&&r!==void 0?r:"unknown",encryptionType:!((s=this.engine.e2eeManager)===null||s===void 0)&&s.isDataChannelEncryptionEnabled?Xe.GCM:Xe.NONE},d=new Tu({totalLength:Wa((o=u.size)!==null&&o!==void 0?o:0),mimeType:u.mimeType,streamId:l,topic:u.topic,timestamp:Wa(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new W1({name:u.name})}}),f=new Mt({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(f,se.RELIABLE);let h=0;const v=new Pt,g=this.engine,C=this.log,m=new WritableStream({write(S){return E(this,void 0,void 0,function*(){const p=yield v.lock();let y=0;try{for(;y<S.byteLength;){const k=S.slice(y,y+Hb),_=new Mt({destinationIdentities:c,value:{case:"streamChunk",value:new Cu({content:k,streamId:l,chunkIndex:Wa(h)})}});yield g.sendDataPacket(_,se.RELIABLE),h+=1,y+=k.byteLength}}finally{p()}})},close(){return E(this,void 0,void 0,function*(){const S=new ku({streamId:l}),p=new Mt({destinationIdentities:c,value:{case:"streamTrailer",value:S}});yield g.sendDataPacket(p,se.RELIABLE)})},abort(S){C.error("Sink error:",S)}});return new I3(m,u)})}}class cE extends D{constructor(e,n,i,a,r){super(e,i,r),this.sid=n,this.receiver=a}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?V.Muted:V.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(V.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return E(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),vg)),sN()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:a,rtpTimestamp:r}=i;r&&this.rtpTimestamp!==r&&(this.emit(V.TimeSyncUpdate,{timestamp:a,rtpTimestamp:r}),this.rtpTimestamp=r)}};e()}}class uE extends cE{constructor(e,n,i,a,r,s){super(e,n,D.Kind.Audio,i,s),this.monitorReceiver=()=>E(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=fd(o,this.prevStats)),this.prevStats=o}),this.audioContext=a,this.webAudioPluginNodes=[],r&&(this.sinkId=r.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;ti()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(ti())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return E(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(dm(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&dm(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(a=>{i.connect(a),i=a}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(V.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(a=>{this.emit(V.AudioPlaybackFailed,a)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return E(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const jf=100;class j3 extends cE{constructor(e,n,i,a,r){super(e,n,D.Kind.Video,i,r),this.elementInfos=[],this.monitorReceiver=()=>E(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const s=yield this.getReceiverStats();s&&this.prevStats&&this.receiver&&(this._currentBitrate=fd(s,this.prevStats)),this.prevStats=s}),this.debouncedHandleResize=hg(()=>{this.updateDimensions()},jf),this.adaptiveStreamSettings=a}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===D.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?ds(this._mediaStreamTrack,n):Zr(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new B3(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return E(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",a=new Map;return e.forEach(r=>{r.type==="inbound-rtp"?(i=r.codecId,n={type:"video",streamId:r.id,framesDecoded:r.framesDecoded,framesDropped:r.framesDropped,framesReceived:r.framesReceived,packetsReceived:r.packetsReceived,packetsLost:r.packetsLost,frameWidth:r.frameWidth,frameHeight:r.frameHeight,pliCount:r.pliCount,firCount:r.firCount,nackCount:r.nackCount,jitter:r.jitter,timestamp:r.timestamp,bytesReceived:r.bytesReceived,decoderImplementation:r.decoderImplementation}):r.type==="codec"&&a.set(r.id,r)}),n&&i!==""&&a.get(i)&&(n.mimeType=a.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return E(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const a=this.elementInfos.reduce((l,c)=>Math.max(l,c.visibilityChangedAt||0),0),r=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,s=this.elementInfos.some(l=>l.pictureInPicture),o=this.elementInfos.some(l=>l.visible)&&!r||s;if(!(this.lastVisible===o&&!e)){if(!o&&Date.now()-a<jf){Tt.setTimeout(()=>{this.updateVisibility()},jf);return}this.lastVisible=o,this.emit(V.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let i=0,a=0;const r=this.getPixelDensity();for(const s of this.elementInfos){const o=s.width()*r,l=s.height()*r;o+l>i+a&&(i=o,a=l)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===a||(this.lastDimensions={width:i,height:a},this.emit(V.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?bb():n||(bb()>2?2:1)}}class B3{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var a;const{target:r,isIntersecting:s}=i;r===this.element&&(this.isIntersecting=s,this.isPiP=co(this.element),this.visibilityChangedAt=Date.now(),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this))},this.onEnterPiP=()=>{var i,a,r;(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP),this.isPiP=co(this.element),(r=this.handleVisibilityChanged)===null||r===void 0||r.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=co(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??vm(e),this.isPiP=Vt()&&co(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=vm(this.element),this.isPiP=co(this.element),this.element.handleResize=()=>{var a;(a=this.handleResize)===null||a===void 0||a.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Sb().observe(this.element),yb().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,a,r;(e=Sb())===null||e===void 0||e.unobserve(this.element),(n=yb())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(r=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||r===void 0||r.removeEventListener("pagehide",this.onLeavePiP)}}function co(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?vm(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function vm(t,e){const n=e||window;let i=t.offsetTop,a=t.offsetLeft;const r=t.offsetWidth,s=t.offsetHeight,{hidden:o}=t,{display:l}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,a+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&a<n.pageXOffset+n.innerWidth&&i+s>n.pageYOffset&&a+r>n.pageXOffset&&!o&&l!=="none"}class yi extends oi.EventEmitter{constructor(e,n,i,a){var r;super(),this.metadataMuted=!1,this.encryption=Xe.NONE,this.log=ae,this.handleMuted=()=>{this.emit(V.Muted)},this.handleUnmuted=()=>{this.emit(V.Unmuted)},this.log=qi((r=a==null?void 0:a.loggerName)!==null&&r!==void 0?r:qn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=D.Source.Unknown}setTrack(e){this.track&&(this.track.off(V.Muted,this.handleMuted),this.track.off(V.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(V.Muted,this.handleMuted),e.on(V.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),oe(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Xe.NONE}get audioTrack(){if(Zn(this.track))return this.track}get videoTrack(){if(za(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=D.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===D.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(yi||(yi={}));class bm extends yi{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,a){super(e,n.sid,n.name,a),this.track=void 0,this.handleTrackEnded=()=>{this.emit(V.Ended)},this.handleCpuConstrained=()=>{this.track&&za(this.track)&&this.emit(V.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(V.Ended,this.handleTrackEnded),this.track.off(V.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(V.Ended,this.handleTrackEnded),e.on(V.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return E(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return E(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return E(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return E(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Zn(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(ft.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(ft.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(ft.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(ft.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(ft.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(ft.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function hd(t,e){return E(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:a,optionsWithoutProcessor:r}=Jk(t);let s=r.audio,o=r.video;if(i&&typeof r.audio=="object"&&(r.audio.processor=i),a&&typeof r.video=="object"&&(r.video.processor=a),t.audio&&typeof r.audio=="object"&&typeof r.audio.deviceId=="string"){const d=r.audio.deviceId;r.audio.deviceId={exact:d},n=!0,s=Object.assign(Object.assign({},r.audio),{deviceId:{ideal:d}})}if(r.video&&typeof r.video=="object"&&typeof r.video.deviceId=="string"){const d=r.video.deviceId;r.video.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},r.video),{deviceId:{ideal:d}})}r.audio===!0?r.audio={deviceId:"default"}:typeof r.audio=="object"&&r.audio!==null&&(r.audio=Object.assign(Object.assign({},r.audio),{deviceId:r.audio.deviceId||"default"})),r.video===!0?r.video={deviceId:"default"}:typeof r.video=="object"&&!r.video.deviceId&&(r.video.deviceId="default");const l=Gk(r,eE,tE),c=cg(l),u=navigator.mediaDevices.getUserMedia(c);r.audio&&(mt.userMediaPromiseMap.set("audioinput",u),u.catch(()=>mt.userMediaPromiseMap.delete("audioinput"))),r.video&&(mt.userMediaPromiseMap.set("videoinput",u),u.catch(()=>mt.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(f=>E(this,void 0,void 0,function*(){const h=f.kind==="audio";let v=h?l.audio:l.video;(typeof v=="boolean"||!v)&&(v={});let g;const C=h?c.audio:c.video;typeof C!="boolean"&&(g=C);const m=f.getSettings().deviceId;g!=null&&g.deviceId&&wa(g.deviceId)!==m?g.deviceId=m:g||(g={deviceId:m});const b=m3(f,g,e);return b.kind===D.Kind.Video?b.source=D.Source.Camera:b.kind===D.Kind.Audio&&(b.source=D.Source.Microphone),b.mediaStream=d,Zn(b)&&i?yield b.setProcessor(i):za(b)&&a&&(yield b.setProcessor(a)),b})))}catch(d){if(!n)throw d;return hd(Object.assign(Object.assign({},t),{audio:s,video:o}),e)}})}function q3(t){return E(this,void 0,void 0,function*(){return(yield hd({audio:!1,video:!0}))[0]})}function z3(t){return E(this,void 0,void 0,function*(){return(yield hd({audio:!0,video:!1}))[0]})}var oa;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(oa||(oa={}));function F3(t){switch(t){case yo.EXCELLENT:return oa.Excellent;case yo.GOOD:return oa.Good;case yo.POOR:return oa.Poor;case yo.LOST:return oa.Lost;default:return oa.Unknown}}class dE extends oi.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===il.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===os.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,a,r,s){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:il.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=oa.Unknown,this.log=ae,this.log=qi((l=s==null?void 0:s.loggerName)!==null&&l!==void 0?l:qn.Participant),this.loggerOptions=s,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=a,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=o,this._attributes=r??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new kn,this.once(B.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(D.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(D.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(D.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===os.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==os.ACTIVE&&this.emit(B.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(B.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(B.ParticipantNameChanged,e)}_setAttributes(e){const n=oN(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(B.AttributesChanged,n)}setPermissions(e){var n,i,a,r,s,o;const l=this.permissions,c=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((a=this.permissions)===null||a===void 0?void 0:a.canPublishData)||e.hidden!==((r=this.permissions)===null||r===void 0?void 0:r.hidden)||e.recorder!==((s=this.permissions)===null||s===void 0?void 0:s.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var f;return u!==((f=this.permissions)===null||f===void 0?void 0:f.canPublishSources[d])})||e.canSubscribeMetrics!==((o=this.permissions)===null||o===void 0?void 0:o.canSubscribeMetrics);return this.permissions=e,c&&this.emit(B.ParticipantPermissionsChanged,l),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(B.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=F3(e),n!==this._connectionQuality&&this.emit(B.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Zn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(V.Muted,()=>{this.emit(B.TrackMuted,e)}),e.on(V.Unmuted,()=>{this.emit(B.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case D.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case D.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function V3(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new ok({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class H3 extends dE{constructor(e,n,i,a,r,s){super(e,n,void 0,void 0,void 0,{loggerName:a.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Xe.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new kn)},this.handleReconnected=()=>{var o,l;(l=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||l===void 0||l.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var o,l,c,u,d,f;this.reconnectFuture&&(this.reconnectFuture.promise.catch(h=>this.log.warn(h.message,this.logContext)),(l=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||l===void 0||l.call(o,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(c=this.signalConnectedFuture).reject)===null||u===void 0||u.call(c,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(f=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||f===void 0||f.call(d,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=o=>{var l,c;o.participant&&this.updateInfo(o.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new kn),(c=(l=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(l)},this.handleSignalRequestResponse=o=>{const{requestId:l,reason:c,message:u}=o,d=this.pendingSignalRequests.get(l);d&&(c!==ag.OK&&d.reject(new hb(u,c)),this.pendingSignalRequests.delete(l))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let l=o.value.value,c=null,u=null;l.value.case==="payload"?c=l.value.value:l.value.case==="error"&&(u=Ke.fromProto(l.value.value)),this.handleIncomingRpcResponse(l.requestId,c,u);break;case"rpcAck":let d=o.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>V3(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,l)=>{if(l===void 0&&(l=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),oe(o)));return}this.engine.updateMuteStatus(o.sid,l)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),oe(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),oe(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const l=this.audioTrackPublications.get(o.sid);if(!l){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(l.trackSid,l.getTrackFeatures())},this.onTrackCpuConstrained=(o,l)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),oe(l))),this.emit(B.LocalTrackCpuConstrained,o,l)},this.handleSubscribedQualityUpdate=o=>E(this,void 0,void 0,function*(){var l,c,u,d,f;if(!(!((f=this.roomOptions)===null||f===void 0)&&f.dynacast))return;const h=this.videoTrackPublications.get(o.trackSid);if(!h){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(!h.videoTrack)return;const v=yield h.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var g=!0,C=ki(v),m;m=yield C.next(),l=m.done,!l;g=!0){d=m.value,g=!1;const b=d;nN(b)&&(this.log.debug("publish ".concat(b," for ").concat(h.videoTrack.sid),Object.assign(Object.assign({},this.logContext),oe(h))),yield this.publishAdditionalCodecForTrack(h.videoTrack,b,h.options))}}catch(b){c={error:b}}finally{try{!g&&!l&&(u=C.return)&&(yield u.call(C))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=o=>{const l=this.trackPublications.get(o.trackSid);if(!l){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(l.track)},this.handleTrackEnded=o=>E(this,void 0,void 0,function*(){if(o.source===D.Source.ScreenShare||o.source===D.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),oe(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(vi(o)||$i(o))try{if(Vt())try{const l=yield navigator==null?void 0:navigator.permissions.query({name:o.source===D.Source.Camera?"camera":"microphone"});if(l&&l.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),oe(o))),l.onchange=()=>{l.state!=="denied"&&(o.isMuted||o.restartTrack(),l.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),oe(o))),vi(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),oe(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=a,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=r,this.roomOutgoingDataStreamManager=s}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Xe.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(H.RemoteMute,(i,a)=>{const r=this.trackPublications.get(i);!r||!r.track||(a?r.mute():r.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(H.Connected,this.handleReconnected).on(H.SignalConnected,this.handleSignalConnected).on(H.SignalRestarted,this.handleReconnected).on(H.SignalResumed,this.handleReconnected).on(H.Restarting,this.handleReconnecting).on(H.Resuming,this.handleReconnecting).on(H.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(H.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(H.Closing,this.handleClosing).on(H.SignalRequestResponse,this.handleSignalRequestResponse).on(H.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return E(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return E(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return E(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return E(this,arguments,void 0,function(n){var i=this;let{metadata:a,name:r,attributes:s}=n;return function*(){return new wt((o,l)=>E(i,void 0,void 0,function*(){var c,u;try{let d=!1;const f=yield this.engine.client.sendUpdateLocalMetadata((c=a??this.metadata)!==null&&c!==void 0?c:"",(u=r??this.name)!==null&&u!==void 0?u:"",s),h=performance.now();for(this.pendingSignalRequests.set(f,{resolve:o,reject:v=>{l(v),d=!0},values:{name:r,metadata:a,attributes:s}});performance.now()-h<5e3&&!d;){if((!r||this.name===r)&&(!a||this.metadata===a)&&(!s||Object.entries(s).every(v=>{let[g,C]=v;return this.attributes[g]===C||C===""&&!this.attributes[g]}))){this.pendingSignalRequests.delete(f),o();return}yield Ct(50)}l(new hb("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error?l(d):l(new Error(String(d)))}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(D.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(D.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(D.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return E(this,void 0,void 0,function*(){this.encryptionType=e?Xe.GCM:Xe.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,a){return E(this,void 0,void 0,function*(){var r,s;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let o=this.getTrackPublication(e);if(n)if(o)yield o.unmute();else{let l;if(this.pendingPublishing.has(e)){const c=yield this.waitForPendingPublicationOfSource(e);return c||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield c==null?void 0:c.unmute(),c}this.pendingPublishing.add(e);try{switch(e){case D.Source.Camera:l=yield this.createTracks({video:(r=i)!==null&&r!==void 0?r:!0});break;case D.Source.Microphone:l=yield this.createTracks({audio:(s=i)!==null&&s!==void 0?s:!0});break;case D.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},i));break;default:throw new Ei(e)}}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c instanceof Error&&this.emit(B.MediaDevicesError,c,lm(e)),this.pendingPublishing.delete(e),c}for(const c of l){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===D.Source.Microphone&&Zn(c)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),c.startPreConnectBuffer())}try{const c=[];for(const d of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),oe(d))),c.push(this.publishTrack(d,a));[o]=yield Promise.all(c)}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c}finally{this.pendingPublishing.delete(e)}}else if(!(o!=null&&o.track)&&this.pendingPublishing.has(e)&&(o=yield this.waitForPendingPublicationOfSource(e),o||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),o&&o.track)if(e===D.Source.ScreenShare){o=yield this.unpublishTrack(o.track);const l=this.getTrackPublication(D.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield o.mute();return o})}enableCameraAndMicrophone(){return E(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(D.Source.Camera)||this.pendingPublishing.has(D.Source.Microphone))){this.pendingPublishing.add(D.Source.Camera),this.pendingPublishing.add(D.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(D.Source.Camera),this.pendingPublishing.delete(D.Source.Microphone)}}})}createTracks(e){return E(this,void 0,void 0,function*(){var n,i;e??(e={});const a=Gk(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield hd(a,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(o=>(Zn(o)&&(this.microphoneError=void 0,o.setAudioContext(this.audioContext),o.source=D.Source.Microphone,this.emit(B.AudioStreamAcquired)),za(o)&&(this.cameraError=void 0,o.source=D.Source.Camera),o))}catch(r){throw r instanceof Error&&(e.audio&&(this.microphoneError=r),e.video&&(this.cameraError=r)),r}})}createScreenTracks(e){return E(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new og("getDisplayMedia not supported");e.resolution===void 0&&!gN()&&(e.resolution=lg.h1080fps30.resolution);const n=aN(e),i=yield navigator.mediaDevices.getDisplayMedia(n),a=i.getVideoTracks();if(a.length===0)throw new Ei("no video track found");const r=new _u(a[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});r.source=D.Source.ScreenShare,e.contentHint&&(r.mediaStreamTrack.contentHint=e.contentHint);const s=[r];if(i.getAudioTracks().length>0){this.emit(B.AudioStreamAcquired);const o=new Eu(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=D.Source.ScreenShareAudio,s.push(o)}return s})}publishTrack(e,n){return E(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return E(this,arguments,void 0,function(i,a){var r=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var o,l,c,u;vi(i)&&i.setAudioContext(r.audioContext),yield(o=r.reconnectFuture)===null||o===void 0?void 0:o.promise,r.republishPromise&&!s&&(yield r.republishPromise),fs(i)&&r.pendingPublishPromises.has(i)&&(yield r.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let m;switch(i.source){case D.Source.Microphone:m="audioinput";break;case D.Source.Camera:m="videoinput"}m&&r.activeDeviceMap.has(m)&&(d=Object.assign(Object.assign({},d),{deviceId:r.activeDeviceMap.get(m)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Eu(i,d,!0,r.audioContext,{loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});break;case"video":i=new _u(i,d,!0,{loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});break;default:throw new Ei("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:r.roomOptions.loggerName,loggerContextCb:()=>r.logContext});let f;if(r.trackPublications.forEach(m=>{m.track&&m.track===i&&(f=m)}),f)return r.log.warn("track has already been published, skipping",Object.assign(Object.assign({},r.logContext),oe(f))),f;const h=Object.assign(Object.assign({},r.roomOptions.publishDefaults),a),v="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,g=(l=h.forceStereo)!==null&&l!==void 0?l:v;g&&(h.dtx===void 0&&r.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},r.logContext),oe(i))),h.red===void 0&&r.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(c=h.dtx)!==null&&c!==void 0||(h.dtx=!1),(u=h.red)!==null&&u!==void 0||(h.red=!1)),!bN()&&r.roomOptions.e2ee&&(r.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},r.logContext)),h.simulcast=!1),h.source&&(i.source=h.source);const C=new Promise((m,b)=>E(r,void 0,void 0,function*(){try{if(this.engine.client.currentState!==xe.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:oe(i)}));let S=!1;const p=setTimeout(()=>{S=!0,i.stop(),b(new fb("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(p),S)return;const y=yield this.publish(i,h,g);m(y)}else try{const S=yield this.publish(i,h,g);m(S)}catch(S){b(S)}}catch(S){b(S)}}));r.pendingPublishPromises.set(i,C);try{return yield C}catch(m){throw m}finally{r.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new kn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),oe(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(a=>lN(a)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),oe(e))),!1)}publish(e,n,i){return E(this,void 0,void 0,function*(){var a,r,s,o,l,c,u,d,f,h;if(!this.hasPermissionsToPublish(e))throw new fb("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(w=>fs(e)&&w.source===e.source)&&e.source!==D.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),oe(e))),n.stopMicTrackOnMute&&Zn(e)&&(e.stopOnMute=!0),e.source===D.Source.ScreenShare&&pr()&&(n.simulcast=!1),n.videoCodec==="av1"&&!hN()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!mN()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=mm),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(w=>n.videoCodec===Uo(w.mime))||(n.videoCodec=Uo(this.enabledPublishVideoCodecs[0].mime)));const g=n.videoCodec;e.on(V.Muted,this.onTrackMuted),e.on(V.Unmuted,this.onTrackUnmuted),e.on(V.Ended,this.handleTrackEnded),e.on(V.UpstreamPaused,this.onTrackUpstreamPaused),e.on(V.UpstreamResumed,this.onTrackUpstreamResumed),e.on(V.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const C=[],m=!(!((a=n.dtx)!==null&&a!==void 0)||a),b=e.getSourceTrackSettings();b.autoGainControl&&C.push(ft.TF_AUTO_GAIN_CONTROL),b.echoCancellation&&C.push(ft.TF_ECHO_CANCELLATION),b.noiseSuppression&&C.push(ft.TF_NOISE_SUPPRESSION),b.channelCount&&b.channelCount>1&&C.push(ft.TF_STEREO),m&&C.push(ft.TF_NO_DTX),vi(e)&&e.hasPreConnectBuffer&&C.push(ft.TF_PRECONNECT_BUFFER);const S=new al({cid:e.mediaStreamTrack.id,name:n.name,type:D.kindToProto(e.kind),muted:e.isMuted,source:D.sourceToProto(e.source),disableDtx:m,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((r=n.red)!==null&&r!==void 0)||r),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:C});let p;if(e.kind===D.Kind.Video){let w={width:0,height:0};try{w=yield e.waitForDimensions()}catch{const N=(o=(s=this.roomOptions.videoCaptureDefaults)===null||s===void 0?void 0:s.resolution)!==null&&o!==void 0?o:sl.h720.resolution;w={width:N.width,height:N.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),oe(e)),{dims:w}))}S.width=w.width,S.height=w.height,$i(e)&&(Un(g)&&(e.source===D.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),oe(e))))),n.scalabilityMode=(l=n.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),S.simulcastCodecs=[new Xh({codec:g,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:mm}),n.backupCodec&&g!==n.backupCodec.codec&&S.encryption===Xe.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),S.simulcastCodecs.push(new Xh({codec:n.backupCodec.codec,cid:""})))),p=gm(e.source===D.Source.ScreenShare,S.width,S.height,n),S.layers=qb(S.width,S.height,p,Un(n.videoCodec))}else e.kind===D.Kind.Audio&&(p=[{maxBitrate:(c=n.audioPreset)===null||c===void 0?void 0:c.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(h=(f=n.audioPreset)===null||f===void 0?void 0:f.priority)!==null&&h!==void 0?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new Ye("cannot publish track when not connected");const y=()=>E(this,void 0,void 0,function*(){var w,R,N;if(!this.engine.pcManager)throw new Ye("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,p),this.emit(B.LocalSenderCreated,e.sender,e),$i(e)&&((w=n.degradationPreference)!==null&&w!==void 0||(n.degradationPreference=E3(e)),e.setDegradationPreference(n.degradationPreference)),p)if(pr()&&e.kind===D.Kind.Audio){let z;for(const Z of this.engine.pcManager.publisher.getTransceivers())if(Z.sender===e.sender){z=Z;break}z&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:z,codec:"opus",maxbr:!((R=p[0])===null||R===void 0)&&R.maxBitrate?p[0].maxBitrate/1e3:0})}else e.codec&&Un(e.codec)&&(!((N=p[0])===null||N===void 0)&&N.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:S.cid,codec:e.codec,maxbr:p[0].maxBitrate/1e3});yield this.engine.negotiate()});let k;const _=new Promise((w,R)=>E(this,void 0,void 0,function*(){var N;try{k=yield this.engine.addTrack(S),w(k)}catch(z){e.sender&&(!((N=this.engine.pcManager)===null||N===void 0)&&N.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(Z=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),oe(e)),{error:Z}))})),R(z)}}));if(this.enabledPublishVideoCodecs.length>0)k=(yield Promise.all([_,y()]))[0];else{k=yield _;let w;if(k.codecs.forEach(R=>{w===void 0&&(w=R.mimeType)}),w&&e.kind===D.Kind.Video){const R=Uo(w);R!==g&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),oe(e)),{codec:R})),n.videoCodec=R,p=gm(e.source===D.Source.ScreenShare,S.width,S.height,n))}yield y()}const O=new bm(e.kind,k,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(O.on(V.CpuConstrained,w=>this.onTrackCpuConstrained(w,O)),O.options=n,e.sid=k.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:p,trackInfo:k})),$i(e)?e.startMonitor(this.engine.client):vi(e)&&e.startMonitor(),this.addTrackPublication(O),this.emit(B.LocalTrackPublished,O),vi(e)&&k.audioFeatures.includes(ft.TF_PRECONNECT_BUFFER)){const w=e.getPreConnectBuffer(),R=e.getPreConnectBufferMimeType();this.on(B.LocalTrackSubscribed,N=>{if(N.trackSid===k.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),oe(e))),e.stopPreConnectBuffer()}}),w&&new Promise((z,Z)=>E(this,void 0,void 0,function*(){var fe,Ge,F,G,Y,re;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),oe(e)));const Ut=setTimeout(()=>{Z(new Error("agent not active within 10 seconds"))},1e4),Jt=yield this.waitUntilActiveAgentPresent();clearTimeout(Ut),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),oe(e)));const un=yield this.streamBytes({name:"preconnect-buffer",mimeType:R,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[Jt.identity],attributes:{trackId:O.trackSid,sampleRate:String((Y=b.sampleRate)!==null&&Y!==void 0?Y:"48000"),channels:String((re=b.channelCount)!==null&&re!==void 0?re:"1")}});try{for(var Te=!0,Qt=ki(w),Rt;Rt=yield Qt.next(),fe=Rt.done,!fe;Te=!0){G=Rt.value,Te=!1;const ui=G;yield un.write(ui)}}catch(ui){Ge={error:ui}}finally{try{!Te&&!fe&&(F=Qt.return)&&(yield F.call(Qt))}finally{if(Ge)throw Ge.error}}yield un.close(),z()}catch(Ut){Z(Ut)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),oe(e)))}).catch(z=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),oe(e)),{error:z}))})}return O})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return E(this,void 0,void 0,function*(){var a;if(this.encryptionType!==Xe.NONE)return;let r;if(this.trackPublications.forEach(h=>{h.track&&h.track===e&&(r=h)}),!r)throw new Ei("track is not published");if(!$i(e))throw new Ei("track is not a video track");const s=Object.assign(Object.assign({},(a=this.roomOptions)===null||a===void 0?void 0:a.publishDefaults),i),o=T3(e,n,s);if(!o){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),oe(e)));return}const l=e.addSimulcastTrack(n,o);if(!l)return;const c=new al({cid:l.mediaStreamTrack.id,type:D.kindToProto(e.kind),muted:e.isMuted,source:D.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:s.videoCodec,cid:l.mediaStreamTrack.id}]});if(c.layers=qb(c.width,c.height,o),!this.engine||this.engine.isClosed)throw new Ye("cannot publish track when not connected");const u=()=>E(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,l,s,o),yield this.engine.negotiate()}),f=(yield Promise.all([this.engine.addTrack(c),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:o,trackInfo:f}))})}unpublishTrack(e,n){return E(this,void 0,void 0,function*(){var i,a;if(fs(e)){const c=this.pendingPublishPromises.get(e);c&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),oe(e))),yield c)}const r=this.getPublicationForTrack(e),s=r?oe(r):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),s)),!r||!r.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),s));return}e=r.track,e.off(V.Muted,this.onTrackMuted),e.off(V.Unmuted,this.onTrackUnmuted),e.off(V.Ended,this.handleTrackEnded),e.off(V.UpstreamPaused,this.onTrackUpstreamPaused),e.off(V.UpstreamResumed,this.onTrackUpstreamResumed),e.off(V.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(a=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&a!==void 0?a:!0),n?e.stop():e.stopMonitor();let o=!1;const l=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Fe.FAILED&&l)try{for(const c of this.engine.pcManager.publisher.getTransceivers())c.sender===l&&(c.direction="inactive",o=!0);if(this.engine.removeTrack(l)&&(o=!0),$i(e)){for(const[,c]of e.simulcastCodecs)c.sender&&(this.engine.removeTrack(c.sender)&&(o=!0),c.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),s),{error:c}))}switch(this.trackPublications.delete(r.trackSid),r.kind){case D.Kind.Audio:this.audioTrackPublications.delete(r.trackSid);break;case D.Kind.Video:this.videoTrackPublications.delete(r.trackSid);break}return this.emit(B.LocalTrackUnpublished,r),r.setTrack(void 0),o&&(yield this.engine.negotiate()),r})}unpublishTracks(e){return E(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return E(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new wt((r,s)=>E(i,void 0,void 0,function*(){try{const o=[];this.trackPublications.forEach(l=>{l.track&&(n&&(l.options=Object.assign(Object.assign({},l.options),n)),o.push(l))}),yield Promise.all(o.map(l=>E(this,void 0,void 0,function*(){const c=l.track;yield this.unpublishTrack(c,!1),a&&!c.isMuted&&c.source!==D.Source.ScreenShare&&c.source!==D.Source.ScreenShareAudio&&(vi(c)||$i(c))&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:l.trackSid})),yield c.restartTrack()),yield this.publishOrRepublishTrack(c,l.options,!0)}))),r()}catch(o){o instanceof Error?s(o):s(new Error(String(o)))}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return E(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const r=a.reliable?se.RELIABLE:se.LOSSY,s=a.destinationIdentities,o=a.topic;let l=new Jp({participantIdentity:i.identity,payload:n,destinationIdentities:s,topic:o});const c=new Mt({kind:r,value:{case:"user",value:l}});yield i.engine.sendDataPacket(c,r)}()})}publishDtmf(e,n){return E(this,void 0,void 0,function*(){const i=new Mt({kind:se.RELIABLE,value:{case:"sipDtmf",value:new V1({code:e,digit:n})}});yield this.engine.sendDataPacket(i,se.RELIABLE)})}sendChatMessage(e,n){return E(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},a=new Mt({value:{case:"chatMessage",value:new Su(Object.assign(Object.assign({},i),{timestamp:Be.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(a,se.RELIABLE),this.emit(B.ChatMessage,i),i})}editChatMessage(e,n){return E(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),a=new Mt({value:{case:"chatMessage",value:new Su(Object.assign(Object.assign({},i),{timestamp:Be.parse(i.timestamp),editTimestamp:Be.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(a,se.RELIABLE),this.emit(B.ChatMessage,i),i})}sendText(e,n){return E(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return E(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return E(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return E(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){let{destinationIdentity:n,method:i,payload:a,responseTimeout:r=15e3}=e;const s=7e3,o=s+1e3;return new wt((l,c)=>E(this,void 0,void 0,function*(){var u,d,f,h;if(gg(a)>iE){c(Ke.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((d=(u=this.engine.latestJoinResponse)===null||u===void 0?void 0:u.serverInfo)===null||d===void 0)&&d.version&&ni((h=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||h===void 0?void 0:h.version,"1.8.0")<0){c(Ke.builtIn("UNSUPPORTED_SERVER"));return}const v=Math.max(r,o),g=crypto.randomUUID();yield this.publishRpcRequest(n,g,i,a,v);const C=setTimeout(()=>{this.pendingAcks.delete(g),c(Ke.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(g),clearTimeout(m)},s);this.pendingAcks.set(g,{resolve:()=>{clearTimeout(C)},participantIdentity:n});const m=setTimeout(()=>{this.pendingResponses.delete(g),c(Ke.builtIn("RESPONSE_TIMEOUT"))},r);this.pendingResponses.set(g,{resolve:(b,S)=>{clearTimeout(m),this.pendingAcks.has(g)&&(this.log.warn("RPC response received before ack",g),this.pendingAcks.delete(g),clearTimeout(C)),S?c(S):l(b??"")},participantIdentity:n})}))}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const a=this.pendingResponses.get(e);a?(a.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,a,r){return E(this,void 0,void 0,function*(){const s=new Mt({destinationIdentities:[e],kind:se.RELIABLE,value:{case:"rpcRequest",value:new Xp({id:n,method:i,payload:a,responseTimeoutMs:r,version:1})}});yield this.engine.sendDataPacket(s,se.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:a}]of this.pendingResponses)i===e&&(a(null,Ke.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,a;const r=this.trackPublications.get(n.sid);if(r){const s=r.isMuted||((a=(i=r.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&a!==void 0?a:!1);s!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),oe(r)),{mutedOnServer:s})),this.engine.client.sendMuteTrack(n.sid,s))}}),!0):!1}setActiveAgent(e){var n,i,a,r;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(r=(a=this.activeAgentFuture)===null||a===void 0?void 0:a.reject)===null||r===void 0||r.call(a,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new kn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const a=i.track;a&&(e instanceof MediaStreamTrack?(vi(a)||$i(a))&&a.mediaStreamTrack===e&&(n=i):e===a&&(n=i))}),n}waitForPendingPublicationOfSource(e){return E(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const a=Array.from(this.pendingPublishPromises.entries()).find(r=>{let[s]=r;return s.source===e});if(a)return a[1];yield Ct(20)}})}}class fE extends yi{constructor(e,n,i,a){super(e,n.sid,n.name,a),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=r=>{this.setTrack(void 0),this.emit(V.Ended,r)},this.handleVisibilityChange=r=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(r),this.logContext),this.visible=r,this.emitTrackUpdate()},this.handleVideoDimensionsChange=r=>{this.log.debug("adaptivestream video dimensions ".concat(r.width,"x").concat(r.height),this.logContext),this.videoDimensionsAdaptiveStream=r,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const a=new cd({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new K1({participantSid:"",trackSids:[this.trackSid]})]});this.emit(V.UpdateSubscription,a),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?yi.SubscriptionStatus.Unsubscribed:super.isSubscribed?yi.SubscriptionStatus.Subscribed:yi.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?yi.PermissionStatus.Allowed:yi.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Mf(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Mf(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:tn.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,a=this.track;a!==e&&(a&&(a.off(V.VideoDimensionsChanged,this.handleVideoDimensionsChange),a.off(V.VisibilityChanged,this.handleVisibilityChange),a.off(V.Ended,this.handleEnded),a.detach(),a.stopMonitor(),this.emit(V.Unsubscribed,a)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(V.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(V.VisibilityChanged,this.handleVisibilityChange),e.on(V.Ended,this.handleEnded),this.emit(V.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(V.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?V.Muted:V.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(V.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(V.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Mf(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new ik({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===D.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)pb(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=cN(this.trackInfo,this.requestedMaxQuality);i&&pb(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:tn.HIGH})),e.quality=tn.HIGH)}this.emit(V.UpdateSettings,e)}}class wu extends dE{static fromParticipantInfo(e,n,i){return new wu(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,a,r,s,o){let l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:il.STANDARD;super(n,i||"",a,r,s,o,l),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(V.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),oe(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(V.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(V.SubscriptionPermissionChanged,n=>{this.emit(B.TrackSubscriptionPermissionChanged,e,n)}),e.on(V.SubscriptionStatusChanged,n=>{this.emit(B.TrackSubscriptionStatusChanged,e,n)}),e.on(V.Subscribed,n=>{this.emit(B.TrackSubscribed,n,e)}),e.on(V.Unsubscribed,n=>{this.emit(B.TrackUnsubscribed,n,e)}),e.on(V.SubscriptionFailed,n=>{this.emit(B.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:D.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,a,r,s){let o=this.getTrackPublicationBySid(n);if(o||n.startsWith("TR")||this.trackPublications.forEach(u=>{!o&&e.kind===u.kind.toString()&&(o=u)}),!o){if(s===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(B.TrackSubscriptionFailed,n);return}s===void 0&&(s=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,a,r,s-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),oe(o))),this.emit(B.TrackSubscriptionFailed,n);return}const l=e.kind==="video";let c;return l?c=new j3(e,n,a,r):c=new uE(e,n,a,this.audioContext,this.audioOutput),c.source=o.source,c.isMuted=o.isMuted,c.setMediaStream(i),c.start(),o.setTrack(c),this.volumeMap.has(o.source)&&fm(c)&&Zn(c)&&c.setVolume(this.volumeMap.get(o.source)),o}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(a=>{var r,s;let o=this.getTrackPublicationBySid(a.sid);if(o)o.updateInfo(a);else{const l=D.kindFromProto(a.type);if(!l)return;o=new fE(l,a,(r=this.signalClient.connectOptions)===null||r===void 0?void 0:r.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(s=this.loggerOptions)===null||s===void 0?void 0:s.loggerName}),o.updateInfo(a),i.set(a.sid,o);const c=Array.from(this.trackPublications.values()).find(u=>u.source===(o==null?void 0:o.source));c&&o.source!==D.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:oe(c),newTrack:oe(o)})),this.addTrackPublication(o)}n.set(a.sid,o)}),this.trackPublications.forEach(a=>{n.has(a.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),oe(a))),this.unpublishTrack(a.trackSid,!0))}),i.forEach(a=>{this.emit(B.TrackPublished,a)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:a}=i;switch(a&&(a.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case D.Kind.Audio:this.audioTrackPublications.delete(e);break;case D.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(B.TrackUnpublished,i)}setAudioOutput(e){return E(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var a;Zn(i.track)&&fm(i.track)&&n.push(i.track.setSinkId((a=e.deviceId)!==null&&a!==void 0?a:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var ge;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(ge||(ge={}));const K3=4*1e3;class zi extends oi.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,a,r,s;if(super(),n=this,this.state=ge.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=ae,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,l,c)=>E(this,void 0,void 0,function*(){var u;if(!pN())throw ti()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===ge.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(ge.Connecting),((u=this.regionUrlProvider)===null||u===void 0?void 0:u.getServerUrl().toString())!==Wk(o)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),As(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new me(o,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(v=>{var g;(g=this.regionUrlProvider)===null||g===void 0||g.setServerReportedRegions(v)}).catch(v=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:v}))}));const f=(v,g,C)=>E(this,void 0,void 0,function*(){var m,b;this.abortController&&this.abortController.abort();const S=new AbortController;this.abortController=S,d==null||d();try{if(yield hs.getInstance().getBackOffPromise(o),S.signal.aborted)throw $.cancelled("Connection attempt aborted");yield this.attemptConnection(C??o,l,c,S),this.abortController=void 0,v()}catch(p){if(this.regionUrlProvider&&p instanceof $&&p.reason!==Oe.Cancelled&&p.reason!==Oe.NotAllowed){let y=null;try{this.log.debug("Fetching next region"),y=yield this.regionUrlProvider.getNextBestRegionUrl((m=this.abortController)===null||m===void 0?void 0:m.signal)}catch(k){if(k instanceof $&&(k.status===401||k.reason===Oe.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),g(k);return}}[Oe.InternalError,Oe.ServerUnreachable,Oe.Timeout].includes(p.reason)&&(this.log.debug("Adding failed connection attempt to back off"),hs.getInstance().addFailedConnectionAttempt(o)),y&&!(!((b=this.abortController)===null||b===void 0)&&b.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(p.message,". Retrying with another region: ").concat(y),this.logContext),this.recreateEngine(),yield f(v,g,y)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Cb(p)),g(p))}else{let y=jn.UNKNOWN_REASON;p instanceof $&&(y=Cb(p)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,y),g(p)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new kn((v,g)=>{f(v,g,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,l,c,u,d,f)=>E(this,void 0,void 0,function*(){var h,v,g;const C=yield c.join(o,l,{autoSubscribe:u.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:u.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:u.websocketTimeout},f.signal,!d.singlePeerConnection);let m=C.serverInfo;if(m||(m={version:C.serverVersion,region:C.serverRegion}),this.serverInfo=m,this.log.debug("connected to Livekit Server ".concat(Object.entries(m).map(b=>{let[S,p]=b;return"".concat(S,": ").concat(p)}).join(", ")),{room:(h=C.room)===null||h===void 0?void 0:h.name,roomSid:(v=C.room)===null||v===void 0?void 0:v.sid,identity:(g=C.participant)===null||g===void 0?void 0:g.identity}),!m.version)throw new $P("unknown server version");return m.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),C}),this.applyJoinResponse=o=>{const l=o.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([l,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,l,c,u)=>E(this,void 0,void 0,function*(){var d,f;this.state===ge.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((f=this.regionUrlProvider)===null||f===void 0)&&f.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},pg),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,l,this.engine,this.connOptions,this.options,u);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(L.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const v=u.signal.aborted?$.cancelled("Signal connection aborted"):$.serverUnreachable("could not establish signal connection");throw h instanceof Error&&(v.message="".concat(v.message,": ").concat(h.message)),h instanceof $&&(v.reason=h.reason,v.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),v}if(u.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),$.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,u)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}Vt()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Vt()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(ge.Connected),this.emit(L.Connected),hs.getInstance().resetFailedConnectionAttempts(o),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return E(n,[...l],void 0,function(){var u=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var f,h,v;const g=yield u.disconnectLock.lock();try{if(u.state===ge.Disconnected){u.log.debug("already disconnected",u.logContext);return}if(u.log.info("disconnect from room",Object.assign({},u.logContext)),u.state===ge.Connecting||u.state===ge.Reconnecting||u.isResuming){const C="Abort connection attempt due to user initiated disconnect";u.log.warn(C,u.logContext),(f=u.abortController)===null||f===void 0||f.abort(C),(v=(h=u.connectFuture)===null||h===void 0?void 0:h.reject)===null||v===void 0||v.call(h,$.cancelled("Client initiated disconnect")),u.connectFuture=void 0}u.engine&&(u.engine.client.isDisconnected||(yield u.engine.client.sendLeave()),yield u.engine.close()),u.handleDisconnect(d,jn.CLIENT_INITIATED),u.engine=void 0}finally{g()}}()})},this.onPageLeave=()=>E(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>E(this,void 0,void 0,function*(){const o=[],l=Nt();if(l&&l.os==="iOS"){const c="livekit-dummy-audio-el";let u=document.getElementById(c);if(!u){u=document.createElement("audio"),u.id=c,u.autoplay=!0,u.hidden=!0;const d=Af();d.enabled=!0;const f=new MediaStream([d]);u.srcObject=f,document.addEventListener("visibilitychange",()=>{u&&(u.srcObject=document.hidden?null:f,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(u),this.once(L.Disconnected,()=>{u==null||u.remove(),u=null})}o.push(u)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(u=>{u.track&&u.track.attachedElements.forEach(d=>{o.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>E(this,void 0,void 0,function*(){const o=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(c=>{var u;(u=c.track)===null||u===void 0||u.attachedElements.forEach(d=>{o.includes(d)||o.push(d)})});yield Promise.all(o.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(ge.Reconnecting)&&this.emit(L.Reconnecting)},this.handleSignalRestarted=o=>E(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(ge.Connected),this.emit(L.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(l=>{var c;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(c=this.sidToIdentity.get(l.sid))!==null&&c!==void 0?c:"");let u=this.remoteParticipants.get(l.identity);l.state===os.DISCONNECTED?this.handleParticipantDisconnected(l.identity,u):u=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=o=>{const l=[],c={};o.forEach(u=>{if(c[u.sid]=!0,u.sid===this.localParticipant.sid)this.localParticipant.audioLevel=u.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(u.sid);d&&(d.audioLevel=u.level,d.setIsSpeaking(!0),l.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(u=>{c[u.sid]||(u.audioLevel=0,u.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(L.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=o=>{const l=new Map;this.activeSpeakers.forEach(u=>{const d=this.remoteParticipants.get(u.identity);d&&d.sid!==u.sid||l.set(u.sid,u)}),o.forEach(u=>{let d=this.getRemoteParticipantBySid(u.sid);u.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=u.level,d.setIsSpeaking(u.active),u.active?l.set(u.sid,d):l.delete(u.sid))});const c=Array.from(l.values());c.sort((u,d)=>d.audioLevel-u.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(L.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(l=>{const c=this.getRemoteParticipantBySid(l.participantSid);if(!c)return;const u=c.getTrackPublicationBySid(l.trackSid);if(!u||!u.track)return;const d=D.streamStateFromProto(l.state);u.track.setStreamState(d),d!==u.track.streamState&&(c.emit(B.TrackStreamStateChanged,u,u.track.streamState),this.emitWhenConnected(L.TrackStreamStateChanged,u,u.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const l=this.getRemoteParticipantBySid(o.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const l=Array.from(this.remoteParticipants.values()).find(u=>u.trackPublications.has(o.trackSid));if(!l)return;const c=l.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=(o,l)=>{const c=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(c,o.value.value,o.kind,l);else if(o.value.case==="transcription")this.handleTranscription(c,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(c,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(c,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,c);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,l);else if(o.value.case==="rpcRequest"){const u=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,u.id,u.method,u.payload,u.responseTimeoutMs,u.version)}},this.handleUserPacket=(o,l,c,u)=>{this.emit(L.DataReceived,l.payload,o,c,l.topic,u),o==null||o.emit(B.DataReceived,l.payload,c,u)},this.handleSipDtmf=(o,l)=>{this.emit(L.SipDTMFReceived,l,o),o==null||o.emit(B.SipDTMFReceived,l)},this.handleTranscription=(o,l)=>{const c=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),u=c==null?void 0:c.trackPublications.get(l.trackId),d=EN(l,this.transcriptionReceivedTimes);u==null||u.emit(V.TranscriptionReceived,d),c==null||c.emit(B.TranscriptionReceived,d,u),this.emit(L.TranscriptionReceived,d,c,u)},this.handleChatMessage=(o,l)=>{const c=_N(l);this.emit(L.ChatMessage,c,o)},this.handleMetrics=(o,l)=>{this.emit(L.MetricsReceived,o,l)},this.handleDataStream=(o,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(L.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(L.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(L.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(L.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>E(this,void 0,void 0,function*(){var o;((o=Nt())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(L.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const l=this.roomInfo;this.roomInfo=o,l&&l.metadata!==o.metadata&&this.emitWhenConnected(L.RoomMetadataChanged,o.metadata),(l==null?void 0:l.activeRecording)!==o.activeRecording&&this.emitWhenConnected(L.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const c=this.getRemoteParticipantBySid(l.participantSid);c&&c.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(L.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(L.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(L.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(L.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(L.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var l;(l=o==null?void 0:o.onPublish)===null||l===void 0||l.call(o,this)},this.onLocalTrackPublished=o=>E(this,void 0,void 0,function*(){var l,c,u,d,f,h;(l=o.track)===null||l===void 0||l.on(V.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(V.Restarted,this.onLocalTrackRestarted),(f=(d=(u=o.track)===null||u===void 0?void 0:u.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||f===void 0||f.call(d,this),this.emit(L.LocalTrackPublished,o,this.localParticipant),vi(o.track)&&(yield o.track.checkForSilence())&&this.emit(L.LocalAudioSilenceDetected,o);const v=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),g=lm(o.source);g&&v&&v!==this.localParticipant.activeDeviceMap.get(g)&&(this.localParticipant.activeDeviceMap.set(g,v),this.emit(L.ActiveDeviceChanged,g,v))}),this.onLocalTrackUnpublished=o=>{var l,c;(l=o.track)===null||l===void 0||l.off(V.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(V.Restarted,this.onLocalTrackRestarted),this.emit(L.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>E(this,void 0,void 0,function*(){const l=yield o.getDeviceId(!1),c=lm(o.source);c&&l&&l!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,l),this.emit(L.ActiveDeviceChanged,c,l))}),this.onLocalConnectionQualityChanged=o=>{this.emit(L.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,l)=>{this.emit(L.MediaDevicesError,o,l)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(L.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(L.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},a3),e),this.log=qi((i=this.options.loggerName)!==null&&i!==void 0?i:qn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},eE),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},tE),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},i3),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new N3,this.outgoingDataStreamManager=new U3(this.engine,this.log),this.disconnectLock=new Pt,this.localParticipant=new H3("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",wa(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",wa(this.options.audioCaptureDefaults.deviceId)),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&this.switchActiveDevice("audiooutput",wa(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),Vt()){const o=new AbortController;(s=(r=navigator.mediaDevices)===null||r===void 0?void 0:r.addEventListener)===null||s===void 0||s.call(r,"devicechange",this.handleDeviceChange,{signal:o.signal}),zi.cleanupRegistry&&zi.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return E(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new qN(i,n),this.e2eeManager.on(ma.ParticipantEncryptionStatusChanged,(a,r)=>{RN(r)&&(this.isE2EEEnabled=a),this.emit(L.ParticipantEncryptionStatusChanged,a,r)}),this.e2eeManager.on(ma.EncryptionError,(a,r)=>{const s=r?this.getParticipantByIdentity(r):void 0;this.emit(L.EncryptionError,a,s)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return this.state===ge.Disconnected?wt.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?wt.resolve(this.roomInfo.sid):new wt((e,n)=>{const i=a=>{a.sid!==""&&(this.engine.off(H.RoomUpdate,i),e(a.sid))};this.engine.on(H.RoomUpdate,i),this.once(L.Disconnected,()=>{this.engine.off(H.RoomUpdate,i),n(new Ye("Room disconnected before room server id was available"))})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new A3(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(H.ParticipantUpdate,this.handleParticipantUpdates).on(H.RoomUpdate,this.handleRoomUpdate).on(H.SpeakersChanged,this.handleSpeakersChanged).on(H.StreamStateChanged,this.handleStreamStateUpdate).on(H.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(H.SubscriptionError,this.handleSubscriptionError).on(H.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(H.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(H.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(H.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(H.DataPacketReceived,this.handleDataPacket).on(H.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(ge.SignalReconnecting)&&this.emit(L.SignalReconnecting)}).on(H.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(ge.Connected)&&this.emit(L.Reconnected)}).on(H.SignalResumed,()=>{this.bufferedEvents=[],(this.state===ge.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(H.Restarting,this.handleRestarting).on(H.SignalRestarted,this.handleSignalRestarted).on(H.Offline,()=>{this.setAndEmitConnectionState(ge.Reconnecting)&&this.emit(L.Reconnecting)}).on(H.DCBufferStatusChanged,(e,n)=>{this.emit(L.DCBufferStatusChanged,e,n)}).on(H.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:a}=i;return a===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(B.LocalTrackSubscribed,n),this.emitWhenConnected(L.LocalTrackSubscribed,n,this.localParticipant)}).on(H.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(L.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return mt.getInstance().getDevices(e,n)}prepareConnection(e,n){return E(this,void 0,void 0,function*(){if(this.state===ge.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(As(new URL(e))&&n){this.regionUrlProvider=new me(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===ge.Disconnected&&(this.regionUrl=i,yield fetch(ll(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(ll(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return E(this,void 0,void 0,function*(){let i=()=>E(this,void 0,void 0,function*(){}),a;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":a=new Gn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":a=new Gn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":a=new Gn({scenario:{case:"serverLeave",value:!0}});break;case"migration":a=new Gn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>E(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new Gn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>E(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new Gn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":a=new Gn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>E(this,void 0,void 0,function*(){const r=this.engine.client.onLeave;r&&r(new ud({reason:jn.CLIENT_INITIATED,action:ls.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");a=new Gn({scenario:{case:"subscriberBandwidth",value:Wa(n)}});break;case"leave-full-reconnect":a=new Gn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}a&&(yield this.engine.client.sendSimulateScenario(a),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return E(this,arguments,void 0,function(i,a){var r=this;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var o,l,c,u,d,f,h;let v=!0,g=!1;const C=s?{exact:a}:a;if(i==="audioinput"){g=r.localParticipant.audioTrackPublications.size===0;const m=(o=r.getActiveDevice(i))!==null&&o!==void 0?o:r.options.audioCaptureDefaults.deviceId;r.options.audioCaptureDefaults.deviceId=C;const b=Array.from(r.localParticipant.audioTrackPublications.values()).filter(p=>p.source===D.Source.Microphone);try{v=(yield Promise.all(b.map(p=>{var y;return(y=p.audioTrack)===null||y===void 0?void 0:y.setDeviceId(C)}))).every(p=>p===!0)}catch(p){throw r.options.audioCaptureDefaults.deviceId=m,p}const S=b.some(p=>{var y,k;return(k=(y=p.track)===null||y===void 0?void 0:y.isMuted)!==null&&k!==void 0?k:!1});v&&S&&(g=!0)}else if(i==="videoinput"){g=r.localParticipant.videoTrackPublications.size===0;const m=(l=r.getActiveDevice(i))!==null&&l!==void 0?l:r.options.videoCaptureDefaults.deviceId;r.options.videoCaptureDefaults.deviceId=C;const b=Array.from(r.localParticipant.videoTrackPublications.values()).filter(p=>p.source===D.Source.Camera);try{v=(yield Promise.all(b.map(p=>{var y;return(y=p.videoTrack)===null||y===void 0?void 0:y.setDeviceId(C)}))).every(p=>p===!0)}catch(p){throw r.options.videoCaptureDefaults.deviceId=m,p}const S=b.some(p=>{var y,k;return(k=(y=p.track)===null||y===void 0?void 0:y.isMuted)!==null&&k!==void 0?k:!1});v&&S&&(g=!0)}else if(i==="audiooutput"){if(g=!0,!dm()&&!r.options.webAudioMix||r.options.webAudioMix&&r.audioContext&&!("setSinkId"in r.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");r.options.webAudioMix&&(a=(c=yield mt.getInstance().normalizeDeviceId("audiooutput",a))!==null&&c!==void 0?c:""),(u=(h=r.options).audioOutput)!==null&&u!==void 0||(h.audioOutput={});const m=(d=r.getActiveDevice(i))!==null&&d!==void 0?d:r.options.audioOutput.deviceId;r.options.audioOutput.deviceId=a;try{r.options.webAudioMix&&((f=r.audioContext)===null||f===void 0||f.setSinkId(a)),yield Promise.all(Array.from(r.remoteParticipants.values()).map(b=>b.setAudioOutput({deviceId:a})))}catch(b){throw r.options.audioOutput.deviceId=m,b}}return g&&(r.localParticipant.activeDeviceMap.set(i,a),r.emit(L.ActiveDeviceChanged,i,a)),v}()})}setupLocalParticipantEvents(){this.localParticipant.on(B.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(B.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(B.AttributesChanged,this.onLocalAttributesChanged).on(B.TrackMuted,this.onLocalTrackMuted).on(B.TrackUnmuted,this.onLocalTrackUnmuted).on(B.LocalTrackPublished,this.onLocalTrackPublished).on(B.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(B.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(B.MediaDevicesError,this.onMediaDevicesError).on(B.AudioStreamAcquired,this.startAudio).on(B.ChatMessage,this.onLocalChatMessageSent).on(B.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===ge.Connecting||this.state===ge.Reconnecting){const d=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(h=>h.id)}),this.onTrackAdded(e,n,i),f()},f=()=>{this.off(L.Reconnected,d),this.off(L.Connected,d),this.off(L.Disconnected,f)};this.once(L.Reconnected,d),this.once(L.Connected,d),this.once(L.Disconnected,f);return}if(this.state===ge.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const a=fN(n.id),r=a[0];let s=a[1],o=e.id;if(s&&s.startsWith("TR")&&(o=s),r===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(d=>d.sid===r);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(r),this.logContext);return}if(!o.startsWith("TR")){const d=this.engine.getTrackIdForReceiver(i);if(!d){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(r),this.logContext);return}o=d}o.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(r,", streamId: ").concat(s,", trackId: ").concat(o),Object.assign(Object.assign({},this.logContext),{rpID:r,streamId:s,trackId:o}));let c;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?c=this.options.adaptiveStream:c={});const u=l.addSubscribedMediaTrack(e,o,n,i,c);u!=null&&u.isEncrypted&&!this.e2eeManager&&this.emit(L.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(l.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i,a;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==ge.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(r=>{r.trackPublications.forEach(s=>{r.unpublishTrack(s.trackSid)})}),this.localParticipant.trackPublications.forEach(r=>{var s,o,l;r.track&&this.localParticipant.unpublishTrack(r.track,e),e?((s=r.track)===null||s===void 0||s.detach(),(o=r.track)===null||o===void 0||o.stop()):(l=r.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(B.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(B.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(B.AttributesChanged,this.onLocalAttributesChanged).off(B.TrackMuted,this.onLocalTrackMuted).off(B.TrackUnmuted,this.onLocalTrackUnmuted).off(B.LocalTrackPublished,this.onLocalTrackPublished).off(B.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(B.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(B.MediaDevicesError,this.onMediaDevicesError).off(B.AudioStreamAcquired,this.startAudio).off(B.ChatMessage,this.onLocalChatMessageSent).off(B.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Vt()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(a=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||a===void 0||a.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(ge.Disconnected),this.emit(L.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(a=>{n.unpublishTrack(a.trackSid,!0)}),this.emit(L.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,a,r,s){return E(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),s!==1){yield this.engine.publishRpcResponse(e,n,null,Ke.builtIn("UNSUPPORTED_VERSION"));return}const o=this.rpcHandlers.get(i);if(!o){yield this.engine.publishRpcResponse(e,n,null,Ke.builtIn("UNSUPPORTED_METHOD"));return}let l=null,c=null;try{const u=yield o({requestId:n,callerIdentity:e,payload:a,responseTimeout:r});gg(u)>iE?(l=Ke.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):c=u}catch(u){u instanceof Ke?l=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),l=Ke.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,c,l)})}selectDefaultDevices(){return E(this,void 0,void 0,function*(){var e,n,i;const a=mt.getInstance().previousDevices,r=yield mt.getInstance().getDevices(void 0,!1),s=Nt();if((s==null?void 0:s.name)==="Chrome"&&s.os!=="iOS")for(let l of r){const c=a.find(u=>u.deviceId===l.deviceId);c&&c.label!==""&&c.kind===l.kind&&c.label!==l.label&&this.getActiveDevice(l.kind)==="default"&&this.emit(L.ActiveDeviceChanged,l.kind,l.deviceId)}const o=["audiooutput","audioinput","videoinput"];for(let l of o){const c=iN(l),u=this.localParticipant.getTrackPublication(c);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=r.filter(h=>h.kind===l),f=this.getActiveDevice(l);if(f===((n=a.filter(h=>h.kind===l)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==f){yield this.switchActiveDevice(l,d[0].deviceId);continue}l==="audioinput"&&!ol()||l==="videoinput"||d.length>0&&!d.find(h=>h.deviceId===this.getActiveDevice(l))&&(l!=="audiooutput"||!ol())&&(yield this.switchActiveDevice(l,d[0].deviceId))}})}acquireAudioContext(){return E(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=Qk())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(a=>a.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),Ct(200)])}catch(a){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:a}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(L.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let a;return n?a=wu.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):a=new wu(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&a.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&a.setAudioOutput(this.options.audioOutput).catch(r=>this.log.warn("Could not set audio output: ".concat(r.message),this.logContext)),a}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const a=this.remoteParticipants.get(e);return n&&a.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),a}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(L.ParticipantConnected,i),i.on(B.TrackPublished,a=>{this.emitWhenConnected(L.TrackPublished,a,i)}).on(B.TrackSubscribed,(a,r)=>{a.kind===D.Kind.Audio?(a.on(V.AudioPlaybackStarted,this.handleAudioPlaybackStarted),a.on(V.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):a.kind===D.Kind.Video&&(a.on(V.VideoPlaybackFailed,this.handleVideoPlaybackFailed),a.on(V.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(L.TrackSubscribed,a,r,i)}).on(B.TrackUnpublished,a=>{this.emit(L.TrackUnpublished,a,i)}).on(B.TrackUnsubscribed,(a,r)=>{this.emit(L.TrackUnsubscribed,a,r,i)}).on(B.TrackMuted,a=>{this.emitWhenConnected(L.TrackMuted,a,i)}).on(B.TrackUnmuted,a=>{this.emitWhenConnected(L.TrackUnmuted,a,i)}).on(B.ParticipantMetadataChanged,a=>{this.emitWhenConnected(L.ParticipantMetadataChanged,a,i)}).on(B.ParticipantNameChanged,a=>{this.emitWhenConnected(L.ParticipantNameChanged,a,i)}).on(B.AttributesChanged,a=>{this.emitWhenConnected(L.ParticipantAttributesChanged,a,i)}).on(B.ConnectionQualityChanged,a=>{this.emitWhenConnected(L.ConnectionQualityChanged,a,i)}).on(B.ParticipantPermissionsChanged,a=>{this.emitWhenConnected(L.ParticipantPermissionsChanged,a,i)}).on(B.TrackSubscriptionStatusChanged,(a,r)=>{this.emitWhenConnected(L.TrackSubscriptionStatusChanged,a,r,i)}).on(B.TrackSubscriptionFailed,(a,r)=>{this.emit(L.TrackSubscriptionFailed,a,i,r)}).on(B.TrackSubscriptionPermissionChanged,(a,r)=>{this.emitWhenConnected(L.TrackSubscriptionPermissionChanged,a,r,i)}).on(B.Active,()=>{this.emitWhenConnected(L.ParticipantActive,i),i.kind===il.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,a)=>(i.push(...a.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&wN(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=Tt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,jn.STATE_MISMATCH))):e=0},K3)}clearConnectionReconcile(){this.connectionReconcileInterval&&Tt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(L.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];if(this.state===ge.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===ge.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return E(this,void 0,void 0,function*(){var n,i,a,r;const s=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new sd({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Be.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new mr({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(L.SignalConnected),this.emit(L.Connected),this.setAndEmitConnectionState(ge.Connected),s.video){const l=new bm(D.Kind.Video,new $r({source:et.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ln.AUDIO,name:"video-dummy"}),new _u(s.useRealTracks&&(!((n=window.navigator.mediaDevices)===null||n===void 0)&&n.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Tb(160*((i=o.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(B.LocalTrackPublished,l)}if(s.audio){const l=new bm(D.Kind.Audio,new $r({source:et.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ln.AUDIO}),new Eu(s.useRealTracks&&(!((a=navigator.mediaDevices)===null||a===void 0)&&a.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:Af(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(B.LocalTrackPublished,l)}for(let l=0;l<o.count-1;l+=1){let c=new mr({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(l),state:os.ACTIVE,tracks:[],joinedAt:Be.parse(Date.now())});const u=this.getOrCreateParticipant(c.identity,c);if(o.video){const d=Tb(160*((r=o.aspectRatios[l%o.aspectRatios.length])!==null&&r!==void 0?r:1),160,!1,!0),f=new $r({source:et.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:Ln.AUDIO});u.addSubscribedMediaTrack(d,f.sid,new MediaStream([d]),new RTCRtpReceiver),c.tracks=[...c.tracks,f]}if(o.audio){const d=Af(),f=new $r({source:et.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:Ln.AUDIO});u.addSubscribedMediaTrack(d,f.sid,new MediaStream([d]),new RTCRtpReceiver),c.tracks=[...c.tracks,f]}u.updateInfo(c)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];if(e!==L.ActiveSpeakersChanged&&e!==L.TranscriptionReceived){const r=hE(i).filter(s=>s!==void 0);(e===L.TrackSubscribed||e===L.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:r})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:r}))}return super.emit(e,...i)}}zi.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function hE(t){return t.map(e=>{if(e)return Array.isArray(e)?hE(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Nn;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Nn||(Nn={}));class Fa extends oi.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Nn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new zi(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return E(this,void 0,void 0,function*(){if(this.status!==Nn.IDLE)throw Error("check is running already");this.setStatus(Nn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Nn.SKIPPED&&this.setStatus(this.isSuccess()?Nn.SUCCESS:Nn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return E(this,void 0,void 0,function*(){return this.room.state===ge.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return E(this,void 0,void 0,function*(){this.room&&this.room.state!==ge.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Nn.SKIPPED)}switchProtocol(e){return E(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(L.Reconnecting,()=>{n=!0}),this.room.once(L.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(r=>setTimeout(r,1e3)),!n)return;const a=Date.now()+1e4;for(;Date.now()<a;){if(i)return;yield Ct(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class G3 extends Fa{get description(){return"Cloud regions"}perform(){return E(this,void 0,void 0,function*(){const e=new me(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let r=0;r<3;r++){const s=yield e.getNextBestRegionUrl();if(!s)break;if(i.has(s))continue;i.add(s);const o=yield this.checkCloudRegion(s);this.appendMessage("".concat(o.region," RTT: ").concat(o.rtt,"ms, duration: ").concat(o.duration,"ms")),n.push(o)}n.sort((r,s)=>(r.duration-s.duration)*.5+(r.rtt-s.rtt)*.5);const a=n[0];this.bestStats=a,this.appendMessage("best Cloud region: ".concat(a.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return E(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const a=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!a)throw new Error("Region not found");const r=yield this.room.localParticipant.streamText({topic:"test"}),s=1e3,l=1e6/s,c="A".repeat(s),u=Date.now();for(let v=0;v<l;v++)yield r.write(c);yield r.close();const d=Date.now(),f=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),h={region:a,rtt:1e4,duration:d-u};return f==null||f.forEach(v=>{v.type==="candidate-pair"&&v.nominated&&(h.rtt=v.currentRoundTripTime*1e3)}),yield this.disconnect(),h})}}const Bf=1e4;class Y3 extends Fa{get description(){return"Connection via UDP vs TCP"}perform(){return E(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(Bf/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(Bf/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return E(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let a=0;const r=()=>{a=(a+1)%360,i.fillStyle="hsl(".concat(a,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(r)};r();const o=n.captureStream(30).getVideoTracks()[0],c=(yield this.room.localParticipant.publishTrack(o,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>E(this,void 0,void 0,function*(){const f=yield c.getRTCStatsReport();f==null||f.forEach(h=>{h.type==="outbound-rtp"?(u.packetsSent=h.packetsSent,u.qualityLimitationDurations=h.qualityLimitationDurations,u.bitrateTotal+=h.targetBitrate,u.count++):h.type==="remote-inbound-rtp"&&(u.packetsLost=h.packetsLost,u.rttTotal+=h.roundTripTime,u.jitterTotal+=h.jitter)})}),1e3);return yield new Promise(f=>setTimeout(f,Bf)),clearInterval(d),o.stop(),n.remove(),yield this.disconnect(),u})}}class Q3 extends Fa{get description(){return"Can publish audio"}perform(){return E(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield z3();if(yield Yk(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,3e3));const r=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!r)throw new Error("Could not get RTCStats");let s=0;if(r.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="audio"||!o.kind&&o.mediaType==="audio")&&(s=o.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," audio packets"))})}}class J3 extends Fa{get description(){return"Can publish video"}perform(){return E(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield q3();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(s=>setTimeout(s,5e3));const a=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!a)throw new Error("Could not get RTCStats");let r=0;if(a.forEach(s=>{s.type==="outbound-rtp"&&(s.kind==="video"||!s.kind&&s.mediaType==="video")&&(r+=s.packetsSent)}),r===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," video packets"))})}checkForVideo(e){return E(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(a=>{i.onplay=()=>{setTimeout(()=>{var r,s,o,l;const c=document.createElement("canvas"),u=e.getSettings(),d=(s=(r=u.width)!==null&&r!==void 0?r:i.videoWidth)!==null&&s!==void 0?s:1280,f=(l=(o=u.height)!==null&&o!==void 0?o:i.videoHeight)!==null&&l!==void 0?l:720;c.width=d,c.height=f;const h=c.getContext("2d");h.drawImage(i,0,0);const g=h.getImageData(0,0,c.width,c.height).data;let C=!0;for(let m=0;m<g.length;m+=4)if(g[m]!==0||g[m+1]!==0||g[m+2]!==0){C=!1;break}C?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),a()},1e3)},i.play()}),n.getTracks().forEach(a=>a.stop()),i.remove()})}}class X3 extends Fa{get description(){return"Resuming connection after interruption"}perform(){return E(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,a=!1,r;const s=new Promise(c=>{setTimeout(c,5e3),r=c}),o=()=>{i=!0};n.on(L.SignalReconnecting,o).on(L.Reconnecting,o).on(L.Reconnected,()=>{a=!0,r(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const l=n.engine.client.onClose;if(l&&l(""),yield s,i){if(!a||n.state!==ge.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class $3 extends Fa{get description(){return"Can connect via TURN"}perform(){return E(this,void 0,void 0,function*(){var e,n,i;As(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new me(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const a=new dg,r=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let s=!1,o=!1,l=!1;for(let c of r.iceServers)for(let u of c.urls)u.startsWith("turn:")?(o=!0,l=!0):u.startsWith("turns:")&&(o=!0,l=!0,s=!0),u.startsWith("stun:")&&(l=!0);l?o&&!s&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield a.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class Z3 extends Fa{get description(){return"Establishing WebRTC connection"}perform(){return E(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(L.SignalConnected,()=>{var i;const a=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(r,s)=>{if(r.candidate){const o=new RTCIceCandidate(r);let l="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(W3(o.address)?l+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,l+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(l)}a&&a(r,s)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=r=>{r instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(r.errorCode," ").concat(r.errorText," ").concat(r.url))})});try{yield this.connect(),ae.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function W3(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class eL extends Fa{get description(){return"Connecting to signal connection via WebSocket"}perform(){return E(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let a=new dg,r;try{r=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(s){if(As(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(s.message,". Retrying with region fallback"));const l=yield new me(this.url,this.token).getNextBestRegionUrl();l&&(r=yield a.join(l,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}r?(this.appendMessage("Connected to server, version ".concat(r.serverVersion,".")),((e=r.serverInfo)===null||e===void 0?void 0:e.edition)===Y1.Cloud&&(!((n=r.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=r.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield a.close()})}}class q5 extends oi.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Nn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Nn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return E(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),a=s=>{this.updateCheck(n,s)};i.on("update",a);const r=yield i.run();return i.off("update",a),r})}checkWebsocket(){return E(this,void 0,void 0,function*(){return this.createAndRunCheck(eL)})}checkWebRTC(){return E(this,void 0,void 0,function*(){return this.createAndRunCheck(Z3)})}checkTURN(){return E(this,void 0,void 0,function*(){return this.createAndRunCheck($3)})}checkReconnect(){return E(this,void 0,void 0,function*(){return this.createAndRunCheck(X3)})}checkPublishAudio(){return E(this,void 0,void 0,function*(){return this.createAndRunCheck(Q3)})}checkPublishVideo(){return E(this,void 0,void 0,function*(){return this.createAndRunCheck(J3)})}checkConnectionProtocol(){return E(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(Y3);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return E(this,void 0,void 0,function*(){return this.createAndRunCheck(G3)})}}function ue(t,e,n){return(e=nL(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tL(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function nL(t){var e=tL(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class It extends Error{constructor(e,n){var i;super(e,n),ue(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}ue(It,"code","ERR_JOSE_GENERIC");class iL extends It{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:a,payload:n}}),ue(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),ue(this,"claim",void 0),ue(this,"reason",void 0),ue(this,"payload",void 0),this.claim=i,this.reason=a,this.payload=n}}ue(iL,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class aL extends It{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:a,payload:n}}),ue(this,"code","ERR_JWT_EXPIRED"),ue(this,"claim",void 0),ue(this,"reason",void 0),ue(this,"payload",void 0),this.claim=i,this.reason=a,this.payload=n}}ue(aL,"code","ERR_JWT_EXPIRED");class rL extends It{constructor(){super(...arguments),ue(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}ue(rL,"code","ERR_JOSE_ALG_NOT_ALLOWED");class sL extends It{constructor(){super(...arguments),ue(this,"code","ERR_JOSE_NOT_SUPPORTED")}}ue(sL,"code","ERR_JOSE_NOT_SUPPORTED");class oL extends It{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ue(this,"code","ERR_JWE_DECRYPTION_FAILED")}}ue(oL,"code","ERR_JWE_DECRYPTION_FAILED");class lL extends It{constructor(){super(...arguments),ue(this,"code","ERR_JWE_INVALID")}}ue(lL,"code","ERR_JWE_INVALID");class cL extends It{constructor(){super(...arguments),ue(this,"code","ERR_JWS_INVALID")}}ue(cL,"code","ERR_JWS_INVALID");class uL extends It{constructor(){super(...arguments),ue(this,"code","ERR_JWT_INVALID")}}ue(uL,"code","ERR_JWT_INVALID");class dL extends It{constructor(){super(...arguments),ue(this,"code","ERR_JWK_INVALID")}}ue(dL,"code","ERR_JWK_INVALID");class fL extends It{constructor(){super(...arguments),ue(this,"code","ERR_JWKS_INVALID")}}ue(fL,"code","ERR_JWKS_INVALID");class hL extends It{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ue(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}ue(hL,"code","ERR_JWKS_NO_MATCHING_KEY");class mL extends It{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),ue(this,Symbol.asyncIterator,void 0),ue(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}ue(mL,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class pL extends It{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),ue(this,"code","ERR_JWKS_TIMEOUT")}}ue(pL,"code","ERR_JWKS_TIMEOUT");class gL extends It{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),ue(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}ue(gL,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");var Kb;(function(t){t[t.Reserved=0]="Reserved",t[t.TooLarge=1]="TooLarge"})(Kb||(Kb={}));var Gb;(function(t){t[t.TooShort=0]="TooShort",t[t.HeaderOverrun=1]="HeaderOverrun",t[t.MissingExtWords=2]="MissingExtWords",t[t.UnsupportedVersion=3]="UnsupportedVersion",t[t.InvalidHandle=4]="InvalidHandle",t[t.MalformedExt=5]="MalformedExt"})(Gb||(Gb={}));var Yb;(function(t){t[t.TooSmallForHeader=0]="TooSmallForHeader",t[t.TooSmallForPayload=1]="TooSmallForPayload"})(Yb||(Yb={}));var Ru;(function(t){t[t.UserTimestamp=2]="UserTimestamp",t[t.E2ee=1]="E2ee"})(Ru||(Ru={}));Ru.UserTimestamp;Ru.E2ee;var Qb;(function(t){t[t.Start=0]="Start",t[t.Inter=1]="Inter",t[t.Final=2]="Final",t[t.Single=3]="Single"})(Qb||(Qb={}));const xu=Math.min,sr=Math.max,Ou=Math.round,tc=Math.floor,Wn=t=>({x:t,y:t}),vL={left:"right",right:"left",bottom:"top",top:"bottom"},bL={start:"end",end:"start"};function Jb(t,e,n){return sr(t,xu(e,n))}function md(t,e){return typeof t=="function"?t(e):t}function vr(t){return t.split("-")[0]}function pd(t){return t.split("-")[1]}function mE(t){return t==="x"?"y":"x"}function pE(t){return t==="y"?"height":"width"}const yL=new Set(["top","bottom"]);function pa(t){return yL.has(vr(t))?"y":"x"}function gE(t){return mE(pa(t))}function SL(t,e,n){n===void 0&&(n=!1);const i=pd(t),a=gE(t),r=pE(a);let s=a==="x"?i===(n?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(s=Au(s)),[s,Au(s)]}function TL(t){const e=Au(t);return[ym(t),e,ym(e)]}function ym(t){return t.replace(/start|end/g,e=>bL[e])}const Xb=["left","right"],$b=["right","left"],CL=["top","bottom"],kL=["bottom","top"];function EL(t,e,n){switch(t){case"top":case"bottom":return n?e?$b:Xb:e?Xb:$b;case"left":case"right":return e?CL:kL;default:return[]}}function _L(t,e,n,i){const a=pd(t);let r=EL(vr(t),n==="start",i);return a&&(r=r.map(s=>s+"-"+a),e&&(r=r.concat(r.map(ym)))),r}function Au(t){return t.replace(/left|right|bottom|top/g,e=>vL[e])}function wL(t){return{top:0,right:0,bottom:0,left:0,...t}}function RL(t){return typeof t!="number"?wL(t):{top:t,right:t,bottom:t,left:t}}function Mu(t){const{x:e,y:n,width:i,height:a}=t;return{width:i,height:a,top:n,left:e,right:e+i,bottom:n+a,x:e,y:n}}function Zb(t,e,n){let{reference:i,floating:a}=t;const r=pa(e),s=gE(e),o=pE(s),l=vr(e),c=r==="y",u=i.x+i.width/2-a.width/2,d=i.y+i.height/2-a.height/2,f=i[o]/2-a[o]/2;let h;switch(l){case"top":h={x:u,y:i.y-a.height};break;case"bottom":h={x:u,y:i.y+i.height};break;case"right":h={x:i.x+i.width,y:d};break;case"left":h={x:i.x-a.width,y:d};break;default:h={x:i.x,y:i.y}}switch(pd(e)){case"start":h[s]-=f*(n&&c?-1:1);break;case"end":h[s]+=f*(n&&c?-1:1);break}return h}const xL=async(t,e,n)=>{const{placement:i="bottom",strategy:a="absolute",middleware:r=[],platform:s}=n,o=r.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(e));let c=await s.getElementRects({reference:t,floating:e,strategy:a}),{x:u,y:d}=Zb(c,i,l),f=i,h={},v=0;for(let g=0;g<o.length;g++){const{name:C,fn:m}=o[g],{x:b,y:S,data:p,reset:y}=await m({x:u,y:d,initialPlacement:i,placement:f,strategy:a,middlewareData:h,rects:c,platform:s,elements:{reference:t,floating:e}});u=b??u,d=S??d,h={...h,[C]:{...h[C],...p}},y&&v<=50&&(v++,typeof y=="object"&&(y.placement&&(f=y.placement),y.rects&&(c=y.rects===!0?await s.getElementRects({reference:t,floating:e,strategy:a}):y.rects),{x:u,y:d}=Zb(c,f,l)),g=-1)}return{x:u,y:d,placement:f,strategy:a,middlewareData:h}};async function vE(t,e){var n;e===void 0&&(e={});const{x:i,y:a,platform:r,rects:s,elements:o,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:h=0}=md(e,t),v=RL(h),g=o[f?d==="floating"?"reference":"floating":d],C=Mu(await r.getClippingRect({element:(n=await(r.isElement==null?void 0:r.isElement(g)))==null||n?g:g.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(o.floating)),boundary:c,rootBoundary:u,strategy:l})),m=d==="floating"?{x:i,y:a,width:s.floating.width,height:s.floating.height}:s.reference,b=await(r.getOffsetParent==null?void 0:r.getOffsetParent(o.floating)),S=await(r.isElement==null?void 0:r.isElement(b))?await(r.getScale==null?void 0:r.getScale(b))||{x:1,y:1}:{x:1,y:1},p=Mu(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:m,offsetParent:b,strategy:l}):m);return{top:(C.top-p.top+v.top)/S.y,bottom:(p.bottom-C.bottom+v.bottom)/S.y,left:(C.left-p.left+v.left)/S.x,right:(p.right-C.right+v.right)/S.x}}const OL=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,i;const{placement:a,middlewareData:r,rects:s,initialPlacement:o,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:f,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:g=!0,...C}=md(t,e);if((n=r.arrow)!=null&&n.alignmentOffset)return{};const m=vr(a),b=pa(o),S=vr(o)===o,p=await(l.isRTL==null?void 0:l.isRTL(c.floating)),y=f||(S||!g?[Au(o)]:TL(o)),k=v!=="none";!f&&k&&y.push(..._L(o,g,v,p));const _=[o,...y],O=await vE(e,C),w=[];let R=((i=r.flip)==null?void 0:i.overflows)||[];if(u&&w.push(O[m]),d){const fe=SL(a,s,p);w.push(O[fe[0]],O[fe[1]])}if(R=[...R,{placement:a,overflows:w}],!w.every(fe=>fe<=0)){var N,z;const fe=(((N=r.flip)==null?void 0:N.index)||0)+1,Ge=_[fe];if(Ge&&(!(d==="alignment"&&b!==pa(Ge))||R.every(G=>pa(G.placement)===b?G.overflows[0]>0:!0)))return{data:{index:fe,overflows:R},reset:{placement:Ge}};let F=(z=R.filter(G=>G.overflows[0]<=0).sort((G,Y)=>G.overflows[1]-Y.overflows[1])[0])==null?void 0:z.placement;if(!F)switch(h){case"bestFit":{var Z;const G=(Z=R.filter(Y=>{if(k){const re=pa(Y.placement);return re===b||re==="y"}return!0}).map(Y=>[Y.placement,Y.overflows.filter(re=>re>0).reduce((re,Te)=>re+Te,0)]).sort((Y,re)=>Y[1]-re[1])[0])==null?void 0:Z[0];G&&(F=G);break}case"initialPlacement":F=o;break}if(a!==F)return{reset:{placement:F}}}return{}}}},AL=new Set(["left","top"]);async function ML(t,e){const{placement:n,platform:i,elements:a}=t,r=await(i.isRTL==null?void 0:i.isRTL(a.floating)),s=vr(n),o=pd(n),l=pa(n)==="y",c=AL.has(s)?-1:1,u=r&&l?-1:1,d=md(e,t);let{mainAxis:f,crossAxis:h,alignmentAxis:v}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:d.mainAxis||0,crossAxis:d.crossAxis||0,alignmentAxis:d.alignmentAxis};return o&&typeof v=="number"&&(h=o==="end"?v*-1:v),l?{x:h*u,y:f*c}:{x:f*c,y:h*u}}const DL=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,i;const{x:a,y:r,placement:s,middlewareData:o}=e,l=await ML(e,t);return s===((n=o.offset)==null?void 0:n.placement)&&(i=o.arrow)!=null&&i.alignmentOffset?{}:{x:a+l.x,y:r+l.y,data:{...l,placement:s}}}}},PL=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:i,placement:a}=e,{mainAxis:r=!0,crossAxis:s=!1,limiter:o={fn:C=>{let{x:m,y:b}=C;return{x:m,y:b}}},...l}=md(t,e),c={x:n,y:i},u=await vE(e,l),d=pa(vr(a)),f=mE(d);let h=c[f],v=c[d];if(r){const C=f==="y"?"top":"left",m=f==="y"?"bottom":"right",b=h+u[C],S=h-u[m];h=Jb(b,h,S)}if(s){const C=d==="y"?"top":"left",m=d==="y"?"bottom":"right",b=v+u[C],S=v-u[m];v=Jb(b,v,S)}const g=o.fn({...e,[f]:h,[d]:v});return{...g,data:{x:g.x-n,y:g.y-i,enabled:{[f]:r,[d]:s}}}}}};function gd(){return typeof window<"u"}function Hs(t){return bE(t)?(t.nodeName||"").toLowerCase():"#document"}function on(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function li(t){var e;return(e=(bE(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function bE(t){return gd()?t instanceof Node||t instanceof on(t).Node:!1}function zn(t){return gd()?t instanceof Element||t instanceof on(t).Element:!1}function ii(t){return gd()?t instanceof HTMLElement||t instanceof on(t).HTMLElement:!1}function Wb(t){return!gd()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof on(t).ShadowRoot}const NL=new Set(["inline","contents"]);function Rl(t){const{overflow:e,overflowX:n,overflowY:i,display:a}=Fn(t);return/auto|scroll|overlay|hidden|clip/.test(e+i+n)&&!NL.has(a)}const LL=new Set(["table","td","th"]);function IL(t){return LL.has(Hs(t))}const UL=[":popover-open",":modal"];function vd(t){return UL.some(e=>{try{return t.matches(e)}catch{return!1}})}const jL=["transform","translate","scale","rotate","perspective"],BL=["transform","translate","scale","rotate","perspective","filter"],qL=["paint","layout","strict","content"];function yg(t){const e=Sg(),n=zn(t)?Fn(t):t;return jL.some(i=>n[i]?n[i]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||BL.some(i=>(n.willChange||"").includes(i))||qL.some(i=>(n.contain||"").includes(i))}function zL(t){let e=La(t);for(;ii(e)&&!Ms(e);){if(yg(e))return e;if(vd(e))return null;e=La(e)}return null}function Sg(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const FL=new Set(["html","body","#document"]);function Ms(t){return FL.has(Hs(t))}function Fn(t){return on(t).getComputedStyle(t)}function bd(t){return zn(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function La(t){if(Hs(t)==="html")return t;const e=t.assignedSlot||t.parentNode||Wb(t)&&t.host||li(t);return Wb(e)?e.host:e}function yE(t){const e=La(t);return Ms(e)?t.ownerDocument?t.ownerDocument.body:t.body:ii(e)&&Rl(e)?e:yE(e)}function cl(t,e,n){var i;e===void 0&&(e=[]),n===void 0&&(n=!0);const a=yE(t),r=a===((i=t.ownerDocument)==null?void 0:i.body),s=on(a);if(r){const o=Sm(s);return e.concat(s,s.visualViewport||[],Rl(a)?a:[],o&&n?cl(o):[])}return e.concat(a,cl(a,[],n))}function Sm(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function SE(t){const e=Fn(t);let n=parseFloat(e.width)||0,i=parseFloat(e.height)||0;const a=ii(t),r=a?t.offsetWidth:n,s=a?t.offsetHeight:i,o=Ou(n)!==r||Ou(i)!==s;return o&&(n=r,i=s),{width:n,height:i,$:o}}function Tg(t){return zn(t)?t:t.contextElement}function ps(t){const e=Tg(t);if(!ii(e))return Wn(1);const n=e.getBoundingClientRect(),{width:i,height:a,$:r}=SE(e);let s=(r?Ou(n.width):n.width)/i,o=(r?Ou(n.height):n.height)/a;return(!s||!Number.isFinite(s))&&(s=1),(!o||!Number.isFinite(o))&&(o=1),{x:s,y:o}}const VL=Wn(0);function TE(t){const e=on(t);return!Sg()||!e.visualViewport?VL:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function HL(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==on(t)?!1:e}function br(t,e,n,i){e===void 0&&(e=!1),n===void 0&&(n=!1);const a=t.getBoundingClientRect(),r=Tg(t);let s=Wn(1);e&&(i?zn(i)&&(s=ps(i)):s=ps(t));const o=HL(r,n,i)?TE(r):Wn(0);let l=(a.left+o.x)/s.x,c=(a.top+o.y)/s.y,u=a.width/s.x,d=a.height/s.y;if(r){const f=on(r),h=i&&zn(i)?on(i):i;let v=f,g=Sm(v);for(;g&&i&&h!==v;){const C=ps(g),m=g.getBoundingClientRect(),b=Fn(g),S=m.left+(g.clientLeft+parseFloat(b.paddingLeft))*C.x,p=m.top+(g.clientTop+parseFloat(b.paddingTop))*C.y;l*=C.x,c*=C.y,u*=C.x,d*=C.y,l+=S,c+=p,v=on(g),g=Sm(v)}}return Mu({width:u,height:d,x:l,y:c})}function yd(t,e){const n=bd(t).scrollLeft;return e?e.left+n:br(li(t)).left+n}function CE(t,e){const n=t.getBoundingClientRect(),i=n.left+e.scrollLeft-yd(t,n),a=n.top+e.scrollTop;return{x:i,y:a}}function KL(t){let{elements:e,rect:n,offsetParent:i,strategy:a}=t;const r=a==="fixed",s=li(i),o=e?vd(e.floating):!1;if(i===s||o&&r)return n;let l={scrollLeft:0,scrollTop:0},c=Wn(1);const u=Wn(0),d=ii(i);if((d||!d&&!r)&&((Hs(i)!=="body"||Rl(s))&&(l=bd(i)),ii(i))){const h=br(i);c=ps(i),u.x=h.x+i.clientLeft,u.y=h.y+i.clientTop}const f=s&&!d&&!r?CE(s,l):Wn(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+u.x+f.x,y:n.y*c.y-l.scrollTop*c.y+u.y+f.y}}function GL(t){return Array.from(t.getClientRects())}function YL(t){const e=li(t),n=bd(t),i=t.ownerDocument.body,a=sr(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),r=sr(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight);let s=-n.scrollLeft+yd(t);const o=-n.scrollTop;return Fn(i).direction==="rtl"&&(s+=sr(e.clientWidth,i.clientWidth)-a),{width:a,height:r,x:s,y:o}}const ey=25;function QL(t,e){const n=on(t),i=li(t),a=n.visualViewport;let r=i.clientWidth,s=i.clientHeight,o=0,l=0;if(a){r=a.width,s=a.height;const u=Sg();(!u||u&&e==="fixed")&&(o=a.offsetLeft,l=a.offsetTop)}const c=yd(i);if(c<=0){const u=i.ownerDocument,d=u.body,f=getComputedStyle(d),h=u.compatMode==="CSS1Compat"&&parseFloat(f.marginLeft)+parseFloat(f.marginRight)||0,v=Math.abs(i.clientWidth-d.clientWidth-h);v<=ey&&(r-=v)}else c<=ey&&(r+=c);return{width:r,height:s,x:o,y:l}}const JL=new Set(["absolute","fixed"]);function XL(t,e){const n=br(t,!0,e==="fixed"),i=n.top+t.clientTop,a=n.left+t.clientLeft,r=ii(t)?ps(t):Wn(1),s=t.clientWidth*r.x,o=t.clientHeight*r.y,l=a*r.x,c=i*r.y;return{width:s,height:o,x:l,y:c}}function ty(t,e,n){let i;if(e==="viewport")i=QL(t,n);else if(e==="document")i=YL(li(t));else if(zn(e))i=XL(e,n);else{const a=TE(t);i={x:e.x-a.x,y:e.y-a.y,width:e.width,height:e.height}}return Mu(i)}function kE(t,e){const n=La(t);return n===e||!zn(n)||Ms(n)?!1:Fn(n).position==="fixed"||kE(n,e)}function $L(t,e){const n=e.get(t);if(n)return n;let i=cl(t,[],!1).filter(o=>zn(o)&&Hs(o)!=="body"),a=null;const r=Fn(t).position==="fixed";let s=r?La(t):t;for(;zn(s)&&!Ms(s);){const o=Fn(s),l=yg(s);!l&&o.position==="fixed"&&(a=null),(r?!l&&!a:!l&&o.position==="static"&&a&&JL.has(a.position)||Rl(s)&&!l&&kE(t,s))?i=i.filter(c=>c!==s):a=o,s=La(s)}return e.set(t,i),i}function ZL(t){let{element:e,boundary:n,rootBoundary:i,strategy:a}=t;const r=[...n==="clippingAncestors"?vd(e)?[]:$L(e,this._c):[].concat(n),i],s=r[0],o=r.reduce((l,c)=>{const u=ty(e,c,a);return l.top=sr(u.top,l.top),l.right=xu(u.right,l.right),l.bottom=xu(u.bottom,l.bottom),l.left=sr(u.left,l.left),l},ty(e,s,a));return{width:o.right-o.left,height:o.bottom-o.top,x:o.left,y:o.top}}function WL(t){const{width:e,height:n}=SE(t);return{width:e,height:n}}function eI(t,e,n){const i=ii(e),a=li(e),r=n==="fixed",s=br(t,!0,r,e);let o={scrollLeft:0,scrollTop:0};const l=Wn(0);function c(){l.x=yd(a)}if(i||!i&&!r)if((Hs(e)!=="body"||Rl(a))&&(o=bd(e)),i){const h=br(e,!0,r,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else a&&c();r&&!i&&a&&c();const u=a&&!i&&!r?CE(a,o):Wn(0),d=s.left+o.scrollLeft-l.x-u.x,f=s.top+o.scrollTop-l.y-u.y;return{x:d,y:f,width:s.width,height:s.height}}function qf(t){return Fn(t).position==="static"}function ny(t,e){if(!ii(t)||Fn(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return li(t)===n&&(n=n.ownerDocument.body),n}function EE(t,e){const n=on(t);if(vd(t))return n;if(!ii(t)){let a=La(t);for(;a&&!Ms(a);){if(zn(a)&&!qf(a))return a;a=La(a)}return n}let i=ny(t,e);for(;i&&IL(i)&&qf(i);)i=ny(i,e);return i&&Ms(i)&&qf(i)&&!yg(i)?n:i||zL(t)||n}const tI=async function(t){const e=this.getOffsetParent||EE,n=this.getDimensions,i=await n(t.floating);return{reference:eI(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function nI(t){return Fn(t).direction==="rtl"}const iI={convertOffsetParentRelativeRectToViewportRelativeRect:KL,getDocumentElement:li,getClippingRect:ZL,getOffsetParent:EE,getElementRects:tI,getClientRects:GL,getDimensions:WL,getScale:ps,isElement:zn,isRTL:nI};function _E(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function aI(t,e){let n=null,i;const a=li(t);function r(){var o;clearTimeout(i),(o=n)==null||o.disconnect(),n=null}function s(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),r();const c=t.getBoundingClientRect(),{left:u,top:d,width:f,height:h}=c;if(o||e(),!f||!h)return;const v=tc(d),g=tc(a.clientWidth-(u+f)),C=tc(a.clientHeight-(d+h)),m=tc(u),b={rootMargin:-v+"px "+-g+"px "+-C+"px "+-m+"px",threshold:sr(0,xu(1,l))||1};let S=!0;function p(y){const k=y[0].intersectionRatio;if(k!==l){if(!S)return s();k?s(!1,k):i=setTimeout(()=>{s(!1,1e-7)},1e3)}k===1&&!_E(c,t.getBoundingClientRect())&&s(),S=!1}try{n=new IntersectionObserver(p,{...b,root:a.ownerDocument})}catch{n=new IntersectionObserver(p,b)}n.observe(t)}return s(!0),r}function rI(t,e,n,i){i===void 0&&(i={});const{ancestorScroll:a=!0,ancestorResize:r=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=i,c=Tg(t),u=a||r?[...c?cl(c):[],...cl(e)]:[];u.forEach(m=>{a&&m.addEventListener("scroll",n,{passive:!0}),r&&m.addEventListener("resize",n)});const d=c&&o?aI(c,n):null;let f=-1,h=null;s&&(h=new ResizeObserver(m=>{let[b]=m;b&&b.target===c&&h&&(h.unobserve(e),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{var S;(S=h)==null||S.observe(e)})),n()}),c&&!l&&h.observe(c),h.observe(e));let v,g=l?br(t):null;l&&C();function C(){const m=br(t);g&&!_E(g,m)&&n(),g=m,v=requestAnimationFrame(C)}return n(),()=>{var m;u.forEach(b=>{a&&b.removeEventListener("scroll",n),r&&b.removeEventListener("resize",n)}),d==null||d(),(m=h)==null||m.disconnect(),h=null,l&&cancelAnimationFrame(v)}}const sI=DL,oI=PL,lI=OL,cI=(t,e,n)=>{const i=new Map,a={platform:iI,...n},r={...a.platform,_c:i};return xL(t,e,{...a,platform:r})};var nc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function uI(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Tm={exports:{}},dI=Tm.exports,iy;function fI(){return iy||(iy=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(dI,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],r={},s=null;function o(g,C){var m=g[C];if(typeof m.bind=="function")return m.bind(g);try{return Function.prototype.bind.call(m,g)}catch{return function(){return Function.prototype.apply.apply(m,[g,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(g){return g==="debug"&&(g="log"),typeof console===n?!1:g==="trace"&&i?l:console[g]!==void 0?o(console,g):console.log!==void 0?o(console,"log"):e}function u(){for(var g=this.getLevel(),C=0;C<a.length;C++){var m=a[C];this[m]=C<g?e:this.methodFactory(m,g,this.name)}if(this.log=this.debug,typeof console===n&&g<this.levels.SILENT)return"No console available for logging"}function d(g){return function(){typeof console!==n&&(u.call(this),this[g].apply(this,arguments))}}function f(g,C,m){return c(g)||d.apply(this,arguments)}function h(g,C){var m=this,b,S,p,y="loglevel";typeof g=="string"?y+=":"+g:typeof g=="symbol"&&(y=void 0);function k(N){var z=(a[N]||"silent").toUpperCase();if(!(typeof window===n||!y)){try{window.localStorage[y]=z;return}catch{}try{window.document.cookie=encodeURIComponent(y)+"="+z+";"}catch{}}}function _(){var N;if(!(typeof window===n||!y)){try{N=window.localStorage[y]}catch{}if(typeof N===n)try{var z=window.document.cookie,Z=encodeURIComponent(y),fe=z.indexOf(Z+"=");fe!==-1&&(N=/^([^;]+)/.exec(z.slice(fe+Z.length+1))[1])}catch{}return m.levels[N]===void 0&&(N=void 0),N}}function O(){if(!(typeof window===n||!y)){try{window.localStorage.removeItem(y)}catch{}try{window.document.cookie=encodeURIComponent(y)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function w(N){var z=N;if(typeof z=="string"&&m.levels[z.toUpperCase()]!==void 0&&(z=m.levels[z.toUpperCase()]),typeof z=="number"&&z>=0&&z<=m.levels.SILENT)return z;throw new TypeError("log.setLevel() called with invalid level: "+N)}m.name=g,m.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},m.methodFactory=C||f,m.getLevel=function(){return p??S??b},m.setLevel=function(N,z){return p=w(N),z!==!1&&k(p),u.call(m)},m.setDefaultLevel=function(N){S=w(N),_()||m.setLevel(N,!1)},m.resetLevel=function(){p=null,O(),u.call(m)},m.enableAll=function(N){m.setLevel(m.levels.TRACE,N)},m.disableAll=function(N){m.setLevel(m.levels.SILENT,N)},m.rebuild=function(){if(s!==m&&(b=w(s.getLevel())),u.call(m),s===m)for(var N in r)r[N].rebuild()},b=w(s?s.getLevel():"WARN");var R=_();R!=null&&(p=w(R)),u.call(m)}s=new h,s.getLogger=function(g){if(typeof g!="symbol"&&typeof g!="string"||g==="")throw new TypeError("You must supply a name when creating a logger.");var C=r[g];return C||(C=r[g]=new h(g,s.methodFactory)),C};var v=typeof window!==n?window.log:void 0;return s.noConflict=function(){return typeof window!==n&&window.log===s&&(window.log=v),s},s.getLoggers=function(){return r},s.default=s,s})}(Tm)),Tm.exports}var hI=fI();const mI=uI(hI);var Cm=function(t,e){return Cm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])},Cm(t,e)};function Hi(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Cm(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}function pI(t,e,n,i){function a(r){return r instanceof n?r:new n(function(s){s(r)})}return new(n||(n=Promise))(function(r,s){function o(u){try{c(i.next(u))}catch(d){s(d)}}function l(u){try{c(i.throw(u))}catch(d){s(d)}}function c(u){u.done?r(u.value):a(u.value).then(o,l)}c((i=i.apply(t,[])).next())})}function wE(t,e){var n={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},i,a,r,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function o(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(n=0)),n;)try{if(i=1,a&&(r=c[0]&2?a.return:c[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,c[1])).done)return r;switch(a=0,r&&(c=[c[0]&2,r.value]),c[0]){case 0:case 1:r=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,a=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(r=n.trys,!(r=r.length>0&&r[r.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!r||c[1]>r[0]&&c[1]<r[3])){n.label=c[1];break}if(c[0]===6&&n.label<r[1]){n.label=r[1],r=c;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(c);break}r[2]&&n.ops.pop(),n.trys.pop();continue}c=e.call(t,n)}catch(u){c=[6,u],a=0}finally{i=r=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Ds(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Du(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var i=n.call(t),a,r=[],s;try{for(;(e===void 0||e-- >0)&&!(a=i.next()).done;)r.push(a.value)}catch(o){s={error:o}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return r}function Pu(t,e,n){if(arguments.length===2)for(var i=0,a=e.length,r;i<a;i++)(r||!(i in e))&&(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function gs(t){return this instanceof gs?(this.v=t,this):new gs(t)}function gI(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=n.apply(t,e||[]),a,r=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",s),a[Symbol.asyncIterator]=function(){return this},a;function s(h){return function(v){return Promise.resolve(v).then(h,d)}}function o(h,v){i[h]&&(a[h]=function(g){return new Promise(function(C,m){r.push([h,g,C,m])>1||l(h,g)})},v&&(a[h]=v(a[h])))}function l(h,v){try{c(i[h](v))}catch(g){f(r[0][3],g)}}function c(h){h.value instanceof gs?Promise.resolve(h.value.v).then(u,d):f(r[0][2],h)}function u(h){l("next",h)}function d(h){l("throw",h)}function f(h,v){h(v),r.shift(),r.length&&l(r[0][0],r[0][1])}}function vI(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Ds=="function"?Ds(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(r){n[r]=t[r]&&function(s){return new Promise(function(o,l){s=t[r](s),a(o,l,s.done,s.value)})}}function a(r,s,o,l){Promise.resolve(l).then(function(c){r({value:c,done:o})},s)}}function ot(t){return typeof t=="function"}function Cg(t){var e=function(i){Error.call(i),i.stack=new Error().stack},n=t(e);return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var zf=Cg(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function Nu(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var xl=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,n,i,a,r;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var o=Ds(s),l=o.next();!l.done;l=o.next()){var c=l.value;c.remove(this)}}catch(g){e={error:g}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}else s.remove(this);var u=this.initialTeardown;if(ot(u))try{u()}catch(g){r=g instanceof zf?g.errors:[g]}var d=this._finalizers;if(d){this._finalizers=null;try{for(var f=Ds(d),h=f.next();!h.done;h=f.next()){var v=h.value;try{ay(v)}catch(g){r=r??[],g instanceof zf?r=Pu(Pu([],Du(r)),Du(g.errors)):r.push(g)}}}catch(g){i={error:g}}finally{try{h&&!h.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}}if(r)throw new zf(r)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)ay(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}},t.prototype._hasParent=function(e){var n=this._parentage;return n===e||Array.isArray(n)&&n.includes(e)},t.prototype._addParent=function(e){var n=this._parentage;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e},t.prototype._removeParent=function(e){var n=this._parentage;n===e?this._parentage=null:Array.isArray(n)&&Nu(n,e)},t.prototype.remove=function(e){var n=this._finalizers;n&&Nu(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),RE=xl.EMPTY;function xE(t){return t instanceof xl||t&&"closed"in t&&ot(t.remove)&&ot(t.add)&&ot(t.unsubscribe)}function ay(t){ot(t)?t():t.unsubscribe()}var bI={Promise:void 0},yI={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setTimeout.apply(void 0,Pu([t,e],Du(n)))},clearTimeout:function(t){return clearTimeout(t)},delegate:void 0};function OE(t){yI.setTimeout(function(){throw t})}function ry(){}function Uc(t){t()}var kg=function(t){Hi(e,t);function e(n){var i=t.call(this)||this;return i.isStopped=!1,n?(i.destination=n,xE(n)&&n.add(i)):i.destination=CI,i}return e.create=function(n,i,a){return new km(n,i,a)},e.prototype.next=function(n){this.isStopped||this._next(n)},e.prototype.error=function(n){this.isStopped||(this.isStopped=!0,this._error(n))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(n){this.destination.next(n)},e.prototype._error=function(n){try{this.destination.error(n)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(xl),SI=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var n=this.partialObserver;if(n.next)try{n.next(e)}catch(i){ic(i)}},t.prototype.error=function(e){var n=this.partialObserver;if(n.error)try{n.error(e)}catch(i){ic(i)}else ic(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(n){ic(n)}},t}(),km=function(t){Hi(e,t);function e(n,i,a){var r=t.call(this)||this,s;return ot(n)||!n?s={next:n??void 0,error:i??void 0,complete:a??void 0}:s=n,r.destination=new SI(s),r}return e}(kg);function ic(t){OE(t)}function TI(t){throw t}var CI={closed:!0,next:ry,error:TI,complete:ry},Eg=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function AE(t){return t}function kI(t){return t.length===0?AE:t.length===1?t[0]:function(e){return t.reduce(function(n,i){return i(n)},e)}}var Et=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(e,n,i){var a=this,r=_I(e)?e:new km(e,n,i);return Uc(function(){var s=a,o=s.operator,l=s.source;r.add(o?o.call(r,l):l?a._subscribe(r):a._trySubscribe(r))}),r},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(n){e.error(n)}},t.prototype.forEach=function(e,n){var i=this;return n=sy(n),new n(function(a,r){var s=new km({next:function(o){try{e(o)}catch(l){r(l),s.unsubscribe()}},error:r,complete:a});i.subscribe(s)})},t.prototype._subscribe=function(e){var n;return(n=this.source)===null||n===void 0?void 0:n.subscribe(e)},t.prototype[Eg]=function(){return this},t.prototype.pipe=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return kI(e)(this)},t.prototype.toPromise=function(e){var n=this;return e=sy(e),new e(function(i,a){var r;n.subscribe(function(s){return r=s},function(s){return a(s)},function(){return i(r)})})},t.create=function(e){return new t(e)},t}();function sy(t){var e;return(e=t??bI.Promise)!==null&&e!==void 0?e:Promise}function EI(t){return t&&ot(t.next)&&ot(t.error)&&ot(t.complete)}function _I(t){return t&&t instanceof kg||EI(t)&&xE(t)}function wI(t){return ot(t==null?void 0:t.lift)}function Ks(t){return function(e){if(wI(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function ul(t,e,n,i,a){return new RI(t,e,n,i,a)}var RI=function(t){Hi(e,t);function e(n,i,a,r,s,o){var l=t.call(this,n)||this;return l.onFinalize=s,l.shouldUnsubscribe=o,l._next=i?function(c){try{i(c)}catch(u){n.error(u)}}:t.prototype._next,l._error=r?function(c){try{r(c)}catch(u){n.error(u)}finally{this.unsubscribe()}}:t.prototype._error,l._complete=a?function(){try{a()}catch(c){n.error(c)}finally{this.unsubscribe()}}:t.prototype._complete,l}return e.prototype.unsubscribe=function(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;t.prototype.unsubscribe.call(this),!i&&((n=this.onFinalize)===null||n===void 0||n.call(this))}},e}(kg),xI=Cg(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),dl=function(t){Hi(e,t);function e(){var n=t.call(this)||this;return n.closed=!1,n.currentObservers=null,n.observers=[],n.isStopped=!1,n.hasError=!1,n.thrownError=null,n}return e.prototype.lift=function(n){var i=new oy(this,this);return i.operator=n,i},e.prototype._throwIfClosed=function(){if(this.closed)throw new xI},e.prototype.next=function(n){var i=this;Uc(function(){var a,r;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var s=Ds(i.currentObservers),o=s.next();!o.done;o=s.next()){var l=o.value;l.next(n)}}catch(c){a={error:c}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(a)throw a.error}}}})},e.prototype.error=function(n){var i=this;Uc(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=n;for(var a=i.observers;a.length;)a.shift().error(n)}})},e.prototype.complete=function(){var n=this;Uc(function(){if(n._throwIfClosed(),!n.isStopped){n.isStopped=!0;for(var i=n.observers;i.length;)i.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(n){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,n)},e.prototype._subscribe=function(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)},e.prototype._innerSubscribe=function(n){var i=this,a=this,r=a.hasError,s=a.isStopped,o=a.observers;return r||s?RE:(this.currentObservers=null,o.push(n),new xl(function(){i.currentObservers=null,Nu(o,n)}))},e.prototype._checkFinalizedStatuses=function(n){var i=this,a=i.hasError,r=i.thrownError,s=i.isStopped;a?n.error(r):s&&n.complete()},e.prototype.asObservable=function(){var n=new Et;return n.source=this,n},e.create=function(n,i){return new oy(n,i)},e}(Et),oy=function(t){Hi(e,t);function e(n,i){var a=t.call(this)||this;return a.destination=n,a.source=i,a}return e.prototype.next=function(n){var i,a;(a=(i=this.destination)===null||i===void 0?void 0:i.next)===null||a===void 0||a.call(i,n)},e.prototype.error=function(n){var i,a;(a=(i=this.destination)===null||i===void 0?void 0:i.error)===null||a===void 0||a.call(i,n)},e.prototype.complete=function(){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||i===void 0||i.call(n)},e.prototype._subscribe=function(n){var i,a;return(a=(i=this.source)===null||i===void 0?void 0:i.subscribe(n))!==null&&a!==void 0?a:RE},e}(dl),OI=function(t){Hi(e,t);function e(n){var i=t.call(this)||this;return i._value=n,i}return Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),e.prototype._subscribe=function(n){var i=t.prototype._subscribe.call(this,n);return!i.closed&&n.next(this._value),i},e.prototype.getValue=function(){var n=this,i=n.hasError,a=n.thrownError,r=n._value;if(i)throw a;return this._throwIfClosed(),r},e.prototype.next=function(n){t.prototype.next.call(this,this._value=n)},e}(dl),AI={now:function(){return Date.now()}},MI=function(t){Hi(e,t);function e(n,i){return t.call(this)||this}return e.prototype.schedule=function(n,i){return this},e}(xl),ly={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return setInterval.apply(void 0,Pu([t,e],Du(n)))},clearInterval:function(t){return clearInterval(t)},delegate:void 0},DI=function(t){Hi(e,t);function e(n,i){var a=t.call(this,n,i)||this;return a.scheduler=n,a.work=i,a.pending=!1,a}return e.prototype.schedule=function(n,i){var a;if(i===void 0&&(i=0),this.closed)return this;this.state=n;var r=this.id,s=this.scheduler;return r!=null&&(this.id=this.recycleAsyncId(s,r,i)),this.pending=!0,this.delay=i,this.id=(a=this.id)!==null&&a!==void 0?a:this.requestAsyncId(s,this.id,i),this},e.prototype.requestAsyncId=function(n,i,a){return a===void 0&&(a=0),ly.setInterval(n.flush.bind(n,this),a)},e.prototype.recycleAsyncId=function(n,i,a){if(a===void 0&&(a=0),a!=null&&this.delay===a&&this.pending===!1)return i;i!=null&&ly.clearInterval(i)},e.prototype.execute=function(n,i){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var a=this._execute(n,i);if(a)return a;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(n,i){var a=!1,r;try{this.work(n)}catch(s){a=!0,r=s||new Error("Scheduled action threw falsy error")}if(a)return this.unsubscribe(),r},e.prototype.unsubscribe=function(){if(!this.closed){var n=this,i=n.id,a=n.scheduler,r=a.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Nu(r,this),i!=null&&(this.id=this.recycleAsyncId(a,i,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(MI),cy=function(){function t(e,n){n===void 0&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(e,n,i){return n===void 0&&(n=0),new this.schedulerActionCtor(this,e).schedule(i,n)},t.now=AI.now,t}(),PI=function(t){Hi(e,t);function e(n,i){i===void 0&&(i=cy.now);var a=t.call(this,n,i)||this;return a.actions=[],a._active=!1,a}return e.prototype.flush=function(n){var i=this.actions;if(this._active){i.push(n);return}var a;this._active=!0;do if(a=n.execute(n.state,n.delay))break;while(n=i.shift());if(this._active=!1,a){for(;n=i.shift();)n.unsubscribe();throw a}},e}(cy);new PI(DI);function NI(t){return t&&ot(t.schedule)}function LI(t){return t[t.length-1]}function ME(t){return NI(LI(t))?t.pop():void 0}var DE=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function PE(t){return ot(t==null?void 0:t.then)}function NE(t){return ot(t[Eg])}function LE(t){return Symbol.asyncIterator&&ot(t==null?void 0:t[Symbol.asyncIterator])}function IE(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function II(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var UE=II();function jE(t){return ot(t==null?void 0:t[UE])}function BE(t){return gI(this,arguments,function(){var e,n,i,a;return wE(this,function(r){switch(r.label){case 0:e=t.getReader(),r.label=1;case 1:r.trys.push([1,,9,10]),r.label=2;case 2:return[4,gs(e.read())];case 3:return n=r.sent(),i=n.value,a=n.done,a?[4,gs(void 0)]:[3,5];case 4:return[2,r.sent()];case 5:return[4,gs(i)];case 6:return[4,r.sent()];case 7:return r.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function qE(t){return ot(t==null?void 0:t.getReader)}function Ol(t){if(t instanceof Et)return t;if(t!=null){if(NE(t))return UI(t);if(DE(t))return jI(t);if(PE(t))return BI(t);if(LE(t))return zE(t);if(jE(t))return qI(t);if(qE(t))return zI(t)}throw IE(t)}function UI(t){return new Et(function(e){var n=t[Eg]();if(ot(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function jI(t){return new Et(function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}function BI(t){return new Et(function(e){t.then(function(n){e.closed||(e.next(n),e.complete())},function(n){return e.error(n)}).then(null,OE)})}function qI(t){return new Et(function(e){var n,i;try{for(var a=Ds(t),r=a.next();!r.done;r=a.next()){var s=r.value;if(e.next(s),e.closed)return}}catch(o){n={error:o}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}e.complete()})}function zE(t){return new Et(function(e){FI(t,e).catch(function(n){return e.error(n)})})}function zI(t){return zE(BE(t))}function FI(t,e){var n,i,a,r;return pI(this,void 0,void 0,function(){var s,o;return wE(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=vI(t),l.label=1;case 1:return[4,n.next()];case 2:if(i=l.sent(),!!i.done)return[3,4];if(s=i.value,e.next(s),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),a={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),i&&!i.done&&(r=n.return)?[4,r.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(a)throw a.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function or(t,e,n,i,a){i===void 0&&(i=0),a===void 0&&(a=!1);var r=e.schedule(function(){n(),a?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(r),!a)return r}function FE(t,e){return e===void 0&&(e=0),Ks(function(n,i){n.subscribe(ul(i,function(a){return or(i,t,function(){return i.next(a)},e)},function(){return or(i,t,function(){return i.complete()},e)},function(a){return or(i,t,function(){return i.error(a)},e)}))})}function VE(t,e){return e===void 0&&(e=0),Ks(function(n,i){i.add(t.schedule(function(){return n.subscribe(i)},e))})}function VI(t,e){return Ol(t).pipe(VE(e),FE(e))}function HI(t,e){return Ol(t).pipe(VE(e),FE(e))}function KI(t,e){return new Et(function(n){var i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}function GI(t,e){return new Et(function(n){var i;return or(n,e,function(){i=t[UE](),or(n,e,function(){var a,r,s;try{a=i.next(),r=a.value,s=a.done}catch(o){n.error(o);return}s?n.complete():n.next(r)},0,!0)}),function(){return ot(i==null?void 0:i.return)&&i.return()}})}function HE(t,e){if(!t)throw new Error("Iterable cannot be null");return new Et(function(n){or(n,e,function(){var i=t[Symbol.asyncIterator]();or(n,e,function(){i.next().then(function(a){a.done?n.complete():n.next(a.value)})},0,!0)})})}function YI(t,e){return HE(BE(t),e)}function QI(t,e){if(t!=null){if(NE(t))return VI(t,e);if(DE(t))return KI(t,e);if(PE(t))return HI(t,e);if(LE(t))return HE(t,e);if(jE(t))return GI(t,e);if(qE(t))return YI(t,e)}throw IE(t)}function JI(t,e){return e?QI(t,e):Ol(t)}Cg(function(t){return function(e){e===void 0&&(e=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e}});function ci(t,e){return Ks(function(n,i){var a=0;n.subscribe(ul(i,function(r){i.next(t.call(e,r,a++))}))})}function XI(t,e,n,i,a,r,s,o){var l=[],c=0,u=0,d=!1,f=function(){d&&!l.length&&!c&&e.complete()},h=function(g){return c<i?v(g):l.push(g)},v=function(g){c++;var C=!1;Ol(n(g,u++)).subscribe(ul(e,function(m){e.next(m)},function(){C=!0},void 0,function(){if(C)try{c--;for(var m=function(){var b=l.shift();s||v(b)};l.length&&c<i;)m();f()}catch(b){e.error(b)}}))};return t.subscribe(ul(e,h,function(){d=!0,f()})),function(){}}function KE(t,e,n){return n===void 0&&(n=1/0),ot(e)?KE(function(i,a){return ci(function(r,s){return e(i,r,a,s)})(Ol(t(i,a)))},n):(typeof e=="number"&&(n=e),Ks(function(i,a){return XI(i,a,t,n)}))}function $I(t){return KE(AE,t)}function ZI(){return $I(1)}function Em(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ZI()(JI(t,ME(t)))}function WI(t,e){return Ks(function(n,i){var a=0;n.subscribe(ul(i,function(r){return t.call(e,r,a++)&&i.next(r)}))})}function xr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ME(t);return Ks(function(i,a){(n?Em(t,i,n):Em(t,i)).subscribe(a)})}var eU=Object.defineProperty,uy=Object.getOwnPropertySymbols,tU=Object.prototype.hasOwnProperty,nU=Object.prototype.propertyIsEnumerable,dy=(t,e,n)=>e in t?eU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fy=(t,e)=>{for(var n in e||(e={}))tU.call(e,n)&&dy(t,n,e[n]);if(uy)for(var n of uy(e))nU.call(e,n)&&dy(t,n,e[n]);return t},Or=(t,e,n)=>new Promise((i,a)=>{var r=l=>{try{o(n.next(l))}catch(c){a(c)}},s=l=>{try{o(n.throw(l))}catch(c){a(c)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(r,s);o((n=n.apply(t,e)).next())}),GE="lk";function _g(t){return typeof t>"u"?!1:iU(t)||aU(t)}function iU(t){var e;return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("track")&&typeof((e=t.publication)==null?void 0:e.track)<"u":!1}function aU(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&t.hasOwnProperty("publication")&&typeof t.publication<"u":!1}function rU(t){return t?t.hasOwnProperty("participant")&&t.hasOwnProperty("source")&&typeof t.publication>"u":!1}function sU(t){if(typeof t=="string"||typeof t=="number")return`${t}`;if(rU(t))return`${t.participant.identity}_${t.source}_placeholder`;if(_g(t))return`${t.participant.identity}_${t.publication.source}_${t.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${t}`)}function oU(t,e,n){return rI(t,e,()=>Or(this,null,function*(){const{x:i,y:a}=yield cI(t,e,{placement:"top",middleware:[sI(6),lI(),oI({padding:5})]});n==null||n(i,a)}))}function lU(t,e){return!t.contains(e.target)}var cU=[L.ConnectionStateChanged,L.RoomMetadataChanged,L.ActiveSpeakersChanged,L.ConnectionQualityChanged,L.ParticipantConnected,L.ParticipantDisconnected,L.ParticipantPermissionsChanged,L.ParticipantMetadataChanged,L.ParticipantNameChanged,L.ParticipantAttributesChanged,L.TrackMuted,L.TrackUnmuted,L.TrackPublished,L.TrackUnpublished,L.TrackStreamStateChanged,L.TrackSubscriptionFailed,L.TrackSubscriptionPermissionChanged,L.TrackSubscriptionStatusChanged],uU=[...cU,L.LocalTrackPublished,L.LocalTrackUnpublished];B.TrackPublished,B.TrackUnpublished,B.TrackMuted,B.TrackUnmuted,B.TrackStreamStateChanged,B.TrackSubscribed,B.TrackUnsubscribed,B.TrackSubscriptionPermissionChanged,B.TrackSubscriptionFailed,B.LocalTrackPublished,B.LocalTrackUnpublished;var dU=[B.ConnectionQualityChanged,B.IsSpeakingChanged,B.ParticipantMetadataChanged,B.ParticipantPermissionsChanged,B.TrackMuted,B.TrackUnmuted,B.TrackPublished,B.TrackUnpublished,B.TrackStreamStateChanged,B.TrackSubscriptionFailed,B.TrackSubscriptionPermissionChanged,B.TrackSubscriptionStatusChanged];[...dU,B.LocalTrackPublished,B.LocalTrackUnpublished];var Se=mI.getLogger("lk-components-js");Se.setDefaultLevel("WARN");function fU(){return typeof navigator<"u"&&navigator.mediaDevices&&!!navigator.mediaDevices.getDisplayMedia}var YE=(t=>(t.AgentState="lk.agent.state",t.PublishOnBehalf="lk.publish_on_behalf",t.TranscriptionFinal="lk.transcription_final",t.TranscriptionSegmentId="lk.segment_id",t.TranscribedTrackId="lk.transcribed_track_id",t))(YE||{});function QE(t){return typeof t=="object"}function JE(t){return Array.isArray(t)&&t.filter(QE).length>0}function Fi(t){return`${GE}-${t}`}function hU(t){const e=_m(t),n=$E(t.participant).pipe(ci(()=>_m(t)),xr(e));return{className:Fi(t.source===D.Source.Camera||t.source===D.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:n}}function _m(t){if(_g(t))return t.publication;{const{source:e,name:n,participant:i}=t;if(e&&n)return i.getTrackPublications().find(a=>a.source===e&&a.trackName===n);if(n)return i.getTrackPublicationByName(n);if(e)return i.getTrackPublication(e);throw new Error("At least one of source and name needs to be defined")}}function wg(t,...e){return new Et(n=>{const i=()=>{n.next(t)};return e.forEach(a=>{t.on(a,i)}),()=>{e.forEach(a=>{t.off(a,i)})}}).pipe(xr(t))}function XE(t,e){return new Et(n=>{const i=(...a)=>{n.next(a)};return t.on(e,i),()=>{t.off(e,i)}})}function mU(t){return XE(t,L.ConnectionStateChanged).pipe(ci(([e])=>e),xr(t.state))}function pU(t,e,n=!0){const i=new Et(r=>{zi.getLocalDevices(t,n).then(s=>{r.next(s),r.complete()}).catch(s=>{e==null||e(s),r.next([]),r.complete()})}),a=new Et(r=>{var s;const o=()=>Or(this,null,function*(){try{const l=yield zi.getLocalDevices(t,n);r.next(l)}catch(l){e==null||e(l)}});if(typeof window<"u"){if(!window.isSecureContext)throw new Error("Accessing media devices is available only in secure contexts (HTTPS and localhost), in some or all supporting browsers. See: https://developer.mozilla.org/en-US/docs/Web/API/Navigator/mediaDevices");(s=navigator==null?void 0:navigator.mediaDevices)==null||s.addEventListener("devicechange",o)}return()=>{var l;(l=navigator==null?void 0:navigator.mediaDevices)==null||l.removeEventListener("devicechange",o)}});return Em(i,a)}function gU(t){return wg(t,L.AudioPlaybackStatusChanged).pipe(ci(e=>({canPlayAudio:e.canPlaybackAudio})))}function vU(t){return wg(t,L.VideoPlaybackStatusChanged).pipe(ci(e=>({canPlayVideo:e.canPlaybackVideo})))}function bU(t,e){return XE(t,L.ActiveDeviceChanged).pipe(WI(([n])=>n===e),ci(([n,i])=>(Se.debug("activeDeviceObservable | RoomEvent.ActiveDeviceChanged",{kind:n,deviceId:i}),i)))}function yU(t,...e){return new Et(n=>{const i=()=>{n.next(t)};return e.forEach(a=>{t.on(a,i)}),()=>{e.forEach(a=>{t.off(a,i)})}}).pipe(xr(t))}function $E(t){return yU(t,B.TrackMuted,B.TrackUnmuted,B.ParticipantPermissionsChanged,B.TrackPublished,B.TrackUnpublished,B.LocalTrackPublished,B.LocalTrackUnpublished,B.MediaDevicesError,B.TrackSubscriptionStatusChanged).pipe(ci(e=>{const{isMicrophoneEnabled:n,isCameraEnabled:i,isScreenShareEnabled:a}=e,r=e.getTrackPublication(D.Source.Microphone),s=e.getTrackPublication(D.Source.Camera);return{isCameraEnabled:i,isMicrophoneEnabled:n,isScreenShareEnabled:a,cameraTrack:s,microphoneTrack:r,participant:e}}))}function SU(t,e){return new Et(n=>{const i=(...a)=>{n.next(a)};return t.on(e,i),()=>{t.off(e,i)}})}function TU(t){return SU(t,B.ParticipantPermissionsChanged).pipe(ci(()=>t.permissions),xr(t.permissions))}function CU(t,e,n,i,a){const{localParticipant:r}=e,s=(u,d)=>{let f=!1;switch(u){case D.Source.Camera:f=d.isCameraEnabled;break;case D.Source.Microphone:f=d.isMicrophoneEnabled;break;case D.Source.ScreenShare:f=d.isScreenShareEnabled;break}return f},o=$E(r).pipe(ci(u=>s(t,u.participant)),xr(s(t,r))),l=new dl,c=(u,d)=>Or(this,null,function*(){try{switch(d??(d=n),l.next(!0),t){case D.Source.Camera:return yield r.setCameraEnabled(u??!r.isCameraEnabled,d,i),r.isCameraEnabled;case D.Source.Microphone:return yield r.setMicrophoneEnabled(u??!r.isMicrophoneEnabled,d,i),r.isMicrophoneEnabled;case D.Source.ScreenShare:return yield r.setScreenShareEnabled(u??!r.isScreenShareEnabled,d,i),r.isScreenShareEnabled;default:throw new TypeError("Tried to toggle unsupported source")}}catch(f){if(a&&f instanceof Error){a==null||a(f);return}else throw f}finally{l.next(!1)}});return{className:Fi("button"),toggle:c,enabledObserver:o,pendingObserver:l.asObservable()}}function kU(){let t=!1;const e=new dl,n=new dl,i=a=>Or(this,null,function*(){n.next(!0),t=a??!t,e.next(t),n.next(!1)});return{className:Fi("button"),toggle:i,enabledObserver:e.asObservable(),pendingObserver:n.asObservable()}}function EU(t,e,n){const i=new OI(void 0),a=bU(e,t),r=(s,...o)=>Or(this,[s,...o],function*(l,c={}){var u,d,f;if(e){const h=Nt();if(t==="audiooutput"&&((h==null?void 0:h.name)==="Safari"||(h==null?void 0:h.os)==="iOS")){Se.warn("Switching audio output device is not supported on Safari and iOS.");return}Se.debug(`Switching active device of kind "${t}" with id ${l}.`),yield e.switchActiveDevice(t,l,c.exact);const v=(u=e.getActiveDevice(t))!=null?u:l;v!==l&&l!=="default"&&Se.info(`We tried to select the device with id (${l}), but the browser decided to select the device with id (${v}) instead.`);let g;t==="audioinput"?g=(d=e.localParticipant.getTrackPublication(D.Source.Microphone))==null?void 0:d.track:t==="videoinput"&&(g=(f=e.localParticipant.getTrackPublication(D.Source.Camera))==null?void 0:f.track);const C=l==="default"&&!g||l==="default"&&(g==null?void 0:g.mediaStreamTrack.label.startsWith("Default"));i.next(C?l:v)}});return{className:Fi("media-device-select"),activeDeviceObservable:a,setActiveMediaDevice:r}}function _U(t){const e=n=>{t.disconnect(n)};return{className:Fi("disconnect-button"),disconnect:e}}function wU(){const t=e=>Or(this,null,function*(){Se.info("Start Audio for room: ",e),yield e.startAudio()});return{className:Fi("start-audio-button"),roomAudioPlaybackAllowedObservable:gU,handleStartAudioPlayback:t}}function RU(){const t=e=>Or(this,null,function*(){Se.info("Start Video for room: ",e),yield e.startVideo()});return{className:Fi("start-audio-button"),roomVideoPlaybackAllowedObservable:vU,handleStartVideoPlayback:t}}function xU(){return{className:[Fi("button"),Fi("chat-toggle")].join(" ")}}function OU(){return{className:"lk-room-container"}}function hy(t,e,n=!0){const i=[t.localParticipant,...Array.from(t.remoteParticipants.values())],a=[];return i.forEach(r=>{e.forEach(s=>{const o=Array.from(r.trackPublications.values()).filter(l=>l.source===s&&(!n||l.track)).map(l=>({participant:r,publication:l,source:l.source}));a.push(...o)})}),{trackReferences:a,participants:i}}function AU(t,e,n){var i,a;const r=(i=n.additionalRoomEvents)!=null?i:uU,s=(a=n.onlySubscribed)!=null?a:!0,o=Array.from(new Set([L.ParticipantConnected,L.ParticipantDisconnected,L.ConnectionStateChanged,L.LocalTrackPublished,L.LocalTrackUnpublished,L.TrackPublished,L.TrackUnpublished,L.TrackSubscriptionStatusChanged,...r]).values());return wg(t,...o).pipe(ci(l=>{const c=hy(l,e,s);return Se.debug(`TrackReference[] was updated. (length ${c.trackReferences.length})`,c),c}),xr(hy(t,e,s)))}function MU(t,e){if(typeof localStorage>"u"){Se.error("Local storage is not available.");return}try{if(e){const n=Object.fromEntries(Object.entries(e).filter(([,i])=>i!==""));localStorage.setItem(t,JSON.stringify(n))}}catch(n){Se.error(`Error setting item to local storage: ${n}`)}}function DU(t){if(typeof localStorage>"u"){Se.error("Local storage is not available.");return}try{const e=localStorage.getItem(t);if(!e){Se.warn(`Item with key ${t} does not exist in local storage.`);return}return JSON.parse(e)}catch(e){Se.error(`Error getting item from local storage: ${e}`);return}}function PU(t){return{load:()=>DU(t),save:e=>MU(t,e)}}var NU=`${GE}-user-choices`,uo={videoEnabled:!0,audioEnabled:!0,videoDeviceId:"default",audioDeviceId:"default",username:""},{load:LU,save:IU}=PU(NU);function UU(t,e=!1){e!==!0&&IU(t)}function jU(t,e=!1){var n,i,a,r,s;const o={videoEnabled:(n=t==null?void 0:t.videoEnabled)!=null?n:uo.videoEnabled,audioEnabled:(i=t==null?void 0:t.audioEnabled)!=null?i:uo.audioEnabled,videoDeviceId:(a=t==null?void 0:t.videoDeviceId)!=null?a:uo.videoDeviceId,audioDeviceId:(r=t==null?void 0:t.audioDeviceId)!=null?r:uo.audioDeviceId,username:(s=t==null?void 0:t.username)!=null?s:uo.username};if(e)return o;{const l=LU();return fy(fy({},o),l??{})}}const ZE=T.createContext(void 0);function WE(){const t=T.useContext(ZE);if(!t)throw Error("Tried to access LayoutContext context outside a LayoutContextProvider provider.");return t}function BU(){return T.useContext(ZE)}const qU=T.createContext(void 0);function zU(){return T.useContext(qU)}function FU(t){const e=zU(),n=t??e;if(!n)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return n}T.createContext(void 0);const Rg=T.createContext(void 0);function xg(){const t=T.useContext(Rg);if(!t)throw Error("tried to access room context outside of livekit room component");return t}function Sd(){return T.useContext(Rg)}function Td(t){const e=Sd(),n=t??e;if(!n)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return n}T.createContext(void 0);const VU=T.createContext(void 0);function e_(t){var e,n,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(e=0;e<a;e++)t[e]&&(n=e_(t[e]))&&(i&&(i+=" "),i+=n)}else for(n in t)t[n]&&(i&&(i+=" "),i+=n);return i}function HU(){for(var t,e,n=0,i="",a=arguments.length;n<a;n++)(t=arguments[n])&&(e=e_(t))&&(i&&(i+=" "),i+=e);return i}function KU(...t){return(...e)=>{for(const n of t)if(typeof n=="function")try{n(...e)}catch(i){console.error(i)}}}function Va(...t){const e={...t[0]};for(let n=1;n<t.length;n++){const i=t[n];for(const a in i){const r=e[a],s=i[a];typeof r=="function"&&typeof s=="function"&&a[0]==="o"&&a[1]==="n"&&a.charCodeAt(2)>=65&&a.charCodeAt(2)<=90?e[a]=KU(r,s):(a==="className"||a==="UNSAFE_className")&&typeof r=="string"&&typeof s=="string"?e[a]=HU(r,s):e[a]=s!==void 0?s:r}}return e}function GU(t){return t!==void 0}function Og(...t){return Va(...t.filter(GU))}function YU(t,e){return t==="processor"&&e&&typeof e=="object"&&"name"in e?e.name:t==="e2ee"&&e?"e2ee-enabled":e}const QU={connect:!0,audio:!1,video:!1};function JU(t){const{token:e,serverUrl:n,options:i,room:a,connectOptions:r,connect:s,audio:o,video:l,screen:c,onConnected:u,onDisconnected:d,onError:f,onMediaDeviceFailure:h,onEncryptionError:v,simulateParticipants:g,...C}={...QU,...t};i&&a&&Se.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[m,b]=T.useState(),S=T.useRef(s);T.useEffect(()=>{b(a??new zi(i))},[a,JSON.stringify(i,YU)]);const p=T.useMemo(()=>{const{className:y}=OU();return Va(C,{className:y})},[C]);return T.useEffect(()=>{if(!m)return;const y=()=>{const R=m.localParticipant;Se.debug("trying to publish local tracks"),Promise.all([R.setMicrophoneEnabled(!!o,typeof o!="boolean"?o:void 0),R.setCameraEnabled(!!l,typeof l!="boolean"?l:void 0),R.setScreenShareEnabled(!!c,typeof c!="boolean"?c:void 0)]).catch(N=>{Se.warn(N),f==null||f(N)})},k=(R,N)=>{const z=rl.getFailure(R);h==null||h(z,N)},_=R=>{v==null||v(R)},O=R=>{d==null||d(R)},w=()=>{u==null||u()};return m.on(L.SignalConnected,y).on(L.MediaDevicesError,k).on(L.EncryptionError,_).on(L.Disconnected,O).on(L.Connected,w),()=>{m.off(L.SignalConnected,y).off(L.MediaDevicesError,k).off(L.EncryptionError,_).off(L.Disconnected,O).off(L.Connected,w)}},[m,o,l,c,f,v,h,u,d]),T.useEffect(()=>{if(m){if(g){m.simulateParticipants({participants:{count:g},publish:{audio:!0,useRealTracks:!0}});return}if(s){if(S.current=!0,Se.debug("connecting"),!e){Se.debug("no token yet");return}if(!n){Se.warn("no livekit url provided"),f==null||f(Error("no livekit url provided"));return}m.connect(n,e,r).catch(y=>{Se.warn(y),S.current===!0&&(f==null||f(y))})}else Se.debug("disconnecting because connect is false"),S.current=!1,m.disconnect()}},[s,e,JSON.stringify(r),m,f,n,g]),T.useEffect(()=>{if(m)return()=>{Se.info("disconnecting on onmount"),m.disconnect()}},[m]),{room:m,htmlProps:p}}const XU=T.forwardRef(function(t,e){const{room:n,htmlProps:i}=JU(t);return T.createElement("div",{ref:e,...i},n&&T.createElement(Rg.Provider,{value:n},T.createElement(VU.Provider,{value:t.featureFlags},t.children)))});function yr(t,e,n=!0){const[i,a]=T.useState(e);return T.useEffect(()=>{if(n&&a(e),typeof window>"u"||!t)return;const r=t.subscribe(a);return()=>r.unsubscribe()},[t,n]),i}function $U(t){const e=r=>typeof window<"u"?window.matchMedia(r).matches:!1,[n,i]=T.useState(e(t));function a(){i(e(t))}return T.useEffect(()=>{const r=window.matchMedia(t);return a(),r.addListener?r.addListener(a):r.addEventListener("change",a),()=>{r.removeListener?r.removeListener(a):r.removeEventListener("change",a)}},[t]),n}function ZU(t){const e=Td(t),n=T.useMemo(()=>mU(e),[e]);return yr(n,e.state)}function WU(t){const e=xg(),n=ZU(e);return{buttonProps:T.useMemo(()=>{const{className:i,disconnect:a}=_U(e);return Va(t,{className:i,onClick:()=>a(t.stopTracks??!0),disabled:n===ge.Disconnected})},[e,t,n])}}function e5(){const t=xg(),e=T.useMemo(()=>TU(t.localParticipant),[t]);return yr(e,t.localParticipant.permissions)}function t5({kind:t,room:e,track:n,requestPermissions:i,onError:a}){const r=Sd(),s=T.useMemo(()=>e??r??new zi,[e,r]),o=T.useMemo(()=>pU(t,a,i),[t,i,a]),l=yr(o,[]),[c,u]=T.useState((s==null?void 0:s.getActiveDevice(t))??"default"),{className:d,activeDeviceObservable:f,setActiveMediaDevice:h}=T.useMemo(()=>EU(t,s),[t,s,n]);return T.useEffect(()=>{const v=f.subscribe(g=>{g&&(Se.info("setCurrentDeviceId",g),u(g))});return()=>{v==null||v.unsubscribe()}},[f]),{devices:l,className:d,activeDeviceId:c,setActiveMediaDevice:h}}function n5({room:t,props:e}){const n=Td(t),{className:i,roomAudioPlaybackAllowedObservable:a,handleStartAudioPlayback:r}=T.useMemo(()=>wU(),[]),s=T.useMemo(()=>a(n),[n,a]),{canPlayAudio:o}=yr(s,{canPlayAudio:n.canPlaybackAudio});return{mergedProps:T.useMemo(()=>Va(e,{className:i,onClick:()=>{r(n)},style:{display:o?"none":"block"}}),[e,i,o,r,n]),canPlayAudio:o}}function i5({room:t,props:e}){const n=Td(t),{className:i,roomVideoPlaybackAllowedObservable:a,handleStartVideoPlayback:r}=T.useMemo(()=>RU(),[]),s=T.useMemo(()=>a(n),[n,a]),{canPlayVideo:o}=yr(s,{canPlayVideo:n.canPlaybackVideo});return{mergedProps:T.useMemo(()=>Va(e,{className:i,onClick:()=>{r(n)},style:{display:o?"none":"block"}}),[e,i,o,r,n]),canPlayVideo:o}}function a5({props:t}){const{dispatch:e,state:n}=WE().widget,{className:i}=T.useMemo(()=>xU(),[]);return{mergedProps:T.useMemo(()=>Va(t,{className:i,onClick:()=>{e&&e({msg:"toggle_chat"})},"aria-pressed":n!=null&&n.showChat?"true":"false","data-lk-unread-msgs":n?n.unreadMessages<10?n.unreadMessages.toFixed(0):"9+":"0"}),[t,i,e,n])}}function r5({source:t,onChange:e,initialState:n,captureOptions:i,publishOptions:a,onDeviceError:r,room:s,...o}){var l;const c=Sd(),u=T.useMemo(()=>s??c,[s,c]),d=(l=u==null?void 0:u.localParticipant)==null?void 0:l.getTrackPublication(t),f=T.useRef(!1),{toggle:h,className:v,pendingObserver:g,enabledObserver:C}=T.useMemo(()=>u?CU(t,u,i,a,r):kU(),[u,t,JSON.stringify(i),a]),m=yr(g,!1),b=yr(C,n??!!(d!=null&&d.isEnabled));T.useEffect(()=>{e==null||e(b,f.current),f.current=!1},[b,e]),T.useEffect(()=>{n!==void 0&&(Se.debug("forcing initial toggle state",t,n),h(n))},[]);const S=T.useMemo(()=>Va(o,{className:v}),[o,v]),p=T.useCallback(y=>{var k;f.current=!0,h().catch(()=>f.current=!1),(k=o.onClick)==null||k.call(o,y)},[o,h]);return{toggle:h,enabled:b,pending:m,track:d,buttonProps:{...S,"aria-pressed":b,"data-lk-source":t,"data-lk-enabled":b,disabled:m,onClick:p}}}function s5(t=[D.Source.Camera,D.Source.Microphone,D.Source.ScreenShare,D.Source.ScreenShareAudio,D.Source.Unknown],e={}){const n=Td(e.room),[i,a]=T.useState([]),[r,s]=T.useState([]),o=T.useMemo(()=>t.map(l=>QE(l)?l.source:l),[JSON.stringify(t)]);return T.useEffect(()=>{const l=AU(n,o,{additionalRoomEvents:e.updateOnlyOn,onlySubscribed:e.onlySubscribed}).subscribe(({trackReferences:c,participants:u})=>{Se.debug("setting track bundles",c,u),a(c),s(u)});return()=>l.unsubscribe()},[n,JSON.stringify(e.onlySubscribed),JSON.stringify(e.updateOnlyOn),JSON.stringify(t)]),T.useMemo(()=>{if(JE(t)){const l=l5(t,r),c=Array.from(i);return r.forEach(u=>{l.has(u.identity)&&(l.get(u.identity)??[]).forEach(d=>{if(i.find(({participant:h,publication:v})=>u.identity===h.identity&&v.source===d))return;Se.debug(`Add ${d} placeholder for participant ${u.identity}.`);const f={participant:u,source:d};c.push(f)})}),c}else return i},[i,r,t])}function o5(t,e){const n=new Set(t);for(const i of e)n.delete(i);return n}function l5(t,e){const n=new Map;if(JE(t)){const i=t.filter(a=>a.withPlaceholder).map(a=>a.source);e.forEach(a=>{const r=a.getTrackPublications().map(o=>{var l;return(l=o.track)==null?void 0:l.source}).filter(o=>o!==void 0),s=Array.from(o5(new Set(i),new Set(r)));s.length>0&&n.set(a.identity,s)})}return n}function c5(t={}){const[e,n]=T.useState(jU(t.defaults,t.preventLoad??!1)),i=T.useCallback(l=>{n(c=>({...c,audioEnabled:l}))},[]),a=T.useCallback(l=>{n(c=>({...c,videoEnabled:l}))},[]),r=T.useCallback(l=>{n(c=>({...c,audioDeviceId:l}))},[]),s=T.useCallback(l=>{n(c=>({...c,videoDeviceId:l}))},[]),o=T.useCallback(l=>{n(c=>({...c,username:l}))},[]);return T.useEffect(()=>{UU(e,t.preventSave??!1)},[e,t.preventSave]),{userChoices:e,saveAudioInputEnabled:i,saveVideoInputEnabled:a,saveAudioInputDeviceId:r,saveVideoInputDeviceId:s,saveUsername:o}}YE.AgentState;var ac={exports:{}},my;function u5(){if(my)return ac.exports;my=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(p,y,k){return Function.prototype.apply.call(p,y,k)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(p){return Object.getOwnPropertyNames(p).concat(Object.getOwnPropertySymbols(p))}:n=function(p){return Object.getOwnPropertyNames(p)};function i(p){console&&console.warn&&console.warn(p)}var a=Number.isNaN||function(p){return p!==p};function r(){r.init.call(this)}ac.exports=r,ac.exports.once=m,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var s=10;function o(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(p){if(typeof p!="number"||p<0||a(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");s=p}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(p){if(typeof p!="number"||p<0||a(p))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+p+".");return this._maxListeners=p,this};function l(p){return p._maxListeners===void 0?r.defaultMaxListeners:p._maxListeners}r.prototype.getMaxListeners=function(){return l(this)},r.prototype.emit=function(p){for(var y=[],k=1;k<arguments.length;k++)y.push(arguments[k]);var _=p==="error",O=this._events;if(O!==void 0)_=_&&O.error===void 0;else if(!_)return!1;if(_){var w;if(y.length>0&&(w=y[0]),w instanceof Error)throw w;var R=new Error("Unhandled error."+(w?" ("+w.message+")":""));throw R.context=w,R}var N=O[p];if(N===void 0)return!1;if(typeof N=="function")e(N,this,y);else for(var z=N.length,Z=v(N,z),k=0;k<z;++k)e(Z[k],this,y);return!0};function c(p,y,k,_){var O,w,R;if(o(k),w=p._events,w===void 0?(w=p._events=Object.create(null),p._eventsCount=0):(w.newListener!==void 0&&(p.emit("newListener",y,k.listener?k.listener:k),w=p._events),R=w[y]),R===void 0)R=w[y]=k,++p._eventsCount;else if(typeof R=="function"?R=w[y]=_?[k,R]:[R,k]:_?R.unshift(k):R.push(k),O=l(p),O>0&&R.length>O&&!R.warned){R.warned=!0;var N=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");N.name="MaxListenersExceededWarning",N.emitter=p,N.type=y,N.count=R.length,i(N)}return p}r.prototype.addListener=function(p,y){return c(this,p,y,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(p,y){return c(this,p,y,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(p,y,k){var _={fired:!1,wrapFn:void 0,target:p,type:y,listener:k},O=u.bind(_);return O.listener=k,_.wrapFn=O,O}r.prototype.once=function(p,y){return o(y),this.on(p,d(this,p,y)),this},r.prototype.prependOnceListener=function(p,y){return o(y),this.prependListener(p,d(this,p,y)),this},r.prototype.removeListener=function(p,y){var k,_,O,w,R;if(o(y),_=this._events,_===void 0)return this;if(k=_[p],k===void 0)return this;if(k===y||k.listener===y)--this._eventsCount===0?this._events=Object.create(null):(delete _[p],_.removeListener&&this.emit("removeListener",p,k.listener||y));else if(typeof k!="function"){for(O=-1,w=k.length-1;w>=0;w--)if(k[w]===y||k[w].listener===y){R=k[w].listener,O=w;break}if(O<0)return this;O===0?k.shift():g(k,O),k.length===1&&(_[p]=k[0]),_.removeListener!==void 0&&this.emit("removeListener",p,R||y)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(p){var y,k,_;if(k=this._events,k===void 0)return this;if(k.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):k[p]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete k[p]),this;if(arguments.length===0){var O=Object.keys(k),w;for(_=0;_<O.length;++_)w=O[_],w!=="removeListener"&&this.removeAllListeners(w);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(y=k[p],typeof y=="function")this.removeListener(p,y);else if(y!==void 0)for(_=y.length-1;_>=0;_--)this.removeListener(p,y[_]);return this};function f(p,y,k){var _=p._events;if(_===void 0)return[];var O=_[y];return O===void 0?[]:typeof O=="function"?k?[O.listener||O]:[O]:k?C(O):v(O,O.length)}r.prototype.listeners=function(p){return f(this,p,!0)},r.prototype.rawListeners=function(p){return f(this,p,!1)},r.listenerCount=function(p,y){return typeof p.listenerCount=="function"?p.listenerCount(y):h.call(p,y)},r.prototype.listenerCount=h;function h(p){var y=this._events;if(y!==void 0){var k=y[p];if(typeof k=="function")return 1;if(k!==void 0)return k.length}return 0}r.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function v(p,y){for(var k=new Array(y),_=0;_<y;++_)k[_]=p[_];return k}function g(p,y){for(;y+1<p.length;y++)p[y]=p[y+1];p.pop()}function C(p){for(var y=new Array(p.length),k=0;k<y.length;++k)y[k]=p[k].listener||p[k];return y}function m(p,y){return new Promise(function(k,_){function O(R){p.removeListener(y,w),_(R)}function w(){typeof p.removeListener=="function"&&p.removeListener("error",O),k([].slice.call(arguments))}S(p,y,w,{once:!0}),y!=="error"&&b(p,O,{once:!0})})}function b(p,y,k){typeof p.on=="function"&&S(p,"error",y,k)}function S(p,y,k,_){if(typeof p.on=="function")_.once?p.once(y,k):p.on(y,k);else if(typeof p.addEventListener=="function")p.addEventListener(y,function O(w){_.once&&p.removeEventListener(y,O),k(w)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p)}return ac.exports}u5();const d5=T.forwardRef(function(t,e){const{mergedProps:n}=a5({props:t});return T.createElement("button",{ref:e,...n},t.children)}),f5=T.forwardRef(function(t,e){const{buttonProps:n}=WU(t);return T.createElement("button",{ref:e,...n},t.children)}),h5=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),T.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),m5=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4z"})),p5=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:18,fill:"none",...t},T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h10.5A2.75 2.75 0 0 1 16 2.75v13.594a.75.75 0 0 1-1.234.572l-3.691-3.12a1.25 1.25 0 0 0-.807-.296H2.75A2.75 2.75 0 0 1 0 10.75v-8ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v8c0 .69.56 1.25 1.25 1.25h7.518c.65 0 1.279.23 1.775.65l2.457 2.077V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M3 4.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Z",clipRule:"evenodd"})),g5=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},T.createElement("path",{fill:"currentcolor",fillRule:"evenodd",d:"M8.961.894C8.875-.298 7.125-.298 7.04.894c-.066.912-1.246 1.228-1.76.472-.67-.99-2.186-.115-1.664.96.399.824-.465 1.688-1.288 1.289-1.076-.522-1.95.994-.961 1.665.756.513.44 1.693-.472 1.759-1.192.086-1.192 1.836 0 1.922.912.066 1.228 1.246.472 1.76-.99.67-.115 2.186.96 1.664.824-.399 1.688.465 1.289 1.288-.522 1.076.994 1.95 1.665.961.513-.756 1.693-.44 1.759.472.086 1.192 1.836 1.192 1.922 0 .066-.912 1.246-1.228 1.76-.472.67.99 2.186.115 1.664-.96-.399-.824.465-1.688 1.288-1.289 1.076.522 1.95-.994.961-1.665-.756-.513-.44-1.693.472-1.759 1.192-.086 1.192-1.836 0-1.922-.912-.066-1.228-1.246-.472-1.76.99-.67.115-2.186-.96-1.664-.824.399-1.688-.465-1.289-1.288.522-1.076-.994-1.95-1.665-.961-.513.756-1.693.44-1.759-.472ZM8 13A5 5 0 1 0 8 3a5 5 0 0 0 0 10Z",clipRule:"evenodd"})),v5=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",...t},T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M2 2.75A2.75 2.75 0 0 1 4.75 0h6.5A2.75 2.75 0 0 1 14 2.75v10.5A2.75 2.75 0 0 1 11.25 16h-6.5A2.75 2.75 0 0 1 2 13.25v-.5a.75.75 0 0 1 1.5 0v.5c0 .69.56 1.25 1.25 1.25h6.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25h-6.5c-.69 0-1.25.56-1.25 1.25v.5a.75.75 0 0 1-1.5 0v-.5Z",clipRule:"evenodd"}),T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M8.78 7.47a.75.75 0 0 1 0 1.06l-2.25 2.25a.75.75 0 1 1-1.06-1.06l.97-.97H1.75a.75.75 0 0 1 0-1.5h4.69l-.97-.97a.75.75 0 0 1 1.06-1.06l2.25 2.25Z",clipRule:"evenodd"})),b5=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{d:"M12.227 11.52a5.477 5.477 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.478 4.478 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5z"}),T.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907z"})),y5=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor",...t},T.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.502 5.502 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.502 5.502 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547z",clipRule:"evenodd"}),T.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),S5=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25V2.75ZM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25H2.75Z",clipRule:"evenodd"}),T.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06l2.25-2.25Z",clipRule:"evenodd"})),T5=t=>T.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none",...t},T.createElement("g",{fill:"currentColor"},T.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),T.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),Ff=T.forwardRef(function({kind:t,initialSelection:e,onActiveDeviceChange:n,onDeviceListChange:i,onDeviceSelectError:a,exactMatch:r,track:s,requestPermissions:o,onError:l,...c},u){const d=Sd(),f=T.useRef("default"),h=T.useCallback(k=>{d&&d.emit(L.MediaDevicesError,k),l==null||l(k)},[d,l]),{devices:v,activeDeviceId:g,setActiveMediaDevice:C,className:m}=t5({kind:t,room:d,track:s,requestPermissions:o,onError:h});T.useEffect(()=>{e!==void 0&&C(e)},[C]),T.useEffect(()=>{typeof i=="function"&&i(v)},[i,v]),T.useEffect(()=>{g!==f.current&&(n==null||n(g)),f.current=g},[g]);const b=async k=>{try{await C(k,{exact:r??!0})}catch(_){if(_ instanceof Error)a==null||a(_);else throw _}},S=T.useMemo(()=>Og(c,{className:m},{className:"lk-list"}),[m,c]),p=!!v.find(k=>k.label.toLowerCase().startsWith("default"));function y(k,_,O){return k===_||!p&&O===0&&_==="default"}return T.createElement("ul",{ref:u,...S},v.map((k,_)=>T.createElement("li",{key:k.deviceId,id:k.deviceId,"data-lk-active":y(k.deviceId,g,_),"aria-selected":y(k.deviceId,g,_),role:"option"},T.createElement("button",{className:"lk-button",onClick:()=>b(k.deviceId)},k.label))))}),C5=T.forwardRef(function({label:t,...e},n){const i=xg(),{mergedProps:a,canPlayAudio:r}=n5({room:i,props:e}),{mergedProps:s,canPlayVideo:o}=i5({room:i,props:a}),{style:l,...c}=s;return l.display=r&&o?"none":"block",T.createElement("button",{ref:n,style:l,...c},t??`Start ${r?"Video":"Audio"}`)});function k5(t,e){switch(t){case D.Source.Microphone:return e?T.createElement(y5,null):T.createElement(b5,null);case D.Source.Camera:return e?T.createElement(m5,null):T.createElement(h5,null);case D.Source.ScreenShare:return e?T.createElement(T5,null):T.createElement(S5,null);default:return}}const Vf=T.forwardRef(function({showIcon:t,...e},n){const{buttonProps:i,enabled:a}=r5(e),[r,s]=T.useState(!1);return T.useEffect(()=>{s(!0)},[]),r&&T.createElement("button",{ref:n,...i},(t??!0)&&k5(e.source,a),e.children)});function E5(t,e={}){const[n,i]=T.useState(_m(t)),[a,r]=T.useState(n==null?void 0:n.isMuted),[s,o]=T.useState(n==null?void 0:n.isSubscribed),[l,c]=T.useState(n==null?void 0:n.track),[u,d]=T.useState("landscape"),f=T.useRef(),{className:h,trackObserver:v}=T.useMemo(()=>hU(t),[t.participant.sid??t.participant.identity,t.source,_g(t)&&t.publication.trackSid]);return T.useEffect(()=>{const g=v.subscribe(C=>{Se.debug("update track",C),i(C),r(C==null?void 0:C.isMuted),o(C==null?void 0:C.isSubscribed),c(C==null?void 0:C.track)});return()=>g==null?void 0:g.unsubscribe()},[v]),T.useEffect(()=>{var g,C;return l&&(f.current&&l.detach(f.current),(g=e.element)!=null&&g.current&&!(t.participant.isLocal&&(l==null?void 0:l.kind)==="audio")&&l.attach(e.element.current)),f.current=(C=e.element)==null?void 0:C.current,()=>{f.current&&(l==null||l.detach(f.current))}},[l,e.element]),T.useEffect(()=>{var g,C;if(typeof((g=n==null?void 0:n.dimensions)==null?void 0:g.width)=="number"&&typeof((C=n==null?void 0:n.dimensions)==null?void 0:C.height)=="number"){const m=n.dimensions.width>n.dimensions.height?"landscape":"portrait";d(m)}},[n]),{publication:n,isMuted:a,isSubscribed:s,track:l,elementProps:Og(e.props,{className:h,"data-lk-local-participant":t.participant.isLocal,"data-lk-source":n==null?void 0:n.source,...(n==null?void 0:n.kind)==="video"&&{"data-lk-orientation":u}})}}var Hf,py;function _5(){if(py)return Hf;py=1;var t="Expected a function",e=NaN,n="[object Symbol]",i=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt,l=typeof nc=="object"&&nc&&nc.Object===Object&&nc,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),d=Object.prototype,f=d.toString,h=Math.max,v=Math.min,g=function(){return u.Date.now()};function C(y,k,_){var O,w,R,N,z,Z,fe=0,Ge=!1,F=!1,G=!0;if(typeof y!="function")throw new TypeError(t);k=p(k)||0,m(_)&&(Ge=!!_.leading,F="maxWait"in _,R=F?h(p(_.maxWait)||0,k):R,G="trailing"in _?!!_.trailing:G);function Y(Ie){var Hn=O,Ki=w;return O=w=void 0,fe=Ie,N=y.apply(Ki,Hn),N}function re(Ie){return fe=Ie,z=setTimeout(Rt,k),Ge?Y(Ie):N}function Te(Ie){var Hn=Ie-Z,Ki=Ie-fe,Al=k-Hn;return F?v(Al,R-Ki):Al}function Qt(Ie){var Hn=Ie-Z,Ki=Ie-fe;return Z===void 0||Hn>=k||Hn<0||F&&Ki>=R}function Rt(){var Ie=g();if(Qt(Ie))return Ut(Ie);z=setTimeout(Rt,Te(Ie))}function Ut(Ie){return z=void 0,G&&O?Y(Ie):(O=w=void 0,N)}function Jt(){z!==void 0&&clearTimeout(z),fe=0,O=Z=w=z=void 0}function un(){return z===void 0?N:Ut(g())}function ui(){var Ie=g(),Hn=Qt(Ie);if(O=arguments,w=this,Z=Ie,Hn){if(z===void 0)return re(Z);if(F)return z=setTimeout(Rt,k),Y(Z)}return z===void 0&&(z=setTimeout(Rt,k)),N}return ui.cancel=Jt,ui.flush=un,ui}function m(y){var k=typeof y;return!!y&&(k=="object"||k=="function")}function b(y){return!!y&&typeof y=="object"}function S(y){return typeof y=="symbol"||b(y)&&f.call(y)==n}function p(y){if(typeof y=="number")return y;if(S(y))return e;if(m(y)){var k=typeof y.valueOf=="function"?y.valueOf():y;y=m(k)?k+"":k}if(typeof y!="string")return y===0?y:+y;y=y.replace(i,"");var _=r.test(y);return _||s.test(y)?o(y.slice(2),_?2:8):a.test(y)?e:+y}return Hf=C,Hf}_5();const w5=T.forwardRef(function({trackRef:t,onSubscriptionStatusChanged:e,volume:n,...i},a){const r=FU(t),s=T.useRef(null);T.useImperativeHandle(a,()=>s.current);const{elementProps:o,isSubscribed:l,track:c,publication:u}=E5(r,{element:s,props:i});return T.useEffect(()=>{e==null||e(!!l)},[l,e]),T.useEffect(()=>{c===void 0||n===void 0||(c instanceof uE?c.setVolume(n):Se.warn("Volume can only be set on remote audio tracks."))},[n,c]),T.useEffect(()=>{u===void 0||i.muted===void 0||(u instanceof fE?u.setEnabled(!i.muted):Se.warn("Can only call setEnabled on remote track publications."))},[i.muted,u,c]),T.createElement("audio",{ref:s,...o})});function R5({room:t,volume:e,muted:n}){const i=s5([D.Source.Microphone,D.Source.ScreenShareAudio,D.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0,room:t}).filter(a=>!a.participant.isLocal&&a.publication.kind===D.Kind.Audio);return T.createElement("div",{style:{display:"none"}},i.map(a=>T.createElement(w5,{key:sU(a),trackRef:a,volume:e,muted:n})))}function gy({kind:t,initialSelection:e,onActiveDeviceChange:n,tracks:i,requestPermissions:a=!1,...r}){const[s,o]=T.useState(!1),[l,c]=T.useState([]),[u,d]=T.useState(!0),[f,h]=T.useState(a),v=(b,S)=>{Se.debug("handle device change"),o(!1),n==null||n(b,S)},g=T.useRef(null),C=T.useRef(null);T.useLayoutEffect(()=>{s&&h(!0)},[s]),T.useLayoutEffect(()=>{let b;return g.current&&C.current&&(l||u)&&(b=oU(g.current,C.current,(S,p)=>{C.current&&Object.assign(C.current.style,{left:`${S}px`,top:`${p}px`})})),d(!1),()=>{b==null||b()}},[g,C,l,u]);const m=T.useCallback(b=>{C.current&&b.target!==g.current&&s&&lU(C.current,b)&&o(!1)},[s,C,g]);return T.useEffect(()=>(document.addEventListener("click",m),()=>{document.removeEventListener("click",m)}),[m]),T.createElement(T.Fragment,null,T.createElement("button",{className:"lk-button lk-button-menu","aria-pressed":s,...r,onClick:()=>o(!s),ref:g},r.children),!r.disabled&&T.createElement("div",{className:"lk-device-menu",ref:C,style:{visibility:s?"visible":"hidden"}},t?T.createElement(Ff,{initialSelection:e,onActiveDeviceChange:b=>v(t,b),onDeviceListChange:c,kind:t,track:i==null?void 0:i[t],requestPermissions:f}):T.createElement(T.Fragment,null,T.createElement("div",{className:"lk-device-menu-heading"},"Audio inputs"),T.createElement(Ff,{kind:"audioinput",onActiveDeviceChange:b=>v("audioinput",b),onDeviceListChange:c,track:i==null?void 0:i.audioinput,requestPermissions:f}),T.createElement("div",{className:"lk-device-menu-heading"},"Video inputs"),T.createElement(Ff,{kind:"videoinput",onActiveDeviceChange:b=>v("videoinput",b),onDeviceListChange:c,track:i==null?void 0:i.videoinput,requestPermissions:f}))))}function x5({props:t}){const{dispatch:e,state:n}=WE().widget,i="lk-button lk-settings-toggle";return{mergedProps:T.useMemo(()=>Va(t,{className:i,onClick:()=>{e&&e({msg:"toggle_settings"})},"aria-pressed":n!=null&&n.showSettings?"true":"false"}),[t,i,e,n])}}const O5=T.forwardRef(function(t,e){const{mergedProps:n}=x5({props:t});return T.createElement("button",{ref:e,...n},t.children)}),A5=t=>{switch(t){case D.Source.Camera:return 1;case D.Source.Microphone:return 2;case D.Source.ScreenShare:return 3;default:return 0}};function M5({variation:t,controls:e,saveUserChoices:n=!0,onDeviceError:i,...a}){var r;const[s,o]=T.useState(!1),l=BU();T.useEffect(()=>{var w,R;((w=l==null?void 0:l.widget.state)==null?void 0:w.showChat)!==void 0&&o((R=l==null?void 0:l.widget.state)==null?void 0:R.showChat)},[(r=l==null?void 0:l.widget.state)==null?void 0:r.showChat]);const c=$U(`(max-width: ${s?1e3:760}px)`)?"minimal":"verbose";t??(t=c);const u={leave:!0,...e},d=e5();if(!d)u.camera=!1,u.chat=!1,u.microphone=!1,u.screenShare=!1;else{const w=R=>d.canPublish&&(d.canPublishSources.length===0||d.canPublishSources.includes(A5(R)));u.camera??(u.camera=w(D.Source.Camera)),u.microphone??(u.microphone=w(D.Source.Microphone)),u.screenShare??(u.screenShare=w(D.Source.ScreenShare)),u.chat??(u.chat=d.canPublishData&&(e==null?void 0:e.chat))}const f=T.useMemo(()=>t==="minimal"||t==="verbose",[t]),h=T.useMemo(()=>t==="textOnly"||t==="verbose",[t]),v=fU(),[g,C]=T.useState(!1),m=T.useCallback(w=>{C(w)},[C]),b=Og({className:"lk-control-bar"},a),{saveAudioInputEnabled:S,saveVideoInputEnabled:p,saveAudioInputDeviceId:y,saveVideoInputDeviceId:k}=c5({preventSave:!n}),_=T.useCallback((w,R)=>R?S(w):null,[S]),O=T.useCallback((w,R)=>R?p(w):null,[p]);return T.createElement("div",{...b},u.microphone&&T.createElement("div",{className:"lk-button-group"},T.createElement(Vf,{source:D.Source.Microphone,showIcon:f,onChange:_,onDeviceError:w=>i==null?void 0:i({source:D.Source.Microphone,error:w})},h&&"Microphone"),T.createElement("div",{className:"lk-button-group-menu"},T.createElement(gy,{kind:"audioinput",onActiveDeviceChange:(w,R)=>y(R??"default")}))),u.camera&&T.createElement("div",{className:"lk-button-group"},T.createElement(Vf,{source:D.Source.Camera,showIcon:f,onChange:O,onDeviceError:w=>i==null?void 0:i({source:D.Source.Camera,error:w})},h&&"Camera"),T.createElement("div",{className:"lk-button-group-menu"},T.createElement(gy,{kind:"videoinput",onActiveDeviceChange:(w,R)=>k(R??"default")}))),u.screenShare&&v&&T.createElement(Vf,{source:D.Source.ScreenShare,captureOptions:{audio:!0,selfBrowserSurface:"include"},showIcon:f,onChange:m,onDeviceError:w=>i==null?void 0:i({source:D.Source.ScreenShare,error:w})},h&&(g?"Stop screen share":"Share screen")),u.chat&&T.createElement(d5,null,f&&T.createElement(p5,null),h&&"Chat"),u.settings&&T.createElement(O5,null,f&&T.createElement(g5,null),h&&"Settings"),u.leave&&T.createElement(f5,null,f&&T.createElement(v5,null),h&&"Leave"),T.createElement(C5,null))}const D5=()=>{const{teacherId:t}=MC(),{userRole:e,currentUserId:n}=Di.useContext(Ar),[i,a]=T.useState(""),[r,s]=T.useState(null),o=td(),l="wss://your-livekit-server.io";return T.useEffect(()=>{if(e==="student"&&pe.getRequestStatus(n,t)!=="approved"){alert("Debes solicitar acceso al profesor primero."),o(`/chat/${t}`);return}a("ey_MOCK_TOKEN_FOR_MVP_PURPOSES_ONLY_ey")},[e,n,t,o]),i?x.jsxs("div",{className:"flex h-[calc(100vh-100px)] gap-4 pt-4",children:[x.jsx("div",{className:"flex-grow bg-[#262421] rounded-lg overflow-hidden flex flex-col shadow-2xl border border-[#302e2b] h-full",children:x.jsx("div",{className:"flex-grow relative p-4 h-full",children:x.jsx(KM,{teacherId:t})})}),x.jsxs("div",{className:"w-80 flex flex-col gap-4",children:[x.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-lg overflow-hidden flex flex-col h-1/3 relative",children:[x.jsx("button",{onClick:()=>o(e==="teacher"?"/dashboard":"/"),className:"absolute top-2 right-2 z-10 bg-red-600/80 hover:bg-red-600 text-white p-1 rounded-full text-xs px-3 transition-colors shadow-lg",children:"Salir"}),x.jsxs("div",{className:"bg-[#161512] p-3 border-b border-[#302e2b] flex justify-between items-center",children:[x.jsx("h3",{className:"font-bold text-white",children:"Sala de Audio"}),x.jsxs("div",{className:"flex items-center gap-1",children:[x.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),x.jsx("span",{className:"text-xs text-[#bababa]",children:"En lnea"})]})]}),x.jsx("div",{className:"flex-grow flex flex-col justify-center items-center p-4 bg-gradient-to-b from-[#262421] to-[#1a1917]",children:i==="ey_MOCK_TOKEN_FOR_MVP_PURPOSES_ONLY_ey"||l.includes("your-livekit-server")?x.jsxs("div",{className:"h-full flex flex-col justify-center items-center text-center p-4",children:[x.jsx("div",{className:"w-16 h-16 bg-[#363431] rounded-full mx-auto flex items-center justify-center mb-2 border-2 border-[#bf811d] animate-pulse",children:x.jsx("span",{className:"text-2xl",children:""})}),x.jsx("p",{className:"text-sm text-[#bababa] font-bold",children:"Modo Demo (Audio Simulado)"}),x.jsxs("p",{className:"text-xs text-[#666] mt-2",children:["Conectado a: ",t]})]}):x.jsxs(XU,{video:!1,audio:!0,token:i,serverUrl:l,"data-lk-theme":"default",style:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center"},onError:c=>console.log("LiveKit Error:",c),children:[x.jsxs("div",{className:"mb-4 text-center",children:[x.jsx("div",{className:"w-16 h-16 bg-[#363431] rounded-full mx-auto flex items-center justify-center mb-2 border-2 border-[#bf811d]",children:x.jsx("span",{className:"text-2xl",children:""})}),x.jsxs("p",{className:"text-sm text-[#bababa]",children:["Conectado a: ",t]})]}),x.jsx(R5,{}),x.jsx(M5,{variation:"minimal",controls:{microphone:!0,camera:!1,screenShare:!1,leave:!1}})]})})]}),x.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-lg flex-grow flex flex-col overflow-hidden",children:[x.jsx("div",{className:"bg-[#161512] p-3 border-b border-[#302e2b]",children:x.jsx("h3",{className:"font-bold text-white",children:"Chat"})}),x.jsxs("div",{className:"flex-grow p-4 overflow-y-auto space-y-3",children:[x.jsxs("div",{className:"text-sm",children:[x.jsx("span",{className:"font-bold text-[#bf811d] mr-2",children:"GM Ana:"}),x.jsx("span",{className:"text-[#bababa]",children:"Bienvenidos a la clase de hoy. Vamos a ver la Defensa Siciliana."})]}),x.jsxs("div",{className:"text-sm",children:[x.jsx("span",{className:"font-bold text-blue-400 mr-2",children:"Alumno1:"}),x.jsx("span",{className:"text-[#bababa]",children:"Genial!"})]})]}),x.jsx("div",{className:"p-3 border-t border-[#302e2b] bg-[#161512]",children:x.jsx("input",{type:"text",placeholder:"Enviar mensaje...",className:"w-full bg-[#262421] border border-[#302e2b] rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-[#bf811d]"})})]})]})]}):x.jsx("div",{className:"text-center mt-10",children:"Cargando aula..."})},P5=()=>{const{teacherId:t}=MC(),{userRole:e,currentUserId:n}=Di.useContext(Ar),i=td(),[a,r]=T.useState([]),[s,o]=T.useState(""),[l,c]=T.useState(null),[u,d]=T.useState(null),f=T.useRef(null);T.useEffect(()=>{const v=pe.getTeacherById(t);v&&d(v);const g=pe.getRequestStatus(n,t);c(g),r(pe.getMessages(n,t));const C=pe.subscribeToChat(n,t,m=>{r(m),c(pe.getRequestStatus(n,t))});return()=>C()},[t,n]),T.useEffect(()=>{var v;(v=f.current)==null||v.scrollIntoView({behavior:"smooth"})},[a]);const h=()=>{s.trim()&&(l?pe.sendMessage(n,t,s,"student"):(pe.createRequest(n,t,s),c("pending")),o(""))};return u?x.jsxs("div",{className:"max-w-2xl mx-auto h-[calc(100vh-100px)] flex flex-col pt-4",children:[x.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-t-lg p-4 flex items-center justify-between shadow-lg",children:[x.jsxs("div",{className:"flex items-center gap-4",children:[x.jsx("img",{src:u.image,alt:u.name,className:"w-12 h-12 rounded-full object-cover border border-[#403d39]"}),x.jsxs("div",{children:[x.jsx("h2",{className:"font-bold text-white text-lg",children:u.name}),x.jsx("p",{className:"text-xs text-[#bababa]",children:"Chat Directo"})]})]}),x.jsxs("div",{className:"flex items-center gap-2",children:[l==="approved"&&x.jsxs("button",{onClick:()=>i(`/room/${t}`),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold flex items-center gap-2 text-sm transition-colors",children:[x.jsx(DA,{size:16})," Ir al Aula"]}),l==="pending"&&x.jsxs("div",{className:"bg-[#bf811d]/20 text-[#bf811d] border border-[#bf811d]/30 px-3 py-1 rounded text-xs flex items-center gap-2 font-bold",children:[x.jsx(NA,{size:14})," Solicitud Pendiente"]}),!l&&x.jsxs("div",{className:"bg-gray-700/50 text-gray-400 px-3 py-1 rounded text-xs flex items-center gap-2",children:[x.jsx(qA,{size:14})," Sin conexin"]})]})]}),x.jsxs("div",{className:"flex-grow bg-[#161512] border-x border-[#302e2b] p-4 overflow-y-auto space-y-3 relative",children:[a.length===0?x.jsxs("div",{className:"text-center text-[#666] mt-10",children:[x.jsxs("p",{className:"mb-2",children:["Enva un mensaje para solicitar clases con ",x.jsx("strong",{children:u.name}),"."]}),x.jsx("p",{className:"text-sm",children:"El profesor debe aprobar tu solicitud para acceder al aula."})]}):a.map(v=>x.jsx("div",{className:`flex ${v.sender==="student"?"justify-end":"justify-start"}`,children:x.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 text-sm ${v.sender==="student"?"bg-[#2b5f8f] text-white rounded-br-none":"bg-[#262421] text-[#bababa] border border-[#302e2b] rounded-bl-none"}`,children:[x.jsx("p",{children:v.text}),x.jsx("span",{className:"text-[10px] opacity-50 block text-right mt-1",children:new Date(v.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},v.id)),x.jsx("div",{ref:f})]}),x.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-b-lg p-3 flex gap-2",children:[x.jsx("input",{type:"text",value:s,onChange:v=>o(v.target.value),onKeyDown:v=>v.key==="Enter"&&h(),placeholder:l==="approved"?"Escribe un mensaje...":"Escribe para solicitar conexin...",className:"flex-grow bg-[#161512] border border-[#302e2b] text-white text-sm rounded px-3 focus:outline-none focus:border-[#bf811d] transition-colors"}),x.jsx("button",{onClick:h,disabled:!s.trim(),className:"bg-[#bf811d] text-white p-2 rounded hover:bg-[#a66f19] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:x.jsx(HA,{size:18})})]})]}):x.jsx("div",{className:"p-8 text-center",children:"Cargando..."})},N5=({teacherId:t})=>{const[e,n]=T.useState([]);T.useEffect(()=>{n(pe.getRequestsForTeacher(t));const s=setInterval(()=>{n(pe.getRequestsForTeacher(t))},2e3);return()=>clearInterval(s)},[t]);const i=s=>{pe.updateRequestStatus(s,t,"approved"),n(pe.getRequestsForTeacher(t)),alert("Estudiante aprobado. Ahora tiene acceso al aula.")},a=s=>{pe.updateRequestStatus(s,t,"rejected"),n(pe.getRequestsForTeacher(t))},r=()=>{const s="student_"+Math.floor(Math.random()*1e3);pe.createRequest(s,t,"Hola profesor, me gustara tomar clases."),n(pe.getRequestsForTeacher(t)),alert("Simulacin: Solicitud de estudiante creada.")};return e.length===0?x.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b] mb-8 text-center opacity-70 hover:opacity-100 transition-opacity",children:[x.jsxs("h2",{className:"text-xl font-bold text-white mb-2 flex items-center justify-center gap-2",children:[x.jsx(E0,{className:"text-[#666]"})," Solicitudes Pendientes"]}),x.jsx("p",{className:"text-[#bababa] text-sm mb-4",children:"No tienes solicitudes nuevas en este momento."}),x.jsx("button",{onClick:r,className:"text-xs text-[#bf811d] border border-[#bf811d] px-3 py-1 rounded hover:bg-[#bf811d] hover:text-white transition-colors",children:"Simular Solicitud de Alumno (Demo)"})]}):x.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b] mb-8",children:[x.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[x.jsx(E0,{className:"text-[#bf811d]"})," Solicitudes Pendientes",x.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.length})]}),x.jsx("div",{className:"space-y-3",children:e.map(s=>x.jsxs("div",{className:"bg-[#161512] p-4 rounded-lg flex justify-between items-center border border-[#302e2b]",children:[x.jsxs("div",{children:[x.jsxs("p",{className:"font-bold text-white",children:["Estudiante #",s.studentId]}),x.jsx("p",{className:"text-xs text-[#bababa]",children:new Date(s.timestamp).toLocaleDateString()})]}),x.jsxs("div",{className:"flex gap-2",children:[x.jsx(Da,{to:`/chat/${t}`,className:"p-2 bg-[#363431] text-white rounded hover:bg-[#403d39]",title:"Ver Mensajes",children:x.jsx(FA,{size:18})}),x.jsx("button",{onClick:()=>i(s.studentId),className:"p-2 bg-green-600/20 text-green-500 rounded hover:bg-green-600/30 border border-green-600/30",children:x.jsx(AA,{size:18})}),x.jsx("button",{onClick:()=>a(s.studentId),className:"p-2 bg-red-600/20 text-red-500 rounded hover:bg-red-600/30 border border-red-600/30",children:x.jsx(JA,{size:18})})]})]},s.id))})]})},L5=()=>{const{userRole:t,currentUserId:e}=Di.useContext(Ar),[n,i]=T.useState(null),[a,r]=T.useState(!0);T.useEffect(()=>{if(t!=="teacher")return;(async()=>{pe.initialize();const u=pe.getTeacherById(e);u?i(u):console.error("Teacher not found in mock DB"),r(!1)})()},[t,e]);const s=c=>c<=20?.6:c<=50?.7:.8,o=async()=>{if(!n)return;const c=n.classesGiven+1;let u=.6;c>50?u=.8:c>20&&(u=.7);const f=n.price*u,h=pe.updateTeacher(e,{classesGiven:c,earnings:n.earnings+f});h?(i(h),alert(`Clase terminada! Ganaste $${f.toFixed(2)} (${u*100}%)`)):alert("Error al actualizar datos.")};if(t!=="teacher")return x.jsxs("div",{className:"text-center mt-10 text-xl",children:["Acceso denegado. ",x.jsx("br",{}),x.jsx("span",{className:"text-sm text-[#bababa]",children:"Debes ser profesor."})]});if(a)return x.jsx("div",{className:"text-center mt-10",children:"Cargando panel..."});if(!n)return x.jsx("div",{className:"text-center mt-10",children:"No se encontraron datos del profesor."});const l=s(n.classesGiven+1);return x.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[x.jsxs("h1",{className:"text-3xl font-bold text-white mb-8",children:["Panel de Profesor (",n.name,")"]}),x.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[x.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b]",children:[x.jsxs("div",{className:"flex items-center gap-3 text-[#bf811d] mb-2",children:[x.jsx(IA,{})," ",x.jsx("span",{className:"font-bold",children:"Ganancias Totales"})]}),x.jsxs("p",{className:"text-3xl text-white",children:["$",n.earnings.toFixed(2)]})]}),x.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b]",children:[x.jsxs("div",{className:"flex items-center gap-3 text-[#bf811d] mb-2",children:[x.jsx(xA,{})," ",x.jsx("span",{className:"font-bold",children:"Clases Dadas"})]}),x.jsx("p",{className:"text-3xl text-white",children:n.classesGiven})]}),x.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b]",children:[x.jsxs("div",{className:"flex items-center gap-3 text-[#bf811d] mb-2",children:[x.jsx(GA,{})," ",x.jsx("span",{className:"font-bold",children:"Nivel de Comisin"})]}),x.jsxs("p",{className:"text-3xl text-white",children:[(l*100).toFixed(0),"%"]}),x.jsx("p",{className:"text-xs text-[#bababa] mt-2",children:n.classesGiven<=20?`Faltan ${21-n.classesGiven} para 70%`:n.classesGiven<=50?`Faltan ${51-n.classesGiven} para 80%`:"Nivel Mximo"})]})]}),x.jsx(N5,{teacherId:e}),x.jsxs("div",{className:"bg-[#262421] p-8 rounded-lg border border-[#302e2b] text-center mt-12",children:[x.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Control de Clase"}),x.jsx("p",{className:"mb-6",children:"Al terminar una clase, se registrar y se sumar el saldo a tu cuenta."}),x.jsxs("div",{className:"flex justify-center gap-4",children:[x.jsx(Da,{to:`/room/${e}`,className:"bg-[#363431] hover:bg-[#403d39] text-white font-bold py-3 px-8 rounded-full text-lg transition-all border border-[#504e4b]",children:"Entrar al Aula"}),x.jsx("button",{onClick:o,className:"bg-[#bf811d] hover:bg-[#a66f19] text-white font-bold py-3 px-8 rounded-full text-lg transition-all transform hover:scale-105 shadow-lg shadow-orange-900/20",children:"Terminar Clase Actual"})]})]})]})},Ar=Di.createContext();function I5(){const[t,e]=T.useState("student"),n=t==="teacher"?"teacher1":"student1";return x.jsx(Ar.Provider,{value:{userRole:t,setUserRole:e,currentUserId:n},children:x.jsx(fA,{basename:"/TopChess",children:x.jsxs("div",{className:"min-h-screen bg-[#161512] text-[#bababa] font-sans",children:[x.jsx(U5,{}),x.jsx("main",{className:"container mx-auto p-4",children:x.jsxs(FO,{children:[x.jsx(vo,{path:"/",element:x.jsx(XA,{})}),x.jsx(vo,{path:"/chat/:teacherId",element:x.jsx(P5,{})}),x.jsx(vo,{path:"/room/:teacherId",element:x.jsx(D5,{})}),x.jsx(vo,{path:"/dashboard",element:x.jsx(L5,{})})]})})]})})})}function U5(){const{userRole:t,setUserRole:e}=Di.useContext(Ar),n=td();return x.jsxs("nav",{className:"bg-[#262421] border-b border-[#302e2b] p-4 flex justify-between items-center",children:[x.jsxs(Da,{to:"/",className:"text-xl font-bold flex items-center gap-2 text-[#bababa] hover:text-white transition-colors",children:[x.jsx("span",{className:"text-2xl",children:""})," AjedrezTopChess"]}),x.jsxs("div",{className:"flex items-center gap-6",children:[x.jsxs("div",{className:"flex bg-[#161512] rounded-lg p-1",children:[x.jsx("button",{onClick:()=>e("student"),className:`px-4 py-1 rounded-md text-sm transition-all ${t==="student"?"bg-[#363431] text-white shadow-sm":"text-[#666] hover:text-[#999]"}`,children:"Soy Alumno"}),x.jsx("button",{onClick:()=>{e("teacher"),n("/dashboard")},className:`px-4 py-1 rounded-md text-sm transition-all ${t==="teacher"?"bg-[#363431] text-white shadow-sm":"text-[#666] hover:text-[#999]"}`,children:"Soy Profesor"})]}),t==="teacher"&&x.jsxs(Da,{to:"/dashboard",className:"flex items-center gap-2 px-4 py-2 rounded bg-[#363431] hover:bg-[#403d39] text-[#bababa] hover:text-white transition-colors",children:[x.jsx(jA,{size:18}),"Panel"]})]})]})}Kx.createRoot(document.getElementById("root")).render(x.jsx(T.StrictMode,{children:x.jsx(I5,{})}));
