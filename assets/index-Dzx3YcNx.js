var d1=Object.defineProperty;var f1=(t,e,n)=>e in t?d1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Pe=(t,e,n)=>f1(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();function uh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function h1(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var a=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:function(){return t[i]}})}),n}var k0={exports:{}},qc={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var m1=Symbol.for("react.transitional.element"),p1=Symbol.for("react.fragment");function E0(t,e,n){var i=null;if(n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),"key"in e){n={};for(var a in e)a!=="key"&&(n[a]=e[a])}else n=e;return e=n.ref,{$$typeof:m1,type:t,key:i,ref:e!==void 0?e:null,props:n}}qc.Fragment=p1;qc.jsx=E0;qc.jsxs=E0;k0.exports=qc;var k=k0.exports,_0={exports:{}},te={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dh=Symbol.for("react.transitional.element"),g1=Symbol.for("react.portal"),v1=Symbol.for("react.fragment"),b1=Symbol.for("react.strict_mode"),y1=Symbol.for("react.profiler"),S1=Symbol.for("react.consumer"),T1=Symbol.for("react.context"),C1=Symbol.for("react.forward_ref"),k1=Symbol.for("react.suspense"),E1=Symbol.for("react.memo"),R0=Symbol.for("react.lazy"),_1=Symbol.for("react.activity"),vp=Symbol.iterator;function R1(t){return t===null||typeof t!="object"?null:(t=vp&&t[vp]||t["@@iterator"],typeof t=="function"?t:null)}var x0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w0=Object.assign,O0={};function nr(t,e,n){this.props=t,this.context=e,this.refs=O0,this.updater=n||x0}nr.prototype.isReactComponent={};nr.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};nr.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function A0(){}A0.prototype=nr.prototype;function fh(t,e,n){this.props=t,this.context=e,this.refs=O0,this.updater=n||x0}var hh=fh.prototype=new A0;hh.constructor=fh;w0(hh,nr.prototype);hh.isPureReactComponent=!0;var bp=Array.isArray;function Ld(){}var De={H:null,A:null,T:null,S:null},M0=Object.prototype.hasOwnProperty;function mh(t,e,n){var i=n.ref;return{$$typeof:dh,type:t,key:e,ref:i!==void 0?i:null,props:n}}function x1(t,e){return mh(t.type,e,t.props)}function ph(t){return typeof t=="object"&&t!==null&&t.$$typeof===dh}function w1(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var yp=/\/+/g;function Su(t,e){return typeof t=="object"&&t!==null&&t.key!=null?w1(""+t.key):e.toString(36)}function O1(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Ld,Ld):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function cs(t,e,n,i,a){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var r=!1;if(t===null)r=!0;else switch(s){case"bigint":case"string":case"number":r=!0;break;case"object":switch(t.$$typeof){case dh:case g1:r=!0;break;case R0:return r=t._init,cs(r(t._payload),e,n,i,a)}}if(r)return a=a(t),r=i===""?"."+Su(t,0):i,bp(a)?(n="",r!=null&&(n=r.replace(yp,"$&/")+"/"),cs(a,e,n,"",function(c){return c})):a!=null&&(ph(a)&&(a=x1(a,n+(a.key==null||t&&t.key===a.key?"":(""+a.key).replace(yp,"$&/")+"/")+r)),e.push(a)),1;r=0;var o=i===""?".":i+":";if(bp(t))for(var l=0;l<t.length;l++)i=t[l],s=o+Su(i,l),r+=cs(i,e,n,s,a);else if(l=R1(t),typeof l=="function")for(t=l.call(t),l=0;!(i=t.next()).done;)i=i.value,s=o+Su(i,l++),r+=cs(i,e,n,s,a);else if(s==="object"){if(typeof t.then=="function")return cs(O1(t),e,n,i,a);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return r}function Qo(t,e,n){if(t==null)return t;var i=[],a=0;return cs(t,i,"","",function(s){return e.call(n,s,a++)}),i}function A1(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Sp=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},M1={map:Qo,forEach:function(t,e,n){Qo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Qo(t,function(){e++}),e},toArray:function(t){return Qo(t,function(e){return e})||[]},only:function(t){if(!ph(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};te.Activity=_1;te.Children=M1;te.Component=nr;te.Fragment=v1;te.Profiler=y1;te.PureComponent=fh;te.StrictMode=b1;te.Suspense=k1;te.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=De;te.__COMPILER_RUNTIME={__proto__:null,c:function(t){return De.H.useMemoCache(t)}};te.cache=function(t){return function(){return t.apply(null,arguments)}};te.cacheSignal=function(){return null};te.cloneElement=function(t,e,n){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var i=w0({},t.props),a=t.key;if(e!=null)for(s in e.key!==void 0&&(a=""+e.key),e)!M0.call(e,s)||s==="key"||s==="__self"||s==="__source"||s==="ref"&&e.ref===void 0||(i[s]=e[s]);var s=arguments.length-2;if(s===1)i.children=n;else if(1<s){for(var r=Array(s),o=0;o<s;o++)r[o]=arguments[o+2];i.children=r}return mh(t.type,a,i)};te.createContext=function(t){return t={$$typeof:T1,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:S1,_context:t},t};te.createElement=function(t,e,n){var i,a={},s=null;if(e!=null)for(i in e.key!==void 0&&(s=""+e.key),e)M0.call(e,i)&&i!=="key"&&i!=="__self"&&i!=="__source"&&(a[i]=e[i]);var r=arguments.length-2;if(r===1)a.children=n;else if(1<r){for(var o=Array(r),l=0;l<r;l++)o[l]=arguments[l+2];a.children=o}if(t&&t.defaultProps)for(i in r=t.defaultProps,r)a[i]===void 0&&(a[i]=r[i]);return mh(t,s,a)};te.createRef=function(){return{current:null}};te.forwardRef=function(t){return{$$typeof:C1,render:t}};te.isValidElement=ph;te.lazy=function(t){return{$$typeof:R0,_payload:{_status:-1,_result:t},_init:A1}};te.memo=function(t,e){return{$$typeof:E1,type:t,compare:e===void 0?null:e}};te.startTransition=function(t){var e=De.T,n={};De.T=n;try{var i=t(),a=De.S;a!==null&&a(n,i),typeof i=="object"&&i!==null&&typeof i.then=="function"&&i.then(Ld,Sp)}catch(s){Sp(s)}finally{e!==null&&n.types!==null&&(e.types=n.types),De.T=e}};te.unstable_useCacheRefresh=function(){return De.H.useCacheRefresh()};te.use=function(t){return De.H.use(t)};te.useActionState=function(t,e,n){return De.H.useActionState(t,e,n)};te.useCallback=function(t,e){return De.H.useCallback(t,e)};te.useContext=function(t){return De.H.useContext(t)};te.useDebugValue=function(){};te.useDeferredValue=function(t,e){return De.H.useDeferredValue(t,e)};te.useEffect=function(t,e){return De.H.useEffect(t,e)};te.useEffectEvent=function(t){return De.H.useEffectEvent(t)};te.useId=function(){return De.H.useId()};te.useImperativeHandle=function(t,e,n){return De.H.useImperativeHandle(t,e,n)};te.useInsertionEffect=function(t,e){return De.H.useInsertionEffect(t,e)};te.useLayoutEffect=function(t,e){return De.H.useLayoutEffect(t,e)};te.useMemo=function(t,e){return De.H.useMemo(t,e)};te.useOptimistic=function(t,e){return De.H.useOptimistic(t,e)};te.useReducer=function(t,e,n){return De.H.useReducer(t,e,n)};te.useRef=function(t){return De.H.useRef(t)};te.useState=function(t){return De.H.useState(t)};te.useSyncExternalStore=function(t,e,n){return De.H.useSyncExternalStore(t,e,n)};te.useTransition=function(){return De.H.useTransition()};te.version="19.2.4";_0.exports=te;var x=_0.exports;const yi=uh(x);var D0={exports:{}},zc={},N0={exports:{}},P0={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(q,X){var ee=q.length;q.push(X);e:for(;0<ee;){var Ee=ee-1>>>1,Oe=q[Ee];if(0<a(Oe,X))q[Ee]=X,q[ee]=Oe,ee=Ee;else break e}}function n(q){return q.length===0?null:q[0]}function i(q){if(q.length===0)return null;var X=q[0],ee=q.pop();if(ee!==X){q[0]=ee;e:for(var Ee=0,Oe=q.length,Pn=Oe>>>1;Ee<Pn;){var Ln=2*(Ee+1)-1,Sn=q[Ln],Tn=Ln+1,Un=q[Tn];if(0>a(Sn,ee))Tn<Oe&&0>a(Un,Sn)?(q[Ee]=Un,q[Tn]=ee,Ee=Tn):(q[Ee]=Sn,q[Ln]=ee,Ee=Ln);else if(Tn<Oe&&0>a(Un,ee))q[Ee]=Un,q[Tn]=ee,Ee=Tn;else break e}}return X}function a(q,X){var ee=q.sortIndex-X.sortIndex;return ee!==0?ee:q.id-X.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var r=Date,o=r.now();t.unstable_now=function(){return r.now()-o}}var l=[],c=[],u=1,d=null,f=3,h=!1,g=!1,y=!1,T=!1,m=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;function b(q){for(var X=n(c);X!==null;){if(X.callback===null)i(c);else if(X.startTime<=q)i(c),X.sortIndex=X.expirationTime,e(l,X);else break;X=n(c)}}function C(q){if(y=!1,b(q),!g)if(n(l)!==null)g=!0,_||(_=!0,G());else{var X=n(c);X!==null&&At(C,X.startTime-q)}}var _=!1,w=-1,P=5,O=-1;function N(){return T?!0:!(t.unstable_now()-O<P)}function z(){if(T=!1,_){var q=t.unstable_now();O=q;var X=!0;try{e:{g=!1,y&&(y=!1,p(w),w=-1),h=!0;var ee=f;try{t:{for(b(q),d=n(l);d!==null&&!(d.expirationTime>q&&N());){var Ee=d.callback;if(typeof Ee=="function"){d.callback=null,f=d.priorityLevel;var Oe=Ee(d.expirationTime<=q);if(q=t.unstable_now(),typeof Oe=="function"){d.callback=Oe,b(q),X=!0;break t}d===n(l)&&i(l),b(q)}else i(l);d=n(l)}if(d!==null)X=!0;else{var Pn=n(c);Pn!==null&&At(C,Pn.startTime-q),X=!1}}break e}finally{d=null,f=ee,h=!1}X=void 0}}finally{X?G():_=!1}}}var G;if(typeof v=="function")G=function(){v(z)};else if(typeof MessageChannel<"u"){var de=new MessageChannel,at=de.port2;de.port1.onmessage=z,G=function(){at.postMessage(null)}}else G=function(){m(z,0)};function At(q,X){w=m(function(){q(t.unstable_now())},X)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(q){switch(f){case 1:case 2:case 3:var X=3;break;default:X=f}var ee=f;f=X;try{return q()}finally{f=ee}},t.unstable_requestPaint=function(){T=!0},t.unstable_runWithPriority=function(q,X){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var ee=f;f=q;try{return X()}finally{f=ee}},t.unstable_scheduleCallback=function(q,X,ee){var Ee=t.unstable_now();switch(typeof ee=="object"&&ee!==null?(ee=ee.delay,ee=typeof ee=="number"&&0<ee?Ee+ee:Ee):ee=Ee,q){case 1:var Oe=-1;break;case 2:Oe=250;break;case 5:Oe=1073741823;break;case 4:Oe=1e4;break;default:Oe=5e3}return Oe=ee+Oe,q={id:u++,callback:X,priorityLevel:q,startTime:ee,expirationTime:Oe,sortIndex:-1},ee>Ee?(q.sortIndex=ee,e(c,q),n(l)===null&&q===n(c)&&(y?(p(w),w=-1):y=!0,At(C,ee-Ee))):(q.sortIndex=Oe,e(l,q),g||h||(g=!0,_||(_=!0,G()))),q},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(q){var X=f;return function(){var ee=f;f=X;try{return q.apply(this,arguments)}finally{f=ee}}}})(P0);N0.exports=P0;var D1=N0.exports,L0={exports:{}},wt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N1=x;function U0(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Oi(){}var Rt={d:{f:Oi,r:function(){throw Error(U0(522))},D:Oi,C:Oi,L:Oi,m:Oi,X:Oi,S:Oi,M:Oi},p:0,findDOMNode:null},P1=Symbol.for("react.portal");function L1(t,e,n){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P1,key:i==null?null:""+i,children:t,containerInfo:e,implementation:n}}var zr=N1.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Fc(t,e){if(t==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}wt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Rt;wt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(U0(299));return L1(t,e,null,n)};wt.flushSync=function(t){var e=zr.T,n=Rt.p;try{if(zr.T=null,Rt.p=2,t)return t()}finally{zr.T=e,Rt.p=n,Rt.d.f()}};wt.preconnect=function(t,e){typeof t=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,Rt.d.C(t,e))};wt.prefetchDNS=function(t){typeof t=="string"&&Rt.d.D(t)};wt.preinit=function(t,e){if(typeof t=="string"&&e&&typeof e.as=="string"){var n=e.as,i=Fc(n,e.crossOrigin),a=typeof e.integrity=="string"?e.integrity:void 0,s=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;n==="style"?Rt.d.S(t,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:i,integrity:a,fetchPriority:s}):n==="script"&&Rt.d.X(t,{crossOrigin:i,integrity:a,fetchPriority:s,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};wt.preinitModule=function(t,e){if(typeof t=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var n=Fc(e.as,e.crossOrigin);Rt.d.M(t,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&Rt.d.M(t)};wt.preload=function(t,e){if(typeof t=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var n=e.as,i=Fc(n,e.crossOrigin);Rt.d.L(t,n,{crossOrigin:i,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};wt.preloadModule=function(t,e){if(typeof t=="string")if(e){var n=Fc(e.as,e.crossOrigin);Rt.d.m(t,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else Rt.d.m(t)};wt.requestFormReset=function(t){Rt.d.r(t)};wt.unstable_batchedUpdates=function(t,e){return t(e)};wt.useFormState=function(t,e,n){return zr.H.useFormState(t,e,n)};wt.useFormStatus=function(){return zr.H.useHostTransitionStatus()};wt.version="19.2.4";function I0(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(I0)}catch(t){console.error(t)}}I0(),L0.exports=wt;var U1=L0.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var it=D1,j0=x,I1=U1;function L(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function B0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ao(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function q0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function z0(t){if(t.tag===31){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Tp(t){if(Ao(t)!==t)throw Error(L(188))}function j1(t){var e=t.alternate;if(!e){if(e=Ao(t),e===null)throw Error(L(188));return e!==t?null:t}for(var n=t,i=e;;){var a=n.return;if(a===null)break;var s=a.alternate;if(s===null){if(i=a.return,i!==null){n=i;continue}break}if(a.child===s.child){for(s=a.child;s;){if(s===n)return Tp(a),t;if(s===i)return Tp(a),e;s=s.sibling}throw Error(L(188))}if(n.return!==i.return)n=a,i=s;else{for(var r=!1,o=a.child;o;){if(o===n){r=!0,n=a,i=s;break}if(o===i){r=!0,i=a,n=s;break}o=o.sibling}if(!r){for(o=s.child;o;){if(o===n){r=!0,n=s,i=a;break}if(o===i){r=!0,i=s,n=a;break}o=o.sibling}if(!r)throw Error(L(189))}}if(n.alternate!==i)throw Error(L(190))}if(n.tag!==3)throw Error(L(188));return n.stateNode.current===n?t:e}function F0(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t;for(t=t.child;t!==null;){if(e=F0(t),e!==null)return e;t=t.sibling}return null}var Ne=Object.assign,B1=Symbol.for("react.element"),Jo=Symbol.for("react.transitional.element"),Dr=Symbol.for("react.portal"),fs=Symbol.for("react.fragment"),V0=Symbol.for("react.strict_mode"),Ud=Symbol.for("react.profiler"),H0=Symbol.for("react.consumer"),fi=Symbol.for("react.context"),gh=Symbol.for("react.forward_ref"),Id=Symbol.for("react.suspense"),jd=Symbol.for("react.suspense_list"),vh=Symbol.for("react.memo"),Ii=Symbol.for("react.lazy"),Bd=Symbol.for("react.activity"),q1=Symbol.for("react.memo_cache_sentinel"),Cp=Symbol.iterator;function pr(t){return t===null||typeof t!="object"?null:(t=Cp&&t[Cp]||t["@@iterator"],typeof t=="function"?t:null)}var z1=Symbol.for("react.client.reference");function qd(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===z1?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case fs:return"Fragment";case Ud:return"Profiler";case V0:return"StrictMode";case Id:return"Suspense";case jd:return"SuspenseList";case Bd:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case Dr:return"Portal";case fi:return t.displayName||"Context";case H0:return(t._context.displayName||"Context")+".Consumer";case gh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case vh:return e=t.displayName||null,e!==null?e:qd(t.type)||"Memo";case Ii:e=t._payload,t=t._init;try{return qd(t(e))}catch{}}return null}var Nr=Array.isArray,W=j0.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ve=I1.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Pa={pending:!1,data:null,method:null,action:null},zd=[],hs=-1;function Qn(t){return{current:t}}function dt(t){0>hs||(t.current=zd[hs],zd[hs]=null,hs--)}function we(t,e){hs++,zd[hs]=t.current,t.current=e}var Vn=Qn(null),so=Qn(null),Wi=Qn(null),Jl=Qn(null);function Xl(t,e){switch(we(Wi,e),we(so,t),we(Vn,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?wg(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)e=wg(e),t=uS(e,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}dt(Vn),we(Vn,t)}function Fs(){dt(Vn),dt(so),dt(Wi)}function Fd(t){t.memoizedState!==null&&we(Jl,t);var e=Vn.current,n=uS(e,t.type);e!==n&&(we(so,t),we(Vn,n))}function Zl(t){so.current===t&&(dt(Vn),dt(so)),Jl.current===t&&(dt(Jl),vo._currentValue=Pa)}var Tu,kp;function xa(t){if(Tu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Tu=e&&e[1]||"",kp=-1<n.stack.indexOf(`
    at`)?" (<anonymous>)":-1<n.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Tu+t+kp}var Cu=!1;function ku(t,e){if(!t||Cu)return"";Cu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(e){var d=function(){throw Error()};if(Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(h){var f=h}Reflect.construct(t,[],d)}else{try{d.call()}catch(h){f=h}t.call(d.prototype)}}else{try{throw Error()}catch(h){f=h}(d=t())&&typeof d.catch=="function"&&d.catch(function(){})}}catch(h){if(h&&f&&typeof h.stack=="string")return[h.stack,f.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=i.DetermineComponentFrameRoot(),r=s[0],o=s[1];if(r&&o){var l=r.split(`
`),c=o.split(`
`);for(a=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;a<c.length&&!c[a].includes("DetermineComponentFrameRoot");)a++;if(i===l.length||a===c.length)for(i=l.length-1,a=c.length-1;1<=i&&0<=a&&l[i]!==c[a];)a--;for(;1<=i&&0<=a;i--,a--)if(l[i]!==c[a]){if(i!==1||a!==1)do if(i--,a--,0>a||l[i]!==c[a]){var u=`
`+l[i].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=i&&0<=a);break}}}finally{Cu=!1,Error.prepareStackTrace=n}return(n=t?t.displayName||t.name:"")?xa(n):""}function F1(t,e){switch(t.tag){case 26:case 27:case 5:return xa(t.type);case 16:return xa("Lazy");case 13:return t.child!==e&&e!==null?xa("Suspense Fallback"):xa("Suspense");case 19:return xa("SuspenseList");case 0:case 15:return ku(t.type,!1);case 11:return ku(t.type.render,!1);case 1:return ku(t.type,!0);case 31:return xa("Activity");default:return""}}function Ep(t){try{var e="",n=null;do e+=F1(t,n),n=t,t=t.return;while(t);return e}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}var Vd=Object.prototype.hasOwnProperty,bh=it.unstable_scheduleCallback,Eu=it.unstable_cancelCallback,V1=it.unstable_shouldYield,H1=it.unstable_requestPaint,Qt=it.unstable_now,G1=it.unstable_getCurrentPriorityLevel,G0=it.unstable_ImmediatePriority,K0=it.unstable_UserBlockingPriority,Wl=it.unstable_NormalPriority,K1=it.unstable_LowPriority,Y0=it.unstable_IdlePriority,Y1=it.log,Q1=it.unstable_setDisableYieldValue,Mo=null,Jt=null;function Gi(t){if(typeof Y1=="function"&&Q1(t),Jt&&typeof Jt.setStrictMode=="function")try{Jt.setStrictMode(Mo,t)}catch{}}var Xt=Math.clz32?Math.clz32:Z1,J1=Math.log,X1=Math.LN2;function Z1(t){return t>>>=0,t===0?32:31-(J1(t)/X1|0)|0}var Xo=256,Zo=262144,Wo=4194304;function wa(t){var e=t&42;if(e!==0)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Vc(t,e,n){var i=t.pendingLanes;if(i===0)return 0;var a=0,s=t.suspendedLanes,r=t.pingedLanes;t=t.warmLanes;var o=i&134217727;return o!==0?(i=o&~s,i!==0?a=wa(i):(r&=o,r!==0?a=wa(r):n||(n=o&~t,n!==0&&(a=wa(n))))):(o=i&~s,o!==0?a=wa(o):r!==0?a=wa(r):n||(n=i&~t,n!==0&&(a=wa(n)))),a===0?0:e!==0&&e!==a&&!(e&s)&&(s=a&-a,n=e&-e,s>=n||s===32&&(n&4194048)!==0)?e:a}function Do(t,e){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)===0}function W1(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Q0(){var t=Wo;return Wo<<=1,!(Wo&62914560)&&(Wo=4194304),t}function _u(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function No(t,e){t.pendingLanes|=e,e!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function $1(t,e,n,i,a,s){var r=t.pendingLanes;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=n,t.entangledLanes&=n,t.errorRecoveryDisabledLanes&=n,t.shellSuspendCounter=0;var o=t.entanglements,l=t.expirationTimes,c=t.hiddenUpdates;for(n=r&~n;0<n;){var u=31-Xt(n),d=1<<u;o[u]=0,l[u]=-1;var f=c[u];if(f!==null)for(c[u]=null,u=0;u<f.length;u++){var h=f[u];h!==null&&(h.lane&=-536870913)}n&=~d}i!==0&&J0(t,i,0),s!==0&&a===0&&t.tag!==0&&(t.suspendedLanes|=s&~(r&~e))}function J0(t,e,n){t.pendingLanes|=e,t.suspendedLanes&=~e;var i=31-Xt(e);t.entangledLanes|=e,t.entanglements[i]=t.entanglements[i]|1073741824|n&261930}function X0(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var i=31-Xt(n),a=1<<i;a&e|t[i]&e&&(t[i]|=e),n&=~a}}function Z0(t,e){var n=e&-e;return n=n&42?1:yh(n),n&(t.suspendedLanes|e)?0:n}function yh(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Sh(t){return t&=-t,2<t?8<t?t&134217727?32:268435456:8:2}function W0(){var t=ve.p;return t!==0?t:(t=window.event,t===void 0?32:TS(t.type))}function _p(t,e){var n=ve.p;try{return ve.p=t,e()}finally{ve.p=n}}var va=Math.random().toString(36).slice(2),mt="__reactFiber$"+va,Bt="__reactProps$"+va,ir="__reactContainer$"+va,Hd="__reactEvents$"+va,eE="__reactListeners$"+va,tE="__reactHandles$"+va,Rp="__reactResources$"+va,Po="__reactMarker$"+va;function Th(t){delete t[mt],delete t[Bt],delete t[Hd],delete t[eE],delete t[tE]}function ms(t){var e=t[mt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ir]||n[mt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ng(t);t!==null;){if(n=t[mt])return n;t=Ng(t)}return e}t=n,n=t.parentNode}return null}function ar(t){if(t=t[mt]||t[ir]){var e=t.tag;if(e===5||e===6||e===13||e===31||e===26||e===27||e===3)return t}return null}function Pr(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t.stateNode;throw Error(L(33))}function xs(t){var e=t[Rp];return e||(e=t[Rp]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function ct(t){t[Po]=!0}var $0=new Set,eb={};function Ja(t,e){Vs(t,e),Vs(t+"Capture",e)}function Vs(t,e){for(eb[t]=e,t=0;t<e.length;t++)$0.add(e[t])}var nE=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xp={},wp={};function iE(t){return Vd.call(wp,t)?!0:Vd.call(xp,t)?!1:nE.test(t)?wp[t]=!0:(xp[t]=!0,!1)}function vl(t,e,n){if(iE(e))if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":t.removeAttribute(e);return;case"boolean":var i=e.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){t.removeAttribute(e);return}}t.setAttribute(e,""+n)}}function $o(t,e,n){if(n===null)t.removeAttribute(e);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(e);return}t.setAttribute(e,""+n)}}function Wn(t,e,n,i){if(i===null)t.removeAttribute(n);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttributeNS(e,n,""+i)}}function sn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function tb(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function aE(t,e,n){var i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e);if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var a=i.get,s=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return a.call(this)},set:function(r){n=""+r,s.call(this,r)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(r){n=""+r},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Gd(t){if(!t._valueTracker){var e=tb(t)?"checked":"value";t._valueTracker=aE(t,e,""+t[e])}}function nb(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),i="";return t&&(i=tb(t)?t.checked?"true":"false":t.value),t=i,t!==n?(e.setValue(t),!0):!1}function $l(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var sE=/[\n"\\]/g;function cn(t){return t.replace(sE,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function Kd(t,e,n,i,a,s,r,o){t.name="",r!=null&&typeof r!="function"&&typeof r!="symbol"&&typeof r!="boolean"?t.type=r:t.removeAttribute("type"),e!=null?r==="number"?(e===0&&t.value===""||t.value!=e)&&(t.value=""+sn(e)):t.value!==""+sn(e)&&(t.value=""+sn(e)):r!=="submit"&&r!=="reset"||t.removeAttribute("value"),e!=null?Yd(t,r,sn(e)):n!=null?Yd(t,r,sn(n)):i!=null&&t.removeAttribute("value"),a==null&&s!=null&&(t.defaultChecked=!!s),a!=null&&(t.checked=a&&typeof a!="function"&&typeof a!="symbol"),o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"?t.name=""+sn(o):t.removeAttribute("name")}function ib(t,e,n,i,a,s,r,o){if(s!=null&&typeof s!="function"&&typeof s!="symbol"&&typeof s!="boolean"&&(t.type=s),e!=null||n!=null){if(!(s!=="submit"&&s!=="reset"||e!=null)){Gd(t);return}n=n!=null?""+sn(n):"",e=e!=null?""+sn(e):n,o||e===t.value||(t.value=e),t.defaultValue=e}i=i??a,i=typeof i!="function"&&typeof i!="symbol"&&!!i,t.checked=o?t.checked:!!i,t.defaultChecked=!!i,r!=null&&typeof r!="function"&&typeof r!="symbol"&&typeof r!="boolean"&&(t.name=r),Gd(t)}function Yd(t,e,n){e==="number"&&$l(t.ownerDocument)===t||t.defaultValue===""+n||(t.defaultValue=""+n)}function ws(t,e,n,i){if(t=t.options,e){e={};for(var a=0;a<n.length;a++)e["$"+n[a]]=!0;for(n=0;n<t.length;n++)a=e.hasOwnProperty("$"+t[n].value),t[n].selected!==a&&(t[n].selected=a),a&&i&&(t[n].defaultSelected=!0)}else{for(n=""+sn(n),e=null,a=0;a<t.length;a++){if(t[a].value===n){t[a].selected=!0,i&&(t[a].defaultSelected=!0);return}e!==null||t[a].disabled||(e=t[a])}e!==null&&(e.selected=!0)}}function ab(t,e,n){if(e!=null&&(e=""+sn(e),e!==t.value&&(t.value=e),n==null)){t.defaultValue!==e&&(t.defaultValue=e);return}t.defaultValue=n!=null?""+sn(n):""}function sb(t,e,n,i){if(e==null){if(i!=null){if(n!=null)throw Error(L(92));if(Nr(i)){if(1<i.length)throw Error(L(93));i=i[0]}n=i}n==null&&(n=""),e=n}n=sn(e),t.defaultValue=n,i=t.textContent,i===n&&i!==""&&i!==null&&(t.value=i),Gd(t)}function Hs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var rE=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Op(t,e,n){var i=e.indexOf("--")===0;n==null||typeof n=="boolean"||n===""?i?t.setProperty(e,""):e==="float"?t.cssFloat="":t[e]="":i?t.setProperty(e,n):typeof n!="number"||n===0||rE.has(e)?e==="float"?t.cssFloat=n:t[e]=(""+n).trim():t[e]=n+"px"}function rb(t,e,n){if(e!=null&&typeof e!="object")throw Error(L(62));if(t=t.style,n!=null){for(var i in n)!n.hasOwnProperty(i)||e!=null&&e.hasOwnProperty(i)||(i.indexOf("--")===0?t.setProperty(i,""):i==="float"?t.cssFloat="":t[i]="");for(var a in e)i=e[a],e.hasOwnProperty(a)&&n[a]!==i&&Op(t,a,i)}else for(var s in e)e.hasOwnProperty(s)&&Op(t,s,e[s])}function Ch(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var oE=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),lE=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function bl(t){return lE.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function hi(){}var Qd=null;function kh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ps=null,Os=null;function Ap(t){var e=ar(t);if(e&&(t=e.stateNode)){var n=t[Bt]||null;e:switch(t=e.stateNode,e.type){case"input":if(Kd(t,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+cn(""+e)+'"][type="radio"]'),e=0;e<n.length;e++){var i=n[e];if(i!==t&&i.form===t.form){var a=i[Bt]||null;if(!a)throw Error(L(90));Kd(i,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(e=0;e<n.length;e++)i=n[e],i.form===t.form&&nb(i)}break e;case"textarea":ab(t,n.value,n.defaultValue);break e;case"select":e=n.value,e!=null&&ws(t,!!n.multiple,e,!1)}}}var Ru=!1;function ob(t,e,n){if(Ru)return t(e,n);Ru=!0;try{var i=t(e);return i}finally{if(Ru=!1,(ps!==null||Os!==null)&&(tu(),ps&&(e=ps,t=Os,Os=ps=null,Ap(e),t)))for(e=0;e<t.length;e++)Ap(t[e])}}function ro(t,e){var n=t.stateNode;if(n===null)return null;var i=n[Bt]||null;if(i===null)return null;n=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(L(231,e,typeof n));return n}var Si=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jd=!1;if(Si)try{var gr={};Object.defineProperty(gr,"passive",{get:function(){Jd=!0}}),window.addEventListener("test",gr,gr),window.removeEventListener("test",gr,gr)}catch{Jd=!1}var Ki=null,Eh=null,yl=null;function lb(){if(yl)return yl;var t,e=Eh,n=e.length,i,a="value"in Ki?Ki.value:Ki.textContent,s=a.length;for(t=0;t<n&&e[t]===a[t];t++);var r=n-t;for(i=1;i<=r&&e[n-i]===a[s-i];i++);return yl=a.slice(t,1<i?1-i:void 0)}function Sl(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function el(){return!0}function Mp(){return!1}function zt(t){function e(n,i,a,s,r){this._reactName=n,this._targetInst=a,this.type=i,this.nativeEvent=s,this.target=r,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?el:Mp,this.isPropagationStopped=Mp,this}return Ne(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=el)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=el)},persist:function(){},isPersistent:el}),e}var Xa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hc=zt(Xa),Lo=Ne({},Xa,{view:0,detail:0}),cE=zt(Lo),xu,wu,vr,Gc=Ne({},Lo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_h,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==vr&&(vr&&t.type==="mousemove"?(xu=t.screenX-vr.screenX,wu=t.screenY-vr.screenY):wu=xu=0,vr=t),xu)},movementY:function(t){return"movementY"in t?t.movementY:wu}}),Dp=zt(Gc),uE=Ne({},Gc,{dataTransfer:0}),dE=zt(uE),fE=Ne({},Lo,{relatedTarget:0}),Ou=zt(fE),hE=Ne({},Xa,{animationName:0,elapsedTime:0,pseudoElement:0}),mE=zt(hE),pE=Ne({},Xa,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),gE=zt(pE),vE=Ne({},Xa,{data:0}),Np=zt(vE),bE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function TE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=SE[t])?!!e[t]:!1}function _h(){return TE}var CE=Ne({},Lo,{key:function(t){if(t.key){var e=bE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Sl(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?yE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_h,charCode:function(t){return t.type==="keypress"?Sl(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Sl(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),kE=zt(CE),EE=Ne({},Gc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pp=zt(EE),_E=Ne({},Lo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_h}),RE=zt(_E),xE=Ne({},Xa,{propertyName:0,elapsedTime:0,pseudoElement:0}),wE=zt(xE),OE=Ne({},Gc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),AE=zt(OE),ME=Ne({},Xa,{newState:0,oldState:0}),DE=zt(ME),NE=[9,13,27,32],Rh=Si&&"CompositionEvent"in window,Fr=null;Si&&"documentMode"in document&&(Fr=document.documentMode);var PE=Si&&"TextEvent"in window&&!Fr,cb=Si&&(!Rh||Fr&&8<Fr&&11>=Fr),Lp=" ",Up=!1;function ub(t,e){switch(t){case"keyup":return NE.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function db(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var gs=!1;function LE(t,e){switch(t){case"compositionend":return db(e);case"keypress":return e.which!==32?null:(Up=!0,Lp);case"textInput":return t=e.data,t===Lp&&Up?null:t;default:return null}}function UE(t,e){if(gs)return t==="compositionend"||!Rh&&ub(t,e)?(t=lb(),yl=Eh=Ki=null,gs=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return cb&&e.locale!=="ko"?null:e.data;default:return null}}var IE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ip(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!IE[t.type]:e==="textarea"}function fb(t,e,n,i){ps?Os?Os.push(i):Os=[i]:ps=i,e=vc(e,"onChange"),0<e.length&&(n=new Hc("onChange","change",null,n,i),t.push({event:n,listeners:e}))}var Vr=null,oo=null;function jE(t){oS(t,0)}function Kc(t){var e=Pr(t);if(nb(e))return t}function jp(t,e){if(t==="change")return e}var hb=!1;if(Si){var Au;if(Si){var Mu="oninput"in document;if(!Mu){var Bp=document.createElement("div");Bp.setAttribute("oninput","return;"),Mu=typeof Bp.oninput=="function"}Au=Mu}else Au=!1;hb=Au&&(!document.documentMode||9<document.documentMode)}function qp(){Vr&&(Vr.detachEvent("onpropertychange",mb),oo=Vr=null)}function mb(t){if(t.propertyName==="value"&&Kc(oo)){var e=[];fb(e,oo,t,kh(t)),ob(jE,e)}}function BE(t,e,n){t==="focusin"?(qp(),Vr=e,oo=n,Vr.attachEvent("onpropertychange",mb)):t==="focusout"&&qp()}function qE(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Kc(oo)}function zE(t,e){if(t==="click")return Kc(e)}function FE(t,e){if(t==="input"||t==="change")return Kc(e)}function VE(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Wt=typeof Object.is=="function"?Object.is:VE;function lo(t,e){if(Wt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),i=Object.keys(e);if(n.length!==i.length)return!1;for(i=0;i<n.length;i++){var a=n[i];if(!Vd.call(e,a)||!Wt(t[a],e[a]))return!1}return!0}function zp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Fp(t,e){var n=zp(t);t=0;for(var i;n;){if(n.nodeType===3){if(i=t+n.textContent.length,t<=e&&i>=e)return{node:n,offset:e-t};t=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=zp(n)}}function pb(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?pb(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function gb(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var e=$l(t.document);e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=$l(t.document)}return e}function xh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var HE=Si&&"documentMode"in document&&11>=document.documentMode,vs=null,Xd=null,Hr=null,Zd=!1;function Vp(t,e,n){var i=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Zd||vs==null||vs!==$l(i)||(i=vs,"selectionStart"in i&&xh(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Hr&&lo(Hr,i)||(Hr=i,i=vc(Xd,"onSelect"),0<i.length&&(e=new Hc("onSelect","select",null,e,n),t.push({event:e,listeners:i}),e.target=vs)))}function _a(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var bs={animationend:_a("Animation","AnimationEnd"),animationiteration:_a("Animation","AnimationIteration"),animationstart:_a("Animation","AnimationStart"),transitionrun:_a("Transition","TransitionRun"),transitionstart:_a("Transition","TransitionStart"),transitioncancel:_a("Transition","TransitionCancel"),transitionend:_a("Transition","TransitionEnd")},Du={},vb={};Si&&(vb=document.createElement("div").style,"AnimationEvent"in window||(delete bs.animationend.animation,delete bs.animationiteration.animation,delete bs.animationstart.animation),"TransitionEvent"in window||delete bs.transitionend.transition);function Za(t){if(Du[t])return Du[t];if(!bs[t])return t;var e=bs[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in vb)return Du[t]=e[n];return t}var bb=Za("animationend"),yb=Za("animationiteration"),Sb=Za("animationstart"),GE=Za("transitionrun"),KE=Za("transitionstart"),YE=Za("transitioncancel"),Tb=Za("transitionend"),Cb=new Map,Wd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Wd.push("scrollEnd");function Nn(t,e){Cb.set(t,e),Ja(e,[t])}var ec=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},an=[],ys=0,wh=0;function Yc(){for(var t=ys,e=wh=ys=0;e<t;){var n=an[e];an[e++]=null;var i=an[e];an[e++]=null;var a=an[e];an[e++]=null;var s=an[e];if(an[e++]=null,i!==null&&a!==null){var r=i.pending;r===null?a.next=a:(a.next=r.next,r.next=a),i.pending=a}s!==0&&kb(n,a,s)}}function Qc(t,e,n,i){an[ys++]=t,an[ys++]=e,an[ys++]=n,an[ys++]=i,wh|=i,t.lanes|=i,t=t.alternate,t!==null&&(t.lanes|=i)}function Oh(t,e,n,i){return Qc(t,e,n,i),tc(t)}function Wa(t,e){return Qc(t,null,null,e),tc(t)}function kb(t,e,n){t.lanes|=n;var i=t.alternate;i!==null&&(i.lanes|=n);for(var a=!1,s=t.return;s!==null;)s.childLanes|=n,i=s.alternate,i!==null&&(i.childLanes|=n),s.tag===22&&(t=s.stateNode,t===null||t._visibility&1||(a=!0)),t=s,s=s.return;return t.tag===3?(s=t.stateNode,a&&e!==null&&(a=31-Xt(n),t=s.hiddenUpdates,i=t[a],i===null?t[a]=[e]:i.push(e),e.lane=n|536870912),s):null}function tc(t){if(50<$r)throw $r=0,Sf=null,Error(L(185));for(var e=t.return;e!==null;)t=e,e=t.return;return t.tag===3?t.stateNode:null}var Ss={};function QE(t,e,n,i){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gt(t,e,n,i){return new QE(t,e,n,i)}function Ah(t){return t=t.prototype,!(!t||!t.isReactComponent)}function pi(t,e){var n=t.alternate;return n===null?(n=Gt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&65011712,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n.refCleanup=t.refCleanup,n}function Eb(t,e){t.flags&=65011714;var n=t.alternate;return n===null?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,t.type=n.type,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function Tl(t,e,n,i,a,s){var r=0;if(i=t,typeof t=="function")Ah(t)&&(r=1);else if(typeof t=="string")r=$_(t,n,Vn.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case Bd:return t=Gt(31,n,e,a),t.elementType=Bd,t.lanes=s,t;case fs:return La(n.children,a,s,e);case V0:r=8,a|=24;break;case Ud:return t=Gt(12,n,e,a|2),t.elementType=Ud,t.lanes=s,t;case Id:return t=Gt(13,n,e,a),t.elementType=Id,t.lanes=s,t;case jd:return t=Gt(19,n,e,a),t.elementType=jd,t.lanes=s,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case fi:r=10;break e;case H0:r=9;break e;case gh:r=11;break e;case vh:r=14;break e;case Ii:r=16,i=null;break e}r=29,n=Error(L(130,t===null?"null":typeof t,"")),i=null}return e=Gt(r,n,e,a),e.elementType=t,e.type=i,e.lanes=s,e}function La(t,e,n,i){return t=Gt(7,t,i,e),t.lanes=n,t}function Nu(t,e,n){return t=Gt(6,t,null,e),t.lanes=n,t}function _b(t){var e=Gt(18,null,null,0);return e.stateNode=t,e}function Pu(t,e,n){return e=Gt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var Hp=new WeakMap;function un(t,e){if(typeof t=="object"&&t!==null){var n=Hp.get(t);return n!==void 0?n:(e={value:t,source:e,stack:Ep(e)},Hp.set(t,e),e)}return{value:t,source:e,stack:Ep(e)}}var Ts=[],Cs=0,nc=null,co=0,rn=[],on=0,ua=null,qn=1,zn="";function si(t,e){Ts[Cs++]=co,Ts[Cs++]=nc,nc=t,co=e}function Rb(t,e,n){rn[on++]=qn,rn[on++]=zn,rn[on++]=ua,ua=t;var i=qn;t=zn;var a=32-Xt(i)-1;i&=~(1<<a),n+=1;var s=32-Xt(e)+a;if(30<s){var r=a-a%5;s=(i&(1<<r)-1).toString(32),i>>=r,a-=r,qn=1<<32-Xt(e)+a|n<<a|i,zn=s+t}else qn=1<<s|n<<a|i,zn=t}function Mh(t){t.return!==null&&(si(t,1),Rb(t,1,0))}function Dh(t){for(;t===nc;)nc=Ts[--Cs],Ts[Cs]=null,co=Ts[--Cs],Ts[Cs]=null;for(;t===ua;)ua=rn[--on],rn[on]=null,zn=rn[--on],rn[on]=null,qn=rn[--on],rn[on]=null}function xb(t,e){rn[on++]=qn,rn[on++]=zn,rn[on++]=ua,qn=e.id,zn=e.overflow,ua=t}var pt=null,Me=null,ue=!1,$i=null,dn=!1,$d=Error(L(519));function da(t){var e=Error(L(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw uo(un(e,t)),$d}function Gp(t){var e=t.stateNode,n=t.type,i=t.memoizedProps;switch(e[mt]=t,e[Bt]=i,n){case"dialog":re("cancel",e),re("close",e);break;case"iframe":case"object":case"embed":re("load",e);break;case"video":case"audio":for(n=0;n<po.length;n++)re(po[n],e);break;case"source":re("error",e);break;case"img":case"image":case"link":re("error",e),re("load",e);break;case"details":re("toggle",e);break;case"input":re("invalid",e),ib(e,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0);break;case"select":re("invalid",e);break;case"textarea":re("invalid",e),sb(e,i.value,i.defaultValue,i.children)}n=i.children,typeof n!="string"&&typeof n!="number"&&typeof n!="bigint"||e.textContent===""+n||i.suppressHydrationWarning===!0||cS(e.textContent,n)?(i.popover!=null&&(re("beforetoggle",e),re("toggle",e)),i.onScroll!=null&&re("scroll",e),i.onScrollEnd!=null&&re("scrollend",e),i.onClick!=null&&(e.onclick=hi),e=!0):e=!1,e||da(t,!0)}function Kp(t){for(pt=t.return;pt;)switch(pt.tag){case 5:case 31:case 13:dn=!1;return;case 27:case 3:dn=!0;return;default:pt=pt.return}}function ss(t){if(t!==pt)return!1;if(!ue)return Kp(t),ue=!0,!1;var e=t.tag,n;if((n=e!==3&&e!==27)&&((n=e===5)&&(n=t.type,n=!(n!=="form"&&n!=="button")||_f(t.type,t.memoizedProps)),n=!n),n&&Me&&da(t),Kp(t),e===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(L(317));Me=Dg(t)}else if(e===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(L(317));Me=Dg(t)}else e===27?(e=Me,ba(t.type)?(t=Of,Of=null,Me=t):Me=e):Me=pt?pn(t.stateNode.nextSibling):null;return!0}function qa(){Me=pt=null,ue=!1}function Lu(){var t=$i;return t!==null&&(Pt===null?Pt=t:Pt.push.apply(Pt,t),$i=null),t}function uo(t){$i===null?$i=[t]:$i.push(t)}var ef=Qn(null),$a=null,mi=null;function qi(t,e,n){we(ef,e._currentValue),e._currentValue=n}function gi(t){t._currentValue=ef.current,dt(ef)}function tf(t,e,n){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===n)break;t=t.return}}function nf(t,e,n,i){var a=t.child;for(a!==null&&(a.return=t);a!==null;){var s=a.dependencies;if(s!==null){var r=a.child;s=s.firstContext;e:for(;s!==null;){var o=s;s=a;for(var l=0;l<e.length;l++)if(o.context===e[l]){s.lanes|=n,o=s.alternate,o!==null&&(o.lanes|=n),tf(s.return,n,t),i||(r=null);break e}s=o.next}}else if(a.tag===18){if(r=a.return,r===null)throw Error(L(341));r.lanes|=n,s=r.alternate,s!==null&&(s.lanes|=n),tf(r,n,t),r=null}else r=a.child;if(r!==null)r.return=a;else for(r=a;r!==null;){if(r===t){r=null;break}if(a=r.sibling,a!==null){a.return=r.return,r=a;break}r=r.return}a=r}}function sr(t,e,n,i){t=null;for(var a=e,s=!1;a!==null;){if(!s){if(a.flags&524288)s=!0;else if(a.flags&262144)break}if(a.tag===10){var r=a.alternate;if(r===null)throw Error(L(387));if(r=r.memoizedProps,r!==null){var o=a.type;Wt(a.pendingProps.value,r.value)||(t!==null?t.push(o):t=[o])}}else if(a===Jl.current){if(r=a.alternate,r===null)throw Error(L(387));r.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(t!==null?t.push(vo):t=[vo])}a=a.return}t!==null&&nf(e,t,n,i),e.flags|=262144}function ic(t){for(t=t.firstContext;t!==null;){if(!Wt(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function za(t){$a=t,mi=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function gt(t){return wb($a,t)}function tl(t,e){return $a===null&&za(t),wb(t,e)}function wb(t,e){var n=e._currentValue;if(e={context:e,memoizedValue:n,next:null},mi===null){if(t===null)throw Error(L(308));mi=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else mi=mi.next=e;return n}var JE=typeof AbortController<"u"?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(n,i){t.push(i)}};this.abort=function(){e.aborted=!0,t.forEach(function(n){return n()})}},XE=it.unstable_scheduleCallback,ZE=it.unstable_NormalPriority,$e={$$typeof:fi,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Nh(){return{controller:new JE,data:new Map,refCount:0}}function Uo(t){t.refCount--,t.refCount===0&&XE(ZE,function(){t.controller.abort()})}var Gr=null,af=0,Gs=0,As=null;function WE(t,e){if(Gr===null){var n=Gr=[];af=0,Gs=am(),As={status:"pending",value:void 0,then:function(i){n.push(i)}}}return af++,e.then(Yp,Yp),e}function Yp(){if(--af===0&&Gr!==null){As!==null&&(As.status="fulfilled");var t=Gr;Gr=null,Gs=0,As=null;for(var e=0;e<t.length;e++)(0,t[e])()}}function $E(t,e){var n=[],i={status:"pending",value:null,reason:null,then:function(a){n.push(a)}};return t.then(function(){i.status="fulfilled",i.value=e;for(var a=0;a<n.length;a++)(0,n[a])(e)},function(a){for(i.status="rejected",i.reason=a,a=0;a<n.length;a++)(0,n[a])(void 0)}),i}var Qp=W.S;W.S=function(t,e){Fy=Qt(),typeof e=="object"&&e!==null&&typeof e.then=="function"&&WE(t,e),Qp!==null&&Qp(t,e)};var Ua=Qn(null);function Ph(){var t=Ua.current;return t!==null?t:xe.pooledCache}function Cl(t,e){e===null?we(Ua,Ua.current):we(Ua,e.pool)}function Ob(){var t=Ph();return t===null?null:{parent:$e._currentValue,pool:t}}var rr=Error(L(460)),Lh=Error(L(474)),Jc=Error(L(542)),ac={then:function(){}};function Jp(t){return t=t.status,t==="fulfilled"||t==="rejected"}function Ab(t,e,n){switch(n=t[n],n===void 0?t.push(e):n!==e&&(e.then(hi,hi),e=n),e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,Zp(t),t;default:if(typeof e.status=="string")e.then(hi,hi);else{if(t=xe,t!==null&&100<t.shellSuspendCounter)throw Error(L(482));t=e,t.status="pending",t.then(function(i){if(e.status==="pending"){var a=e;a.status="fulfilled",a.value=i}},function(i){if(e.status==="pending"){var a=e;a.status="rejected",a.reason=i}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,Zp(t),t}throw Ia=e,rr}}function Oa(t){try{var e=t._init;return e(t._payload)}catch(n){throw n!==null&&typeof n=="object"&&typeof n.then=="function"?(Ia=n,rr):n}}var Ia=null;function Xp(){if(Ia===null)throw Error(L(459));var t=Ia;return Ia=null,t}function Zp(t){if(t===rr||t===Jc)throw Error(L(483))}var Ms=null,fo=0;function nl(t){var e=fo;return fo+=1,Ms===null&&(Ms=[]),Ab(Ms,t,e)}function br(t,e){e=e.props.ref,t.ref=e!==void 0?e:null}function il(t,e){throw e.$$typeof===B1?Error(L(525)):(t=Object.prototype.toString.call(e),Error(L(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)))}function Mb(t){function e(m,p){if(t){var v=m.deletions;v===null?(m.deletions=[p],m.flags|=16):v.push(p)}}function n(m,p){if(!t)return null;for(;p!==null;)e(m,p),p=p.sibling;return null}function i(m){for(var p=new Map;m!==null;)m.key!==null?p.set(m.key,m):p.set(m.index,m),m=m.sibling;return p}function a(m,p){return m=pi(m,p),m.index=0,m.sibling=null,m}function s(m,p,v){return m.index=v,t?(v=m.alternate,v!==null?(v=v.index,v<p?(m.flags|=67108866,p):v):(m.flags|=67108866,p)):(m.flags|=1048576,p)}function r(m){return t&&m.alternate===null&&(m.flags|=67108866),m}function o(m,p,v,b){return p===null||p.tag!==6?(p=Nu(v,m.mode,b),p.return=m,p):(p=a(p,v),p.return=m,p)}function l(m,p,v,b){var C=v.type;return C===fs?u(m,p,v.props.children,b,v.key):p!==null&&(p.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Ii&&Oa(C)===p.type)?(p=a(p,v.props),br(p,v),p.return=m,p):(p=Tl(v.type,v.key,v.props,null,m.mode,b),br(p,v),p.return=m,p)}function c(m,p,v,b){return p===null||p.tag!==4||p.stateNode.containerInfo!==v.containerInfo||p.stateNode.implementation!==v.implementation?(p=Pu(v,m.mode,b),p.return=m,p):(p=a(p,v.children||[]),p.return=m,p)}function u(m,p,v,b,C){return p===null||p.tag!==7?(p=La(v,m.mode,b,C),p.return=m,p):(p=a(p,v),p.return=m,p)}function d(m,p,v){if(typeof p=="string"&&p!==""||typeof p=="number"||typeof p=="bigint")return p=Nu(""+p,m.mode,v),p.return=m,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Jo:return v=Tl(p.type,p.key,p.props,null,m.mode,v),br(v,p),v.return=m,v;case Dr:return p=Pu(p,m.mode,v),p.return=m,p;case Ii:return p=Oa(p),d(m,p,v)}if(Nr(p)||pr(p))return p=La(p,m.mode,v,null),p.return=m,p;if(typeof p.then=="function")return d(m,nl(p),v);if(p.$$typeof===fi)return d(m,tl(m,p),v);il(m,p)}return null}function f(m,p,v,b){var C=p!==null?p.key:null;if(typeof v=="string"&&v!==""||typeof v=="number"||typeof v=="bigint")return C!==null?null:o(m,p,""+v,b);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Jo:return v.key===C?l(m,p,v,b):null;case Dr:return v.key===C?c(m,p,v,b):null;case Ii:return v=Oa(v),f(m,p,v,b)}if(Nr(v)||pr(v))return C!==null?null:u(m,p,v,b,null);if(typeof v.then=="function")return f(m,p,nl(v),b);if(v.$$typeof===fi)return f(m,p,tl(m,v),b);il(m,v)}return null}function h(m,p,v,b,C){if(typeof b=="string"&&b!==""||typeof b=="number"||typeof b=="bigint")return m=m.get(v)||null,o(p,m,""+b,C);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Jo:return m=m.get(b.key===null?v:b.key)||null,l(p,m,b,C);case Dr:return m=m.get(b.key===null?v:b.key)||null,c(p,m,b,C);case Ii:return b=Oa(b),h(m,p,v,b,C)}if(Nr(b)||pr(b))return m=m.get(v)||null,u(p,m,b,C,null);if(typeof b.then=="function")return h(m,p,v,nl(b),C);if(b.$$typeof===fi)return h(m,p,v,tl(p,b),C);il(p,b)}return null}function g(m,p,v,b){for(var C=null,_=null,w=p,P=p=0,O=null;w!==null&&P<v.length;P++){w.index>P?(O=w,w=null):O=w.sibling;var N=f(m,w,v[P],b);if(N===null){w===null&&(w=O);break}t&&w&&N.alternate===null&&e(m,w),p=s(N,p,P),_===null?C=N:_.sibling=N,_=N,w=O}if(P===v.length)return n(m,w),ue&&si(m,P),C;if(w===null){for(;P<v.length;P++)w=d(m,v[P],b),w!==null&&(p=s(w,p,P),_===null?C=w:_.sibling=w,_=w);return ue&&si(m,P),C}for(w=i(w);P<v.length;P++)O=h(w,m,P,v[P],b),O!==null&&(t&&O.alternate!==null&&w.delete(O.key===null?P:O.key),p=s(O,p,P),_===null?C=O:_.sibling=O,_=O);return t&&w.forEach(function(z){return e(m,z)}),ue&&si(m,P),C}function y(m,p,v,b){if(v==null)throw Error(L(151));for(var C=null,_=null,w=p,P=p=0,O=null,N=v.next();w!==null&&!N.done;P++,N=v.next()){w.index>P?(O=w,w=null):O=w.sibling;var z=f(m,w,N.value,b);if(z===null){w===null&&(w=O);break}t&&w&&z.alternate===null&&e(m,w),p=s(z,p,P),_===null?C=z:_.sibling=z,_=z,w=O}if(N.done)return n(m,w),ue&&si(m,P),C;if(w===null){for(;!N.done;P++,N=v.next())N=d(m,N.value,b),N!==null&&(p=s(N,p,P),_===null?C=N:_.sibling=N,_=N);return ue&&si(m,P),C}for(w=i(w);!N.done;P++,N=v.next())N=h(w,m,P,N.value,b),N!==null&&(t&&N.alternate!==null&&w.delete(N.key===null?P:N.key),p=s(N,p,P),_===null?C=N:_.sibling=N,_=N);return t&&w.forEach(function(G){return e(m,G)}),ue&&si(m,P),C}function T(m,p,v,b){if(typeof v=="object"&&v!==null&&v.type===fs&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Jo:e:{for(var C=v.key;p!==null;){if(p.key===C){if(C=v.type,C===fs){if(p.tag===7){n(m,p.sibling),b=a(p,v.props.children),b.return=m,m=b;break e}}else if(p.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Ii&&Oa(C)===p.type){n(m,p.sibling),b=a(p,v.props),br(b,v),b.return=m,m=b;break e}n(m,p);break}else e(m,p);p=p.sibling}v.type===fs?(b=La(v.props.children,m.mode,b,v.key),b.return=m,m=b):(b=Tl(v.type,v.key,v.props,null,m.mode,b),br(b,v),b.return=m,m=b)}return r(m);case Dr:e:{for(C=v.key;p!==null;){if(p.key===C)if(p.tag===4&&p.stateNode.containerInfo===v.containerInfo&&p.stateNode.implementation===v.implementation){n(m,p.sibling),b=a(p,v.children||[]),b.return=m,m=b;break e}else{n(m,p);break}else e(m,p);p=p.sibling}b=Pu(v,m.mode,b),b.return=m,m=b}return r(m);case Ii:return v=Oa(v),T(m,p,v,b)}if(Nr(v))return g(m,p,v,b);if(pr(v)){if(C=pr(v),typeof C!="function")throw Error(L(150));return v=C.call(v),y(m,p,v,b)}if(typeof v.then=="function")return T(m,p,nl(v),b);if(v.$$typeof===fi)return T(m,p,tl(m,v),b);il(m,v)}return typeof v=="string"&&v!==""||typeof v=="number"||typeof v=="bigint"?(v=""+v,p!==null&&p.tag===6?(n(m,p.sibling),b=a(p,v),b.return=m,m=b):(n(m,p),b=Nu(v,m.mode,b),b.return=m,m=b),r(m)):n(m,p)}return function(m,p,v,b){try{fo=0;var C=T(m,p,v,b);return Ms=null,C}catch(w){if(w===rr||w===Jc)throw w;var _=Gt(29,w,null,m.mode);return _.lanes=b,_.return=m,_}finally{}}}var Fa=Mb(!0),Db=Mb(!1),ji=!1;function Uh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function sf(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function ea(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function ta(t,e,n){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,ge&2){var a=i.pending;return a===null?e.next=e:(e.next=a.next,a.next=e),i.pending=e,e=tc(t),kb(t,null,n),e}return Qc(t,i,e,n),tc(t)}function Kr(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194048)!==0)){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,X0(t,n)}}function Uu(t,e){var n=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,n===i)){var a=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var r={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};s===null?a=s=r:s=s.next=r,n=n.next}while(n!==null);s===null?a=s=e:s=s.next=e}else a=s=e;n={baseState:i.baseState,firstBaseUpdate:a,lastBaseUpdate:s,shared:i.shared,callbacks:i.callbacks},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}var rf=!1;function Yr(){if(rf){var t=As;if(t!==null)throw t}}function Qr(t,e,n,i){rf=!1;var a=t.updateQueue;ji=!1;var s=a.firstBaseUpdate,r=a.lastBaseUpdate,o=a.shared.pending;if(o!==null){a.shared.pending=null;var l=o,c=l.next;l.next=null,r===null?s=c:r.next=c,r=l;var u=t.alternate;u!==null&&(u=u.updateQueue,o=u.lastBaseUpdate,o!==r&&(o===null?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(s!==null){var d=a.baseState;r=0,u=c=l=null,o=s;do{var f=o.lane&-536870913,h=f!==o.lane;if(h?(ce&f)===f:(i&f)===f){f!==0&&f===Gs&&(rf=!0),u!==null&&(u=u.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var g=t,y=o;f=e;var T=n;switch(y.tag){case 1:if(g=y.payload,typeof g=="function"){d=g.call(T,d,f);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,f=typeof g=="function"?g.call(T,d,f):g,f==null)break e;d=Ne({},d,f);break e;case 2:ji=!0}}f=o.callback,f!==null&&(t.flags|=64,h&&(t.flags|=8192),h=a.callbacks,h===null?a.callbacks=[f]:h.push(f))}else h={lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},u===null?(c=u=h,l=d):u=u.next=h,r|=f;if(o=o.next,o===null){if(o=a.shared.pending,o===null)break;h=o,o=h.next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}while(!0);u===null&&(l=d),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=u,s===null&&(a.shared.lanes=0),ha|=r,t.lanes=r,t.memoizedState=d}}function Nb(t,e){if(typeof t!="function")throw Error(L(191,t));t.call(e)}function Pb(t,e){var n=t.callbacks;if(n!==null)for(t.callbacks=null,t=0;t<n.length;t++)Nb(n[t],e)}var Ks=Qn(null),sc=Qn(0);function Wp(t,e){t=Ei,we(sc,t),we(Ks,e),Ei=t|e.baseLanes}function of(){we(sc,Ei),we(Ks,Ks.current)}function Ih(){Ei=sc.current,dt(Ks),dt(sc)}var $t=Qn(null),mn=null;function zi(t){var e=t.alternate;we(Ye,Ye.current&1),we($t,t),mn===null&&(e===null||Ks.current!==null||e.memoizedState!==null)&&(mn=t)}function lf(t){we(Ye,Ye.current),we($t,t),mn===null&&(mn=t)}function Lb(t){t.tag===22?(we(Ye,Ye.current),we($t,t),mn===null&&(mn=t)):Fi()}function Fi(){we(Ye,Ye.current),we($t,$t.current)}function Ht(t){dt($t),mn===t&&(mn=null),dt(Ye)}var Ye=Qn(0);function rc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||xf(n)||wf(n)))return e}else if(e.tag===19&&(e.memoizedProps.revealOrder==="forwards"||e.memoizedProps.revealOrder==="backwards"||e.memoizedProps.revealOrder==="unstable_legacy-backwards"||e.memoizedProps.revealOrder==="together")){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ti=0,ne=null,ke=null,Ze=null,oc=!1,Ds=!1,Va=!1,lc=0,ho=0,Ns=null,e_=0;function je(){throw Error(L(321))}function jh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Wt(t[n],e[n]))return!1;return!0}function Bh(t,e,n,i,a,s){return Ti=s,ne=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,W.H=t===null||t.memoizedState===null?fy:Xh,Va=!1,s=n(i,a),Va=!1,Ds&&(s=Ib(e,n,i,a)),Ub(t),s}function Ub(t){W.H=mo;var e=ke!==null&&ke.next!==null;if(Ti=0,Ze=ke=ne=null,oc=!1,ho=0,Ns=null,e)throw Error(L(300));t===null||et||(t=t.dependencies,t!==null&&ic(t)&&(et=!0))}function Ib(t,e,n,i){ne=t;var a=0;do{if(Ds&&(Ns=null),ho=0,Ds=!1,25<=a)throw Error(L(301));if(a+=1,Ze=ke=null,t.updateQueue!=null){var s=t.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,s.memoCache!=null&&(s.memoCache.index=0)}W.H=hy,s=e(n,i)}while(Ds);return s}function t_(){var t=W.H,e=t.useState()[0];return e=typeof e.then=="function"?Io(e):e,t=t.useState()[0],(ke!==null?ke.memoizedState:null)!==t&&(ne.flags|=1024),e}function qh(){var t=lc!==0;return lc=0,t}function zh(t,e,n){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n}function Fh(t){if(oc){for(t=t.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}oc=!1}Ti=0,Ze=ke=ne=null,Ds=!1,ho=lc=0,Ns=null}function kt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ze===null?ne.memoizedState=Ze=t:Ze=Ze.next=t,Ze}function Qe(){if(ke===null){var t=ne.alternate;t=t!==null?t.memoizedState:null}else t=ke.next;var e=Ze===null?ne.memoizedState:Ze.next;if(e!==null)Ze=e,ke=t;else{if(t===null)throw ne.alternate===null?Error(L(467)):Error(L(310));ke=t,t={memoizedState:ke.memoizedState,baseState:ke.baseState,baseQueue:ke.baseQueue,queue:ke.queue,next:null},Ze===null?ne.memoizedState=Ze=t:Ze=Ze.next=t}return Ze}function Xc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Io(t){var e=ho;return ho+=1,Ns===null&&(Ns=[]),t=Ab(Ns,t,e),e=ne,(Ze===null?e.memoizedState:Ze.next)===null&&(e=e.alternate,W.H=e===null||e.memoizedState===null?fy:Xh),t}function Zc(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Io(t);if(t.$$typeof===fi)return gt(t)}throw Error(L(438,String(t)))}function Vh(t){var e=null,n=ne.updateQueue;if(n!==null&&(e=n.memoCache),e==null){var i=ne.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(e={data:i.data.map(function(a){return a.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),n===null&&(n=Xc(),ne.updateQueue=n),n.memoCache=e,n=e.data[e.index],n===void 0)for(n=e.data[e.index]=Array(t),i=0;i<t;i++)n[i]=q1;return e.index++,n}function Ci(t,e){return typeof e=="function"?e(t):e}function kl(t){var e=Qe();return Hh(e,ke,t)}function Hh(t,e,n){var i=t.queue;if(i===null)throw Error(L(311));i.lastRenderedReducer=n;var a=t.baseQueue,s=i.pending;if(s!==null){if(a!==null){var r=a.next;a.next=s.next,s.next=r}e.baseQueue=a=s,i.pending=null}if(s=t.baseState,a===null)t.memoizedState=s;else{e=a.next;var o=r=null,l=null,c=e,u=!1;do{var d=c.lane&-536870913;if(d!==c.lane?(ce&d)===d:(Ti&d)===d){var f=c.revertLane;if(f===0)l!==null&&(l=l.next={lane:0,revertLane:0,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),d===Gs&&(u=!0);else if((Ti&f)===f){c=c.next,f===Gs&&(u=!0);continue}else d={lane:0,revertLane:c.revertLane,gesture:null,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},l===null?(o=l=d,r=s):l=l.next=d,ne.lanes|=f,ha|=f;d=c.action,Va&&n(s,d),s=c.hasEagerState?c.eagerState:n(s,d)}else f={lane:d,revertLane:c.revertLane,gesture:c.gesture,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null},l===null?(o=l=f,r=s):l=l.next=f,ne.lanes|=d,ha|=d;c=c.next}while(c!==null&&c!==e);if(l===null?r=s:l.next=o,!Wt(s,t.memoizedState)&&(et=!0,u&&(n=As,n!==null)))throw n;t.memoizedState=s,t.baseState=r,t.baseQueue=l,i.lastRenderedState=s}return a===null&&(i.lanes=0),[t.memoizedState,i.dispatch]}function Iu(t){var e=Qe(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var i=n.dispatch,a=n.pending,s=e.memoizedState;if(a!==null){n.pending=null;var r=a=a.next;do s=t(s,r.action),r=r.next;while(r!==a);Wt(s,e.memoizedState)||(et=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,i]}function jb(t,e,n){var i=ne,a=Qe(),s=ue;if(s){if(n===void 0)throw Error(L(407));n=n()}else n=e();var r=!Wt((ke||a).memoizedState,n);if(r&&(a.memoizedState=n,et=!0),a=a.queue,Gh(zb.bind(null,i,a,t),[t]),a.getSnapshot!==e||r||Ze!==null&&Ze.memoizedState.tag&1){if(i.flags|=2048,Ys(9,{destroy:void 0},qb.bind(null,i,a,n,e),null),xe===null)throw Error(L(349));s||Ti&127||Bb(i,e,n)}return n}function Bb(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ne.updateQueue,e===null?(e=Xc(),ne.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function qb(t,e,n,i){e.value=n,e.getSnapshot=i,Fb(e)&&Vb(t)}function zb(t,e,n){return n(function(){Fb(e)&&Vb(t)})}function Fb(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Wt(t,n)}catch{return!0}}function Vb(t){var e=Wa(t,2);e!==null&&It(e,t,2)}function cf(t){var e=kt();if(typeof t=="function"){var n=t;if(t=n(),Va){Gi(!0);try{n()}finally{Gi(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ci,lastRenderedState:t},e}function Hb(t,e,n,i){return t.baseState=n,Hh(t,ke,typeof i=="function"?i:Ci)}function n_(t,e,n,i,a){if($c(t))throw Error(L(485));if(t=e.action,t!==null){var s={payload:a,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(r){s.listeners.push(r)}};W.T!==null?n(!0):s.isTransition=!1,i(s),n=e.pending,n===null?(s.next=e.pending=s,Gb(e,s)):(s.next=n.next,e.pending=n.next=s)}}function Gb(t,e){var n=e.action,i=e.payload,a=t.state;if(e.isTransition){var s=W.T,r={};W.T=r;try{var o=n(a,i),l=W.S;l!==null&&l(r,o),$p(t,e,o)}catch(c){uf(t,e,c)}finally{s!==null&&r.types!==null&&(s.types=r.types),W.T=s}}else try{s=n(a,i),$p(t,e,s)}catch(c){uf(t,e,c)}}function $p(t,e,n){n!==null&&typeof n=="object"&&typeof n.then=="function"?n.then(function(i){eg(t,e,i)},function(i){return uf(t,e,i)}):eg(t,e,n)}function eg(t,e,n){e.status="fulfilled",e.value=n,Kb(e),t.state=n,e=t.pending,e!==null&&(n=e.next,n===e?t.pending=null:(n=n.next,e.next=n,Gb(t,n)))}function uf(t,e,n){var i=t.pending;if(t.pending=null,i!==null){i=i.next;do e.status="rejected",e.reason=n,Kb(e),e=e.next;while(e!==i)}t.action=null}function Kb(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function Yb(t,e){return e}function tg(t,e){if(ue){var n=xe.formState;if(n!==null){e:{var i=ne;if(ue){if(Me){t:{for(var a=Me,s=dn;a.nodeType!==8;){if(!s){a=null;break t}if(a=pn(a.nextSibling),a===null){a=null;break t}}s=a.data,a=s==="F!"||s==="F"?a:null}if(a){Me=pn(a.nextSibling),i=a.data==="F!";break e}}da(i)}i=!1}i&&(e=n[0])}}return n=kt(),n.memoizedState=n.baseState=e,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yb,lastRenderedState:e},n.queue=i,n=cy.bind(null,ne,i),i.dispatch=n,i=cf(!1),s=Jh.bind(null,ne,!1,i.queue),i=kt(),a={state:e,dispatch:null,action:t,pending:null},i.queue=a,n=n_.bind(null,ne,a,s,n),a.dispatch=n,i.memoizedState=t,[e,n,!1]}function ng(t){var e=Qe();return Qb(e,ke,t)}function Qb(t,e,n){if(e=Hh(t,e,Yb)[0],t=kl(Ci)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var i=Io(e)}catch(r){throw r===rr?Jc:r}else i=e;e=Qe();var a=e.queue,s=a.dispatch;return n!==e.memoizedState&&(ne.flags|=2048,Ys(9,{destroy:void 0},i_.bind(null,a,n),null)),[i,s,t]}function i_(t,e){t.action=e}function ig(t){var e=Qe(),n=ke;if(n!==null)return Qb(e,n,t);Qe(),e=e.memoizedState,n=Qe();var i=n.queue.dispatch;return n.memoizedState=t,[e,i,!1]}function Ys(t,e,n,i){return t={tag:t,create:n,deps:i,inst:e,next:null},e=ne.updateQueue,e===null&&(e=Xc(),ne.updateQueue=e),n=e.lastEffect,n===null?e.lastEffect=t.next=t:(i=n.next,n.next=t,t.next=i,e.lastEffect=t),t}function Jb(){return Qe().memoizedState}function El(t,e,n,i){var a=kt();ne.flags|=t,a.memoizedState=Ys(1|e,{destroy:void 0},n,i===void 0?null:i)}function Wc(t,e,n,i){var a=Qe();i=i===void 0?null:i;var s=a.memoizedState.inst;ke!==null&&i!==null&&jh(i,ke.memoizedState.deps)?a.memoizedState=Ys(e,s,n,i):(ne.flags|=t,a.memoizedState=Ys(1|e,s,n,i))}function ag(t,e){El(8390656,8,t,e)}function Gh(t,e){Wc(2048,8,t,e)}function a_(t){ne.flags|=4;var e=ne.updateQueue;if(e===null)e=Xc(),ne.updateQueue=e,e.events=[t];else{var n=e.events;n===null?e.events=[t]:n.push(t)}}function Xb(t){var e=Qe().memoizedState;return a_({ref:e,nextImpl:t}),function(){if(ge&2)throw Error(L(440));return e.impl.apply(void 0,arguments)}}function Zb(t,e){return Wc(4,2,t,e)}function Wb(t,e){return Wc(4,4,t,e)}function $b(t,e){if(typeof e=="function"){t=t();var n=e(t);return function(){typeof n=="function"?n():e(null)}}if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function ey(t,e,n){n=n!=null?n.concat([t]):null,Wc(4,4,$b.bind(null,e,t),n)}function Kh(){}function ty(t,e){var n=Qe();e=e===void 0?null:e;var i=n.memoizedState;return e!==null&&jh(e,i[1])?i[0]:(n.memoizedState=[t,e],t)}function ny(t,e){var n=Qe();e=e===void 0?null:e;var i=n.memoizedState;if(e!==null&&jh(e,i[1]))return i[0];if(i=t(),Va){Gi(!0);try{t()}finally{Gi(!1)}}return n.memoizedState=[i,e],i}function Yh(t,e,n){return n===void 0||Ti&1073741824&&!(ce&261930)?t.memoizedState=e:(t.memoizedState=n,t=Hy(),ne.lanes|=t,ha|=t,n)}function iy(t,e,n,i){return Wt(n,e)?n:Ks.current!==null?(t=Yh(t,n,i),Wt(t,e)||(et=!0),t):!(Ti&42)||Ti&1073741824&&!(ce&261930)?(et=!0,t.memoizedState=n):(t=Hy(),ne.lanes|=t,ha|=t,e)}function ay(t,e,n,i,a){var s=ve.p;ve.p=s!==0&&8>s?s:8;var r=W.T,o={};W.T=o,Jh(t,!1,e,n);try{var l=a(),c=W.S;if(c!==null&&c(o,l),l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=$E(l,i);Jr(t,e,u,Zt(t))}else Jr(t,e,i,Zt(t))}catch(d){Jr(t,e,{then:function(){},status:"rejected",reason:d},Zt())}finally{ve.p=s,r!==null&&o.types!==null&&(r.types=o.types),W.T=r}}function s_(){}function df(t,e,n,i){if(t.tag!==5)throw Error(L(476));var a=sy(t).queue;ay(t,a,e,Pa,n===null?s_:function(){return ry(t),n(i)})}function sy(t){var e=t.memoizedState;if(e!==null)return e;e={memoizedState:Pa,baseState:Pa,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ci,lastRenderedState:Pa},next:null};var n={};return e.next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ci,lastRenderedState:n},next:null},t.memoizedState=e,t=t.alternate,t!==null&&(t.memoizedState=e),e}function ry(t){var e=sy(t);e.next===null&&(e=t.alternate.memoizedState),Jr(t,e.next.queue,{},Zt())}function Qh(){return gt(vo)}function oy(){return Qe().memoizedState}function ly(){return Qe().memoizedState}function r_(t){for(var e=t.return;e!==null;){switch(e.tag){case 24:case 3:var n=Zt();t=ea(n);var i=ta(e,t,n);i!==null&&(It(i,e,n),Kr(i,e,n)),e={cache:Nh()},t.payload=e;return}e=e.return}}function o_(t,e,n){var i=Zt();n={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},$c(t)?uy(e,n):(n=Oh(t,e,n,i),n!==null&&(It(n,t,i),dy(n,e,i)))}function cy(t,e,n){var i=Zt();Jr(t,e,n,i)}function Jr(t,e,n,i){var a={lane:i,revertLane:0,gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null};if($c(t))uy(e,a);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var r=e.lastRenderedState,o=s(r,n);if(a.hasEagerState=!0,a.eagerState=o,Wt(o,r))return Qc(t,e,a,0),xe===null&&Yc(),!1}catch{}finally{}if(n=Oh(t,e,a,i),n!==null)return It(n,t,i),dy(n,e,i),!0}return!1}function Jh(t,e,n,i){if(i={lane:2,revertLane:am(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},$c(t)){if(e)throw Error(L(479))}else e=Oh(t,n,i,2),e!==null&&It(e,t,2)}function $c(t){var e=t.alternate;return t===ne||e!==null&&e===ne}function uy(t,e){Ds=oc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function dy(t,e,n){if(n&4194048){var i=e.lanes;i&=t.pendingLanes,n|=i,e.lanes=n,X0(t,n)}}var mo={readContext:gt,use:Zc,useCallback:je,useContext:je,useEffect:je,useImperativeHandle:je,useLayoutEffect:je,useInsertionEffect:je,useMemo:je,useReducer:je,useRef:je,useState:je,useDebugValue:je,useDeferredValue:je,useTransition:je,useSyncExternalStore:je,useId:je,useHostTransitionStatus:je,useFormState:je,useActionState:je,useOptimistic:je,useMemoCache:je,useCacheRefresh:je};mo.useEffectEvent=je;var fy={readContext:gt,use:Zc,useCallback:function(t,e){return kt().memoizedState=[t,e===void 0?null:e],t},useContext:gt,useEffect:ag,useImperativeHandle:function(t,e,n){n=n!=null?n.concat([t]):null,El(4194308,4,$b.bind(null,e,t),n)},useLayoutEffect:function(t,e){return El(4194308,4,t,e)},useInsertionEffect:function(t,e){El(4,2,t,e)},useMemo:function(t,e){var n=kt();e=e===void 0?null:e;var i=t();if(Va){Gi(!0);try{t()}finally{Gi(!1)}}return n.memoizedState=[i,e],i},useReducer:function(t,e,n){var i=kt();if(n!==void 0){var a=n(e);if(Va){Gi(!0);try{n(e)}finally{Gi(!1)}}}else a=e;return i.memoizedState=i.baseState=a,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:a},i.queue=t,t=t.dispatch=o_.bind(null,ne,t),[i.memoizedState,t]},useRef:function(t){var e=kt();return t={current:t},e.memoizedState=t},useState:function(t){t=cf(t);var e=t.queue,n=cy.bind(null,ne,e);return e.dispatch=n,[t.memoizedState,n]},useDebugValue:Kh,useDeferredValue:function(t,e){var n=kt();return Yh(n,t,e)},useTransition:function(){var t=cf(!1);return t=ay.bind(null,ne,t.queue,!0,!1),kt().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,n){var i=ne,a=kt();if(ue){if(n===void 0)throw Error(L(407));n=n()}else{if(n=e(),xe===null)throw Error(L(349));ce&127||Bb(i,e,n)}a.memoizedState=n;var s={value:n,getSnapshot:e};return a.queue=s,ag(zb.bind(null,i,s,t),[t]),i.flags|=2048,Ys(9,{destroy:void 0},qb.bind(null,i,s,n,e),null),n},useId:function(){var t=kt(),e=xe.identifierPrefix;if(ue){var n=zn,i=qn;n=(i&~(1<<32-Xt(i)-1)).toString(32)+n,e="_"+e+"R_"+n,n=lc++,0<n&&(e+="H"+n.toString(32)),e+="_"}else n=e_++,e="_"+e+"r_"+n.toString(32)+"_";return t.memoizedState=e},useHostTransitionStatus:Qh,useFormState:tg,useActionState:tg,useOptimistic:function(t){var e=kt();e.memoizedState=e.baseState=t;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=n,e=Jh.bind(null,ne,!0,n),n.dispatch=e,[t,e]},useMemoCache:Vh,useCacheRefresh:function(){return kt().memoizedState=r_.bind(null,ne)},useEffectEvent:function(t){var e=kt(),n={impl:t};return e.memoizedState=n,function(){if(ge&2)throw Error(L(440));return n.impl.apply(void 0,arguments)}}},Xh={readContext:gt,use:Zc,useCallback:ty,useContext:gt,useEffect:Gh,useImperativeHandle:ey,useInsertionEffect:Zb,useLayoutEffect:Wb,useMemo:ny,useReducer:kl,useRef:Jb,useState:function(){return kl(Ci)},useDebugValue:Kh,useDeferredValue:function(t,e){var n=Qe();return iy(n,ke.memoizedState,t,e)},useTransition:function(){var t=kl(Ci)[0],e=Qe().memoizedState;return[typeof t=="boolean"?t:Io(t),e]},useSyncExternalStore:jb,useId:oy,useHostTransitionStatus:Qh,useFormState:ng,useActionState:ng,useOptimistic:function(t,e){var n=Qe();return Hb(n,ke,t,e)},useMemoCache:Vh,useCacheRefresh:ly};Xh.useEffectEvent=Xb;var hy={readContext:gt,use:Zc,useCallback:ty,useContext:gt,useEffect:Gh,useImperativeHandle:ey,useInsertionEffect:Zb,useLayoutEffect:Wb,useMemo:ny,useReducer:Iu,useRef:Jb,useState:function(){return Iu(Ci)},useDebugValue:Kh,useDeferredValue:function(t,e){var n=Qe();return ke===null?Yh(n,t,e):iy(n,ke.memoizedState,t,e)},useTransition:function(){var t=Iu(Ci)[0],e=Qe().memoizedState;return[typeof t=="boolean"?t:Io(t),e]},useSyncExternalStore:jb,useId:oy,useHostTransitionStatus:Qh,useFormState:ig,useActionState:ig,useOptimistic:function(t,e){var n=Qe();return ke!==null?Hb(n,ke,t,e):(n.baseState=t,[t,n.queue.dispatch])},useMemoCache:Vh,useCacheRefresh:ly};hy.useEffectEvent=Xb;function ju(t,e,n,i){e=t.memoizedState,n=n(i,e),n=n==null?e:Ne({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ff={enqueueSetState:function(t,e,n){t=t._reactInternals;var i=Zt(),a=ea(i);a.payload=e,n!=null&&(a.callback=n),e=ta(t,a,i),e!==null&&(It(e,t,i),Kr(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var i=Zt(),a=ea(i);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=ta(t,a,i),e!==null&&(It(e,t,i),Kr(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Zt(),i=ea(n);i.tag=2,e!=null&&(i.callback=e),e=ta(t,i,n),e!==null&&(It(e,t,n),Kr(e,t,n))}};function sg(t,e,n,i,a,s,r){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,r):e.prototype&&e.prototype.isPureReactComponent?!lo(n,i)||!lo(a,s):!0}function rg(t,e,n,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,i),e.state!==t&&ff.enqueueReplaceState(e,e.state,null)}function Ha(t,e){var n=e;if("ref"in e){n={};for(var i in e)i!=="ref"&&(n[i]=e[i])}if(t=t.defaultProps){n===e&&(n=Ne({},n));for(var a in t)n[a]===void 0&&(n[a]=t[a])}return n}function my(t){ec(t)}function py(t){console.error(t)}function gy(t){ec(t)}function cc(t,e){try{var n=t.onUncaughtError;n(e.value,{componentStack:e.stack})}catch(i){setTimeout(function(){throw i})}}function og(t,e,n){try{var i=t.onCaughtError;i(n.value,{componentStack:n.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function hf(t,e,n){return n=ea(n),n.tag=3,n.payload={element:null},n.callback=function(){cc(t,e)},n}function vy(t){return t=ea(t),t.tag=3,t}function by(t,e,n,i){var a=n.type.getDerivedStateFromError;if(typeof a=="function"){var s=i.value;t.payload=function(){return a(s)},t.callback=function(){og(e,n,i)}}var r=n.stateNode;r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){og(e,n,i),typeof a!="function"&&(na===null?na=new Set([this]):na.add(this));var o=i.stack;this.componentDidCatch(i.value,{componentStack:o!==null?o:""})})}function l_(t,e,n,i,a){if(n.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(e=n.alternate,e!==null&&sr(e,n,a,!0),n=$t.current,n!==null){switch(n.tag){case 31:case 13:return mn===null?mc():n.alternate===null&&qe===0&&(qe=3),n.flags&=-257,n.flags|=65536,n.lanes=a,i===ac?n.flags|=16384:(e=n.updateQueue,e===null?n.updateQueue=new Set([i]):e.add(i),Ju(t,i,a)),!1;case 22:return n.flags|=65536,i===ac?n.flags|=16384:(e=n.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([i])},n.updateQueue=e):(n=e.retryQueue,n===null?e.retryQueue=new Set([i]):n.add(i)),Ju(t,i,a)),!1}throw Error(L(435,n.tag))}return Ju(t,i,a),mc(),!1}if(ue)return e=$t.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=a,i!==$d&&(t=Error(L(422),{cause:i}),uo(un(t,n)))):(i!==$d&&(e=Error(L(423),{cause:i}),uo(un(e,n))),t=t.current.alternate,t.flags|=65536,a&=-a,t.lanes|=a,i=un(i,n),a=hf(t.stateNode,i,a),Uu(t,a),qe!==4&&(qe=2)),!1;var s=Error(L(520),{cause:i});if(s=un(s,n),Wr===null?Wr=[s]:Wr.push(s),qe!==4&&(qe=2),e===null)return!0;i=un(i,n),n=e;do{switch(n.tag){case 3:return n.flags|=65536,t=a&-a,n.lanes|=t,t=hf(n.stateNode,i,t),Uu(n,t),!1;case 1:if(e=n.type,s=n.stateNode,(n.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||s!==null&&typeof s.componentDidCatch=="function"&&(na===null||!na.has(s))))return n.flags|=65536,a&=-a,n.lanes|=a,a=vy(a),by(a,t,n,i),Uu(n,a),!1}n=n.return}while(n!==null);return!1}var Zh=Error(L(461)),et=!1;function ht(t,e,n,i){e.child=t===null?Db(e,null,n,i):Fa(e,t.child,n,i)}function lg(t,e,n,i,a){n=n.render;var s=e.ref;if("ref"in i){var r={};for(var o in i)o!=="ref"&&(r[o]=i[o])}else r=i;return za(e),i=Bh(t,e,n,r,s,a),o=qh(),t!==null&&!et?(zh(t,e,a),ki(t,e,a)):(ue&&o&&Mh(e),e.flags|=1,ht(t,e,i,a),e.child)}function cg(t,e,n,i,a){if(t===null){var s=n.type;return typeof s=="function"&&!Ah(s)&&s.defaultProps===void 0&&n.compare===null?(e.tag=15,e.type=s,yy(t,e,s,i,a)):(t=Tl(n.type,null,i,e,e.mode,a),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!Wh(t,a)){var r=s.memoizedProps;if(n=n.compare,n=n!==null?n:lo,n(r,i)&&t.ref===e.ref)return ki(t,e,a)}return e.flags|=1,t=pi(s,i),t.ref=e.ref,t.return=e,e.child=t}function yy(t,e,n,i,a){if(t!==null){var s=t.memoizedProps;if(lo(s,i)&&t.ref===e.ref)if(et=!1,e.pendingProps=i=s,Wh(t,a))t.flags&131072&&(et=!0);else return e.lanes=t.lanes,ki(t,e,a)}return mf(t,e,n,i,a)}function Sy(t,e,n,i){var a=i.children,s=t!==null?t.memoizedState:null;if(t===null&&e.stateNode===null&&(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.mode==="hidden"){if(e.flags&128){if(s=s!==null?s.baseLanes|n:n,t!==null){for(i=e.child=t.child,a=0;i!==null;)a=a|i.lanes|i.childLanes,i=i.sibling;i=a&~s}else i=0,e.child=null;return ug(t,e,s,n,i)}if(n&536870912)e.memoizedState={baseLanes:0,cachePool:null},t!==null&&Cl(e,s!==null?s.cachePool:null),s!==null?Wp(e,s):of(),Lb(e);else return i=e.lanes=536870912,ug(t,e,s!==null?s.baseLanes|n:n,n,i)}else s!==null?(Cl(e,s.cachePool),Wp(e,s),Fi(),e.memoizedState=null):(t!==null&&Cl(e,null),of(),Fi());return ht(t,e,a,n),e.child}function Lr(t,e){return t!==null&&t.tag===22||e.stateNode!==null||(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),e.sibling}function ug(t,e,n,i,a){var s=Ph();return s=s===null?null:{parent:$e._currentValue,pool:s},e.memoizedState={baseLanes:n,cachePool:s},t!==null&&Cl(e,null),of(),Lb(e),t!==null&&sr(t,e,i,!0),e.childLanes=a,null}function _l(t,e){return e=uc({mode:e.mode,children:e.children},t.mode),e.ref=t.ref,t.child=e,e.return=t,e}function dg(t,e,n){return Fa(e,t.child,null,n),t=_l(e,e.pendingProps),t.flags|=2,Ht(e),e.memoizedState=null,t}function c_(t,e,n){var i=e.pendingProps,a=(e.flags&128)!==0;if(e.flags&=-129,t===null){if(ue){if(i.mode==="hidden")return t=_l(e,i),e.lanes=536870912,Lr(null,t);if(lf(e),(t=Me)?(t=fS(t,dn),t=t!==null&&t.data==="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:ua!==null?{id:qn,overflow:zn}:null,retryLane:536870912,hydrationErrors:null},n=_b(t),n.return=e,e.child=n,pt=e,Me=null)):t=null,t===null)throw da(e);return e.lanes=536870912,null}return _l(e,i)}var s=t.memoizedState;if(s!==null){var r=s.dehydrated;if(lf(e),a)if(e.flags&256)e.flags&=-257,e=dg(t,e,n);else if(e.memoizedState!==null)e.child=t.child,e.flags|=128,e=null;else throw Error(L(558));else if(et||sr(t,e,n,!1),a=(n&t.childLanes)!==0,et||a){if(i=xe,i!==null&&(r=Z0(i,n),r!==0&&r!==s.retryLane))throw s.retryLane=r,Wa(t,r),It(i,t,r),Zh;mc(),e=dg(t,e,n)}else t=s.treeContext,Me=pn(r.nextSibling),pt=e,ue=!0,$i=null,dn=!1,t!==null&&xb(e,t),e=_l(e,i),e.flags|=4096;return e}return t=pi(t.child,{mode:i.mode,children:i.children}),t.ref=e.ref,e.child=t,t.return=e,t}function Rl(t,e){var n=e.ref;if(n===null)t!==null&&t.ref!==null&&(e.flags|=4194816);else{if(typeof n!="function"&&typeof n!="object")throw Error(L(284));(t===null||t.ref!==n)&&(e.flags|=4194816)}}function mf(t,e,n,i,a){return za(e),n=Bh(t,e,n,i,void 0,a),i=qh(),t!==null&&!et?(zh(t,e,a),ki(t,e,a)):(ue&&i&&Mh(e),e.flags|=1,ht(t,e,n,a),e.child)}function fg(t,e,n,i,a,s){return za(e),e.updateQueue=null,n=Ib(e,i,n,a),Ub(t),i=qh(),t!==null&&!et?(zh(t,e,s),ki(t,e,s)):(ue&&i&&Mh(e),e.flags|=1,ht(t,e,n,s),e.child)}function hg(t,e,n,i,a){if(za(e),e.stateNode===null){var s=Ss,r=n.contextType;typeof r=="object"&&r!==null&&(s=gt(r)),s=new n(i,s),e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=ff,e.stateNode=s,s._reactInternals=e,s=e.stateNode,s.props=i,s.state=e.memoizedState,s.refs={},Uh(e),r=n.contextType,s.context=typeof r=="object"&&r!==null?gt(r):Ss,s.state=e.memoizedState,r=n.getDerivedStateFromProps,typeof r=="function"&&(ju(e,n,r,i),s.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(r=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),r!==s.state&&ff.enqueueReplaceState(s,s.state,null),Qr(e,i,s,a),Yr(),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308),i=!0}else if(t===null){s=e.stateNode;var o=e.memoizedProps,l=Ha(n,o);s.props=l;var c=s.context,u=n.contextType;r=Ss,typeof u=="object"&&u!==null&&(r=gt(u));var d=n.getDerivedStateFromProps;u=typeof d=="function"||typeof s.getSnapshotBeforeUpdate=="function",o=e.pendingProps!==o,u||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(o||c!==r)&&rg(e,s,i,r),ji=!1;var f=e.memoizedState;s.state=f,Qr(e,i,s,a),Yr(),c=e.memoizedState,o||f!==c||ji?(typeof d=="function"&&(ju(e,n,d,i),c=e.memoizedState),(l=ji||sg(e,n,l,i,f,c,r))?(u||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=c),s.props=i,s.state=c,s.context=r,i=l):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{s=e.stateNode,sf(t,e),r=e.memoizedProps,u=Ha(n,r),s.props=u,d=e.pendingProps,f=s.context,c=n.contextType,l=Ss,typeof c=="object"&&c!==null&&(l=gt(c)),o=n.getDerivedStateFromProps,(c=typeof o=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(r!==d||f!==l)&&rg(e,s,i,l),ji=!1,f=e.memoizedState,s.state=f,Qr(e,i,s,a),Yr();var h=e.memoizedState;r!==d||f!==h||ji||t!==null&&t.dependencies!==null&&ic(t.dependencies)?(typeof o=="function"&&(ju(e,n,o,i),h=e.memoizedState),(u=ji||sg(e,n,u,i,f,h,l)||t!==null&&t.dependencies!==null&&ic(t.dependencies))?(c||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(i,h,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(i,h,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||r===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||r===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=h),s.props=i,s.state=h,s.context=l,i=u):(typeof s.componentDidUpdate!="function"||r===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||r===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return s=i,Rl(t,e),i=(e.flags&128)!==0,s||i?(s=e.stateNode,n=i&&typeof n.getDerivedStateFromError!="function"?null:s.render(),e.flags|=1,t!==null&&i?(e.child=Fa(e,t.child,null,a),e.child=Fa(e,null,n,a)):ht(t,e,n,a),e.memoizedState=s.state,t=e.child):t=ki(t,e,a),t}function mg(t,e,n,i){return qa(),e.flags|=256,ht(t,e,n,i),e.child}var Bu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function qu(t){return{baseLanes:t,cachePool:Ob()}}function zu(t,e,n){return t=t!==null?t.childLanes&~n:0,e&&(t|=Kt),t}function Ty(t,e,n){var i=e.pendingProps,a=!1,s=(e.flags&128)!==0,r;if((r=s)||(r=t!==null&&t.memoizedState===null?!1:(Ye.current&2)!==0),r&&(a=!0,e.flags&=-129),r=(e.flags&32)!==0,e.flags&=-33,t===null){if(ue){if(a?zi(e):Fi(),(t=Me)?(t=fS(t,dn),t=t!==null&&t.data!=="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:ua!==null?{id:qn,overflow:zn}:null,retryLane:536870912,hydrationErrors:null},n=_b(t),n.return=e,e.child=n,pt=e,Me=null)):t=null,t===null)throw da(e);return wf(t)?e.lanes=32:e.lanes=536870912,null}var o=i.children;return i=i.fallback,a?(Fi(),a=e.mode,o=uc({mode:"hidden",children:o},a),i=La(i,a,n,null),o.return=e,i.return=e,o.sibling=i,e.child=o,i=e.child,i.memoizedState=qu(n),i.childLanes=zu(t,r,n),e.memoizedState=Bu,Lr(null,i)):(zi(e),pf(e,o))}var l=t.memoizedState;if(l!==null&&(o=l.dehydrated,o!==null)){if(s)e.flags&256?(zi(e),e.flags&=-257,e=Fu(t,e,n)):e.memoizedState!==null?(Fi(),e.child=t.child,e.flags|=128,e=null):(Fi(),o=i.fallback,a=e.mode,i=uc({mode:"visible",children:i.children},a),o=La(o,a,n,null),o.flags|=2,i.return=e,o.return=e,i.sibling=o,e.child=i,Fa(e,t.child,null,n),i=e.child,i.memoizedState=qu(n),i.childLanes=zu(t,r,n),e.memoizedState=Bu,e=Lr(null,i));else if(zi(e),wf(o)){if(r=o.nextSibling&&o.nextSibling.dataset,r)var c=r.dgst;r=c,i=Error(L(419)),i.stack="",i.digest=r,uo({value:i,source:null,stack:null}),e=Fu(t,e,n)}else if(et||sr(t,e,n,!1),r=(n&t.childLanes)!==0,et||r){if(r=xe,r!==null&&(i=Z0(r,n),i!==0&&i!==l.retryLane))throw l.retryLane=i,Wa(t,i),It(r,t,i),Zh;xf(o)||mc(),e=Fu(t,e,n)}else xf(o)?(e.flags|=192,e.child=t.child,e=null):(t=l.treeContext,Me=pn(o.nextSibling),pt=e,ue=!0,$i=null,dn=!1,t!==null&&xb(e,t),e=pf(e,i.children),e.flags|=4096);return e}return a?(Fi(),o=i.fallback,a=e.mode,l=t.child,c=l.sibling,i=pi(l,{mode:"hidden",children:i.children}),i.subtreeFlags=l.subtreeFlags&65011712,c!==null?o=pi(c,o):(o=La(o,a,n,null),o.flags|=2),o.return=e,i.return=e,i.sibling=o,e.child=i,Lr(null,i),i=e.child,o=t.child.memoizedState,o===null?o=qu(n):(a=o.cachePool,a!==null?(l=$e._currentValue,a=a.parent!==l?{parent:l,pool:l}:a):a=Ob(),o={baseLanes:o.baseLanes|n,cachePool:a}),i.memoizedState=o,i.childLanes=zu(t,r,n),e.memoizedState=Bu,Lr(t.child,i)):(zi(e),n=t.child,t=n.sibling,n=pi(n,{mode:"visible",children:i.children}),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n)}function pf(t,e){return e=uc({mode:"visible",children:e},t.mode),e.return=t,t.child=e}function uc(t,e){return t=Gt(22,t,null,e),t.lanes=0,t}function Fu(t,e,n){return Fa(e,t.child,null,n),t=pf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function pg(t,e,n){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),tf(t.return,e,n)}function Vu(t,e,n,i,a,s){var r=t.memoizedState;r===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:n,tailMode:a,treeForkCount:s}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=n,r.tailMode=a,r.treeForkCount=s)}function Cy(t,e,n){var i=e.pendingProps,a=i.revealOrder,s=i.tail;i=i.children;var r=Ye.current,o=(r&2)!==0;if(o?(r=r&1|2,e.flags|=128):r&=1,we(Ye,r),ht(t,e,i,n),i=ue?co:0,!o&&t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&pg(t,n,e);else if(t.tag===19)pg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(a){case"forwards":for(n=e.child,a=null;n!==null;)t=n.alternate,t!==null&&rc(t)===null&&(a=n),n=n.sibling;n=a,n===null?(a=e.child,e.child=null):(a=n.sibling,n.sibling=null),Vu(e,!1,a,n,s,i);break;case"backwards":case"unstable_legacy-backwards":for(n=null,a=e.child,e.child=null;a!==null;){if(t=a.alternate,t!==null&&rc(t)===null){e.child=a;break}t=a.sibling,a.sibling=n,n=a,a=t}Vu(e,!0,n,null,s,i);break;case"together":Vu(e,!1,null,null,void 0,i);break;default:e.memoizedState=null}return e.child}function ki(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ha|=e.lanes,!(n&e.childLanes))if(t!==null){if(sr(t,e,n,!1),(n&e.childLanes)===0)return null}else return null;if(t!==null&&e.child!==t.child)throw Error(L(153));if(e.child!==null){for(t=e.child,n=pi(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=pi(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Wh(t,e){return t.lanes&e?!0:(t=t.dependencies,!!(t!==null&&ic(t)))}function u_(t,e,n){switch(e.tag){case 3:Xl(e,e.stateNode.containerInfo),qi(e,$e,t.memoizedState.cache),qa();break;case 27:case 5:Fd(e);break;case 4:Xl(e,e.stateNode.containerInfo);break;case 10:qi(e,e.type,e.memoizedProps.value);break;case 31:if(e.memoizedState!==null)return e.flags|=128,lf(e),null;break;case 13:var i=e.memoizedState;if(i!==null)return i.dehydrated!==null?(zi(e),e.flags|=128,null):n&e.child.childLanes?Ty(t,e,n):(zi(e),t=ki(t,e,n),t!==null?t.sibling:null);zi(e);break;case 19:var a=(t.flags&128)!==0;if(i=(n&e.childLanes)!==0,i||(sr(t,e,n,!1),i=(n&e.childLanes)!==0),a){if(i)return Cy(t,e,n);e.flags|=128}if(a=e.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),we(Ye,Ye.current),i)break;return null;case 22:return e.lanes=0,Sy(t,e,n,e.pendingProps);case 24:qi(e,$e,t.memoizedState.cache)}return ki(t,e,n)}function ky(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps)et=!0;else{if(!Wh(t,n)&&!(e.flags&128))return et=!1,u_(t,e,n);et=!!(t.flags&131072)}else et=!1,ue&&e.flags&1048576&&Rb(e,co,e.index);switch(e.lanes=0,e.tag){case 16:e:{var i=e.pendingProps;if(t=Oa(e.elementType),e.type=t,typeof t=="function")Ah(t)?(i=Ha(t,i),e.tag=1,e=hg(null,e,t,i,n)):(e.tag=0,e=mf(null,e,t,i,n));else{if(t!=null){var a=t.$$typeof;if(a===gh){e.tag=11,e=lg(null,e,t,i,n);break e}else if(a===vh){e.tag=14,e=cg(null,e,t,i,n);break e}}throw e=qd(t)||t,Error(L(306,e,""))}}return e;case 0:return mf(t,e,e.type,e.pendingProps,n);case 1:return i=e.type,a=Ha(i,e.pendingProps),hg(t,e,i,a,n);case 3:e:{if(Xl(e,e.stateNode.containerInfo),t===null)throw Error(L(387));i=e.pendingProps;var s=e.memoizedState;a=s.element,sf(t,e),Qr(e,i,null,n);var r=e.memoizedState;if(i=r.cache,qi(e,$e,i),i!==s.cache&&nf(e,[$e],n,!0),Yr(),i=r.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:r.cache},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){e=mg(t,e,i,n);break e}else if(i!==a){a=un(Error(L(424)),e),uo(a),e=mg(t,e,i,n);break e}else{switch(t=e.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(Me=pn(t.firstChild),pt=e,ue=!0,$i=null,dn=!0,n=Db(e,null,i,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling}else{if(qa(),i===a){e=ki(t,e,n);break e}ht(t,e,i,n)}e=e.child}return e;case 26:return Rl(t,e),t===null?(n=Lg(e.type,null,e.pendingProps,null))?e.memoizedState=n:ue||(n=e.type,t=e.pendingProps,i=bc(Wi.current).createElement(n),i[mt]=e,i[Bt]=t,yt(i,n,t),ct(i),e.stateNode=i):e.memoizedState=Lg(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return Fd(e),t===null&&ue&&(i=e.stateNode=hS(e.type,e.pendingProps,Wi.current),pt=e,dn=!0,a=Me,ba(e.type)?(Of=a,Me=pn(i.firstChild)):Me=a),ht(t,e,e.pendingProps.children,n),Rl(t,e),t===null&&(e.flags|=4194304),e.child;case 5:return t===null&&ue&&((a=i=Me)&&(i=q_(i,e.type,e.pendingProps,dn),i!==null?(e.stateNode=i,pt=e,Me=pn(i.firstChild),dn=!1,a=!0):a=!1),a||da(e)),Fd(e),a=e.type,s=e.pendingProps,r=t!==null?t.memoizedProps:null,i=s.children,_f(a,s)?i=null:r!==null&&_f(a,r)&&(e.flags|=32),e.memoizedState!==null&&(a=Bh(t,e,t_,null,null,n),vo._currentValue=a),Rl(t,e),ht(t,e,i,n),e.child;case 6:return t===null&&ue&&((t=n=Me)&&(n=z_(n,e.pendingProps,dn),n!==null?(e.stateNode=n,pt=e,Me=null,t=!0):t=!1),t||da(e)),null;case 13:return Ty(t,e,n);case 4:return Xl(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=Fa(e,null,i,n):ht(t,e,i,n),e.child;case 11:return lg(t,e,e.type,e.pendingProps,n);case 7:return ht(t,e,e.pendingProps,n),e.child;case 8:return ht(t,e,e.pendingProps.children,n),e.child;case 12:return ht(t,e,e.pendingProps.children,n),e.child;case 10:return i=e.pendingProps,qi(e,e.type,i.value),ht(t,e,i.children,n),e.child;case 9:return a=e.type._context,i=e.pendingProps.children,za(e),a=gt(a),i=i(a),e.flags|=1,ht(t,e,i,n),e.child;case 14:return cg(t,e,e.type,e.pendingProps,n);case 15:return yy(t,e,e.type,e.pendingProps,n);case 19:return Cy(t,e,n);case 31:return c_(t,e,n);case 22:return Sy(t,e,n,e.pendingProps);case 24:return za(e),i=gt($e),t===null?(a=Ph(),a===null&&(a=xe,s=Nh(),a.pooledCache=s,s.refCount++,s!==null&&(a.pooledCacheLanes|=n),a=s),e.memoizedState={parent:i,cache:a},Uh(e),qi(e,$e,a)):(t.lanes&n&&(sf(t,e),Qr(e,null,null,n),Yr()),a=t.memoizedState,s=e.memoizedState,a.parent!==i?(a={parent:i,cache:i},e.memoizedState=a,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=a),qi(e,$e,i)):(i=s.cache,qi(e,$e,i),i!==a.cache&&nf(e,[$e],n,!0))),ht(t,e,e.pendingProps.children,n),e.child;case 29:throw e.pendingProps}throw Error(L(156,e.tag))}function $n(t){t.flags|=4}function Hu(t,e,n,i,a){if((e=(t.mode&32)!==0)&&(e=!1),e){if(t.flags|=16777216,(a&335544128)===a)if(t.stateNode.complete)t.flags|=8192;else if(Yy())t.flags|=8192;else throw Ia=ac,Lh}else t.flags&=-16777217}function gg(t,e){if(e.type!=="stylesheet"||e.state.loading&4)t.flags&=-16777217;else if(t.flags|=16777216,!gS(e))if(Yy())t.flags|=8192;else throw Ia=ac,Lh}function al(t,e){e!==null&&(t.flags|=4),t.flags&16384&&(e=t.tag!==22?Q0():536870912,t.lanes|=e,Qs|=e)}function yr(t,e){if(!ue)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var i=null;n!==null;)n.alternate!==null&&(i=n),n=n.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Ae(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,i=0;if(e)for(var a=t.child;a!==null;)n|=a.lanes|a.childLanes,i|=a.subtreeFlags&65011712,i|=a.flags&65011712,a.return=t,a=a.sibling;else for(a=t.child;a!==null;)n|=a.lanes|a.childLanes,i|=a.subtreeFlags,i|=a.flags,a.return=t,a=a.sibling;return t.subtreeFlags|=i,t.childLanes=n,e}function d_(t,e,n){var i=e.pendingProps;switch(Dh(e),e.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ae(e),null;case 1:return Ae(e),null;case 3:return n=e.stateNode,i=null,t!==null&&(i=t.memoizedState.cache),e.memoizedState.cache!==i&&(e.flags|=2048),gi($e),Fs(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(ss(e)?$n(e):t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Lu())),Ae(e),null;case 26:var a=e.type,s=e.memoizedState;return t===null?($n(e),s!==null?(Ae(e),gg(e,s)):(Ae(e),Hu(e,a,null,i,n))):s?s!==t.memoizedState?($n(e),Ae(e),gg(e,s)):(Ae(e),e.flags&=-16777217):(t=t.memoizedProps,t!==i&&$n(e),Ae(e),Hu(e,a,t,i,n)),null;case 27:if(Zl(e),n=Wi.current,a=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==i&&$n(e);else{if(!i){if(e.stateNode===null)throw Error(L(166));return Ae(e),null}t=Vn.current,ss(e)?Gp(e):(t=hS(a,i,n),e.stateNode=t,$n(e))}return Ae(e),null;case 5:if(Zl(e),a=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==i&&$n(e);else{if(!i){if(e.stateNode===null)throw Error(L(166));return Ae(e),null}if(s=Vn.current,ss(e))Gp(e);else{var r=bc(Wi.current);switch(s){case 1:s=r.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:s=r.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":s=r.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":s=r.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":s=r.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof i.is=="string"?r.createElement("select",{is:i.is}):r.createElement("select"),i.multiple?s.multiple=!0:i.size&&(s.size=i.size);break;default:s=typeof i.is=="string"?r.createElement(a,{is:i.is}):r.createElement(a)}}s[mt]=e,s[Bt]=i;e:for(r=e.child;r!==null;){if(r.tag===5||r.tag===6)s.appendChild(r.stateNode);else if(r.tag!==4&&r.tag!==27&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}e.stateNode=s;e:switch(yt(s,a,i),a){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&$n(e)}}return Ae(e),Hu(e,e.type,t===null?null:t.memoizedProps,e.pendingProps,n),null;case 6:if(t&&e.stateNode!=null)t.memoizedProps!==i&&$n(e);else{if(typeof i!="string"&&e.stateNode===null)throw Error(L(166));if(t=Wi.current,ss(e)){if(t=e.stateNode,n=e.memoizedProps,i=null,a=pt,a!==null)switch(a.tag){case 27:case 5:i=a.memoizedProps}t[mt]=e,t=!!(t.nodeValue===n||i!==null&&i.suppressHydrationWarning===!0||cS(t.nodeValue,n)),t||da(e,!0)}else t=bc(t).createTextNode(i),t[mt]=e,e.stateNode=t}return Ae(e),null;case 31:if(n=e.memoizedState,t===null||t.memoizedState!==null){if(i=ss(e),n!==null){if(t===null){if(!i)throw Error(L(318));if(t=e.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(L(557));t[mt]=e}else qa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ae(e),t=!1}else n=Lu(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=n),t=!0;if(!t)return e.flags&256?(Ht(e),e):(Ht(e),null);if(e.flags&128)throw Error(L(558))}return Ae(e),null;case 13:if(i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(a=ss(e),i!==null&&i.dehydrated!==null){if(t===null){if(!a)throw Error(L(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(L(317));a[mt]=e}else qa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ae(e),a=!1}else a=Lu(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=a),a=!0;if(!a)return e.flags&256?(Ht(e),e):(Ht(e),null)}return Ht(e),e.flags&128?(e.lanes=n,e):(n=i!==null,t=t!==null&&t.memoizedState!==null,n&&(i=e.child,a=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(a=i.alternate.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==a&&(i.flags|=2048)),n!==t&&n&&(e.child.flags|=8192),al(e,e.updateQueue),Ae(e),null);case 4:return Fs(),t===null&&sm(e.stateNode.containerInfo),Ae(e),null;case 10:return gi(e.type),Ae(e),null;case 19:if(dt(Ye),i=e.memoizedState,i===null)return Ae(e),null;if(a=(e.flags&128)!==0,s=i.rendering,s===null)if(a)yr(i,!1);else{if(qe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=rc(t),s!==null){for(e.flags|=128,yr(i,!1),t=s.updateQueue,e.updateQueue=t,al(e,t),e.subtreeFlags=0,t=n,n=e.child;n!==null;)Eb(n,t),n=n.sibling;return we(Ye,Ye.current&1|2),ue&&si(e,i.treeForkCount),e.child}t=t.sibling}i.tail!==null&&Qt()>fc&&(e.flags|=128,a=!0,yr(i,!1),e.lanes=4194304)}else{if(!a)if(t=rc(s),t!==null){if(e.flags|=128,a=!0,t=t.updateQueue,e.updateQueue=t,al(e,t),yr(i,!0),i.tail===null&&i.tailMode==="hidden"&&!s.alternate&&!ue)return Ae(e),null}else 2*Qt()-i.renderingStartTime>fc&&n!==536870912&&(e.flags|=128,a=!0,yr(i,!1),e.lanes=4194304);i.isBackwards?(s.sibling=e.child,e.child=s):(t=i.last,t!==null?t.sibling=s:e.child=s,i.last=s)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Qt(),t.sibling=null,n=Ye.current,we(Ye,a?n&1|2:n&1),ue&&si(e,i.treeForkCount),t):(Ae(e),null);case 22:case 23:return Ht(e),Ih(),i=e.memoizedState!==null,t!==null?t.memoizedState!==null!==i&&(e.flags|=8192):i&&(e.flags|=8192),i?n&536870912&&!(e.flags&128)&&(Ae(e),e.subtreeFlags&6&&(e.flags|=8192)):Ae(e),n=e.updateQueue,n!==null&&al(e,n.retryQueue),n=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),i=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),i!==n&&(e.flags|=2048),t!==null&&dt(Ua),null;case 24:return n=null,t!==null&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),gi($e),Ae(e),null;case 25:return null;case 30:return null}throw Error(L(156,e.tag))}function f_(t,e){switch(Dh(e),e.tag){case 1:return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return gi($e),Fs(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 26:case 27:case 5:return Zl(e),null;case 31:if(e.memoizedState!==null){if(Ht(e),e.alternate===null)throw Error(L(340));qa()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 13:if(Ht(e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(L(340));qa()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return dt(Ye),null;case 4:return Fs(),null;case 10:return gi(e.type),null;case 22:case 23:return Ht(e),Ih(),t!==null&&dt(Ua),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 24:return gi($e),null;case 25:return null;default:return null}}function Ey(t,e){switch(Dh(e),e.tag){case 3:gi($e),Fs();break;case 26:case 27:case 5:Zl(e);break;case 4:Fs();break;case 31:e.memoizedState!==null&&Ht(e);break;case 13:Ht(e);break;case 19:dt(Ye);break;case 10:gi(e.type);break;case 22:case 23:Ht(e),Ih(),t!==null&&dt(Ua);break;case 24:gi($e)}}function jo(t,e){try{var n=e.updateQueue,i=n!==null?n.lastEffect:null;if(i!==null){var a=i.next;n=a;do{if((n.tag&t)===t){i=void 0;var s=n.create,r=n.inst;i=s(),r.destroy=i}n=n.next}while(n!==a)}}catch(o){Se(e,e.return,o)}}function fa(t,e,n){try{var i=e.updateQueue,a=i!==null?i.lastEffect:null;if(a!==null){var s=a.next;i=s;do{if((i.tag&t)===t){var r=i.inst,o=r.destroy;if(o!==void 0){r.destroy=void 0,a=e;var l=n,c=o;try{c()}catch(u){Se(a,l,u)}}}i=i.next}while(i!==s)}}catch(u){Se(e,e.return,u)}}function _y(t){var e=t.updateQueue;if(e!==null){var n=t.stateNode;try{Pb(e,n)}catch(i){Se(t,t.return,i)}}}function Ry(t,e,n){n.props=Ha(t.type,t.memoizedProps),n.state=t.memoizedState;try{n.componentWillUnmount()}catch(i){Se(t,e,i)}}function Xr(t,e){try{var n=t.ref;if(n!==null){switch(t.tag){case 26:case 27:case 5:var i=t.stateNode;break;case 30:i=t.stateNode;break;default:i=t.stateNode}typeof n=="function"?t.refCleanup=n(i):n.current=i}}catch(a){Se(t,e,a)}}function Fn(t,e){var n=t.ref,i=t.refCleanup;if(n!==null)if(typeof i=="function")try{i()}catch(a){Se(t,e,a)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof n=="function")try{n(null)}catch(a){Se(t,e,a)}else n.current=null}function xy(t){var e=t.type,n=t.memoizedProps,i=t.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":n.autoFocus&&i.focus();break e;case"img":n.src?i.src=n.src:n.srcSet&&(i.srcset=n.srcSet)}}catch(a){Se(t,t.return,a)}}function Gu(t,e,n){try{var i=t.stateNode;P_(i,t.type,n,e),i[Bt]=e}catch(a){Se(t,t.return,a)}}function wy(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&ba(t.type)||t.tag===4}function Ku(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||wy(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&ba(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function gf(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n).insertBefore(t,e):(e=n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,e.appendChild(t),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=hi));else if(i!==4&&(i===27&&ba(t.type)&&(n=t.stateNode,e=null),t=t.child,t!==null))for(gf(t,e,n),t=t.sibling;t!==null;)gf(t,e,n),t=t.sibling}function dc(t,e,n){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(i!==4&&(i===27&&ba(t.type)&&(n=t.stateNode),t=t.child,t!==null))for(dc(t,e,n),t=t.sibling;t!==null;)dc(t,e,n),t=t.sibling}function Oy(t){var e=t.stateNode,n=t.memoizedProps;try{for(var i=t.type,a=e.attributes;a.length;)e.removeAttributeNode(a[0]);yt(e,i,n),e[mt]=t,e[Bt]=n}catch(s){Se(t,t.return,s)}}var oi=!1,We=!1,Yu=!1,vg=typeof WeakSet=="function"?WeakSet:Set,ot=null;function h_(t,e){if(t=t.containerInfo,kf=Cc,t=gb(t),xh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var i=n.getSelection&&n.getSelection();if(i&&i.rangeCount!==0){n=i.anchorNode;var a=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var r=0,o=-1,l=-1,c=0,u=0,d=t,f=null;t:for(;;){for(var h;d!==n||a!==0&&d.nodeType!==3||(o=r+a),d!==s||i!==0&&d.nodeType!==3||(l=r+i),d.nodeType===3&&(r+=d.nodeValue.length),(h=d.firstChild)!==null;)f=d,d=h;for(;;){if(d===t)break t;if(f===n&&++c===a&&(o=r),f===s&&++u===i&&(l=r),(h=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=h}n=o===-1||l===-1?null:{start:o,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ef={focusedElem:t,selectionRange:n},Cc=!1,ot=e;ot!==null;)if(e=ot,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ot=t;else for(;ot!==null;){switch(e=ot,s=e.alternate,t=e.flags,e.tag){case 0:if(t&4&&(t=e.updateQueue,t=t!==null?t.events:null,t!==null))for(n=0;n<t.length;n++)a=t[n],a.ref.impl=a.nextImpl;break;case 11:case 15:break;case 1:if(t&1024&&s!==null){t=void 0,n=e,a=s.memoizedProps,s=s.memoizedState,i=n.stateNode;try{var g=Ha(n.type,a);t=i.getSnapshotBeforeUpdate(g,s),i.__reactInternalSnapshotBeforeUpdate=t}catch(y){Se(n,n.return,y)}}break;case 3:if(t&1024){if(t=e.stateNode.containerInfo,n=t.nodeType,n===9)Rf(t);else if(n===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Rf(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(t&1024)throw Error(L(163))}if(t=e.sibling,t!==null){t.return=e.return,ot=t;break}ot=e.return}}function Ay(t,e,n){var i=n.flags;switch(n.tag){case 0:case 11:case 15:ti(t,n),i&4&&jo(5,n);break;case 1:if(ti(t,n),i&4)if(t=n.stateNode,e===null)try{t.componentDidMount()}catch(r){Se(n,n.return,r)}else{var a=Ha(n.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(a,e,t.__reactInternalSnapshotBeforeUpdate)}catch(r){Se(n,n.return,r)}}i&64&&_y(n),i&512&&Xr(n,n.return);break;case 3:if(ti(t,n),i&64&&(t=n.updateQueue,t!==null)){if(e=null,n.child!==null)switch(n.child.tag){case 27:case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}try{Pb(t,e)}catch(r){Se(n,n.return,r)}}break;case 27:e===null&&i&4&&Oy(n);case 26:case 5:ti(t,n),e===null&&i&4&&xy(n),i&512&&Xr(n,n.return);break;case 12:ti(t,n);break;case 31:ti(t,n),i&4&&Ny(t,n);break;case 13:ti(t,n),i&4&&Py(t,n),i&64&&(t=n.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(n=C_.bind(null,n),F_(t,n))));break;case 22:if(i=n.memoizedState!==null||oi,!i){e=e!==null&&e.memoizedState!==null||We,a=oi;var s=We;oi=i,(We=e)&&!s?ii(t,n,(n.subtreeFlags&8772)!==0):ti(t,n),oi=a,We=s}break;case 30:break;default:ti(t,n)}}function My(t){var e=t.alternate;e!==null&&(t.alternate=null,My(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&Th(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Le=null,Nt=!1;function ei(t,e,n){for(n=n.child;n!==null;)Dy(t,e,n),n=n.sibling}function Dy(t,e,n){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(Mo,n)}catch{}switch(n.tag){case 26:We||Fn(n,e),ei(t,e,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode,n.parentNode.removeChild(n));break;case 27:We||Fn(n,e);var i=Le,a=Nt;ba(n.type)&&(Le=n.stateNode,Nt=!1),ei(t,e,n),eo(n.stateNode),Le=i,Nt=a;break;case 5:We||Fn(n,e);case 6:if(i=Le,a=Nt,Le=null,ei(t,e,n),Le=i,Nt=a,Le!==null)if(Nt)try{(Le.nodeType===9?Le.body:Le.nodeName==="HTML"?Le.ownerDocument.body:Le).removeChild(n.stateNode)}catch(s){Se(n,e,s)}else try{Le.removeChild(n.stateNode)}catch(s){Se(n,e,s)}break;case 18:Le!==null&&(Nt?(t=Le,Ag(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,n.stateNode),Ws(t)):Ag(Le,n.stateNode));break;case 4:i=Le,a=Nt,Le=n.stateNode.containerInfo,Nt=!0,ei(t,e,n),Le=i,Nt=a;break;case 0:case 11:case 14:case 15:fa(2,n,e),We||fa(4,n,e),ei(t,e,n);break;case 1:We||(Fn(n,e),i=n.stateNode,typeof i.componentWillUnmount=="function"&&Ry(n,e,i)),ei(t,e,n);break;case 21:ei(t,e,n);break;case 22:We=(i=We)||n.memoizedState!==null,ei(t,e,n),We=i;break;default:ei(t,e,n)}}function Ny(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{Ws(t)}catch(n){Se(e,e.return,n)}}}function Py(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Ws(t)}catch(n){Se(e,e.return,n)}}function m_(t){switch(t.tag){case 31:case 13:case 19:var e=t.stateNode;return e===null&&(e=t.stateNode=new vg),e;case 22:return t=t.stateNode,e=t._retryCache,e===null&&(e=t._retryCache=new vg),e;default:throw Error(L(435,t.tag))}}function sl(t,e){var n=m_(t);e.forEach(function(i){if(!n.has(i)){n.add(i);var a=k_.bind(null,t,i);i.then(a,a)}})}function Mt(t,e){var n=e.deletions;if(n!==null)for(var i=0;i<n.length;i++){var a=n[i],s=t,r=e,o=r;e:for(;o!==null;){switch(o.tag){case 27:if(ba(o.type)){Le=o.stateNode,Nt=!1;break e}break;case 5:Le=o.stateNode,Nt=!1;break e;case 3:case 4:Le=o.stateNode.containerInfo,Nt=!0;break e}o=o.return}if(Le===null)throw Error(L(160));Dy(s,r,a),Le=null,Nt=!1,s=a.alternate,s!==null&&(s.return=null),a.return=null}if(e.subtreeFlags&13886)for(e=e.child;e!==null;)Ly(e,t),e=e.sibling}var _n=null;function Ly(t,e){var n=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Mt(e,t),Dt(t),i&4&&(fa(3,t,t.return),jo(3,t),fa(5,t,t.return));break;case 1:Mt(e,t),Dt(t),i&512&&(We||n===null||Fn(n,n.return)),i&64&&oi&&(t=t.updateQueue,t!==null&&(i=t.callbacks,i!==null&&(n=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=n===null?i:n.concat(i))));break;case 26:var a=_n;if(Mt(e,t),Dt(t),i&512&&(We||n===null||Fn(n,n.return)),i&4){var s=n!==null?n.memoizedState:null;if(i=t.memoizedState,n===null)if(i===null)if(t.stateNode===null){e:{i=t.type,n=t.memoizedProps,a=a.ownerDocument||a;t:switch(i){case"title":s=a.getElementsByTagName("title")[0],(!s||s[Po]||s[mt]||s.namespaceURI==="http://www.w3.org/2000/svg"||s.hasAttribute("itemprop"))&&(s=a.createElement(i),a.head.insertBefore(s,a.querySelector("head > title"))),yt(s,i,n),s[mt]=t,ct(s),i=s;break e;case"link":var r=Ig("link","href",a).get(i+(n.href||""));if(r){for(var o=0;o<r.length;o++)if(s=r[o],s.getAttribute("href")===(n.href==null||n.href===""?null:n.href)&&s.getAttribute("rel")===(n.rel==null?null:n.rel)&&s.getAttribute("title")===(n.title==null?null:n.title)&&s.getAttribute("crossorigin")===(n.crossOrigin==null?null:n.crossOrigin)){r.splice(o,1);break t}}s=a.createElement(i),yt(s,i,n),a.head.appendChild(s);break;case"meta":if(r=Ig("meta","content",a).get(i+(n.content||""))){for(o=0;o<r.length;o++)if(s=r[o],s.getAttribute("content")===(n.content==null?null:""+n.content)&&s.getAttribute("name")===(n.name==null?null:n.name)&&s.getAttribute("property")===(n.property==null?null:n.property)&&s.getAttribute("http-equiv")===(n.httpEquiv==null?null:n.httpEquiv)&&s.getAttribute("charset")===(n.charSet==null?null:n.charSet)){r.splice(o,1);break t}}s=a.createElement(i),yt(s,i,n),a.head.appendChild(s);break;default:throw Error(L(468,i))}s[mt]=t,ct(s),i=s}t.stateNode=i}else jg(a,t.type,t.stateNode);else t.stateNode=Ug(a,i,t.memoizedProps);else s!==i?(s===null?n.stateNode!==null&&(n=n.stateNode,n.parentNode.removeChild(n)):s.count--,i===null?jg(a,t.type,t.stateNode):Ug(a,i,t.memoizedProps)):i===null&&t.stateNode!==null&&Gu(t,t.memoizedProps,n.memoizedProps)}break;case 27:Mt(e,t),Dt(t),i&512&&(We||n===null||Fn(n,n.return)),n!==null&&i&4&&Gu(t,t.memoizedProps,n.memoizedProps);break;case 5:if(Mt(e,t),Dt(t),i&512&&(We||n===null||Fn(n,n.return)),t.flags&32){a=t.stateNode;try{Hs(a,"")}catch(g){Se(t,t.return,g)}}i&4&&t.stateNode!=null&&(a=t.memoizedProps,Gu(t,a,n!==null?n.memoizedProps:a)),i&1024&&(Yu=!0);break;case 6:if(Mt(e,t),Dt(t),i&4){if(t.stateNode===null)throw Error(L(162));i=t.memoizedProps,n=t.stateNode;try{n.nodeValue=i}catch(g){Se(t,t.return,g)}}break;case 3:if(Ol=null,a=_n,_n=yc(e.containerInfo),Mt(e,t),_n=a,Dt(t),i&4&&n!==null&&n.memoizedState.isDehydrated)try{Ws(e.containerInfo)}catch(g){Se(t,t.return,g)}Yu&&(Yu=!1,Uy(t));break;case 4:i=_n,_n=yc(t.stateNode.containerInfo),Mt(e,t),Dt(t),_n=i;break;case 12:Mt(e,t),Dt(t);break;case 31:Mt(e,t),Dt(t),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,sl(t,i)));break;case 13:Mt(e,t),Dt(t),t.child.flags&8192&&t.memoizedState!==null!=(n!==null&&n.memoizedState!==null)&&(eu=Qt()),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,sl(t,i)));break;case 22:a=t.memoizedState!==null;var l=n!==null&&n.memoizedState!==null,c=oi,u=We;if(oi=c||a,We=u||l,Mt(e,t),We=u,oi=c,Dt(t),i&8192)e:for(e=t.stateNode,e._visibility=a?e._visibility&-2:e._visibility|1,a&&(n===null||l||oi||We||Aa(t)),n=null,e=t;;){if(e.tag===5||e.tag===26){if(n===null){l=n=e;try{if(s=l.stateNode,a)r=s.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none";else{o=l.stateNode;var d=l.memoizedProps.style,f=d!=null&&d.hasOwnProperty("display")?d.display:null;o.style.display=f==null||typeof f=="boolean"?"":(""+f).trim()}}catch(g){Se(l,l.return,g)}}}else if(e.tag===6){if(n===null){l=e;try{l.stateNode.nodeValue=a?"":l.memoizedProps}catch(g){Se(l,l.return,g)}}}else if(e.tag===18){if(n===null){l=e;try{var h=l.stateNode;a?Mg(h,!0):Mg(l.stateNode,!1)}catch(g){Se(l,l.return,g)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===t)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;n===e&&(n=null),e=e.return}n===e&&(n=null),e.sibling.return=e.return,e=e.sibling}i&4&&(i=t.updateQueue,i!==null&&(n=i.retryQueue,n!==null&&(i.retryQueue=null,sl(t,n))));break;case 19:Mt(e,t),Dt(t),i&4&&(i=t.updateQueue,i!==null&&(t.updateQueue=null,sl(t,i)));break;case 30:break;case 21:break;default:Mt(e,t),Dt(t)}}function Dt(t){var e=t.flags;if(e&2){try{for(var n,i=t.return;i!==null;){if(wy(i)){n=i;break}i=i.return}if(n==null)throw Error(L(160));switch(n.tag){case 27:var a=n.stateNode,s=Ku(t);dc(t,s,a);break;case 5:var r=n.stateNode;n.flags&32&&(Hs(r,""),n.flags&=-33);var o=Ku(t);dc(t,o,r);break;case 3:case 4:var l=n.stateNode.containerInfo,c=Ku(t);gf(t,c,l);break;default:throw Error(L(161))}}catch(u){Se(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Uy(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var e=t;Uy(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),t=t.sibling}}function ti(t,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)Ay(t,e.alternate,e),e=e.sibling}function Aa(t){for(t=t.child;t!==null;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:fa(4,e,e.return),Aa(e);break;case 1:Fn(e,e.return);var n=e.stateNode;typeof n.componentWillUnmount=="function"&&Ry(e,e.return,n),Aa(e);break;case 27:eo(e.stateNode);case 26:case 5:Fn(e,e.return),Aa(e);break;case 22:e.memoizedState===null&&Aa(e);break;case 30:Aa(e);break;default:Aa(e)}t=t.sibling}}function ii(t,e,n){for(n=n&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var i=e.alternate,a=t,s=e,r=s.flags;switch(s.tag){case 0:case 11:case 15:ii(a,s,n),jo(4,s);break;case 1:if(ii(a,s,n),i=s,a=i.stateNode,typeof a.componentDidMount=="function")try{a.componentDidMount()}catch(c){Se(i,i.return,c)}if(i=s,a=i.updateQueue,a!==null){var o=i.stateNode;try{var l=a.shared.hiddenCallbacks;if(l!==null)for(a.shared.hiddenCallbacks=null,a=0;a<l.length;a++)Nb(l[a],o)}catch(c){Se(i,i.return,c)}}n&&r&64&&_y(s),Xr(s,s.return);break;case 27:Oy(s);case 26:case 5:ii(a,s,n),n&&i===null&&r&4&&xy(s),Xr(s,s.return);break;case 12:ii(a,s,n);break;case 31:ii(a,s,n),n&&r&4&&Ny(a,s);break;case 13:ii(a,s,n),n&&r&4&&Py(a,s);break;case 22:s.memoizedState===null&&ii(a,s,n),Xr(s,s.return);break;case 30:break;default:ii(a,s,n)}e=e.sibling}}function $h(t,e){var n=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(n=t.memoizedState.cachePool.pool),t=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(t=e.memoizedState.cachePool.pool),t!==n&&(t!=null&&t.refCount++,n!=null&&Uo(n))}function em(t,e){t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Uo(t))}function kn(t,e,n,i){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)Iy(t,e,n,i),e=e.sibling}function Iy(t,e,n,i){var a=e.flags;switch(e.tag){case 0:case 11:case 15:kn(t,e,n,i),a&2048&&jo(9,e);break;case 1:kn(t,e,n,i);break;case 3:kn(t,e,n,i),a&2048&&(t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Uo(t)));break;case 12:if(a&2048){kn(t,e,n,i),t=e.stateNode;try{var s=e.memoizedProps,r=s.id,o=s.onPostCommit;typeof o=="function"&&o(r,e.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(l){Se(e,e.return,l)}}else kn(t,e,n,i);break;case 31:kn(t,e,n,i);break;case 13:kn(t,e,n,i);break;case 23:break;case 22:s=e.stateNode,r=e.alternate,e.memoizedState!==null?s._visibility&2?kn(t,e,n,i):Zr(t,e):s._visibility&2?kn(t,e,n,i):(s._visibility|=2,us(t,e,n,i,(e.subtreeFlags&10256)!==0||!1)),a&2048&&$h(r,e);break;case 24:kn(t,e,n,i),a&2048&&em(e.alternate,e);break;default:kn(t,e,n,i)}}function us(t,e,n,i,a){for(a=a&&((e.subtreeFlags&10256)!==0||!1),e=e.child;e!==null;){var s=t,r=e,o=n,l=i,c=r.flags;switch(r.tag){case 0:case 11:case 15:us(s,r,o,l,a),jo(8,r);break;case 23:break;case 22:var u=r.stateNode;r.memoizedState!==null?u._visibility&2?us(s,r,o,l,a):Zr(s,r):(u._visibility|=2,us(s,r,o,l,a)),a&&c&2048&&$h(r.alternate,r);break;case 24:us(s,r,o,l,a),a&&c&2048&&em(r.alternate,r);break;default:us(s,r,o,l,a)}e=e.sibling}}function Zr(t,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var n=t,i=e,a=i.flags;switch(i.tag){case 22:Zr(n,i),a&2048&&$h(i.alternate,i);break;case 24:Zr(n,i),a&2048&&em(i.alternate,i);break;default:Zr(n,i)}e=e.sibling}}var Ur=8192;function rs(t,e,n){if(t.subtreeFlags&Ur)for(t=t.child;t!==null;)jy(t,e,n),t=t.sibling}function jy(t,e,n){switch(t.tag){case 26:rs(t,e,n),t.flags&Ur&&t.memoizedState!==null&&eR(n,_n,t.memoizedState,t.memoizedProps);break;case 5:rs(t,e,n);break;case 3:case 4:var i=_n;_n=yc(t.stateNode.containerInfo),rs(t,e,n),_n=i;break;case 22:t.memoizedState===null&&(i=t.alternate,i!==null&&i.memoizedState!==null?(i=Ur,Ur=16777216,rs(t,e,n),Ur=i):rs(t,e,n));break;default:rs(t,e,n)}}function By(t){var e=t.alternate;if(e!==null&&(t=e.child,t!==null)){e.child=null;do e=t.sibling,t.sibling=null,t=e;while(t!==null)}}function Sr(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var i=e[n];ot=i,zy(i,t)}By(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)qy(t),t=t.sibling}function qy(t){switch(t.tag){case 0:case 11:case 15:Sr(t),t.flags&2048&&fa(9,t,t.return);break;case 3:Sr(t);break;case 12:Sr(t);break;case 22:var e=t.stateNode;t.memoizedState!==null&&e._visibility&2&&(t.return===null||t.return.tag!==13)?(e._visibility&=-3,xl(t)):Sr(t);break;default:Sr(t)}}function xl(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var n=0;n<e.length;n++){var i=e[n];ot=i,zy(i,t)}By(t)}for(t=t.child;t!==null;){switch(e=t,e.tag){case 0:case 11:case 15:fa(8,e,e.return),xl(e);break;case 22:n=e.stateNode,n._visibility&2&&(n._visibility&=-3,xl(e));break;default:xl(e)}t=t.sibling}}function zy(t,e){for(;ot!==null;){var n=ot;switch(n.tag){case 0:case 11:case 15:fa(8,n,e);break;case 23:case 22:if(n.memoizedState!==null&&n.memoizedState.cachePool!==null){var i=n.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:Uo(n.memoizedState.cache)}if(i=n.child,i!==null)i.return=n,ot=i;else e:for(n=t;ot!==null;){i=ot;var a=i.sibling,s=i.return;if(My(i),i===n){ot=null;break e}if(a!==null){a.return=s,ot=a;break e}ot=s}}}var p_={getCacheForType:function(t){var e=gt($e),n=e.data.get(t);return n===void 0&&(n=t(),e.data.set(t,n)),n},cacheSignal:function(){return gt($e).controller.signal}},g_=typeof WeakMap=="function"?WeakMap:Map,ge=0,xe=null,oe=null,ce=0,ye=0,Vt=null,Yi=!1,or=!1,tm=!1,Ei=0,qe=0,ha=0,ja=0,nm=0,Kt=0,Qs=0,Wr=null,Pt=null,vf=!1,eu=0,Fy=0,fc=1/0,hc=null,na=null,nt=0,ia=null,Js=null,vi=0,bf=0,yf=null,Vy=null,$r=0,Sf=null;function Zt(){return ge&2&&ce!==0?ce&-ce:W.T!==null?am():W0()}function Hy(){if(Kt===0)if(!(ce&536870912)||ue){var t=Zo;Zo<<=1,!(Zo&3932160)&&(Zo=262144),Kt=t}else Kt=536870912;return t=$t.current,t!==null&&(t.flags|=32),Kt}function It(t,e,n){(t===xe&&(ye===2||ye===9)||t.cancelPendingCommit!==null)&&(Xs(t,0),Qi(t,ce,Kt,!1)),No(t,n),(!(ge&2)||t!==xe)&&(t===xe&&(!(ge&2)&&(ja|=n),qe===4&&Qi(t,ce,Kt,!1)),Jn(t))}function Gy(t,e,n){if(ge&6)throw Error(L(327));var i=!n&&(e&127)===0&&(e&t.expiredLanes)===0||Do(t,e),a=i?y_(t,e):Qu(t,e,!0),s=i;do{if(a===0){or&&!i&&Qi(t,e,0,!1);break}else{if(n=t.current.alternate,s&&!v_(n)){a=Qu(t,e,!1),s=!1;continue}if(a===2){if(s=e,t.errorRecoveryDisabledLanes&s)var r=0;else r=t.pendingLanes&-536870913,r=r!==0?r:r&536870912?536870912:0;if(r!==0){e=r;e:{var o=t;a=Wr;var l=o.current.memoizedState.isDehydrated;if(l&&(Xs(o,r).flags|=256),r=Qu(o,r,!1),r!==2){if(tm&&!l){o.errorRecoveryDisabledLanes|=s,ja|=s,a=4;break e}s=Pt,Pt=a,s!==null&&(Pt===null?Pt=s:Pt.push.apply(Pt,s))}a=r}if(s=!1,a!==2)continue}}if(a===1){Xs(t,0),Qi(t,e,0,!0);break}e:{switch(i=t,s=a,s){case 0:case 1:throw Error(L(345));case 4:if((e&4194048)!==e)break;case 6:Qi(i,e,Kt,!Yi);break e;case 2:Pt=null;break;case 3:case 5:break;default:throw Error(L(329))}if((e&62914560)===e&&(a=eu+300-Qt(),10<a)){if(Qi(i,e,Kt,!Yi),Vc(i,0,!0)!==0)break e;vi=e,i.timeoutHandle=dS(bg.bind(null,i,n,Pt,hc,vf,e,Kt,ja,Qs,Yi,s,"Throttled",-0,0),a);break e}bg(i,n,Pt,hc,vf,e,Kt,ja,Qs,Yi,s,null,-0,0)}}break}while(!0);Jn(t)}function bg(t,e,n,i,a,s,r,o,l,c,u,d,f,h){if(t.timeoutHandle=-1,d=e.subtreeFlags,d&8192||(d&16785408)===16785408){d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:hi},jy(e,s,d);var g=(s&62914560)===s?eu-Qt():(s&4194048)===s?Fy-Qt():0;if(g=tR(d,g),g!==null){vi=s,t.cancelPendingCommit=g(Sg.bind(null,t,e,s,n,i,a,r,o,l,u,d,null,f,h)),Qi(t,s,r,!c);return}}Sg(t,e,s,n,i,a,r,o,l)}function v_(t){for(var e=t;;){var n=e.tag;if((n===0||n===11||n===15)&&e.flags&16384&&(n=e.updateQueue,n!==null&&(n=n.stores,n!==null)))for(var i=0;i<n.length;i++){var a=n[i],s=a.getSnapshot;a=a.value;try{if(!Wt(s(),a))return!1}catch{return!1}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Qi(t,e,n,i){e&=~nm,e&=~ja,t.suspendedLanes|=e,t.pingedLanes&=~e,i&&(t.warmLanes|=e),i=t.expirationTimes;for(var a=e;0<a;){var s=31-Xt(a),r=1<<s;i[s]=-1,a&=~r}n!==0&&J0(t,n,e)}function tu(){return ge&6?!0:(Bo(0),!1)}function im(){if(oe!==null){if(ye===0)var t=oe.return;else t=oe,mi=$a=null,Fh(t),Ms=null,fo=0,t=oe;for(;t!==null;)Ey(t.alternate,t),t=t.return;oe=null}}function Xs(t,e){var n=t.timeoutHandle;n!==-1&&(t.timeoutHandle=-1,I_(n)),n=t.cancelPendingCommit,n!==null&&(t.cancelPendingCommit=null,n()),vi=0,im(),xe=t,oe=n=pi(t.current,null),ce=e,ye=0,Vt=null,Yi=!1,or=Do(t,e),tm=!1,Qs=Kt=nm=ja=ha=qe=0,Pt=Wr=null,vf=!1,e&8&&(e|=e&32);var i=t.entangledLanes;if(i!==0)for(t=t.entanglements,i&=e;0<i;){var a=31-Xt(i),s=1<<a;e|=t[a],i&=~s}return Ei=e,Yc(),n}function Ky(t,e){ne=null,W.H=mo,e===rr||e===Jc?(e=Xp(),ye=3):e===Lh?(e=Xp(),ye=4):ye=e===Zh?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,Vt=e,oe===null&&(qe=1,cc(t,un(e,t.current)))}function Yy(){var t=$t.current;return t===null?!0:(ce&4194048)===ce?mn===null:(ce&62914560)===ce||ce&536870912?t===mn:!1}function Qy(){var t=W.H;return W.H=mo,t===null?mo:t}function Jy(){var t=W.A;return W.A=p_,t}function mc(){qe=4,Yi||(ce&4194048)!==ce&&$t.current!==null||(or=!0),!(ha&134217727)&&!(ja&134217727)||xe===null||Qi(xe,ce,Kt,!1)}function Qu(t,e,n){var i=ge;ge|=2;var a=Qy(),s=Jy();(xe!==t||ce!==e)&&(hc=null,Xs(t,e)),e=!1;var r=qe;e:do try{if(ye!==0&&oe!==null){var o=oe,l=Vt;switch(ye){case 8:im(),r=6;break e;case 3:case 2:case 9:case 6:$t.current===null&&(e=!0);var c=ye;if(ye=0,Vt=null,ks(t,o,l,c),n&&or){r=0;break e}break;default:c=ye,ye=0,Vt=null,ks(t,o,l,c)}}b_(),r=qe;break}catch(u){Ky(t,u)}while(!0);return e&&t.shellSuspendCounter++,mi=$a=null,ge=i,W.H=a,W.A=s,oe===null&&(xe=null,ce=0,Yc()),r}function b_(){for(;oe!==null;)Xy(oe)}function y_(t,e){var n=ge;ge|=2;var i=Qy(),a=Jy();xe!==t||ce!==e?(hc=null,fc=Qt()+500,Xs(t,e)):or=Do(t,e);e:do try{if(ye!==0&&oe!==null){e=oe;var s=Vt;t:switch(ye){case 1:ye=0,Vt=null,ks(t,e,s,1);break;case 2:case 9:if(Jp(s)){ye=0,Vt=null,yg(e);break}e=function(){ye!==2&&ye!==9||xe!==t||(ye=7),Jn(t)},s.then(e,e);break e;case 3:ye=7;break e;case 4:ye=5;break e;case 7:Jp(s)?(ye=0,Vt=null,yg(e)):(ye=0,Vt=null,ks(t,e,s,7));break;case 5:var r=null;switch(oe.tag){case 26:r=oe.memoizedState;case 5:case 27:var o=oe;if(r?gS(r):o.stateNode.complete){ye=0,Vt=null;var l=o.sibling;if(l!==null)oe=l;else{var c=o.return;c!==null?(oe=c,nu(c)):oe=null}break t}}ye=0,Vt=null,ks(t,e,s,5);break;case 6:ye=0,Vt=null,ks(t,e,s,6);break;case 8:im(),qe=6;break e;default:throw Error(L(462))}}S_();break}catch(u){Ky(t,u)}while(!0);return mi=$a=null,W.H=i,W.A=a,ge=n,oe!==null?0:(xe=null,ce=0,Yc(),qe)}function S_(){for(;oe!==null&&!V1();)Xy(oe)}function Xy(t){var e=ky(t.alternate,t,Ei);t.memoizedProps=t.pendingProps,e===null?nu(t):oe=e}function yg(t){var e=t,n=e.alternate;switch(e.tag){case 15:case 0:e=fg(n,e,e.pendingProps,e.type,void 0,ce);break;case 11:e=fg(n,e,e.pendingProps,e.type.render,e.ref,ce);break;case 5:Fh(e);default:Ey(n,e),e=oe=Eb(e,Ei),e=ky(n,e,Ei)}t.memoizedProps=t.pendingProps,e===null?nu(t):oe=e}function ks(t,e,n,i){mi=$a=null,Fh(e),Ms=null,fo=0;var a=e.return;try{if(l_(t,a,e,n,ce)){qe=1,cc(t,un(n,t.current)),oe=null;return}}catch(s){if(a!==null)throw oe=a,s;qe=1,cc(t,un(n,t.current)),oe=null;return}e.flags&32768?(ue||i===1?t=!0:or||ce&536870912?t=!1:(Yi=t=!0,(i===2||i===9||i===3||i===6)&&(i=$t.current,i!==null&&i.tag===13&&(i.flags|=16384))),Zy(e,t)):nu(e)}function nu(t){var e=t;do{if(e.flags&32768){Zy(e,Yi);return}t=e.return;var n=d_(e.alternate,e,Ei);if(n!==null){oe=n;return}if(e=e.sibling,e!==null){oe=e;return}oe=e=t}while(e!==null);qe===0&&(qe=5)}function Zy(t,e){do{var n=f_(t.alternate,t);if(n!==null){n.flags&=32767,oe=n;return}if(n=t.return,n!==null&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!e&&(t=t.sibling,t!==null)){oe=t;return}oe=t=n}while(t!==null);qe=6,oe=null}function Sg(t,e,n,i,a,s,r,o,l){t.cancelPendingCommit=null;do iu();while(nt!==0);if(ge&6)throw Error(L(327));if(e!==null){if(e===t.current)throw Error(L(177));if(s=e.lanes|e.childLanes,s|=wh,$1(t,n,s,r,o,l),t===xe&&(oe=xe=null,ce=0),Js=e,ia=t,vi=n,bf=s,yf=a,Vy=i,e.subtreeFlags&10256||e.flags&10256?(t.callbackNode=null,t.callbackPriority=0,E_(Wl,function(){return nS(),null})):(t.callbackNode=null,t.callbackPriority=0),i=(e.flags&13878)!==0,e.subtreeFlags&13878||i){i=W.T,W.T=null,a=ve.p,ve.p=2,r=ge,ge|=4;try{h_(t,e,n)}finally{ge=r,ve.p=a,W.T=i}}nt=1,Wy(),$y(),eS()}}function Wy(){if(nt===1){nt=0;var t=ia,e=Js,n=(e.flags&13878)!==0;if(e.subtreeFlags&13878||n){n=W.T,W.T=null;var i=ve.p;ve.p=2;var a=ge;ge|=4;try{Ly(e,t);var s=Ef,r=gb(t.containerInfo),o=s.focusedElem,l=s.selectionRange;if(r!==o&&o&&o.ownerDocument&&pb(o.ownerDocument.documentElement,o)){if(l!==null&&xh(o)){var c=l.start,u=l.end;if(u===void 0&&(u=c),"selectionStart"in o)o.selectionStart=c,o.selectionEnd=Math.min(u,o.value.length);else{var d=o.ownerDocument||document,f=d&&d.defaultView||window;if(f.getSelection){var h=f.getSelection(),g=o.textContent.length,y=Math.min(l.start,g),T=l.end===void 0?y:Math.min(l.end,g);!h.extend&&y>T&&(r=T,T=y,y=r);var m=Fp(o,y),p=Fp(o,T);if(m&&p&&(h.rangeCount!==1||h.anchorNode!==m.node||h.anchorOffset!==m.offset||h.focusNode!==p.node||h.focusOffset!==p.offset)){var v=d.createRange();v.setStart(m.node,m.offset),h.removeAllRanges(),y>T?(h.addRange(v),h.extend(p.node,p.offset)):(v.setEnd(p.node,p.offset),h.addRange(v))}}}}for(d=[],h=o;h=h.parentNode;)h.nodeType===1&&d.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<d.length;o++){var b=d[o];b.element.scrollLeft=b.left,b.element.scrollTop=b.top}}Cc=!!kf,Ef=kf=null}finally{ge=a,ve.p=i,W.T=n}}t.current=e,nt=2}}function $y(){if(nt===2){nt=0;var t=ia,e=Js,n=(e.flags&8772)!==0;if(e.subtreeFlags&8772||n){n=W.T,W.T=null;var i=ve.p;ve.p=2;var a=ge;ge|=4;try{Ay(t,e.alternate,e)}finally{ge=a,ve.p=i,W.T=n}}nt=3}}function eS(){if(nt===4||nt===3){nt=0,H1();var t=ia,e=Js,n=vi,i=Vy;e.subtreeFlags&10256||e.flags&10256?nt=5:(nt=0,Js=ia=null,tS(t,t.pendingLanes));var a=t.pendingLanes;if(a===0&&(na=null),Sh(n),e=e.stateNode,Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(Mo,e,void 0,(e.current.flags&128)===128)}catch{}if(i!==null){e=W.T,a=ve.p,ve.p=2,W.T=null;try{for(var s=t.onRecoverableError,r=0;r<i.length;r++){var o=i[r];s(o.value,{componentStack:o.stack})}}finally{W.T=e,ve.p=a}}vi&3&&iu(),Jn(t),a=t.pendingLanes,n&261930&&a&42?t===Sf?$r++:($r=0,Sf=t):$r=0,Bo(0)}}function tS(t,e){(t.pooledCacheLanes&=e)===0&&(e=t.pooledCache,e!=null&&(t.pooledCache=null,Uo(e)))}function iu(){return Wy(),$y(),eS(),nS()}function nS(){if(nt!==5)return!1;var t=ia,e=bf;bf=0;var n=Sh(vi),i=W.T,a=ve.p;try{ve.p=32>n?32:n,W.T=null,n=yf,yf=null;var s=ia,r=vi;if(nt=0,Js=ia=null,vi=0,ge&6)throw Error(L(331));var o=ge;if(ge|=4,qy(s.current),Iy(s,s.current,r,n),ge=o,Bo(0,!1),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(Mo,s)}catch{}return!0}finally{ve.p=a,W.T=i,tS(t,e)}}function Tg(t,e,n){e=un(n,e),e=hf(t.stateNode,e,2),t=ta(t,e,2),t!==null&&(No(t,2),Jn(t))}function Se(t,e,n){if(t.tag===3)Tg(t,t,n);else for(;e!==null;){if(e.tag===3){Tg(e,t,n);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(na===null||!na.has(i))){t=un(n,t),n=vy(2),i=ta(e,n,2),i!==null&&(by(n,i,e,t),No(i,2),Jn(i));break}}e=e.return}}function Ju(t,e,n){var i=t.pingCache;if(i===null){i=t.pingCache=new g_;var a=new Set;i.set(e,a)}else a=i.get(e),a===void 0&&(a=new Set,i.set(e,a));a.has(n)||(tm=!0,a.add(n),t=T_.bind(null,t,e,n),e.then(t,t))}function T_(t,e,n){var i=t.pingCache;i!==null&&i.delete(e),t.pingedLanes|=t.suspendedLanes&n,t.warmLanes&=~n,xe===t&&(ce&n)===n&&(qe===4||qe===3&&(ce&62914560)===ce&&300>Qt()-eu?!(ge&2)&&Xs(t,0):nm|=n,Qs===ce&&(Qs=0)),Jn(t)}function iS(t,e){e===0&&(e=Q0()),t=Wa(t,e),t!==null&&(No(t,e),Jn(t))}function C_(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),iS(t,n)}function k_(t,e){var n=0;switch(t.tag){case 31:case 13:var i=t.stateNode,a=t.memoizedState;a!==null&&(n=a.retryLane);break;case 19:i=t.stateNode;break;case 22:i=t.stateNode._retryCache;break;default:throw Error(L(314))}i!==null&&i.delete(e),iS(t,n)}function E_(t,e){return bh(t,e)}var pc=null,ds=null,Tf=!1,gc=!1,Xu=!1,Ji=0;function Jn(t){t!==ds&&t.next===null&&(ds===null?pc=ds=t:ds=ds.next=t),gc=!0,Tf||(Tf=!0,R_())}function Bo(t,e){if(!Xu&&gc){Xu=!0;do for(var n=!1,i=pc;i!==null;){if(t!==0){var a=i.pendingLanes;if(a===0)var s=0;else{var r=i.suspendedLanes,o=i.pingedLanes;s=(1<<31-Xt(42|t)+1)-1,s&=a&~(r&~o),s=s&201326741?s&201326741|1:s?s|2:0}s!==0&&(n=!0,Cg(i,s))}else s=ce,s=Vc(i,i===xe?s:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),!(s&3)||Do(i,s)||(n=!0,Cg(i,s));i=i.next}while(n);Xu=!1}}function __(){aS()}function aS(){gc=Tf=!1;var t=0;Ji!==0&&U_()&&(t=Ji);for(var e=Qt(),n=null,i=pc;i!==null;){var a=i.next,s=sS(i,e);s===0?(i.next=null,n===null?pc=a:n.next=a,a===null&&(ds=n)):(n=i,(t!==0||s&3)&&(gc=!0)),i=a}nt!==0&&nt!==5||Bo(t),Ji!==0&&(Ji=0)}function sS(t,e){for(var n=t.suspendedLanes,i=t.pingedLanes,a=t.expirationTimes,s=t.pendingLanes&-62914561;0<s;){var r=31-Xt(s),o=1<<r,l=a[r];l===-1?(!(o&n)||o&i)&&(a[r]=W1(o,e)):l<=e&&(t.expiredLanes|=o),s&=~o}if(e=xe,n=ce,n=Vc(t,t===e?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),i=t.callbackNode,n===0||t===e&&(ye===2||ye===9)||t.cancelPendingCommit!==null)return i!==null&&i!==null&&Eu(i),t.callbackNode=null,t.callbackPriority=0;if(!(n&3)||Do(t,n)){if(e=n&-n,e===t.callbackPriority)return e;switch(i!==null&&Eu(i),Sh(n)){case 2:case 8:n=K0;break;case 32:n=Wl;break;case 268435456:n=Y0;break;default:n=Wl}return i=rS.bind(null,t),n=bh(n,i),t.callbackPriority=e,t.callbackNode=n,e}return i!==null&&i!==null&&Eu(i),t.callbackPriority=2,t.callbackNode=null,2}function rS(t,e){if(nt!==0&&nt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var n=t.callbackNode;if(iu()&&t.callbackNode!==n)return null;var i=ce;return i=Vc(t,t===xe?i:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),i===0?null:(Gy(t,i,e),sS(t,Qt()),t.callbackNode!=null&&t.callbackNode===n?rS.bind(null,t):null)}function Cg(t,e){if(iu())return null;Gy(t,e,!0)}function R_(){j_(function(){ge&6?bh(G0,__):aS()})}function am(){if(Ji===0){var t=Gs;t===0&&(t=Xo,Xo<<=1,!(Xo&261888)&&(Xo=256)),Ji=t}return Ji}function kg(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:bl(""+t)}function Eg(t,e){var n=e.ownerDocument.createElement("input");return n.name=e.name,n.value=e.value,t.id&&n.setAttribute("form",t.id),e.parentNode.insertBefore(n,e),t=new FormData(t),n.parentNode.removeChild(n),t}function x_(t,e,n,i,a){if(e==="submit"&&n&&n.stateNode===a){var s=kg((a[Bt]||null).action),r=i.submitter;r&&(e=(e=r[Bt]||null)?kg(e.formAction):r.getAttribute("formAction"),e!==null&&(s=e,r=null));var o=new Hc("action","action",null,i,a);t.push({event:o,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(Ji!==0){var l=r?Eg(a,r):new FormData(a);df(n,{pending:!0,data:l,method:a.method,action:s},null,l)}}else typeof s=="function"&&(o.preventDefault(),l=r?Eg(a,r):new FormData(a),df(n,{pending:!0,data:l,method:a.method,action:s},s,l))},currentTarget:a}]})}}for(var Zu=0;Zu<Wd.length;Zu++){var Wu=Wd[Zu],w_=Wu.toLowerCase(),O_=Wu[0].toUpperCase()+Wu.slice(1);Nn(w_,"on"+O_)}Nn(bb,"onAnimationEnd");Nn(yb,"onAnimationIteration");Nn(Sb,"onAnimationStart");Nn("dblclick","onDoubleClick");Nn("focusin","onFocus");Nn("focusout","onBlur");Nn(GE,"onTransitionRun");Nn(KE,"onTransitionStart");Nn(YE,"onTransitionCancel");Nn(Tb,"onTransitionEnd");Vs("onMouseEnter",["mouseout","mouseover"]);Vs("onMouseLeave",["mouseout","mouseover"]);Vs("onPointerEnter",["pointerout","pointerover"]);Vs("onPointerLeave",["pointerout","pointerover"]);Ja("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ja("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ja("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ja("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ja("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ja("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var po="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),A_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(po));function oS(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var i=t[n],a=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var r=i.length-1;0<=r;r--){var o=i[r],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&a.isPropagationStopped())break e;s=o,a.currentTarget=c;try{s(a)}catch(u){ec(u)}a.currentTarget=null,s=l}else for(r=0;r<i.length;r++){if(o=i[r],l=o.instance,c=o.currentTarget,o=o.listener,l!==s&&a.isPropagationStopped())break e;s=o,a.currentTarget=c;try{s(a)}catch(u){ec(u)}a.currentTarget=null,s=l}}}}function re(t,e){var n=e[Hd];n===void 0&&(n=e[Hd]=new Set);var i=t+"__bubble";n.has(i)||(lS(e,t,2,!1),n.add(i))}function $u(t,e,n){var i=0;e&&(i|=4),lS(n,t,i,e)}var rl="_reactListening"+Math.random().toString(36).slice(2);function sm(t){if(!t[rl]){t[rl]=!0,$0.forEach(function(n){n!=="selectionchange"&&(A_.has(n)||$u(n,!1,t),$u(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[rl]||(e[rl]=!0,$u("selectionchange",!1,e))}}function lS(t,e,n,i){switch(TS(e)){case 2:var a=aR;break;case 8:a=sR;break;default:a=cm}n=a.bind(null,e,n,t),a=void 0,!Jd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(a=!0),i?a!==void 0?t.addEventListener(e,n,{capture:!0,passive:a}):t.addEventListener(e,n,!0):a!==void 0?t.addEventListener(e,n,{passive:a}):t.addEventListener(e,n,!1)}function ed(t,e,n,i,a){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var r=i.tag;if(r===3||r===4){var o=i.stateNode.containerInfo;if(o===a)break;if(r===4)for(r=i.return;r!==null;){var l=r.tag;if((l===3||l===4)&&r.stateNode.containerInfo===a)return;r=r.return}for(;o!==null;){if(r=ms(o),r===null)return;if(l=r.tag,l===5||l===6||l===26||l===27){i=s=r;continue e}o=o.parentNode}}i=i.return}ob(function(){var c=s,u=kh(n),d=[];e:{var f=Cb.get(t);if(f!==void 0){var h=Hc,g=t;switch(t){case"keypress":if(Sl(n)===0)break e;case"keydown":case"keyup":h=kE;break;case"focusin":g="focus",h=Ou;break;case"focusout":g="blur",h=Ou;break;case"beforeblur":case"afterblur":h=Ou;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=Dp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=dE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=RE;break;case bb:case yb:case Sb:h=mE;break;case Tb:h=wE;break;case"scroll":case"scrollend":h=cE;break;case"wheel":h=AE;break;case"copy":case"cut":case"paste":h=gE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=Pp;break;case"toggle":case"beforetoggle":h=DE}var y=(e&4)!==0,T=!y&&(t==="scroll"||t==="scrollend"),m=y?f!==null?f+"Capture":null:f;y=[];for(var p=c,v;p!==null;){var b=p;if(v=b.stateNode,b=b.tag,b!==5&&b!==26&&b!==27||v===null||m===null||(b=ro(p,m),b!=null&&y.push(go(p,b,v))),T)break;p=p.return}0<y.length&&(f=new h(f,g,null,n,u),d.push({event:f,listeners:y}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",h=t==="mouseout"||t==="pointerout",f&&n!==Qd&&(g=n.relatedTarget||n.fromElement)&&(ms(g)||g[ir]))break e;if((h||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,h?(g=n.relatedTarget||n.toElement,h=c,g=g?ms(g):null,g!==null&&(T=Ao(g),y=g.tag,g!==T||y!==5&&y!==27&&y!==6)&&(g=null)):(h=null,g=c),h!==g)){if(y=Dp,b="onMouseLeave",m="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(y=Pp,b="onPointerLeave",m="onPointerEnter",p="pointer"),T=h==null?f:Pr(h),v=g==null?f:Pr(g),f=new y(b,p+"leave",h,n,u),f.target=T,f.relatedTarget=v,b=null,ms(u)===c&&(y=new y(m,p+"enter",g,n,u),y.target=v,y.relatedTarget=T,b=y),T=b,h&&g)t:{for(y=M_,m=h,p=g,v=0,b=m;b;b=y(b))v++;b=0;for(var C=p;C;C=y(C))b++;for(;0<v-b;)m=y(m),v--;for(;0<b-v;)p=y(p),b--;for(;v--;){if(m===p||p!==null&&m===p.alternate){y=m;break t}m=y(m),p=y(p)}y=null}else y=null;h!==null&&_g(d,f,h,y,!1),g!==null&&T!==null&&_g(d,T,g,y,!0)}}e:{if(f=c?Pr(c):window,h=f.nodeName&&f.nodeName.toLowerCase(),h==="select"||h==="input"&&f.type==="file")var _=jp;else if(Ip(f))if(hb)_=FE;else{_=qE;var w=BE}else h=f.nodeName,!h||h.toLowerCase()!=="input"||f.type!=="checkbox"&&f.type!=="radio"?c&&Ch(c.elementType)&&(_=jp):_=zE;if(_&&(_=_(t,c))){fb(d,_,n,u);break e}w&&w(t,f,c),t==="focusout"&&c&&f.type==="number"&&c.memoizedProps.value!=null&&Yd(f,"number",f.value)}switch(w=c?Pr(c):window,t){case"focusin":(Ip(w)||w.contentEditable==="true")&&(vs=w,Xd=c,Hr=null);break;case"focusout":Hr=Xd=vs=null;break;case"mousedown":Zd=!0;break;case"contextmenu":case"mouseup":case"dragend":Zd=!1,Vp(d,n,u);break;case"selectionchange":if(HE)break;case"keydown":case"keyup":Vp(d,n,u)}var P;if(Rh)e:{switch(t){case"compositionstart":var O="onCompositionStart";break e;case"compositionend":O="onCompositionEnd";break e;case"compositionupdate":O="onCompositionUpdate";break e}O=void 0}else gs?ub(t,n)&&(O="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(O="onCompositionStart");O&&(cb&&n.locale!=="ko"&&(gs||O!=="onCompositionStart"?O==="onCompositionEnd"&&gs&&(P=lb()):(Ki=u,Eh="value"in Ki?Ki.value:Ki.textContent,gs=!0)),w=vc(c,O),0<w.length&&(O=new Np(O,t,null,n,u),d.push({event:O,listeners:w}),P?O.data=P:(P=db(n),P!==null&&(O.data=P)))),(P=PE?LE(t,n):UE(t,n))&&(O=vc(c,"onBeforeInput"),0<O.length&&(w=new Np("onBeforeInput","beforeinput",null,n,u),d.push({event:w,listeners:O}),w.data=P)),x_(d,t,c,n,u)}oS(d,e)})}function go(t,e,n){return{instance:t,listener:e,currentTarget:n}}function vc(t,e){for(var n=e+"Capture",i=[];t!==null;){var a=t,s=a.stateNode;if(a=a.tag,a!==5&&a!==26&&a!==27||s===null||(a=ro(t,n),a!=null&&i.unshift(go(t,a,s)),a=ro(t,e),a!=null&&i.push(go(t,a,s))),t.tag===3)return i;t=t.return}return[]}function M_(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function _g(t,e,n,i,a){for(var s=e._reactName,r=[];n!==null&&n!==i;){var o=n,l=o.alternate,c=o.stateNode;if(o=o.tag,l!==null&&l===i)break;o!==5&&o!==26&&o!==27||c===null||(l=c,a?(c=ro(n,s),c!=null&&r.unshift(go(n,c,l))):a||(c=ro(n,s),c!=null&&r.push(go(n,c,l)))),n=n.return}r.length!==0&&t.push({event:e,listeners:r})}var D_=/\r\n?/g,N_=/\u0000|\uFFFD/g;function Rg(t){return(typeof t=="string"?t:""+t).replace(D_,`
`).replace(N_,"")}function cS(t,e){return e=Rg(e),Rg(t)===e}function Te(t,e,n,i,a,s){switch(n){case"children":typeof i=="string"?e==="body"||e==="textarea"&&i===""||Hs(t,i):(typeof i=="number"||typeof i=="bigint")&&e!=="body"&&Hs(t,""+i);break;case"className":$o(t,"class",i);break;case"tabIndex":$o(t,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":$o(t,n,i);break;case"style":rb(t,i,s);break;case"data":if(e!=="object"){$o(t,"data",i);break}case"src":case"href":if(i===""&&(e!=="a"||n!=="href")){t.removeAttribute(n);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){t.removeAttribute(n);break}i=bl(""+i),t.setAttribute(n,i);break;case"action":case"formAction":if(typeof i=="function"){t.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof s=="function"&&(n==="formAction"?(e!=="input"&&Te(t,e,"name",a.name,a,null),Te(t,e,"formEncType",a.formEncType,a,null),Te(t,e,"formMethod",a.formMethod,a,null),Te(t,e,"formTarget",a.formTarget,a,null)):(Te(t,e,"encType",a.encType,a,null),Te(t,e,"method",a.method,a,null),Te(t,e,"target",a.target,a,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){t.removeAttribute(n);break}i=bl(""+i),t.setAttribute(n,i);break;case"onClick":i!=null&&(t.onclick=hi);break;case"onScroll":i!=null&&re("scroll",t);break;case"onScrollEnd":i!=null&&re("scrollend",t);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(L(61));if(n=i.__html,n!=null){if(a.children!=null)throw Error(L(60));t.innerHTML=n}}break;case"multiple":t.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":t.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){t.removeAttribute("xlink:href");break}n=bl(""+i),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,""+i):t.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,""):t.removeAttribute(n);break;case"capture":case"download":i===!0?t.setAttribute(n,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?t.setAttribute(n,i):t.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?t.setAttribute(n,i):t.removeAttribute(n);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?t.removeAttribute(n):t.setAttribute(n,i);break;case"popover":re("beforetoggle",t),re("toggle",t),vl(t,"popover",i);break;case"xlinkActuate":Wn(t,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":Wn(t,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":Wn(t,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":Wn(t,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":Wn(t,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":Wn(t,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":Wn(t,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":Wn(t,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":Wn(t,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":vl(t,"is",i);break;case"innerText":case"textContent":break;default:(!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(n=oE.get(n)||n,vl(t,n,i))}}function Cf(t,e,n,i,a,s){switch(n){case"style":rb(t,i,s);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(L(61));if(n=i.__html,n!=null){if(a.children!=null)throw Error(L(60));t.innerHTML=n}}break;case"children":typeof i=="string"?Hs(t,i):(typeof i=="number"||typeof i=="bigint")&&Hs(t,""+i);break;case"onScroll":i!=null&&re("scroll",t);break;case"onScrollEnd":i!=null&&re("scrollend",t);break;case"onClick":i!=null&&(t.onclick=hi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!eb.hasOwnProperty(n))e:{if(n[0]==="o"&&n[1]==="n"&&(a=n.endsWith("Capture"),e=n.slice(2,a?n.length-7:void 0),s=t[Bt]||null,s=s!=null?s[n]:null,typeof s=="function"&&t.removeEventListener(e,s,a),typeof i=="function")){typeof s!="function"&&s!==null&&(n in t?t[n]=null:t.hasAttribute(n)&&t.removeAttribute(n)),t.addEventListener(e,i,a);break e}n in t?t[n]=i:i===!0?t.setAttribute(n,""):vl(t,n,i)}}}function yt(t,e,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":re("error",t),re("load",t);var i=!1,a=!1,s;for(s in n)if(n.hasOwnProperty(s)){var r=n[s];if(r!=null)switch(s){case"src":i=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(L(137,e));default:Te(t,e,s,r,n,null)}}a&&Te(t,e,"srcSet",n.srcSet,n,null),i&&Te(t,e,"src",n.src,n,null);return;case"input":re("invalid",t);var o=s=r=a=null,l=null,c=null;for(i in n)if(n.hasOwnProperty(i)){var u=n[i];if(u!=null)switch(i){case"name":a=u;break;case"type":r=u;break;case"checked":l=u;break;case"defaultChecked":c=u;break;case"value":s=u;break;case"defaultValue":o=u;break;case"children":case"dangerouslySetInnerHTML":if(u!=null)throw Error(L(137,e));break;default:Te(t,e,i,u,n,null)}}ib(t,s,o,l,c,r,a,!1);return;case"select":re("invalid",t),i=r=s=null;for(a in n)if(n.hasOwnProperty(a)&&(o=n[a],o!=null))switch(a){case"value":s=o;break;case"defaultValue":r=o;break;case"multiple":i=o;default:Te(t,e,a,o,n,null)}e=s,n=r,t.multiple=!!i,e!=null?ws(t,!!i,e,!1):n!=null&&ws(t,!!i,n,!0);return;case"textarea":re("invalid",t),s=a=i=null;for(r in n)if(n.hasOwnProperty(r)&&(o=n[r],o!=null))switch(r){case"value":i=o;break;case"defaultValue":a=o;break;case"children":s=o;break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(L(91));break;default:Te(t,e,r,o,n,null)}sb(t,i,a,s);return;case"option":for(l in n)if(n.hasOwnProperty(l)&&(i=n[l],i!=null))switch(l){case"selected":t.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:Te(t,e,l,i,n,null)}return;case"dialog":re("beforetoggle",t),re("toggle",t),re("cancel",t),re("close",t);break;case"iframe":case"object":re("load",t);break;case"video":case"audio":for(i=0;i<po.length;i++)re(po[i],t);break;case"image":re("error",t),re("load",t);break;case"details":re("toggle",t);break;case"embed":case"source":case"link":re("error",t),re("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(c in n)if(n.hasOwnProperty(c)&&(i=n[c],i!=null))switch(c){case"children":case"dangerouslySetInnerHTML":throw Error(L(137,e));default:Te(t,e,c,i,n,null)}return;default:if(Ch(e)){for(u in n)n.hasOwnProperty(u)&&(i=n[u],i!==void 0&&Cf(t,e,u,i,n,void 0));return}}for(o in n)n.hasOwnProperty(o)&&(i=n[o],i!=null&&Te(t,e,o,i,n,null))}function P_(t,e,n,i){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,s=null,r=null,o=null,l=null,c=null,u=null;for(h in n){var d=n[h];if(n.hasOwnProperty(h)&&d!=null)switch(h){case"checked":break;case"value":break;case"defaultValue":l=d;default:i.hasOwnProperty(h)||Te(t,e,h,null,i,d)}}for(var f in i){var h=i[f];if(d=n[f],i.hasOwnProperty(f)&&(h!=null||d!=null))switch(f){case"type":s=h;break;case"name":a=h;break;case"checked":c=h;break;case"defaultChecked":u=h;break;case"value":r=h;break;case"defaultValue":o=h;break;case"children":case"dangerouslySetInnerHTML":if(h!=null)throw Error(L(137,e));break;default:h!==d&&Te(t,e,f,h,i,d)}}Kd(t,r,o,l,c,u,s,a);return;case"select":h=r=o=f=null;for(s in n)if(l=n[s],n.hasOwnProperty(s)&&l!=null)switch(s){case"value":break;case"multiple":h=l;default:i.hasOwnProperty(s)||Te(t,e,s,null,i,l)}for(a in i)if(s=i[a],l=n[a],i.hasOwnProperty(a)&&(s!=null||l!=null))switch(a){case"value":f=s;break;case"defaultValue":o=s;break;case"multiple":r=s;default:s!==l&&Te(t,e,a,s,i,l)}e=o,n=r,i=h,f!=null?ws(t,!!n,f,!1):!!i!=!!n&&(e!=null?ws(t,!!n,e,!0):ws(t,!!n,n?[]:"",!1));return;case"textarea":h=f=null;for(o in n)if(a=n[o],n.hasOwnProperty(o)&&a!=null&&!i.hasOwnProperty(o))switch(o){case"value":break;case"children":break;default:Te(t,e,o,null,i,a)}for(r in i)if(a=i[r],s=n[r],i.hasOwnProperty(r)&&(a!=null||s!=null))switch(r){case"value":f=a;break;case"defaultValue":h=a;break;case"children":break;case"dangerouslySetInnerHTML":if(a!=null)throw Error(L(91));break;default:a!==s&&Te(t,e,r,a,i,s)}ab(t,f,h);return;case"option":for(var g in n)if(f=n[g],n.hasOwnProperty(g)&&f!=null&&!i.hasOwnProperty(g))switch(g){case"selected":t.selected=!1;break;default:Te(t,e,g,null,i,f)}for(l in i)if(f=i[l],h=n[l],i.hasOwnProperty(l)&&f!==h&&(f!=null||h!=null))switch(l){case"selected":t.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Te(t,e,l,f,i,h)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var y in n)f=n[y],n.hasOwnProperty(y)&&f!=null&&!i.hasOwnProperty(y)&&Te(t,e,y,null,i,f);for(c in i)if(f=i[c],h=n[c],i.hasOwnProperty(c)&&f!==h&&(f!=null||h!=null))switch(c){case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(L(137,e));break;default:Te(t,e,c,f,i,h)}return;default:if(Ch(e)){for(var T in n)f=n[T],n.hasOwnProperty(T)&&f!==void 0&&!i.hasOwnProperty(T)&&Cf(t,e,T,void 0,i,f);for(u in i)f=i[u],h=n[u],!i.hasOwnProperty(u)||f===h||f===void 0&&h===void 0||Cf(t,e,u,f,i,h);return}}for(var m in n)f=n[m],n.hasOwnProperty(m)&&f!=null&&!i.hasOwnProperty(m)&&Te(t,e,m,null,i,f);for(d in i)f=i[d],h=n[d],!i.hasOwnProperty(d)||f===h||f==null&&h==null||Te(t,e,d,f,i,h)}function xg(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function L_(){if(typeof performance.getEntriesByType=="function"){for(var t=0,e=0,n=performance.getEntriesByType("resource"),i=0;i<n.length;i++){var a=n[i],s=a.transferSize,r=a.initiatorType,o=a.duration;if(s&&o&&xg(r)){for(r=0,o=a.responseEnd,i+=1;i<n.length;i++){var l=n[i],c=l.startTime;if(c>o)break;var u=l.transferSize,d=l.initiatorType;u&&xg(d)&&(l=l.responseEnd,r+=u*(l<o?1:(o-c)/(l-c)))}if(--i,e+=8*(s+r)/(a.duration/1e3),t++,10<t)break}}if(0<t)return e/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var kf=null,Ef=null;function bc(t){return t.nodeType===9?t:t.ownerDocument}function wg(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function uS(t,e){if(t===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&e==="foreignObject"?0:t}function _f(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var td=null;function U_(){var t=window.event;return t&&t.type==="popstate"?t===td?!1:(td=t,!0):(td=null,!1)}var dS=typeof setTimeout=="function"?setTimeout:void 0,I_=typeof clearTimeout=="function"?clearTimeout:void 0,Og=typeof Promise=="function"?Promise:void 0,j_=typeof queueMicrotask=="function"?queueMicrotask:typeof Og<"u"?function(t){return Og.resolve(null).then(t).catch(B_)}:dS;function B_(t){setTimeout(function(){throw t})}function ba(t){return t==="head"}function Ag(t,e){var n=e,i=0;do{var a=n.nextSibling;if(t.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"||n==="/&"){if(i===0){t.removeChild(a),Ws(e);return}i--}else if(n==="$"||n==="$?"||n==="$~"||n==="$!"||n==="&")i++;else if(n==="html")eo(t.ownerDocument.documentElement);else if(n==="head"){n=t.ownerDocument.head,eo(n);for(var s=n.firstChild;s;){var r=s.nextSibling,o=s.nodeName;s[Po]||o==="SCRIPT"||o==="STYLE"||o==="LINK"&&s.rel.toLowerCase()==="stylesheet"||n.removeChild(s),s=r}}else n==="body"&&eo(t.ownerDocument.body);n=a}while(n);Ws(e)}function Mg(t,e){var n=t;t=0;do{var i=n.nextSibling;if(n.nodeType===1?e?(n._stashedDisplay=n.style.display,n.style.display="none"):(n.style.display=n._stashedDisplay||"",n.getAttribute("style")===""&&n.removeAttribute("style")):n.nodeType===3&&(e?(n._stashedText=n.nodeValue,n.nodeValue=""):n.nodeValue=n._stashedText||""),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(t===0)break;t--}else n!=="$"&&n!=="$?"&&n!=="$~"&&n!=="$!"||t++;n=i}while(n)}function Rf(t){var e=t.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var n=e;switch(e=e.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":Rf(n),Th(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(n.rel.toLowerCase()==="stylesheet")continue}t.removeChild(n)}}function q_(t,e,n,i){for(;t.nodeType===1;){var a=n;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!i&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(i){if(!t[Po])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(s=t.getAttribute("rel"),s==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(s!==a.rel||t.getAttribute("href")!==(a.href==null||a.href===""?null:a.href)||t.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin)||t.getAttribute("title")!==(a.title==null?null:a.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(s=t.getAttribute("src"),(s!==(a.src==null?null:a.src)||t.getAttribute("type")!==(a.type==null?null:a.type)||t.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin))&&s&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(e==="input"&&t.type==="hidden"){var s=a.name==null?null:""+a.name;if(a.type==="hidden"&&t.getAttribute("name")===s)return t}else return t;if(t=pn(t.nextSibling),t===null)break}return null}function z_(t,e,n){if(e==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=pn(t.nextSibling),t===null))return null;return t}function fS(t,e){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!e||(t=pn(t.nextSibling),t===null))return null;return t}function xf(t){return t.data==="$?"||t.data==="$~"}function wf(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function F_(t,e){var n=t.ownerDocument;if(t.data==="$~")t._reactRetry=e;else if(t.data!=="$?"||n.readyState!=="loading")e();else{var i=function(){e(),n.removeEventListener("DOMContentLoaded",i)};n.addEventListener("DOMContentLoaded",i),t._reactRetry=i}}function pn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?"||e==="$~"||e==="&"||e==="F!"||e==="F")break;if(e==="/$"||e==="/&")return null}}return t}var Of=null;function Dg(t){t=t.nextSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"||n==="/&"){if(e===0)return pn(t.nextSibling);e--}else n!=="$"&&n!=="$!"&&n!=="$?"&&n!=="$~"&&n!=="&"||e++}t=t.nextSibling}return null}function Ng(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"){if(e===0)return t;e--}else n!=="/$"&&n!=="/&"||e++}t=t.previousSibling}return null}function hS(t,e,n){switch(e=bc(n),t){case"html":if(t=e.documentElement,!t)throw Error(L(452));return t;case"head":if(t=e.head,!t)throw Error(L(453));return t;case"body":if(t=e.body,!t)throw Error(L(454));return t;default:throw Error(L(451))}}function eo(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);Th(t)}var vn=new Map,Pg=new Set;function yc(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var wi=ve.d;ve.d={f:V_,r:H_,D:G_,C:K_,L:Y_,m:Q_,X:X_,S:J_,M:Z_};function V_(){var t=wi.f(),e=tu();return t||e}function H_(t){var e=ar(t);e!==null&&e.tag===5&&e.type==="form"?ry(e):wi.r(t)}var lr=typeof document>"u"?null:document;function mS(t,e,n){var i=lr;if(i&&typeof e=="string"&&e){var a=cn(e);a='link[rel="'+t+'"][href="'+a+'"]',typeof n=="string"&&(a+='[crossorigin="'+n+'"]'),Pg.has(a)||(Pg.add(a),t={rel:t,crossOrigin:n,href:e},i.querySelector(a)===null&&(e=i.createElement("link"),yt(e,"link",t),ct(e),i.head.appendChild(e)))}}function G_(t){wi.D(t),mS("dns-prefetch",t,null)}function K_(t,e){wi.C(t,e),mS("preconnect",t,e)}function Y_(t,e,n){wi.L(t,e,n);var i=lr;if(i&&t&&e){var a='link[rel="preload"][as="'+cn(e)+'"]';e==="image"&&n&&n.imageSrcSet?(a+='[imagesrcset="'+cn(n.imageSrcSet)+'"]',typeof n.imageSizes=="string"&&(a+='[imagesizes="'+cn(n.imageSizes)+'"]')):a+='[href="'+cn(t)+'"]';var s=a;switch(e){case"style":s=Zs(t);break;case"script":s=cr(t)}vn.has(s)||(t=Ne({rel:"preload",href:e==="image"&&n&&n.imageSrcSet?void 0:t,as:e},n),vn.set(s,t),i.querySelector(a)!==null||e==="style"&&i.querySelector(qo(s))||e==="script"&&i.querySelector(zo(s))||(e=i.createElement("link"),yt(e,"link",t),ct(e),i.head.appendChild(e)))}}function Q_(t,e){wi.m(t,e);var n=lr;if(n&&t){var i=e&&typeof e.as=="string"?e.as:"script",a='link[rel="modulepreload"][as="'+cn(i)+'"][href="'+cn(t)+'"]',s=a;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=cr(t)}if(!vn.has(s)&&(t=Ne({rel:"modulepreload",href:t},e),vn.set(s,t),n.querySelector(a)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(n.querySelector(zo(s)))return}i=n.createElement("link"),yt(i,"link",t),ct(i),n.head.appendChild(i)}}}function J_(t,e,n){wi.S(t,e,n);var i=lr;if(i&&t){var a=xs(i).hoistableStyles,s=Zs(t);e=e||"default";var r=a.get(s);if(!r){var o={loading:0,preload:null};if(r=i.querySelector(qo(s)))o.loading=5;else{t=Ne({rel:"stylesheet",href:t,"data-precedence":e},n),(n=vn.get(s))&&rm(t,n);var l=r=i.createElement("link");ct(l),yt(l,"link",t),l._p=new Promise(function(c,u){l.onload=c,l.onerror=u}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,wl(r,e,i)}r={type:"stylesheet",instance:r,count:1,state:o},a.set(s,r)}}}function X_(t,e){wi.X(t,e);var n=lr;if(n&&t){var i=xs(n).hoistableScripts,a=cr(t),s=i.get(a);s||(s=n.querySelector(zo(a)),s||(t=Ne({src:t,async:!0},e),(e=vn.get(a))&&om(t,e),s=n.createElement("script"),ct(s),yt(s,"link",t),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(a,s))}}function Z_(t,e){wi.M(t,e);var n=lr;if(n&&t){var i=xs(n).hoistableScripts,a=cr(t),s=i.get(a);s||(s=n.querySelector(zo(a)),s||(t=Ne({src:t,async:!0,type:"module"},e),(e=vn.get(a))&&om(t,e),s=n.createElement("script"),ct(s),yt(s,"link",t),n.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},i.set(a,s))}}function Lg(t,e,n,i){var a=(a=Wi.current)?yc(a):null;if(!a)throw Error(L(446));switch(t){case"meta":case"title":return null;case"style":return typeof n.precedence=="string"&&typeof n.href=="string"?(e=Zs(n.href),n=xs(a).hoistableStyles,i=n.get(e),i||(i={type:"style",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(n.rel==="stylesheet"&&typeof n.href=="string"&&typeof n.precedence=="string"){t=Zs(n.href);var s=xs(a).hoistableStyles,r=s.get(t);if(r||(a=a.ownerDocument||a,r={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},s.set(t,r),(s=a.querySelector(qo(t)))&&!s._p&&(r.instance=s,r.state.loading=5),vn.has(t)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},vn.set(t,n),s||W_(a,t,n,r.state))),e&&i===null)throw Error(L(528,""));return r}if(e&&i!==null)throw Error(L(529,""));return null;case"script":return e=n.async,n=n.src,typeof n=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=cr(n),n=xs(a).hoistableScripts,i=n.get(e),i||(i={type:"script",instance:null,count:0,state:null},n.set(e,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(L(444,t))}}function Zs(t){return'href="'+cn(t)+'"'}function qo(t){return'link[rel="stylesheet"]['+t+"]"}function pS(t){return Ne({},t,{"data-precedence":t.precedence,precedence:null})}function W_(t,e,n,i){t.querySelector('link[rel="preload"][as="style"]['+e+"]")?i.loading=1:(e=t.createElement("link"),i.preload=e,e.addEventListener("load",function(){return i.loading|=1}),e.addEventListener("error",function(){return i.loading|=2}),yt(e,"link",n),ct(e),t.head.appendChild(e))}function cr(t){return'[src="'+cn(t)+'"]'}function zo(t){return"script[async]"+t}function Ug(t,e,n){if(e.count++,e.instance===null)switch(e.type){case"style":var i=t.querySelector('style[data-href~="'+cn(n.href)+'"]');if(i)return e.instance=i,ct(i),i;var a=Ne({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return i=(t.ownerDocument||t).createElement("style"),ct(i),yt(i,"style",a),wl(i,n.precedence,t),e.instance=i;case"stylesheet":a=Zs(n.href);var s=t.querySelector(qo(a));if(s)return e.state.loading|=4,e.instance=s,ct(s),s;i=pS(n),(a=vn.get(a))&&rm(i,a),s=(t.ownerDocument||t).createElement("link"),ct(s);var r=s;return r._p=new Promise(function(o,l){r.onload=o,r.onerror=l}),yt(s,"link",i),e.state.loading|=4,wl(s,n.precedence,t),e.instance=s;case"script":return s=cr(n.src),(a=t.querySelector(zo(s)))?(e.instance=a,ct(a),a):(i=n,(a=vn.get(s))&&(i=Ne({},n),om(i,a)),t=t.ownerDocument||t,a=t.createElement("script"),ct(a),yt(a,"link",i),t.head.appendChild(a),e.instance=a);case"void":return null;default:throw Error(L(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(i=e.instance,e.state.loading|=4,wl(i,n.precedence,t));return e.instance}function wl(t,e,n){for(var i=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),a=i.length?i[i.length-1]:null,s=a,r=0;r<i.length;r++){var o=i[r];if(o.dataset.precedence===e)s=o;else if(s!==a)break}s?s.parentNode.insertBefore(t,s.nextSibling):(e=n.nodeType===9?n.head:n,e.insertBefore(t,e.firstChild))}function rm(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.title==null&&(t.title=e.title)}function om(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.integrity==null&&(t.integrity=e.integrity)}var Ol=null;function Ig(t,e,n){if(Ol===null){var i=new Map,a=Ol=new Map;a.set(n,i)}else a=Ol,i=a.get(n),i||(i=new Map,a.set(n,i));if(i.has(t))return i;for(i.set(t,null),n=n.getElementsByTagName(t),a=0;a<n.length;a++){var s=n[a];if(!(s[Po]||s[mt]||t==="link"&&s.getAttribute("rel")==="stylesheet")&&s.namespaceURI!=="http://www.w3.org/2000/svg"){var r=s.getAttribute(e)||"";r=t+r;var o=i.get(r);o?o.push(s):i.set(r,[s])}}return i}function jg(t,e,n){t=t.ownerDocument||t,t.head.insertBefore(n,e==="title"?t.querySelector("head > title"):null)}function $_(t,e,n){if(n===1||e.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return t=e.disabled,typeof e.precedence=="string"&&t==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function gS(t){return!(t.type==="stylesheet"&&!(t.state.loading&3))}function eR(t,e,n,i){if(n.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&!(n.state.loading&4)){if(n.instance===null){var a=Zs(i.href),s=e.querySelector(qo(a));if(s){e=s._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(t.count++,t=Sc.bind(t),e.then(t,t)),n.state.loading|=4,n.instance=s,ct(s);return}s=e.ownerDocument||e,i=pS(i),(a=vn.get(a))&&rm(i,a),s=s.createElement("link"),ct(s);var r=s;r._p=new Promise(function(o,l){r.onload=o,r.onerror=l}),yt(s,"link",i),n.instance=s}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(n,e),(e=n.state.preload)&&!(n.state.loading&3)&&(t.count++,n=Sc.bind(t),e.addEventListener("load",n),e.addEventListener("error",n))}}var nd=0;function tR(t,e){return t.stylesheets&&t.count===0&&Al(t,t.stylesheets),0<t.count||0<t.imgCount?function(n){var i=setTimeout(function(){if(t.stylesheets&&Al(t,t.stylesheets),t.unsuspend){var s=t.unsuspend;t.unsuspend=null,s()}},6e4+e);0<t.imgBytes&&nd===0&&(nd=62500*L_());var a=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Al(t,t.stylesheets),t.unsuspend)){var s=t.unsuspend;t.unsuspend=null,s()}},(t.imgBytes>nd?50:800)+e);return t.unsuspend=n,function(){t.unsuspend=null,clearTimeout(i),clearTimeout(a)}}:null}function Sc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Al(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Tc=null;function Al(t,e){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Tc=new Map,e.forEach(nR,t),Tc=null,Sc.call(t))}function nR(t,e){if(!(e.state.loading&4)){var n=Tc.get(t);if(n)var i=n.get(null);else{n=new Map,Tc.set(t,n);for(var a=t.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<a.length;s++){var r=a[s];(r.nodeName==="LINK"||r.getAttribute("media")!=="not all")&&(n.set(r.dataset.precedence,r),i=r)}i&&n.set(null,i)}a=e.instance,r=a.getAttribute("data-precedence"),s=n.get(r)||i,s===i&&n.set(null,a),n.set(r,a),this.count++,i=Sc.bind(this),a.addEventListener("load",i),a.addEventListener("error",i),s?s.parentNode.insertBefore(a,s.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(a,t.firstChild)),e.state.loading|=4}}var vo={$$typeof:fi,Provider:null,Consumer:null,_currentValue:Pa,_currentValue2:Pa,_threadCount:0};function iR(t,e,n,i,a,s,r,o,l){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=_u(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=_u(0),this.hiddenUpdates=_u(null),this.identifierPrefix=i,this.onUncaughtError=a,this.onCaughtError=s,this.onRecoverableError=r,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function vS(t,e,n,i,a,s,r,o,l,c,u,d){return t=new iR(t,e,n,r,l,c,u,d,o),e=1,s===!0&&(e|=24),s=Gt(3,null,null,e),t.current=s,s.stateNode=t,e=Nh(),e.refCount++,t.pooledCache=e,e.refCount++,s.memoizedState={element:i,isDehydrated:n,cache:e},Uh(s),t}function bS(t){return t?(t=Ss,t):Ss}function yS(t,e,n,i,a,s){a=bS(a),i.context===null?i.context=a:i.pendingContext=a,i=ea(e),i.payload={element:n},s=s===void 0?null:s,s!==null&&(i.callback=s),n=ta(t,i,e),n!==null&&(It(n,t,e),Kr(n,t,e))}function Bg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function lm(t,e){Bg(t,e),(t=t.alternate)&&Bg(t,e)}function SS(t){if(t.tag===13||t.tag===31){var e=Wa(t,67108864);e!==null&&It(e,t,67108864),lm(t,67108864)}}function qg(t){if(t.tag===13||t.tag===31){var e=Zt();e=yh(e);var n=Wa(t,e);n!==null&&It(n,t,e),lm(t,e)}}var Cc=!0;function aR(t,e,n,i){var a=W.T;W.T=null;var s=ve.p;try{ve.p=2,cm(t,e,n,i)}finally{ve.p=s,W.T=a}}function sR(t,e,n,i){var a=W.T;W.T=null;var s=ve.p;try{ve.p=8,cm(t,e,n,i)}finally{ve.p=s,W.T=a}}function cm(t,e,n,i){if(Cc){var a=Af(i);if(a===null)ed(t,e,i,kc,n),zg(t,i);else if(oR(a,t,e,n,i))i.stopPropagation();else if(zg(t,i),e&4&&-1<rR.indexOf(t)){for(;a!==null;){var s=ar(a);if(s!==null)switch(s.tag){case 3:if(s=s.stateNode,s.current.memoizedState.isDehydrated){var r=wa(s.pendingLanes);if(r!==0){var o=s;for(o.pendingLanes|=2,o.entangledLanes|=2;r;){var l=1<<31-Xt(r);o.entanglements[1]|=l,r&=~l}Jn(s),!(ge&6)&&(fc=Qt()+500,Bo(0))}}break;case 31:case 13:o=Wa(s,2),o!==null&&It(o,s,2),tu(),lm(s,2)}if(s=Af(i),s===null&&ed(t,e,i,kc,n),s===a)break;a=s}a!==null&&i.stopPropagation()}else ed(t,e,i,null,n)}}function Af(t){return t=kh(t),um(t)}var kc=null;function um(t){if(kc=null,t=ms(t),t!==null){var e=Ao(t);if(e===null)t=null;else{var n=e.tag;if(n===13){if(t=q0(e),t!==null)return t;t=null}else if(n===31){if(t=z0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return kc=t,null}function TS(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(G1()){case G0:return 2;case K0:return 8;case Wl:case K1:return 32;case Y0:return 268435456;default:return 32}default:return 32}}var Mf=!1,aa=null,sa=null,ra=null,bo=new Map,yo=new Map,Vi=[],rR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function zg(t,e){switch(t){case"focusin":case"focusout":aa=null;break;case"dragenter":case"dragleave":sa=null;break;case"mouseover":case"mouseout":ra=null;break;case"pointerover":case"pointerout":bo.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":yo.delete(e.pointerId)}}function Tr(t,e,n,i,a,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:i,nativeEvent:s,targetContainers:[a]},e!==null&&(e=ar(e),e!==null&&SS(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,a!==null&&e.indexOf(a)===-1&&e.push(a),t)}function oR(t,e,n,i,a){switch(e){case"focusin":return aa=Tr(aa,t,e,n,i,a),!0;case"dragenter":return sa=Tr(sa,t,e,n,i,a),!0;case"mouseover":return ra=Tr(ra,t,e,n,i,a),!0;case"pointerover":var s=a.pointerId;return bo.set(s,Tr(bo.get(s)||null,t,e,n,i,a)),!0;case"gotpointercapture":return s=a.pointerId,yo.set(s,Tr(yo.get(s)||null,t,e,n,i,a)),!0}return!1}function CS(t){var e=ms(t.target);if(e!==null){var n=Ao(e);if(n!==null){if(e=n.tag,e===13){if(e=q0(n),e!==null){t.blockedOn=e,_p(t.priority,function(){qg(n)});return}}else if(e===31){if(e=z0(n),e!==null){t.blockedOn=e,_p(t.priority,function(){qg(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ml(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Af(t.nativeEvent);if(n===null){n=t.nativeEvent;var i=new n.constructor(n.type,n);Qd=i,n.target.dispatchEvent(i),Qd=null}else return e=ar(n),e!==null&&SS(e),t.blockedOn=n,!1;e.shift()}return!0}function Fg(t,e,n){Ml(t)&&n.delete(e)}function lR(){Mf=!1,aa!==null&&Ml(aa)&&(aa=null),sa!==null&&Ml(sa)&&(sa=null),ra!==null&&Ml(ra)&&(ra=null),bo.forEach(Fg),yo.forEach(Fg)}function ol(t,e){t.blockedOn===e&&(t.blockedOn=null,Mf||(Mf=!0,it.unstable_scheduleCallback(it.unstable_NormalPriority,lR)))}var ll=null;function Vg(t){ll!==t&&(ll=t,it.unstable_scheduleCallback(it.unstable_NormalPriority,function(){ll===t&&(ll=null);for(var e=0;e<t.length;e+=3){var n=t[e],i=t[e+1],a=t[e+2];if(typeof i!="function"){if(um(i||n)===null)continue;break}var s=ar(n);s!==null&&(t.splice(e,3),e-=3,df(s,{pending:!0,data:a,method:n.method,action:i},i,a))}}))}function Ws(t){function e(l){return ol(l,t)}aa!==null&&ol(aa,t),sa!==null&&ol(sa,t),ra!==null&&ol(ra,t),bo.forEach(e),yo.forEach(e);for(var n=0;n<Vi.length;n++){var i=Vi[n];i.blockedOn===t&&(i.blockedOn=null)}for(;0<Vi.length&&(n=Vi[0],n.blockedOn===null);)CS(n),n.blockedOn===null&&Vi.shift();if(n=(t.ownerDocument||t).$$reactFormReplay,n!=null)for(i=0;i<n.length;i+=3){var a=n[i],s=n[i+1],r=a[Bt]||null;if(typeof s=="function")r||Vg(n);else if(r){var o=null;if(s&&s.hasAttribute("formAction")){if(a=s,r=s[Bt]||null)o=r.formAction;else if(um(a)!==null)continue}else o=r.action;typeof o=="function"?n[i+1]=o:(n.splice(i,3),i-=3),Vg(n)}}}function kS(){function t(s){s.canIntercept&&s.info==="react-transition"&&s.intercept({handler:function(){return new Promise(function(r){return a=r})},focusReset:"manual",scroll:"manual"})}function e(){a!==null&&(a(),a=null),i||setTimeout(n,20)}function n(){if(!i&&!navigation.transition){var s=navigation.currentEntry;s&&s.url!=null&&navigation.navigate(s.url,{state:s.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var i=!1,a=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",e),navigation.addEventListener("navigateerror",e),setTimeout(n,100),function(){i=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",e),navigation.removeEventListener("navigateerror",e),a!==null&&(a(),a=null)}}}function dm(t){this._internalRoot=t}au.prototype.render=dm.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(L(409));var n=e.current,i=Zt();yS(n,i,t,e,null,null)};au.prototype.unmount=dm.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;yS(t.current,2,null,t,null,null),tu(),e[ir]=null}};function au(t){this._internalRoot=t}au.prototype.unstable_scheduleHydration=function(t){if(t){var e=W0();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Vi.length&&e!==0&&e<Vi[n].priority;n++);Vi.splice(n,0,t),n===0&&CS(t)}};var Hg=j0.version;if(Hg!=="19.2.4")throw Error(L(527,Hg,"19.2.4"));ve.findDOMNode=function(t){var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(L(188)):(t=Object.keys(t).join(","),Error(L(268,t)));return t=j1(e),t=t!==null?F0(t):null,t=t===null?null:t.stateNode,t};var cR={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cl.isDisabled&&cl.supportsFiber)try{Mo=cl.inject(cR),Jt=cl}catch{}}zc.createRoot=function(t,e){if(!B0(t))throw Error(L(299));var n=!1,i="",a=my,s=py,r=gy;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onUncaughtError!==void 0&&(a=e.onUncaughtError),e.onCaughtError!==void 0&&(s=e.onCaughtError),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=vS(t,1,!1,null,null,n,i,null,a,s,r,kS),t[ir]=e.current,sm(t),new dm(e)};zc.hydrateRoot=function(t,e,n){if(!B0(t))throw Error(L(299));var i=!1,a="",s=my,r=py,o=gy,l=null;return n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onUncaughtError!==void 0&&(s=n.onUncaughtError),n.onCaughtError!==void 0&&(r=n.onCaughtError),n.onRecoverableError!==void 0&&(o=n.onRecoverableError),n.formState!==void 0&&(l=n.formState)),e=vS(t,1,!0,e,n??null,i,a,l,s,r,o,kS),e.context=bS(null),n=e.current,i=Zt(),i=yh(i),a=ea(i),a.callback=null,ta(n,a,i),n=i,e.current.lanes=n,No(e,n),Jn(e),t[ir]=e.current,sm(t),new au(e)};zc.version="19.2.4";function ES(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ES)}catch(t){console.error(t)}}ES(),D0.exports=zc;var uR=D0.exports;/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Gg="popstate";function dR(t={}){function e(i,a){let{pathname:s,search:r,hash:o}=i.location;return Df("",{pathname:s,search:r,hash:o},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(i,a){return typeof a=="string"?a:So(a)}return hR(e,n,null,t)}function Ie(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Gn(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function fR(){return Math.random().toString(36).substring(2,10)}function Kg(t,e){return{usr:t.state,key:t.key,idx:e}}function Df(t,e,n=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?ur(e):e,state:n,key:e&&e.key||i||fR()}}function So({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function ur(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substring(i),t=t.substring(0,i)),t&&(e.pathname=t)}return e}function hR(t,e,n,i={}){let{window:a=document.defaultView,v5Compat:s=!1}=i,r=a.history,o="POP",l=null,c=u();c==null&&(c=0,r.replaceState({...r.state,idx:c},""));function u(){return(r.state||{idx:null}).idx}function d(){o="POP";let T=u(),m=T==null?null:T-c;c=T,l&&l({action:o,location:y.location,delta:m})}function f(T,m){o="PUSH";let p=Df(y.location,T,m);c=u()+1;let v=Kg(p,c),b=y.createHref(p);try{r.pushState(v,"",b)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;a.location.assign(b)}s&&l&&l({action:o,location:y.location,delta:1})}function h(T,m){o="REPLACE";let p=Df(y.location,T,m);c=u();let v=Kg(p,c),b=y.createHref(p);r.replaceState(v,"",b),s&&l&&l({action:o,location:y.location,delta:0})}function g(T){return mR(T)}let y={get action(){return o},get location(){return t(a,r)},listen(T){if(l)throw new Error("A history only accepts one active listener");return a.addEventListener(Gg,d),l=T,()=>{a.removeEventListener(Gg,d),l=null}},createHref(T){return e(a,T)},createURL:g,encodeLocation(T){let m=g(T);return{pathname:m.pathname,search:m.search,hash:m.hash}},push:f,replace:h,go(T){return r.go(T)}};return y}function mR(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Ie(n,"No window.location.(origin|href) available to create URL");let i=typeof t=="string"?t:So(t);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=n+i),new URL(i,n)}function _S(t,e,n="/"){return pR(t,e,n,!1)}function pR(t,e,n,i){let a=typeof e=="string"?ur(e):e,s=_i(a.pathname||"/",n);if(s==null)return null;let r=RS(t);gR(r);let o=null;for(let l=0;o==null&&l<r.length;++l){let c=xR(s);o=_R(r[l],c,i)}return o}function RS(t,e=[],n=[],i="",a=!1){let s=(r,o,l=a,c)=>{let u={relativePath:c===void 0?r.path||"":c,caseSensitive:r.caseSensitive===!0,childrenIndex:o,route:r};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(i)&&l)return;Ie(u.relativePath.startsWith(i),`Absolute route path "${u.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(i.length)}let d=bi([i,u.relativePath]),f=n.concat(u);r.children&&r.children.length>0&&(Ie(r.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${d}".`),RS(r.children,e,f,d,l)),!(r.path==null&&!r.index)&&e.push({path:d,score:kR(d,r.index),routesMeta:f})};return t.forEach((r,o)=>{var l;if(r.path===""||!((l=r.path)!=null&&l.includes("?")))s(r,o);else for(let c of xS(r.path))s(r,o,!0,c)}),e}function xS(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,a=n.endsWith("?"),s=n.replace(/\?$/,"");if(i.length===0)return a?[s,""]:[s];let r=xS(i.join("/")),o=[];return o.push(...r.map(l=>l===""?s:[s,l].join("/"))),a&&o.push(...r),o.map(l=>t.startsWith("/")&&l===""?"/":l)}function gR(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:ER(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var vR=/^:[\w-]+$/,bR=3,yR=2,SR=1,TR=10,CR=-2,Yg=t=>t==="*";function kR(t,e){let n=t.split("/"),i=n.length;return n.some(Yg)&&(i+=CR),e&&(i+=yR),n.filter(a=>!Yg(a)).reduce((a,s)=>a+(vR.test(s)?bR:s===""?SR:TR),i)}function ER(t,e){return t.length===e.length&&t.slice(0,-1).every((i,a)=>i===e[a])?t[t.length-1]-e[e.length-1]:0}function _R(t,e,n=!1){let{routesMeta:i}=t,a={},s="/",r=[];for(let o=0;o<i.length;++o){let l=i[o],c=o===i.length-1,u=s==="/"?e:e.slice(s.length)||"/",d=Ec({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!d&&c&&n&&!i[i.length-1].route.index&&(d=Ec({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(a,d.params),r.push({params:a,pathname:bi([s,d.pathname]),pathnameBase:MR(bi([s,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(s=bi([s,d.pathnameBase]))}return r}function Ec(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=RR(t.path,t.caseSensitive,t.end),a=e.match(n);if(!a)return null;let s=a[0],r=s.replace(/(.)\/+$/,"$1"),o=a.slice(1);return{params:i.reduce((c,{paramName:u,isOptional:d},f)=>{if(u==="*"){let g=o[f]||"";r=s.slice(0,s.length-g.length).replace(/(.)\/+$/,"$1")}const h=o[f];return d&&!h?c[u]=void 0:c[u]=(h||"").replace(/%2F/g,"/"),c},{}),pathname:s,pathnameBase:r,pattern:t}}function RR(t,e=!1,n=!0){Gn(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(r,o,l)=>(i.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(i.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),i]}function xR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Gn(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function _i(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}var wR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function OR(t,e="/"){let{pathname:n,search:i="",hash:a=""}=typeof t=="string"?ur(t):t,s;return n?(n=n.replace(/\/\/+/g,"/"),n.startsWith("/")?s=Qg(n.substring(1),"/"):s=Qg(n,e)):s=e,{pathname:s,search:DR(i),hash:NR(a)}}function Qg(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function id(t,e,n,i){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function AR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function wS(t){let e=AR(t);return e.map((n,i)=>i===e.length-1?n.pathname:n.pathnameBase)}function OS(t,e,n,i=!1){let a;typeof t=="string"?a=ur(t):(a={...t},Ie(!a.pathname||!a.pathname.includes("?"),id("?","pathname","search",a)),Ie(!a.pathname||!a.pathname.includes("#"),id("#","pathname","hash",a)),Ie(!a.search||!a.search.includes("#"),id("#","search","hash",a)));let s=t===""||a.pathname==="",r=s?"/":a.pathname,o;if(r==null)o=n;else{let d=e.length-1;if(!i&&r.startsWith("..")){let f=r.split("/");for(;f[0]==="..";)f.shift(),d-=1;a.pathname=f.join("/")}o=d>=0?e[d]:"/"}let l=OR(a,o),c=r&&r!=="/"&&r.endsWith("/"),u=(s||r===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var bi=t=>t.join("/").replace(/\/\/+/g,"/"),MR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),DR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,NR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,PR=class{constructor(t,e,n,i=!1){this.status=t,this.statusText=e||"",this.internal=i,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function LR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function UR(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var AS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function MS(t,e){let n=t;if(typeof n!="string"||!wR.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let i=n,a=!1;if(AS)try{let s=new URL(window.location.href),r=n.startsWith("//")?new URL(s.protocol+n):new URL(n),o=_i(r.pathname,e);r.origin===s.origin&&o!=null?n=o+r.search+r.hash:a=!0}catch{Gn(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:i,isExternal:a,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var DS=["POST","PUT","PATCH","DELETE"];new Set(DS);var IR=["GET",...DS];new Set(IR);var dr=x.createContext(null);dr.displayName="DataRouter";var su=x.createContext(null);su.displayName="DataRouterState";var jR=x.createContext(!1),NS=x.createContext({isTransitioning:!1});NS.displayName="ViewTransition";var BR=x.createContext(new Map);BR.displayName="Fetchers";var qR=x.createContext(null);qR.displayName="Await";var bn=x.createContext(null);bn.displayName="Navigation";var Fo=x.createContext(null);Fo.displayName="Location";var Xn=x.createContext({outlet:null,matches:[],isDataRoute:!1});Xn.displayName="Route";var fm=x.createContext(null);fm.displayName="RouteError";var PS="REACT_ROUTER_ERROR",zR="REDIRECT",FR="ROUTE_ERROR_RESPONSE";function VR(t){if(t.startsWith(`${PS}:${zR}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function HR(t){if(t.startsWith(`${PS}:${FR}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new PR(e.status,e.statusText,e.data)}catch{}}function GR(t,{relative:e}={}){Ie(Vo(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=x.useContext(bn),{hash:a,pathname:s,search:r}=Ho(t,{relative:e}),o=s;return n!=="/"&&(o=s==="/"?n:bi([n,s])),i.createHref({pathname:o,search:r,hash:a})}function Vo(){return x.useContext(Fo)!=null}function es(){return Ie(Vo(),"useLocation() may be used only in the context of a <Router> component."),x.useContext(Fo).location}var LS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function US(t){x.useContext(bn).static||x.useLayoutEffect(t)}function ru(){let{isDataRoute:t}=x.useContext(Xn);return t?ax():KR()}function KR(){Ie(Vo(),"useNavigate() may be used only in the context of a <Router> component.");let t=x.useContext(dr),{basename:e,navigator:n}=x.useContext(bn),{matches:i}=x.useContext(Xn),{pathname:a}=es(),s=JSON.stringify(wS(i)),r=x.useRef(!1);return US(()=>{r.current=!0}),x.useCallback((l,c={})=>{if(Gn(r.current,LS),!r.current)return;if(typeof l=="number"){n.go(l);return}let u=OS(l,JSON.parse(s),a,c.relative==="path");t==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:bi([e,u.pathname])),(c.replace?n.replace:n.push)(u,c.state,c)},[e,n,s,a,t])}x.createContext(null);function IS(){let{matches:t}=x.useContext(Xn),e=t[t.length-1];return e?e.params:{}}function Ho(t,{relative:e}={}){let{matches:n}=x.useContext(Xn),{pathname:i}=es(),a=JSON.stringify(wS(n));return x.useMemo(()=>OS(t,JSON.parse(a),i,e==="path"),[t,a,i,e])}function YR(t,e){return jS(t,e)}function jS(t,e,n,i,a){var p;Ie(Vo(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=x.useContext(bn),{matches:r}=x.useContext(Xn),o=r[r.length-1],l=o?o.params:{},c=o?o.pathname:"/",u=o?o.pathnameBase:"/",d=o&&o.route;{let v=d&&d.path||"";qS(c,!d||v.endsWith("*")||v.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${v}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${v}"> to <Route path="${v==="/"?"*":`${v}/*`}">.`)}let f=es(),h;if(e){let v=typeof e=="string"?ur(e):e;Ie(u==="/"||((p=v.pathname)==null?void 0:p.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${v.pathname}" was given in the \`location\` prop.`),h=v}else h=f;let g=h.pathname||"/",y=g;if(u!=="/"){let v=u.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(v.length).join("/")}let T=_S(t,{pathname:y});Gn(d||T!=null,`No routes matched location "${h.pathname}${h.search}${h.hash}" `),Gn(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${h.pathname}${h.search}${h.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let m=WR(T&&T.map(v=>Object.assign({},v,{params:Object.assign({},l,v.params),pathname:bi([u,s.encodeLocation?s.encodeLocation(v.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?u:bi([u,s.encodeLocation?s.encodeLocation(v.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:v.pathnameBase])})),r,n,i,a);return e&&m?x.createElement(Fo.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...h},navigationType:"POP"}},m):m}function QR(){let t=ix(),e=LR(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:i},s={padding:"2px 4px",backgroundColor:i},r=null;return console.error("Error handled by React Router default ErrorBoundary:",t),r=x.createElement(x.Fragment,null,x.createElement("p",null," Hey developer "),x.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",x.createElement("code",{style:s},"ErrorBoundary")," or"," ",x.createElement("code",{style:s},"errorElement")," prop on your route.")),x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},e),n?x.createElement("pre",{style:a},n):null,r)}var JR=x.createElement(QR,null),BS=class extends x.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=HR(t.digest);n&&(t=n)}let e=t!==void 0?x.createElement(Xn.Provider,{value:this.props.routeContext},x.createElement(fm.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?x.createElement(XR,{error:t},e):e}};BS.contextType=jR;var ad=new WeakMap;function XR({children:t,error:e}){let{basename:n}=x.useContext(bn);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let i=VR(e.digest);if(i){let a=ad.get(e);if(a)throw a;let s=MS(i.location,n);if(AS&&!ad.get(e))if(s.isExternal||i.reloadDocument)window.location.href=s.absoluteURL||s.to;else{const r=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(s.to,{replace:i.replace}));throw ad.set(e,r),r}return x.createElement("meta",{httpEquiv:"refresh",content:`0;url=${s.absoluteURL||s.to}`})}}return t}function ZR({routeContext:t,match:e,children:n}){let i=x.useContext(dr);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),x.createElement(Xn.Provider,{value:t},n)}function WR(t,e=[],n=null,i=null,a=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let s=t,r=n==null?void 0:n.errors;if(r!=null){let u=s.findIndex(d=>d.route.id&&(r==null?void 0:r[d.route.id])!==void 0);Ie(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(r).join(",")}`),s=s.slice(0,Math.min(s.length,u+1))}let o=!1,l=-1;if(n)for(let u=0;u<s.length;u++){let d=s[u];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=u),d.route.id){let{loaderData:f,errors:h}=n,g=d.route.loader&&!f.hasOwnProperty(d.route.id)&&(!h||h[d.route.id]===void 0);if(d.route.lazy||g){o=!0,l>=0?s=s.slice(0,l+1):s=[s[0]];break}}}let c=n&&i?(u,d)=>{var f,h;i(u,{location:n.location,params:((h=(f=n.matches)==null?void 0:f[0])==null?void 0:h.params)??{},unstable_pattern:UR(n.matches),errorInfo:d})}:void 0;return s.reduceRight((u,d,f)=>{let h,g=!1,y=null,T=null;n&&(h=r&&d.route.id?r[d.route.id]:void 0,y=d.route.errorElement||JR,o&&(l<0&&f===0?(qS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),g=!0,T=null):l===f&&(g=!0,T=d.route.hydrateFallbackElement||null)));let m=e.concat(s.slice(0,f+1)),p=()=>{let v;return h?v=y:g?v=T:d.route.Component?v=x.createElement(d.route.Component,null):d.route.element?v=d.route.element:v=u,x.createElement(ZR,{match:d,routeContext:{outlet:u,matches:m,isDataRoute:n!=null},children:v})};return n&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?x.createElement(BS,{location:n.location,revalidation:n.revalidation,component:y,error:h,children:p(),routeContext:{outlet:null,matches:m,isDataRoute:!0},onError:c}):p()},null)}function hm(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function $R(t){let e=x.useContext(dr);return Ie(e,hm(t)),e}function ex(t){let e=x.useContext(su);return Ie(e,hm(t)),e}function tx(t){let e=x.useContext(Xn);return Ie(e,hm(t)),e}function mm(t){let e=tx(t),n=e.matches[e.matches.length-1];return Ie(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function nx(){return mm("useRouteId")}function ix(){var i;let t=x.useContext(fm),e=ex("useRouteError"),n=mm("useRouteError");return t!==void 0?t:(i=e.errors)==null?void 0:i[n]}function ax(){let{router:t}=$R("useNavigate"),e=mm("useNavigate"),n=x.useRef(!1);return US(()=>{n.current=!0}),x.useCallback(async(a,s={})=>{Gn(n.current,LS),n.current&&(typeof a=="number"?await t.navigate(a):await t.navigate(a,{fromRouteId:e,...s}))},[t,e])}var Jg={};function qS(t,e,n){!e&&!Jg[t]&&(Jg[t]=!0,Gn(!1,n))}x.memo(sx);function sx({routes:t,future:e,state:n,onError:i}){return jS(t,void 0,n,i,e)}function Ir(t){Ie(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function rx({basename:t="/",children:e=null,location:n,navigationType:i="POP",navigator:a,static:s=!1,unstable_useTransitions:r}){Ie(!Vo(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),l=x.useMemo(()=>({basename:o,navigator:a,static:s,unstable_useTransitions:r,future:{}}),[o,a,s,r]);typeof n=="string"&&(n=ur(n));let{pathname:c="/",search:u="",hash:d="",state:f=null,key:h="default"}=n,g=x.useMemo(()=>{let y=_i(c,o);return y==null?null:{location:{pathname:y,search:u,hash:d,state:f,key:h},navigationType:i}},[o,c,u,d,f,h,i]);return Gn(g!=null,`<Router basename="${o}"> is not able to match the URL "${c}${u}${d}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:x.createElement(bn.Provider,{value:l},x.createElement(Fo.Provider,{children:e,value:g}))}function ox({children:t,location:e}){return YR(Nf(t),e)}function Nf(t,e=[]){let n=[];return x.Children.forEach(t,(i,a)=>{if(!x.isValidElement(i))return;let s=[...e,a];if(i.type===x.Fragment){n.push.apply(n,Nf(i.props.children,s));return}Ie(i.type===Ir,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ie(!i.props.index||!i.props.children,"An index route cannot have child routes.");let r={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(r.children=Nf(i.props.children,s)),n.push(r)}),n}var Dl="get",Nl="application/x-www-form-urlencoded";function ou(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function lx(t){return ou(t)&&t.tagName.toLowerCase()==="button"}function cx(t){return ou(t)&&t.tagName.toLowerCase()==="form"}function ux(t){return ou(t)&&t.tagName.toLowerCase()==="input"}function dx(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function fx(t,e){return t.button===0&&(!e||e==="_self")&&!dx(t)}var ul=null;function hx(){if(ul===null)try{new FormData(document.createElement("form"),0),ul=!1}catch{ul=!0}return ul}var mx=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function sd(t){return t!=null&&!mx.has(t)?(Gn(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Nl}"`),null):t}function px(t,e){let n,i,a,s,r;if(cx(t)){let o=t.getAttribute("action");i=o?_i(o,e):null,n=t.getAttribute("method")||Dl,a=sd(t.getAttribute("enctype"))||Nl,s=new FormData(t)}else if(lx(t)||ux(t)&&(t.type==="submit"||t.type==="image")){let o=t.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||o.getAttribute("action");if(i=l?_i(l,e):null,n=t.getAttribute("formmethod")||o.getAttribute("method")||Dl,a=sd(t.getAttribute("formenctype"))||sd(o.getAttribute("enctype"))||Nl,s=new FormData(o,t),!hx()){let{name:c,type:u,value:d}=t;if(u==="image"){let f=c?`${c}.`:"";s.append(`${f}x`,"0"),s.append(`${f}y`,"0")}else c&&s.append(c,d)}}else{if(ou(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=Dl,i=null,a=Nl,r=t}return s&&a==="text/plain"&&(r=s,s=void 0),{action:i,method:n.toLowerCase(),encType:a,formData:s,body:r}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function pm(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function gx(t,e,n,i){let a=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n?a.pathname.endsWith("/")?a.pathname=`${a.pathname}_.${i}`:a.pathname=`${a.pathname}.${i}`:a.pathname==="/"?a.pathname=`_root.${i}`:e&&_i(a.pathname,e)==="/"?a.pathname=`${e.replace(/\/$/,"")}/_root.${i}`:a.pathname=`${a.pathname.replace(/\/$/,"")}.${i}`,a}async function vx(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function bx(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function yx(t,e,n){let i=await Promise.all(t.map(async a=>{let s=e.routes[a.route.id];if(s){let r=await vx(s,n);return r.links?r.links():[]}return[]}));return kx(i.flat(1).filter(bx).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function Xg(t,e,n,i,a,s){let r=(l,c)=>n[c]?l.route.id!==n[c].route.id:!0,o=(l,c)=>{var u;return n[c].pathname!==l.pathname||((u=n[c].route.path)==null?void 0:u.endsWith("*"))&&n[c].params["*"]!==l.params["*"]};return s==="assets"?e.filter((l,c)=>r(l,c)||o(l,c)):s==="data"?e.filter((l,c)=>{var d;let u=i.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(r(l,c)||o(l,c))return!0;if(l.route.shouldRevalidate){let f=l.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:((d=n[0])==null?void 0:d.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function Sx(t,e,{includeHydrateFallback:n}={}){return Tx(t.map(i=>{let a=e.routes[i.route.id];if(!a)return[];let s=[a.module];return a.clientActionModule&&(s=s.concat(a.clientActionModule)),a.clientLoaderModule&&(s=s.concat(a.clientLoaderModule)),n&&a.hydrateFallbackModule&&(s=s.concat(a.hydrateFallbackModule)),a.imports&&(s=s.concat(a.imports)),s}).flat(1))}function Tx(t){return[...new Set(t)]}function Cx(t){let e={},n=Object.keys(t).sort();for(let i of n)e[i]=t[i];return e}function kx(t,e){let n=new Set;return new Set(e),t.reduce((i,a)=>{let s=JSON.stringify(Cx(a));return n.has(s)||(n.add(s),i.push({key:s,link:a})),i},[])}function zS(){let t=x.useContext(dr);return pm(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function Ex(){let t=x.useContext(su);return pm(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var gm=x.createContext(void 0);gm.displayName="FrameworkContext";function FS(){let t=x.useContext(gm);return pm(t,"You must render this element inside a <HydratedRouter> element"),t}function _x(t,e){let n=x.useContext(gm),[i,a]=x.useState(!1),[s,r]=x.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:d}=e,f=x.useRef(null);x.useEffect(()=>{if(t==="render"&&r(!0),t==="viewport"){let y=m=>{m.forEach(p=>{r(p.isIntersecting)})},T=new IntersectionObserver(y,{threshold:.5});return f.current&&T.observe(f.current),()=>{T.disconnect()}}},[t]),x.useEffect(()=>{if(i){let y=setTimeout(()=>{r(!0)},100);return()=>{clearTimeout(y)}}},[i]);let h=()=>{a(!0)},g=()=>{a(!1),r(!1)};return n?t!=="intent"?[s,f,{}]:[s,f,{onFocus:Cr(o,h),onBlur:Cr(l,g),onMouseEnter:Cr(c,h),onMouseLeave:Cr(u,g),onTouchStart:Cr(d,h)}]:[!1,f,{}]}function Cr(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function Rx({page:t,...e}){let{router:n}=zS(),i=x.useMemo(()=>_S(n.routes,t,n.basename),[n.routes,t,n.basename]);return i?x.createElement(wx,{page:t,matches:i,...e}):null}function xx(t){let{manifest:e,routeModules:n}=FS(),[i,a]=x.useState([]);return x.useEffect(()=>{let s=!1;return yx(t,e,n).then(r=>{s||a(r)}),()=>{s=!0}},[t,e,n]),i}function wx({page:t,matches:e,...n}){let i=es(),{future:a,manifest:s,routeModules:r}=FS(),{basename:o}=zS(),{loaderData:l,matches:c}=Ex(),u=x.useMemo(()=>Xg(t,e,c,s,i,"data"),[t,e,c,s,i]),d=x.useMemo(()=>Xg(t,e,c,s,i,"assets"),[t,e,c,s,i]),f=x.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let y=new Set,T=!1;if(e.forEach(p=>{var b;let v=s.routes[p.route.id];!v||!v.hasLoader||(!u.some(C=>C.route.id===p.route.id)&&p.route.id in l&&((b=r[p.route.id])!=null&&b.shouldRevalidate)||v.hasClientLoader?T=!0:y.add(p.route.id))}),y.size===0)return[];let m=gx(t,o,a.unstable_trailingSlashAwareDataRequests,"data");return T&&y.size>0&&m.searchParams.set("_routes",e.filter(p=>y.has(p.route.id)).map(p=>p.route.id).join(",")),[m.pathname+m.search]},[o,a.unstable_trailingSlashAwareDataRequests,l,i,s,u,e,t,r]),h=x.useMemo(()=>Sx(d,s),[d,s]),g=xx(d);return x.createElement(x.Fragment,null,f.map(y=>x.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...n})),h.map(y=>x.createElement("link",{key:y,rel:"modulepreload",href:y,...n})),g.map(({key:y,link:T})=>x.createElement("link",{key:y,nonce:n.nonce,...T,crossOrigin:T.crossOrigin??n.crossOrigin})))}function Ox(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var Ax=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Ax&&(window.__reactRouterVersion="7.13.0")}catch{}function Mx({basename:t,children:e,unstable_useTransitions:n,window:i}){let a=x.useRef();a.current==null&&(a.current=dR({window:i,v5Compat:!0}));let s=a.current,[r,o]=x.useState({action:s.action,location:s.location}),l=x.useCallback(c=>{n===!1?o(c):x.startTransition(()=>o(c))},[n]);return x.useLayoutEffect(()=>s.listen(l),[s,l]),x.createElement(rx,{basename:t,children:e,location:r.location,navigationType:r.action,navigator:s,unstable_useTransitions:n})}var VS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ma=x.forwardRef(function({onClick:e,discover:n="render",prefetch:i="none",relative:a,reloadDocument:s,replace:r,state:o,target:l,to:c,preventScrollReset:u,viewTransition:d,unstable_defaultShouldRevalidate:f,...h},g){let{basename:y,unstable_useTransitions:T}=x.useContext(bn),m=typeof c=="string"&&VS.test(c),p=MS(c,y);c=p.to;let v=GR(c,{relative:a}),[b,C,_]=_x(i,h),w=Lx(c,{replace:r,state:o,target:l,preventScrollReset:u,relative:a,viewTransition:d,unstable_defaultShouldRevalidate:f,unstable_useTransitions:T});function P(N){e&&e(N),N.defaultPrevented||w(N)}let O=x.createElement("a",{...h,..._,href:p.absoluteURL||v,onClick:p.isExternal||s?e:P,ref:Ox(g,C),target:l,"data-discover":!m&&n==="render"?"true":void 0});return b&&!m?x.createElement(x.Fragment,null,O,x.createElement(Rx,{page:v})):O});ma.displayName="Link";var Dx=x.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:i="",end:a=!1,style:s,to:r,viewTransition:o,children:l,...c},u){let d=Ho(r,{relative:c.relative}),f=es(),h=x.useContext(su),{navigator:g,basename:y}=x.useContext(bn),T=h!=null&&qx(d)&&o===!0,m=g.encodeLocation?g.encodeLocation(d).pathname:d.pathname,p=f.pathname,v=h&&h.navigation&&h.navigation.location?h.navigation.location.pathname:null;n||(p=p.toLowerCase(),v=v?v.toLowerCase():null,m=m.toLowerCase()),v&&y&&(v=_i(v,y)||v);const b=m!=="/"&&m.endsWith("/")?m.length-1:m.length;let C=p===m||!a&&p.startsWith(m)&&p.charAt(b)==="/",_=v!=null&&(v===m||!a&&v.startsWith(m)&&v.charAt(m.length)==="/"),w={isActive:C,isPending:_,isTransitioning:T},P=C?e:void 0,O;typeof i=="function"?O=i(w):O=[i,C?"active":null,_?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let N=typeof s=="function"?s(w):s;return x.createElement(ma,{...c,"aria-current":P,className:O,ref:u,style:N,to:r,viewTransition:o},typeof l=="function"?l(w):l)});Dx.displayName="NavLink";var Nx=x.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:i,replace:a,state:s,method:r=Dl,action:o,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:d,unstable_defaultShouldRevalidate:f,...h},g)=>{let{unstable_useTransitions:y}=x.useContext(bn),T=jx(),m=Bx(o,{relative:c}),p=r.toLowerCase()==="get"?"get":"post",v=typeof o=="string"&&VS.test(o),b=C=>{if(l&&l(C),C.defaultPrevented)return;C.preventDefault();let _=C.nativeEvent.submitter,w=(_==null?void 0:_.getAttribute("formmethod"))||r,P=()=>T(_||C.currentTarget,{fetcherKey:e,method:w,navigate:n,replace:a,state:s,relative:c,preventScrollReset:u,viewTransition:d,unstable_defaultShouldRevalidate:f});y&&n!==!1?x.startTransition(()=>P()):P()};return x.createElement("form",{ref:g,method:p,action:m,onSubmit:i?l:b,...h,"data-discover":!v&&t==="render"?"true":void 0})});Nx.displayName="Form";function Px(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function HS(t){let e=x.useContext(dr);return Ie(e,Px(t)),e}function Lx(t,{target:e,replace:n,state:i,preventScrollReset:a,relative:s,viewTransition:r,unstable_defaultShouldRevalidate:o,unstable_useTransitions:l}={}){let c=ru(),u=es(),d=Ho(t,{relative:s});return x.useCallback(f=>{if(fx(f,e)){f.preventDefault();let h=n!==void 0?n:So(u)===So(d),g=()=>c(t,{replace:h,state:i,preventScrollReset:a,relative:s,viewTransition:r,unstable_defaultShouldRevalidate:o});l?x.startTransition(()=>g()):g()}},[u,c,d,n,i,e,t,a,s,r,o,l])}var Ux=0,Ix=()=>`__${String(++Ux)}__`;function jx(){let{router:t}=HS("useSubmit"),{basename:e}=x.useContext(bn),n=nx(),i=t.fetch,a=t.navigate;return x.useCallback(async(s,r={})=>{let{action:o,method:l,encType:c,formData:u,body:d}=px(s,e);if(r.navigate===!1){let f=r.fetcherKey||Ix();await i(f,n,r.action||o,{unstable_defaultShouldRevalidate:r.unstable_defaultShouldRevalidate,preventScrollReset:r.preventScrollReset,formData:u,body:d,formMethod:r.method||l,formEncType:r.encType||c,flushSync:r.flushSync})}else await a(r.action||o,{unstable_defaultShouldRevalidate:r.unstable_defaultShouldRevalidate,preventScrollReset:r.preventScrollReset,formData:u,body:d,formMethod:r.method||l,formEncType:r.encType||c,replace:r.replace,state:r.state,fromRouteId:n,flushSync:r.flushSync,viewTransition:r.viewTransition})},[i,a,e,n])}function Bx(t,{relative:e}={}){let{basename:n}=x.useContext(bn),i=x.useContext(Xn);Ie(i,"useFormAction must be used inside a RouteContext");let[a]=i.matches.slice(-1),s={...Ho(t||".",{relative:e})},r=es();if(t==null){s.search=r.search;let o=new URLSearchParams(s.search),l=o.getAll("index");if(l.some(u=>u==="")){o.delete("index"),l.filter(d=>d).forEach(d=>o.append("index",d));let u=o.toString();s.search=u?`?${u}`:""}}return(!t||t===".")&&a.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(s.pathname=s.pathname==="/"?n:bi([n,s.pathname])),So(s)}function qx(t,{relative:e}={}){let n=x.useContext(NS);Ie(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=HS("useViewTransitionState"),a=Ho(t,{relative:e});if(!n.isTransitioning)return!1;let s=_i(n.currentLocation.pathname,i)||n.currentLocation.pathname,r=_i(n.nextLocation.pathname,i)||n.nextLocation.pathname;return Ec(a.pathname,r)!=null||Ec(a.pathname,s)!=null}/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GS=(...t)=>t.filter((e,n,i)=>!!e&&e.trim()!==""&&i.indexOf(e)===n).join(" ").trim();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zx=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fx=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,i)=>i?i.toUpperCase():n.toLowerCase());/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zg=t=>{const e=Fx(t);return e.charAt(0).toUpperCase()+e.slice(1)};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Vx={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hx=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0;return!1};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gx=x.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:a="",children:s,iconNode:r,...o},l)=>x.createElement("svg",{ref:l,...Vx,width:e,height:e,stroke:t,strokeWidth:i?Number(n)*24/Number(e):n,className:GS("lucide",a),...!s&&!Hx(o)&&{"aria-hidden":"true"},...o},[...r.map(([c,u])=>x.createElement(c,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=(t,e)=>{const n=x.forwardRef(({className:i,...a},s)=>x.createElement(Gx,{ref:s,iconNode:e,className:GS(`lucide-${zx(Zg(t))}`,`lucide-${t}`,i),...a}));return n.displayName=Zg(t),n};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kx=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],Yx=yn("book-open",Kx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qx=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Jx=yn("check",Qx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xx=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Zx=yn("circle-check-big",Xx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wx=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],$x=yn("clock",Wx);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ew=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],tw=yn("dollar-sign",ew);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nw=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],iw=yn("layout-dashboard",nw);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aw=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],sw=yn("lock",aw);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rw=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],ow=yn("message-circle",rw);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lw=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],cw=yn("send",lw);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uw=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],dw=yn("trending-up",uw);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fw=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Wg=yn("user-plus",fw);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hw=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],mw=yn("x",hw),$g=[{id:"teacher1",name:"GM Ana Smith",elo:2450,price:35,classesGiven:42,earnings:1250.5,description:"Especialista en defensa siciliana y finales.",image:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher2",name:"IM Carlos Ruiz",elo:2310,price:25,classesGiven:18,earnings:450,description:"Entrenador tctico para jugadores de club.",image:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher3",name:"WGM Sarah Polgar",elo:2505,price:50,classesGiven:156,earnings:7800,description:"Ex-campeona mundial juvenil. Clases avanzadas.",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"}],ni={TEACHERS:"topchess_teachers",ROOMS:"topchess_rooms"},pe={initialize:()=>{localStorage.getItem(ni.TEACHERS)||localStorage.setItem(ni.TEACHERS,JSON.stringify($g)),localStorage.getItem(ni.ROOMS)||localStorage.setItem(ni.ROOMS,JSON.stringify({}))},getTeachers:()=>{const t=localStorage.getItem(ni.TEACHERS);return t?JSON.parse(t):$g},getTeacherById:t=>pe.getTeachers().find(n=>n.id===t)||null,updateTeacher:(t,e)=>{const n=pe.getTeachers(),i=n.findIndex(a=>a.id===t);return i!==-1?(n[i]={...n[i],...e},localStorage.setItem(ni.TEACHERS,JSON.stringify(n)),n[i]):null},getRoom:t=>JSON.parse(localStorage.getItem(ni.ROOMS)||"{}")[t]||null,updateRoom:(t,e)=>{const n=JSON.parse(localStorage.getItem(ni.ROOMS)||"{}");n[t]={...n[t],...e},localStorage.setItem(ni.ROOMS,JSON.stringify(n)),window.dispatchEvent(new CustomEvent("room-update",{detail:{teacherId:t,data:n[t]}}))},subscribeToRoom:(t,e)=>{const n=a=>{a.detail.teacherId===t&&e(a.detail.data)};window.addEventListener("room-update",n);const i=pe.getRoom(t);return i&&e(i),()=>window.removeEventListener("room-update",n)},createRequest:(t,e,n)=>{const i=JSON.parse(localStorage.getItem("topchess_requests")||"[]"),a=i.find(r=>r.studentId===t&&r.teacherId===e);if(a)return pe.sendMessage(t,e,n,"student"),a;const s={id:Date.now().toString(),studentId:t,teacherId:e,status:"pending",timestamp:Date.now()};return i.push(s),localStorage.setItem("topchess_requests",JSON.stringify(i)),n&&pe.sendMessage(t,e,n,"student"),s},getRequestStatus:(t,e)=>{const i=JSON.parse(localStorage.getItem("topchess_requests")||"[]").find(a=>a.studentId===t&&a.teacherId===e);return i?i.status:null},getRequestsForTeacher:t=>JSON.parse(localStorage.getItem("topchess_requests")||"[]").filter(n=>n.teacherId===t&&n.status==="pending"),updateRequestStatus:(t,e,n)=>{const i=JSON.parse(localStorage.getItem("topchess_requests")||"[]"),a=i.findIndex(s=>s.studentId===t&&s.teacherId===e);return a!==-1?(i[a].status=n,localStorage.setItem("topchess_requests",JSON.stringify(i)),!0):!1},sendMessage:(t,e,n,i)=>{const a=JSON.parse(localStorage.getItem("topchess_messages")||"[]"),s={id:Date.now().toString()+Math.random(),studentId:t,teacherId:e,text:n,sender:i,timestamp:Date.now()};a.push(s),localStorage.setItem("topchess_messages",JSON.stringify(a)),window.dispatchEvent(new CustomEvent("chat-update",{detail:{studentId:t,teacherId:e}}))},getMessages:(t,e)=>JSON.parse(localStorage.getItem("topchess_messages")||"[]").filter(i=>i.studentId===t&&i.teacherId===e).sort((i,a)=>i.timestamp-a.timestamp),subscribeToChat:(t,e,n)=>{const i=a=>{a.detail.studentId===t&&a.detail.teacherId===e&&n(pe.getMessages(t,e))};return window.addEventListener("chat-update",i),()=>window.removeEventListener("chat-update",i)}},pw=()=>{const[t,e]=x.useState([]),{userRole:n}=yi.useContext(is),[i,a]=x.useState(!0),s=[{id:"teacher1",name:"GM Ana Smith",elo:2450,price:35,classesGiven:42,description:"Especialista en defensa siciliana y finales.",image:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher2",name:"IM Carlos Ruiz",elo:2310,price:25,classesGiven:18,description:"Entrenador tctico para jugadores de club.",image:"https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"},{id:"teacher3",name:"WGM Sarah Polgar",elo:2505,price:50,classesGiven:156,description:"Ex-campeona mundial juvenil. Clases avanzadas.",image:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-1.2.1&auto=format&fit=crop&w=256&q=80"}];return x.useEffect(()=>{(async()=>{try{const o=pe.getTeachers();!o||o.length===0?(pe.initialize(),e(pe.getTeachers())):e(o)}catch(o){console.error("Error fetching teachers:",o),e(s)}finally{a(!1)}})()},[]),k.jsxs("div",{className:"min-h-screen",children:[k.jsxs("section",{className:"relative py-20 px-4 mb-16 overflow-hidden",children:[k.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-br from-[#161512] via-[#201e1b] to-[#262421] z-0"}),k.jsxs("div",{className:"relative z-10 max-w-5xl mx-auto text-center",children:[k.jsx("div",{className:"inline-block px-4 py-1.5 mb-6 rounded-full bg-[#bf811d]/10 border border-[#bf811d]/20 text-[#bf811d] text-sm font-semibold tracking-wide uppercase",children:"La Escuela de Ajedrez del Futuro"}),k.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Domina el Tablero ",k.jsx("br",{}),k.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-[#bf811d] to-[#f0d9b5]",children:"Sin Lmites"})]}),k.jsx("p",{className:"text-xl text-[#bababa] max-w-2xl mx-auto mb-10 leading-relaxed",children:"Conectamos a estudiantes apasionados con grandes maestros en aulas virtuales con audio en tiempo real."}),k.jsx("div",{className:"flex gap-4 justify-center",children:k.jsx("button",{className:"bg-[#bf811d] hover:bg-[#a66f19] text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg shadow-orange-900/20",children:"Buscar Profesor"})})]})]}),k.jsxs("div",{className:"max-w-6xl mx-auto px-4 pb-20",children:[k.jsx("h2",{className:"text-3xl font-bold text-white mb-8",children:"Maestros Recomendados"}),i?k.jsx("div",{className:"text-center py-20 text-[#666]",children:"Cargando maestros..."}):k.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:t.map(r=>k.jsxs("div",{className:"bg-[#21201d] border border-[#302e2b] rounded-2xl p-6 hover:border-[#bf811d]/50 transition-all",children:[k.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[k.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-800 overflow-hidden",children:k.jsx("img",{src:r.image,alt:r.name,className:"w-full h-full object-cover"})}),k.jsxs("div",{children:[k.jsx("h3",{className:"text-xl font-bold text-white",children:r.name}),k.jsxs("div",{className:"text-[#bf811d] font-bold text-sm",children:[r.elo," ELO"]})]})]}),k.jsx("p",{className:"text-[#bababa] text-sm mb-4 h-12 overflow-hidden",children:r.description}),k.jsxs("div",{className:"flex justify-between items-center mb-6",children:[k.jsx("span",{className:"text-white font-bold text-lg",children:"Plan Mensual"}),k.jsxs("div",{className:"text-right",children:[k.jsx("div",{className:"text-[#bf811d] font-bold",children:"59 EUR"}),k.jsx("div",{className:"text-xs text-[#666]",children:"$39 USD"})]})]}),n==="student"?k.jsx(ma,{to:`/chat/${r.id}`,className:"block w-full text-center py-3 bg-[#bf811d] text-white font-bold rounded-xl hover:bg-[#a66f19] transition-all shadow-lg hover:shadow-orange-900/40",children:"Contactar Profesor"}):r.id==="teacher1"&&k.jsx(ma,{to:`/room/${r.id}`,className:"block w-full text-center py-3 bg-[#363431] text-white font-bold rounded-xl border border-[#403d39]",children:"Ir al Aula"})]},r.id))})]})]})};var KS={exports:{}},gw="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",vw=gw,bw=vw;function YS(){}function QS(){}QS.resetWarningCache=YS;var yw=function(){function t(i,a,s,r,o,l){if(l!==bw){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:QS,resetWarningCache:YS};return n.PropTypes=n,n};KS.exports=yw();var Sw=KS.exports;const he=uh(Sw),Tw=["white","black"],vm=["a","b","c","d","e","f","g","h"],bm=["1","2","3","4","5","6","7","8"],Cw=[...bm].reverse(),ym=Array.prototype.concat(...vm.map(t=>bm.map(e=>t+e))),ln=t=>ym[8*t[0]+t[1]],He=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],JS=ym.map(He);function kw(t){let e;const n=()=>(e===void 0&&(e=t()),e);return n.clear=()=>{e=void 0},n}const Ew=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const e=performance.now()-t;return t=void 0,e}}},Sm=t=>t==="white"?"black":"white",To=(t,e)=>{const n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i},Pf=(t,e)=>t.role===e.role&&t.color===e.color,XS=(t,e,n,i)=>[(e?t[0]:7-t[0])*n,(e?7-t[1]:t[1])*i],Tm=t=>{const e=t.width/8,n=t.height/8;return(i,a)=>XS(i,a,e,n)},_w=(t,e)=>XS(t,e,100,100),lu=(t,e)=>{t.style.transform=`translate(${e[0]}px,${e[1]}px)`},Rw=(t,e)=>{t.style.transform=`translate(${e[0]}%,${e[1]}%)`},Cm=(t,e)=>{t.style.visibility=e?"visible":"hidden"},ts=t=>{var e;if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(!((e=t.targetTouches)===null||e===void 0)&&e[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},ZS=t=>t.buttons===2||t.button===2,Xi=(t,e)=>{const n=document.createElement(t);return e&&(n.className=e),n};function WS(t,e,n){const i=He(t);return e||(i[0]=7-i[0],i[1]=7-i[1]),[n.left+n.width*i[0]/8+n.width/16,n.top+n.height*(7-i[1])/8+n.height/16]}function Ga(t,e){return Math.abs(t-e)}function xw(t){return(e,n,i,a)=>Ga(e,i)<2&&(t==="white"?a===n+1||n<=1&&a===n+2&&e===i:a===n-1||n>=6&&a===n-2&&e===i)}const $S=(t,e,n,i)=>{const a=Ga(t,n),s=Ga(e,i);return a===1&&s===2||a===2&&s===1},eT=(t,e,n,i)=>Ga(t,n)===Ga(e,i),tT=(t,e,n,i)=>t===n||e===i,nT=(t,e,n,i)=>eT(t,e,n,i)||tT(t,e,n,i);function ww(t,e,n){return(i,a,s,r)=>Ga(i,s)<2&&Ga(a,r)<2||n&&a===r&&a===(t==="white"?0:7)&&(i===4&&(s===2&&e.includes(0)||s===6&&e.includes(7))||e.includes(s))}function Ow(t,e){const n=e==="white"?"1":"8",i=[];for(const[a,s]of t)a[1]===n&&s.color===e&&s.role==="rook"&&i.push(He(a)[0]);return i}function iT(t,e,n){const i=t.get(e);if(!i)return[];const a=He(e),s=i.role,r=s==="pawn"?xw(i.color):s==="knight"?$S:s==="bishop"?eT:s==="rook"?tT:s==="queen"?nT:ww(i.color,Ow(t,i.color),n);return JS.filter(o=>(a[0]!==o[0]||a[1]!==o[1])&&r(a[0],a[1],o[0],o[1])).map(ln)}function qt(t,...e){t&&setTimeout(()=>t(...e),1)}function Aw(t){t.orientation=Sm(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function Mw(t,e){for(const[n,i]of e)i?t.pieces.set(n,i):t.pieces.delete(n)}function Dw(t,e){if(t.check=void 0,e===!0&&(e=t.turnColor),e)for(const[n,i]of t.pieces)i.role==="king"&&i.color===e&&(t.check=n)}function Nw(t,e,n,i){Sa(t),t.premovable.current=[e,n],qt(t.premovable.events.set,e,n,i)}function ya(t){t.premovable.current&&(t.premovable.current=void 0,qt(t.premovable.events.unset))}function Pw(t,e,n){ya(t),t.predroppable.current={role:e,key:n},qt(t.predroppable.events.set,e,n)}function Sa(t){const e=t.predroppable;e.current&&(e.current=void 0,qt(e.events.unset))}function Lw(t,e,n){if(!t.autoCastle)return!1;const i=t.pieces.get(e);if(!i||i.role!=="king")return!1;const a=He(e),s=He(n);if(a[1]!==0&&a[1]!==7||a[1]!==s[1])return!1;a[0]===4&&!t.pieces.has(n)&&(s[0]===6?n=ln([7,s[1]]):s[0]===2&&(n=ln([0,s[1]])));const r=t.pieces.get(n);return!r||r.color!==i.color||r.role!=="rook"?!1:(t.pieces.delete(e),t.pieces.delete(n),a[0]<s[0]?(t.pieces.set(ln([6,s[1]]),i),t.pieces.set(ln([5,s[1]]),r)):(t.pieces.set(ln([2,s[1]]),i),t.pieces.set(ln([3,s[1]]),r)),!0)}function aT(t,e,n){const i=t.pieces.get(e),a=t.pieces.get(n);if(e===n||!i)return!1;const s=a&&a.color!==i.color?a:void 0;return n===t.selected&&gn(t),qt(t.events.move,e,n,s),Lw(t,e,n)||(t.pieces.set(n,i),t.pieces.delete(e)),t.lastMove=[e,n],t.check=void 0,qt(t.events.change),s||!0}function km(t,e,n,i){if(t.pieces.has(n))if(i)t.pieces.delete(n);else return!1;return qt(t.events.dropNewPiece,e,n),t.pieces.set(n,e),t.lastMove=[n],t.check=void 0,qt(t.events.change),t.movable.dests=void 0,t.turnColor=Sm(t.turnColor),!0}function sT(t,e,n){const i=aT(t,e,n);return i&&(t.movable.dests=void 0,t.turnColor=Sm(t.turnColor),t.animation.current=void 0),i}function rT(t,e,n){if(Em(t,e,n)){const i=sT(t,e,n);if(i){const a=t.hold.stop();gn(t);const s={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:a};return i!==!0&&(s.captured=i),qt(t.movable.events.after,e,n,s),!0}}else if(Iw(t,e,n))return Nw(t,e,n,{ctrlKey:t.stats.ctrlKey}),gn(t),!0;return gn(t),!1}function oT(t,e,n,i){const a=t.pieces.get(e);a&&(Uw(t,e,n)||i)?(t.pieces.delete(e),km(t,a,n,i),qt(t.movable.events.afterNewPiece,a.role,n,{premove:!1,predrop:!1})):a&&jw(t,e,n)?Pw(t,a.role,n):(ya(t),Sa(t)),t.pieces.delete(e),gn(t)}function Lf(t,e,n){if(qt(t.events.select,e),t.selected){if(t.selected===e&&!t.draggable.enabled){gn(t),t.hold.cancel();return}else if((t.selectable.enabled||n)&&t.selected!==e&&rT(t,t.selected,e)){t.stats.dragged=!1;return}}(cT(t,e)||_m(t,e))&&(lT(t,e),t.hold.start())}function lT(t,e){t.selected=e,_m(t,e)?t.premovable.dests=iT(t.pieces,e,t.premovable.castle):t.premovable.dests=void 0}function gn(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function cT(t,e){const n=t.pieces.get(e);return!!n&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}function Em(t,e,n){var i,a;return e!==n&&cT(t,e)&&(t.movable.free||!!(!((a=(i=t.movable.dests)===null||i===void 0?void 0:i.get(e))===null||a===void 0)&&a.includes(n)))}function Uw(t,e,n){const i=t.pieces.get(e);return!!i&&(e===n||!t.pieces.has(n))&&(t.movable.color==="both"||t.movable.color===i.color&&t.turnColor===i.color)}function _m(t,e){const n=t.pieces.get(e);return!!n&&t.premovable.enabled&&t.movable.color===n.color&&t.turnColor!==n.color}function Iw(t,e,n){return e!==n&&_m(t,e)&&iT(t.pieces,e,t.premovable.castle).includes(n)}function jw(t,e,n){const i=t.pieces.get(e),a=t.pieces.get(n);return!!i&&(!a||a.color!==t.movable.color)&&t.predroppable.enabled&&(i.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&t.movable.color===i.color&&t.turnColor!==i.color}function Bw(t,e){const n=t.pieces.get(e);return!!n&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===n.color&&(t.turnColor===n.color||t.premovable.enabled))}function qw(t){const e=t.premovable.current;if(!e)return!1;const n=e[0],i=e[1];let a=!1;if(Em(t,n,i)){const s=sT(t,n,i);if(s){const r={premove:!0};s!==!0&&(r.captured=s),qt(t.movable.events.after,n,i,r),a=!0}}return ya(t),a}function zw(t,e){const n=t.predroppable.current;let i=!1;if(!n)return!1;if(e(n)){const a={role:n.role,color:t.movable.color};km(t,a,n.key)&&(qt(t.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),i=!0)}return Sa(t),i}function Rm(t){ya(t),Sa(t),gn(t)}function ev(t){t.movable.color=t.movable.dests=t.animation.current=void 0,Rm(t)}function fr(t,e,n){let i=Math.floor(8*(t[0]-n.left)/n.width);e||(i=7-i);let a=7-Math.floor(8*(t[1]-n.top)/n.height);return e||(a=7-a),i>=0&&i<8&&a>=0&&a<8?ln([i,a]):void 0}function Fw(t,e,n,i){const a=He(t),s=JS.filter(c=>nT(a[0],a[1],c[0],c[1])||$S(a[0],a[1],c[0],c[1])),o=s.map(c=>WS(ln(c),n,i)).map(c=>To(e,c)),[,l]=o.reduce((c,u,d)=>c[0]<u?c:[u,d],[o[0],0]);return ln(s[l])}function Mn(t){return t.orientation==="white"}const uT="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Vw={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Hw={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function dT(t){t==="start"&&(t=uT);const e=new Map;let n=7,i=0;for(const a of t)switch(a){case" ":return e;case"/":if(--n,n<0)return e;i=0;break;case"~":{const s=e.get(ln([i,n]));s&&(s.promoted=!0);break}default:{const s=a.charCodeAt(0);if(s<57)i+=s-48;else{const r=a.toLowerCase();e.set(ln([i,n]),{role:Vw[r],color:a===r?"black":"white"}),++i}}}return e}function Gw(t){return Cw.map(e=>vm.map(n=>{const i=t.get(n+e);if(i){const a=Hw[i.role];return i.color==="white"?a.toUpperCase():a}else return"1"}).join("")).join("/").replace(/1{2,}/g,e=>e.length.toString())}function fT(t,e){var n,i;if(!((n=e.movable)===null||n===void 0)&&n.dests&&(t.movable.dests=void 0),!((i=e.drawable)===null||i===void 0)&&i.autoShapes&&(t.drawable.autoShapes=[]),hT(t,e),e.fen&&(t.pieces=dT(e.fen),t.drawable.shapes=[]),"check"in e&&Dw(t,e.check||!1),"lastMove"in e&&!e.lastMove?t.lastMove=void 0:e.lastMove&&(t.lastMove=e.lastMove),t.selected&&lT(t,t.selected),(!t.animation.duration||t.animation.duration<100)&&(t.animation.enabled=!1),!t.movable.rookCastle&&t.movable.dests){const a=t.movable.color==="white"?"1":"8",s="e"+a,r=t.movable.dests.get(s),o=t.pieces.get(s);if(!r||!o||o.role!=="king")return;t.movable.dests.set(s,r.filter(l=>!(l==="a"+a&&r.includes("c"+a))&&!(l==="h"+a&&r.includes("g"+a))))}}function hT(t,e){for(const n in e)tv(t[n])&&tv(e[n])?hT(t[n],e[n]):t[n]=e[n]}function tv(t){return typeof t=="object"}function Ma(t,e){return e.animation.enabled?Qw(t,e):Li(t,e)}function Li(t,e){const n=t(e);return e.dom.redraw(),n}function rd(t,e){return{key:t,pos:He(t),piece:e}}function Kw(t,e){return e.sort((n,i)=>To(t.pos,n.pos)-To(t.pos,i.pos))[0]}function Yw(t,e){const n=new Map,i=[],a=new Map,s=[],r=[],o=new Map;let l,c,u;for(const[d,f]of t)o.set(d,rd(d,f));for(const d of ym)l=e.pieces.get(d),c=o.get(d),l?c?Pf(l,c.piece)||(s.push(c),r.push(rd(d,l))):r.push(rd(d,l)):c&&s.push(c);for(const d of r)c=Kw(d,s.filter(f=>Pf(d.piece,f.piece))),c&&(u=[c.pos[0]-d.pos[0],c.pos[1]-d.pos[1]],n.set(d.key,u.concat(u)),i.push(c.key));for(const d of s)i.includes(d.key)||a.set(d.key,d.piece);return{anims:n,fadings:a}}function mT(t,e){const n=t.animation.current;if(n===void 0){t.dom.destroyed||t.dom.redrawNow();return}const i=1-(e-n.start)*n.frequency;if(i<=0)t.animation.current=void 0,t.dom.redrawNow();else{const a=Jw(i);for(const s of n.plan.anims.values())s[2]=s[0]*a,s[3]=s[1]*a;t.dom.redrawNow(!0),requestAnimationFrame((s=performance.now())=>mT(t,s))}}function Qw(t,e){const n=new Map(e.pieces),i=t(e),a=Yw(n,e);if(a.anims.size||a.fadings.size){const s=e.animation.current&&e.animation.current.start;e.animation.current={start:performance.now(),frequency:1/e.animation.duration,plan:a},s||mT(e,performance.now())}else e.dom.redraw();return i}function Jw(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}const Xw=["green","red","blue","yellow"];function Zw(t,e){if(e.touches&&e.touches.length>1)return;e.stopPropagation(),e.preventDefault(),e.ctrlKey?gn(t):Rm(t);const n=ts(e),i=fr(n,Mn(t),t.dom.bounds());i&&(t.drawable.current={orig:i,pos:n,brush:tO(e),snapToValidMove:t.drawable.defaultSnapToValidMove},pT(t))}function pT(t){requestAnimationFrame(()=>{const e=t.drawable.current;if(e){const n=fr(e.pos,Mn(t),t.dom.bounds());n||(e.snapToValidMove=!1);const i=e.snapToValidMove?Fw(e.orig,e.pos,Mn(t),t.dom.bounds()):n;i!==e.mouseSq&&(e.mouseSq=i,e.dest=i!==e.orig?i:void 0,t.dom.redrawNow()),pT(t)}})}function Ww(t,e){t.drawable.current&&(t.drawable.current.pos=ts(e))}function $w(t){const e=t.drawable.current;e&&(e.mouseSq&&nO(t.drawable,e),gT(t))}function gT(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function eO(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),vT(t.drawable))}function tO(t){var e;const n=(t.shiftKey||t.ctrlKey)&&ZS(t),i=t.altKey||t.metaKey||((e=t.getModifierState)===null||e===void 0?void 0:e.call(t,"AltGraph"));return Xw[(n?1:0)+(i?2:0)]}function nO(t,e){const n=a=>a.orig===e.orig&&a.dest===e.dest,i=t.shapes.find(n);i&&(t.shapes=t.shapes.filter(a=>!n(a))),(!i||i.brush!==e.brush)&&t.shapes.push(e),vT(t)}function vT(t){t.onChange&&t.onChange(t.shapes)}function iO(t,e){if(!e.isTrusted||e.button!==void 0&&e.button!==0||e.touches&&e.touches.length>1)return;const n=t.dom.bounds(),i=ts(e),a=fr(i,Mn(t),n);if(!a)return;const s=t.pieces.get(a),r=t.selected;!r&&t.drawable.enabled&&(t.drawable.eraseOnClick||!s||s.color!==t.turnColor)&&eO(t),e.cancelable!==!1&&(!e.touches||!t.movable.color||s||r||aO(t,i))&&e.preventDefault();const o=!!t.premovable.current,l=!!t.predroppable.current;t.stats.ctrlKey=e.ctrlKey,t.selected&&Em(t,t.selected,a)?Ma(d=>Lf(d,a),t):Lf(t,a);const c=t.selected===a,u=yT(t,a);if(s&&u&&c&&Bw(t,a)){t.draggable.current={orig:a,piece:s,origPos:i,pos:i,started:t.draggable.autoDistance&&t.stats.dragged,element:u,previouslySelected:r,originTarget:e.target},u.cgDragging=!0,u.classList.add("dragging");const d=t.dom.elements.ghost;d&&(d.className=`ghost ${s.color} ${s.role}`,lu(d,Tm(n)(He(a),Mn(t))),Cm(d,!0)),xm(t)}else o&&ya(t),l&&Sa(t);t.dom.redraw()}function aO(t,e){const n=Mn(t),i=t.dom.bounds(),a=Math.pow(i.width/8,2);for(const s in t.pieces){const r=WS(s,n,i);if(To(r,e)<=a)return!0}return!1}function sO(t,e,n,i){const a="a0";t.pieces.set(a,e),t.dom.redraw();const s=ts(n);t.draggable.current={orig:a,piece:e,origPos:s,pos:s,started:!0,element:()=>yT(t,a),originTarget:n.target,newPiece:!0,force:!!i},xm(t)}function xm(t){requestAnimationFrame(()=>{var e;const n=t.draggable.current;if(!n)return;!((e=t.animation.current)===null||e===void 0)&&e.plan.anims.has(n.orig)&&(t.animation.current=void 0);const i=t.pieces.get(n.orig);if(!i||!Pf(i,n.piece))_c(t);else if(!n.started&&To(n.pos,n.origPos)>=Math.pow(t.draggable.distance,2)&&(n.started=!0),n.started){if(typeof n.element=="function"){const s=n.element();if(!s)return;s.cgDragging=!0,s.classList.add("dragging"),n.element=s}const a=t.dom.bounds();lu(n.element,[n.pos[0]-a.left-a.width/16,n.pos[1]-a.top-a.height/16])}xm(t)})}function rO(t,e){t.draggable.current&&(!e.touches||e.touches.length<2)&&(t.draggable.current.pos=ts(e))}function oO(t,e){const n=t.draggable.current;if(!n)return;if(e.type==="touchend"&&e.cancelable!==!1&&e.preventDefault(),e.type==="touchend"&&n.originTarget!==e.target&&!n.newPiece){t.draggable.current=void 0;return}ya(t),Sa(t);const i=ts(e)||n.pos,a=fr(i,Mn(t),t.dom.bounds());a&&n.started&&n.orig!==a?n.newPiece?oT(t,n.orig,a,n.force):(t.stats.ctrlKey=e.ctrlKey,rT(t,n.orig,a)&&(t.stats.dragged=!0)):n.newPiece?t.pieces.delete(n.orig):t.draggable.deleteOnDropOff&&!a&&(t.pieces.delete(n.orig),qt(t.events.change)),n.orig===n.previouslySelected&&(n.orig===a||!a)?gn(t):t.selectable.enabled||gn(t),bT(t),t.draggable.current=void 0,t.dom.redraw()}function _c(t){const e=t.draggable.current;e&&(e.newPiece&&t.pieces.delete(e.orig),t.draggable.current=void 0,gn(t),bT(t),t.dom.redraw())}function bT(t){const e=t.dom.elements;e.ghost&&Cm(e.ghost,!1)}function yT(t,e){let n=t.dom.elements.board.firstChild;for(;n;){if(n.cgKey===e&&n.tagName==="PIECE")return n;n=n.nextSibling}}function lO(t,e){t.exploding={stage:1,keys:e},t.dom.redraw(),setTimeout(()=>{nv(t,2),setTimeout(()=>nv(t,void 0),120)},120)}function nv(t,e){t.exploding&&(e?t.exploding.stage=e:t.exploding=void 0,t.dom.redraw())}function cO(t,e){function n(){Aw(t),e()}return{set(i){i.orientation&&i.orientation!==t.orientation&&n(),(i.fen?Ma:Li)(a=>fT(a,i),t)},state:t,getFen:()=>Gw(t.pieces),toggleOrientation:n,setPieces(i){Ma(a=>Mw(a,i),t)},selectSquare(i,a){i?Ma(s=>Lf(s,i,a),t):t.selected&&(gn(t),t.dom.redraw())},move(i,a){Ma(s=>aT(s,i,a),t)},newPiece(i,a){Ma(s=>km(s,i,a),t)},playPremove(){if(t.premovable.current){if(Ma(qw,t))return!0;t.dom.redraw()}return!1},playPredrop(i){if(t.predroppable.current){const a=zw(t,i);return t.dom.redraw(),a}return!1},cancelPremove(){Li(ya,t)},cancelPredrop(){Li(Sa,t)},cancelMove(){Li(i=>{Rm(i),_c(i)},t)},stop(){Li(i=>{ev(i),_c(i)},t)},explode(i){lO(t,i)},setAutoShapes(i){Li(a=>a.drawable.autoShapes=i,t)},setShapes(i){Li(a=>a.drawable.shapes=i,t)},getKeyAtDomPos(i){return fr(i,Mn(t),t.dom.bounds())},redrawAll:e,dragNewPiece(i,a,s){sO(t,i,a,s)},destroy(){ev(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function uO(){return{pieces:dT(uT),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:Ew()}}function fn(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function iv(t,e,n){const i=t.drawable,a=i.current,s=a&&a.mouseSq?a:void 0,r=new Map,o=t.dom.bounds();for(const h of i.shapes.concat(i.autoShapes).concat(s?[s]:[]))h.dest&&r.set(h.dest,(r.get(h.dest)||0)+1);const l=i.shapes.concat(i.autoShapes).map(h=>({shape:h,current:!1,hash:sv(h,r,!1,o)}));s&&l.push({shape:s,current:!0,hash:sv(s,r,!0,o)});const c=l.map(h=>h.hash).join(";");if(c===t.drawable.prevSvgHash)return;t.drawable.prevSvgHash=c;const u=e.querySelector("defs"),d=e.querySelector("g"),f=n.querySelector("g");dO(i,l,u),av(t,l.filter(h=>!h.shape.customSvg),i.brushes,r,d),av(t,l.filter(h=>h.shape.customSvg),i.brushes,r,f)}function dO(t,e,n){const i=new Map;let a;for(const o of e)o.shape.dest&&(a=t.brushes[o.shape.brush],o.shape.modifiers&&(a=ST(a,o.shape.modifiers)),i.set(a.key,a));const s=new Set;let r=n.firstChild;for(;r;)s.add(r.getAttribute("cgKey")),r=r.nextSibling;for(const[o,l]of i.entries())s.has(o)||n.appendChild(SO(l))}function av(t,e,n,i,a){const s=t.dom.bounds(),r=new Map,o=[];for(const u of e)r.set(u.hash,!1);let l=a.firstChild,c;for(;l;)c=l.getAttribute("cgHash"),r.has(c)?r.set(c,!0):o.push(l),l=l.nextSibling;for(const u of o)a.removeChild(u);for(const u of e)r.get(u.hash)||a.appendChild(pO(t,u,n,i,s))}function sv({orig:t,dest:e,brush:n,piece:i,modifiers:a,customSvg:s},r,o,l){return[l.width,l.height,o,t,e,n,e&&(r.get(e)||0)>1,i&&fO(i),a&&hO(a),s&&mO(s)].filter(c=>c).join(",")}function fO(t){return[t.color,t.role,t.scale].filter(e=>e).join(",")}function hO(t){return""+(t.lineWidth||"")}function mO(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n)>>>0;return"custom-"+e.toString()}function pO(t,{shape:e,current:n,hash:i},a,s,r){let o;if(e.customSvg){const l=dl(He(e.orig),t.orientation);o=gO(e.customSvg,l,r)}else if(e.piece)o=yO(t.drawable.pieces.baseUrl,dl(He(e.orig),t.orientation),e.piece,r);else{const l=dl(He(e.orig),t.orientation);if(e.dest){let c=a[e.brush];e.modifiers&&(c=ST(c,e.modifiers)),o=bO(c,l,dl(He(e.dest),t.orientation),n,(s.get(e.dest)||0)>1,r)}else o=vO(a[e.brush],l,n,r)}return o.setAttribute("cgHash",i),o}function gO(t,e,n){const{width:i,height:a}=n,s=i/8,r=a/8,o=e[0]*s,l=(7-e[1])*r,c=Ri(fn("g"),{transform:`translate(${o},${l})`}),u=Ri(fn("svg"),{width:s,height:r,viewBox:"0 0 100 100"});return c.appendChild(u),u.innerHTML=t,c}function vO(t,e,n,i){const a=Rc(e,i),s=TO(i),r=(i.width+i.height)/32;return Ri(fn("circle"),{stroke:t.color,"stroke-width":s[n?0:1],fill:"none",opacity:TT(t,n),cx:a[0],cy:a[1],r:r-s[1]/2})}function bO(t,e,n,i,a,s){const r=kO(s,a&&!i),o=Rc(e,s),l=Rc(n,s),c=l[0]-o[0],u=l[1]-o[1],d=Math.atan2(u,c),f=Math.cos(d)*r,h=Math.sin(d)*r;return Ri(fn("line"),{stroke:t.color,"stroke-width":CO(t,i,s),"stroke-linecap":"round","marker-end":"url(#arrowhead-"+t.key+")",opacity:TT(t,i),x1:o[0],y1:o[1],x2:l[0]-f,y2:l[1]-h})}function yO(t,e,n,i){const a=Rc(e,i),s=i.width/8*(n.scale||1),r=n.color[0]+(n.role==="knight"?"n":n.role[0]).toUpperCase();return Ri(fn("image"),{className:`${n.role} ${n.color}`,x:a[0]-s/2,y:a[1]-s/2,width:s,height:s,href:t+r+".svg"})}function SO(t){const e=Ri(fn("marker"),{id:"arrowhead-"+t.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return e.appendChild(Ri(fn("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),e.setAttribute("cgKey",t.key),e}function Ri(t,e){for(const n in e)t.setAttribute(n,e[n]);return t}function dl(t,e){return e==="white"?t:[7-t[0],7-t[1]]}function ST(t,e){return{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(e.lineWidth||t.lineWidth),key:[t.key,e.lineWidth].filter(n=>n).join("")}}function TO(t){const e=t.width/512;return[3*e,4*e]}function CO(t,e,n){return(t.lineWidth||10)*(e?.85:1)/512*n.width}function TT(t,e){return(t.opacity||1)*(e?.9:1)}function kO(t,e){return(e?20:10)/512*t.width}function Rc(t,e){return[(t[0]+.5)*e.width/8,(7.5-t[1])*e.height/8]}function EO(t,e,n){t.innerHTML="",t.classList.add("cg-wrap");for(const c of Tw)t.classList.toggle("orientation-"+c,e.orientation===c);t.classList.toggle("manipulable",!e.viewOnly);const i=Xi("cg-helper");t.appendChild(i);const a=Xi("cg-container");i.appendChild(a);const s=Xi("cg-board");a.appendChild(s);let r,o;if(e.drawable.visible&&!n&&(r=Ri(fn("svg"),{class:"cg-shapes"}),r.appendChild(fn("defs")),r.appendChild(fn("g")),o=Ri(fn("svg"),{class:"cg-custom-svgs"}),o.appendChild(fn("g")),a.appendChild(r),a.appendChild(o)),e.coordinates){const c=e.orientation==="black"?" black":"";a.appendChild(rv(bm,"ranks"+c)),a.appendChild(rv(vm,"files"+c))}let l;return e.draggable.showGhost&&!n&&(l=Xi("piece","ghost"),Cm(l,!1),a.appendChild(l)),{board:s,container:a,ghost:l,svg:r,customSvg:o}}function rv(t,e){const n=Xi("coords",e);let i;for(const a of t)i=Xi("coord"),i.textContent=a,n.appendChild(i);return n}function _O(t,e){if(!t.dropmode.active)return;ya(t),Sa(t);const n=t.dropmode.piece;if(n){t.pieces.set("a0",n);const i=ts(e),a=i&&fr(i,Mn(t),t.dom.bounds());a&&oT(t,"a0",a)}t.dom.redraw()}function RO(t,e){const n=t.dom.elements.board;if(!t.dom.relative&&t.resizable&&"ResizeObserver"in window&&new window.ResizeObserver(e).observe(n),t.viewOnly)return;const i=wO(t);n.addEventListener("touchstart",i,{passive:!1}),n.addEventListener("mousedown",i,{passive:!1}),(t.disableContextMenu||t.drawable.enabled)&&n.addEventListener("contextmenu",a=>a.preventDefault())}function xO(t,e){const n=[];if(!t.dom.relative&&t.resizable&&!("ResizeObserver"in window)&&n.push(kr(document.body,"chessground.resize",e)),!t.viewOnly){const i=ov(t,rO,Ww),a=ov(t,oO,$w);for(const r of["touchmove","mousemove"])n.push(kr(document,r,i));for(const r of["touchend","mouseup"])n.push(kr(document,r,a));const s=()=>t.dom.bounds.clear();n.push(kr(document,"scroll",s,{capture:!0,passive:!0})),n.push(kr(window,"resize",s,{passive:!0}))}return()=>n.forEach(i=>i())}function kr(t,e,n,i){return t.addEventListener(e,n,i),()=>t.removeEventListener(e,n,i)}function wO(t){return e=>{t.draggable.current?_c(t):t.drawable.current?gT(t):e.shiftKey||ZS(e)?t.drawable.enabled&&Zw(t,e):t.viewOnly||(t.dropmode.active?_O(t,e):iO(t,e))}}function ov(t,e,n){return i=>{t.drawable.current?t.drawable.enabled&&n(t,i):t.viewOnly||e(t,i)}}function OO(t){const e=Mn(t),n=t.dom.relative?_w:Tm(t.dom.bounds()),i=t.dom.relative?Rw:lu,a=t.dom.elements.board,s=t.pieces,r=t.animation.current,o=r?r.plan.anims:new Map,l=r?r.plan.fadings:new Map,c=t.draggable.current,u=MO(t),d=new Set,f=new Set,h=new Map,g=new Map;let y,T,m,p,v,b,C,_,w,P;for(T=a.firstChild;T;){if(y=T.cgKey,CT(T))if(m=s.get(y),v=o.get(y),b=l.get(y),p=T.cgPiece,T.cgDragging&&(!c||c.orig!==y)&&(T.classList.remove("dragging"),i(T,n(He(y),e)),T.cgDragging=!1),!b&&T.cgFading&&(T.cgFading=!1,T.classList.remove("fading")),m){if(v&&T.cgAnimating&&p===Er(m)){const O=He(y);O[0]+=v[2],O[1]+=v[3],T.classList.add("anim"),i(T,n(O,e))}else T.cgAnimating&&(T.cgAnimating=!1,T.classList.remove("anim"),i(T,n(He(y),e)),t.addPieceZIndex&&(T.style.zIndex=od(He(y),e)));p===Er(m)&&(!b||!T.cgFading)?d.add(y):b&&p===Er(b)?(T.classList.add("fading"),T.cgFading=!0):ld(h,p,T)}else ld(h,p,T);else if(kT(T)){const O=T.className;u.get(y)===O?f.add(y):ld(g,O,T)}T=T.nextSibling}for(const[O,N]of u)if(!f.has(O)){w=g.get(N),P=w&&w.pop();const z=n(He(O),e);if(P)P.cgKey=O,i(P,z);else{const G=Xi("square",N);G.cgKey=O,i(G,z),a.insertBefore(G,a.firstChild)}}for(const[O,N]of s)if(v=o.get(O),!d.has(O))if(C=h.get(Er(N)),_=C&&C.pop(),_){_.cgKey=O,_.cgFading&&(_.classList.remove("fading"),_.cgFading=!1);const z=He(O);t.addPieceZIndex&&(_.style.zIndex=od(z,e)),v&&(_.cgAnimating=!0,_.classList.add("anim"),z[0]+=v[2],z[1]+=v[3]),i(_,n(z,e))}else{const z=Er(N),G=Xi("piece",z),de=He(O);G.cgPiece=z,G.cgKey=O,v&&(G.cgAnimating=!0,de[0]+=v[2],de[1]+=v[3]),i(G,n(de,e)),t.addPieceZIndex&&(G.style.zIndex=od(de,e)),a.appendChild(G)}for(const O of h.values())lv(t,O);for(const O of g.values())lv(t,O)}function AO(t){if(t.dom.relative)return;const e=Mn(t),n=Tm(t.dom.bounds());let i=t.dom.elements.board.firstChild;for(;i;)(CT(i)&&!i.cgAnimating||kT(i))&&lu(i,n(He(i.cgKey),e)),i=i.nextSibling}function CT(t){return t.tagName==="PIECE"}function kT(t){return t.tagName==="SQUARE"}function lv(t,e){for(const n of e)t.dom.elements.board.removeChild(n)}function od(t,e){let n=2+t[1]*8+(7-t[0]);return e&&(n=67-n),n+""}function Er(t){return`${t.color} ${t.role}`}function MO(t){var e;const n=new Map;if(t.lastMove&&t.highlight.lastMove)for(const s of t.lastMove)Ai(n,s,"last-move");if(t.check&&t.highlight.check&&Ai(n,t.check,"check"),t.selected&&(Ai(n,t.selected,"selected"),t.movable.showDests)){const s=(e=t.movable.dests)===null||e===void 0?void 0:e.get(t.selected);if(s)for(const o of s)Ai(n,o,"move-dest"+(t.pieces.has(o)?" oc":""));const r=t.premovable.dests;if(r)for(const o of r)Ai(n,o,"premove-dest"+(t.pieces.has(o)?" oc":""))}const i=t.premovable.current;if(i)for(const s of i)Ai(n,s,"current-premove");else t.predroppable.current&&Ai(n,t.predroppable.current.key,"current-premove");const a=t.exploding;if(a)for(const s of a.keys)Ai(n,s,"exploding"+a.stage);return n}function Ai(t,e,n){const i=t.get(e);i?t.set(e,`${i} ${n}`):t.set(e,n)}function ld(t,e,n){const i=t.get(e);i?i.push(n):t.set(e,[n])}function DO(t,e){const n=uO();fT(n,e||{});function i(){const a="dom"in n?n.dom.unbind:void 0,s=n.viewOnly&&!n.drawable.visible,r=EO(t,n,s),o=kw(()=>r.board.getBoundingClientRect()),l=d=>{OO(u),!d&&r.svg&&iv(u,r.svg,r.customSvg)},c=()=>{o.clear(),AO(u),r.svg&&iv(u,r.svg,r.customSvg)},u=n;return u.dom={elements:r,bounds:o,redraw:NO(l),redrawNow:l,unbind:a,relative:s},u.drawable.prevSvgHash="",l(!1),RO(u,c),a||(u.dom.unbind=xO(u,c)),u.events.insert&&u.events.insert(r),u}return cO(i(),i)}function NO(t){let e=!1;return()=>{e||(e=!0,requestAnimationFrame(()=>{t(),e=!1}))}}function xc(){return xc=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},xc.apply(this,arguments)}function PO(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function ET(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var wm=function(t){PO(e,t);function e(){return t.apply(this,arguments)||this}var n=e.prototype;return n.buildConfigFromProps=function(a){var s={events:{}};return Object.keys(e.propTypes).forEach(function(r){var o=a[r];if(typeof o<"u"){var l=r.match(/^on([A-Z]\S*)/);l?s.events[l[1].toLowerCase()]=o:s[r]=o}}),s},n.componentDidMount=function(){this.cg=DO(this.el,this.buildConfigFromProps(this.props))},n.componentWillReceiveProps=function(a){this.cg.set(this.buildConfigFromProps(a))},n.componentWillUnmount=function(){this.cg.destroy()},n.render=function(){var a=this,s={style:xc({},this.props.style)};return this.props.width&&(s.style.width=this.props.width),this.props.height&&(s.style.height=this.props.height),yi.createElement("div",xc({ref:function(o){return a.el=o}},s))},e}(yi.Component);ET(wm,"propTypes",{width:he.oneOfType([he.string,he.number]),height:he.oneOfType([he.string,he.number]),fen:he.string,orientation:he.string,turnColor:he.string,check:he.string,lastMove:he.array,selected:he.string,coordinates:he.bool,autoCastle:he.bool,viewOnly:he.bool,disableContextMenu:he.bool,resizable:he.bool,addPieceZIndex:he.bool,highlight:he.object,animation:he.object,movable:he.object,premovable:he.object,predroppable:he.object,draggable:he.object,selectable:he.object,onChange:he.func,onMove:he.func,onDropNewPiece:he.func,onSelect:he.func,items:he.object,drawable:he.object});ET(wm,"defaultProps",{coordinates:!0,resizable:!0,highlight:{lastMove:!0,check:!0}});const LO=Object.freeze(Object.defineProperty({__proto__:null,default:wm},Symbol.toStringTag,{value:"Module"})),UO=h1(LO);var IO=UO;const jO=uh(IO);function BO(t){return t!==null?{comment:t,variations:[]}:{variations:[]}}function qO(t,e,n,i,a){const s={move:t,variations:a};return e&&(s.suffix=e),n&&(s.nag=n),i!==null&&(s.comment=i),s}function zO(...t){const[e,...n]=t;let i=e;for(const a of n)a!==null&&(i.variations=[a,...a.variations],a.variations=[],i=a);return e}function FO(t,e){if(e.marker&&e.marker.comment){let n=e.root;for(;;){const i=n.variations[0];if(!i){n.comment=e.marker.comment;break}n=i}}return{headers:t,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function VO(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function $s(t,e,n,i){var a=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(a,$s.prototype),a.expected=e,a.found=n,a.location=i,a.name="SyntaxError",a}VO($s,Error);function cd(t,e,n){return n=n||" ",t.length>e?t:(e-=t.length,n+=n.repeat(e),t+n.slice(0,e))}$s.prototype.format=function(t){var e="Error: "+this.message;if(this.location){var n=null,i;for(i=0;i<t.length;i++)if(t[i].source===this.location.source){n=t[i].text.split(/\r\n|\n|\r/g);break}var a=this.location.start,s=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(a):a,r=this.location.source+":"+s.line+":"+s.column;if(n){var o=this.location.end,l=cd("",s.line.toString().length," "),c=n[a.line-1],u=a.line===o.line?o.column:c.length+1,d=u-a.column||1;e+=`
 --> `+r+`
`+l+` |
`+s.line+" | "+c+`
`+l+" | "+cd("",a.column-1," ")+cd("",d,"^")}else e+=`
 at `+r}return e};$s.buildMessage=function(t,e){var n={literal:function(c){return'"'+a(c.text)+'"'},class:function(c){var u=c.parts.map(function(d){return Array.isArray(d)?s(d[0])+"-"+s(d[1]):s(d)});return"["+(c.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function i(c){return c.charCodeAt(0).toString(16).toUpperCase()}function a(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function s(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function r(c){return n[c.type](c)}function o(c){var u=c.map(r),d,f;if(u.sort(),u.length>0){for(d=1,f=1;d<u.length;d++)u[d-1]!==u[d]&&(u[f]=u[d],f++);u.length=f}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}function l(c){return c?'"'+a(c)+'"':"end of input"}return"Expected "+o(t)+" but "+l(e)+" found."};function HO(t,e){e=e!==void 0?e:{};var n={},i=e.grammarSource,a={pgn:dp},s=dp,r="[",o='"',l="]",c=".",u="O-O-O",d="O-O",f="0-0-0",h="0-0",g="$",y="{",T="}",m=";",p="(",v=")",b="1-0",C="0-1",_="1/2-1/2",w="*",P=/^[a-zA-Z]/,O=/^[^"]/,N=/^[0-9]/,z=/^[.]/,G=/^[a-zA-Z1-8\-=]/,de=/^[+#]/,at=/^[!?]/,At=/^[^}]/,q=/^[^\r\n]/,X=/^[ \t\r\n]/,ee=en("tag pair"),Ee=st("[",!1),Oe=st('"',!1),Pn=st("]",!1),Ln=en("tag name"),Sn=In([["a","z"],["A","Z"]],!1,!1),Tn=en("tag value"),Un=In(['"'],!0,!1),hr=en("move number"),Go=In([["0","9"]],!1,!1),bk=st(".",!1),ip=In(["."],!1,!1),yk=en("standard algebraic notation"),Sk=st("O-O-O",!1),Tk=st("O-O",!1),Ck=st("0-0-0",!1),kk=st("0-0",!1),ap=In([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),Ek=In(["+","#"],!1,!1),_k=en("suffix annotation"),sp=In(["!","?"],!1,!1),Rk=en("NAG"),xk=st("$",!1),wk=en("brace comment"),Ok=st("{",!1),rp=In(["}"],!0,!1),Ak=st("}",!1),Mk=en("rest of line comment"),Dk=st(";",!1),op=In(["\r",`
`],!0,!1),Nk=en("variation"),Pk=st("(",!1),Lk=st(")",!1),Uk=en("game termination marker"),Ik=st("1-0",!1),jk=st("0-1",!1),Bk=st("1/2-1/2",!1),qk=st("*",!1),zk=en("whitespace"),lp=In([" ","	","\r",`
`],!1,!1),Fk=function(R,M){return FO(R,M)},Vk=function(R){return Object.fromEntries(R)},Hk=function(R,M){return[R,M]},Gk=function(R,M){return{root:R,marker:M}},Kk=function(R,M){return zO(BO(R),...M.flat())},Yk=function(R,M,D,Y,Q){return qO(R,M,D,Y,Q)},Qk=function(R){return R},Jk=function(R){return R.replace(/[\r\n]+/g," ")},Xk=function(R){return R.trim()},Zk=function(R){return R},Wk=function(R,M){return{result:R,comment:M}},A=e.peg$currPos|0,as=[{line:1,column:1}],Cn=A,Ko=e.peg$maxFailExpected||[],H=e.peg$silentFails|0,mr;if(e.startRule){if(!(e.startRule in a))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');s=a[e.startRule]}function st(R,M){return{type:"literal",text:R,ignoreCase:M}}function In(R,M,D){return{type:"class",parts:R,inverted:M,ignoreCase:D}}function $k(){return{type:"end"}}function en(R){return{type:"other",description:R}}function cp(R){var M=as[R],D;if(M)return M;if(R>=as.length)D=as.length-1;else for(D=R;!as[--D];);for(M=as[D],M={line:M.line,column:M.column};D<R;)t.charCodeAt(D)===10?(M.line++,M.column=1):M.column++,D++;return as[R]=M,M}function up(R,M,D){var Y=cp(R),Q=cp(M),be={source:i,start:{offset:R,line:Y.line,column:Y.column},end:{offset:M,line:Q.line,column:Q.column}};return be}function K(R){A<Cn||(A>Cn&&(Cn=A,Ko=[]),Ko.push(R))}function e1(R,M,D){return new $s($s.buildMessage(R,M),R,M,D)}function dp(){var R,M,D;return R=A,M=t1(),D=a1(),R=Fk(M,D),R}function t1(){var R,M,D;for(R=A,M=[],D=fp();D!==n;)M.push(D),D=fp();return D=Ct(),R=Vk(M),R}function fp(){var R,M,D,Y,Q,be,Ea;return H++,R=A,Ct(),t.charCodeAt(A)===91?(M=r,A++):(M=n,H===0&&K(Ee)),M!==n?(Ct(),D=n1(),D!==n?(Ct(),t.charCodeAt(A)===34?(Y=o,A++):(Y=n,H===0&&K(Oe)),Y!==n?(Q=i1(),t.charCodeAt(A)===34?(be=o,A++):(be=n,H===0&&K(Oe)),be!==n?(Ct(),t.charCodeAt(A)===93?(Ea=l,A++):(Ea=n,H===0&&K(Pn)),Ea!==n?R=Hk(D,Q):(A=R,R=n)):(A=R,R=n)):(A=R,R=n)):(A=R,R=n)):(A=R,R=n),H--,R===n&&H===0&&K(ee),R}function n1(){var R,M,D;if(H++,R=A,M=[],D=t.charAt(A),P.test(D)?A++:(D=n,H===0&&K(Sn)),D!==n)for(;D!==n;)M.push(D),D=t.charAt(A),P.test(D)?A++:(D=n,H===0&&K(Sn));else M=n;return M!==n?R=t.substring(R,A):R=M,H--,R===n&&(M=n,H===0&&K(Ln)),R}function i1(){var R,M,D;for(H++,R=A,M=[],D=t.charAt(A),O.test(D)?A++:(D=n,H===0&&K(Un));D!==n;)M.push(D),D=t.charAt(A),O.test(D)?A++:(D=n,H===0&&K(Un));return R=t.substring(R,A),H--,M=n,H===0&&K(Tn),R}function a1(){var R,M,D;return R=A,M=hp(),Ct(),D=u1(),D===n&&(D=null),Ct(),R=Gk(M,D),R}function hp(){var R,M,D,Y;for(R=A,M=yu(),M===n&&(M=null),D=[],Y=mp();Y!==n;)D.push(Y),Y=mp();return R=Kk(M,D),R}function mp(){var R,M,D,Y,Q,be,Ea,Yo;if(R=A,Ct(),s1(),Ct(),M=r1(),M!==n){for(D=o1(),D===n&&(D=null),Y=[],Q=pp();Q!==n;)Y.push(Q),Q=pp();for(Q=Ct(),be=yu(),be===n&&(be=null),Ea=[],Yo=gp();Yo!==n;)Ea.push(Yo),Yo=gp();R=Yk(M,D,Y,be,Ea)}else A=R,R=n;return R}function s1(){var R,M,D,Y,Q,be;for(H++,R=A,M=[],D=t.charAt(A),N.test(D)?A++:(D=n,H===0&&K(Go));D!==n;)M.push(D),D=t.charAt(A),N.test(D)?A++:(D=n,H===0&&K(Go));if(t.charCodeAt(A)===46?(D=c,A++):(D=n,H===0&&K(bk)),D!==n){for(Y=Ct(),Q=[],be=t.charAt(A),z.test(be)?A++:(be=n,H===0&&K(ip));be!==n;)Q.push(be),be=t.charAt(A),z.test(be)?A++:(be=n,H===0&&K(ip));M=[M,D,Y,Q],R=M}else A=R,R=n;return H--,R===n&&(M=n,H===0&&K(hr)),R}function r1(){var R,M,D,Y,Q,be;if(H++,R=A,M=A,t.substr(A,5)===u?(D=u,A+=5):(D=n,H===0&&K(Sk)),D===n&&(t.substr(A,3)===d?(D=d,A+=3):(D=n,H===0&&K(Tk)),D===n&&(t.substr(A,5)===f?(D=f,A+=5):(D=n,H===0&&K(Ck)),D===n&&(t.substr(A,3)===h?(D=h,A+=3):(D=n,H===0&&K(kk)),D===n))))if(D=A,Y=t.charAt(A),P.test(Y)?A++:(Y=n,H===0&&K(Sn)),Y!==n){if(Q=[],be=t.charAt(A),G.test(be)?A++:(be=n,H===0&&K(ap)),be!==n)for(;be!==n;)Q.push(be),be=t.charAt(A),G.test(be)?A++:(be=n,H===0&&K(ap));else Q=n;Q!==n?(Y=[Y,Q],D=Y):(A=D,D=n)}else A=D,D=n;return D!==n?(Y=t.charAt(A),de.test(Y)?A++:(Y=n,H===0&&K(Ek)),Y===n&&(Y=null),D=[D,Y],M=D):(A=M,M=n),M!==n?R=t.substring(R,A):R=M,H--,R===n&&(M=n,H===0&&K(yk)),R}function o1(){var R,M,D;for(H++,R=A,M=[],D=t.charAt(A),at.test(D)?A++:(D=n,H===0&&K(sp));D!==n;)M.push(D),M.length>=2?D=n:(D=t.charAt(A),at.test(D)?A++:(D=n,H===0&&K(sp)));return M.length<1?(A=R,R=n):R=M,H--,R===n&&(M=n,H===0&&K(_k)),R}function pp(){var R,M,D,Y,Q;if(H++,R=A,Ct(),t.charCodeAt(A)===36?(M=g,A++):(M=n,H===0&&K(xk)),M!==n){if(D=A,Y=[],Q=t.charAt(A),N.test(Q)?A++:(Q=n,H===0&&K(Go)),Q!==n)for(;Q!==n;)Y.push(Q),Q=t.charAt(A),N.test(Q)?A++:(Q=n,H===0&&K(Go));else Y=n;Y!==n?D=t.substring(D,A):D=Y,D!==n?R=Qk(D):(A=R,R=n)}else A=R,R=n;return H--,R===n&&H===0&&K(Rk),R}function yu(){var R;return R=l1(),R===n&&(R=c1()),R}function l1(){var R,M,D,Y,Q;if(H++,R=A,t.charCodeAt(A)===123?(M=y,A++):(M=n,H===0&&K(Ok)),M!==n){for(D=A,Y=[],Q=t.charAt(A),At.test(Q)?A++:(Q=n,H===0&&K(rp));Q!==n;)Y.push(Q),Q=t.charAt(A),At.test(Q)?A++:(Q=n,H===0&&K(rp));D=t.substring(D,A),t.charCodeAt(A)===125?(Y=T,A++):(Y=n,H===0&&K(Ak)),Y!==n?R=Jk(D):(A=R,R=n)}else A=R,R=n;return H--,R===n&&(M=n,H===0&&K(wk)),R}function c1(){var R,M,D,Y,Q;if(H++,R=A,t.charCodeAt(A)===59?(M=m,A++):(M=n,H===0&&K(Dk)),M!==n){for(D=A,Y=[],Q=t.charAt(A),q.test(Q)?A++:(Q=n,H===0&&K(op));Q!==n;)Y.push(Q),Q=t.charAt(A),q.test(Q)?A++:(Q=n,H===0&&K(op));D=t.substring(D,A),R=Xk(D)}else A=R,R=n;return H--,R===n&&(M=n,H===0&&K(Mk)),R}function gp(){var R,M,D,Y;return H++,R=A,Ct(),t.charCodeAt(A)===40?(M=p,A++):(M=n,H===0&&K(Pk)),M!==n?(D=hp(),D!==n?(Ct(),t.charCodeAt(A)===41?(Y=v,A++):(Y=n,H===0&&K(Lk)),Y!==n?R=Zk(D):(A=R,R=n)):(A=R,R=n)):(A=R,R=n),H--,R===n&&H===0&&K(Nk),R}function u1(){var R,M,D;return H++,R=A,t.substr(A,3)===b?(M=b,A+=3):(M=n,H===0&&K(Ik)),M===n&&(t.substr(A,3)===C?(M=C,A+=3):(M=n,H===0&&K(jk)),M===n&&(t.substr(A,7)===_?(M=_,A+=7):(M=n,H===0&&K(Bk)),M===n&&(t.charCodeAt(A)===42?(M=w,A++):(M=n,H===0&&K(qk))))),M!==n?(Ct(),D=yu(),D===n&&(D=null),R=Wk(M,D)):(A=R,R=n),H--,R===n&&(M=n,H===0&&K(Uk)),R}function Ct(){var R,M;for(H++,R=[],M=t.charAt(A),X.test(M)?A++:(M=n,H===0&&K(lp));M!==n;)R.push(M),M=t.charAt(A),X.test(M)?A++:(M=n,H===0&&K(lp));return H--,M=n,H===0&&K(zk),R}if(mr=s(),e.peg$library)return{peg$result:mr,peg$currPos:A,peg$FAILED:n,peg$maxFailExpected:Ko,peg$maxFailPos:Cn};if(mr!==n&&A===t.length)return mr;throw mr!==n&&A<t.length&&K($k()),e1(Ko,Cn<t.length?t.charAt(Cn):null,Cn<t.length?up(Cn,Cn+1):up(Cn,Cn))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const Pl=0xffffffffffffffffn;function ud(t,e){return(t<<e|t>>64n-e)&0xffffffffffffffffn}function cv(t,e){return t*e&Pl}function GO(t){return function(){let e=BigInt(t&Pl),n=BigInt(t>>64n&Pl);const i=cv(ud(cv(e,5n),7n),9n);return n^=e,e=(ud(e,24n)^n^n<<16n)&Pl,n=ud(n,37n),t=n<<64n|e,i}}const cu=GO(0xa187eb39cdcaed8f31c4b365b102e01en),KO=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>cu()))),YO=Array.from({length:8},()=>cu()),QO=Array.from({length:16},()=>cu()),dd=cu(),St="w",Ft="b",Je="p",Uf="n",Ll="b",jr="r",Bi="q",tt="k",fd="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class fl{constructor(e,n){Pe(this,"color");Pe(this,"from");Pe(this,"to");Pe(this,"piece");Pe(this,"captured");Pe(this,"promotion");Pe(this,"flags");Pe(this,"san");Pe(this,"lan");Pe(this,"before");Pe(this,"after");const{color:i,piece:a,from:s,to:r,flags:o,captured:l,promotion:c}=n,u=rt(s),d=rt(r);this.color=i,this.piece=a,this.from=u,this.to=d,this.san=e._moveToSan(n,e._moves({legal:!0})),this.lan=u+d,this.before=e.fen(),e._makeMove(n),this.after=e.fen(),e._undoMove(),this.flags="";for(const f in $)$[f]&o&&(this.flags+=Ra[f]);l&&(this.captured=l),c&&(this.promotion=c,this.lan+=c)}isCapture(){return this.flags.indexOf(Ra.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Ra.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Ra.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Ra.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Ra.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Ra.BIG_PAWN)>-1}}const ft=-1,Ra={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},$={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},If={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},JO={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},XO={...If,...JO},Z={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},hd={b:[16,32,17,15],w:[-16,-32,-17,-15]},uv={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ZO=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],WO=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],$O={p:1,n:2,b:4,r:8,q:16,k:32},eA="pnbrqkPNBRQK",dv=[Uf,Ll,jr,Bi],tA=7,nA=6,iA=1,aA=0,hl={[tt]:$.KSIDE_CASTLE,[Bi]:$.QSIDE_CASTLE},Mi={w:[{square:Z.a1,flag:$.QSIDE_CASTLE},{square:Z.h1,flag:$.KSIDE_CASTLE}],b:[{square:Z.a8,flag:$.QSIDE_CASTLE},{square:Z.h8,flag:$.KSIDE_CASTLE}]},sA={b:iA,w:nA},md="--";function Ba(t){return t>>4}function Co(t){return t&15}function _T(t){return"0123456789".indexOf(t)!==-1}function rt(t){const e=Co(t),n=Ba(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(n,n+1)}function _r(t){return t===St?Ft:St}function rA(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(e[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const a=e[0].split("/");if(a.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let r=0;r<a.length;r++){let o=0,l=!1;for(let c=0;c<a[r].length;c++)if(_T(a[r][c])){if(l)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};o+=parseInt(a[r][c],10),l=!0}else{if(!/^[prnbqkPRNBQK]$/.test(a[r][c]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};o+=1,l=!1}if(o!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:r,regex:o}of s){if(!o.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${r} king`};if((e[0].match(o)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${r} kings`}}return Array.from(a[0]+a[7]).some(r=>r.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function oA(t,e){const n=t.from,i=t.to,a=t.piece;let s=0,r=0,o=0;for(let l=0,c=e.length;l<c;l++){const u=e[l].from,d=e[l].to,f=e[l].piece;a===f&&n!==u&&i===d&&(s++,Ba(n)===Ba(u)&&r++,Co(n)===Co(u)&&o++)}return s>0?r>0&&o>0?rt(n):o>0?rt(n).charAt(1):rt(n).charAt(0):""}function Di(t,e,n,i,a,s=void 0,r=$.NORMAL){const o=Ba(i);if(a===Je&&(o===tA||o===aA))for(let l=0;l<dv.length;l++){const c=dv[l];t.push({color:e,from:n,to:i,piece:a,captured:s,promotion:c,flags:r|$.PROMOTION})}else t.push({color:e,from:n,to:i,piece:a,captured:s,flags:r})}function fv(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:Je:(e=e.toLowerCase(),e==="o"?tt:e)}function pd(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class ml{constructor(e=fd,{skipValidation:n=!1}={}){Pe(this,"_board",new Array(128));Pe(this,"_turn",St);Pe(this,"_header",{});Pe(this,"_kings",{w:ft,b:ft});Pe(this,"_epSquare",-1);Pe(this,"_halfMoves",0);Pe(this,"_moveNumber",0);Pe(this,"_history",[]);Pe(this,"_comments",{});Pe(this,"_castling",{w:0,b:0});Pe(this,"_hash",0n);Pe(this,"_positionCount",new Map);this.load(e,{skipValidation:n})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:ft,b:ft},this._turn=St,this._castling={w:0,b:0},this._epSquare=ft,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...XO},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:n=!1,preserveHeaders:i=!1}={}){let a=e.split(/\s+/);if(a.length>=2&&a.length<6){const o=["-","-","0","1"];e=a.concat(o.slice(-(6-a.length))).join(" ")}if(a=e.split(/\s+/),!n){const{ok:o,error:l}=rA(e);if(!o)throw new Error(l)}const s=a[0];let r=0;this.clear({preserveHeaders:i});for(let o=0;o<s.length;o++){const l=s.charAt(o);if(l==="/")r+=8;else if(_T(l))r+=parseInt(l,10);else{const c=l<"a"?St:Ft;this._put({type:l.toLowerCase(),color:c},rt(r)),r++}}this._turn=a[1],a[2].indexOf("K")>-1&&(this._castling.w|=$.KSIDE_CASTLE),a[2].indexOf("Q")>-1&&(this._castling.w|=$.QSIDE_CASTLE),a[2].indexOf("k")>-1&&(this._castling.b|=$.KSIDE_CASTLE),a[2].indexOf("q")>-1&&(this._castling.b|=$.QSIDE_CASTLE),this._epSquare=a[3]==="-"?ft:Z[a[3]],this._halfMoves=parseInt(a[4],10),this._moveNumber=parseInt(a[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){var r,o;let n=0,i="";for(let l=Z.a8;l<=Z.h1;l++){if(this._board[l]){n>0&&(i+=n,n=0);const{color:c,type:u}=this._board[l];i+=c===St?u.toUpperCase():u.toLowerCase()}else n++;l+1&136&&(n>0&&(i+=n),l!==Z.h1&&(i+="/"),n=0,l+=8)}let a="";this._castling[St]&$.KSIDE_CASTLE&&(a+="K"),this._castling[St]&$.QSIDE_CASTLE&&(a+="Q"),this._castling[Ft]&$.KSIDE_CASTLE&&(a+="k"),this._castling[Ft]&$.QSIDE_CASTLE&&(a+="q"),a=a||"-";let s="-";if(this._epSquare!==ft)if(e)s=rt(this._epSquare);else{const l=this._epSquare+(this._turn===St?16:-16),c=[l+1,l-1];for(const u of c){if(u&136)continue;const d=this._turn;if(((r=this._board[u])==null?void 0:r.color)===d&&((o=this._board[u])==null?void 0:o.type)===Je){this._makeMove({color:d,from:u,to:this._epSquare,piece:Je,captured:Je,flags:$.EP_CAPTURE});const f=!this._isKingAttacked(d);if(this._undoMove(),f){s=rt(this._epSquare);break}}}}return[i,this._turn,a,s,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:n,type:i}=this._board[e],a={w:0,b:1}[n],s={p:0,n:1,b:2,r:3,q:4,k:5}[i];return KO[a][s][e]}_epKey(){return this._epSquare===ft?0n:YO[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return QO[e]}_computeHash(){let e=0n;for(let n=Z.a8;n<=Z.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(e^=this._pieceKey(n))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=dd),e}_updateSetup(e){this._history.length>0||(e!==fd?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(fd)}get(e){return this._board[Z[e]]}findPiece(e){var i;const n=[];for(let a=Z.a8;a<=Z.h1;a++){if(a&136){a+=7;continue}!this._board[a]||((i=this._board[a])==null?void 0:i.color)!==e.color||this._board[a].color===e.color&&this._board[a].type===e.type&&n.push(rt(a))}return n}put({type:e,color:n},i){return this._put({type:e,color:n},i)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,n){this._hash^=this._pieceKey(e),this._board[e]=n,this._hash^=this._pieceKey(e)}_put({type:e,color:n},i){if(eA.indexOf(e.toLowerCase())===-1||!(i in Z))return!1;const a=Z[i];if(e==tt&&!(this._kings[n]==ft||this._kings[n]==a))return!1;const s=this._board[a];return s&&s.type===tt&&(this._kings[s.color]=ft),this._set(a,{type:e,color:n}),e===tt&&(this._kings[n]=a),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const n=this.get(e);return this._clear(Z[e]),n&&n.type===tt&&(this._kings[n.color]=ft),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){var i,a,s,r,o,l,c,u,d,f,h,g;this._hash^=this._castlingKey();const e=((i=this._board[Z.e1])==null?void 0:i.type)===tt&&((a=this._board[Z.e1])==null?void 0:a.color)===St,n=((s=this._board[Z.e8])==null?void 0:s.type)===tt&&((r=this._board[Z.e8])==null?void 0:r.color)===Ft;(!e||((o=this._board[Z.a1])==null?void 0:o.type)!==jr||((l=this._board[Z.a1])==null?void 0:l.color)!==St)&&(this._castling.w&=-65),(!e||((c=this._board[Z.h1])==null?void 0:c.type)!==jr||((u=this._board[Z.h1])==null?void 0:u.color)!==St)&&(this._castling.w&=-33),(!n||((d=this._board[Z.a8])==null?void 0:d.type)!==jr||((f=this._board[Z.a8])==null?void 0:f.color)!==Ft)&&(this._castling.b&=-65),(!n||((h=this._board[Z.h8])==null?void 0:h.type)!==jr||((g=this._board[Z.h8])==null?void 0:g.color)!==Ft)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var s,r;if(this._epSquare===ft)return;const e=this._epSquare+(this._turn===St?-16:16),n=this._epSquare+(this._turn===St?16:-16),i=[n+1,n-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((s=this._board[n])==null?void 0:s.color)!==_r(this._turn)||((r=this._board[n])==null?void 0:r.type)!==Je){this._hash^=this._epKey(),this._epSquare=ft;return}const a=o=>{var l,c;return!(o&136)&&((l=this._board[o])==null?void 0:l.color)===this._turn&&((c=this._board[o])==null?void 0:c.type)===Je};i.some(a)||(this._hash^=this._epKey(),this._epSquare=ft)}_attacked(e,n,i){const a=[];for(let s=Z.a8;s<=Z.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==e)continue;const r=this._board[s],o=s-n;if(o===0)continue;const l=o+119;if(ZO[l]&$O[r.type]){if(r.type===Je){if(o>0&&r.color===St||o<=0&&r.color===Ft)if(i)a.push(rt(s));else return!0;continue}if(r.type==="n"||r.type==="k")if(i){a.push(rt(s));continue}else return!0;const c=WO[l];let u=s+c,d=!1;for(;u!==n;){if(this._board[u]!=null){d=!0;break}u+=c}if(!d)if(i){a.push(rt(s));continue}else return!0}}return i?a:!1}attackers(e,n){return n?this._attacked(n,Z[e],!0):this._attacked(this._turn,Z[e],!0)}_isKingAttacked(e){const n=this._kings[e];return n===-1?!1:this._attacked(_r(e),n)}hash(){return this._hash.toString(16)}isAttacked(e,n){return this._attacked(n,Z[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let i=0,a=0;for(let s=Z.a8;s<=Z.h1;s++){if(a=(a+1)%2,s&136){s+=7;continue}const r=this._board[s];r&&(e[r.type]=r.type in e?e[r.type]+1:1,r.type===Ll&&n.push(a),i++)}if(i===2)return!0;if(i===3&&(e[Ll]===1||e[Uf]===1))return!0;if(i===e[Ll]+2){let s=0;const r=n.length;for(let o=0;o<r;o++)s+=n[o];if(s===0||s===r)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:n=void 0,piece:i=void 0}={}){const a=this._moves({square:n,piece:i});return e?a.map(s=>new fl(this,s)):a.map(s=>this._moveToSan(s,a))}_moves({legal:e=!0,piece:n=void 0,square:i=void 0}={}){var h;const a=i?i.toLowerCase():void 0,s=n==null?void 0:n.toLowerCase(),r=[],o=this._turn,l=_r(o);let c=Z.a8,u=Z.h1,d=!1;if(a)if(a in Z)c=u=Z[a],d=!0;else return[];for(let g=c;g<=u;g++){if(g&136){g+=7;continue}if(!this._board[g]||this._board[g].color===l)continue;const{type:y}=this._board[g];let T;if(y===Je){if(s&&s!==y)continue;T=g+hd[o][0],this._board[T]||(Di(r,o,g,T,Je),T=g+hd[o][1],sA[o]===Ba(g)&&!this._board[T]&&Di(r,o,g,T,Je,void 0,$.BIG_PAWN));for(let m=2;m<4;m++)T=g+hd[o][m],!(T&136)&&(((h=this._board[T])==null?void 0:h.color)===l?Di(r,o,g,T,Je,this._board[T].type,$.CAPTURE):T===this._epSquare&&Di(r,o,g,T,Je,Je,$.EP_CAPTURE))}else{if(s&&s!==y)continue;for(let m=0,p=uv[y].length;m<p;m++){const v=uv[y][m];for(T=g;T+=v,!(T&136);){if(!this._board[T])Di(r,o,g,T,y);else{if(this._board[T].color===o)break;Di(r,o,g,T,y,this._board[T].type,$.CAPTURE);break}if(y===Uf||y===tt)break}}}}if((s===void 0||s===tt)&&(!d||u===this._kings[o])){if(this._castling[o]&$.KSIDE_CASTLE){const g=this._kings[o],y=g+2;!this._board[g+1]&&!this._board[y]&&!this._attacked(l,this._kings[o])&&!this._attacked(l,g+1)&&!this._attacked(l,y)&&Di(r,o,this._kings[o],y,tt,void 0,$.KSIDE_CASTLE)}if(this._castling[o]&$.QSIDE_CASTLE){const g=this._kings[o],y=g-2;!this._board[g-1]&&!this._board[g-2]&&!this._board[g-3]&&!this._attacked(l,this._kings[o])&&!this._attacked(l,g-1)&&!this._attacked(l,y)&&Di(r,o,this._kings[o],y,tt,void 0,$.QSIDE_CASTLE)}}if(!e||this._kings[o]===-1)return r;const f=[];for(let g=0,y=r.length;g<y;g++)this._makeMove(r[g]),this._isKingAttacked(o)||f.push(r[g]),this._undoMove();return f}move(e,{strict:n=!1}={}){let i=null;if(typeof e=="string")i=this._moveFromSan(e,n);else if(e===null)i=this._moveFromSan(md,n);else if(typeof e=="object"){const s=this._moves();for(let r=0,o=s.length;r<o;r++)if(e.from===rt(s[r].from)&&e.to===rt(s[r].to)&&(!("promotion"in s[r])||e.promotion===s[r].promotion)){i=s[r];break}}if(!i)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&i.flags&$.NULL_MOVE)throw new Error("Null move not allowed when in check");const a=new fl(this,i);return this._makeMove(i),this._incPositionCount(),a}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,n){this._hash^=this._pieceKey(e),this._board[n]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(n)}_makeMove(e){var a,s,r,o;const n=this._turn,i=_r(n);if(this._push(e),e.flags&$.NULL_MOVE){n===Ft&&this._moveNumber++,this._halfMoves++,this._turn=i,this._epSquare=ft;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&$.EP_CAPTURE&&(this._turn===Ft?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:n})),this._board[e.to].type===tt){if(this._kings[n]=e.to,e.flags&$.KSIDE_CASTLE){const l=e.to-1,c=e.to+1;this._movePiece(c,l)}else if(e.flags&$.QSIDE_CASTLE){const l=e.to+1,c=e.to-2;this._movePiece(c,l)}this._castling[n]=0}if(this._castling[n]){for(let l=0,c=Mi[n].length;l<c;l++)if(e.from===Mi[n][l].square&&this._castling[n]&Mi[n][l].flag){this._castling[n]^=Mi[n][l].flag;break}}if(this._castling[i]){for(let l=0,c=Mi[i].length;l<c;l++)if(e.to===Mi[i][l].square&&this._castling[i]&Mi[i][l].flag){this._castling[i]^=Mi[i][l].flag;break}}if(this._hash^=this._castlingKey(),e.flags&$.BIG_PAWN){let l;n===Ft?l=e.to-16:l=e.to+16,!(e.to-1&136)&&((a=this._board[e.to-1])==null?void 0:a.type)===Je&&((s=this._board[e.to-1])==null?void 0:s.color)===i||!(e.to+1&136)&&((r=this._board[e.to+1])==null?void 0:r.type)===Je&&((o=this._board[e.to+1])==null?void 0:o.color)===i?(this._epSquare=l,this._hash^=this._epKey()):this._epSquare=ft}else this._epSquare=ft;e.piece===Je?this._halfMoves=0:e.flags&($.CAPTURE|$.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===Ft&&this._moveNumber++,this._turn=i,this._hash^=dd}undo(){const e=this._hash,n=this._undoMove();if(n){const i=new fl(this,n);return this._decPositionCount(e),i}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=dd;const i=this._turn,a=_r(i);if(n.flags&$.NULL_MOVE)return n;if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:i})),n.captured)if(n.flags&$.EP_CAPTURE){let s;i===Ft?s=n.to-16:s=n.to+16,this._set(s,{type:Je,color:a})}else this._set(n.to,{type:n.captured,color:a});if(n.flags&($.KSIDE_CASTLE|$.QSIDE_CASTLE)){let s,r;n.flags&$.KSIDE_CASTLE?(s=n.to+1,r=n.to-1):(s=n.to-2,r=n.to+1),this._movePiece(r,s)}return n}pgn({newline:e=`
`,maxWidth:n=0}={}){const i=[];let a=!1;for(const f in this._header)this._header[f]&&i.push(`[${f} "${this._header[f]}"]`+e),a=!0;a&&this._history.length&&i.push(e);const s=f=>{const h=this._comments[this.fen()];if(typeof h<"u"){const g=f.length>0?" ":"";f=`${f}${g}{${h}}`}return f},r=[];for(;this._history.length>0;)r.push(this._undoMove());const o=[];let l="";for(r.length===0&&o.push(s(""));r.length>0;){l=s(l);const f=r.pop();if(!f)break;if(!this._history.length&&f.color==="b"){const h=`${this._moveNumber}. ...`;l=l?`${l} ${h}`:h}else f.color==="w"&&(l.length&&o.push(l),l=this._moveNumber+".");l=l+" "+this._moveToSan(f,this._moves({legal:!0})),this._makeMove(f)}if(l.length&&o.push(s(l)),o.push(this._header.Result||"*"),n===0)return i.join("")+o.join(" ");const c=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},u=function(f,h){for(const g of h.split(" "))if(g){if(f+g.length>n){for(;c();)f--;i.push(e),f=0}i.push(g),f+=g.length,i.push(" "),f++}return c()&&f--,f};let d=0;for(let f=0;f<o.length;f++){if(d+o[f].length>n&&o[f].includes("{")){d=u(d,o[f]);continue}d+o[f].length>n&&f!==0?(i[i.length-1]===" "&&i.pop(),i.push(e),d=0):f!==0&&(i.push(" "),d++),i.push(o[f]),d+=o[f].length}return i.join("")}header(...e){for(let n=0;n<e.length;n+=2)typeof e[n]=="string"&&typeof e[n+1]=="string"&&(this._header[e[n]]=e[n+1]);return this._header}setHeader(e,n){return this._header[e]=n??If[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=If[e]||null,!0):!1}getHeaders(){const e={};for(const[n,i]of Object.entries(this._header))i!==null&&(e[n]=i);return e}loadPgn(e,{strict:n=!1,newlineChar:i=`\r?
`}={}){i!==`\r?
`&&(e=e.replace(new RegExp(i,"g"),`
`));const a=HO(e);this.reset();const s=a.headers;let r="";for(const c in s)c.toLowerCase()==="fen"&&(r=s[c]),this.header(c,s[c]);if(!n)r&&this.load(r,{preserveHeaders:!0});else if(s.SetUp==="1"){if(!("FEN"in s))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(s.FEN,{preserveHeaders:!0})}let o=a.root;for(;o;){if(o.move){const c=this._moveFromSan(o.move,n);if(c==null)throw new Error(`Invalid move in PGN: ${o.move}`);this._makeMove(c),this._incPositionCount()}o.comment!==void 0&&(this._comments[this.fen()]=o.comment),o=o.variations[0]}const l=a.result;l&&Object.keys(this._header).length&&this._header.Result!==l&&this.setHeader("Result",l)}_moveToSan(e,n){let i="";if(e.flags&$.KSIDE_CASTLE)i="O-O";else if(e.flags&$.QSIDE_CASTLE)i="O-O-O";else{if(e.flags&$.NULL_MOVE)return md;if(e.piece!==Je){const a=oA(e,n);i+=e.piece.toUpperCase()+a}e.flags&($.CAPTURE|$.EP_CAPTURE)&&(e.piece===Je&&(i+=rt(e.from)[0]),i+="x"),i+=rt(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,n=!1){let i=pd(e);if(n||(i==="0-0"?i="O-O":i==="0-0-0"&&(i="O-O-O")),i==md)return{color:this._turn,from:0,to:0,piece:"k",flags:$.NULL_MOVE};let a=fv(i),s=this._moves({legal:!0,piece:a});for(let f=0,h=s.length;f<h;f++)if(i===pd(this._moveToSan(s[f],s)))return s[f];if(n)return null;let r,o,l,c,u,d=!1;if(o=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),o?(r=o[1],l=o[2],c=o[3],u=o[4],l.length==1&&(d=!0)):(o=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),o&&(r=o[1],l=o[2],c=o[3],u=o[4],l.length==1&&(d=!0))),a=fv(i),s=this._moves({legal:!0,piece:r||a}),!c)return null;for(let f=0,h=s.length;f<h;f++)if(l){if((!r||r.toLowerCase()==s[f].piece)&&Z[l]==s[f].from&&Z[c]==s[f].to&&(!u||u.toLowerCase()==s[f].promotion))return s[f];if(d){const g=rt(s[f].from);if((!r||r.toLowerCase()==s[f].piece)&&Z[c]==s[f].to&&(l==g[0]||l==g[1])&&(!u||u.toLowerCase()==s[f].promotion))return s[f]}}else if(i===pd(this._moveToSan(s[f],s)).replace("x",""))return s[f];return null}ascii(){let e=`   +------------------------+
`;for(let n=Z.a8;n<=Z.h1;n++){if(Co(n)===0&&(e+=" "+"87654321"[Ba(n)]+" |"),this._board[n]){const i=this._board[n].type,s=this._board[n].color===St?i.toUpperCase():i.toLowerCase();e+=" "+s+" "}else e+=" . ";n+1&136&&(e+=`|
`,n+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const n=this._moves({legal:!1});let i=0;const a=this._turn;for(let s=0,r=n.length;s<r;s++)this._makeMove(n[s]),this._isKingAttacked(a)||(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let n=[];for(let i=Z.a8;i<=Z.h1;i++)this._board[i]==null?n.push(null):n.push({square:rt(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(n),n=[],i+=8);return e}squareColor(e){if(e in Z){const n=Z[e];return(Ba(n)+Co(n))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const n=[],i=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const a=n.pop();if(!a)break;e?i.push(new fl(this,a)):i.push(this._moveToSan(a,this._moves())),this._makeMove(a)}return i}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const n=this._positionCount.get(e)??0;n===1?this._positionCount.delete(e):this._positionCount.set(e,n-1)}_pruneComments(){const e=[],n={},i=a=>{a in this._comments&&(n[a]=this._comments[a])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){const a=e.pop();if(!a)break;this._makeMove(a),i(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const n=this._comments[e];return delete this._comments[e],{fen:e,comment:n}})}setCastlingRights(e,n){for(const a of[tt,Bi])n[a]!==void 0&&(n[a]?this._castling[e]|=hl[a]:this._castling[e]&=~hl[a]);this._updateCastlingRights();const i=this.getCastlingRights(e);return(n[tt]===void 0||n[tt]===i[tt])&&(n[Bi]===void 0||n[Bi]===i[Bi])}getCastlingRights(e){return{[tt]:(this._castling[e]&hl[tt])!==0,[Bi]:(this._castling[e]&hl[Bi])!==0}}moveNumber(){return this._moveNumber}}function lA(t){const e=new Map;return["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"].forEach(i=>{try{const a=t.moves({square:i,verbose:!0});a.length&&e.set(i,a.map(s=>s.to))}catch{}}),e}const cA=({onReset:t})=>k.jsx("div",{className:"absolute top-2 left-2 z-10 opacity-0 group-hover:opacity-100 transition-opacity",children:k.jsx("button",{onClick:t,className:"bg-red-600 text-white text-xs px-2 py-1 rounded shadow hover:bg-red-700",children:"Reset Tablero"})}),uA=({teacherId:t})=>{const[e,n]=x.useState(()=>new ml),[i,a]=x.useState(()=>e.fen()),[s,r]=x.useState(null),[o,l]=x.useState("white"),{userRole:c,currentUserId:u}=yi.useContext(is);x.useEffect(()=>{const T=pe.subscribeToRoom(t,m=>{if(m&&m.fen&&m.fen!==i)try{const p=new ml(m.fen);n(p),a(m.fen),m.lastMove&&r(m.lastMove),m.orientation&&l(m.orientation)}catch(p){console.error("Sync error:",p)}});return()=>T()},[t,i]);const d=x.useCallback((T,m)=>{const p=new ml(e.fen());if(p.move({from:T,to:m,promotion:"q"})){const b=p.fen();n(p),a(b),r([T,m]),c==="teacher"&&u===t&&pe.updateRoom(t,{fen:b,lastMove:[T,m],orientation:o})}else a(null),setTimeout(()=>a(e.fen()),0)},[e,t,c,u,o]),f=()=>{if(window.confirm("Reiniciar partida?")){const T=new ml,m=T.fen();n(T),a(m),r(null),c==="teacher"&&u===t&&pe.updateRoom(t,{fen:m,lastMove:null,orientation:"white"})}},h=lA(e),g=e.turn()==="w"?"white":"black",y={fen:i,orientation:o,turnColor:g,lastMove:s,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:250},movable:{free:!1,color:g,dests:h,showDests:!0},draggable:{enabled:!0},selectable:{enabled:!0},events:{move:d}};return k.jsxs("div",{className:"w-full h-full flex flex-col justify-center items-center bg-[#262421] rounded-xl p-4 md:p-8 shadow-2xl relative group overflow-hidden board-container",children:[c==="teacher"&&u===t&&k.jsx(cA,{onReset:f}),k.jsxs("div",{className:"w-full h-full max-w-[min(100%,calc(100vh-280px))] aspect-square flex items-center justify-center relative shadow-2xl border-4 border-[#302e2b] rounded-sm",children:[k.jsx("div",{className:"chessground-wrapper w-full h-full shadow-inner",children:k.jsx(jO,{width:"100%",height:"100%",config:y})}),e.isGameOver()&&k.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-50 animate-in fade-in zoom-in duration-300 backdrop-blur-sm",children:k.jsxs("div",{className:"bg-[#161512] p-10 rounded-2xl border-2 border-[#bf811d] shadow-[0_0_50px_rgba(191,129,29,0.5)] text-center transform scale-110",children:[k.jsx("h3",{className:"text-4xl font-black text-white uppercase tracking-tighter mb-4",children:"Juego Terminado"}),k.jsxs("div",{className:"flex flex-col gap-2",children:[k.jsx("p",{className:"text-[#bf811d] font-black text-2xl uppercase",children:e.isCheckmate()?"Jaque Mate!":e.isDraw()?"Empate":e.isStalemate()?"Ahogado":"Fin de partida"}),!e.isDraw()&&k.jsxs("p",{className:"text-[#bababa] text-lg font-bold",children:["Ganador: ",e.turn()==="w"?"Negras":"Blancas"]})]}),k.jsx("button",{onClick:f,className:"mt-8 px-6 py-2 bg-[#bf811d] text-white rounded-lg font-bold hover:bg-[#a6701a] transition-all shadow-lg",children:"Nueva Partida"})]})})]})]})};var hv={};function dA(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(i){if(i!=="default"&&!(i in t)){var a=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,a.get?a:{enumerable:!0,get:function(){return n[i]}})}})}),Object.freeze(t)}var fA=Object.defineProperty,hA=(t,e,n)=>e in t?fA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,mv=(t,e,n)=>hA(t,typeof e!="symbol"?e+"":e,n);class xt{constructor(){mv(this,"_locking"),mv(this,"_locks"),this._locking=Promise.resolve(),this._locks=0}isLocked(){return this._locks>0}lock(){this._locks+=1;let e;const n=new Promise(a=>e=()=>{this._locks-=1,a()}),i=this._locking.then(()=>e);return this._locking=this._locking.then(()=>n),i}}function ze(t,e){if(!t)throw new Error(e)}const mA=34028234663852886e22,pA=-34028234663852886e22,gA=4294967295,vA=2147483647,bA=-2147483648;function Ul(t){if(typeof t!="number")throw new Error("invalid int 32: "+typeof t);if(!Number.isInteger(t)||t>vA||t<bA)throw new Error("invalid int 32: "+t)}function jf(t){if(typeof t!="number")throw new Error("invalid uint 32: "+typeof t);if(!Number.isInteger(t)||t>gA||t<0)throw new Error("invalid uint 32: "+t)}function RT(t){if(typeof t!="number")throw new Error("invalid float 32: "+typeof t);if(Number.isFinite(t)&&(t>mA||t<pA))throw new Error("invalid float 32: "+t)}const xT=Symbol("@bufbuild/protobuf/enum-type");function yA(t){const e=t[xT];return ze(e,"missing enum type on enum object"),e}function wT(t,e,n,i){t[xT]=OT(e,n.map(a=>({no:a.no,name:a.name,localName:t[a.no]})))}function OT(t,e,n){const i=Object.create(null),a=Object.create(null),s=[];for(const r of e){const o=AT(r);s.push(o),i[r.name]=o,a[r.no]=o}return{typeName:t,values:s,findName(r){return i[r]},findNumber(r){return a[r]}}}function SA(t,e,n){const i={};for(const a of e){const s=AT(a);i[s.localName]=s.no,i[s.no]=s.localName}return wT(i,t,e),i}function AT(t){return"localName"in t?t:Object.assign(Object.assign({},t),{localName:t.name})}class Om{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,n){const i=this.getType(),a=i.runtime.bin,s=a.makeReadOptions(n);return a.readMessage(this,s.readerFactory(e),e.byteLength,s),this}fromJson(e,n){const i=this.getType(),a=i.runtime.json,s=a.makeReadOptions(n);return a.readMessage(i,e,s,this),this}fromJsonString(e,n){let i;try{i=JSON.parse(e)}catch(a){throw new Error("cannot decode ".concat(this.getType().typeName," from JSON: ").concat(a instanceof Error?a.message:String(a)))}return this.fromJson(i,n)}toBinary(e){const n=this.getType(),i=n.runtime.bin,a=i.makeWriteOptions(e),s=a.writerFactory();return i.writeMessage(this,s,a),s.finish()}toJson(e){const n=this.getType(),i=n.runtime.json,a=i.makeWriteOptions(e);return i.writeMessage(this,a)}toJsonString(e){var n;const i=this.toJson(e);return JSON.stringify(i,null,(n=e==null?void 0:e.prettySpaces)!==null&&n!==void 0?n:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function TA(t,e,n,i){var a;const s=(a=i==null?void 0:i.localName)!==null&&a!==void 0?a:e.substring(e.lastIndexOf(".")+1),r={[s]:function(o){t.util.initFields(this),t.util.initPartial(o,this)}}[s];return Object.setPrototypeOf(r.prototype,new Om),Object.assign(r,{runtime:t,typeName:e,fields:t.util.newFieldList(n),fromBinary(o,l){return new r().fromBinary(o,l)},fromJson(o,l){return new r().fromJson(o,l)},fromJsonString(o,l){return new r().fromJsonString(o,l)},equals(o,l){return t.util.equals(r,o,l)}}),r}function CA(){let t=0,e=0;for(let i=0;i<28;i+=7){let a=this.buf[this.pos++];if(t|=(a&127)<<i,!(a&128))return this.assertBounds(),[t,e]}let n=this.buf[this.pos++];if(t|=(n&15)<<28,e=(n&112)>>4,!(n&128))return this.assertBounds(),[t,e];for(let i=3;i<=31;i+=7){let a=this.buf[this.pos++];if(e|=(a&127)<<i,!(a&128))return this.assertBounds(),[t,e]}throw new Error("invalid varint")}function gd(t,e,n){for(let s=0;s<28;s=s+7){const r=t>>>s,o=!(!(r>>>7)&&e==0),l=(o?r|128:r)&255;if(n.push(l),!o)return}const i=t>>>28&15|(e&7)<<4,a=!!(e>>3);if(n.push((a?i|128:i)&255),!!a){for(let s=3;s<31;s=s+7){const r=e>>>s,o=!!(r>>>7),l=(o?r|128:r)&255;if(n.push(l),!o)return}n.push(e>>>31&1)}}const Il=4294967296;function pv(t){const e=t[0]==="-";e&&(t=t.slice(1));const n=1e6;let i=0,a=0;function s(r,o){const l=Number(t.slice(r,o));a*=n,i=i*n+l,i>=Il&&(a=a+(i/Il|0),i=i%Il)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),e?DT(i,a):Am(i,a)}function kA(t,e){let n=Am(t,e);const i=n.hi&2147483648;i&&(n=DT(n.lo,n.hi));const a=MT(n.lo,n.hi);return i?"-"+a:a}function MT(t,e){if({lo:t,hi:e}=EA(t,e),e<=2097151)return String(Il*e+t);const n=t&16777215,i=(t>>>24|e<<8)&16777215,a=e>>16&65535;let s=n+i*6777216+a*6710656,r=i+a*8147497,o=a*2;const l=1e7;return s>=l&&(r+=Math.floor(s/l),s%=l),r>=l&&(o+=Math.floor(r/l),r%=l),o.toString()+gv(r)+gv(s)}function EA(t,e){return{lo:t>>>0,hi:e>>>0}}function Am(t,e){return{lo:t|0,hi:e|0}}function DT(t,e){return e=~e,t?t=~t+1:e+=1,Am(t,e)}const gv=t=>{const e=String(t);return"0000000".slice(e.length)+e};function vv(t,e){if(t>=0){for(;t>127;)e.push(t&127|128),t=t>>>7;e.push(t)}else{for(let n=0;n<9;n++)e.push(t&127|128),t=t>>7;e.push(1)}}function _A(){let t=this.buf[this.pos++],e=t&127;if(!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<7,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<14,!(t&128))return this.assertBounds(),e;if(t=this.buf[this.pos++],e|=(t&127)<<21,!(t&128))return this.assertBounds(),e;t=this.buf[this.pos++],e|=(t&15)<<28;for(let n=5;t&128&&n<10;n++)t=this.buf[this.pos++];if(t&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}function RA(){const t=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof t.getBigInt64=="function"&&typeof t.getBigUint64=="function"&&typeof t.setBigInt64=="function"&&typeof t.setBigUint64=="function"&&(typeof process!="object"||typeof hv!="object"||hv.BUF_BIGINT_DISABLE!=="1")){const a=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),r=BigInt("0"),o=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>s||c<a)throw new Error("int64 invalid: ".concat(l));return c},uParse(l){const c=typeof l=="bigint"?l:BigInt(l);if(c>o||c<r)throw new Error("uint64 invalid: ".concat(l));return c},enc(l){return t.setBigInt64(0,this.parse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},uEnc(l){return t.setBigInt64(0,this.uParse(l),!0),{lo:t.getInt32(0,!0),hi:t.getInt32(4,!0)}},dec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigInt64(0,!0)},uDec(l,c){return t.setInt32(0,l,!0),t.setInt32(4,c,!0),t.getBigUint64(0,!0)}}}const n=a=>ze(/^-?[0-9]+$/.test(a),"int64 invalid: ".concat(a)),i=a=>ze(/^[0-9]+$/.test(a),"uint64 invalid: ".concat(a));return{zero:"0",supported:!1,parse(a){return typeof a!="string"&&(a=a.toString()),n(a),a},uParse(a){return typeof a!="string"&&(a=a.toString()),i(a),a},enc(a){return typeof a!="string"&&(a=a.toString()),n(a),pv(a)},uEnc(a){return typeof a!="string"&&(a=a.toString()),i(a),pv(a)},dec(a,s){return kA(a,s)},uDec(a,s){return MT(a,s)}}}const Ue=RA();var I;(function(t){t[t.DOUBLE=1]="DOUBLE",t[t.FLOAT=2]="FLOAT",t[t.INT64=3]="INT64",t[t.UINT64=4]="UINT64",t[t.INT32=5]="INT32",t[t.FIXED64=6]="FIXED64",t[t.FIXED32=7]="FIXED32",t[t.BOOL=8]="BOOL",t[t.STRING=9]="STRING",t[t.BYTES=12]="BYTES",t[t.UINT32=13]="UINT32",t[t.SFIXED32=15]="SFIXED32",t[t.SFIXED64=16]="SFIXED64",t[t.SINT32=17]="SINT32",t[t.SINT64=18]="SINT64"})(I||(I={}));var pa;(function(t){t[t.BIGINT=0]="BIGINT",t[t.STRING=1]="STRING"})(pa||(pa={}));function Ni(t,e,n){if(e===n)return!0;if(t==I.BYTES){if(!(e instanceof Uint8Array)||!(n instanceof Uint8Array)||e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}switch(t){case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==n}return!1}function er(t,e){switch(t){case I.BOOL:return!1;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return e==0?Ue.zero:"0";case I.DOUBLE:case I.FLOAT:return 0;case I.BYTES:return new Uint8Array(0);case I.STRING:return"";default:return 0}}function NT(t,e){switch(t){case I.BOOL:return e===!1;case I.STRING:return e==="";case I.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var Ge;(function(t){t[t.Varint=0]="Varint",t[t.Bit64=1]="Bit64",t[t.LengthDelimited=2]="LengthDelimited",t[t.StartGroup=3]="StartGroup",t[t.EndGroup=4]="EndGroup",t[t.Bit32=5]="Bit32"})(Ge||(Ge={}));class xA{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let a=0;a<this.chunks.length;a++)e+=this.chunks[a].length;let n=new Uint8Array(e),i=0;for(let a=0;a<this.chunks.length;a++)n.set(this.chunks[a],i),i+=this.chunks[a].length;return this.chunks=[],n}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),n=this.stack.pop();if(!n)throw new Error("invalid state, fork stack empty");return this.chunks=n.chunks,this.buf=n.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,n){return this.uint32((e<<3|n)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(jf(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Ul(e),vv(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let n=this.textEncoder.encode(e);return this.uint32(n.byteLength),this.raw(n)}float(e){RT(e);let n=new Uint8Array(4);return new DataView(n.buffer).setFloat32(0,e,!0),this.raw(n)}double(e){let n=new Uint8Array(8);return new DataView(n.buffer).setFloat64(0,e,!0),this.raw(n)}fixed32(e){jf(e);let n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,e,!0),this.raw(n)}sfixed32(e){Ul(e);let n=new Uint8Array(4);return new DataView(n.buffer).setInt32(0,e,!0),this.raw(n)}sint32(e){return Ul(e),e=(e<<1^e>>31)>>>0,vv(e,this.buf),this}sfixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),a=Ue.enc(e);return i.setInt32(0,a.lo,!0),i.setInt32(4,a.hi,!0),this.raw(n)}fixed64(e){let n=new Uint8Array(8),i=new DataView(n.buffer),a=Ue.uEnc(e);return i.setInt32(0,a.lo,!0),i.setInt32(4,a.hi,!0),this.raw(n)}int64(e){let n=Ue.enc(e);return gd(n.lo,n.hi,this.buf),this}sint64(e){let n=Ue.enc(e),i=n.hi>>31,a=n.lo<<1^i,s=(n.hi<<1|n.lo>>>31)^i;return gd(a,s,this.buf),this}uint64(e){let n=Ue.uEnc(e);return gd(n.lo,n.hi,this.buf),this}}class wA{constructor(e,n){this.varint64=CA,this.uint32=_A,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=n??new TextDecoder}tag(){let e=this.uint32(),n=e>>>3,i=e&7;if(n<=0||i<0||i>5)throw new Error("illegal tag: field no "+n+" wire type "+i);return[n,i]}skip(e,n){let i=this.pos;switch(e){case Ge.Varint:for(;this.buf[this.pos++]&128;);break;case Ge.Bit64:this.pos+=4;case Ge.Bit32:this.pos+=4;break;case Ge.LengthDelimited:let a=this.uint32();this.pos+=a;break;case Ge.StartGroup:for(;;){const[s,r]=this.tag();if(r===Ge.EndGroup){if(n!==void 0&&s!==n)throw new Error("invalid end group tag");break}this.skip(r,s)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(i,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return Ue.dec(...this.varint64())}uint64(){return Ue.uDec(...this.varint64())}sint64(){let[e,n]=this.varint64(),i=-(e&1);return e=(e>>>1|(n&1)<<31)^i,n=n>>>1^i,Ue.dec(e,n)}bool(){let[e,n]=this.varint64();return e!==0||n!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return Ue.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return Ue.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),n=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(n,n+e)}string(){return this.textDecoder.decode(this.bytes())}}function OA(t,e,n,i){let a;return{typeName:e,extendee:n,get field(){if(!a){const s=typeof i=="function"?i():i;s.name=e.split(".").pop(),s.jsonName="[".concat(e,"]"),a=t.util.newFieldList([s]).list()[0]}return a},runtime:t}}function PT(t){const e=t.field.localName,n=Object.create(null);return n[e]=AA(t),[n,()=>n[e]]}function AA(t){const e=t.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return er(e.T,e.L);case"message":const n=e.T,i=new n;return n.fieldWrapper?n.fieldWrapper.unwrapField(i):i;case"map":throw"map fields are not allowed to be extensions"}}function MA(t,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let n=t.length-1;n>=0;--n)if(t[n].no==e.no)return[t[n]];return[]}return t.filter(n=>n.no===e.no)}let li="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),uu=[];for(let t=0;t<li.length;t++)uu[li[t].charCodeAt(0)]=t;uu[45]=li.indexOf("+");uu[95]=li.indexOf("/");const LT={dec(t){let e=t.length*3/4;t[t.length-2]=="="?e-=2:t[t.length-1]=="="&&(e-=1);let n=new Uint8Array(e),i=0,a=0,s,r=0;for(let o=0;o<t.length;o++){if(s=uu[t.charCodeAt(o)],s===void 0)switch(t[o]){case"=":a=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(a){case 0:r=s,a=1;break;case 1:n[i++]=r<<2|(s&48)>>4,r=s,a=2;break;case 2:n[i++]=(r&15)<<4|(s&60)>>2,r=s,a=3;break;case 3:n[i++]=(r&3)<<6|s,a=0;break}}if(a==1)throw Error("invalid base64 string.");return n.subarray(0,i)},enc(t){let e="",n=0,i,a=0;for(let s=0;s<t.length;s++)switch(i=t[s],n){case 0:e+=li[i>>2],a=(i&3)<<4,n=1;break;case 1:e+=li[a|i>>4],a=(i&15)<<2,n=2;break;case 2:e+=li[a|i>>6],e+=li[i&63],n=0;break}return n&&(e+=li[a],e+="=",n==1&&(e+="=")),e}};function DA(t,e,n){IT(e,t);const i=e.runtime.bin.makeReadOptions(n),a=MA(t.getType().runtime.bin.listUnknownFields(t),e.field),[s,r]=PT(e);for(const o of a)e.runtime.bin.readField(s,i.readerFactory(o.data),e.field,o.wireType,i);return r()}function NA(t,e,n,i){IT(e,t);const a=e.runtime.bin.makeReadOptions(i),s=e.runtime.bin.makeWriteOptions(i);if(UT(t,e)){const c=t.getType().runtime.bin.listUnknownFields(t).filter(u=>u.no!=e.field.no);t.getType().runtime.bin.discardUnknownFields(t);for(const u of c)t.getType().runtime.bin.onUnknownField(t,u.no,u.wireType,u.data)}const r=s.writerFactory();let o=e.field;!o.opt&&!o.repeated&&(o.kind=="enum"||o.kind=="scalar")&&(o=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(o,n,r,s);const l=a.readerFactory(r.finish());for(;l.pos<l.len;){const[c,u]=l.tag(),d=l.skip(u,c);t.getType().runtime.bin.onUnknownField(t,c,u,d)}}function UT(t,e){const n=t.getType();return e.extendee.typeName===n.typeName&&!!n.runtime.bin.listUnknownFields(t).find(i=>i.no==e.field.no)}function IT(t,e){ze(t.extendee.typeName==e.getType().typeName,"extension ".concat(t.typeName," can only be applied to message ").concat(t.extendee.typeName))}function jT(t,e){const n=t.localName;if(t.repeated)return e[n].length>0;if(t.oneof)return e[t.oneof.localName].case===n;switch(t.kind){case"enum":case"scalar":return t.opt||t.req?e[n]!==void 0:t.kind=="enum"?e[n]!==t.T.values[0].no:!NT(t.T,e[n]);case"message":return e[n]!==void 0;case"map":return Object.keys(e[n]).length>0}}function bv(t,e){const n=t.localName,i=!t.opt&&!t.req;if(t.repeated)e[n]=[];else if(t.oneof)e[t.oneof.localName]={case:void 0};else switch(t.kind){case"map":e[n]={};break;case"enum":e[n]=i?t.T.values[0].no:void 0;break;case"scalar":e[n]=i?er(t.T,t.L):void 0;break;case"message":e[n]=void 0;break}}function ci(t,e){if(t===null||typeof t!="object"||!Object.getOwnPropertyNames(Om.prototype).every(i=>i in t&&typeof t[i]=="function"))return!1;const n=t.getType();return n===null||typeof n!="function"||!("typeName"in n)||typeof n.typeName!="string"?!1:e===void 0?!0:n.typeName==e.typeName}function BT(t,e){return ci(e)||!t.fieldWrapper?e:t.fieldWrapper.wrapField(e)}I.DOUBLE,I.FLOAT,I.INT64,I.UINT64,I.INT32,I.UINT32,I.BOOL,I.STRING,I.BYTES;const yv={ignoreUnknownFields:!1},Sv={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function PA(t){return t?Object.assign(Object.assign({},yv),t):yv}function LA(t){return t?Object.assign(Object.assign({},Sv),t):Sv}const wc=Symbol(),jl=Symbol();function UA(){return{makeReadOptions:PA,makeWriteOptions:LA,readMessage(t,e,n,i){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error("cannot decode message ".concat(t.typeName," from JSON: ").concat(Bn(e)));i=i??new t;const a=new Map,s=n.typeRegistry;for(const[r,o]of Object.entries(e)){const l=t.fields.findJsonName(r);if(l){if(l.oneof){if(o===null&&l.kind=="scalar")continue;const c=a.get(l.oneof);if(c!==void 0)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: multiple keys for oneof "').concat(l.oneof.name,'" present: "').concat(c,'", "').concat(r,'"'));a.set(l.oneof,r)}Tv(i,o,l,n,t)}else{let c=!1;if(s!=null&&s.findExtension&&r.startsWith("[")&&r.endsWith("]")){const u=s.findExtension(r.substring(1,r.length-1));if(u&&u.extendee.typeName==t.typeName){c=!0;const[d,f]=PT(u);Tv(d,o,u.field,n,u),NA(i,u,f(),n)}}if(!c&&!n.ignoreUnknownFields)throw new Error("cannot decode message ".concat(t.typeName,' from JSON: key "').concat(r,'" is unknown'))}}return i},writeMessage(t,e){const n=t.getType(),i={};let a;try{for(a of n.fields.byNumber()){if(!jT(a,t)){if(a.req)throw"required field not set";if(!e.emitDefaultValues||!jA(a))continue}const r=a.oneof?t[a.oneof.localName].value:t[a.localName],o=Cv(a,r,e);o!==void 0&&(i[e.useProtoFieldName?a.name:a.jsonName]=o)}const s=e.typeRegistry;if(s!=null&&s.findExtensionFor)for(const r of n.runtime.bin.listUnknownFields(t)){const o=s.findExtensionFor(n.typeName,r.no);if(o&&UT(t,o)){const l=DA(t,o,e),c=Cv(o.field,l,e);c!==void 0&&(i[o.field.jsonName]=c)}}}catch(s){const r=a?"cannot encode field ".concat(n.typeName,".").concat(a.name," to JSON"):"cannot encode message ".concat(n.typeName," to JSON"),o=s instanceof Error?s.message:String(s);throw new Error(r+(o.length>0?": ".concat(o):""))}return i},readScalar(t,e,n){return to(t,e,n??pa.BIGINT,!0)},writeScalar(t,e,n){if(e!==void 0&&(n||NT(t,e)))return Bl(t,e)},debug:Bn}}function Bn(t){if(t===null)return"null";switch(typeof t){case"object":return Array.isArray(t)?"array":"object";case"string":return t.length>100?"string":'"'.concat(t.split('"').join('\\"'),'"');default:return String(t)}}function Tv(t,e,n,i,a){let s=n.localName;if(n.repeated){if(ze(n.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error("cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Bn(e)));const r=t[s];for(const o of e){if(o===null)throw new Error("cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Bn(o)));switch(n.kind){case"message":r.push(n.T.fromJson(o,i));break;case"enum":const l=vd(n.T,o,i.ignoreUnknownFields,!0);l!==jl&&r.push(l);break;case"scalar":try{r.push(to(n.T,o,n.L,!0))}catch(c){let u="cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Bn(o));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}}else if(n.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error("cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Bn(e)));const r=t[s];for(const[o,l]of Object.entries(e)){if(l===null)throw new Error("cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: map value null"));let c;try{c=IA(n.K,o)}catch(u){let d="cannot decode map key for field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Bn(e));throw u instanceof Error&&u.message.length>0&&(d+=": ".concat(u.message)),new Error(d)}switch(n.V.kind){case"message":r[c]=n.V.T.fromJson(l,i);break;case"enum":const u=vd(n.V.T,l,i.ignoreUnknownFields,!0);u!==jl&&(r[c]=u);break;case"scalar":try{r[c]=to(n.V.T,l,pa.BIGINT,!0)}catch(d){let f="cannot decode map value for field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Bn(e));throw d instanceof Error&&d.message.length>0&&(f+=": ".concat(d.message)),new Error(f)}break}}}else switch(n.oneof&&(t=t[n.oneof.localName]={case:s},s="value"),n.kind){case"message":const r=n.T;if(e===null&&r.typeName!="google.protobuf.Value")return;let o=t[s];ci(o)?o.fromJson(e,i):(t[s]=o=r.fromJson(e,i),r.fieldWrapper&&!n.oneof&&(t[s]=r.fieldWrapper.unwrapField(o)));break;case"enum":const l=vd(n.T,e,i.ignoreUnknownFields,!1);switch(l){case wc:bv(n,t);break;case jl:break;default:t[s]=l;break}break;case"scalar":try{const c=to(n.T,e,n.L,!1);switch(c){case wc:bv(n,t);break;default:t[s]=c;break}}catch(c){let u="cannot decode field ".concat(a.typeName,".").concat(n.name," from JSON: ").concat(Bn(e));throw c instanceof Error&&c.message.length>0&&(u+=": ".concat(c.message)),new Error(u)}break}}function IA(t,e){if(t===I.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return to(t,e,pa.BIGINT,!0).toString()}function to(t,e,n,i){if(e===null)return i?er(t,n):wc;switch(t){case I.DOUBLE:case I.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const a=Number(e);if(Number.isNaN(a)||!Number.isFinite(a))break;return t==I.FLOAT&&RT(a),a;case I.INT32:case I.FIXED32:case I.SFIXED32:case I.SINT32:case I.UINT32:let s;if(typeof e=="number"?s=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(s=Number(e)),s===void 0)break;return t==I.UINT32||t==I.FIXED32?jf(s):Ul(s),s;case I.INT64:case I.SFIXED64:case I.SINT64:if(typeof e!="number"&&typeof e!="string")break;const r=Ue.parse(e);return n?r.toString():r;case I.FIXED64:case I.UINT64:if(typeof e!="number"&&typeof e!="string")break;const o=Ue.uParse(e);return n?o.toString():o;case I.BOOL:if(typeof e!="boolean")break;return e;case I.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case I.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return LT.dec(e)}throw new Error}function vd(t,e,n,i){if(e===null)return t.typeName=="google.protobuf.NullValue"?0:i?t.values[0].no:wc;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const a=t.findName(e);if(a!==void 0)return a.no;if(n)return jl;break}throw new Error("cannot decode enum ".concat(t.typeName," from JSON: ").concat(Bn(e)))}function jA(t){return t.repeated||t.kind=="map"?!0:!(t.oneof||t.kind=="message"||t.opt||t.req)}function Cv(t,e,n){if(t.kind=="map"){ze(typeof e=="object"&&e!=null);const i={},a=Object.entries(e);switch(t.V.kind){case"scalar":for(const[r,o]of a)i[r.toString()]=Bl(t.V.T,o);break;case"message":for(const[r,o]of a)i[r.toString()]=o.toJson(n);break;case"enum":const s=t.V.T;for(const[r,o]of a)i[r.toString()]=bd(s,o,n.enumAsInteger);break}return n.emitDefaultValues||a.length>0?i:void 0}if(t.repeated){ze(Array.isArray(e));const i=[];switch(t.kind){case"scalar":for(let a=0;a<e.length;a++)i.push(Bl(t.T,e[a]));break;case"enum":for(let a=0;a<e.length;a++)i.push(bd(t.T,e[a],n.enumAsInteger));break;case"message":for(let a=0;a<e.length;a++)i.push(e[a].toJson(n));break}return n.emitDefaultValues||i.length>0?i:void 0}switch(t.kind){case"scalar":return Bl(t.T,e);case"enum":return bd(t.T,e,n.enumAsInteger);case"message":return BT(t.T,e).toJson(n)}}function bd(t,e,n){var i;if(ze(typeof e=="number"),t.typeName=="google.protobuf.NullValue")return null;if(n)return e;const a=t.findNumber(e);return(i=a==null?void 0:a.name)!==null&&i!==void 0?i:e}function Bl(t,e){switch(t){case I.INT32:case I.SFIXED32:case I.SINT32:case I.FIXED32:case I.UINT32:return ze(typeof e=="number"),e;case I.FLOAT:case I.DOUBLE:return ze(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case I.STRING:return ze(typeof e=="string"),e;case I.BOOL:return ze(typeof e=="boolean"),e;case I.UINT64:case I.FIXED64:case I.INT64:case I.SFIXED64:case I.SINT64:return ze(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case I.BYTES:return ze(e instanceof Uint8Array),LT.enc(e)}}const os=Symbol("@bufbuild/protobuf/unknown-fields"),kv={readUnknownFields:!0,readerFactory:t=>new wA(t)},Ev={writeUnknownFields:!0,writerFactory:()=>new xA};function BA(t){return t?Object.assign(Object.assign({},kv),t):kv}function qA(t){return t?Object.assign(Object.assign({},Ev),t):Ev}function zA(){return{makeReadOptions:BA,makeWriteOptions:qA,listUnknownFields(t){var e;return(e=t[os])!==null&&e!==void 0?e:[]},discardUnknownFields(t){delete t[os]},writeUnknownFields(t,e){const i=t[os];if(i)for(const a of i)e.tag(a.no,a.wireType).raw(a.data)},onUnknownField(t,e,n,i){const a=t;Array.isArray(a[os])||(a[os]=[]),a[os].push({no:e,wireType:n,data:i})},readMessage(t,e,n,i,a){const s=t.getType(),r=a?e.len:e.pos+n;let o,l;for(;e.pos<r&&([o,l]=e.tag(),!(a===!0&&l==Ge.EndGroup));){const c=s.fields.find(o);if(!c){const u=e.skip(l,o);i.readUnknownFields&&this.onUnknownField(t,o,l,u);continue}_v(t,e,c,l,i)}if(a&&(l!=Ge.EndGroup||o!==n))throw new Error("invalid end group tag")},readField:_v,writeMessage(t,e,n){const i=t.getType();for(const a of i.fields.byNumber()){if(!jT(a,t)){if(a.req)throw new Error("cannot encode field ".concat(i.typeName,".").concat(a.name," to binary: required field not set"));continue}const s=a.oneof?t[a.oneof.localName].value:t[a.localName];Rv(a,s,e,n)}return n.writeUnknownFields&&this.writeUnknownFields(t,e),e},writeField(t,e,n,i){e!==void 0&&Rv(t,e,n,i)}}}function _v(t,e,n,i,a){let{repeated:s,localName:r}=n;switch(n.oneof&&(t=t[n.oneof.localName],t.case!=r&&delete t.value,t.case=r,r="value"),n.kind){case"scalar":case"enum":const o=n.kind=="enum"?I.INT32:n.T;let l=Oc;if(n.kind=="scalar"&&n.L>0&&(l=VA),s){let f=t[r];if(i==Ge.LengthDelimited&&o!=I.STRING&&o!=I.BYTES){let g=e.uint32()+e.pos;for(;e.pos<g;)f.push(l(e,o))}else f.push(l(e,o))}else t[r]=l(e,o);break;case"message":const c=n.T;s?t[r].push(ql(e,new c,a,n)):ci(t[r])?ql(e,t[r],a,n):(t[r]=ql(e,new c,a,n),c.fieldWrapper&&!n.oneof&&!n.repeated&&(t[r]=c.fieldWrapper.unwrapField(t[r])));break;case"map":let[u,d]=FA(n,e,a);t[r][u]=d;break}}function ql(t,e,n,i){const a=e.getType().runtime.bin,s=i==null?void 0:i.delimited;return a.readMessage(e,t,s?i.no:t.uint32(),n,s),e}function FA(t,e,n){const i=e.uint32(),a=e.pos+i;let s,r;for(;e.pos<a;){const[o]=e.tag();switch(o){case 1:s=Oc(e,t.K);break;case 2:switch(t.V.kind){case"scalar":r=Oc(e,t.V.T);break;case"enum":r=e.int32();break;case"message":r=ql(e,new t.V.T,n,void 0);break}break}}if(s===void 0&&(s=er(t.K,pa.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),r===void 0)switch(t.V.kind){case"scalar":r=er(t.V.T,pa.BIGINT);break;case"enum":r=t.V.T.values[0].no;break;case"message":r=new t.V.T;break}return[s,r]}function VA(t,e){const n=Oc(t,e);return typeof n=="bigint"?n.toString():n}function Oc(t,e){switch(e){case I.STRING:return t.string();case I.BOOL:return t.bool();case I.DOUBLE:return t.double();case I.FLOAT:return t.float();case I.INT32:return t.int32();case I.INT64:return t.int64();case I.UINT64:return t.uint64();case I.FIXED64:return t.fixed64();case I.BYTES:return t.bytes();case I.FIXED32:return t.fixed32();case I.SFIXED32:return t.sfixed32();case I.SFIXED64:return t.sfixed64();case I.SINT64:return t.sint64();case I.UINT32:return t.uint32();case I.SINT32:return t.sint32()}}function Rv(t,e,n,i){ze(e!==void 0);const a=t.repeated;switch(t.kind){case"scalar":case"enum":let s=t.kind=="enum"?I.INT32:t.T;if(a)if(ze(Array.isArray(e)),t.packed)GA(n,s,t.no,e);else for(const r of e)no(n,s,t.no,r);else no(n,s,t.no,e);break;case"message":if(a){ze(Array.isArray(e));for(const r of e)xv(n,i,t,r)}else xv(n,i,t,e);break;case"map":ze(typeof e=="object"&&e!=null);for(const[r,o]of Object.entries(e))HA(n,i,t,r,o);break}}function HA(t,e,n,i,a){t.tag(n.no,Ge.LengthDelimited),t.fork();let s=i;switch(n.K){case I.INT32:case I.FIXED32:case I.UINT32:case I.SFIXED32:case I.SINT32:s=Number.parseInt(i);break;case I.BOOL:ze(i=="true"||i=="false"),s=i=="true";break}switch(no(t,n.K,1,s),n.V.kind){case"scalar":no(t,n.V.T,2,a);break;case"enum":no(t,I.INT32,2,a);break;case"message":ze(a!==void 0),t.tag(2,Ge.LengthDelimited).bytes(a.toBinary(e));break}t.join()}function xv(t,e,n,i){const a=BT(n.T,i);n.delimited?t.tag(n.no,Ge.StartGroup).raw(a.toBinary(e)).tag(n.no,Ge.EndGroup):t.tag(n.no,Ge.LengthDelimited).bytes(a.toBinary(e))}function no(t,e,n,i){ze(i!==void 0);let[a,s]=qT(e);t.tag(n,a)[s](i)}function GA(t,e,n,i){if(!i.length)return;t.tag(n,Ge.LengthDelimited).fork();let[,a]=qT(e);for(let s=0;s<i.length;s++)t[a](i[s]);t.join()}function qT(t){let e=Ge.Varint;switch(t){case I.BYTES:case I.STRING:e=Ge.LengthDelimited;break;case I.DOUBLE:case I.FIXED64:case I.SFIXED64:e=Ge.Bit64;break;case I.FIXED32:case I.SFIXED32:case I.FLOAT:e=Ge.Bit32;break}const n=I[t].toLowerCase();return[e,n]}function KA(){return{setEnumType:wT,initPartial(t,e){if(t===void 0)return;const n=e.getType();for(const i of n.fields.byMember()){const a=i.localName,s=e,r=t;if(r[a]!=null)switch(i.kind){case"oneof":const o=r[a].case;if(o===void 0)continue;const l=i.findField(o);let c=r[a].value;l&&l.kind=="message"&&!ci(c,l.T)?c=new l.T(c):l&&l.kind==="scalar"&&l.T===I.BYTES&&(c=Rr(c)),s[a]={case:o,value:c};break;case"scalar":case"enum":let u=r[a];i.T===I.BYTES&&(u=i.repeated?u.map(Rr):Rr(u)),s[a]=u;break;case"map":switch(i.V.kind){case"scalar":case"enum":if(i.V.T===I.BYTES)for(const[h,g]of Object.entries(r[a]))s[a][h]=Rr(g);else Object.assign(s[a],r[a]);break;case"message":const f=i.V.T;for(const h of Object.keys(r[a])){let g=r[a][h];f.fieldWrapper||(g=new f(g)),s[a][h]=g}break}break;case"message":const d=i.T;if(i.repeated)s[a]=r[a].map(f=>ci(f,d)?f:new d(f));else{const f=r[a];d.fieldWrapper?d.typeName==="google.protobuf.BytesValue"?s[a]=Rr(f):s[a]=f:s[a]=ci(f,d)?f:new d(f)}break}}},equals(t,e,n){return e===n?!0:!e||!n?!1:t.fields.byMember().every(i=>{const a=e[i.localName],s=n[i.localName];if(i.repeated){if(a.length!==s.length)return!1;switch(i.kind){case"message":return a.every((r,o)=>i.T.equals(r,s[o]));case"scalar":return a.every((r,o)=>Ni(i.T,r,s[o]));case"enum":return a.every((r,o)=>Ni(I.INT32,r,s[o]))}throw new Error("repeated cannot contain ".concat(i.kind))}switch(i.kind){case"message":let r=a,o=s;return i.T.fieldWrapper&&(r!==void 0&&!ci(r)&&(r=i.T.fieldWrapper.wrapField(r)),o!==void 0&&!ci(o)&&(o=i.T.fieldWrapper.wrapField(o))),i.T.equals(r,o);case"enum":return Ni(I.INT32,a,s);case"scalar":return Ni(i.T,a,s);case"oneof":if(a.case!==s.case)return!1;const l=i.findField(a.case);if(l===void 0)return!0;switch(l.kind){case"message":return l.T.equals(a.value,s.value);case"enum":return Ni(I.INT32,a.value,s.value);case"scalar":return Ni(l.T,a.value,s.value)}throw new Error("oneof cannot contain ".concat(l.kind));case"map":const c=Object.keys(a).concat(Object.keys(s));switch(i.V.kind){case"message":const u=i.V.T;return c.every(f=>u.equals(a[f],s[f]));case"enum":return c.every(f=>Ni(I.INT32,a[f],s[f]));case"scalar":const d=i.V.T;return c.every(f=>Ni(d,a[f],s[f]))}break}})},clone(t){const e=t.getType(),n=new e,i=n;for(const a of e.fields.byMember()){const s=t[a.localName];let r;if(a.repeated)r=s.map(pl);else if(a.kind=="map"){r=i[a.localName];for(const[o,l]of Object.entries(s))r[o]=pl(l)}else a.kind=="oneof"?r=a.findField(s.case)?{case:s.case,value:pl(s.value)}:{case:void 0}:r=pl(s);i[a.localName]=r}for(const a of e.runtime.bin.listUnknownFields(t))e.runtime.bin.onUnknownField(i,a.no,a.wireType,a.data);return n}}}function pl(t){if(t===void 0)return t;if(ci(t))return t.clone();if(t instanceof Uint8Array){const e=new Uint8Array(t.byteLength);return e.set(t),e}return t}function Rr(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function YA(t,e,n){return{syntax:t,json:UA(),bin:zA(),util:Object.assign(Object.assign({},KA()),{newFieldList:e,initFields:n}),makeMessageType(i,a,s){return TA(this,i,a,s)},makeEnum:SA,makeEnumType:OT,getEnumType:yA,makeExtension(i,a,s){return OA(this,i,a,s)}}}class QA{constructor(e,n){this._fields=e,this._normalizer=n}findJsonName(e){if(!this.jsonNames){const n={};for(const i of this.list())n[i.jsonName]=n[i.name]=i;this.jsonNames=n}return this.jsonNames[e]}find(e){if(!this.numbers){const n={};for(const i of this.list())n[i.no]=i;this.numbers=n}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,n)=>e.no-n.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let n;for(const i of this.list())i.oneof?i.oneof!==n&&(n=i.oneof,e.push(n)):e.push(i)}return this.members}}function zT(t,e){const n=FT(t);return e?n:eM($A(n))}function JA(t){return zT(t,!1)}const XA=FT;function FT(t){let e=!1;const n=[];for(let i=0;i<t.length;i++){let a=t.charAt(i);switch(a){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":n.push(a),e=!1;break;default:e&&(e=!1,a=a.toUpperCase()),n.push(a);break}}return n.join("")}const ZA=new Set(["constructor","toString","toJSON","valueOf"]),WA=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),VT=t=>"".concat(t,"$"),$A=t=>WA.has(t)?VT(t):t,eM=t=>ZA.has(t)?VT(t):t;class tM{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=JA(e)}addField(e){ze(e.oneof===this,"field ".concat(e.name," not one of ").concat(this.name)),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let n=0;n<this.fields.length;n++)this._lookup[this.fields[n].localName]=this.fields[n]}return this._lookup[e]}}function nM(t,e){var n,i,a,s,r,o;const l=[];let c;for(const u of typeof t=="function"?t():t){const d=u;if(d.localName=zT(u.name,u.oneof!==void 0),d.jsonName=(n=u.jsonName)!==null&&n!==void 0?n:XA(u.name),d.repeated=(i=u.repeated)!==null&&i!==void 0?i:!1,u.kind=="scalar"&&(d.L=(a=u.L)!==null&&a!==void 0?a:pa.BIGINT),d.delimited=(s=u.delimited)!==null&&s!==void 0?s:!1,d.req=(r=u.req)!==null&&r!==void 0?r:!1,d.opt=(o=u.opt)!==null&&o!==void 0?o:!1,u.packed===void 0&&(d.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=I.BYTES&&u.T!=I.STRING),u.oneof!==void 0){const f=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!c||c.name!=f)&&(c=new tM(f)),d.oneof=c,c.addField(d)}l.push(d)}return l}const E=YA("proto3",t=>new QA(t,e=>nM(e)),t=>{for(const e of t.getType().fields.byMember()){if(e.opt)continue;const n=e.localName,i=t;if(e.repeated){i[n]=[];continue}switch(e.kind){case"oneof":i[n]={case:void 0};break;case"enum":i[n]=0;break;case"map":i[n]={};break;case"scalar":i[n]=er(e.T,e.L);break}}});class Lt extends Om{constructor(e){super(),this.seconds=Ue.zero,this.nanos=0,E.util.initPartial(e,this)}fromJson(e,n){if(typeof e!="string")throw new Error("cannot decode google.protobuf.Timestamp from JSON: ".concat(E.json.debug(e)));const i=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!i)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const a=Date.parse(i[1]+"-"+i[2]+"-"+i[3]+"T"+i[4]+":"+i[5]+":"+i[6]+(i[8]?i[8]:"Z"));if(Number.isNaN(a))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(a<Date.parse("0001-01-01T00:00:00Z")||a>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=Ue.parse(a/1e3),this.nanos=0,i[7]&&(this.nanos=parseInt("1"+i[7]+"0".repeat(9-i[7].length))-1e9),this}toJson(e){const n=Number(this.seconds)*1e3;if(n<Date.parse("0001-01-01T00:00:00Z")||n>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let i="Z";if(this.nanos>0){const a=(this.nanos+1e9).toString().substring(1);a.substring(3)==="000000"?i="."+a.substring(0,3)+"Z":a.substring(6)==="000"?i="."+a.substring(0,6)+"Z":i="."+a+"Z"}return new Date(n).toISOString().replace(".000Z",i)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Lt.fromDate(new Date)}static fromDate(e){const n=e.getTime();return new Lt({seconds:Ue.parse(Math.floor(n/1e3)),nanos:n%1e3*1e6})}static fromBinary(e,n){return new Lt().fromBinary(e,n)}static fromJson(e,n){return new Lt().fromJson(e,n)}static fromJsonString(e,n){return new Lt().fromJsonString(e,n)}static equals(e,n){return E.util.equals(Lt,e,n)}}Lt.runtime=E;Lt.typeName="google.protobuf.Timestamp";Lt.fields=E.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);const iM=E.makeMessageType("livekit.MetricsBatch",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Lt},{no:3,name:"str_data",kind:"scalar",T:9,repeated:!0},{no:4,name:"time_series",kind:"message",T:aM,repeated:!0},{no:5,name:"events",kind:"message",T:rM,repeated:!0}]),aM=E.makeMessageType("livekit.TimeSeriesMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"samples",kind:"message",T:sM,repeated:!0},{no:5,name:"rid",kind:"scalar",T:13}]),sM=E.makeMessageType("livekit.MetricSample",()=>[{no:1,name:"timestamp_ms",kind:"scalar",T:3},{no:2,name:"normalized_timestamp",kind:"message",T:Lt},{no:3,name:"value",kind:"scalar",T:2}]),rM=E.makeMessageType("livekit.EventMetric",()=>[{no:1,name:"label",kind:"scalar",T:13},{no:2,name:"participant_identity",kind:"scalar",T:13},{no:3,name:"track_sid",kind:"scalar",T:13},{no:4,name:"start_timestamp_ms",kind:"scalar",T:3},{no:5,name:"end_timestamp_ms",kind:"scalar",T:3,opt:!0},{no:6,name:"normalized_start_timestamp",kind:"message",T:Lt},{no:7,name:"normalized_end_timestamp",kind:"message",T:Lt,opt:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"rid",kind:"scalar",T:13}]),HT=E.makeEnum("livekit.BackupCodecPolicy",[{no:0,name:"PREFER_REGRESSION"},{no:1,name:"SIMULCAST"},{no:2,name:"REGRESSION"}]),xn=E.makeEnum("livekit.TrackType",[{no:0,name:"AUDIO"},{no:1,name:"VIDEO"},{no:2,name:"DATA"}]),Xe=E.makeEnum("livekit.TrackSource",[{no:0,name:"UNKNOWN"},{no:1,name:"CAMERA"},{no:2,name:"MICROPHONE"},{no:3,name:"SCREEN_SHARE"},{no:4,name:"SCREEN_SHARE_AUDIO"}]),Mm=E.makeEnum("livekit.VideoQuality",[{no:0,name:"LOW"},{no:1,name:"MEDIUM"},{no:2,name:"HIGH"},{no:3,name:"OFF"}]),Br=E.makeEnum("livekit.ConnectionQuality",[{no:0,name:"POOR"},{no:1,name:"GOOD"},{no:2,name:"EXCELLENT"},{no:3,name:"LOST"}]),ko=E.makeEnum("livekit.ClientConfigSetting",[{no:0,name:"UNSET"},{no:1,name:"DISABLED"},{no:2,name:"ENABLED"}]),An=E.makeEnum("livekit.DisconnectReason",[{no:0,name:"UNKNOWN_REASON"},{no:1,name:"CLIENT_INITIATED"},{no:2,name:"DUPLICATE_IDENTITY"},{no:3,name:"SERVER_SHUTDOWN"},{no:4,name:"PARTICIPANT_REMOVED"},{no:5,name:"ROOM_DELETED"},{no:6,name:"STATE_MISMATCH"},{no:7,name:"JOIN_FAILURE"},{no:8,name:"MIGRATION"},{no:9,name:"SIGNAL_CLOSE"},{no:10,name:"ROOM_CLOSED"},{no:11,name:"USER_UNAVAILABLE"},{no:12,name:"USER_REJECTED"},{no:13,name:"SIP_TRUNK_FAILURE"},{no:14,name:"CONNECTION_TIMEOUT"},{no:15,name:"MEDIA_FAILURE"}]),Da=E.makeEnum("livekit.ReconnectReason",[{no:0,name:"RR_UNKNOWN"},{no:1,name:"RR_SIGNAL_DISCONNECTED"},{no:2,name:"RR_PUBLISHER_FAILED"},{no:3,name:"RR_SUBSCRIBER_FAILED"},{no:4,name:"RR_SWITCH_CANDIDATE"}]),oM=E.makeEnum("livekit.SubscriptionError",[{no:0,name:"SE_UNKNOWN"},{no:1,name:"SE_CODEC_UNSUPPORTED"},{no:2,name:"SE_TRACK_NOTFOUND"}]),lt=E.makeEnum("livekit.AudioTrackFeature",[{no:0,name:"TF_STEREO"},{no:1,name:"TF_NO_DTX"},{no:2,name:"TF_AUTO_GAIN_CONTROL"},{no:3,name:"TF_ECHO_CANCELLATION"},{no:4,name:"TF_NOISE_SUPPRESSION"},{no:5,name:"TF_ENHANCED_NOISE_CANCELLATION"},{no:6,name:"TF_PRECONNECT_BUFFER"}]),du=E.makeMessageType("livekit.Room",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"empty_timeout",kind:"scalar",T:13},{no:14,name:"departure_timeout",kind:"scalar",T:13},{no:4,name:"max_participants",kind:"scalar",T:13},{no:5,name:"creation_time",kind:"scalar",T:3},{no:15,name:"creation_time_ms",kind:"scalar",T:3},{no:6,name:"turn_password",kind:"scalar",T:9},{no:7,name:"enabled_codecs",kind:"message",T:Ac,repeated:!0},{no:8,name:"metadata",kind:"scalar",T:9},{no:9,name:"num_participants",kind:"scalar",T:13},{no:11,name:"num_publishers",kind:"scalar",T:13},{no:10,name:"active_recording",kind:"scalar",T:8},{no:13,name:"version",kind:"message",T:iC}]),Ac=E.makeMessageType("livekit.Codec",()=>[{no:1,name:"mime",kind:"scalar",T:9},{no:2,name:"fmtp_line",kind:"scalar",T:9}]),lM=E.makeMessageType("livekit.ParticipantPermission",()=>[{no:1,name:"can_subscribe",kind:"scalar",T:8},{no:2,name:"can_publish",kind:"scalar",T:8},{no:3,name:"can_publish_data",kind:"scalar",T:8},{no:9,name:"can_publish_sources",kind:"enum",T:E.getEnumType(Xe),repeated:!0},{no:7,name:"hidden",kind:"scalar",T:8},{no:8,name:"recorder",kind:"scalar",T:8},{no:10,name:"can_update_metadata",kind:"scalar",T:8},{no:11,name:"agent",kind:"scalar",T:8},{no:12,name:"can_subscribe_metrics",kind:"scalar",T:8}]),Ka=E.makeMessageType("livekit.ParticipantInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"identity",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:E.getEnumType(Ps)},{no:4,name:"tracks",kind:"message",T:Es,repeated:!0},{no:5,name:"metadata",kind:"scalar",T:9},{no:6,name:"joined_at",kind:"scalar",T:3},{no:17,name:"joined_at_ms",kind:"scalar",T:3},{no:9,name:"name",kind:"scalar",T:9},{no:10,name:"version",kind:"scalar",T:13},{no:11,name:"permission",kind:"message",T:lM},{no:12,name:"region",kind:"scalar",T:9},{no:13,name:"is_publisher",kind:"scalar",T:8},{no:14,name:"kind",kind:"enum",T:E.getEnumType(Eo)},{no:15,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:16,name:"disconnect_reason",kind:"enum",T:E.getEnumType(An)},{no:18,name:"kind_details",kind:"enum",T:E.getEnumType(cM),repeated:!0},{no:19,name:"data_tracks",kind:"message",T:Dm,repeated:!0}]),Ps=E.makeEnum("livekit.ParticipantInfo.State",[{no:0,name:"JOINING"},{no:1,name:"JOINED"},{no:2,name:"ACTIVE"},{no:3,name:"DISCONNECTED"}]),Eo=E.makeEnum("livekit.ParticipantInfo.Kind",[{no:0,name:"STANDARD"},{no:1,name:"INGRESS"},{no:2,name:"EGRESS"},{no:3,name:"SIP"},{no:4,name:"AGENT"},{no:7,name:"CONNECTOR"},{no:8,name:"BRIDGE"}]),cM=E.makeEnum("livekit.ParticipantInfo.KindDetail",[{no:0,name:"CLOUD_AGENT"},{no:1,name:"FORWARDED"},{no:2,name:"CONNECTOR_WHATSAPP"},{no:3,name:"CONNECTOR_TWILIO"},{no:4,name:"BRIDGE_RTSP"}]),Ke=E.makeEnum("livekit.Encryption.Type",[{no:0,name:"NONE"},{no:1,name:"GCM"},{no:2,name:"CUSTOM"}]),uM=E.makeMessageType("livekit.SimulcastCodecInfo",()=>[{no:1,name:"mime_type",kind:"scalar",T:9},{no:2,name:"mid",kind:"scalar",T:9},{no:3,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:oa,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:E.getEnumType(GT)},{no:6,name:"sdp_cid",kind:"scalar",T:9}]),Es=E.makeMessageType("livekit.TrackInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"type",kind:"enum",T:E.getEnumType(xn)},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"muted",kind:"scalar",T:8},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"simulcast",kind:"scalar",T:8},{no:8,name:"disable_dtx",kind:"scalar",T:8},{no:9,name:"source",kind:"enum",T:E.getEnumType(Xe)},{no:10,name:"layers",kind:"message",T:oa,repeated:!0},{no:11,name:"mime_type",kind:"scalar",T:9},{no:12,name:"mid",kind:"scalar",T:9},{no:13,name:"codecs",kind:"message",T:uM,repeated:!0},{no:14,name:"stereo",kind:"scalar",T:8},{no:15,name:"disable_red",kind:"scalar",T:8},{no:16,name:"encryption",kind:"enum",T:E.getEnumType(Ke)},{no:17,name:"stream",kind:"scalar",T:9},{no:18,name:"version",kind:"message",T:iC},{no:19,name:"audio_features",kind:"enum",T:E.getEnumType(lt),repeated:!0},{no:20,name:"backup_codec_policy",kind:"enum",T:E.getEnumType(HT)}]),Dm=E.makeMessageType("livekit.DataTrackInfo",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"sid",kind:"scalar",T:9},{no:3,name:"name",kind:"scalar",T:9},{no:4,name:"encryption",kind:"enum",T:E.getEnumType(Ke)}]),dM=E.makeMessageType("livekit.DataTrackSubscriptionOptions",()=>[{no:1,name:"target_fps",kind:"scalar",T:13,opt:!0}]),oa=E.makeMessageType("livekit.VideoLayer",()=>[{no:1,name:"quality",kind:"enum",T:E.getEnumType(Mm)},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"ssrc",kind:"scalar",T:13},{no:6,name:"spatial_layer",kind:"scalar",T:5},{no:7,name:"rid",kind:"scalar",T:9},{no:8,name:"repair_ssrc",kind:"scalar",T:13}]),GT=E.makeEnum("livekit.VideoLayer.Mode",[{no:0,name:"MODE_UNUSED"},{no:1,name:"ONE_SPATIAL_LAYER_PER_STREAM"},{no:2,name:"MULTIPLE_SPATIAL_LAYERS_PER_STREAM"},{no:3,name:"ONE_SPATIAL_LAYER_PER_STREAM_INCOMPLETE_RTCP_SR"}]),_t=E.makeMessageType("livekit.DataPacket",()=>[{no:1,name:"kind",kind:"enum",T:E.getEnumType(ae)},{no:4,name:"participant_identity",kind:"scalar",T:9},{no:5,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:2,name:"user",kind:"message",T:Nm,oneof:"value"},{no:3,name:"speaker",kind:"message",T:fM,oneof:"value"},{no:6,name:"sip_dtmf",kind:"message",T:JT,oneof:"value"},{no:7,name:"transcription",kind:"message",T:hM,oneof:"value"},{no:8,name:"metrics",kind:"message",T:iM,oneof:"value"},{no:9,name:"chat_message",kind:"message",T:Mc,oneof:"value"},{no:10,name:"rpc_request",kind:"message",T:Pm,oneof:"value"},{no:11,name:"rpc_ack",kind:"message",T:Lm,oneof:"value"},{no:12,name:"rpc_response",kind:"message",T:Um,oneof:"value"},{no:13,name:"stream_header",kind:"message",T:Dc,oneof:"value"},{no:14,name:"stream_chunk",kind:"message",T:Nc,oneof:"value"},{no:15,name:"stream_trailer",kind:"message",T:Pc,oneof:"value"},{no:18,name:"encrypted_packet",kind:"message",T:KT,oneof:"value"},{no:16,name:"sequence",kind:"scalar",T:13},{no:17,name:"participant_sid",kind:"scalar",T:9}]),ae=E.makeEnum("livekit.DataPacket.Kind",[{no:0,name:"RELIABLE"},{no:1,name:"LOSSY"}]),KT=E.makeMessageType("livekit.EncryptedPacket",()=>[{no:1,name:"encryption_type",kind:"enum",T:E.getEnumType(Ke)},{no:2,name:"iv",kind:"scalar",T:12},{no:3,name:"key_index",kind:"scalar",T:13},{no:4,name:"encrypted_value",kind:"scalar",T:12}]),YT=E.makeMessageType("livekit.EncryptedPacketPayload",()=>[{no:1,name:"user",kind:"message",T:Nm,oneof:"value"},{no:3,name:"chat_message",kind:"message",T:Mc,oneof:"value"},{no:4,name:"rpc_request",kind:"message",T:Pm,oneof:"value"},{no:5,name:"rpc_ack",kind:"message",T:Lm,oneof:"value"},{no:6,name:"rpc_response",kind:"message",T:Um,oneof:"value"},{no:7,name:"stream_header",kind:"message",T:Dc,oneof:"value"},{no:8,name:"stream_chunk",kind:"message",T:Nc,oneof:"value"},{no:9,name:"stream_trailer",kind:"message",T:Pc,oneof:"value"}]),fM=E.makeMessageType("livekit.ActiveSpeakerUpdate",()=>[{no:1,name:"speakers",kind:"message",T:QT,repeated:!0}]),QT=E.makeMessageType("livekit.SpeakerInfo",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"level",kind:"scalar",T:2},{no:3,name:"active",kind:"scalar",T:8}]),Nm=E.makeMessageType("livekit.UserPacket",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:5,name:"participant_identity",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12},{no:3,name:"destination_sids",kind:"scalar",T:9,repeated:!0},{no:6,name:"destination_identities",kind:"scalar",T:9,repeated:!0},{no:4,name:"topic",kind:"scalar",T:9,opt:!0},{no:8,name:"id",kind:"scalar",T:9,opt:!0},{no:9,name:"start_time",kind:"scalar",T:4,opt:!0},{no:10,name:"end_time",kind:"scalar",T:4,opt:!0},{no:11,name:"nonce",kind:"scalar",T:12}]),JT=E.makeMessageType("livekit.SipDTMF",()=>[{no:3,name:"code",kind:"scalar",T:13},{no:4,name:"digit",kind:"scalar",T:9}]),hM=E.makeMessageType("livekit.Transcription",()=>[{no:2,name:"transcribed_participant_identity",kind:"scalar",T:9},{no:3,name:"track_id",kind:"scalar",T:9},{no:4,name:"segments",kind:"message",T:mM,repeated:!0}]),mM=E.makeMessageType("livekit.TranscriptionSegment",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"text",kind:"scalar",T:9},{no:3,name:"start_time",kind:"scalar",T:4},{no:4,name:"end_time",kind:"scalar",T:4},{no:5,name:"final",kind:"scalar",T:8},{no:6,name:"language",kind:"scalar",T:9}]),Mc=E.makeMessageType("livekit.ChatMessage",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"edit_timestamp",kind:"scalar",T:3,opt:!0},{no:4,name:"message",kind:"scalar",T:9},{no:5,name:"deleted",kind:"scalar",T:8},{no:6,name:"generated",kind:"scalar",T:8}]),Pm=E.makeMessageType("livekit.RpcRequest",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"method",kind:"scalar",T:9},{no:3,name:"payload",kind:"scalar",T:9},{no:4,name:"response_timeout_ms",kind:"scalar",T:13},{no:5,name:"version",kind:"scalar",T:13}]),Lm=E.makeMessageType("livekit.RpcAck",()=>[{no:1,name:"request_id",kind:"scalar",T:9}]),Um=E.makeMessageType("livekit.RpcResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:9,oneof:"value"},{no:3,name:"error",kind:"message",T:XT,oneof:"value"}]),XT=E.makeMessageType("livekit.RpcError",()=>[{no:1,name:"code",kind:"scalar",T:13},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"data",kind:"scalar",T:9}]),ZT=E.makeMessageType("livekit.ParticipantTracks",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sids",kind:"scalar",T:9,repeated:!0}]),WT=E.makeMessageType("livekit.ServerInfo",()=>[{no:1,name:"edition",kind:"enum",T:E.getEnumType($T)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"region",kind:"scalar",T:9},{no:5,name:"node_id",kind:"scalar",T:9},{no:6,name:"debug_info",kind:"scalar",T:9},{no:7,name:"agent_protocol",kind:"scalar",T:5}]),$T=E.makeEnum("livekit.ServerInfo.Edition",[{no:0,name:"Standard"},{no:1,name:"Cloud"}]),eC=E.makeMessageType("livekit.ClientInfo",()=>[{no:1,name:"sdk",kind:"enum",T:E.getEnumType(tC)},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"protocol",kind:"scalar",T:5},{no:4,name:"os",kind:"scalar",T:9},{no:5,name:"os_version",kind:"scalar",T:9},{no:6,name:"device_model",kind:"scalar",T:9},{no:7,name:"browser",kind:"scalar",T:9},{no:8,name:"browser_version",kind:"scalar",T:9},{no:9,name:"address",kind:"scalar",T:9},{no:10,name:"network",kind:"scalar",T:9},{no:11,name:"other_sdks",kind:"scalar",T:9}]),tC=E.makeEnum("livekit.ClientInfo.SDK",[{no:0,name:"UNKNOWN"},{no:1,name:"JS"},{no:2,name:"SWIFT"},{no:3,name:"ANDROID"},{no:4,name:"FLUTTER"},{no:5,name:"GO"},{no:6,name:"UNITY"},{no:7,name:"REACT_NATIVE"},{no:8,name:"RUST"},{no:9,name:"PYTHON"},{no:10,name:"CPP"},{no:11,name:"UNITY_WEB"},{no:12,name:"NODE"},{no:13,name:"UNREAL"},{no:14,name:"ESP32"}]),nC=E.makeMessageType("livekit.ClientConfiguration",()=>[{no:1,name:"video",kind:"message",T:wv},{no:2,name:"screen",kind:"message",T:wv},{no:3,name:"resume_connection",kind:"enum",T:E.getEnumType(ko)},{no:4,name:"disabled_codecs",kind:"message",T:pM},{no:5,name:"force_relay",kind:"enum",T:E.getEnumType(ko)}]),wv=E.makeMessageType("livekit.VideoConfiguration",()=>[{no:1,name:"hardware_encoder",kind:"enum",T:E.getEnumType(ko)}]),pM=E.makeMessageType("livekit.DisabledCodecs",()=>[{no:1,name:"codecs",kind:"message",T:Ac,repeated:!0},{no:2,name:"publish",kind:"message",T:Ac,repeated:!0}]),iC=E.makeMessageType("livekit.TimedVersion",()=>[{no:1,name:"unix_micro",kind:"scalar",T:3},{no:2,name:"ticks",kind:"scalar",T:5}]),Bf=E.makeEnum("livekit.DataStream.OperationType",[{no:0,name:"CREATE"},{no:1,name:"UPDATE"},{no:2,name:"DELETE"},{no:3,name:"REACTION"}]),aC=E.makeMessageType("livekit.DataStream.TextHeader",()=>[{no:1,name:"operation_type",kind:"enum",T:E.getEnumType(Bf)},{no:2,name:"version",kind:"scalar",T:5},{no:3,name:"reply_to_stream_id",kind:"scalar",T:9},{no:4,name:"attached_stream_ids",kind:"scalar",T:9,repeated:!0},{no:5,name:"generated",kind:"scalar",T:8}],{localName:"DataStream_TextHeader"}),sC=E.makeMessageType("livekit.DataStream.ByteHeader",()=>[{no:1,name:"name",kind:"scalar",T:9}],{localName:"DataStream_ByteHeader"}),Dc=E.makeMessageType("livekit.DataStream.Header",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"timestamp",kind:"scalar",T:3},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"mime_type",kind:"scalar",T:9},{no:5,name:"total_length",kind:"scalar",T:4,opt:!0},{no:7,name:"encryption_type",kind:"enum",T:E.getEnumType(Ke)},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:9,name:"text_header",kind:"message",T:aC,oneof:"content_header"},{no:10,name:"byte_header",kind:"message",T:sC,oneof:"content_header"}],{localName:"DataStream_Header"}),Nc=E.makeMessageType("livekit.DataStream.Chunk",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"chunk_index",kind:"scalar",T:4},{no:3,name:"content",kind:"scalar",T:12},{no:4,name:"version",kind:"scalar",T:5},{no:5,name:"iv",kind:"scalar",T:12,opt:!0}],{localName:"DataStream_Chunk"}),Pc=E.makeMessageType("livekit.DataStream.Trailer",()=>[{no:1,name:"stream_id",kind:"scalar",T:9},{no:2,name:"reason",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"DataStream_Trailer"}),gM=E.makeMessageType("livekit.SubscribedAudioCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"enabled",kind:"scalar",T:8}]),wn=E.makeEnum("livekit.SignalTarget",[{no:0,name:"PUBLISHER"},{no:1,name:"SUBSCRIBER"}]),qf=E.makeEnum("livekit.StreamState",[{no:0,name:"ACTIVE"},{no:1,name:"PAUSED"}]),vM=E.makeEnum("livekit.CandidateProtocol",[{no:0,name:"UDP"},{no:1,name:"TCP"},{no:2,name:"TLS"}]),bM=E.makeMessageType("livekit.SignalRequest",()=>[{no:1,name:"offer",kind:"message",T:ga,oneof:"message"},{no:2,name:"answer",kind:"message",T:ga,oneof:"message"},{no:3,name:"trickle",kind:"message",T:fu,oneof:"message"},{no:4,name:"add_track",kind:"message",T:_o,oneof:"message"},{no:5,name:"mute",kind:"message",T:hu,oneof:"message"},{no:6,name:"subscription",kind:"message",T:mu,oneof:"message"},{no:7,name:"track_setting",kind:"message",T:cC,oneof:"message"},{no:8,name:"leave",kind:"message",T:pu,oneof:"message"},{no:10,name:"update_layers",kind:"message",T:dC,oneof:"message"},{no:11,name:"subscription_permission",kind:"message",T:mC,oneof:"message"},{no:12,name:"sync_state",kind:"message",T:zm,oneof:"message"},{no:13,name:"simulate",kind:"message",T:jn,oneof:"message"},{no:14,name:"ping",kind:"scalar",T:3,oneof:"message"},{no:15,name:"update_metadata",kind:"message",T:Bm,oneof:"message"},{no:16,name:"ping_req",kind:"message",T:vC,oneof:"message"},{no:17,name:"update_audio_track",kind:"message",T:jm,oneof:"message"},{no:18,name:"update_video_track",kind:"message",T:uC,oneof:"message"},{no:19,name:"publish_data_track_request",kind:"message",T:rC,oneof:"message"},{no:20,name:"unpublish_data_track_request",kind:"message",T:lC,oneof:"message"},{no:21,name:"update_data_subscription",kind:"message",T:RM,oneof:"message"}]),Ov=E.makeMessageType("livekit.SignalResponse",()=>[{no:1,name:"join",kind:"message",T:CM,oneof:"message"},{no:2,name:"answer",kind:"message",T:ga,oneof:"message"},{no:3,name:"offer",kind:"message",T:ga,oneof:"message"},{no:4,name:"trickle",kind:"message",T:fu,oneof:"message"},{no:5,name:"update",kind:"message",T:_M,oneof:"message"},{no:6,name:"track_published",kind:"message",T:Im,oneof:"message"},{no:8,name:"leave",kind:"message",T:pu,oneof:"message"},{no:9,name:"mute",kind:"message",T:hu,oneof:"message"},{no:10,name:"speakers_changed",kind:"message",T:wM,oneof:"message"},{no:11,name:"room_update",kind:"message",T:OM,oneof:"message"},{no:12,name:"connection_quality",kind:"message",T:MM,oneof:"message"},{no:13,name:"stream_state_update",kind:"message",T:NM,oneof:"message"},{no:14,name:"subscribed_quality_update",kind:"message",T:LM,oneof:"message"},{no:15,name:"subscription_permission_update",kind:"message",T:IM,oneof:"message"},{no:16,name:"refresh_token",kind:"scalar",T:9,oneof:"message"},{no:17,name:"track_unpublished",kind:"message",T:EM,oneof:"message"},{no:18,name:"pong",kind:"scalar",T:3,oneof:"message"},{no:19,name:"reconnect",kind:"message",T:kM,oneof:"message"},{no:20,name:"pong_resp",kind:"message",T:BM,oneof:"message"},{no:21,name:"subscription_response",kind:"message",T:FM,oneof:"message"},{no:22,name:"request_response",kind:"message",T:VM,oneof:"message"},{no:23,name:"track_subscribed",kind:"message",T:HM,oneof:"message"},{no:24,name:"room_moved",kind:"message",T:jM,oneof:"message"},{no:25,name:"media_sections_requirement",kind:"message",T:QM,oneof:"message"},{no:26,name:"subscribed_audio_codec_update",kind:"message",T:UM,oneof:"message"},{no:27,name:"publish_data_track_response",kind:"message",T:oC,oneof:"message"},{no:28,name:"unpublish_data_track_response",kind:"message",T:yM,oneof:"message"},{no:29,name:"data_track_subscriber_handles",kind:"message",T:SM,oneof:"message"}]),zf=E.makeMessageType("livekit.SimulcastCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"cid",kind:"scalar",T:9},{no:4,name:"layers",kind:"message",T:oa,repeated:!0},{no:5,name:"video_layer_mode",kind:"enum",T:E.getEnumType(GT)}]),_o=E.makeMessageType("livekit.AddTrackRequest",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:E.getEnumType(xn)},{no:4,name:"width",kind:"scalar",T:13},{no:5,name:"height",kind:"scalar",T:13},{no:6,name:"muted",kind:"scalar",T:8},{no:7,name:"disable_dtx",kind:"scalar",T:8},{no:8,name:"source",kind:"enum",T:E.getEnumType(Xe)},{no:9,name:"layers",kind:"message",T:oa,repeated:!0},{no:10,name:"simulcast_codecs",kind:"message",T:zf,repeated:!0},{no:11,name:"sid",kind:"scalar",T:9},{no:12,name:"stereo",kind:"scalar",T:8},{no:13,name:"disable_red",kind:"scalar",T:8},{no:14,name:"encryption",kind:"enum",T:E.getEnumType(Ke)},{no:15,name:"stream",kind:"scalar",T:9},{no:16,name:"backup_codec_policy",kind:"enum",T:E.getEnumType(HT)},{no:17,name:"audio_features",kind:"enum",T:E.getEnumType(lt),repeated:!0}]),rC=E.makeMessageType("livekit.PublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"encryption",kind:"enum",T:E.getEnumType(Ke)}]),oC=E.makeMessageType("livekit.PublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:Dm}]),lC=E.makeMessageType("livekit.UnpublishDataTrackRequest",()=>[{no:1,name:"pub_handle",kind:"scalar",T:13}]),yM=E.makeMessageType("livekit.UnpublishDataTrackResponse",()=>[{no:1,name:"info",kind:"message",T:Dm}]),SM=E.makeMessageType("livekit.DataTrackSubscriberHandles",()=>[{no:1,name:"sub_handles",kind:"map",K:13,V:{kind:"message",T:TM}}]),TM=E.makeMessageType("livekit.DataTrackSubscriberHandles.PublishedDataTrack",()=>[{no:1,name:"publisher_identity",kind:"scalar",T:9},{no:2,name:"publisher_sid",kind:"scalar",T:9},{no:3,name:"track_sid",kind:"scalar",T:9}],{localName:"DataTrackSubscriberHandles_PublishedDataTrack"}),fu=E.makeMessageType("livekit.TrickleRequest",()=>[{no:1,name:"candidateInit",kind:"scalar",T:9},{no:2,name:"target",kind:"enum",T:E.getEnumType(wn)},{no:3,name:"final",kind:"scalar",T:8}]),hu=E.makeMessageType("livekit.MuteTrackRequest",()=>[{no:1,name:"sid",kind:"scalar",T:9},{no:2,name:"muted",kind:"scalar",T:8}]),CM=E.makeMessageType("livekit.JoinResponse",()=>[{no:1,name:"room",kind:"message",T:du},{no:2,name:"participant",kind:"message",T:Ka},{no:3,name:"other_participants",kind:"message",T:Ka,repeated:!0},{no:4,name:"server_version",kind:"scalar",T:9},{no:5,name:"ice_servers",kind:"message",T:fC,repeated:!0},{no:6,name:"subscriber_primary",kind:"scalar",T:8},{no:7,name:"alternative_url",kind:"scalar",T:9},{no:8,name:"client_configuration",kind:"message",T:nC},{no:9,name:"server_region",kind:"scalar",T:9},{no:10,name:"ping_timeout",kind:"scalar",T:5},{no:11,name:"ping_interval",kind:"scalar",T:5},{no:12,name:"server_info",kind:"message",T:WT},{no:13,name:"sif_trailer",kind:"scalar",T:12},{no:14,name:"enabled_publish_codecs",kind:"message",T:Ac,repeated:!0},{no:15,name:"fast_publish",kind:"scalar",T:8}]),kM=E.makeMessageType("livekit.ReconnectResponse",()=>[{no:1,name:"ice_servers",kind:"message",T:fC,repeated:!0},{no:2,name:"client_configuration",kind:"message",T:nC},{no:3,name:"server_info",kind:"message",T:WT},{no:4,name:"last_message_seq",kind:"scalar",T:13}]),Im=E.makeMessageType("livekit.TrackPublishedResponse",()=>[{no:1,name:"cid",kind:"scalar",T:9},{no:2,name:"track",kind:"message",T:Es}]),EM=E.makeMessageType("livekit.TrackUnpublishedResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),ga=E.makeMessageType("livekit.SessionDescription",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"id",kind:"scalar",T:13},{no:4,name:"mid_to_track_id",kind:"map",K:9,V:{kind:"scalar",T:9}}]),_M=E.makeMessageType("livekit.ParticipantUpdate",()=>[{no:1,name:"participants",kind:"message",T:Ka,repeated:!0}]),mu=E.makeMessageType("livekit.UpdateSubscription",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"participant_tracks",kind:"message",T:ZT,repeated:!0}]),RM=E.makeMessageType("livekit.UpdateDataSubscription",()=>[{no:1,name:"updates",kind:"message",T:xM,repeated:!0}]),xM=E.makeMessageType("livekit.UpdateDataSubscription.Update",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribe",kind:"scalar",T:8},{no:3,name:"options",kind:"message",T:dM}],{localName:"UpdateDataSubscription_Update"}),cC=E.makeMessageType("livekit.UpdateTrackSettings",()=>[{no:1,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:3,name:"disabled",kind:"scalar",T:8},{no:4,name:"quality",kind:"enum",T:E.getEnumType(Mm)},{no:5,name:"width",kind:"scalar",T:13},{no:6,name:"height",kind:"scalar",T:13},{no:7,name:"fps",kind:"scalar",T:13},{no:8,name:"priority",kind:"scalar",T:13}]),jm=E.makeMessageType("livekit.UpdateLocalAudioTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"features",kind:"enum",T:E.getEnumType(lt),repeated:!0}]),uC=E.makeMessageType("livekit.UpdateLocalVideoTrack",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"width",kind:"scalar",T:13},{no:3,name:"height",kind:"scalar",T:13}]),pu=E.makeMessageType("livekit.LeaveRequest",()=>[{no:1,name:"can_reconnect",kind:"scalar",T:8},{no:2,name:"reason",kind:"enum",T:E.getEnumType(An)},{no:3,name:"action",kind:"enum",T:E.getEnumType(Ls)},{no:4,name:"regions",kind:"message",T:qM}]),Ls=E.makeEnum("livekit.LeaveRequest.Action",[{no:0,name:"DISCONNECT"},{no:1,name:"RESUME"},{no:2,name:"RECONNECT"}]),dC=E.makeMessageType("livekit.UpdateVideoLayers",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"layers",kind:"message",T:oa,repeated:!0}]),Bm=E.makeMessageType("livekit.UpdateParticipantMetadata",()=>[{no:1,name:"metadata",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:4,name:"request_id",kind:"scalar",T:13}]),fC=E.makeMessageType("livekit.ICEServer",()=>[{no:1,name:"urls",kind:"scalar",T:9,repeated:!0},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"credential",kind:"scalar",T:9}]),wM=E.makeMessageType("livekit.SpeakersChanged",()=>[{no:1,name:"speakers",kind:"message",T:QT,repeated:!0}]),OM=E.makeMessageType("livekit.RoomUpdate",()=>[{no:1,name:"room",kind:"message",T:du}]),AM=E.makeMessageType("livekit.ConnectionQualityInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"quality",kind:"enum",T:E.getEnumType(Br)},{no:3,name:"score",kind:"scalar",T:2}]),MM=E.makeMessageType("livekit.ConnectionQualityUpdate",()=>[{no:1,name:"updates",kind:"message",T:AM,repeated:!0}]),DM=E.makeMessageType("livekit.StreamStateInfo",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"state",kind:"enum",T:E.getEnumType(qf)}]),NM=E.makeMessageType("livekit.StreamStateUpdate",()=>[{no:1,name:"stream_states",kind:"message",T:DM,repeated:!0}]),qm=E.makeMessageType("livekit.SubscribedQuality",()=>[{no:1,name:"quality",kind:"enum",T:E.getEnumType(Mm)},{no:2,name:"enabled",kind:"scalar",T:8}]),PM=E.makeMessageType("livekit.SubscribedCodec",()=>[{no:1,name:"codec",kind:"scalar",T:9},{no:2,name:"qualities",kind:"message",T:qm,repeated:!0}]),LM=E.makeMessageType("livekit.SubscribedQualityUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_qualities",kind:"message",T:qm,repeated:!0},{no:3,name:"subscribed_codecs",kind:"message",T:PM,repeated:!0}]),UM=E.makeMessageType("livekit.SubscribedAudioCodecUpdate",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"subscribed_audio_codecs",kind:"message",T:gM,repeated:!0}]),hC=E.makeMessageType("livekit.TrackPermission",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"all_tracks",kind:"scalar",T:8},{no:3,name:"track_sids",kind:"scalar",T:9,repeated:!0},{no:4,name:"participant_identity",kind:"scalar",T:9}]),mC=E.makeMessageType("livekit.SubscriptionPermission",()=>[{no:1,name:"all_participants",kind:"scalar",T:8},{no:2,name:"track_permissions",kind:"message",T:hC,repeated:!0}]),IM=E.makeMessageType("livekit.SubscriptionPermissionUpdate",()=>[{no:1,name:"participant_sid",kind:"scalar",T:9},{no:2,name:"track_sid",kind:"scalar",T:9},{no:3,name:"allowed",kind:"scalar",T:8}]),jM=E.makeMessageType("livekit.RoomMovedResponse",()=>[{no:1,name:"room",kind:"message",T:du},{no:2,name:"token",kind:"scalar",T:9},{no:3,name:"participant",kind:"message",T:Ka},{no:4,name:"other_participants",kind:"message",T:Ka,repeated:!0}]),zm=E.makeMessageType("livekit.SyncState",()=>[{no:1,name:"answer",kind:"message",T:ga},{no:2,name:"subscription",kind:"message",T:mu},{no:3,name:"publish_tracks",kind:"message",T:Im,repeated:!0},{no:4,name:"data_channels",kind:"message",T:gC,repeated:!0},{no:5,name:"offer",kind:"message",T:ga},{no:6,name:"track_sids_disabled",kind:"scalar",T:9,repeated:!0},{no:7,name:"datachannel_receive_states",kind:"message",T:pC,repeated:!0},{no:8,name:"publish_data_tracks",kind:"message",T:oC,repeated:!0}]),pC=E.makeMessageType("livekit.DataChannelReceiveState",()=>[{no:1,name:"publisher_sid",kind:"scalar",T:9},{no:2,name:"last_seq",kind:"scalar",T:13}]),gC=E.makeMessageType("livekit.DataChannelInfo",()=>[{no:1,name:"label",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:13},{no:3,name:"target",kind:"enum",T:E.getEnumType(wn)}]),jn=E.makeMessageType("livekit.SimulateScenario",()=>[{no:1,name:"speaker_update",kind:"scalar",T:5,oneof:"scenario"},{no:2,name:"node_failure",kind:"scalar",T:8,oneof:"scenario"},{no:3,name:"migration",kind:"scalar",T:8,oneof:"scenario"},{no:4,name:"server_leave",kind:"scalar",T:8,oneof:"scenario"},{no:5,name:"switch_candidate_protocol",kind:"enum",T:E.getEnumType(vM),oneof:"scenario"},{no:6,name:"subscriber_bandwidth",kind:"scalar",T:3,oneof:"scenario"},{no:7,name:"disconnect_signal_on_resume",kind:"scalar",T:8,oneof:"scenario"},{no:8,name:"disconnect_signal_on_resume_no_messages",kind:"scalar",T:8,oneof:"scenario"},{no:9,name:"leave_request_full_reconnect",kind:"scalar",T:8,oneof:"scenario"}]),vC=E.makeMessageType("livekit.Ping",()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"rtt",kind:"scalar",T:3}]),BM=E.makeMessageType("livekit.Pong",()=>[{no:1,name:"last_ping_timestamp",kind:"scalar",T:3},{no:2,name:"timestamp",kind:"scalar",T:3}]),qM=E.makeMessageType("livekit.RegionSettings",()=>[{no:1,name:"regions",kind:"message",T:zM,repeated:!0}]),zM=E.makeMessageType("livekit.RegionInfo",()=>[{no:1,name:"region",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9},{no:3,name:"distance",kind:"scalar",T:3}]),FM=E.makeMessageType("livekit.SubscriptionResponse",()=>[{no:1,name:"track_sid",kind:"scalar",T:9},{no:2,name:"err",kind:"enum",T:E.getEnumType(oM)}]),VM=E.makeMessageType("livekit.RequestResponse",()=>[{no:1,name:"request_id",kind:"scalar",T:13},{no:2,name:"reason",kind:"enum",T:E.getEnumType(Fm)},{no:3,name:"message",kind:"scalar",T:9},{no:4,name:"trickle",kind:"message",T:fu,oneof:"request"},{no:5,name:"add_track",kind:"message",T:_o,oneof:"request"},{no:6,name:"mute",kind:"message",T:hu,oneof:"request"},{no:7,name:"update_metadata",kind:"message",T:Bm,oneof:"request"},{no:8,name:"update_audio_track",kind:"message",T:jm,oneof:"request"},{no:9,name:"update_video_track",kind:"message",T:uC,oneof:"request"},{no:10,name:"publish_data_track",kind:"message",T:rC,oneof:"request"},{no:11,name:"unpublish_data_track",kind:"message",T:lC,oneof:"request"}]),Fm=E.makeEnum("livekit.RequestResponse.Reason",[{no:0,name:"OK"},{no:1,name:"NOT_FOUND"},{no:2,name:"NOT_ALLOWED"},{no:3,name:"LIMIT_EXCEEDED"},{no:4,name:"QUEUED"},{no:5,name:"UNSUPPORTED_TYPE"},{no:6,name:"UNCLASSIFIED_ERROR"},{no:7,name:"INVALID_HANDLE"},{no:8,name:"INVALID_NAME"},{no:9,name:"DUPLICATE_HANDLE"},{no:10,name:"DUPLICATE_NAME"}]),HM=E.makeMessageType("livekit.TrackSubscribed",()=>[{no:1,name:"track_sid",kind:"scalar",T:9}]),bC=E.makeMessageType("livekit.ConnectionSettings",()=>[{no:1,name:"auto_subscribe",kind:"scalar",T:8},{no:2,name:"adaptive_stream",kind:"scalar",T:8},{no:3,name:"subscriber_allow_pause",kind:"scalar",T:8,opt:!0},{no:4,name:"disable_ice_lite",kind:"scalar",T:8},{no:5,name:"auto_subscribe_data_track",kind:"scalar",T:8,opt:!0}]),GM=E.makeMessageType("livekit.JoinRequest",()=>[{no:1,name:"client_info",kind:"message",T:eC},{no:2,name:"connection_settings",kind:"message",T:bC},{no:3,name:"metadata",kind:"scalar",T:9},{no:4,name:"participant_attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"add_track_requests",kind:"message",T:_o,repeated:!0},{no:6,name:"publisher_offer",kind:"message",T:ga},{no:7,name:"reconnect",kind:"scalar",T:8},{no:8,name:"reconnect_reason",kind:"enum",T:E.getEnumType(Da)},{no:9,name:"participant_sid",kind:"scalar",T:9},{no:10,name:"sync_state",kind:"message",T:zm}]),KM=E.makeMessageType("livekit.WrappedJoinRequest",()=>[{no:1,name:"compression",kind:"enum",T:E.getEnumType(YM)},{no:2,name:"join_request",kind:"scalar",T:12}]),YM=E.makeEnum("livekit.WrappedJoinRequest.Compression",[{no:0,name:"NONE"},{no:1,name:"GZIP"}]),QM=E.makeMessageType("livekit.MediaSectionsRequirement",()=>[{no:1,name:"num_audios",kind:"scalar",T:13},{no:2,name:"num_videos",kind:"scalar",T:13}]);function JM(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var zl={exports:{}},XM=zl.exports,Av;function ZM(){return Av||(Av=1,function(t){(function(e,n){t.exports?t.exports=n():e.log=n()})(XM,function(){var e=function(){},n="undefined",i=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),a=["trace","debug","info","warn","error"],s={},r=null;function o(y,T){var m=y[T];if(typeof m.bind=="function")return m.bind(y);try{return Function.prototype.bind.call(m,y)}catch{return function(){return Function.prototype.apply.apply(m,[y,arguments])}}}function l(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function c(y){return y==="debug"&&(y="log"),typeof console===n?!1:y==="trace"&&i?l:console[y]!==void 0?o(console,y):console.log!==void 0?o(console,"log"):e}function u(){for(var y=this.getLevel(),T=0;T<a.length;T++){var m=a[T];this[m]=T<y?e:this.methodFactory(m,y,this.name)}if(this.log=this.debug,typeof console===n&&y<this.levels.SILENT)return"No console available for logging"}function d(y){return function(){typeof console!==n&&(u.call(this),this[y].apply(this,arguments))}}function f(y,T,m){return c(y)||d.apply(this,arguments)}function h(y,T){var m=this,p,v,b,C="loglevel";typeof y=="string"?C+=":"+y:typeof y=="symbol"&&(C=void 0);function _(z){var G=(a[z]||"silent").toUpperCase();if(!(typeof window===n||!C)){try{window.localStorage[C]=G;return}catch{}try{window.document.cookie=encodeURIComponent(C)+"="+G+";"}catch{}}}function w(){var z;if(!(typeof window===n||!C)){try{z=window.localStorage[C]}catch{}if(typeof z===n)try{var G=window.document.cookie,de=encodeURIComponent(C),at=G.indexOf(de+"=");at!==-1&&(z=/^([^;]+)/.exec(G.slice(at+de.length+1))[1])}catch{}return m.levels[z]===void 0&&(z=void 0),z}}function P(){if(!(typeof window===n||!C)){try{window.localStorage.removeItem(C)}catch{}try{window.document.cookie=encodeURIComponent(C)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function O(z){var G=z;if(typeof G=="string"&&m.levels[G.toUpperCase()]!==void 0&&(G=m.levels[G.toUpperCase()]),typeof G=="number"&&G>=0&&G<=m.levels.SILENT)return G;throw new TypeError("log.setLevel() called with invalid level: "+z)}m.name=y,m.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},m.methodFactory=T||f,m.getLevel=function(){return b??v??p},m.setLevel=function(z,G){return b=O(z),G!==!1&&_(b),u.call(m)},m.setDefaultLevel=function(z){v=O(z),w()||m.setLevel(z,!1)},m.resetLevel=function(){b=null,P(),u.call(m)},m.enableAll=function(z){m.setLevel(m.levels.TRACE,z)},m.disableAll=function(z){m.setLevel(m.levels.SILENT,z)},m.rebuild=function(){if(r!==m&&(p=O(r.getLevel())),u.call(m),r===m)for(var z in s)s[z].rebuild()},p=O(r?r.getLevel():"WARN");var N=w();N!=null&&(b=O(N)),u.call(m)}r=new h,r.getLogger=function(T){if(typeof T!="symbol"&&typeof T!="string"||T==="")throw new TypeError("You must supply a name when creating a logger.");var m=s[T];return m||(m=s[T]=new h(T,r.methodFactory)),m};var g=typeof window!==n?window.log:void 0;return r.noConflict=function(){return typeof window!==n&&window.log===r&&(window.log=g),r},r.getLoggers=function(){return s},r.default=r,r})}(zl)),zl.exports}var gu=ZM(),Ff;(function(t){t[t.trace=0]="trace",t[t.debug=1]="debug",t[t.info=2]="info",t[t.warn=3]="warn",t[t.error=4]="error",t[t.silent=5]="silent"})(Ff||(Ff={}));var Dn;(function(t){t.Default="livekit",t.Room="livekit-room",t.TokenSource="livekit-token-source",t.Participant="livekit-participant",t.Track="livekit-track",t.Publication="livekit-track-publication",t.Engine="livekit-engine",t.Signal="livekit-signal",t.PCManager="livekit-pc-manager",t.PCTransport="livekit-pc-transport",t.E2EE="lk-e2ee"})(Dn||(Dn={}));let ie=gu.getLogger("livekit");Object.values(Dn).map(t=>gu.getLogger(t));ie.setDefaultLevel(Ff.info);function xi(t){const e=gu.getLogger(t);return e.setDefaultLevel(ie.getLevel()),e}const WM=gu.getLogger("lk-e2ee"),xr=7e3,$M=[0,300,2*2*300,3*3*300,4*4*300,xr,xr,xr,xr,xr];class eD{constructor(e){this._retryDelays=e!==void 0?[...e]:$M}nextRetryDelayInMs(e){if(e.retryCount>=this._retryDelays.length)return null;const n=this._retryDelays[e.retryCount];return e.retryCount<=1?n:n+Math.random()*1e3}}function tD(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,i=Object.getOwnPropertySymbols(t);a<i.length;a++)e.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(t,i[a])&&(n[i[a]]=t[i[a]]);return n}function S(t,e,n,i){function a(s){return s instanceof n?s:new n(function(r){r(s)})}return new(n||(n=Promise))(function(s,r){function o(u){try{c(i.next(u))}catch(d){r(d)}}function l(u){try{c(i.throw(u))}catch(d){r(d)}}function c(u){u.done?s(u.value):a(u.value).then(o,l)}c((i=i.apply(t,e||[])).next())})}function Mv(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ui(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Mv=="function"?Mv(t):t[Symbol.iterator](),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(s){n[s]=t[s]&&function(r){return new Promise(function(o,l){r=t[s](r),a(o,l,r.done,r.value)})}}function a(s,r,o,l){Promise.resolve(l).then(function(c){s({value:c,done:o})},r)}}var gl={exports:{}},Dv;function nD(){if(Dv)return gl.exports;Dv=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(C,_,w){return Function.prototype.apply.call(C,_,w)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(C){return Object.getOwnPropertyNames(C).concat(Object.getOwnPropertySymbols(C))}:n=function(C){return Object.getOwnPropertyNames(C)};function i(b){console&&console.warn&&console.warn(b)}var a=Number.isNaN||function(C){return C!==C};function s(){s.init.call(this)}gl.exports=s,gl.exports.once=m,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var r=10;function o(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return r},set:function(b){if(typeof b!="number"||b<0||a(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");r=b}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(C){if(typeof C!="number"||C<0||a(C))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+C+".");return this._maxListeners=C,this};function l(b){return b._maxListeners===void 0?s.defaultMaxListeners:b._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(C){for(var _=[],w=1;w<arguments.length;w++)_.push(arguments[w]);var P=C==="error",O=this._events;if(O!==void 0)P=P&&O.error===void 0;else if(!P)return!1;if(P){var N;if(_.length>0&&(N=_[0]),N instanceof Error)throw N;var z=new Error("Unhandled error."+(N?" ("+N.message+")":""));throw z.context=N,z}var G=O[C];if(G===void 0)return!1;if(typeof G=="function")e(G,this,_);else for(var de=G.length,at=g(G,de),w=0;w<de;++w)e(at[w],this,_);return!0};function c(b,C,_,w){var P,O,N;if(o(_),O=b._events,O===void 0?(O=b._events=Object.create(null),b._eventsCount=0):(O.newListener!==void 0&&(b.emit("newListener",C,_.listener?_.listener:_),O=b._events),N=O[C]),N===void 0)N=O[C]=_,++b._eventsCount;else if(typeof N=="function"?N=O[C]=w?[_,N]:[N,_]:w?N.unshift(_):N.push(_),P=l(b),P>0&&N.length>P&&!N.warned){N.warned=!0;var z=new Error("Possible EventEmitter memory leak detected. "+N.length+" "+String(C)+" listeners added. Use emitter.setMaxListeners() to increase limit");z.name="MaxListenersExceededWarning",z.emitter=b,z.type=C,z.count=N.length,i(z)}return b}s.prototype.addListener=function(C,_){return c(this,C,_,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(C,_){return c(this,C,_,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(b,C,_){var w={fired:!1,wrapFn:void 0,target:b,type:C,listener:_},P=u.bind(w);return P.listener=_,w.wrapFn=P,P}s.prototype.once=function(C,_){return o(_),this.on(C,d(this,C,_)),this},s.prototype.prependOnceListener=function(C,_){return o(_),this.prependListener(C,d(this,C,_)),this},s.prototype.removeListener=function(C,_){var w,P,O,N,z;if(o(_),P=this._events,P===void 0)return this;if(w=P[C],w===void 0)return this;if(w===_||w.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete P[C],P.removeListener&&this.emit("removeListener",C,w.listener||_));else if(typeof w!="function"){for(O=-1,N=w.length-1;N>=0;N--)if(w[N]===_||w[N].listener===_){z=w[N].listener,O=N;break}if(O<0)return this;O===0?w.shift():y(w,O),w.length===1&&(P[C]=w[0]),P.removeListener!==void 0&&this.emit("removeListener",C,z||_)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(C){var _,w,P;if(w=this._events,w===void 0)return this;if(w.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):w[C]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete w[C]),this;if(arguments.length===0){var O=Object.keys(w),N;for(P=0;P<O.length;++P)N=O[P],N!=="removeListener"&&this.removeAllListeners(N);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=w[C],typeof _=="function")this.removeListener(C,_);else if(_!==void 0)for(P=_.length-1;P>=0;P--)this.removeListener(C,_[P]);return this};function f(b,C,_){var w=b._events;if(w===void 0)return[];var P=w[C];return P===void 0?[]:typeof P=="function"?_?[P.listener||P]:[P]:_?T(P):g(P,P.length)}s.prototype.listeners=function(C){return f(this,C,!0)},s.prototype.rawListeners=function(C){return f(this,C,!1)},s.listenerCount=function(b,C){return typeof b.listenerCount=="function"?b.listenerCount(C):h.call(b,C)},s.prototype.listenerCount=h;function h(b){var C=this._events;if(C!==void 0){var _=C[b];if(typeof _=="function")return 1;if(_!==void 0)return _.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function g(b,C){for(var _=new Array(C),w=0;w<C;++w)_[w]=b[w];return _}function y(b,C){for(;C+1<b.length;C++)b[C]=b[C+1];b.pop()}function T(b){for(var C=new Array(b.length),_=0;_<C.length;++_)C[_]=b[_].listener||b[_];return C}function m(b,C){return new Promise(function(_,w){function P(N){b.removeListener(C,O),w(N)}function O(){typeof b.removeListener=="function"&&b.removeListener("error",P),_([].slice.call(arguments))}v(b,C,O,{once:!0}),C!=="error"&&p(b,P,{once:!0})})}function p(b,C,_){typeof b.on=="function"&&v(b,"error",C,_)}function v(b,C,_,w){if(typeof b.on=="function")w.once?b.once(C,_):b.on(C,_);else if(typeof b.addEventListener=="function")b.addEventListener(C,function P(O){w.once&&b.removeEventListener(C,P),_(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}return gl.exports}var Zn=nD();let yC=!0,SC=!0;function qr(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseFloat(i[n],10)}function ns(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,a=i.addEventListener;i.addEventListener=function(r,o){if(r!==e)return a.apply(this,arguments);const l=c=>{const u=n(c);u&&(o.handleEvent?o.handleEvent(u):o(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(o,l),a.apply(this,[r,l])};const s=i.removeEventListener;i.removeEventListener=function(r,o){if(r!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(o))return s.apply(this,arguments);const l=this._eventMap[e].get(o);return this._eventMap[e].delete(o),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[r,l])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(r){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),r&&this.addEventListener(e,this["_on"+e]=r)},enumerable:!0,configurable:!0})}function iD(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(yC=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function aD(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(SC=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function TC(){if(typeof window=="object"){if(yC)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Vm(t,e){SC&&console.warn(t+" is deprecated, please use "+e+" instead.")}function sD(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.userAgentData&&n.userAgentData.brands){const i=n.userAgentData.brands.find(a=>a.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(n.mozGetUserMedia)e.browser="firefox",e.version=parseInt(qr(n.userAgent,/Firefox\/(\d+)\./,1));else if(n.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(qr(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&n.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(qr(n.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=qr(n.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Nv(t){return Object.prototype.toString.call(t)==="[object Object]"}function CC(t){return Nv(t)?Object.keys(t).reduce(function(e,n){const i=Nv(t[n]),a=i?CC(t[n]):t[n],s=i&&!Object.keys(a).length;return a===void 0||s?e:Object.assign(e,{[n]:a})},{}):t}function Vf(t,e,n){!e||n.has(e.id)||(n.set(e.id,e),Object.keys(e).forEach(i=>{i.endsWith("Id")?Vf(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach(a=>{Vf(t,t.get(a),n)})}))}function Pv(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",a=new Map;if(e===null)return a;const s=[];return t.forEach(r=>{r.type==="track"&&r.trackIdentifier===e.id&&s.push(r)}),s.forEach(r=>{t.forEach(o=>{o.type===i&&o.trackId===r.id&&Vf(t,o,a)})}),a}const Lv=TC;function kC(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const l={};return Object.keys(o).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof o[c]=="object"?o[c]:{ideal:o[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,h){return f?f+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(u.ideal!==void 0){l.optional=l.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",c)]=u.ideal,l.optional.push(f),f={},f[d("max",c)]=u.ideal,l.optional.push(f)):(f[d("",c)]=u.ideal,l.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[d("",c)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[d(f,c)]=u[f])})}),o.advanced&&(l.optional=(l.optional||[]).concat(o.advanced)),l},a=function(o,l){if(e.version>=61)return l(o);if(o=JSON.parse(JSON.stringify(o)),o&&typeof o.audio=="object"){const c=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};o=JSON.parse(JSON.stringify(o)),c(o.audio,"autoGainControl","googAutoGainControl"),c(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=i(o.audio)}if(o&&typeof o.video=="object"){let c=o.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete o.video.facingMode;let d;if(c.exact==="environment"||c.ideal==="environment"?d=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(f=>{f=f.filter(g=>g.kind==="videoinput");let h=f.find(g=>d.some(y=>g.label.toLowerCase().includes(y)));return!h&&f.length&&d.includes("back")&&(h=f[f.length-1]),h&&(o.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),o.video=i(o.video),Lv("chrome: "+JSON.stringify(o)),l(o)})}o.video=i(o.video)}return Lv("chrome: "+JSON.stringify(o)),l(o)},s=function(o){return e.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},r=function(o,l,c){a(o,u=>{n.webkitGetUserMedia(u,l,d=>{c&&c(s(d))})})};if(n.getUserMedia=r.bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(l){return a(l,c=>o(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(s(u))))}}}function EC(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function _C(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",a=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===a.track.id):s={track:a.track};const r=new Event("track");r.track=a.track,r.receiver=s,r.transceiver={receiver:s},r.streams=[i.stream],this.dispatchEvent(r)}),i.stream.getTracks().forEach(a=>{let s;t.RTCPeerConnection.prototype.getReceivers?s=this.getReceivers().find(o=>o.track&&o.track.id===a.id):s={track:a};const r=new Event("track");r.track=a,r.receiver=s,r.transceiver={receiver:s},r.streams=[i.stream],this.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ns(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function RC(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(a,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=a.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:a}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const a=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,l){let c=a.apply(this,arguments);return c||(c=e(this,o),this._senders.push(c)),c};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const l=this._senders.indexOf(o);l!==-1&&this._senders.splice(l,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach(r=>{this._senders.push(e(this,r))})};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(r=>{const o=this._senders.find(l=>l.track===r);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function xC(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach(r=>r._pc=this),s});const i=t.RTCPeerConnection.prototype.addTrack;i&&(t.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),t.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then(r=>Pv(r,s.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=n.apply(this,[]);return a.forEach(s=>s._pc=this),a}),ns(t,"track",i=>(i.receiver._pc=i.srcElement,i)),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then(s=>Pv(s,a.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const i=arguments[0];let a,s,r;return this.getSenders().forEach(o=>{o.track===i&&(a?r=!0:a=o)}),this.getReceivers().forEach(o=>(o.track===i&&(s?r=!0:s=o),o.track===i)),r||a&&s?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():s?s.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function wC(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(r=>this._shimmedLocalStreams[r][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(r,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(l)===-1&&this._shimmedLocalStreams[o.id].push(l):this._shimmedLocalStreams[o.id]=[o,l],l};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(r){this._shimmedLocalStreams=this._shimmedLocalStreams||{},r.getTracks().forEach(c=>{if(this.getSenders().find(d=>d.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const l=this.getSenders().filter(c=>o.indexOf(c)===-1);this._shimmedLocalStreams[r.id]=[r].concat(l)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[r.id],i.apply(this,arguments)};const a=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(r){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const l=this._shimmedLocalStreams[o].indexOf(r);l!==-1&&this._shimmedLocalStreams[o].splice(l,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),a.apply(this,arguments)}}function OC(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return wC(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(h=>h.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new t.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}i.apply(this,[u])};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(y=>y===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(y=>y.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const g=this._streams[d.id];if(g)g.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const y=new t.MediaStream([u]);this._streams[d.id]=y,this._reverseStreams[y.id]=d,this.addStream(y)}return this.getSenders().find(y=>y.track===u)};function s(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const h=c._reverseStreams[f],g=c._streams[h.id];d=d.replace(new RegExp(g.id,"g"),h.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function r(c,u){let d=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(f=>{const h=c._reverseStreams[f],g=c._streams[h.id];d=d.replace(new RegExp(h.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(c){const u=t.RTCPeerConnection.prototype[c],d={[c](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{const y=s(this,g);f[0].apply(null,[y])},g=>{f[1]&&f[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>s(this,g))}};t.RTCPeerConnection.prototype[c]=d[c]});const o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?o.apply(this,arguments):(arguments[0]=r(this,arguments[0]),o.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=l.get.apply(this);return c.type===""?c:s(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(y=>u.track===y)&&(f=this._streams[h])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Hf(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const i=t.RTCPeerConnection.prototype[n],a={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=a[n]})}function AC(t,e){ns(t,"negotiationneeded",n=>{const i=n.target;if(!((e.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return n})}var Uv=Object.freeze({__proto__:null,fixNegotiationNeeded:AC,shimAddTrackRemoveTrack:OC,shimAddTrackRemoveTrackWithNative:wC,shimGetSendersWithDtmf:RC,shimGetUserMedia:kC,shimMediaStream:EC,shimOnTrack:_C,shimPeerConnection:Hf,shimSenderReceiverGetStats:xC});function MC(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(a,s,r){Vm("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(a).then(s,r)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const a=function(r,o,l){o in r&&!(l in r)&&(r[l]=r[o],delete r[o])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(r){return typeof r=="object"&&typeof r.audio=="object"&&(r=JSON.parse(JSON.stringify(r)),a(r.audio,"autoGainControl","mozAutoGainControl"),a(r.audio,"noiseSuppression","mozNoiseSuppression")),s(r)},i&&i.prototype.getSettings){const r=i.prototype.getSettings;i.prototype.getSettings=function(){const o=r.apply(this,arguments);return a(o,"mozAutoGainControl","autoGainControl"),a(o,"mozNoiseSuppression","noiseSuppression"),o}}if(i&&i.prototype.applyConstraints){const r=i.prototype.applyConstraints;i.prototype.applyConstraints=function(o){return this.kind==="audio"&&typeof o=="object"&&(o=JSON.parse(JSON.stringify(o)),a(o,"autoGainControl","mozAutoGainControl"),a(o,"noiseSuppression","mozNoiseSuppression")),r.apply(this,[o])}}}}function rD(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,Promise.reject(a)}return i.video===!0?i.video={mediaSource:e}:i.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(i)})}function DC(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Gf(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(a){const s=t.RTCPeerConnection.prototype[a],r={[a](){return arguments[0]=new(a==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[a]=r[a]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,r,o]=arguments;return i.apply(this,[s||null]).then(l=>{if(e.version<53&&!r)try{l.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;l.forEach((u,d)=>{l.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return l}).then(r,o)}}function NC(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=e.apply(this,[]);return a.forEach(s=>s._pc=this),a});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=n.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function PC(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const i=e.apply(this,[]);return i.forEach(a=>a._pc=this),i}),ns(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function LC(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){Vm("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&n.getTracks().includes(i.track)&&this.removeTrack(i)})})}function UC(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function IC(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const a=i.length>0;a&&i.forEach(r=>{if("rid"in r&&!/^[a-z0-9]{0,16}$/i.test(r.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in r&&!(parseFloat(r.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in r&&!(parseFloat(r.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const s=e.apply(this,arguments);if(a){const{sender:r}=s,o=r.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=i,r.sendEncodings=i,this.setParametersPromises.push(r.setParameters(o).then(()=>{delete r.sendEncodings}).catch(()=>{delete r.sendEncodings})))}return s})}function jC(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const i=e.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function BC(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function qC(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Iv=Object.freeze({__proto__:null,shimAddTransceiver:IC,shimCreateAnswer:qC,shimCreateOffer:BC,shimGetDisplayMedia:rD,shimGetParameters:jC,shimGetUserMedia:MC,shimOnTrack:DC,shimPeerConnection:Gf,shimRTCDataChannel:UC,shimReceiverGetStats:PC,shimRemoveStream:LC,shimSenderGetStats:NC});function zC(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(a=>e.call(this,a,i)),i.getVideoTracks().forEach(a=>e.call(this,a,i))},t.RTCPeerConnection.prototype.addTrack=function(i){for(var a=arguments.length,s=new Array(a>1?a-1:0),r=1;r<a;r++)s[r-1]=arguments[r];return s&&s.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const a=n.getTracks();this.getSenders().forEach(s=>{a.includes(s.track)&&this.removeTrack(s)})})}}function FC(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(a))return;this._remoteStreams.push(a);const s=new Event("addstream");s.stream=a,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);const r=new Event("addstream");r.stream=s,i.dispatchEvent(r)})}),e.apply(i,arguments)}}}function VC(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,a=e.setLocalDescription,s=e.setRemoteDescription,r=e.addIceCandidate;e.createOffer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[d]);return u?(f.then(c,u),Promise.resolve()):f},e.createAnswer=function(c,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=i.apply(this,[d]);return u?(f.then(c,u),Promise.resolve()):f};let o=function(l,c,u){const d=a.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d};e.setLocalDescription=o,o=function(l,c,u){const d=s.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.setRemoteDescription=o,o=function(l,c,u){const d=r.apply(this,[l]);return u?(d.then(c,u),Promise.resolve()):d},e.addIceCandidate=o}function HC(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,i=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=a=>i(GC(a))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(i,a,s){e.mediaDevices.getUserMedia(i).then(a,s)}).bind(e))}function GC(t){return t&&t.video!==void 0?Object.assign({},t,{video:CC(t.video)}):t}function KC(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(i,a){if(i&&i.iceServers){const s=[];for(let r=0;r<i.iceServers.length;r++){let o=i.iceServers[r];o.urls===void 0&&o.url?(Vm("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,s.push(o)):s.push(i.iceServers[r])}i.iceServers=s}return new e(i,a)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function YC(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function QC(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const a=this.getTransceivers().find(r=>r.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):i.offerToReceiveAudio===!0&&!a&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const s=this.getTransceivers().find(r=>r.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo===!0&&!s&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function JC(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var jv=Object.freeze({__proto__:null,shimAudioContext:JC,shimCallbacksAPI:VC,shimConstraints:GC,shimCreateOfferLegacy:QC,shimGetUserMedia:HC,shimLocalStreamsAPI:zC,shimRTCIceServerUrls:KC,shimRemoteStreamsAPI:FC,shimTrackEventTransceiver:YC}),yd={exports:{}},Bv;function oD(){return Bv||(Bv=1,function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(i=>i.trim())},e.splitSections=function(n){return n.split(`
m=`).map((a,s)=>(s>0?"m="+a:a).trim()+`\r
`)},e.getDescription=function(n){const i=e.splitSections(n);return i&&i[0]},e.getMediaSections=function(n){const i=e.splitSections(n);return i.shift(),i},e.matchPrefix=function(n,i){return e.splitLines(n).filter(a=>a.indexOf(i)===0)},e.parseCandidate=function(n){let i;n.indexOf("a=candidate:")===0?i=n.substring(12).split(" "):i=n.substring(10).split(" ");const a={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let s=8;s<i.length;s+=2)switch(i[s]){case"raddr":a.relatedAddress=i[s+1];break;case"rport":a.relatedPort=parseInt(i[s+1],10);break;case"tcptype":a.tcpType=i[s+1];break;case"ufrag":a.ufrag=i[s+1],a.usernameFragment=i[s+1];break;default:a[i[s]]===void 0&&(a[i[s]]=i[s+1]);break}return a},e.writeCandidate=function(n){const i=[];i.push(n.foundation);const a=n.component;a==="rtp"?i.push(1):a==="rtcp"?i.push(2):i.push(a),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const s=n.type;return i.push("typ"),i.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let i=n.substring(9).split(" ");const a={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),a.name=i[0],a.clockRate=parseInt(i[1],10),a.channels=i.length===3?parseInt(i[2],10):1,a.numChannels=a.channels,a},e.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const a=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(a!==1?"/"+a:"")+`\r
`},e.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const i={};let a;const s=n.substring(n.indexOf(" ")+1).split(";");for(let r=0;r<s.length;r++)a=s[r].trim().split("="),i[a[0].trim()]=a[1];return i},e.writeFmtp=function(n){let i="",a=n.payloadType;if(n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(r=>{n.parameters[r]!==void 0?s.push(r+"="+n.parameters[r]):s.push(r)}),i+="a=fmtp:"+a+" "+s.join(";")+`\r
`}return i},e.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},e.writeRtcpFb=function(n){let i="",a=n.payloadType;return n.preferredPayloadType!==void 0&&(a=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{i+="a=rtcp-fb:"+a+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),i},e.parseSsrcMedia=function(n){const i=n.indexOf(" "),a={ssrc:parseInt(n.substring(7,i),10)},s=n.indexOf(":",i);return s>-1?(a.attribute=n.substring(i+1,s),a.value=n.substring(s+1)):a.attribute=n.substring(i+1),a},e.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(a=>parseInt(a,10))}},e.getMid=function(n){const i=e.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},e.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},e.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:e.matchPrefix(n+i,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,i){let a="a=setup:"+i+`\r
`;return n.fingerprints.forEach(s=>{a+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),a},e.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,i){return e.matchPrefix(n+i,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,i){const a=e.matchPrefix(n+i,"a=ice-ufrag:")[0],s=e.matchPrefix(n+i,"a=ice-pwd:")[0];return a&&s?{usernameFragment:a.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},e.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(n)[0].split(" ");i.profile=s[2];for(let o=3;o<s.length;o++){const l=s[o],c=e.matchPrefix(n,"a=rtpmap:"+l+" ")[0];if(c){const u=e.parseRtpMap(c),d=e.matchPrefix(n,"a=fmtp:"+l+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),i.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(n,"a=extmap:").forEach(o=>{i.headerExtensions.push(e.parseExtmap(o))});const r=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return i.codecs.forEach(o=>{r.forEach(l=>{o.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||o.rtcpFeedback.push(l)})}),i},e.writeRtpDescription=function(n,i){let a="";a+="m="+n+" ",a+=i.codecs.length>0?"9":"0",a+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",a+=i.codecs.map(r=>r.preferredPayloadType!==void 0?r.preferredPayloadType:r.payloadType).join(" ")+`\r
`,a+=`c=IN IP4 0.0.0.0\r
`,a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(r=>{a+=e.writeRtpMap(r),a+=e.writeFmtp(r),a+=e.writeRtcpFb(r)});let s=0;return i.codecs.forEach(r=>{r.maxptime>s&&(s=r.maxptime)}),s>0&&(a+="a=maxptime:"+s+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(r=>{a+=e.writeExtmap(r)}),a},e.parseRtpEncodingParameters=function(n){const i=[],a=e.parseRtpParameters(n),s=a.fecMechanisms.indexOf("RED")!==-1,r=a.fecMechanisms.indexOf("ULPFEC")!==-1,o=e.matchPrefix(n,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),l=o.length>0&&o[0].ssrc;let c;const u=e.matchPrefix(n,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(g=>parseInt(g,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(c=u[0][1]),a.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let h={ssrc:l,codecPayloadType:parseInt(f.parameters.apt,10)};l&&c&&(h.rtx={ssrc:c}),i.push(h),s&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:l,mechanism:r?"red+ulpfec":"red"},i.push(h))}}),i.length===0&&l&&i.push({ssrc:l});let d=e.matchPrefix(n,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,i.forEach(f=>{f.maxBitrate=d})),i},e.parseRtcpParameters=function(n){const i={},a=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="cname")[0];a&&(i.cname=a.value,i.ssrc=a.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=s.length>0,i.compound=s.length===0;const r=e.matchPrefix(n,"a=rtcp-mux");return i.mux=r.length>0,i},e.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},e.parseMsid=function(n){let i;const a=e.matchPrefix(n,"a=msid:");if(a.length===1)return i=a[0].substring(7).split(" "),{stream:i[0],track:i[1]};const s=e.matchPrefix(n,"a=ssrc:").map(r=>e.parseSsrcMedia(r)).filter(r=>r.attribute==="msid");if(s.length>0)return i=s[0].value.split(" "),{stream:i[0],track:i[1]}},e.parseSctpDescription=function(n){const i=e.parseMLine(n),a=e.matchPrefix(n,"a=max-message-size:");let s;a.length>0&&(s=parseInt(a[0].substring(19),10)),isNaN(s)&&(s=65536);const r=e.matchPrefix(n,"a=sctp-port:");if(r.length>0)return{port:parseInt(r[0].substring(12),10),protocol:i.fmt,maxMessageSize:s};const o=e.matchPrefix(n,"a=sctpmap:");if(o.length>0){const l=o[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,i){let a=[];return n.protocol!=="DTLS/SCTP"?a=["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:a=["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&a.push("a=max-message-size:"+i.maxMessageSize+`\r
`),a.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,i,a){let s;const r=i!==void 0?i:2;return n?s=n:s=e.generateSessionId(),`v=0\r
o=`+(a||"thisisadapterortc")+" "+s+" "+r+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,i){const a=e.splitLines(n);for(let s=0;s<a.length;s++)switch(a[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[s].substring(2)}return i?e.getDirection(i):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const a=e.splitLines(n)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},e.parseOLine=function(n){const a=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=e.splitLines(n);for(let a=0;a<i.length;a++)if(i[a].length<2||i[a].charAt(1)!=="=")return!1;return!0},t.exports=e}(yd)),yd.exports}var XC=oD(),Us=JM(XC),lD=dA({__proto__:null,default:Us},[XC]);function Fl(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const a=new e(i),s=Us.parseCandidate(i.candidate);for(const r in s)r in a||Object.defineProperty(a,r,{value:s[r]});return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new e(i)},t.RTCIceCandidate.prototype=e.prototype,ns(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Kf(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||ns(t,"icecandidate",e=>{if(e.candidate){const n=Us.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Vl(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const n=function(o){if(!o||!o.sdp)return!1;const l=Us.splitSections(o.sdp);return l.shift(),l.some(c=>{const u=Us.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},i=function(o){const l=o.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const c=parseInt(l[1],10);return c!==c?-1:c},a=function(o){let l=65536;return e.browser==="firefox"&&(e.version<57?o===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},s=function(o,l){let c=65536;e.browser==="firefox"&&e.version===57&&(c=65535);const u=Us.matchPrefix(o.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(c=2147483637),c},r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const l=i(arguments[0]),c=a(l),u=s(arguments[0],l);let d;c===0&&u===0?d=Number.POSITIVE_INFINITY:c===0||u===0?d=Math.max(c,u):d=Math.min(c,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return r.apply(this,arguments)}}function Hl(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(i,a){const s=i.send;i.send=function(){const o=arguments[0],l=o.length||o.size||o.byteLength;if(i.readyState==="open"&&a.sctp&&l>a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+a.sctp.maxMessageSize+" bytes)");return s.apply(i,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=n.apply(this,arguments);return e(a,this),a},ns(t,"datachannel",i=>(e(i.channel,i.target),i))}function Yf(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const i=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=a=>{const s=a.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const r=new Event("connectionstatechange",a);s.dispatchEvent(r)}return a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function Qf(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=a.sdp.split(`
`).filter(r=>r.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:s}):a.sdp=s}return n.apply(this,arguments)}}function Gl(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.addIceCandidate;!n||n.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Kl(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const n=t.RTCPeerConnection.prototype.setLocalDescription;!n||n.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return n.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer";break}return a.sdp||a.type!=="offer"&&a.type!=="answer"?n.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(r=>n.apply(this,[r]))})}var cD=Object.freeze({__proto__:null,removeExtmapAllowMixed:Qf,shimAddIceCandidateNullOrEmpty:Gl,shimConnectionState:Yf,shimMaxMessageSize:Vl,shimParameterlessSetLocalDescription:Kl,shimRTCIceCandidate:Fl,shimRTCIceCandidateRelayProtocol:Kf,shimSendThrowTypeError:Hl});function uD(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=TC,i=sD(t),a={browserDetails:i,commonShim:cD,extractVersion:qr,disableLog:iD,disableWarnings:aD,sdp:lD};switch(i.browser){case"chrome":if(!Uv||!Hf||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),a;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),a;n("adapter.js shimming chrome."),a.browserShim=Uv,Gl(t,i),Kl(t),kC(t,i),EC(t),Hf(t,i),_C(t),OC(t,i),RC(t),xC(t),AC(t,i),Fl(t),Kf(t),Yf(t),Vl(t,i),Hl(t),Qf(t,i);break;case"firefox":if(!Iv||!Gf||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),a;n("adapter.js shimming firefox."),a.browserShim=Iv,Gl(t,i),Kl(t),MC(t,i),Gf(t,i),DC(t),LC(t),NC(t),PC(t),UC(t),IC(t),jC(t),BC(t),qC(t),Fl(t),Yf(t),Vl(t,i),Hl(t);break;case"safari":if(!jv||!e.shimSafari)return n("Safari shim is not included in this adapter release."),a;n("adapter.js shimming safari."),a.browserShim=jv,Gl(t,i),Kl(t),KC(t),QC(t),VC(t),zC(t),FC(t),YC(t),HC(t),JC(t),Fl(t),Kf(t),Vl(t,i),Hl(t),Qf(t,i);break;default:n("Unsupported browser!");break}return a}uD({window:typeof window>"u"?void 0:window});var Jf,ZC;class Tt extends(ZC=Promise){constructor(e){super(e)}catch(e){return super.catch(e)}static reject(e){return super.reject(e)}static all(e){return super.all(e)}static race(e){return super.race(e)}}Jf=Tt;Tt.resolve=t=>Reflect.get(ZC,"resolve",Jf).call(Jf,t);const dD=/version\/(\d+(\.?_?\d+)+)/i;let Sd;function jt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(typeof navigator>"u")return;const n=navigator.userAgent.toLowerCase();if(Sd===void 0||e){const i=fD.find(a=>{let{test:s}=a;return s.test(n)});Sd=i==null?void 0:i.describe(n)}return Sd}const fD=[{test:/firefox|iceweasel|fxios/i,describe(t){return{name:"Firefox",version:Yl(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("fxios")?"iOS":void 0,osVersion:Td(t)}}},{test:/chrom|crios|crmo/i,describe(t){return{name:"Chrome",version:Yl(/(?:chrome|chromium|crios|crmo)\/(\d+(\.?_?\d+)+)/i,t),os:t.toLowerCase().includes("crios")?"iOS":void 0,osVersion:Td(t)}}},{test:/safari|applewebkit/i,describe(t){return{name:"Safari",version:Yl(dD,t),os:t.includes("mobile/")?"iOS":"macOS",osVersion:Td(t)}}}];function Yl(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const i=e.match(t);return i&&i.length>=n&&i[n]||""}function Td(t){return t.includes("mac os")?Yl(/\(.+?(\d+_\d+(:?_\d+)?)/,t,1).replace(/_/g,"."):void 0}var hD="2.17.1";const mD=hD,pD=16;class Ta extends Error{constructor(e,n,i){super(n||"an error has occurred"),this.name="LiveKitError",this.code=e,typeof(i==null?void 0:i.cause)<"u"&&(this.cause=i==null?void 0:i.cause)}}class Hm extends Ta{}var Re;(function(t){t[t.NotAllowed=0]="NotAllowed",t[t.ServerUnreachable=1]="ServerUnreachable",t[t.InternalError=2]="InternalError",t[t.Cancelled=3]="Cancelled",t[t.LeaveRequest=4]="LeaveRequest",t[t.Timeout=5]="Timeout",t[t.WebSocket=6]="WebSocket",t[t.ServiceNotFound=7]="ServiceNotFound"})(Re||(Re={}));class J extends Hm{constructor(e,n,i,a){super(1,e),this.name="ConnectionError",this.status=i,this.reason=n,this.context=a,this.reasonName=Re[n]}static notAllowed(e,n,i){return new J(e,Re.NotAllowed,n,i)}static timeout(e){return new J(e,Re.Timeout)}static leaveRequest(e,n){return new J(e,Re.LeaveRequest,void 0,n)}static internal(e,n){return new J(e,Re.InternalError,void 0,n)}static cancelled(e){return new J(e,Re.Cancelled)}static serverUnreachable(e,n){return new J(e,Re.ServerUnreachable,n)}static websocket(e,n,i){return new J(e,Re.WebSocket,n,i)}static serviceNotFound(e,n){return new J(e,Re.ServiceNotFound,void 0,n)}}class Gm extends Ta{constructor(e){super(21,e??"device is unsupported"),this.name="DeviceUnsupportedError"}}class di extends Ta{constructor(e){super(20,e??"track is invalid"),this.name="TrackInvalidError"}}class gD extends Ta{constructor(e){super(10,e??"unsupported server"),this.name="UnsupportedServer"}}class Ve extends Ta{constructor(e){super(12,e??"unexpected connection state"),this.name="UnexpectedConnectionState"}}class Is extends Ta{constructor(e){super(13,e??"unable to negotiate"),this.name="NegotiationError"}}class qv extends Ta{constructor(e,n){super(15,e),this.name="PublishTrackError",this.status=n}}class zv extends Hm{constructor(e,n){super(15,e),this.name="SignalRequestError",this.reason=n,this.reasonName=typeof n=="string"?n:Fm[n]}}var Et;(function(t){t[t.AlreadyOpened=0]="AlreadyOpened",t[t.AbnormalEnd=1]="AbnormalEnd",t[t.DecodeFailed=2]="DecodeFailed",t[t.LengthExceeded=3]="LengthExceeded",t[t.Incomplete=4]="Incomplete",t[t.HandlerAlreadyRegistered=7]="HandlerAlreadyRegistered",t[t.EncryptionTypeMismatch=8]="EncryptionTypeMismatch"})(Et||(Et={}));class nn extends Hm{constructor(e,n){super(16,e),this.name="DataStreamError",this.reason=n,this.reasonName=Et[n]}}class ls extends Ta{constructor(e){super(18,e),this.name="SignalReconnectError"}}var Lc;(function(t){t.PermissionDenied="PermissionDenied",t.NotFound="NotFound",t.DeviceInUse="DeviceInUse",t.Other="Other"})(Lc||(Lc={}));(function(t){function e(n){if(n&&"name"in n)return n.name==="NotFoundError"||n.name==="DevicesNotFoundError"?t.NotFound:n.name==="NotAllowedError"||n.name==="PermissionDeniedError"?t.PermissionDenied:n.name==="NotReadableError"||n.name==="TrackStartError"?t.DeviceInUse:t.Other}t.getFailure=e})(Lc||(Lc={}));class vt{}vt.setTimeout=function(){return setTimeout(...arguments)};vt.setInterval=function(){return setInterval(...arguments)};vt.clearTimeout=function(){return clearTimeout(...arguments)};vt.clearInterval=function(){return clearInterval(...arguments)};var j;(function(t){t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting",t.Reconnected="reconnected",t.Disconnected="disconnected",t.ConnectionStateChanged="connectionStateChanged",t.Moved="moved",t.MediaDevicesChanged="mediaDevicesChanged",t.ParticipantConnected="participantConnected",t.ParticipantDisconnected="participantDisconnected",t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalAudioSilenceDetected="localAudioSilenceDetected",t.ActiveSpeakersChanged="activeSpeakersChanged",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.ParticipantAttributesChanged="participantAttributesChanged",t.ParticipantActive="participantActive",t.RoomMetadataChanged="roomMetadataChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.AudioPlaybackStatusChanged="audioPlaybackChanged",t.VideoPlaybackStatusChanged="videoPlaybackChanged",t.MediaDevicesError="mediaDevicesError",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.SignalConnected="signalConnected",t.RecordingStatusChanged="recordingStatusChanged",t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ActiveDeviceChanged="activeDeviceChanged",t.ChatMessage="chatMessage",t.LocalTrackSubscribed="localTrackSubscribed",t.MetricsReceived="metricsReceived"})(j||(j={}));var V;(function(t){t.TrackPublished="trackPublished",t.TrackSubscribed="trackSubscribed",t.TrackSubscriptionFailed="trackSubscriptionFailed",t.TrackUnpublished="trackUnpublished",t.TrackUnsubscribed="trackUnsubscribed",t.TrackMuted="trackMuted",t.TrackUnmuted="trackUnmuted",t.LocalTrackPublished="localTrackPublished",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackCpuConstrained="localTrackCpuConstrained",t.LocalSenderCreated="localSenderCreated",t.ParticipantMetadataChanged="participantMetadataChanged",t.ParticipantNameChanged="participantNameChanged",t.DataReceived="dataReceived",t.SipDTMFReceived="sipDTMFReceived",t.TranscriptionReceived="transcriptionReceived",t.IsSpeakingChanged="isSpeakingChanged",t.ConnectionQualityChanged="connectionQualityChanged",t.TrackStreamStateChanged="trackStreamStateChanged",t.TrackSubscriptionPermissionChanged="trackSubscriptionPermissionChanged",t.TrackSubscriptionStatusChanged="trackSubscriptionStatusChanged",t.TrackCpuConstrained="trackCpuConstrained",t.MediaDevicesError="mediaDevicesError",t.AudioStreamAcquired="audioStreamAcquired",t.ParticipantPermissionsChanged="participantPermissionsChanged",t.PCTrackAdded="pcTrackAdded",t.AttributesChanged="attributesChanged",t.LocalTrackSubscribed="localTrackSubscribed",t.ChatMessage="chatMessage",t.Active="active"})(V||(V={}));var F;(function(t){t.TransportsCreated="transportsCreated",t.Connected="connected",t.Disconnected="disconnected",t.Resuming="resuming",t.Resumed="resumed",t.Restarting="restarting",t.Restarted="restarted",t.SignalResumed="signalResumed",t.SignalRestarted="signalRestarted",t.Closing="closing",t.MediaTrackAdded="mediaTrackAdded",t.ActiveSpeakersUpdate="activeSpeakersUpdate",t.DataPacketReceived="dataPacketReceived",t.RTPVideoMapUpdate="rtpVideoMapUpdate",t.DCBufferStatusChanged="dcBufferStatusChanged",t.ParticipantUpdate="participantUpdate",t.RoomUpdate="roomUpdate",t.SpeakersChanged="speakersChanged",t.StreamStateChanged="streamStateChanged",t.ConnectionQualityUpdate="connectionQualityUpdate",t.SubscriptionError="subscriptionError",t.SubscriptionPermissionUpdate="subscriptionPermissionUpdate",t.RemoteMute="remoteMute",t.SubscribedQualityUpdate="subscribedQualityUpdate",t.LocalTrackUnpublished="localTrackUnpublished",t.LocalTrackSubscribed="localTrackSubscribed",t.Offline="offline",t.SignalRequestResponse="signalRequestResponse",t.SignalConnected="signalConnected",t.RoomMoved="roomMoved"})(F||(F={}));var B;(function(t){t.Message="message",t.Muted="muted",t.Unmuted="unmuted",t.Restarted="restarted",t.Ended="ended",t.Subscribed="subscribed",t.Unsubscribed="unsubscribed",t.CpuConstrained="cpuConstrained",t.UpdateSettings="updateSettings",t.UpdateSubscription="updateSubscription",t.AudioPlaybackStarted="audioPlaybackStarted",t.AudioPlaybackFailed="audioPlaybackFailed",t.AudioSilenceDetected="audioSilenceDetected",t.VisibilityChanged="visibilityChanged",t.VideoDimensionsChanged="videoDimensionsChanged",t.VideoPlaybackStarted="videoPlaybackStarted",t.VideoPlaybackFailed="videoPlaybackFailed",t.ElementAttached="elementAttached",t.ElementDetached="elementDetached",t.UpstreamPaused="upstreamPaused",t.UpstreamResumed="upstreamResumed",t.SubscriptionPermissionChanged="subscriptionPermissionChanged",t.SubscriptionStatusChanged="subscriptionStatusChanged",t.SubscriptionFailed="subscriptionFailed",t.TrackProcessorUpdate="trackProcessorUpdate",t.AudioTrackFeatureUpdate="audioTrackFeatureUpdate",t.TranscriptionReceived="transcriptionReceived",t.TimeSyncUpdate="timeSyncUpdate",t.PreConnectBufferFlushed="preConnectBufferFlushed"})(B||(B={}));function vD(t){return typeof t>"u"?t:typeof structuredClone=="function"?typeof t=="object"&&t!==null?structuredClone(Object.assign({},t)):structuredClone(t):JSON.parse(JSON.stringify(t))}class Ce{constructor(e,n,i,a,s){if(typeof e=="object")this.width=e.width,this.height=e.height,this.aspectRatio=e.aspectRatio,this.encoding={maxBitrate:e.maxBitrate,maxFramerate:e.maxFramerate,priority:e.priority};else if(n!==void 0&&i!==void 0)this.width=e,this.height=n,this.aspectRatio=e/n,this.encoding={maxBitrate:i,maxFramerate:a,priority:s};else throw new TypeError("Unsupported options: provide at least width, height and maxBitrate")}get resolution(){return{width:this.width,height:this.height,frameRate:this.encoding.maxFramerate,aspectRatio:this.aspectRatio}}}const bD=["vp8","h264"],yD=["vp8","h264","vp9","av1","h265"];function SD(t){return!!bD.find(e=>e===t)}const TD=SD;var Fv;(function(t){t[t.PREFER_REGRESSION=0]="PREFER_REGRESSION",t[t.SIMULCAST=1]="SIMULCAST",t[t.REGRESSION=2]="REGRESSION"})(Fv||(Fv={}));var Xf;(function(t){t.telephone={maxBitrate:12e3},t.speech={maxBitrate:24e3},t.music={maxBitrate:48e3},t.musicStereo={maxBitrate:64e3},t.musicHighQuality={maxBitrate:96e3},t.musicHighQualityStereo={maxBitrate:128e3}})(Xf||(Xf={}));const Ro={h90:new Ce(160,90,9e4,20),h180:new Ce(320,180,16e4,20),h216:new Ce(384,216,18e4,20),h360:new Ce(640,360,45e4,20),h540:new Ce(960,540,8e5,25),h720:new Ce(1280,720,17e5,30),h1080:new Ce(1920,1080,3e6,30),h1440:new Ce(2560,1440,5e6,30),h2160:new Ce(3840,2160,8e6,30)},Zf={h120:new Ce(160,120,7e4,20),h180:new Ce(240,180,125e3,20),h240:new Ce(320,240,14e4,20),h360:new Ce(480,360,33e4,20),h480:new Ce(640,480,5e5,20),h540:new Ce(720,540,6e5,25),h720:new Ce(960,720,13e5,30),h1080:new Ce(1440,1080,23e5,30),h1440:new Ce(1920,1440,38e5,30)},Km={h360fps3:new Ce(640,360,2e5,3,"medium"),h360fps15:new Ce(640,360,4e5,15,"medium"),h720fps5:new Ce(1280,720,8e5,5,"medium"),h720fps15:new Ce(1280,720,15e5,15,"medium"),h720fps30:new Ce(1280,720,2e6,30,"medium"),h1080fps15:new Ce(1920,1080,25e5,15,"medium"),h1080fps30:new Ce(1920,1080,5e6,30,"medium"),original:new Ce(0,0,7e6,30,"medium")};function WC(t,e,n){var i,a,s,r;const{optionsWithoutProcessor:o,audioProcessor:l,videoProcessor:c}=tk(t??{}),u=e==null?void 0:e.processor,d=n==null?void 0:n.processor,f=o??{};return f.audio===!0&&(f.audio={}),f.video===!0&&(f.video={}),f.audio&&(Wf(f.audio,e),(i=(s=f.audio).deviceId)!==null&&i!==void 0||(s.deviceId={ideal:"default"}),(l||u)&&(f.audio.processor=l??u)),f.video&&(Wf(f.video,n),(a=(r=f.video).deviceId)!==null&&a!==void 0||(r.deviceId={ideal:"default"}),(c||d)&&(f.video.processor=c??d)),f}function Wf(t,e){return Object.keys(e).forEach(n=>{t[n]===void 0&&(t[n]=e[n])}),t}function Ym(t){var e,n,i,a;const s={};if(t.video)if(typeof t.video=="object"){const r={},o=r,l=t.video;Object.keys(l).forEach(c=>{switch(c){case"resolution":Wf(o,l.resolution);break;default:o[c]=l[c]}}),s.video=r,(e=(i=s.video).deviceId)!==null&&e!==void 0||(i.deviceId={ideal:"default"})}else s.video=t.video?{deviceId:{ideal:"default"}}:!1;else s.video=!1;return t.audio?typeof t.audio=="object"?(s.audio=t.audio,(n=(a=s.audio).deviceId)!==null&&n!==void 0||(a.deviceId={ideal:"default"})):s.audio={deviceId:{ideal:"default"}}:s.audio=!1,s}function $C(t){return S(this,arguments,void 0,function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:200;return function*(){const i=ek();if(i){const a=i.createAnalyser();a.fftSize=2048;const s=a.frequencyBinCount,r=new Uint8Array(s);i.createMediaStreamSource(new MediaStream([e.mediaStreamTrack])).connect(a),yield bt(n),a.getByteTimeDomainData(r);const l=r.some(c=>c!==128&&c!==0);return i.close(),!l}return!1}()})}function ek(){var t;const e=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);if(e){const n=new e({latencyHint:"interactive"});if(n.state==="suspended"&&typeof window<"u"&&(!((t=window.document)===null||t===void 0)&&t.body)){const i=()=>S(this,void 0,void 0,function*(){var a;try{n.state==="suspended"&&(yield n.resume())}catch(s){console.warn("Error trying to auto-resume audio context",s)}finally{(a=window.document.body)===null||a===void 0||a.removeEventListener("click",i)}});n.addEventListener("statechange",()=>{var a;n.state==="closed"&&((a=window.document.body)===null||a===void 0||a.removeEventListener("click",i))}),window.document.body.addEventListener("click",i)}return n}}function CD(t){return t==="audioinput"?U.Source.Microphone:t==="videoinput"?U.Source.Camera:U.Source.Unknown}function $f(t){return t===U.Source.Microphone?"audioinput":t===U.Source.Camera?"videoinput":void 0}function kD(t){var e,n;let i=(e=t.video)!==null&&e!==void 0?e:!0;return t.resolution&&t.resolution.width>0&&t.resolution.height>0&&(i=typeof i=="boolean"?{}:i,Qa()?i=Object.assign(Object.assign({},i),{width:{max:t.resolution.width},height:{max:t.resolution.height},frameRate:t.resolution.frameRate}):i=Object.assign(Object.assign({},i),{width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:t.resolution.frameRate})),{audio:(n=t.audio)!==null&&n!==void 0?n:!1,video:i,controller:t.controller,selfBrowserSurface:t.selfBrowserSurface,surfaceSwitching:t.surfaceSwitching,systemAudio:t.systemAudio,preferCurrentTab:t.preferCurrentTab}}function io(t){return t.split("/")[1].toLowerCase()}function ED(t){const e=[];return t.forEach(n=>{n.track!==void 0&&e.push(new Im({cid:n.track.mediaStreamID,track:n.trackInfo}))}),e}function se(t){return"mediaStreamTrack"in t?{trackID:t.sid,source:t.source,muted:t.isMuted,enabled:t.mediaStreamTrack.enabled,kind:t.kind,streamID:t.mediaStreamID,streamTrackID:t.mediaStreamTrack.id}:{trackID:t.trackSid,enabled:t.isEnabled,muted:t.isMuted,trackInfo:Object.assign({mimeType:t.mimeType,name:t.trackName,encrypted:t.isEncrypted,kind:t.kind,source:t.source},t.track?se(t.track):{})}}function _D(){return typeof RTCRtpReceiver<"u"&&"getSynchronizationSources"in RTCRtpReceiver}function RD(t,e){var n;t===void 0&&(t={}),e===void 0&&(e={});const i=[...Object.keys(e),...Object.keys(t)],a={};for(const s of i)t[s]!==e[s]&&(a[s]=(n=e[s])!==null&&n!==void 0?n:"");return a}function tk(t){const e=Object.assign({},t);let n,i;return typeof e.audio=="object"&&e.audio.processor&&(n=e.audio.processor,e.audio=Object.assign(Object.assign({},e.audio),{processor:void 0})),typeof e.video=="object"&&e.video.processor&&(i=e.video.processor,e.video=Object.assign(Object.assign({},e.video),{processor:void 0})),{audioProcessor:n,videoProcessor:i,optionsWithoutProcessor:vD(e)}}function xD(t){switch(t){case Xe.CAMERA:return U.Source.Camera;case Xe.MICROPHONE:return U.Source.Microphone;case Xe.SCREEN_SHARE:return U.Source.ScreenShare;case Xe.SCREEN_SHARE_AUDIO:return U.Source.ScreenShareAudio;default:return U.Source.Unknown}}function Vv(t,e){return t.width*t.height<e.width*e.height}function wD(t,e){var n;return(n=t.layers)===null||n===void 0?void 0:n.find(i=>i.quality===e)}const OD=5e3,wr=[];var Yt;(function(t){t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH"})(Yt||(Yt={}));class U extends Zn.EventEmitter{get streamState(){return this._streamState}setStreamState(e){this._streamState=e}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};var a;super(),this.attachedElements=[],this.isMuted=!1,this._streamState=U.StreamState.Active,this.isInBackground=!1,this._currentBitrate=0,this.log=ie,this.appVisibilityChangedListener=()=>{this.backgroundTimeout&&clearTimeout(this.backgroundTimeout),document.visibilityState==="hidden"?this.backgroundTimeout=setTimeout(()=>this.handleAppVisibilityChanged(),OD):this.handleAppVisibilityChanged()},this.log=xi((a=i.loggerName)!==null&&a!==void 0?a:Dn.Track),this.loggerContextCb=i.loggerContextCb,this.setMaxListeners(100),this.kind=n,this._mediaStreamTrack=e,this._mediaStreamID=e.id,this.source=U.Source.Unknown}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),se(this))}get currentBitrate(){return this._currentBitrate}get mediaStreamTrack(){return this._mediaStreamTrack}get mediaStreamID(){return this._mediaStreamID}attach(e){let n="audio";this.kind===U.Kind.Video&&(n="video"),this.attachedElements.length===0&&this.kind===U.Kind.Video&&this.addAppVisibilityListener(),e||(n==="audio"&&(wr.forEach(s=>{s.parentElement===null&&!e&&(e=s)}),e&&wr.splice(wr.indexOf(e),1)),e||(e=document.createElement(n))),this.attachedElements.includes(e)||this.attachedElements.push(e),_s(this.mediaStreamTrack,e);const i=e.srcObject.getTracks(),a=i.some(s=>s.kind==="audio");return e.play().then(()=>{this.emit(a?B.AudioPlaybackStarted:B.VideoPlaybackStarted)}).catch(s=>{s.name==="NotAllowedError"?this.emit(a?B.AudioPlaybackFailed:B.VideoPlaybackFailed,s):s.name==="AbortError"?ie.debug("".concat(a?"audio":"video"," playback aborted, likely due to new play request")):ie.warn("could not playback ".concat(a?"audio":"video"),s),a&&e&&i.some(r=>r.kind==="video")&&s.name==="NotAllowedError"&&(e.muted=!0,e.play().catch(()=>{}))}),this.emit(B.ElementAttached,e),e}detach(e){try{if(e){js(this.mediaStreamTrack,e);const i=this.attachedElements.indexOf(e);return i>=0&&(this.attachedElements.splice(i,1),this.recycleElement(e),this.emit(B.ElementDetached,e)),e}const n=[];return this.attachedElements.forEach(i=>{js(this.mediaStreamTrack,i),n.push(i),this.recycleElement(i),this.emit(B.ElementDetached,i)}),this.attachedElements=[],n}finally{this.attachedElements.length===0&&this.removeAppVisibilityListener()}}stop(){this.stopMonitor(),this._mediaStreamTrack.stop()}enable(){this._mediaStreamTrack.enabled=!0}disable(){this._mediaStreamTrack.enabled=!1}stopMonitor(){this.monitorInterval&&clearInterval(this.monitorInterval),this.timeSyncHandle&&cancelAnimationFrame(this.timeSyncHandle)}updateLoggerOptions(e){e.loggerName&&(this.log=xi(e.loggerName)),e.loggerContextCb&&(this.loggerContextCb=e.loggerContextCb)}recycleElement(e){if(e instanceof HTMLAudioElement){let n=!0;e.pause(),wr.forEach(i=>{i.parentElement||(n=!1)}),n&&wr.push(e)}}handleAppVisibilityChanged(){return S(this,void 0,void 0,function*(){this.isInBackground=document.visibilityState==="hidden",!this.isInBackground&&this.kind===U.Kind.Video&&setTimeout(()=>this.attachedElements.forEach(e=>e.play().catch(()=>{})),0)})}addAppVisibilityListener(){Ut()?(this.isInBackground=document.visibilityState==="hidden",document.addEventListener("visibilitychange",this.appVisibilityChangedListener)):this.isInBackground=!1}removeAppVisibilityListener(){Ut()&&document.removeEventListener("visibilitychange",this.appVisibilityChangedListener)}}function _s(t,e){let n;e.srcObject instanceof MediaStream?n=e.srcObject:n=new MediaStream;let i;t.kind==="audio"?i=n.getAudioTracks():i=n.getVideoTracks(),i.includes(t)||(i.forEach(a=>{n.removeTrack(a)}),n.addTrack(t)),(!Qa()||!(e instanceof HTMLVideoElement))&&(e.autoplay=!0),e.muted=n.getAudioTracks().length===0,e instanceof HTMLVideoElement&&(e.playsInline=!0),e.srcObject!==n&&(e.srcObject=n,(Qa()||Ya())&&e instanceof HTMLVideoElement&&setTimeout(()=>{e.srcObject=n,e.play().catch(()=>{})},0))}function js(t,e){if(e.srcObject instanceof MediaStream){const n=e.srcObject;n.removeTrack(t),n.getTracks().length>0?e.srcObject=n:e.srcObject=null}}(function(t){let e;(function(c){c.Audio="audio",c.Video="video",c.Unknown="unknown"})(e=t.Kind||(t.Kind={}));let n;(function(c){c.Camera="camera",c.Microphone="microphone",c.ScreenShare="screen_share",c.ScreenShareAudio="screen_share_audio",c.Unknown="unknown"})(n=t.Source||(t.Source={}));let i;(function(c){c.Active="active",c.Paused="paused",c.Unknown="unknown"})(i=t.StreamState||(t.StreamState={}));function a(c){switch(c){case e.Audio:return xn.AUDIO;case e.Video:return xn.VIDEO;default:return xn.DATA}}t.kindToProto=a;function s(c){switch(c){case xn.AUDIO:return e.Audio;case xn.VIDEO:return e.Video;default:return e.Unknown}}t.kindFromProto=s;function r(c){switch(c){case n.Camera:return Xe.CAMERA;case n.Microphone:return Xe.MICROPHONE;case n.ScreenShare:return Xe.SCREEN_SHARE;case n.ScreenShareAudio:return Xe.SCREEN_SHARE_AUDIO;default:return Xe.UNKNOWN}}t.sourceToProto=r;function o(c){switch(c){case Xe.CAMERA:return n.Camera;case Xe.MICROPHONE:return n.Microphone;case Xe.SCREEN_SHARE:return n.ScreenShare;case Xe.SCREEN_SHARE_AUDIO:return n.ScreenShareAudio;default:return n.Unknown}}t.sourceFromProto=o;function l(c){switch(c){case qf.ACTIVE:return i.Active;case qf.PAUSED:return i.Paused;default:return i.Unknown}}t.streamStateFromProto=l})(U||(U={}));const AD="|",Hv="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension";function MD(t){const e=t.split(AD);return e.length>1?[e[0],t.substr(e[0].length+1)]:[t,""]}function bt(t){return new Tt(e=>vt.setTimeout(e,t))}function eh(){return"addTransceiver"in RTCPeerConnection.prototype}function th(){return"addTrack"in RTCPeerConnection.prototype}function DD(){if(!("getCapabilities"in RTCRtpSender)||Qa()||Ya())return!1;const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/av1"){e=!0;break}}return e}function ND(){if(!("getCapabilities"in RTCRtpSender)||Ya())return!1;if(Qa()){const n=jt();if(n!=null&&n.version&&Yn(n.version,"16")<0||(n==null?void 0:n.os)==="iOS"&&(n!=null&&n.osVersion)&&Yn(n.osVersion,"16")<0)return!1}const t=RTCRtpSender.getCapabilities("video");let e=!1;if(t){for(const n of t.codecs)if(n.mimeType.toLowerCase()==="video/vp9"){e=!0;break}}return e}function On(t){return t==="av1"||t==="vp9"}function nh(t){return!document||xo()?!1:(t||(t=document.createElement("audio")),"setSinkId"in t)}function PD(){return typeof RTCPeerConnection>"u"?!1:eh()||th()}function Ya(){var t;return((t=jt())===null||t===void 0?void 0:t.name)==="Firefox"}function Gv(){const t=jt();return!!t&&t.name==="Chrome"&&t.os!=="iOS"}function Qa(){var t;return((t=jt())===null||t===void 0?void 0:t.name)==="Safari"}function xo(){const t=jt();return(t==null?void 0:t.name)==="Safari"||(t==null?void 0:t.os)==="iOS"}function LD(){const t=jt();return(t==null?void 0:t.name)==="Safari"&&t.version.startsWith("17.")||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Yn(t.osVersion,"17")>=0}function UD(t){return t||(t=jt()),(t==null?void 0:t.name)==="Safari"&&Yn(t.version,"18.3")>0||(t==null?void 0:t.os)==="iOS"&&!!(t!=null&&t.osVersion)&&Yn(t.osVersion,"18.3")>0}function nk(){var t,e;return Ut()?(e=(t=navigator.userAgentData)===null||t===void 0?void 0:t.mobile)!==null&&e!==void 0?e:/Tablet|iPad|Mobile|Android|BlackBerry/.test(navigator.userAgent):!1}function ID(){const t=jt(),e="17.2";if(t)return t.name!=="Safari"&&t.os!=="iOS"||t.os==="iOS"&&t.osVersion&&Yn(t.osVersion,e)>=0?!0:t.name==="Safari"&&Yn(t.version,e)>=0}function Ut(){return typeof document<"u"}function Kn(){return navigator.product=="ReactNative"}function tr(t){return t.hostname.endsWith(".livekit.cloud")||t.hostname.endsWith(".livekit.run")}function Cd(t){return tr(t)?t.hostname.split(".")[0]:null}function ik(){if(global&&global.LiveKitReactNativeGlobal)return global.LiveKitReactNativeGlobal}function ak(){if(!Kn())return;let t=ik();if(t)return t.platform}function Kv(){if(Ut())return window.devicePixelRatio;if(Kn()){let t=ik();if(t)return t.devicePixelRatio}return 1}function Yn(t,e){const n=t.split("."),i=e.split("."),a=Math.min(n.length,i.length);for(let s=0;s<a;++s){const r=parseInt(n[s],10),o=parseInt(i[s],10);if(r>o)return 1;if(r<o)return-1;if(s===a-1&&r===o)return 0}return t===""&&e!==""?-1:e===""?1:n.length==i.length?0:n.length<i.length?-1:1}function jD(t){for(const e of t)e.target.handleResize(e)}function BD(t){for(const e of t)e.target.handleVisibilityChanged(e)}let kd=null;const Yv=()=>(kd||(kd=new ResizeObserver(jD)),kd);let Ed=null;const Qv=()=>(Ed||(Ed=new IntersectionObserver(BD,{root:null,rootMargin:"0px"})),Ed);function qD(){var t;const e=new eC({sdk:tC.JS,protocol:pD,version:mD});return Kn()&&(e.os=(t=ak())!==null&&t!==void 0?t:""),e}function Jv(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const a=document.createElement("canvas");a.width=t,a.height=e;const s=a.getContext("2d");s==null||s.fillRect(0,0,a.width,a.height),i&&s&&(s.beginPath(),s.arc(t/2,e/2,50,0,Math.PI*2,!0),s.closePath(),s.fillStyle="grey",s.fill());const r=a.captureStream(),[o]=r.getTracks();if(!o)throw Error("Could not get empty media stream video track");return o.enabled=n,o}let Or;function _d(){if(!Or){const t=new AudioContext,e=t.createOscillator(),n=t.createGain();n.gain.setValueAtTime(0,0);const i=t.createMediaStreamDestination();if(e.connect(n),n.connect(i),e.start(),[Or]=i.stream.getAudioTracks(),!Or)throw Error("Could not get empty media stream audio track");Or.enabled=!1}return Or.clone()}class hn{get isResolved(){return this._isResolved}constructor(e,n){this._isResolved=!1,this.onFinally=n,this.promise=new Promise((i,a)=>S(this,void 0,void 0,function*(){this.resolve=i,this.reject=a,e&&(yield e(i,a))})).finally(()=>{var i;this._isResolved=!0,(i=this.onFinally)===null||i===void 0||i.call(this)})}}function zD(t){return yD.includes(t)}function la(t){if(typeof t=="string"||typeof t=="number")return t;if(Array.isArray(t))return t[0];if(t.exact!==void 0)return Array.isArray(t.exact)?t.exact[0]:t.exact;if(t.ideal!==void 0)return Array.isArray(t.ideal)?t.ideal[0]:t.ideal;throw Error("could not unwrap constraint")}function FD(t){return t.startsWith("http")?t.replace(/^(http)/,"ws"):t}function wo(t){return t.startsWith("ws")?t.replace(/^(ws)/,"http"):t}function VD(t,e){return t.segments.map(n=>{let{id:i,text:a,language:s,startTime:r,endTime:o,final:l}=n;var c;const u=(c=e.get(i))!==null&&c!==void 0?c:Date.now(),d=Date.now();return l?e.delete(i):e.set(i,u),{id:i,text:a,startTime:Number.parseInt(r.toString()),endTime:Number.parseInt(o.toString()),final:l,language:s,firstReceivedTime:u,lastReceivedTime:d}})}function HD(t){const{id:e,timestamp:n,message:i,editTimestamp:a}=t;return{id:e,timestamp:Number.parseInt(n.toString()),editTimestamp:a?Number.parseInt(a.toString()):void 0,message:i}}function Xv(t){switch(t.reason){case Re.LeaveRequest:return t.context;case Re.Cancelled:return An.CLIENT_INITIATED;case Re.NotAllowed:return An.USER_REJECTED;case Re.ServerUnreachable:return An.JOIN_FAILURE;default:return An.UNKNOWN_REASON}}function Ql(t){return t!==void 0?Number(t):void 0}function Na(t){return t!==void 0?BigInt(t):void 0}function Bs(t){return!!t&&!(t instanceof MediaStreamTrack)&&t.isLocal}function Hn(t){return!!t&&t.kind==U.Kind.Audio}function Ca(t){return!!t&&t.kind==U.Kind.Video}function Pi(t){return Bs(t)&&Ca(t)}function ai(t){return Bs(t)&&Hn(t)}function ih(t){return!!t&&!t.isLocal}function GD(t){return!!t&&!t.isLocal}function Rd(t){return ih(t)&&Ca(t)}function KD(t){return t.isLocal}function YD(t,e){const n=[];let i=new TextEncoder().encode(t);for(;i.length>e;){let a=e;for(;a>0;){const s=i[a];if(s!==void 0&&(s&192)!==128)break;a--}n.push(i.slice(0,a)),i=i.slice(a)}return i.length>0&&n.push(i),n}function QD(t){var e;const n=t.get("Cache-Control");if(n){const i=(e=n.match(/(?:^|[,\s])max-age=(\d+)/))===null||e===void 0?void 0:e[1];if(i)return parseInt(i,10)}}function JD(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=XD(t,e);return n?i:Qm(i,"v1")}function XD(t,e){const n=new URL(FD(t));return e.forEach((i,a)=>{n.searchParams.set(a,i)}),Qm(n,"rtc")}function ZD(t){const e=new URL(wo(t));return Qm(e,"validate")}function sk(t){return t.endsWith("/")?t:"".concat(t,"/")}function Qm(t,e){return t.pathname="".concat(sk(t.pathname)).concat(e),t}function Zv(t){if(typeof t=="string")return Ov.fromJson(JSON.parse(t),{ignoreUnknownFields:!0});if(t instanceof ArrayBuffer)return Ov.fromBinary(new Uint8Array(t));throw new Error("could not decode websocket message: ".concat(typeof t))}function WD(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Unknown reason";if(!(t instanceof AbortSignal))return e;const n=t.reason;switch(typeof n){case"string":return n;case"object":return n instanceof Error?n.message:e;default:return"toString"in n?n.toString():e}}const $D=10,Ar="lk_e2ee",eN="LKFrameEncryptionKey",tN={sharedKey:!1,ratchetSalt:eN,ratchetWindowSize:8,failureTolerance:$D,keyringSize:16};var ca;(function(t){t.SetKey="setKey",t.RatchetRequest="ratchetRequest",t.KeyRatcheted="keyRatcheted"})(ca||(ca={}));var Wv;(function(t){t.KeyRatcheted="keyRatcheted"})(Wv||(Wv={}));var Zi;(function(t){t.ParticipantEncryptionStatusChanged="participantEncryptionStatusChanged",t.EncryptionError="encryptionError"})(Zi||(Zi={}));var $v;(function(t){t.Error="cryptorError"})($v||($v={}));function nN(){return iN()||ah()}function ah(){return typeof window.RTCRtpScriptTransform<"u"}function iN(){return typeof window.RTCRtpSender<"u"&&typeof window.RTCRtpSender.prototype.createEncodedStreams<"u"}function aN(t){var e,n,i,a,s;if(((e=t.value)===null||e===void 0?void 0:e.case)!=="sipDtmf"&&((n=t.value)===null||n===void 0?void 0:n.case)!=="metrics"&&((i=t.value)===null||i===void 0?void 0:i.case)!=="speaker"&&((a=t.value)===null||a===void 0?void 0:a.case)!=="transcription"&&((s=t.value)===null||s===void 0?void 0:s.case)!=="encryptedPacket")return new YT({value:t.value})}class K2 extends Zn.EventEmitter{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),this.onKeyRatcheted=(n,i,a)=>{ie.debug("key ratcheted event received",{ratchetResult:n,participantId:i,keyIndex:a})},this.keyInfoMap=new Map,this.options=Object.assign(Object.assign({},tN),e),this.on(ca.KeyRatcheted,this.onKeyRatcheted)}onSetEncryptionKey(e,n,i){const a={key:e,participantIdentity:n,keyIndex:i};if(!this.options.sharedKey&&!n)throw new Error("participant identity needs to be passed for encryption key if sharedKey option is false");this.keyInfoMap.set("".concat(n??"shared","-").concat(i??0),a),this.emit(ca.SetKey,a)}getKeys(){return Array.from(this.keyInfoMap.values())}getOptions(){return this.options}ratchetKey(e,n){this.emit(ca.RatchetRequest,e,n)}}var e0;(function(t){t[t.InvalidKey=0]="InvalidKey",t[t.MissingKey=1]="MissingKey",t[t.InternalError=2]="InternalError"})(e0||(e0={}));class sN extends Zn.EventEmitter{constructor(e,n){super(),this.decryptDataRequests=new Map,this.encryptDataRequests=new Map,this.onWorkerMessage=i=>{var a,s;const{kind:r,data:o}=i.data;switch(r){case"error":if(ie.error(o.error.message),o.uuid){const u=this.decryptDataRequests.get(o.uuid);if(u!=null&&u.reject){u.reject(o.error);break}const d=this.encryptDataRequests.get(o.uuid);if(d!=null&&d.reject){d.reject(o.error);break}}this.emit(Zi.EncryptionError,o.error,o.participantIdentity);break;case"initAck":o.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)});break;case"enable":if(o.enabled&&this.keyProvider.getKeys().forEach(u=>{this.postKey(u)}),this.encryptionEnabled!==o.enabled&&o.participantIdentity===((a=this.room)===null||a===void 0?void 0:a.localParticipant.identity))this.emit(Zi.ParticipantEncryptionStatusChanged,o.enabled,this.room.localParticipant),this.encryptionEnabled=o.enabled;else if(o.participantIdentity){const u=(s=this.room)===null||s===void 0?void 0:s.getParticipantByIdentity(o.participantIdentity);if(!u)throw TypeError("couldn't set encryption status, participant not found".concat(o.participantIdentity));this.emit(Zi.ParticipantEncryptionStatusChanged,o.enabled,u)}break;case"ratchetKey":this.keyProvider.emit(ca.KeyRatcheted,o.ratchetResult,o.participantIdentity,o.keyIndex);break;case"decryptDataResponse":const l=this.decryptDataRequests.get(o.uuid);l!=null&&l.resolve&&l.resolve(o);break;case"encryptDataResponse":const c=this.encryptDataRequests.get(o.uuid);c!=null&&c.resolve&&c.resolve(o);break}},this.onWorkerError=i=>{ie.error("e2ee worker encountered an error:",{error:i.error}),this.emit(Zi.EncryptionError,i.error,void 0)},this.keyProvider=e.keyProvider,this.worker=e.worker,this.encryptionEnabled=!1,this.dataChannelEncryptionEnabled=n}get isEnabled(){return this.encryptionEnabled}get isDataChannelEncryptionEnabled(){return this.isEnabled&&this.dataChannelEncryptionEnabled}setup(e){if(!nN())throw new Gm("tried to setup end-to-end encryption on an unsupported browser");if(ie.info("setting up e2ee"),e!==this.room){this.room=e,this.setupEventListeners(e,this.keyProvider);const n={kind:"init",data:{keyProviderOptions:this.keyProvider.getOptions(),loglevel:WM.getLevel()}};this.worker&&(ie.info("initializing worker",{worker:this.worker}),this.worker.onmessage=this.onWorkerMessage,this.worker.onerror=this.onWorkerError,this.worker.postMessage(n))}}setParticipantCryptorEnabled(e,n){ie.debug("set e2ee to ".concat(e," for participant ").concat(n)),this.postEnable(e,n)}setSifTrailer(e){!e||e.length===0?ie.warn("ignoring server sent trailer as it's empty"):this.postSifTrailer(e)}setupEngine(e){e.on(F.RTPVideoMapUpdate,n=>{this.postRTPMap(n)})}setupEventListeners(e,n){e.on(j.TrackPublished,(i,a)=>this.setParticipantCryptorEnabled(i.trackInfo.encryption!==Ke.NONE,a.identity)),e.on(j.ConnectionStateChanged,i=>{i===me.Connected&&e.remoteParticipants.forEach(a=>{a.trackPublications.forEach(s=>{this.setParticipantCryptorEnabled(s.trackInfo.encryption!==Ke.NONE,a.identity)})})}).on(j.TrackUnsubscribed,(i,a,s)=>{var r;const o={kind:"removeTransform",data:{participantIdentity:s.identity,trackId:i.mediaStreamID}};(r=this.worker)===null||r===void 0||r.postMessage(o)}).on(j.TrackSubscribed,(i,a,s)=>{this.setupE2EEReceiver(i,s.identity,a.trackInfo)}).on(j.SignalConnected,()=>{if(!this.room)throw new TypeError("expected room to be present on signal connect");n.getKeys().forEach(i=>{this.postKey(i)}),this.setParticipantCryptorEnabled(this.room.localParticipant.isE2EEEnabled,this.room.localParticipant.identity)}),e.localParticipant.on(V.LocalSenderCreated,(i,a)=>S(this,void 0,void 0,function*(){this.setupE2EESender(a,i)})),e.localParticipant.on(V.LocalTrackPublished,i=>{if(!Ca(i.track)||!xo())return;const a={kind:"updateCodec",data:{trackId:i.track.mediaStreamID,codec:io(i.trackInfo.codecs[0].mimeType),participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(a)}),n.on(ca.SetKey,i=>this.postKey(i)).on(ca.RatchetRequest,(i,a)=>this.postRatchetRequest(i,a))}encryptData(e){return S(this,void 0,void 0,function*(){if(!this.worker)throw Error("could not encrypt data, worker is missing");const n=crypto.randomUUID(),i={kind:"encryptDataRequest",data:{uuid:n,payload:e,participantIdentity:this.room.localParticipant.identity}},a=new hn;return a.onFinally=()=>{this.encryptDataRequests.delete(n)},this.encryptDataRequests.set(n,a),this.worker.postMessage(i),a.promise})}handleEncryptedData(e,n,i,a){if(!this.worker)throw Error("could not handle encrypted data, worker is missing");const s=crypto.randomUUID(),r={kind:"decryptDataRequest",data:{uuid:s,payload:e,iv:n,participantIdentity:i,keyIndex:a}},o=new hn;return o.onFinally=()=>{this.decryptDataRequests.delete(s)},this.decryptDataRequests.set(s,o),this.worker.postMessage(r),o.promise}postRatchetRequest(e,n){if(!this.worker)throw Error("could not ratchet key, worker is missing");const i={kind:"ratchetRequest",data:{participantIdentity:e,keyIndex:n}};this.worker.postMessage(i)}postKey(e){let{key:n,participantIdentity:i,keyIndex:a}=e;var s;if(!this.worker)throw Error("could not set key, worker is missing");const r={kind:"setKey",data:{participantIdentity:i,isPublisher:i===((s=this.room)===null||s===void 0?void 0:s.localParticipant.identity),key:n,keyIndex:a}};this.worker.postMessage(r)}postEnable(e,n){if(this.worker){const i={kind:"enable",data:{enabled:e,participantIdentity:n}};this.worker.postMessage(i)}else throw new ReferenceError("failed to enable e2ee, worker is not ready")}postRTPMap(e){var n;if(!this.worker)throw TypeError("could not post rtp map, worker is missing");if(!(!((n=this.room)===null||n===void 0)&&n.localParticipant.identity))throw TypeError("could not post rtp map, local participant identity is missing");const i={kind:"setRTPMap",data:{map:e,participantIdentity:this.room.localParticipant.identity}};this.worker.postMessage(i)}postSifTrailer(e){if(!this.worker)throw Error("could not post SIF trailer, worker is missing");const n={kind:"setSifTrailer",data:{trailer:e}};this.worker.postMessage(n)}setupE2EEReceiver(e,n,i){if(e.receiver){if(!(i!=null&&i.mimeType)||i.mimeType==="")throw new TypeError("MimeType missing from trackInfo, cannot set up E2EE cryptor");this.handleReceiver(e.receiver,e.mediaStreamID,n,e.kind==="video"?io(i.mimeType):void 0)}}setupE2EESender(e,n){if(!Bs(e)||!n){n||ie.warn("early return because sender is not ready");return}this.handleSender(n,e.mediaStreamID,void 0)}handleReceiver(e,n,i,a){return S(this,void 0,void 0,function*(){if(this.worker){if(ah()&&!Gv()){const s={kind:"decode",participantIdentity:i,trackId:n,codec:a};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{if(Ar in e&&a){const l={kind:"updateCodec",data:{trackId:n,codec:a,participantIdentity:i}};this.worker.postMessage(l);return}let s=e.writableStream,r=e.readableStream;if(!s||!r){const l=e.createEncodedStreams();e.writableStream=l.writable,s=l.writable,e.readableStream=l.readable,r=l.readable}const o={kind:"decode",data:{readableStream:r,writableStream:s,trackId:n,codec:a,participantIdentity:i,isReuse:Ar in e}};this.worker.postMessage(o,[r,s])}e[Ar]=!0}})}handleSender(e,n,i){var a;if(!(Ar in e||!this.worker)){if(!(!((a=this.room)===null||a===void 0)&&a.localParticipant.identity)||this.room.localParticipant.identity==="")throw TypeError("local identity needs to be known in order to set up encrypted sender");if(ah()&&!Gv()){ie.info("initialize script transform");const s={kind:"encode",participantIdentity:this.room.localParticipant.identity,trackId:n,codec:i};e.transform=new RTCRtpScriptTransform(this.worker,s)}else{ie.info("initialize encoded streams");const s=e.createEncodedStreams(),r={kind:"encode",data:{readableStream:s.readable,writableStream:s.writable,codec:i,trackId:n,participantIdentity:this.room.localParticipant.identity,isReuse:!1}};this.worker.postMessage(r,[s.readable,s.writable])}e[Ar]=!0}}}const rN=500,oN=15e3;class qs{constructor(){this.failedConnectionAttempts=new Map,this.backOffPromises=new Map}static getInstance(){return this._instance||(this._instance=new qs),this._instance}addFailedConnectionAttempt(e){var n;const i=new URL(e),a=Cd(i);if(!a)return;let s=(n=this.failedConnectionAttempts.get(a))!==null&&n!==void 0?n:0;this.failedConnectionAttempts.set(a,s+1),this.backOffPromises.set(a,bt(Math.min(rN*Math.pow(2,s),oN)))}getBackOffPromise(e){const n=new URL(e),i=n&&Cd(n);return i&&this.backOffPromises.get(i)||Promise.resolve()}resetFailedConnectionAttempts(e){const n=new URL(e),i=n&&Cd(n);i&&(this.failedConnectionAttempts.set(i,0),this.backOffPromises.set(i,Promise.resolve()))}resetAll(){this.backOffPromises.clear(),this.failedConnectionAttempts.clear()}}qs._instance=null;const xd="default";class ut{constructor(){this._previousDevices=[]}static getInstance(){return this.instance===void 0&&(this.instance=new ut),this.instance}get previousDevices(){return this._previousDevices}getDevices(e){return S(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;if(((s=ut.userMediaPromiseMap)===null||s===void 0?void 0:s.size)>0){ie.debug("awaiting getUserMedia promise");try{n?yield ut.userMediaPromiseMap.get(n):yield Promise.all(ut.userMediaPromiseMap.values())}catch{ie.warn("error waiting for media permissons")}}let r=yield navigator.mediaDevices.enumerateDevices();if(a&&!(Qa()&&i.hasDeviceInUse(n))&&(r.filter(l=>l.kind===n).length===0||r.some(l=>{const c=l.label==="",u=n?l.kind===n:!0;return c&&u}))){const l={video:n!=="audioinput"&&n!=="audiooutput",audio:n!=="videoinput"&&{deviceId:{ideal:"default"}}},c=yield navigator.mediaDevices.getUserMedia(l);r=yield navigator.mediaDevices.enumerateDevices(),c.getTracks().forEach(u=>{u.stop()})}return i._previousDevices=r,n&&(r=r.filter(o=>o.kind===n)),r}()})}normalizeDeviceId(e,n,i){return S(this,void 0,void 0,function*(){if(n!==xd)return n;const a=yield this.getDevices(e),s=a.find(o=>o.deviceId===xd);if(!s){ie.warn("could not reliably determine default device");return}const r=a.find(o=>o.deviceId!==xd&&o.groupId===(i??s.groupId));if(!r){ie.warn("could not reliably determine default device");return}return r==null?void 0:r.deviceId})}hasDeviceInUse(e){return e?ut.userMediaPromiseMap.has(e):ut.userMediaPromiseMap.size>0}}ut.mediaDeviceKinds=["audioinput","audiooutput","videoinput"];ut.userMediaPromiseMap=new Map;var ao;(function(t){t[t.WAITING=0]="WAITING",t[t.RUNNING=1]="RUNNING",t[t.COMPLETED=2]="COMPLETED"})(ao||(ao={}));class lN{constructor(){this.pendingTasks=new Map,this.taskMutex=new xt,this.nextTaskIndex=0}run(e){return S(this,void 0,void 0,function*(){const n={id:this.nextTaskIndex++,enqueuedAt:Date.now(),status:ao.WAITING};this.pendingTasks.set(n.id,n);const i=yield this.taskMutex.lock();try{return n.executedAt=Date.now(),n.status=ao.RUNNING,yield e()}finally{n.status=ao.COMPLETED,this.pendingTasks.delete(n.id),i()}})}flush(){return S(this,void 0,void 0,function*(){return this.run(()=>S(this,void 0,void 0,function*(){}))})}snapshot(){return Array.from(this.pendingTasks.values())}}class cN{get readyState(){return this.ws.readyState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i,a;if(!((i=n.signal)===null||i===void 0)&&i.aborted)throw new DOMException("This operation was aborted","AbortError");this.url=e;const s=new WebSocket(e,(a=n.protocols)!==null&&a!==void 0?a:[]);s.binaryType="arraybuffer",this.ws=s;const r=function(){let{closeCode:o,reason:l}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return s.close(o,l)};this.opened=new Tt((o,l)=>{const c=()=>{l(J.websocket("Encountered websocket error during connection establishment"))};s.onopen=()=>{o({readable:new ReadableStream({start(u){s.onmessage=d=>{let{data:f}=d;return u.enqueue(f)},s.onerror=d=>u.error(d)},cancel:r}),writable:new WritableStream({write(u){s.send(u)},abort(){s.close()},close:r}),protocol:s.protocol,extensions:s.extensions}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),this.closed=new Tt((o,l)=>{const c=()=>S(this,void 0,void 0,function*(){const u=new Tt(f=>{s.readyState!==WebSocket.CLOSED&&s.addEventListener("close",h=>{f(h)},{once:!0})}),d=yield Tt.race([bt(250),u]);d?o(d):l(J.websocket("Encountered unspecified websocket error without a timely close event"))});s.onclose=u=>{let{code:d,reason:f}=u;o({closeCode:d,reason:f}),s.removeEventListener("error",c)},s.addEventListener("error",c)}),n.signal&&(n.signal.onabort=()=>s.close()),this.close=r}}const uN=["syncState","trickle","offer","answer","simulate","leave"];function dN(t){const e=uN.indexOf(t.case)>=0;return ie.trace("request allowed to bypass queue:",{canPass:e,req:t}),e}var _e;(function(t){t[t.CONNECTING=0]="CONNECTING",t[t.CONNECTED=1]="CONNECTED",t[t.RECONNECTING=2]="RECONNECTING",t[t.DISCONNECTING=3]="DISCONNECTING",t[t.DISCONNECTED=4]="DISCONNECTED"})(_e||(_e={}));const fN=250;class Jm{get currentState(){return this.state}get isDisconnected(){return this.state===_e.DISCONNECTING||this.state===_e.DISCONNECTED}get isEstablishingConnection(){return this.state===_e.CONNECTING||this.state===_e.RECONNECTING}getNextRequestId(){return this._requestId+=1,this._requestId}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;this.rtt=0,this.state=_e.DISCONNECTED,this.log=ie,this._requestId=0,this.useV0SignalPath=!1,this.resetCallbacks=()=>{this.onAnswer=void 0,this.onLeave=void 0,this.onLocalTrackPublished=void 0,this.onLocalTrackUnpublished=void 0,this.onNegotiateRequested=void 0,this.onOffer=void 0,this.onRemoteMuteChanged=void 0,this.onSubscribedQualityUpdate=void 0,this.onTokenRefresh=void 0,this.onTrickle=void 0,this.onClose=void 0,this.onMediaSectionsRequirement=void 0},this.log=xi((i=n.loggerName)!==null&&i!==void 0?i:Dn.Signal),this.loggerContextCb=n.loggerContextCb,this.useJSON=e,this.requestQueue=new lN,this.queuedRequests=[],this.closingLock=new xt,this.connectionLock=new xt,this.state=_e.DISCONNECTED}get logContext(){var e,n;return(n=(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this))!==null&&n!==void 0?n:{}}join(e,n,i,a){return S(this,arguments,void 0,function(s,r,o,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){return c.state=_e.CONNECTING,c.options=o,yield c.connect(s,r,o,l,u)}()})}reconnect(e,n,i,a){return S(this,void 0,void 0,function*(){if(!this.options){this.log.warn("attempted to reconnect without signal options being set, ignoring",this.logContext);return}return this.state=_e.RECONNECTING,this.clearPingInterval(),yield this.connect(e,n,Object.assign(Object.assign({},this.options),{reconnect:!0,sid:i,reconnectReason:a}),void 0,this.useV0SignalPath)})}connect(e,n,i,a){return S(this,arguments,void 0,function(s,r,o,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){const d=yield c.connectionLock.lock();c.connectOptions=o,c.useV0SignalPath=u;const f=qD(),h=u?hN(r,f,o):mN(r,f,o),g=JD(s,h,u).toString(),y=ZD(g).toString();return new Promise((T,m)=>S(c,void 0,void 0,function*(){var p,v;try{let b=!1;const C=N=>S(this,void 0,void 0,function*(){if(b)return;b=!0;const z=N instanceof Event?N.currentTarget:N,G=WD(z,"Abort handler called");this.streamWriter&&!this.isDisconnected?this.sendLeave().then(()=>this.close(G)).catch(de=>{this.log.error(de),this.close()}):this.close(),_(),m(J.cancelled(G))});l==null||l.addEventListener("abort",C);const _=()=>{clearTimeout(w),l==null||l.removeEventListener("abort",C)},w=setTimeout(()=>{C(J.timeout("room connection has timed out (signal)"))},o.websocketTimeout),P=(N,z)=>{this.handleSignalConnected(N,w,z)},O=new URL(g);O.searchParams.has("access_token")&&O.searchParams.set("access_token","<redacted>"),this.log.debug("connecting to ".concat(O),Object.assign({reconnect:o.reconnect,reconnectReason:o.reconnectReason},this.logContext)),this.ws&&(yield this.close(!1)),this.ws=new cN(g);try{this.ws.closed.then(q=>{var X;this.isEstablishingConnection&&m(J.internal("Websocket got closed during a (re)connection attempt: ".concat(q.reason))),q.closeCode!==1e3&&(this.log.warn("websocket closed",Object.assign(Object.assign({},this.logContext),{reason:q.reason,code:q.closeCode,wasClean:q.closeCode===1e3,state:this.state})),this.state===_e.CONNECTED&&this.handleOnClose((X=q.reason)!==null&&X!==void 0?X:"Unexpected WS error"))}).catch(q=>{this.isEstablishingConnection&&m(J.internal("Websocket error during a (re)connection attempt: ".concat(q)))});const N=yield this.ws.opened.catch(q=>S(this,void 0,void 0,function*(){if(this.state!==_e.CONNECTED){this.state=_e.DISCONNECTED,clearTimeout(w);const X=yield this.handleConnectionError(q,y);m(X);return}this.handleWSError(q),m(q)}));if(clearTimeout(w),!N)return;const z=N.readable.getReader();this.streamWriter=N.writable.getWriter();const G=yield z.read();if(z.releaseLock(),!G.value)throw J.internal("no message received as first message");const de=Zv(G.value),at=this.validateFirstMessage(de,(p=o.reconnect)!==null&&p!==void 0?p:!1);if(!at.isValid){m(at.error);return}((v=de.message)===null||v===void 0?void 0:v.case)==="join"&&(this.pingTimeoutDuration=de.message.value.pingTimeout,this.pingIntervalDuration=de.message.value.pingInterval,this.pingTimeoutDuration&&this.pingTimeoutDuration>0&&this.log.debug("ping config",Object.assign(Object.assign({},this.logContext),{timeout:this.pingTimeoutDuration,interval:this.pingIntervalDuration})));const At=at.shouldProcessFirstMessage?de:void 0;P(N,At),T(at.response)}catch(N){m(N)}finally{_()}}finally{d()}}))}()})}startReadingLoop(e,n){return S(this,void 0,void 0,function*(){for(n&&this.handleSignalResponse(n);;){this.signalLatency&&(yield bt(this.signalLatency));const{done:i,value:a}=yield e.read();if(i)break;const s=Zv(a);this.handleSignalResponse(s)}})}close(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"Close method called on signal client";return function*(){if([_e.DISCONNECTING||_e.DISCONNECTED].includes(e.state)){e.log.debug("ignoring signal close as it's already in disconnecting state");return}const a=yield e.closingLock.lock();try{if(e.clearPingInterval(),n&&(e.state=_e.DISCONNECTING),e.ws){e.ws.close({closeCode:1e3,reason:i});const s=e.ws.closed;e.ws=void 0,e.streamWriter=void 0,yield Promise.race([s,bt(fN)])}}catch(s){e.log.debug("websocket error while closing",Object.assign(Object.assign({},e.logContext),{error:s}))}finally{n&&(e.state=_e.DISCONNECTED),a()}}()})}sendOffer(e,n){this.log.debug("sending offer",Object.assign(Object.assign({},this.logContext),{offerSdp:e.sdp})),this.sendRequest({case:"offer",value:Rs(e,n)})}sendAnswer(e,n){return this.log.debug("sending answer",Object.assign(Object.assign({},this.logContext),{answerSdp:e.sdp})),this.sendRequest({case:"answer",value:Rs(e,n)})}sendIceCandidate(e,n){return this.log.debug("sending ice candidate",Object.assign(Object.assign({},this.logContext),{candidate:e})),this.sendRequest({case:"trickle",value:new fu({candidateInit:JSON.stringify(e),target:n})})}sendMuteTrack(e,n){return this.sendRequest({case:"mute",value:new hu({sid:e,muted:n})})}sendAddTrack(e){return this.sendRequest({case:"addTrack",value:e})}sendUpdateLocalMetadata(e,n){return S(this,arguments,void 0,function(i,a){var s=this;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return function*(){const o=s.getNextRequestId();return yield s.sendRequest({case:"updateMetadata",value:new Bm({requestId:o,metadata:i,name:a,attributes:r})}),o}()})}sendUpdateTrackSettings(e){this.sendRequest({case:"trackSetting",value:e})}sendUpdateSubscription(e){return this.sendRequest({case:"subscription",value:e})}sendSyncState(e){return this.sendRequest({case:"syncState",value:e})}sendUpdateVideoLayers(e,n){return this.sendRequest({case:"updateLayers",value:new dC({trackSid:e,layers:n})})}sendUpdateSubscriptionPermissions(e,n){return this.sendRequest({case:"subscriptionPermission",value:new mC({allParticipants:e,trackPermissions:n})})}sendSimulateScenario(e){return this.sendRequest({case:"simulate",value:e})}sendPing(){return Promise.all([this.sendRequest({case:"ping",value:Ue.parse(Date.now())}),this.sendRequest({case:"pingReq",value:new vC({timestamp:Ue.parse(Date.now()),rtt:Ue.parse(this.rtt)})})])}sendUpdateLocalAudioTrack(e,n){return this.sendRequest({case:"updateAudioTrack",value:new jm({trackSid:e,features:n})})}sendLeave(){return this.sendRequest({case:"leave",value:new pu({reason:An.CLIENT_INITIATED,action:Ls.DISCONNECT})})}sendRequest(e){return S(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return function*(){if(!a&&!dN(n)&&i.state===_e.RECONNECTING){i.queuedRequests.push(()=>S(i,void 0,void 0,function*(){yield this.sendRequest(n,!0)}));return}if(a||(yield i.requestQueue.flush()),i.signalLatency&&(yield bt(i.signalLatency)),i.isDisconnected){i.log.debug("skipping signal request (type: ".concat(n.case,") - SignalClient disconnected"));return}if(!i.streamWriter){i.log.error("cannot send signal request before connected, type: ".concat(n==null?void 0:n.case),i.logContext);return}const r=new bM({message:n});try{i.useJSON?yield i.streamWriter.write(r.toJsonString()):yield i.streamWriter.write(r.toBinary())}catch(o){i.log.error("error sending signal message",Object.assign(Object.assign({},i.logContext),{error:o}))}}()})}handleSignalResponse(e){var n,i;const a=e.message;if(a==null){this.log.debug("received unsupported message",this.logContext);return}let s=!1;if(a.case==="answer"){const r=t0(a.value);this.onAnswer&&this.onAnswer(r,a.value.id,a.value.midToTrackId)}else if(a.case==="offer"){const r=t0(a.value);this.onOffer&&this.onOffer(r,a.value.id,a.value.midToTrackId)}else if(a.case==="trickle"){const r=JSON.parse(a.value.candidateInit);this.onTrickle&&this.onTrickle(r,a.value.target)}else a.case==="update"?this.onParticipantUpdate&&this.onParticipantUpdate((n=a.value.participants)!==null&&n!==void 0?n:[]):a.case==="trackPublished"?this.onLocalTrackPublished&&this.onLocalTrackPublished(a.value):a.case==="speakersChanged"?this.onSpeakersChanged&&this.onSpeakersChanged((i=a.value.speakers)!==null&&i!==void 0?i:[]):a.case==="leave"?this.onLeave&&this.onLeave(a.value):a.case==="mute"?this.onRemoteMuteChanged&&this.onRemoteMuteChanged(a.value.sid,a.value.muted):a.case==="roomUpdate"?this.onRoomUpdate&&a.value.room&&this.onRoomUpdate(a.value.room):a.case==="connectionQuality"?this.onConnectionQuality&&this.onConnectionQuality(a.value):a.case==="streamStateUpdate"?this.onStreamStateUpdate&&this.onStreamStateUpdate(a.value):a.case==="subscribedQualityUpdate"?this.onSubscribedQualityUpdate&&this.onSubscribedQualityUpdate(a.value):a.case==="subscriptionPermissionUpdate"?this.onSubscriptionPermissionUpdate&&this.onSubscriptionPermissionUpdate(a.value):a.case==="refreshToken"?this.onTokenRefresh&&this.onTokenRefresh(a.value):a.case==="trackUnpublished"?this.onLocalTrackUnpublished&&this.onLocalTrackUnpublished(a.value):a.case==="subscriptionResponse"?this.onSubscriptionError&&this.onSubscriptionError(a.value):a.case==="pong"||(a.case==="pongResp"?(this.rtt=Date.now()-Number.parseInt(a.value.lastPingTimestamp.toString()),this.resetPingTimeout(),s=!0):a.case==="requestResponse"?this.onRequestResponse&&this.onRequestResponse(a.value):a.case==="trackSubscribed"?this.onLocalTrackSubscribed&&this.onLocalTrackSubscribed(a.value.trackSid):a.case==="roomMoved"?(this.onTokenRefresh&&this.onTokenRefresh(a.value.token),this.onRoomMoved&&this.onRoomMoved(a.value)):a.case==="mediaSectionsRequirement"?this.onMediaSectionsRequirement&&this.onMediaSectionsRequirement(a.value):this.log.debug("unsupported message",Object.assign(Object.assign({},this.logContext),{msgCase:a.case})));s||this.resetPingTimeout()}setReconnected(){for(;this.queuedRequests.length>0;){const e=this.queuedRequests.shift();e&&this.requestQueue.run(e)}}handleOnClose(e){return S(this,void 0,void 0,function*(){if(this.state===_e.DISCONNECTED)return;const n=this.onClose;yield this.close(void 0,e),this.log.debug("websocket connection closed: ".concat(e),Object.assign(Object.assign({},this.logContext),{reason:e})),n&&n(e)})}handleWSError(e){this.log.error("websocket error",Object.assign(Object.assign({},this.logContext),{error:e}))}resetPingTimeout(){if(this.clearPingTimeout(),!this.pingTimeoutDuration){this.log.warn("ping timeout duration not set",this.logContext);return}this.pingTimeout=vt.setTimeout(()=>{this.log.warn("ping timeout triggered. last pong received at: ".concat(new Date(Date.now()-this.pingTimeoutDuration*1e3).toUTCString()),this.logContext),this.handleOnClose("ping timeout")},this.pingTimeoutDuration*1e3)}clearPingTimeout(){this.pingTimeout&&vt.clearTimeout(this.pingTimeout)}startPingInterval(){if(this.clearPingInterval(),this.resetPingTimeout(),!this.pingIntervalDuration){this.log.warn("ping interval duration not set",this.logContext);return}this.log.debug("start ping interval",this.logContext),this.pingInterval=vt.setInterval(()=>{this.sendPing()},this.pingIntervalDuration*1e3)}clearPingInterval(){this.log.debug("clearing ping interval",this.logContext),this.clearPingTimeout(),this.pingInterval&&vt.clearInterval(this.pingInterval)}handleSignalConnected(e,n,i){this.state=_e.CONNECTED,clearTimeout(n),this.startPingInterval(),this.startReadingLoop(e.readable.getReader(),i)}validateFirstMessage(e,n){var i,a,s,r,o;return((i=e.message)===null||i===void 0?void 0:i.case)==="join"?{isValid:!0,response:e.message.value}:this.state===_e.RECONNECTING&&((a=e.message)===null||a===void 0?void 0:a.case)!=="leave"?((s=e.message)===null||s===void 0?void 0:s.case)==="reconnect"?{isValid:!0,response:e.message.value}:(this.log.debug("declaring signal reconnected without reconnect response received",this.logContext),{isValid:!0,response:void 0,shouldProcessFirstMessage:!0}):this.isEstablishingConnection&&((r=e.message)===null||r===void 0?void 0:r.case)==="leave"?{isValid:!1,error:J.leaveRequest("Received leave request while trying to (re)connect",e.message.value.reason)}:n?{isValid:!1,error:J.internal("Unexpected first message")}:{isValid:!1,error:J.internal("did not receive join response, got ".concat((o=e.message)===null||o===void 0?void 0:o.case," instead"))}}handleConnectionError(e,n){return S(this,void 0,void 0,function*(){try{const i=yield fetch(n);switch(i.status){case 404:return J.serviceNotFound("v1 RTC path not found. Consider upgrading your LiveKit server version","v0-rtc");case 401:case 403:const a=yield i.text();return J.notAllowed(a,i.status);default:break}return e instanceof J?e:J.internal("Encountered unknown websocket error during connection: ".concat(e),{status:i.status,statusText:i.statusText})}catch(i){return i instanceof J?i:J.serverUnreachable(i instanceof Error?i.message:"server was not reachable")}})}}function t0(t){const e={type:"offer",sdp:t.sdp};switch(t.type){case"answer":case"offer":case"pranswer":case"rollback":e.type=t.type;break}return e}function Rs(t,e){return new ga({sdp:t.sdp,type:t.type,id:e})}function hN(t,e,n){var i;const a=new URLSearchParams;return a.set("access_token",t),n.reconnect&&(a.set("reconnect","1"),n.sid&&a.set("sid",n.sid)),a.set("auto_subscribe",n.autoSubscribe?"1":"0"),a.set("sdk",Kn()?"reactnative":"js"),a.set("version",e.version),a.set("protocol",e.protocol.toString()),e.deviceModel&&a.set("device_model",e.deviceModel),e.os&&a.set("os",e.os),e.osVersion&&a.set("os_version",e.osVersion),e.browser&&a.set("browser",e.browser),e.browserVersion&&a.set("browser_version",e.browserVersion),n.adaptiveStream&&a.set("adaptive_stream","1"),n.reconnectReason&&a.set("reconnect_reason",n.reconnectReason.toString()),!((i=navigator.connection)===null||i===void 0)&&i.type&&a.set("network",navigator.connection.type),a}function mN(t,e,n){const i=new URLSearchParams;i.set("access_token",t);const a=new GM({clientInfo:e,connectionSettings:new bC({autoSubscribe:!!n.autoSubscribe,adaptiveStream:!!n.adaptiveStream}),reconnect:!!n.reconnect,participantSid:n.sid?n.sid:void 0});n.reconnectReason&&(a.reconnectReason=n.reconnectReason);const s=new KM({joinRequest:a.toBinary()});return i.set("join_request",btoa(new TextDecoder("utf-8").decode(s.toBinary()))),i}class n0{constructor(){this.buffer=[],this._totalSize=0}push(e){this.buffer.push(e),this._totalSize+=e.data.byteLength}pop(){const e=this.buffer.shift();return e&&(this._totalSize-=e.data.byteLength),e}getAll(){return this.buffer.slice()}popToSequence(e){for(;this.buffer.length>0&&this.buffer[0].sequence<=e;)this.pop()}alignBufferedAmount(e){for(;this.buffer.length>0;){const n=this.buffer[0];if(this._totalSize-n.data.byteLength<=e)break;this.pop()}}get length(){return this.buffer.length}}class pN{constructor(e){this._map=new Map,this._lastCleanup=0,this.ttl=e}set(e,n){const i=Date.now();i-this._lastCleanup>this.ttl/2&&this.cleanup();const a=i+this.ttl;return this._map.set(e,{value:n,expiresAt:a}),this}get(e){const n=this._map.get(e);if(n){if(n.expiresAt<Date.now()){this._map.delete(e);return}return n.value}}has(e){const n=this._map.get(e);return n?n.expiresAt<Date.now()?(this._map.delete(e),!1):!0:!1}delete(e){return this._map.delete(e)}clear(){this._map.clear()}cleanup(){const e=Date.now();for(const[n,i]of this._map.entries())i.expiresAt<e&&this._map.delete(n);this._lastCleanup=e}get size(){return this.cleanup(),this._map.size}forEach(e){this.cleanup();for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e(i.value,n,this.asValueMap())}map(e){this.cleanup();const n=[],i=this.asValueMap();for(const[a,s]of i.entries())n.push(e(s,a,i));return n}asValueMap(){const e=new Map;for(const[n,i]of this._map.entries())i.expiresAt>=Date.now()&&e.set(n,i.value);return e}}var En={},wd={},Od={exports:{}},i0;function Xm(){if(i0)return Od.exports;i0=1;var t=Od.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var n="candidate:%s %d %s %d %s %d typ %s";return n+=e.raddr!=null?" raddr %s rport %d":"%v%v",n+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(n+=" generation %d"),n+=e["network-id"]!=null?" network-id %d":"%v",n+=e["network-cost"]!=null?" network-cost %d":"%v",n}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var n="ssrc:%d";return e.attribute!=null&&(n+=" %s",e.value!=null&&(n+=":%s")),n}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var n="mediaclk:";return n+=e.id!=null?"id=%s %s":"%v%s",n+=e.mediaClockValue!=null?"=%s":"",n+=e.rateNumerator!=null?" rate=%s":"",n+=e.rateDenominator!=null?"/%s":"",n}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(t).forEach(function(e){var n=t[e];n.forEach(function(i){i.reg||(i.reg=/(.*)/),i.format||(i.format="%s")})}),Od.exports}var a0;function gN(){return a0||(a0=1,function(t){var e=function(o){return String(Number(o))===o?Number(o):o},n=function(o,l,c,u){if(u&&!c)l[u]=e(o[1]);else for(var d=0;d<c.length;d+=1)o[d+1]!=null&&(l[c[d]]=e(o[d+1]))},i=function(o,l,c){var u=o.name&&o.names;o.push&&!l[o.push]?l[o.push]=[]:u&&!l[o.name]&&(l[o.name]={});var d=o.push?{}:u?l[o.name]:l;n(c.match(o.reg),d,o.names,o.name),o.push&&l[o.push].push(d)},a=Xm(),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(o){var l={},c=[],u=l;return o.split(/(\r\n|\r|\n)/).filter(s).forEach(function(d){var f=d[0],h=d.slice(2);f==="m"&&(c.push({rtp:[],fmtp:[]}),u=c[c.length-1]);for(var g=0;g<(a[f]||[]).length;g+=1){var y=a[f][g];if(y.reg.test(h))return i(y,u,h)}}),l.media=c,l};var r=function(o,l){var c=l.split(/=(.+)/,2);return c.length===2?o[c[0]]=e(c[1]):c.length===1&&l.length>1&&(o[c[0]]=void 0),o};t.parseParams=function(o){return o.split(/;\s?/).reduce(r,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(o){return o.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(o){for(var l=[],c=o.split(" ").map(e),u=0;u<c.length;u+=3)l.push({component:c[u],ip:c[u+1],port:c[u+2]});return l},t.parseImageAttributes=function(o){return o.split(" ").map(function(l){return l.substring(1,l.length-1).split(",").reduce(r,{})})},t.parseSimulcastStreamList=function(o){return o.split(";").map(function(l){return l.split(",").map(function(c){var u,d=!1;return c[0]!=="~"?u=e(c):(u=e(c.substring(1,c.length)),d=!0),{scid:u,paused:d}})})}}(wd)),wd}var Ad,s0;function vN(){if(s0)return Ad;s0=1;var t=Xm(),e=/%[sdv%]/g,n=function(r){var o=1,l=arguments,c=l.length;return r.replace(e,function(u){if(o>=c)return u;var d=l[o];switch(o+=1,u){case"%%":return"%";case"%s":return String(d);case"%d":return Number(d);case"%v":return""}})},i=function(r,o,l){var c=o.format instanceof Function?o.format(o.push?l:l[o.name]):o.format,u=[r+"="+c];if(o.names)for(var d=0;d<o.names.length;d+=1){var f=o.names[d];o.name?u.push(l[o.name][f]):u.push(l[o.names[d]])}else u.push(l[o.name]);return n.apply(null,u)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],s=["i","c","b","a"];return Ad=function(r,o){o=o||{},r.version==null&&(r.version=0),r.name==null&&(r.name=" "),r.media.forEach(function(d){d.payloads==null&&(d.payloads="")});var l=o.outerOrder||a,c=o.innerOrder||s,u=[];return l.forEach(function(d){t[d].forEach(function(f){f.name in r&&r[f.name]!=null?u.push(i(d,f,r)):f.push in r&&r[f.push]!=null&&r[f.push].forEach(function(h){u.push(i(d,f,h))})})}),r.media.forEach(function(d){u.push(i("m",t.m[0],d)),c.forEach(function(f){t[f].forEach(function(h){h.name in d&&d[h.name]!=null?u.push(i(f,h,d)):h.push in d&&d[h.push]!=null&&d[h.push].forEach(function(g){u.push(i(f,h,g))})})})}),u.join(`\r
`)+`\r
`},Ad}var r0;function bN(){if(r0)return En;r0=1;var t=gN(),e=vN(),n=Xm();return En.grammar=n,En.write=e,En.parse=t.parse,En.parseParams=t.parseParams,En.parseFmtpConfig=t.parseFmtpConfig,En.parsePayloads=t.parsePayloads,En.parseRemoteCandidates=t.parseRemoteCandidates,En.parseImageAttributes=t.parseImageAttributes,En.parseSimulcastStreamList=t.parseSimulcastStreamList,En}var Ui=bN();function Zm(t,e,n){var i,a,s;e===void 0&&(e=50),n===void 0&&(n={});var r=(i=n.isImmediate)!=null&&i,o=(a=n.callback)!=null&&a,l=n.maxWait,c=Date.now(),u=[];function d(){if(l!==void 0){var h=Date.now()-c;if(h+e>=l)return l-h}return e}var f=function(){var h=[].slice.call(arguments),g=this;return new Promise(function(y,T){var m=r&&s===void 0;if(s!==void 0&&clearTimeout(s),s=setTimeout(function(){if(s=void 0,c=Date.now(),!r){var v=t.apply(g,h);o&&o(v),u.forEach(function(b){return(0,b.resolve)(v)}),u=[]}},d()),m){var p=t.apply(g,h);return o&&o(p),y(p)}u.push({resolve:y,reject:T})})};return f.cancel=function(h){s!==void 0&&clearTimeout(s),u.forEach(function(g){return(0,g.reject)(h)}),u=[]},f}const yN=.7,SN=20,zs={NegotiationStarted:"negotiationStarted",NegotiationComplete:"negotiationComplete",RTPVideoPayloadTypes:"rtpVideoPayloadTypes"};class o0 extends Zn.EventEmitter{get pc(){return this._pc||(this._pc=this.createPC()),this._pc}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;super(),this.log=ie,this.ddExtID=0,this.latestOfferId=0,this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate=!1,this.trackBitrates=[],this.remoteStereoMids=[],this.remoteNackMids=[],this.negotiate=Zm(a=>S(this,void 0,void 0,function*(){this.emit(zs.NegotiationStarted);try{yield this.createAndSendOffer()}catch(s){if(a)a(s);else throw s}}),SN),this.close=()=>{this._pc&&(this._pc.close(),this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.ondatachannel=null,this._pc.onnegotiationneeded=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ondatachannel=null,this._pc.ontrack=null,this._pc.onconnectionstatechange=null,this._pc.oniceconnectionstatechange=null,this._pc=null)},this.log=xi((i=n.loggerName)!==null&&i!==void 0?i:Dn.PCTransport),this.loggerOptions=n,this.config=e,this._pc=this.createPC(),this.offerLock=new xt}createPC(){const e=new RTCPeerConnection(this.config);return e.onicecandidate=n=>{var i;n.candidate&&((i=this.onIceCandidate)===null||i===void 0||i.call(this,n.candidate))},e.onicecandidateerror=n=>{var i;(i=this.onIceCandidateError)===null||i===void 0||i.call(this,n)},e.oniceconnectionstatechange=()=>{var n;(n=this.onIceConnectionStateChange)===null||n===void 0||n.call(this,e.iceConnectionState)},e.onsignalingstatechange=()=>{var n;(n=this.onSignalingStatechange)===null||n===void 0||n.call(this,e.signalingState)},e.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,e.connectionState)},e.ondatachannel=n=>{var i;(i=this.onDataChannel)===null||i===void 0||i.call(this,n)},e.ontrack=n=>{var i;(i=this.onTrack)===null||i===void 0||i.call(this,n)},e}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isICEConnected(){return this._pc!==null&&(this.pc.iceConnectionState==="connected"||this.pc.iceConnectionState==="completed")}addIceCandidate(e){return S(this,void 0,void 0,function*(){if(this.pc.remoteDescription&&!this.restartingIce)return this.pc.addIceCandidate(e);this.pendingCandidates.push(e)})}setRemoteDescription(e,n){return S(this,void 0,void 0,function*(){var i;if(e.type==="answer"&&this.latestOfferId>0&&n>0&&n!==this.latestOfferId)return this.log.warn("ignoring answer for old offer",Object.assign(Object.assign({},this.logContext),{offerId:n,latestOfferId:this.latestOfferId})),!1;let a;if(e.type==="offer"){let{stereoMids:s,nackMids:r}=TN(e);this.remoteStereoMids=s,this.remoteNackMids=r}else if(e.type==="answer"){const s=Ui.parse((i=e.sdp)!==null&&i!==void 0?i:"");s.media.forEach(r=>{const o=Wm(r.mid);r.type==="audio"&&this.trackBitrates.some(l=>{if(!l.transceiver||o!=l.transceiver.mid)return!1;let c=0;if(r.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0)return!0;let u=!1;for(const d of r.fmtp)if(d.payload===c){d.config=d.config.split(";").filter(f=>!f.includes("maxaveragebitrate")).join(";"),l.maxbr>0&&(d.config+=";maxaveragebitrate=".concat(l.maxbr*1e3)),u=!0;break}return u||l.maxbr>0&&r.fmtp.push({payload:c,config:"maxaveragebitrate=".concat(l.maxbr*1e3)}),!0})}),a=Ui.write(s)}return yield this.setMungedSDP(e,a,!0),this.pendingCandidates.forEach(s=>{this.pc.addIceCandidate(s)}),this.pendingCandidates=[],this.restartingIce=!1,this.renegotiate?(this.renegotiate=!1,yield this.createAndSendOffer()):e.type==="answer"&&(this.emit(zs.NegotiationComplete),e.sdp&&Ui.parse(e.sdp).media.forEach(r=>{r.type==="video"&&this.emit(zs.RTPVideoPayloadTypes,r.rtp)})),!0})}createAndSendOffer(e){return S(this,void 0,void 0,function*(){var n;const i=yield this.offerLock.lock();try{if(this.onOffer===void 0)return;if(e!=null&&e.iceRestart&&(this.log.debug("restarting ICE",this.logContext),this.restartingIce=!0),this._pc&&this._pc.signalingState==="have-local-offer"){const o=this._pc.remoteDescription;if(e!=null&&e.iceRestart&&o)yield this._pc.setRemoteDescription(o);else{this.renegotiate=!0;return}}else if(!this._pc||this._pc.signalingState==="closed"){this.log.warn("could not createOffer with closed peer connection",this.logContext);return}this.log.debug("starting to negotiate",this.logContext);const a=this.latestOfferId+1;this.latestOfferId=a;const s=yield this.pc.createOffer(e);this.log.debug("original offer",Object.assign({sdp:s.sdp},this.logContext));const r=Ui.parse((n=s.sdp)!==null&&n!==void 0?n:"");if(r.media.forEach(o=>{c0(o),o.type==="audio"?l0(o,["all"],[]):o.type==="video"&&this.trackBitrates.some(l=>{if(!o.msid||!l.cid||!o.msid.includes(l.cid))return!1;let c=0;if(o.rtp.some(d=>d.codec.toUpperCase()===l.codec.toUpperCase()?(c=d.payload,!0):!1),c===0||(On(l.codec)&&!Qa()&&this.ensureVideoDDExtensionForSVC(o,r),!On(l.codec)))return!0;const u=Math.round(l.maxbr*yN);for(const d of o.fmtp)if(d.payload===c){d.config.includes("x-google-start-bitrate")||(d.config+=";x-google-start-bitrate=".concat(u));break}return!0})}),this.latestOfferId>a){this.log.warn("latestOfferId mismatch",Object.assign(Object.assign({},this.logContext),{latestOfferId:this.latestOfferId,offerId:a}));return}yield this.setMungedSDP(s,Ui.write(r)),this.onOffer(s,this.latestOfferId)}finally{i()}})}createAndSetAnswer(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pc.createAnswer(),i=Ui.parse((e=n.sdp)!==null&&e!==void 0?e:"");return i.media.forEach(a=>{c0(a),a.type==="audio"&&l0(a,this.remoteStereoMids,this.remoteNackMids)}),yield this.setMungedSDP(n,Ui.write(i)),n})}createDataChannel(e,n){return this.pc.createDataChannel(e,n)}addTransceiver(e,n){return this.pc.addTransceiver(e,n)}addTransceiverOfKind(e,n){return this.pc.addTransceiver(e,n)}addTrack(e){if(!this._pc)throw new Ve("PC closed, cannot add track");return this._pc.addTrack(e)}setTrackCodecBitrate(e){this.trackBitrates.push(e)}setConfiguration(e){var n;if(!this._pc)throw new Ve("PC closed, cannot configure");return(n=this._pc)===null||n===void 0?void 0:n.setConfiguration(e)}canRemoveTrack(){var e;return!!(!((e=this._pc)===null||e===void 0)&&e.removeTrack)}removeTrack(e){var n;return(n=this._pc)===null||n===void 0?void 0:n.removeTrack(e)}getConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.connectionState)!==null&&n!==void 0?n:"closed"}getICEConnectionState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.iceConnectionState)!==null&&n!==void 0?n:"closed"}getSignallingState(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.signalingState)!==null&&n!==void 0?n:"closed"}getTransceivers(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getTransceivers())!==null&&n!==void 0?n:[]}getSenders(){var e,n;return(n=(e=this._pc)===null||e===void 0?void 0:e.getSenders())!==null&&n!==void 0?n:[]}getLocalDescription(){var e;return(e=this._pc)===null||e===void 0?void 0:e.localDescription}getRemoteDescription(){var e;return(e=this.pc)===null||e===void 0?void 0:e.remoteDescription}getStats(){return this.pc.getStats()}getConnectedAddress(){return S(this,void 0,void 0,function*(){var e;if(!this._pc)return;let n="";const i=new Map,a=new Map;if((yield this._pc.getStats()).forEach(o=>{switch(o.type){case"transport":n=o.selectedCandidatePairId;break;case"candidate-pair":n===""&&o.selected&&(n=o.id),i.set(o.id,o);break;case"remote-candidate":a.set(o.id,"".concat(o.address,":").concat(o.port));break}}),n==="")return;const r=(e=i.get(n))===null||e===void 0?void 0:e.remoteCandidateId;if(r!==void 0)return a.get(r)})}setMungedSDP(e,n,i){return S(this,void 0,void 0,function*(){if(n){const a=e.sdp;e.sdp=n;try{this.log.debug("setting munged ".concat(i?"remote":"local"," description"),this.logContext),i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e);return}catch(s){this.log.warn("not able to set ".concat(e.type,", falling back to unmodified sdp"),Object.assign(Object.assign({},this.logContext),{error:s,sdp:n})),e.sdp=a}}try{i?yield this.pc.setRemoteDescription(e):yield this.pc.setLocalDescription(e)}catch(a){let s="unknown error";a instanceof Error?s=a.message:typeof a=="string"&&(s=a);const r={error:s,sdp:e.sdp};throw!i&&this.pc.remoteDescription&&(r.remoteSdp=this.pc.remoteDescription),this.log.error("unable to set ".concat(e.type),Object.assign(Object.assign({},this.logContext),{fields:r})),new Is(s)}})}ensureVideoDDExtensionForSVC(e,n){var i,a;if(!((i=e.ext)===null||i===void 0?void 0:i.some(r=>r.uri===Hv))){if(this.ddExtID===0){let r=0;n.media.forEach(o=>{var l;o.type==="video"&&((l=o.ext)===null||l===void 0||l.forEach(c=>{c.value>r&&(r=c.value)}))}),this.ddExtID=r+1}(a=e.ext)===null||a===void 0||a.push({value:this.ddExtID,uri:Hv})}}}function l0(t,e,n){const i=Wm(t.mid);let a=0;t.rtp.some(s=>s.codec==="opus"?(a=s.payload,!0):!1),a>0&&(t.rtcpFb||(t.rtcpFb=[]),n.includes(i)&&!t.rtcpFb.some(s=>s.payload===a&&s.type==="nack")&&t.rtcpFb.push({payload:a,type:"nack"}),(e.includes(i)||e.length===1&&e[0]==="all")&&t.fmtp.some(s=>s.payload===a?(s.config.includes("stereo=1")||(s.config+=";stereo=1"),!0):!1))}function TN(t){var e;const n=[],i=[],a=Ui.parse((e=t.sdp)!==null&&e!==void 0?e:"");let s=0;return a.media.forEach(r=>{var o;const l=Wm(r.mid);r.type==="audio"&&(r.rtp.some(c=>c.codec==="opus"?(s=c.payload,!0):!1),!((o=r.rtcpFb)===null||o===void 0)&&o.some(c=>c.payload===s&&c.type==="nack")&&i.push(l),r.fmtp.some(c=>c.payload===s?(c.config.includes("sprop-stereo=1")&&n.push(l),!0):!1))}),{stereoMids:n,nackMids:i}}function c0(t){if(t.connection){const e=t.connection.ip.indexOf(":")>=0;(t.connection.version===4&&e||t.connection.version===6&&!e)&&(t.connection.ip="0.0.0.0",t.connection.version=4)}}function Wm(t){return typeof t=="number"?t.toFixed(0):t}const sh="vp8",CN={audioPreset:Xf.music,dtx:!0,red:!0,forceStereo:!1,simulcast:!0,screenShareEncoding:Km.h1080fps15.encoding,stopMicTrackOnMute:!1,videoCodec:sh,backupCodec:!0,preConnectBuffer:!1},rk={deviceId:{ideal:"default"},autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,voiceIsolation:!0},ok={deviceId:{ideal:"default"},resolution:Ro.h720.resolution},kN={adaptiveStream:!1,dynacast:!1,stopLocalTrackOnUnpublish:!0,reconnectPolicy:new eD,disconnectOnPageLeave:!0,webAudioMix:!1,singlePeerConnection:!0},$m={autoSubscribe:!0,maxRetries:1,peerConnectionTimeout:15e3,websocketTimeout:15e3};var Be;(function(t){t[t.NEW=0]="NEW",t[t.CONNECTING=1]="CONNECTING",t[t.CONNECTED=2]="CONNECTED",t[t.FAILED=3]="FAILED",t[t.CLOSING=4]="CLOSING",t[t.CLOSED=5]="CLOSED"})(Be||(Be={}));class EN{get needsPublisher(){return this.isPublisherConnectionRequired}get needsSubscriber(){return this.isSubscriberConnectionRequired}get currentState(){return this.state}get mode(){return this._mode}constructor(e,n,i){var a;this.peerConnectionTimeout=$m.peerConnectionTimeout,this.log=ie,this.updateState=()=>{var s,r;const o=this.state,l=this.requiredTransports.map(c=>c.getConnectionState());l.every(c=>c==="connected")?this.state=Be.CONNECTED:l.some(c=>c==="failed")?this.state=Be.FAILED:l.some(c=>c==="connecting")?this.state=Be.CONNECTING:l.every(c=>c==="closed")?this.state=Be.CLOSED:l.some(c=>c==="closed")?this.state=Be.CLOSING:l.every(c=>c==="new")&&(this.state=Be.NEW),o!==this.state&&(this.log.debug("pc state change: from ".concat(Be[o]," to ").concat(Be[this.state]),this.logContext),(s=this.onStateChange)===null||s===void 0||s.call(this,this.state,this.publisher.getConnectionState(),(r=this.subscriber)===null||r===void 0?void 0:r.getConnectionState()))},this.log=xi((a=i.loggerName)!==null&&a!==void 0?a:Dn.PCManager),this.loggerOptions=i,this.isPublisherConnectionRequired=n!=="subscriber-primary",this.isSubscriberConnectionRequired=n==="subscriber-primary",this.publisher=new o0(e,i),this._mode=n,n!=="publisher-only"&&(this.subscriber=new o0(e,i),this.subscriber.onConnectionStateChange=this.updateState,this.subscriber.onIceConnectionStateChange=this.updateState,this.subscriber.onSignalingStatechange=this.updateState,this.subscriber.onIceCandidate=s=>{var r;(r=this.onIceCandidate)===null||r===void 0||r.call(this,s,wn.SUBSCRIBER)},this.subscriber.onDataChannel=s=>{var r;(r=this.onDataChannel)===null||r===void 0||r.call(this,s)},this.subscriber.onTrack=s=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,s)}),this.publisher.onConnectionStateChange=this.updateState,this.publisher.onIceConnectionStateChange=this.updateState,this.publisher.onSignalingStatechange=this.updateState,this.publisher.onIceCandidate=s=>{var r;(r=this.onIceCandidate)===null||r===void 0||r.call(this,s,wn.PUBLISHER)},this.publisher.onTrack=s=>{var r;(r=this.onTrack)===null||r===void 0||r.call(this,s)},this.publisher.onOffer=(s,r)=>{var o;(o=this.onPublisherOffer)===null||o===void 0||o.call(this,s,r)},this.state=Be.NEW,this.connectionLock=new xt,this.remoteOfferLock=new xt}get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions).loggerContextCb)===null||n===void 0?void 0:n.call(e))}requirePublisher(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.isPublisherConnectionRequired=e,this.updateState()}createAndSendPublisherOffer(e){return this.publisher.createAndSendOffer(e)}setPublisherAnswer(e,n){return this.publisher.setRemoteDescription(e,n)}removeTrack(e){return this.publisher.removeTrack(e)}close(){return S(this,void 0,void 0,function*(){var e;if(this.publisher&&this.publisher.getSignallingState()!=="closed"){const n=this.publisher;for(const i of n.getSenders())try{n.canRemoveTrack()&&n.removeTrack(i)}catch(a){this.log.warn("could not removeTrack",Object.assign(Object.assign({},this.logContext),{error:a}))}}yield Promise.all([this.publisher.close(),(e=this.subscriber)===null||e===void 0?void 0:e.close()]),this.updateState()})}triggerIceRestart(){return S(this,void 0,void 0,function*(){this.subscriber&&(this.subscriber.restartingIce=!0),this.needsPublisher&&(yield this.createAndSendPublisherOffer({iceRestart:!0}))})}addIceCandidate(e,n){return S(this,void 0,void 0,function*(){var i;n===wn.PUBLISHER?yield this.publisher.addIceCandidate(e):yield(i=this.subscriber)===null||i===void 0?void 0:i.addIceCandidate(e)})}createSubscriberAnswerFromOffer(e,n){return S(this,void 0,void 0,function*(){var i,a,s;this.log.debug("received server offer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,signalingState:(i=this.subscriber)===null||i===void 0?void 0:i.getSignallingState().toString()}));const r=yield this.remoteOfferLock.lock();try{return(yield(a=this.subscriber)===null||a===void 0?void 0:a.setRemoteDescription(e,n))?yield(s=this.subscriber)===null||s===void 0?void 0:s.createAndSetAnswer():void 0}finally{r()}})}updateConfiguration(e,n){var i;this.publisher.setConfiguration(e),(i=this.subscriber)===null||i===void 0||i.setConfiguration(e),n&&this.triggerIceRestart()}ensurePCTransportConnection(e,n){return S(this,void 0,void 0,function*(){var i;const a=yield this.connectionLock.lock();try{this.isPublisherConnectionRequired&&this.publisher.getConnectionState()!=="connected"&&this.publisher.getConnectionState()!=="connecting"&&(this.log.debug("negotiation required, start negotiating",this.logContext),this.publisher.negotiate()),yield Promise.all((i=this.requiredTransports)===null||i===void 0?void 0:i.map(s=>this.ensureTransportConnected(s,e,n)))}finally{a()}})}negotiate(e){return S(this,void 0,void 0,function*(){return new Tt((n,i)=>S(this,void 0,void 0,function*(){const a=setTimeout(()=>{i(new Is("negotiation timed out"))},this.peerConnectionTimeout),s=()=>{clearTimeout(a),i(new Is("negotiation aborted"))};e.signal.addEventListener("abort",s),this.publisher.once(zs.NegotiationStarted,()=>{e.signal.aborted||this.publisher.once(zs.NegotiationComplete,()=>{clearTimeout(a),n()})}),yield this.publisher.negotiate(r=>{clearTimeout(a),r instanceof Error?i(r):i(new Error(String(r)))})}))})}addPublisherTransceiver(e,n){return this.publisher.addTransceiver(e,n)}addPublisherTransceiverOfKind(e,n){return this.publisher.addTransceiverOfKind(e,n)}getMidForReceiver(e){const i=(this.subscriber?this.subscriber.getTransceivers():this.publisher.getTransceivers()).find(a=>a.receiver===e);return i==null?void 0:i.mid}addPublisherTrack(e){return this.publisher.addTrack(e)}createPublisherDataChannel(e,n){return this.publisher.createDataChannel(e,n)}getConnectedAddress(e){return e===wn.PUBLISHER?this.publisher.getConnectedAddress():e===wn.SUBSCRIBER?this.publisher.getConnectedAddress():this.requiredTransports[0].getConnectedAddress()}get requiredTransports(){const e=[];return this.isPublisherConnectionRequired&&e.push(this.publisher),this.isSubscriberConnectionRequired&&this.subscriber&&e.push(this.subscriber),e}ensureTransportConnected(e,n){return S(this,arguments,void 0,function(i,a){var s=this;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.peerConnectionTimeout;return function*(){if(i.getConnectionState()!=="connected")return new Promise((l,c)=>S(s,void 0,void 0,function*(){const u=()=>{this.log.warn("abort transport connection",this.logContext),vt.clearTimeout(d),c(J.cancelled("room connection has been cancelled"))};a!=null&&a.signal.aborted&&u(),a==null||a.signal.addEventListener("abort",u);const d=vt.setTimeout(()=>{a==null||a.signal.removeEventListener("abort",u),c(J.internal("could not establish pc connection"))},r);for(;this.state!==Be.CONNECTED;)if(yield bt(50),a!=null&&a.signal.aborted){c(J.cancelled("room connection has been cancelled"));return}vt.clearTimeout(d),a==null||a.signal.removeEventListener("abort",u),l()}))}()})}}const lk=5e3,_N=3e4;class fe{static fetchRegionSettings(e,n,i){return S(this,void 0,void 0,function*(){const a=yield fe.fetchLock.lock();try{const s=yield fetch("".concat(RN(e),"/regions"),{headers:{authorization:"Bearer ".concat(n)},signal:i});if(s.ok){const r=QD(s.headers),o=r?r*1e3:lk;return{regionSettings:yield s.json(),updatedAtInMs:Date.now(),maxAgeInMs:o}}else throw s.status===401?J.notAllowed("Could not fetch region settings: ".concat(s.statusText),s.status):J.internal("Could not fetch region settings: ".concat(s.statusText))}catch(s){throw s instanceof J?s:i!=null&&i.aborted?J.cancelled("Region fetching was aborted"):J.serverUnreachable("Could not fetch region settings, ".concat(s instanceof Error?"".concat(s.name,": ").concat(s.message):s))}finally{a()}})}static scheduleRefetch(e,n,i){return S(this,void 0,void 0,function*(){const a=fe.settingsTimeouts.get(e.hostname);clearTimeout(a),fe.settingsTimeouts.set(e.hostname,setTimeout(()=>S(this,void 0,void 0,function*(){try{const s=yield fe.fetchRegionSettings(e,n);fe.updateCachedRegionSettings(e,n,s)}catch(s){if(s instanceof J&&s.reason===Re.NotAllowed){ie.debug("token is not valid, cancelling auto region refresh");return}ie.debug("auto refetching of region settings failed",{error:s}),fe.scheduleRefetch(e,n,i)}}),i))})}static updateCachedRegionSettings(e,n,i){fe.cache.set(e.hostname,i),fe.scheduleRefetch(e,n,i.maxAgeInMs)}static stopRefetch(e){const n=fe.settingsTimeouts.get(e);n&&(clearTimeout(n),fe.settingsTimeouts.delete(e))}static scheduleCleanup(e){let n=fe.connectionTrackers.get(e);n&&(n.cleanupTimeout&&clearTimeout(n.cleanupTimeout),n.cleanupTimeout=setTimeout(()=>{const i=fe.connectionTrackers.get(e);i&&i.connectionCount===0&&(ie.debug("stopping region refetch after disconnect delay",{hostname:e}),fe.stopRefetch(e)),i&&(i.cleanupTimeout=void 0)},_N))}static cancelCleanup(e){const n=fe.connectionTrackers.get(e);n!=null&&n.cleanupTimeout&&(clearTimeout(n.cleanupTimeout),n.cleanupTimeout=void 0)}notifyConnected(){const e=this.serverUrl.hostname;let n=fe.connectionTrackers.get(e);n||(n={connectionCount:0},fe.connectionTrackers.set(e,n)),n.connectionCount++,fe.cancelCleanup(e)}notifyDisconnected(){const e=this.serverUrl.hostname,n=fe.connectionTrackers.get(e);n&&(n.connectionCount=Math.max(0,n.connectionCount-1),n.connectionCount===0&&fe.scheduleCleanup(e))}constructor(e,n){this.attemptedRegions=[],this.serverUrl=new URL(e),this.token=n}updateToken(e){this.token=e}isCloud(){return tr(this.serverUrl)}getServerUrl(){return this.serverUrl}fetchRegionSettings(e){return S(this,void 0,void 0,function*(){return fe.fetchRegionSettings(this.serverUrl,this.token,e)})}getNextBestRegionUrl(e){return S(this,void 0,void 0,function*(){if(!this.isCloud())throw Error("region availability is only supported for LiveKit Cloud domains");let n=fe.cache.get(this.serverUrl.hostname);(!n||Date.now()-n.updatedAtInMs>n.maxAgeInMs)&&(n=yield this.fetchRegionSettings(e),fe.updateCachedRegionSettings(this.serverUrl,this.token,n));const i=n.regionSettings.regions.filter(a=>!this.attemptedRegions.find(s=>s.url===a.url));if(i.length>0){const a=i[0];return this.attemptedRegions.push(a),ie.debug("next region: ".concat(a.region)),a.url}else return null})}resetAttempts(){this.attemptedRegions=[]}setServerReportedRegions(e){fe.updateCachedRegionSettings(this.serverUrl,this.token,e)}}fe.cache=new Map;fe.settingsTimeouts=new Map;fe.connectionTrackers=new Map;fe.fetchLock=new xt;function RN(t){return"".concat(t.protocol.replace("ws","http"),"//").concat(t.host,"/settings")}class Fe extends Error{constructor(e,n,i){super(n),this.code=e,this.message=u0(n,Fe.MAX_MESSAGE_BYTES),this.data=i?u0(i,Fe.MAX_DATA_BYTES):void 0}static fromProto(e){return new Fe(e.code,e.message,e.data)}toProto(){return new XT({code:this.code,message:this.message,data:this.data})}static builtIn(e,n){return new Fe(Fe.ErrorCode[e],Fe.ErrorMessage[e],n)}}Fe.MAX_MESSAGE_BYTES=256;Fe.MAX_DATA_BYTES=15360;Fe.ErrorCode={APPLICATION_ERROR:1500,CONNECTION_TIMEOUT:1501,RESPONSE_TIMEOUT:1502,RECIPIENT_DISCONNECTED:1503,RESPONSE_PAYLOAD_TOO_LARGE:1504,SEND_FAILED:1505,UNSUPPORTED_METHOD:1400,RECIPIENT_NOT_FOUND:1401,REQUEST_PAYLOAD_TOO_LARGE:1402,UNSUPPORTED_SERVER:1403,UNSUPPORTED_VERSION:1404};Fe.ErrorMessage={APPLICATION_ERROR:"Application error in method handler",CONNECTION_TIMEOUT:"Connection timeout",RESPONSE_TIMEOUT:"Response timeout",RECIPIENT_DISCONNECTED:"Recipient disconnected",RESPONSE_PAYLOAD_TOO_LARGE:"Response payload too large",SEND_FAILED:"Failed to send",UNSUPPORTED_METHOD:"Method not supported at destination",RECIPIENT_NOT_FOUND:"Recipient not found",REQUEST_PAYLOAD_TOO_LARGE:"Request payload too large",UNSUPPORTED_SERVER:"RPC not supported by server",UNSUPPORTED_VERSION:"Unsupported RPC version"};const ck=15360;function ep(t){return new TextEncoder().encode(t).length}function u0(t,e){if(ep(t)<=e)return t;let n=0,i=t.length;const a=new TextEncoder;for(;n<i;){const s=Math.floor((n+i+1)/2);a.encode(t.slice(0,s)).length<=e?n=s:i=s-1}return t.slice(0,n)}const tp=2e3;function vu(t,e){if(!e)return 0;let n,i;return"bytesReceived"in t?(n=t.bytesReceived,i=e.bytesReceived):"bytesSent"in t&&(n=t.bytesSent,i=e.bytesSent),n===void 0||i===void 0||t.timestamp===void 0||e.timestamp===void 0?0:(n-i)*8*1e3/(t.timestamp-e.timestamp)}const np=typeof MediaRecorder<"u";class xN{constructor(){throw new Error("MediaRecorder is not available in this environment")}}const wN=np?MediaRecorder:xN;class ON extends wN{constructor(e,n){if(!np)throw new Error("MediaRecorder is not available in this environment");super(new MediaStream([e.mediaStreamTrack]),n);let i,a;const s=()=>a===void 0,r=()=>{this.removeEventListener("dataavailable",i),this.removeEventListener("stop",r),this.removeEventListener("error",o),a==null||a.close(),a=void 0},o=l=>{a==null||a.error(l),this.removeEventListener("dataavailable",i),this.removeEventListener("stop",r),this.removeEventListener("error",o),a=void 0};this.byteStream=new ReadableStream({start:l=>{a=l,i=c=>S(this,void 0,void 0,function*(){let u;if(c.data.arrayBuffer){const d=yield c.data.arrayBuffer();u=new Uint8Array(d)}else if(c.data.byteArray)u=c.data.byteArray;else throw new Error("no data available!");s()||l.enqueue(u)}),this.addEventListener("dataavailable",i)},cancel:()=>{r()}}),this.addEventListener("stop",r),this.addEventListener("error",o)}}function AN(){return np}const MN=1e3,DN=1e4;class uk extends U{get sender(){return this._sender}set sender(e){this._sender=e}get constraints(){return this._constraints}get hasPreConnectBuffer(){return!!this.localTrackRecorder}constructor(e,n,i){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,s=arguments.length>4?arguments[4]:void 0;super(e,n,s),this.manuallyStopped=!1,this._isUpstreamPaused=!1,this.handleTrackMuteEvent=()=>this.debouncedTrackMuteHandler().catch(()=>this.log.debug("track mute bounce got cancelled by an unmute event",this.logContext)),this.debouncedTrackMuteHandler=Zm(()=>S(this,void 0,void 0,function*(){yield this.pauseUpstream()}),5e3),this.handleTrackUnmuteEvent=()=>S(this,void 0,void 0,function*(){this.debouncedTrackMuteHandler.cancel("unmute"),yield this.resumeUpstream()}),this.handleEnded=()=>{this.isInBackground&&(this.reacquireTrack=!0),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),this.emit(B.Ended,this)},this.reacquireTrack=!1,this.providedByUser=a,this.muteLock=new xt,this.pauseUpstreamLock=new xt,this.trackChangeLock=new xt,this.trackChangeLock.lock().then(r=>S(this,void 0,void 0,function*(){try{yield this.setMediaStreamTrack(e,!0)}finally{r()}})),this._constraints=e.getConstraints(),i&&(this._constraints=i)}get id(){return this._mediaStreamTrack.id}get dimensions(){if(this.kind!==U.Kind.Video)return;const{width:e,height:n}=this._mediaStreamTrack.getSettings();if(e&&n)return{width:e,height:n}}get isUpstreamPaused(){return this._isUpstreamPaused}get isUserProvided(){return this.providedByUser}get mediaStreamTrack(){var e,n;return(n=(e=this.processor)===null||e===void 0?void 0:e.processedTrack)!==null&&n!==void 0?n:this._mediaStreamTrack}get isLocal(){return!0}getSourceTrackSettings(){return this._mediaStreamTrack.getSettings()}setMediaStreamTrack(e,n){return S(this,void 0,void 0,function*(){var i;if(e===this._mediaStreamTrack&&!n)return;this._mediaStreamTrack&&(this.attachedElements.forEach(s=>{js(this._mediaStreamTrack,s)}),this.debouncedTrackMuteHandler.cancel("new-track"),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent)),this.mediaStream=new MediaStream([e]),e&&(e.addEventListener("ended",this.handleEnded),e.addEventListener("mute",this.handleTrackMuteEvent),e.addEventListener("unmute",this.handleTrackUnmuteEvent),this._constraints=e.getConstraints());let a;if(this.processor&&e){if(this.log.debug("restarting processor",this.logContext),this.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");this.processorElement&&(_s(e,this.processorElement),this.processorElement.muted=!0),yield this.processor.restart({track:e,kind:this.kind,element:this.processorElement}),a=this.processor.processedTrack}this.sender&&((i=this.sender.transport)===null||i===void 0?void 0:i.state)!=="closed"&&(yield this.sender.replaceTrack(a??e)),!this.providedByUser&&this._mediaStreamTrack!==e&&this._mediaStreamTrack.stop(),this._mediaStreamTrack=e,e&&(this._mediaStreamTrack.enabled=!this.isMuted,yield this.resumeUpstream(),this.attachedElements.forEach(s=>{_s(a??e,s)}))})}waitForDimensions(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:MN;return function*(){var i;if(e.kind===U.Kind.Audio)throw new Error("cannot get dimensions for audio tracks");((i=jt())===null||i===void 0?void 0:i.os)==="iOS"&&(yield bt(10));const a=Date.now();for(;Date.now()-a<n;){const s=e.dimensions;if(s)return s;yield bt(50)}throw new di("unable to get track dimensions after timeout")}()})}setDeviceId(e){return S(this,void 0,void 0,function*(){return this._constraints.deviceId===e&&this._mediaStreamTrack.getSettings().deviceId===la(e)||(this._constraints.deviceId=e,this.isMuted)?!0:(yield this.restartTrack(),la(e)===this._mediaStreamTrack.getSettings().deviceId)})}getDeviceId(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){if(e.source===U.Source.ScreenShare)return;const{deviceId:i,groupId:a}=e._mediaStreamTrack.getSettings(),s=e.kind===U.Kind.Audio?"audioinput":"videoinput";return n?ut.getInstance().normalizeDeviceId(s,i,a):i}()})}mute(){return S(this,void 0,void 0,function*(){return this.setTrackMuted(!0),this})}unmute(){return S(this,void 0,void 0,function*(){return this.setTrackMuted(!1),this})}replaceTrack(e,n){return S(this,void 0,void 0,function*(){const i=yield this.trackChangeLock.lock();try{if(!this.sender)throw new di("unable to replace an unpublished track");let a,s;return typeof n=="boolean"?a=n:n!==void 0&&(a=n.userProvidedTrack,s=n.stopProcessor),this.providedByUser=a??!0,this.log.debug("replace MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(e),s&&this.processor&&(yield this.internalStopProcessor()),this}finally{i()}})}restart(e){return S(this,void 0,void 0,function*(){this.manuallyStopped=!1;const n=yield this.trackChangeLock.lock();try{e||(e=this._constraints);const{deviceId:i,facingMode:a}=e,s=tD(e,["deviceId","facingMode"]);this.log.debug("restarting track with constraints",Object.assign(Object.assign({},this.logContext),{constraints:e}));const r={audio:!1,video:!1};this.kind===U.Kind.Video?r.video=i||a?{deviceId:i,facingMode:a}:!0:r.audio=i?Object.assign({deviceId:i},s):!0,this.attachedElements.forEach(c=>{js(this.mediaStreamTrack,c)}),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.stop();const l=(yield navigator.mediaDevices.getUserMedia(r)).getTracks()[0];return this.kind===U.Kind.Video&&(yield l.applyConstraints(s)),l.addEventListener("ended",this.handleEnded),this.log.debug("re-acquired MediaStreamTrack",this.logContext),yield this.setMediaStreamTrack(l),this._constraints=e,this.emit(B.Restarted,this),this.manuallyStopped&&(this.log.warn("track was stopped during a restart, stopping restarted track",this.logContext),this.stop()),this}finally{n()}})}setTrackMuted(e){this.log.debug("setting ".concat(this.kind," track ").concat(e?"muted":"unmuted"),this.logContext),!(this.isMuted===e&&this._mediaStreamTrack.enabled!==e)&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?B.Muted:B.Unmuted,this))}get needsReAcquisition(){return this._mediaStreamTrack.readyState!=="live"||this._mediaStreamTrack.muted||!this._mediaStreamTrack.enabled||this.reacquireTrack}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),nk()&&(this.log.debug("visibility changed, is in Background: ".concat(this.isInBackground),this.logContext),!this.isInBackground&&this.needsReAcquisition&&!this.isUserProvided&&!this.isMuted&&(this.log.debug("track needs to be reacquired, restarting ".concat(this.source),this.logContext),yield this.restart(),this.reacquireTrack=!1))})}stop(){var e;this.manuallyStopped=!0,super.stop(),this._mediaStreamTrack.removeEventListener("ended",this.handleEnded),this._mediaStreamTrack.removeEventListener("mute",this.handleTrackMuteEvent),this._mediaStreamTrack.removeEventListener("unmute",this.handleTrackUnmuteEvent),(e=this.processor)===null||e===void 0||e.destroy(),this.processor=void 0}pauseUpstream(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!0)return;if(!this.sender){this.log.warn("unable to pause upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!0,this.emit(B.UpstreamPaused,this);const i=jt();if((i==null?void 0:i.name)==="Safari"&&Yn(i.version,"12.0")<0)throw new Gm("pauseUpstream is not supported on Safari < 12.");((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(null))}finally{n()}})}resumeUpstream(){return S(this,void 0,void 0,function*(){var e;const n=yield this.pauseUpstreamLock.lock();try{if(this._isUpstreamPaused===!1)return;if(!this.sender){this.log.warn("unable to resume upstream for an unpublished track",this.logContext);return}this._isUpstreamPaused=!1,this.emit(B.UpstreamResumed,this),((e=this.sender.transport)===null||e===void 0?void 0:e.state)!=="closed"&&(yield this.sender.replaceTrack(this.mediaStreamTrack))}finally{n()}})}getRTCStatsReport(){return S(this,void 0,void 0,function*(){var e;return!((e=this.sender)===null||e===void 0)&&e.getStats?yield this.sender.getStats():void 0})}setProcessor(e){return S(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var s;const r=yield i.trackChangeLock.lock();try{i.log.debug("setting up processor",i.logContext);const o=document.createElement(i.kind),l={kind:i.kind,track:i._mediaStreamTrack,element:o,audioContext:i.audioContext};if(yield n.init(l),i.log.debug("processor initialized",i.logContext),i.processor&&(yield i.internalStopProcessor()),i.kind==="unknown")throw TypeError("cannot set processor on track of unknown kind");if(_s(i._mediaStreamTrack,o),o.muted=!0,o.play().catch(c=>{c instanceof DOMException&&c.name==="AbortError"?(i.log.warn("failed to play processor element, retrying",Object.assign(Object.assign({},i.logContext),{error:c})),setTimeout(()=>{o.play().catch(u=>{i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{err:u}))})},100)):i.log.error("failed to play processor element",Object.assign(Object.assign({},i.logContext),{error:c}))}),i.processor=n,i.processorElement=o,i.processor.processedTrack){for(const c of i.attachedElements)c!==i.processorElement&&a&&(js(i._mediaStreamTrack,c),_s(i.processor.processedTrack,c));yield(s=i.sender)===null||s===void 0?void 0:s.replaceTrack(i.processor.processedTrack)}i.emit(B.TrackProcessorUpdate,i.processor)}finally{r()}}()})}getProcessor(){return this.processor}stopProcessor(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){const i=yield e.trackChangeLock.lock();try{yield e.internalStopProcessor(n)}finally{i()}}()})}internalStopProcessor(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var i,a;e.processor&&(e.log.debug("stopping processor",e.logContext),(i=e.processor.processedTrack)===null||i===void 0||i.stop(),yield e.processor.destroy(),e.processor=void 0,n||((a=e.processorElement)===null||a===void 0||a.remove(),e.processorElement=void 0),yield e._mediaStreamTrack.applyConstraints(e._constraints),yield e.setMediaStreamTrack(e._mediaStreamTrack,!0),e.emit(B.TrackProcessorUpdate))}()})}startPreConnectBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;if(!AN()){this.log.warn("MediaRecorder is not available, cannot start preconnect buffer",this.logContext);return}if(this.localTrackRecorder){this.log.warn("preconnect buffer already started");return}else{let n="audio/webm;codecs=opus";MediaRecorder.isTypeSupported(n)||(n="video/mp4"),this.localTrackRecorder=new ON(this,{mimeType:n})}this.localTrackRecorder.start(e),this.autoStopPreConnectBuffer=setTimeout(()=>{this.log.warn("preconnect buffer timed out, stopping recording automatically",this.logContext),this.stopPreConnectBuffer()},DN)}stopPreConnectBuffer(){clearTimeout(this.autoStopPreConnectBuffer),this.localTrackRecorder&&(this.localTrackRecorder.stop(),this.localTrackRecorder=void 0)}getPreConnectBuffer(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.byteStream}getPreConnectBufferMimeType(){var e;return(e=this.localTrackRecorder)===null||e===void 0?void 0:e.mimeType}}class Uc extends uk{get enhancedNoiseCancellation(){return this.isKrispNoiseFilterEnabled}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;super(e,U.Kind.Audio,n,i,s),this.stopOnMute=!1,this.isKrispNoiseFilterEnabled=!1,this.monitorSender=()=>S(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let r;try{r=yield this.getSenderStats()}catch(o){this.log.error("could not get audio sender stats",Object.assign(Object.assign({},this.logContext),{error:o}));return}r&&this.prevStats&&(this._currentBitrate=vu(r,this.prevStats)),this.prevStats=r}),this.handleKrispNoiseFilterEnable=()=>{this.isKrispNoiseFilterEnabled=!0,this.log.debug("Krisp noise filter enabled",this.logContext),this.emit(B.AudioTrackFeatureUpdate,this,lt.TF_ENHANCED_NOISE_CANCELLATION,!0)},this.handleKrispNoiseFilterDisable=()=>{this.isKrispNoiseFilterEnabled=!1,this.log.debug("Krisp noise filter disabled",this.logContext),this.emit(B.AudioTrackFeatureUpdate,this,lt.TF_ENHANCED_NOISE_CANCELLATION,!1)},this.audioContext=a,this.checkForSilence()}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===U.Source.Microphone&&this.stopOnMute&&!this.isUserProvided&&(this.log.debug("stopping mic track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{if(!this.isMuted)return this.log.debug("Track already unmuted",this.logContext),this;const i=this._constraints.deviceId&&this._mediaStreamTrack.getSettings().deviceId!==la(this._constraints.deviceId);return this.source===U.Source.Microphone&&(this.stopOnMute||this._mediaStreamTrack.readyState==="ended"||i)&&!this.isUserProvided&&(this.log.debug("reacquiring mic track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this}finally{n()}})}restartTrack(e){return S(this,void 0,void 0,function*(){let n;if(e){const i=Ym({audio:e});typeof i.audio!="boolean"&&(n=i.audio)}yield this.restart(n)})}restart(e){const n=Object.create(null,{restart:{get:()=>super.restart}});return S(this,void 0,void 0,function*(){const i=yield n.restart.call(this,e);return this.checkForSilence(),i})}startMonitor(){Ut()&&(this.monitorInterval||(this.monitorInterval=setInterval(()=>{this.monitorSender()},tp)))}setProcessor(e){return S(this,void 0,void 0,function*(){var n;const i=yield this.trackChangeLock.lock();try{if(!Kn()&&!this.audioContext)throw Error("Audio context needs to be set on LocalAudioTrack in order to enable processors");this.processor&&(yield this.internalStopProcessor());const a={kind:this.kind,track:this._mediaStreamTrack,audioContext:this.audioContext};this.log.debug("setting up audio processor ".concat(e.name),this.logContext),yield e.init(a),this.processor=e,this.processor.processedTrack&&(yield(n=this.sender)===null||n===void 0?void 0:n.replaceTrack(this.processor.processedTrack),this.processor.processedTrack.addEventListener("enable-lk-krisp-noise-filter",this.handleKrispNoiseFilterEnable),this.processor.processedTrack.addEventListener("disable-lk-krisp-noise-filter",this.handleKrispNoiseFilterDisable)),this.emit(B.TrackProcessorUpdate,this.processor)}finally{i()}})}setAudioContext(e){this.audioContext=e}getSenderStats(){return S(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return;const n=yield this.sender.getStats();let i;return n.forEach(a=>{a.type==="outbound-rtp"&&(i={type:"audio",streamId:a.id,packetsSent:a.packetsSent,packetsLost:a.packetsLost,bytesSent:a.bytesSent,timestamp:a.timestamp,roundTripTime:a.roundTripTime,jitter:a.jitter})}),i})}checkForSilence(){return S(this,void 0,void 0,function*(){const e=yield $C(this);return e&&(this.isMuted||this.log.debug("silence detected on local audio track",this.logContext),this.emit(B.AudioSilenceDetected)),e})}}function NN(t,e,n){switch(t.kind){case"audio":return new Uc(t,e,!1,void 0,n);case"video":return new Ic(t,e,!1,n);default:throw new di("unsupported track type: ".concat(t.kind))}}const PN=Object.values(Ro),LN=Object.values(Zf),UN=Object.values(Km),IN=[Ro.h180,Ro.h360],jN=[Zf.h180,Zf.h360],BN=t=>[{scaleResolutionDownBy:2,fps:t.encoding.maxFramerate}].map(n=>{var i,a;return new Ce(Math.floor(t.width/n.scaleResolutionDownBy),Math.floor(t.height/n.scaleResolutionDownBy),Math.max(15e4,Math.floor(t.encoding.maxBitrate/(Math.pow(n.scaleResolutionDownBy,2)*(((i=t.encoding.maxFramerate)!==null&&i!==void 0?i:30)/((a=n.fps)!==null&&a!==void 0?a:30))))),n.fps,t.encoding.priority)}),rh=["q","h","f"];function oh(t,e,n,i){var a,s;let r=i==null?void 0:i.videoEncoding;t&&(r=i==null?void 0:i.screenShareEncoding);const o=i==null?void 0:i.simulcast,l=i==null?void 0:i.scalabilityMode,c=i==null?void 0:i.videoCodec;if(!r&&!o&&!l||!e||!n)return[{}];r||(r=zN(t,e,n,c),ie.debug("using video encoding",r));const u=r.maxFramerate,d=new Ce(e,n,r.maxBitrate,r.maxFramerate,r.priority);if(l&&On(c)){const g=new dk(l),y=[];if(g.spatial>3)throw new Error("unsupported scalabilityMode: ".concat(l));const T=jt();if(xo()||Kn()||(T==null?void 0:T.name)==="Chrome"&&Yn(T==null?void 0:T.version,"113")<0){const m=g.suffix=="h"?2:3,p=UD(T);for(let v=0;v<g.spatial;v+=1)y.push({rid:rh[2-v],maxBitrate:r.maxBitrate/Math.pow(m,v),maxFramerate:d.encoding.maxFramerate,scaleResolutionDownBy:p?Math.pow(2,v):void 0});y[0].scalabilityMode=l}else y.push({maxBitrate:r.maxBitrate,maxFramerate:d.encoding.maxFramerate,scalabilityMode:l});return d.encoding.priority&&(y[0].priority=d.encoding.priority,y[0].networkPriority=d.encoding.priority),ie.debug("using svc encoding",{encodings:y}),y}if(!o)return[r];let f=[];t?f=(a=f0(i==null?void 0:i.screenShareSimulcastLayers))!==null&&a!==void 0?a:d0(t,d):f=(s=f0(i==null?void 0:i.videoSimulcastLayers))!==null&&s!==void 0?s:d0(t,d);let h;if(f.length>0){const g=f[0];f.length>1&&([,h]=f);const y=Math.max(e,n);if(y>=960&&h)return Md(e,n,[g,h,d],u);if(y>=480)return Md(e,n,[g,d],u)}return Md(e,n,[d])}function qN(t,e,n){var i,a,s,r;if(!n.backupCodec||n.backupCodec===!0||n.backupCodec.codec===n.videoCodec)return;e!==n.backupCodec.codec&&ie.warn("requested a different codec than specified as backup",{serverRequested:e,backup:n.backupCodec.codec}),n.videoCodec=e,n.videoEncoding=n.backupCodec.encoding;const o=t.mediaStreamTrack.getSettings(),l=(i=o.width)!==null&&i!==void 0?i:(a=t.dimensions)===null||a===void 0?void 0:a.width,c=(s=o.height)!==null&&s!==void 0?s:(r=t.dimensions)===null||r===void 0?void 0:r.height;return t.source===U.Source.ScreenShare&&n.simulcast&&(n.simulcast=!1),oh(t.source===U.Source.ScreenShare,l,c,n)}function zN(t,e,n,i){const a=FN(t,e,n);let{encoding:s}=a[0];const r=Math.max(e,n);for(let o=0;o<a.length;o+=1){const l=a[o];if(s=l.encoding,l.width>=r)break}if(i)switch(i){case"av1":case"h265":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.7;break;case"vp9":s=Object.assign({},s),s.maxBitrate=s.maxBitrate*.85;break}return s}function FN(t,e,n){if(t)return UN;const i=e>n?e/n:n/e;return Math.abs(i-16/9)<Math.abs(i-4/3)?PN:LN}function d0(t,e){if(t)return BN(e);const{width:n,height:i}=e,a=n>i?n/i:i/n;return Math.abs(a-16/9)<Math.abs(a-4/3)?IN:jN}function Md(t,e,n,i){const a=[];if(n.forEach((s,r)=>{if(r>=rh.length)return;const o=Math.min(t,e),c={rid:rh[r],scaleResolutionDownBy:Math.max(1,o/Math.min(s.width,s.height)),maxBitrate:s.encoding.maxBitrate},u=i&&s.encoding.maxFramerate?Math.min(i,s.encoding.maxFramerate):s.encoding.maxFramerate;u&&(c.maxFramerate=u);const d=Ya()||r===0;s.encoding.priority&&d&&(c.priority=s.encoding.priority,c.networkPriority=s.encoding.priority),a.push(c)}),Kn()&&ak()==="ios"){let s;a.forEach(o=>{s?o.maxFramerate&&o.maxFramerate>s&&(s=o.maxFramerate):s=o.maxFramerate});let r=!0;a.forEach(o=>{var l;o.maxFramerate!=s&&(r&&(r=!1,ie.info("Simulcast on iOS React-Native requires all encodings to share the same framerate.")),ie.info('Setting framerate of encoding "'.concat((l=o.rid)!==null&&l!==void 0?l:"",'" to ').concat(s)),o.maxFramerate=s)})}return a}function f0(t){if(t)return t.sort((e,n)=>{const{encoding:i}=e,{encoding:a}=n;return i.maxBitrate>a.maxBitrate?1:i.maxBitrate<a.maxBitrate?-1:i.maxBitrate===a.maxBitrate&&i.maxFramerate&&a.maxFramerate?i.maxFramerate>a.maxFramerate?1:-1:0})}class dk{constructor(e){const n=e.match(/^L(\d)T(\d)(h|_KEY|_KEY_SHIFT){0,1}$/);if(!n)throw new Error("invalid scalability mode");if(this.spatial=parseInt(n[1]),this.temporal=parseInt(n[2]),n.length>3)switch(n[3]){case"h":case"_KEY":case"_KEY_SHIFT":this.suffix=n[3]}}toString(){var e;return"L".concat(this.spatial,"T").concat(this.temporal).concat((e=this.suffix)!==null&&e!==void 0?e:"")}}function VN(t){return t.source===U.Source.ScreenShare||t.constraints.height&&la(t.constraints.height)>=1080?"maintain-resolution":"balanced"}const HN=5e3;class Ic extends uk{get sender(){return this._sender}set sender(e){this._sender=e,this.degradationPreference&&this.setDegradationPreference(this.degradationPreference)}constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,a=arguments.length>3?arguments[3]:void 0;super(e,U.Kind.Video,n,i,a),this.simulcastCodecs=new Map,this.degradationPreference="balanced",this.isCpuConstrained=!1,this.optimizeForPerformance=!1,this.monitorSender=()=>S(this,void 0,void 0,function*(){if(!this.sender){this._currentBitrate=0;return}let s;try{s=yield this.getSenderStats()}catch(l){this.log.error("could not get video sender stats",Object.assign(Object.assign({},this.logContext),{error:l}));return}const r=new Map(s.map(l=>[l.rid,l])),o=s.some(l=>l.qualityLimitationReason==="cpu");if(o!==this.isCpuConstrained&&(this.isCpuConstrained=o,this.isCpuConstrained&&this.emit(B.CpuConstrained)),this.prevStats){let l=0;r.forEach((c,u)=>{var d;const f=(d=this.prevStats)===null||d===void 0?void 0:d.get(u);l+=vu(c,f)}),this._currentBitrate=l}this.prevStats=r}),this.senderLock=new xt}get isSimulcast(){return!!(this.sender&&this.sender.getParameters().encodings.length>1)}startMonitor(e){var n;if(this.signalClient=e,!Ut())return;const i=(n=this.sender)===null||n===void 0?void 0:n.getParameters();i&&(this.encodings=i.encodings),!this.monitorInterval&&(this.monitorInterval=setInterval(()=>{this.monitorSender()},tp))}stop(){this._mediaStreamTrack.getConstraints(),this.simulcastCodecs.forEach(e=>{e.mediaStreamTrack.stop()}),super.stop()}pauseUpstream(){const e=Object.create(null,{pauseUpstream:{get:()=>super.pauseUpstream}});return S(this,void 0,void 0,function*(){var n,i,a,s,r;yield e.pauseUpstream.call(this);try{for(var o=!0,l=ui(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;o=!0)s=c.value,o=!1,yield(r=s.sender)===null||r===void 0?void 0:r.replaceTrack(null)}catch(u){i={error:u}}finally{try{!o&&!n&&(a=l.return)&&(yield a.call(l))}finally{if(i)throw i.error}}})}resumeUpstream(){const e=Object.create(null,{resumeUpstream:{get:()=>super.resumeUpstream}});return S(this,void 0,void 0,function*(){var n,i,a,s,r;yield e.resumeUpstream.call(this);try{for(var o=!0,l=ui(this.simulcastCodecs.values()),c;c=yield l.next(),n=c.done,!n;o=!0){s=c.value,o=!1;const u=s;yield(r=u.sender)===null||r===void 0?void 0:r.replaceTrack(u.mediaStreamTrack)}}catch(u){i={error:u}}finally{try{!o&&!n&&(a=l.return)&&(yield a.call(l))}finally{if(i)throw i.error}}})}mute(){const e=Object.create(null,{mute:{get:()=>super.mute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.log.debug("Track already muted",this.logContext),this):(this.source===U.Source.Camera&&!this.isUserProvided&&(this.log.debug("stopping camera track",this.logContext),this._mediaStreamTrack.stop()),yield e.mute.call(this),this)}finally{n()}})}unmute(){const e=Object.create(null,{unmute:{get:()=>super.unmute}});return S(this,void 0,void 0,function*(){const n=yield this.muteLock.lock();try{return this.isMuted?(this.source===U.Source.Camera&&!this.isUserProvided&&(this.log.debug("reacquiring camera track",this.logContext),yield this.restartTrack()),yield e.unmute.call(this),this):(this.log.debug("Track already unmuted",this.logContext),this)}finally{n()}})}setTrackMuted(e){super.setTrackMuted(e);for(const n of this.simulcastCodecs.values())n.mediaStreamTrack.enabled=!e}getSenderStats(){return S(this,void 0,void 0,function*(){var e;if(!(!((e=this.sender)===null||e===void 0)&&e.getStats))return[];const n=[],i=yield this.sender.getStats();return i.forEach(a=>{var s;if(a.type==="outbound-rtp"){const r={type:"video",streamId:a.id,frameHeight:a.frameHeight,frameWidth:a.frameWidth,framesPerSecond:a.framesPerSecond,framesSent:a.framesSent,firCount:a.firCount,pliCount:a.pliCount,nackCount:a.nackCount,packetsSent:a.packetsSent,bytesSent:a.bytesSent,qualityLimitationReason:a.qualityLimitationReason,qualityLimitationDurations:a.qualityLimitationDurations,qualityLimitationResolutionChanges:a.qualityLimitationResolutionChanges,rid:(s=a.rid)!==null&&s!==void 0?s:a.id,retransmittedPacketsSent:a.retransmittedPacketsSent,targetBitrate:a.targetBitrate,timestamp:a.timestamp},o=i.get(a.remoteId);o&&(r.jitter=o.jitter,r.packetsLost=o.packetsLost,r.roundTripTime=o.roundTripTime),n.push(r)}}),n.sort((a,s)=>{var r,o;return((r=s.frameWidth)!==null&&r!==void 0?r:0)-((o=a.frameWidth)!==null&&o!==void 0?o:0)}),n})}setPublishingQuality(e){const n=[];for(let i=Yt.LOW;i<=Yt.HIGH;i+=1)n.push(new qm({quality:i,enabled:i<=e}));this.log.debug("setting publishing quality. max quality ".concat(e),this.logContext),this.setPublishingLayers(On(this.codec),n)}restartTrack(e){return S(this,void 0,void 0,function*(){var n,i,a,s,r;let o;if(e){const d=Ym({video:e});typeof d.video!="boolean"&&(o=d.video)}yield this.restart(o),this.isCpuConstrained=!1;try{for(var l=!0,c=ui(this.simulcastCodecs.values()),u;u=yield c.next(),n=u.done,!n;l=!0){s=u.value,l=!1;const d=s;d.sender&&((r=d.sender.transport)===null||r===void 0?void 0:r.state)!=="closed"&&(d.mediaStreamTrack=this.mediaStreamTrack.clone(),yield d.sender.replaceTrack(d.mediaStreamTrack))}}catch(d){i={error:d}}finally{try{!l&&!n&&(a=c.return)&&(yield a.call(c))}finally{if(i)throw i.error}}})}setProcessor(e){const n=Object.create(null,{setProcessor:{get:()=>super.setProcessor}});return S(this,arguments,void 0,function(i){var a=this;let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){var r,o,l,c,u,d;if(yield n.setProcessor.call(a,i,s),!((u=a.processor)===null||u===void 0)&&u.processedTrack)try{for(var f=!0,h=ui(a.simulcastCodecs.values()),g;g=yield h.next(),r=g.done,!r;f=!0)c=g.value,f=!1,yield(d=c.sender)===null||d===void 0?void 0:d.replaceTrack(a.processor.processedTrack)}catch(y){o={error:y}}finally{try{!f&&!r&&(l=h.return)&&(yield l.call(h))}finally{if(o)throw o.error}}}()})}setDegradationPreference(e){return S(this,void 0,void 0,function*(){if(this.degradationPreference=e,this.sender)try{this.log.debug("setting degradationPreference to ".concat(e),this.logContext);const n=this.sender.getParameters();n.degradationPreference=e,this.sender.setParameters(n)}catch(n){this.log.warn("failed to set degradationPreference",Object.assign({error:n},this.logContext))}})}addSimulcastTrack(e,n){if(this.simulcastCodecs.has(e)){this.log.error("".concat(e," already added, skipping adding simulcast codec"),this.logContext);return}const i={codec:e,mediaStreamTrack:this.mediaStreamTrack.clone(),sender:void 0,encodings:n};return this.simulcastCodecs.set(e,i),i}setSimulcastTrackSender(e,n){const i=this.simulcastCodecs.get(e);i&&(i.sender=n,setTimeout(()=>{this.subscribedCodecs&&this.setPublishingCodecs(this.subscribedCodecs)},HN))}setPublishingCodecs(e){return S(this,void 0,void 0,function*(){var n,i,a,s,r,o,l;if(this.log.debug("setting publishing codecs",Object.assign(Object.assign({},this.logContext),{codecs:e,currentCodec:this.codec})),!this.codec&&e.length>0)return yield this.setPublishingLayers(On(e[0].codec),e[0].qualities),[];this.subscribedCodecs=e;const c=[];try{for(n=!0,i=ui(e);a=yield i.next(),s=a.done,!s;n=!0){l=a.value,n=!1;const u=l;if(!this.codec||this.codec===u.codec)yield this.setPublishingLayers(On(u.codec),u.qualities);else{const d=this.simulcastCodecs.get(u.codec);if(this.log.debug("try setPublishingCodec for ".concat(u.codec),Object.assign(Object.assign({},this.logContext),{simulcastCodecInfo:d})),!d||!d.sender){for(const f of u.qualities)if(f.enabled){c.push(u.codec);break}}else d.encodings&&(this.log.debug("try setPublishingLayersForSender ".concat(u.codec),this.logContext),yield h0(d.sender,d.encodings,u.qualities,this.senderLock,On(u.codec),this.log,this.logContext))}}}catch(u){r={error:u}}finally{try{!n&&!s&&(o=i.return)&&(yield o.call(i))}finally{if(r)throw r.error}}return c})}setPublishingLayers(e,n){return S(this,void 0,void 0,function*(){if(this.optimizeForPerformance){this.log.info("skipping setPublishingLayers due to optimized publishing performance",Object.assign(Object.assign({},this.logContext),{qualities:n}));return}this.log.debug("setting publishing layers",Object.assign(Object.assign({},this.logContext),{qualities:n})),!(!this.sender||!this.encodings)&&(yield h0(this.sender,this.encodings,n,this.senderLock,e,this.log,this.logContext))})}prioritizePerformance(){return S(this,void 0,void 0,function*(){if(!this.sender)throw new Error("sender not found");const e=yield this.senderLock.lock();try{this.optimizeForPerformance=!0;const n=this.sender.getParameters();n.encodings=n.encodings.map((i,a)=>{var s;return Object.assign(Object.assign({},i),{active:a===0,scaleResolutionDownBy:Math.max(1,Math.ceil(((s=this.mediaStreamTrack.getSettings().height)!==null&&s!==void 0?s:360)/360)),scalabilityMode:a===0&&On(this.codec)?"L1T3":void 0,maxFramerate:a===0?15:0,maxBitrate:a===0?i.maxBitrate:0})}),this.log.debug("setting performance optimised encodings",Object.assign(Object.assign({},this.logContext),{encodings:n.encodings})),this.encodings=n.encodings,yield this.sender.setParameters(n)}catch(n){this.log.error("failed to set performance optimised encodings",Object.assign(Object.assign({},this.logContext),{error:n})),this.optimizeForPerformance=!1}finally{e()}})}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),nk()&&this.isInBackground&&this.source===U.Source.Camera&&(this._mediaStreamTrack.enabled=!1)})}}function h0(t,e,n,i,a,s,r){return S(this,void 0,void 0,function*(){const o=yield i.lock();s.debug("setPublishingLayersForSender",Object.assign(Object.assign({},r),{sender:t,qualities:n,senderEncodings:e}));try{const l=t.getParameters(),{encodings:c}=l;if(!c)return;if(c.length!==e.length){s.warn("cannot set publishing layers, encodings mismatch",Object.assign(Object.assign({},r),{encodings:c,senderEncodings:e}));return}let u=!1;!1&&c[0].scalabilityMode||(a&&n.some(h=>h.enabled)&&n.forEach(h=>h.enabled=!0),c.forEach((f,h)=>{var g;let y=(g=f.rid)!==null&&g!==void 0?g:"";y===""&&(y="q");const T=fk(y),m=n.find(p=>p.quality===T);m&&f.active!==m.enabled&&(u=!0,f.active=m.enabled,s.debug("setting layer ".concat(m.quality," to ").concat(f.active?"enabled":"disabled"),r),Ya()&&(m.enabled?(f.scaleResolutionDownBy=e[h].scaleResolutionDownBy,f.maxBitrate=e[h].maxBitrate,f.maxFrameRate=e[h].maxFrameRate):(f.scaleResolutionDownBy=4,f.maxBitrate=10,f.maxFrameRate=2)))})),u&&(l.encodings=c,s.debug("setting encodings",Object.assign(Object.assign({},r),{encodings:l.encodings})),yield t.setParameters(l))}finally{o()}})}function fk(t){switch(t){case"f":return Yt.HIGH;case"h":return Yt.MEDIUM;case"q":return Yt.LOW;default:return Yt.HIGH}}function m0(t,e,n,i){if(!n)return[new oa({quality:Yt.HIGH,width:t,height:e,bitrate:0,ssrc:0})];if(i){const a=n[0].scalabilityMode,s=new dk(a),r=[],o=s.suffix=="h"?1.5:2,l=s.suffix=="h"?2:3;for(let c=0;c<s.spatial;c+=1)r.push(new oa({quality:Math.min(Yt.HIGH,s.spatial-1)-c,width:Math.ceil(t/Math.pow(o,c)),height:Math.ceil(e/Math.pow(o,c)),bitrate:n[0].maxBitrate?Math.ceil(n[0].maxBitrate/Math.pow(l,c)):0,ssrc:0}));return r}return n.map(a=>{var s,r,o;const l=(s=a.scaleResolutionDownBy)!==null&&s!==void 0?s:1;let c=fk((r=a.rid)!==null&&r!==void 0?r:"");return new oa({quality:c,width:Math.ceil(t/l),height:Math.ceil(e/l),bitrate:(o=a.maxBitrate)!==null&&o!==void 0?o:0,ssrc:0})})}const p0="_lossy",g0="_reliable",GN=2*1e3,Dd="leave-reconnect",KN=3e4,YN=8*1024,QN=256*1024;var tn;(function(t){t[t.New=0]="New",t[t.Connected=1]="Connected",t[t.Disconnected=2]="Disconnected",t[t.Reconnecting=3]="Reconnecting",t[t.Closed=4]="Closed"})(tn||(tn={}));class JN extends Zn.EventEmitter{get isClosed(){return this._isClosed}get pendingReconnect(){return!!this.reconnectTimeout}constructor(e){var n;super(),this.options=e,this.rtcConfig={},this.peerConnectionTimeout=$m.peerConnectionTimeout,this.fullReconnectOnNext=!1,this.latestRemoteOfferId=0,this.subscriberPrimary=!1,this.pcState=tn.New,this._isClosed=!0,this.pendingTrackResolvers={},this.reconnectAttempts=0,this.reconnectStart=0,this.attemptingReconnect=!1,this.joinAttempts=0,this.maxJoinAttempts=1,this.shouldFailNext=!1,this.log=ie,this.reliableDataSequence=1,this.reliableMessageBuffer=new n0,this.reliableReceivedState=new pN(KN),this.lossyDataStatCurrentBytes=0,this.lossyDataStatByterate=0,this.lossyDataDropCount=0,this.midToTrackId={},this.isWaitingForNetworkReconnect=!1,this.handleDataChannel=i=>S(this,[i],void 0,function(a){var s=this;let{channel:r}=a;return function*(){if(r){if(r.label===g0)s.reliableDCSub=r;else if(r.label===p0)s.lossyDCSub=r;else return;s.log.debug("on data channel ".concat(r.id,", ").concat(r.label),s.logContext),r.onmessage=s.handleDataMessage}}()}),this.handleDataMessage=i=>S(this,void 0,void 0,function*(){var a,s,r,o,l;const c=yield this.dataProcessLock.lock();try{let u;if(i.data instanceof ArrayBuffer)u=i.data;else if(i.data instanceof Blob)u=yield i.data.arrayBuffer();else{this.log.error("unsupported data type",Object.assign(Object.assign({},this.logContext),{data:i.data}));return}const d=_t.fromBinary(new Uint8Array(u));if(d.sequence>0&&d.participantSid!==""){const f=this.reliableReceivedState.get(d.participantSid);if(f&&d.sequence<=f)return;this.reliableReceivedState.set(d.participantSid,d.sequence)}if(((a=d.value)===null||a===void 0?void 0:a.case)==="speaker")this.emit(F.ActiveSpeakersUpdate,d.value.value.speakers);else if(((s=d.value)===null||s===void 0?void 0:s.case)==="encryptedPacket"){if(!this.e2eeManager){this.log.error("Received encrypted packet but E2EE not set up",this.logContext);return}const f=yield(r=this.e2eeManager)===null||r===void 0?void 0:r.handleEncryptedData(d.value.value.encryptedValue,d.value.value.iv,d.participantIdentity,d.value.value.keyIndex),h=YT.fromBinary(f.payload),g=new _t({value:h.value,participantIdentity:d.participantIdentity,participantSid:d.participantSid});((o=g.value)===null||o===void 0?void 0:o.case)==="user"&&v0(g,g.value.value),this.emit(F.DataPacketReceived,g,d.value.value.encryptionType)}else((l=d.value)===null||l===void 0?void 0:l.case)==="user"&&v0(d,d.value.value),this.emit(F.DataPacketReceived,d,Ke.NONE)}finally{c()}}),this.handleDataError=i=>{const s=i.currentTarget.maxRetransmits===0?"lossy":"reliable";if(i instanceof ErrorEvent&&i.error){const{error:r}=i.error;this.log.error("DataChannel error on ".concat(s,": ").concat(i.message),Object.assign(Object.assign({},this.logContext),{error:r}))}else this.log.error("Unknown DataChannel error on ".concat(s),Object.assign(Object.assign({},this.logContext),{event:i}))},this.handleBufferedAmountLow=i=>{const s=i.currentTarget.maxRetransmits===0?ae.LOSSY:ae.RELIABLE;this.updateAndEmitDCBufferStatus(s)},this.handleDisconnect=(i,a)=>{if(this._isClosed)return;this.log.warn("".concat(i," disconnected"),this.logContext),this.reconnectAttempts===0&&(this.reconnectStart=Date.now());const s=l=>{this.log.warn("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(l,"ms. giving up"),this.logContext),this.emit(F.Disconnected),this.close()},r=Date.now()-this.reconnectStart;let o=this.getNextRetryDelay({elapsedMs:r,retryCount:this.reconnectAttempts});if(o===null){s(r);return}i===Dd&&(o=0),this.log.debug("reconnecting in ".concat(o,"ms"),this.logContext),this.clearReconnectTimeout(),this.token&&this.regionUrlProvider&&this.regionUrlProvider.updateToken(this.token),this.reconnectTimeout=vt.setTimeout(()=>this.attemptReconnect(a).finally(()=>this.reconnectTimeout=void 0),o)},this.waitForRestarted=()=>new Promise((i,a)=>{this.pcState===tn.Connected&&i();const s=()=>{this.off(F.Disconnected,r),i()},r=()=>{this.off(F.Restarted,s),a()};this.once(F.Restarted,s),this.once(F.Disconnected,r)}),this.updateAndEmitDCBufferStatus=i=>{if(i===ae.RELIABLE){const s=this.dataChannelForKind(i);s&&this.reliableMessageBuffer.alignBufferedAmount(s.bufferedAmount)}const a=this.isBufferStatusLow(i);typeof a<"u"&&a!==this.dcBufferStatus.get(i)&&(this.dcBufferStatus.set(i,a),this.emit(F.DCBufferStatusChanged,a,i))},this.isBufferStatusLow=i=>{const a=this.dataChannelForKind(i);if(a)return a.bufferedAmount<=a.bufferedAmountLowThreshold},this.handleBrowserOnLine=()=>S(this,void 0,void 0,function*(){!this.url||!(yield fetch(wo(this.url),{method:"HEAD"}).then(a=>a.ok).catch(()=>!1))||(this.log.info("detected network reconnected"),(this.client.currentState===_e.RECONNECTING||this.isWaitingForNetworkReconnect&&this.client.currentState===_e.CONNECTED)&&(this.clearReconnectTimeout(),this.attemptReconnect(Da.RR_SIGNAL_DISCONNECTED),this.isWaitingForNetworkReconnect=!1))}),this.handleBrowserOffline=()=>S(this,void 0,void 0,function*(){if(this.url)try{yield Promise.race([fetch(wo(this.url),{method:"HEAD"}),bt(4e3).then(()=>Promise.reject())])}catch{window.navigator.onLine===!1&&(this.log.info("detected network interruption"),this.isWaitingForNetworkReconnect=!0)}}),this.log=xi((n=e.loggerName)!==null&&n!==void 0?n:Dn.Engine),this.loggerOptions={loggerName:e.loggerName,loggerContextCb:()=>this.logContext},this.client=new Jm(void 0,this.loggerOptions),this.client.signalLatency=this.options.expSignalLatency,this.reconnectPolicy=this.options.reconnectPolicy,this.closingLock=new xt,this.dataProcessLock=new xt,this.dcBufferStatus=new Map([[ae.LOSSY,!0],[ae.RELIABLE,!0]]),this.client.onParticipantUpdate=i=>this.emit(F.ParticipantUpdate,i),this.client.onConnectionQuality=i=>this.emit(F.ConnectionQualityUpdate,i),this.client.onRoomUpdate=i=>this.emit(F.RoomUpdate,i),this.client.onSubscriptionError=i=>this.emit(F.SubscriptionError,i),this.client.onSubscriptionPermissionUpdate=i=>this.emit(F.SubscriptionPermissionUpdate,i),this.client.onSpeakersChanged=i=>this.emit(F.SpeakersChanged,i),this.client.onStreamStateUpdate=i=>this.emit(F.StreamStateChanged,i),this.client.onRequestResponse=i=>this.emit(F.SignalRequestResponse,i)}get logContext(){var e,n,i,a,s,r;return{room:(n=(e=this.latestJoinResponse)===null||e===void 0?void 0:e.room)===null||n===void 0?void 0:n.name,roomID:(a=(i=this.latestJoinResponse)===null||i===void 0?void 0:i.room)===null||a===void 0?void 0:a.sid,participant:(r=(s=this.latestJoinResponse)===null||s===void 0?void 0:s.participant)===null||r===void 0?void 0:r.identity,pID:this.participantSid}}join(e,n,i,a){return S(this,arguments,void 0,function(s,r,o,l){var c=this;let u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;return function*(){c.url=s,c.token=r,c.signalOpts=o,c.maxJoinAttempts=o.maxRetries;try{c.joinAttempts+=1,c.setupSignalClientCallbacks();const d=yield c.client.join(s,r,o,l,u);return c._isClosed=!1,c.latestJoinResponse=d,c.subscriberPrimary=d.subscriberPrimary,c.pcManager||(yield c.configure(d,!u)),(!c.subscriberPrimary||d.fastPublish)&&c.negotiate().catch(f=>{ie.error(f,c.logContext)}),c.registerOnLineListener(),c.clientConfiguration=d.clientConfiguration,c.emit(F.SignalConnected,d),d}catch(d){if(d instanceof J){if(d.reason===Re.ServerUnreachable){if(c.log.warn("Couldn't connect to server, attempt ".concat(c.joinAttempts," of ").concat(c.maxJoinAttempts),c.logContext),c.joinAttempts<c.maxJoinAttempts)return c.join(s,r,o,l,u)}else if(d.reason===Re.ServiceNotFound)return c.log.warn("Initial connection failed: ".concat(d.message,"  Retrying")),c.join(s,r,o,l,!0)}throw d}}()})}close(){return S(this,void 0,void 0,function*(){const e=yield this.closingLock.lock();if(this.isClosed){e();return}try{this._isClosed=!0,this.joinAttempts=0,this.emit(F.Closing),this.removeAllListeners(),this.deregisterOnLineListener(),this.clearPendingReconnect(),this.cleanupLossyDataStats(),yield this.cleanupPeerConnections(),yield this.cleanupClient()}finally{e()}})}cleanupPeerConnections(){return S(this,void 0,void 0,function*(){var e;yield(e=this.pcManager)===null||e===void 0?void 0:e.close(),this.pcManager=void 0;const n=i=>{i&&(i.close(),i.onbufferedamountlow=null,i.onclose=null,i.onclosing=null,i.onerror=null,i.onmessage=null,i.onopen=null)};n(this.lossyDC),n(this.lossyDCSub),n(this.reliableDC),n(this.reliableDCSub),this.lossyDC=void 0,this.lossyDCSub=void 0,this.reliableDC=void 0,this.reliableDCSub=void 0,this.reliableMessageBuffer=new n0,this.reliableDataSequence=1,this.reliableReceivedState.clear()})}cleanupLossyDataStats(){this.lossyDataStatByterate=0,this.lossyDataStatCurrentBytes=0,this.lossyDataStatInterval&&(clearInterval(this.lossyDataStatInterval),this.lossyDataStatInterval=void 0),this.lossyDataDropCount=0}cleanupClient(){return S(this,void 0,void 0,function*(){yield this.client.close(),this.client.resetCallbacks()})}addTrack(e){if(this.pendingTrackResolvers[e.cid])throw new di("a track with the same ID has already been published");return new Promise((n,i)=>{const a=setTimeout(()=>{delete this.pendingTrackResolvers[e.cid],i(J.timeout("publication of local track timed out, no response from server"))},1e4);this.pendingTrackResolvers[e.cid]={resolve:s=>{clearTimeout(a),n(s)},reject:()=>{clearTimeout(a),i(new Error("Cancelled publication by calling unpublish"))}},this.client.sendAddTrack(e)})}removeTrack(e){if(e.track&&this.pendingTrackResolvers[e.track.id]){const{reject:n}=this.pendingTrackResolvers[e.track.id];n&&n(),delete this.pendingTrackResolvers[e.track.id]}try{return this.pcManager.removeTrack(e),!0}catch(n){this.log.warn("failed to remove track",Object.assign(Object.assign({},this.logContext),{error:n}))}return!1}updateMuteStatus(e,n){this.client.sendMuteTrack(e,n)}get dataSubscriberReadyState(){var e;return(e=this.reliableDCSub)===null||e===void 0?void 0:e.readyState}getConnectedServerAddress(){return S(this,void 0,void 0,function*(){var e;return(e=this.pcManager)===null||e===void 0?void 0:e.getConnectedAddress()})}setRegionUrlProvider(e){this.regionUrlProvider=e}configure(e,n){return S(this,void 0,void 0,function*(){var i,a;if(this.pcManager&&this.pcManager.currentState!==Be.NEW)return;this.participantSid=(i=e.participant)===null||i===void 0?void 0:i.sid;const s=this.makeRTCConfiguration(e);this.pcManager=new EN(s,n?"publisher-only":e.subscriberPrimary?"subscriber-primary":"publisher-primary",this.loggerOptions),this.emit(F.TransportsCreated,this.pcManager.publisher,this.pcManager.subscriber),this.pcManager.onIceCandidate=(r,o)=>{this.client.sendIceCandidate(r,o)},this.pcManager.onPublisherOffer=(r,o)=>{this.client.sendOffer(r,o)},this.pcManager.onDataChannel=this.handleDataChannel,this.pcManager.onStateChange=(r,o,l)=>S(this,void 0,void 0,function*(){if(this.log.debug("primary PC state changed ".concat(r),this.logContext),["closed","disconnected","failed"].includes(o)&&(this.publisherConnectionPromise=void 0),r===Be.CONNECTED){const d=this.pcState===tn.New;this.pcState=tn.Connected,d&&this.emit(F.Connected,e)}else r===Be.FAILED&&(this.pcState===tn.Connected||this.pcState===tn.Reconnecting)&&(this.pcState=tn.Disconnected,this.handleDisconnect("peerconnection failed",l==="failed"?Da.RR_SUBSCRIBER_FAILED:Da.RR_PUBLISHER_FAILED));const c=this.client.isDisconnected||this.client.currentState===_e.RECONNECTING,u=[Be.FAILED,Be.CLOSING,Be.CLOSED].includes(r);c&&u&&!this._isClosed&&this.emit(F.Offline)}),this.pcManager.onTrack=r=>{r.streams.length!==0&&this.emit(F.MediaTrackAdded,r.track,r.streams[0],r.receiver)},XN((a=e.serverInfo)===null||a===void 0?void 0:a.protocol)||this.createDataChannels()})}setupSignalClientCallbacks(){this.client.onAnswer=(e,n,i)=>S(this,void 0,void 0,function*(){this.pcManager&&(this.log.debug("received server answer",Object.assign(Object.assign({},this.logContext),{RTCSdpType:e.type,sdp:e.sdp,midToTrackId:i})),this.midToTrackId=i,yield this.pcManager.setPublisherAnswer(e,n))}),this.client.onTrickle=(e,n)=>{this.pcManager&&(this.log.debug("got ICE candidate from peer",Object.assign(Object.assign({},this.logContext),{candidate:e,target:n})),this.pcManager.addIceCandidate(e,n))},this.client.onOffer=(e,n,i)=>S(this,void 0,void 0,function*(){if(this.latestRemoteOfferId=n,!this.pcManager)return;this.midToTrackId=i;const a=yield this.pcManager.createSubscriberAnswerFromOffer(e,n);a&&this.client.sendAnswer(a,n)}),this.client.onLocalTrackPublished=e=>{var n;if(this.log.debug("received trackPublishedResponse",Object.assign(Object.assign({},this.logContext),{cid:e.cid,track:(n=e.track)===null||n===void 0?void 0:n.sid})),!this.pendingTrackResolvers[e.cid]){this.log.error("missing track resolver for ".concat(e.cid),Object.assign(Object.assign({},this.logContext),{cid:e.cid}));return}const{resolve:i}=this.pendingTrackResolvers[e.cid];delete this.pendingTrackResolvers[e.cid],i(e.track)},this.client.onLocalTrackUnpublished=e=>{this.emit(F.LocalTrackUnpublished,e)},this.client.onLocalTrackSubscribed=e=>{this.emit(F.LocalTrackSubscribed,e)},this.client.onTokenRefresh=e=>{var n;this.token=e,(n=this.regionUrlProvider)===null||n===void 0||n.updateToken(e)},this.client.onRemoteMuteChanged=(e,n)=>{this.emit(F.RemoteMute,e,n)},this.client.onSubscribedQualityUpdate=e=>{this.emit(F.SubscribedQualityUpdate,e)},this.client.onRoomMoved=e=>{var n;this.participantSid=(n=e.participant)===null||n===void 0?void 0:n.sid,this.latestJoinResponse&&(this.latestJoinResponse.room=e.room),this.emit(F.RoomMoved,e)},this.client.onMediaSectionsRequirement=e=>{var n,i;const a={direction:"recvonly"};for(let s=0;s<e.numAudios;s++)(n=this.pcManager)===null||n===void 0||n.addPublisherTransceiverOfKind("audio",a);for(let s=0;s<e.numVideos;s++)(i=this.pcManager)===null||i===void 0||i.addPublisherTransceiverOfKind("video",a);this.negotiate()},this.client.onClose=()=>{this.handleDisconnect("signal",Da.RR_SIGNAL_DISCONNECTED)},this.client.onLeave=e=>{switch(this.log.debug("client leave request",Object.assign(Object.assign({},this.logContext),{reason:e==null?void 0:e.reason})),e.regions&&this.regionUrlProvider&&(this.log.debug("updating regions",this.logContext),this.regionUrlProvider.setServerReportedRegions({updatedAtInMs:Date.now(),maxAgeInMs:lk,regionSettings:e.regions})),e.action){case Ls.DISCONNECT:this.emit(F.Disconnected,e==null?void 0:e.reason),this.close();break;case Ls.RECONNECT:this.fullReconnectOnNext=!0,this.handleDisconnect(Dd);break;case Ls.RESUME:this.handleDisconnect(Dd)}}}makeRTCConfiguration(e){var n;const i=Object.assign({},this.rtcConfig);if(!((n=this.signalOpts)===null||n===void 0)&&n.e2eeEnabled&&(this.log.debug("E2EE - setting up transports with insertable streams",this.logContext),i.encodedInsertableStreams=!0),e.iceServers&&!i.iceServers){const a=[];e.iceServers.forEach(s=>{const r={urls:s.urls};s.username&&(r.username=s.username),s.credential&&(r.credential=s.credential),a.push(r)}),i.iceServers=a}return e.clientConfiguration&&e.clientConfiguration.forceRelay===ko.ENABLED&&(i.iceTransportPolicy="relay"),i.sdpSemantics="unified-plan",i.continualGatheringPolicy="gather_continually",i}createDataChannels(){this.pcManager&&(this.lossyDC&&(this.lossyDC.onmessage=null,this.lossyDC.onerror=null),this.reliableDC&&(this.reliableDC.onmessage=null,this.reliableDC.onerror=null),this.lossyDC=this.pcManager.createPublisherDataChannel(p0,{ordered:!1,maxRetransmits:0}),this.reliableDC=this.pcManager.createPublisherDataChannel(g0,{ordered:!0}),this.lossyDC.onmessage=this.handleDataMessage,this.reliableDC.onmessage=this.handleDataMessage,this.lossyDC.onerror=this.handleDataError,this.reliableDC.onerror=this.handleDataError,this.lossyDC.bufferedAmountLowThreshold=65535,this.reliableDC.bufferedAmountLowThreshold=65535,this.lossyDC.onbufferedamountlow=this.handleBufferedAmountLow,this.reliableDC.onbufferedamountlow=this.handleBufferedAmountLow,this.cleanupLossyDataStats(),this.lossyDataStatInterval=setInterval(()=>{this.lossyDataStatByterate=this.lossyDataStatCurrentBytes,this.lossyDataStatCurrentBytes=0;const e=this.dataChannelForKind(ae.LOSSY);if(e){const n=this.lossyDataStatByterate/10;e.bufferedAmountLowThreshold=Math.min(Math.max(n,YN),QN)}},1e3))}createSender(e,n,i){return S(this,void 0,void 0,function*(){if(eh())return yield this.createTransceiverRTCRtpSender(e,n,i);if(th())return this.log.warn("using add-track fallback",this.logContext),yield this.createRTCRtpSender(e.mediaStreamTrack);throw new Ve("Required webRTC APIs not supported on this device")})}createSimulcastSender(e,n,i,a){return S(this,void 0,void 0,function*(){if(eh())return this.createSimulcastTransceiverSender(e,n,i,a);if(th())return this.log.debug("using add-track fallback",this.logContext),this.createRTCRtpSender(e.mediaStreamTrack);throw new Ve("Cannot stream on this device")})}createTransceiverRTCRtpSender(e,n,i){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ve("publisher is closed");const a=[];e.mediaStream&&a.push(e.mediaStream),Ca(e)&&(e.codec=n.videoCodec);const s={direction:"sendonly",streams:a};return i&&(s.sendEncodings=i),(yield this.pcManager.addPublisherTransceiver(e.mediaStreamTrack,s)).sender})}createSimulcastTransceiverSender(e,n,i,a){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ve("publisher is closed");const s={direction:"sendonly"};a&&(s.sendEncodings=a);const r=yield this.pcManager.addPublisherTransceiver(n.mediaStreamTrack,s);if(i.videoCodec)return e.setSimulcastTrackSender(i.videoCodec,r.sender),r.sender})}createRTCRtpSender(e){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ve("publisher is closed");return this.pcManager.addPublisherTrack(e)})}attemptReconnect(e){return S(this,void 0,void 0,function*(){var n,i,a;if(!this._isClosed){if(this.attemptingReconnect){ie.warn("already attempting reconnect, returning early",this.logContext);return}(((n=this.clientConfiguration)===null||n===void 0?void 0:n.resumeConnection)===ko.DISABLED||((a=(i=this.pcManager)===null||i===void 0?void 0:i.currentState)!==null&&a!==void 0?a:Be.NEW)===Be.NEW)&&(this.fullReconnectOnNext=!0);try{this.attemptingReconnect=!0,this.fullReconnectOnNext?yield this.restartConnection():yield this.resumeConnection(e),this.clearPendingReconnect(),this.fullReconnectOnNext=!1}catch(s){this.reconnectAttempts+=1;let r=!0;s instanceof Ve?(this.log.debug("received unrecoverable error",Object.assign(Object.assign({},this.logContext),{error:s})),r=!1):s instanceof ls||(this.fullReconnectOnNext=!0),r?this.handleDisconnect("reconnect",Da.RR_UNKNOWN):(this.log.info("could not recover connection after ".concat(this.reconnectAttempts," attempts, ").concat(Date.now()-this.reconnectStart,"ms. giving up"),this.logContext),this.emit(F.Disconnected),yield this.close())}finally{this.attemptingReconnect=!1}}})}getNextRetryDelay(e){try{return this.reconnectPolicy.nextRetryDelayInMs(e)}catch(n){this.log.warn("encountered error in reconnect policy",Object.assign(Object.assign({},this.logContext),{error:n}))}return null}restartConnection(e){return S(this,void 0,void 0,function*(){var n,i,a;try{if(!this.url||!this.token)throw new Ve("could not reconnect, url or token not saved");this.log.info("reconnecting, attempt: ".concat(this.reconnectAttempts),this.logContext),this.emit(F.Restarting),this.client.isDisconnected||(yield this.client.sendLeave()),yield this.cleanupPeerConnections(),yield this.cleanupClient();let s;try{if(!this.signalOpts)throw this.log.warn("attempted connection restart, without signal options present",this.logContext),new ls;s=yield this.join(e??this.url,this.token,this.signalOpts,void 0,!this.options.singlePeerConnection)}catch(r){throw r instanceof J&&r.reason===Re.NotAllowed?new Ve("could not reconnect, token might be expired"):new ls}if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(this.client.setReconnected(),this.emit(F.SignalRestarted,s),yield this.waitForPCReconnected(),this.client.currentState!==_e.CONNECTED)throw new ls("Signal connection got severed during reconnect");(n=this.regionUrlProvider)===null||n===void 0||n.resetAttempts(),this.emit(F.Restarted)}catch(s){const r=yield(i=this.regionUrlProvider)===null||i===void 0?void 0:i.getNextBestRegionUrl();if(r){yield this.restartConnection(r);return}else throw(a=this.regionUrlProvider)===null||a===void 0||a.resetAttempts(),s}})}resumeConnection(e){return S(this,void 0,void 0,function*(){var n;if(!this.url||!this.token)throw new Ve("could not reconnect, url or token not saved");if(!this.pcManager)throw new Ve("publisher and subscriber connections unset");this.log.info("resuming signal connection, attempt ".concat(this.reconnectAttempts),this.logContext),this.emit(F.Resuming);let i;try{this.setupSignalClientCallbacks(),i=yield this.client.reconnect(this.url,this.token,this.participantSid,e)}catch(a){let s="";throw a instanceof Error&&(s=a.message,this.log.error(a.message,Object.assign(Object.assign({},this.logContext),{error:a}))),a instanceof J&&a.reason===Re.NotAllowed?new Ve("could not reconnect, token might be expired"):a instanceof J&&a.reason===Re.LeaveRequest?a:new ls(s)}if(this.emit(F.SignalResumed),i){const a=this.makeRTCConfiguration(i);this.pcManager.updateConfiguration(a),this.latestJoinResponse&&(this.latestJoinResponse.serverInfo=i.serverInfo)}else this.log.warn("Did not receive reconnect response",this.logContext);if(this.shouldFailNext)throw this.shouldFailNext=!1,new Error("simulated failure");if(yield this.pcManager.triggerIceRestart(),yield this.waitForPCReconnected(),this.client.currentState!==_e.CONNECTED)throw new ls("Signal connection got severed during reconnect");this.client.setReconnected(),((n=this.reliableDC)===null||n===void 0?void 0:n.readyState)==="open"&&this.reliableDC.id===null&&this.createDataChannels(),i!=null&&i.lastMessageSeq&&this.resendReliableMessagesForResume(i.lastMessageSeq),this.emit(F.Resumed)})}waitForPCInitialConnection(e,n){return S(this,void 0,void 0,function*(){if(!this.pcManager)throw new Ve("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(n,e)})}waitForPCReconnected(){return S(this,void 0,void 0,function*(){this.pcState=tn.Reconnecting,this.log.debug("waiting for peer connection to reconnect",this.logContext);try{if(yield bt(GN),!this.pcManager)throw new Ve("PC manager is closed");yield this.pcManager.ensurePCTransportConnection(void 0,this.peerConnectionTimeout),this.pcState=tn.Connected}catch(e){throw this.pcState=tn.Disconnected,J.internal("could not establish PC connection, ".concat(e.message))}})}publishRpcResponse(e,n,i,a){return S(this,void 0,void 0,function*(){const s=new _t({destinationIdentities:[e],kind:ae.RELIABLE,value:{case:"rpcResponse",value:new Um({requestId:n,value:a?{case:"error",value:a.toProto()}:{case:"payload",value:i??""}})}});yield this.sendDataPacket(s,ae.RELIABLE)})}publishRpcAck(e,n){return S(this,void 0,void 0,function*(){const i=new _t({destinationIdentities:[e],kind:ae.RELIABLE,value:{case:"rpcAck",value:new Lm({requestId:n})}});yield this.sendDataPacket(i,ae.RELIABLE)})}sendDataPacket(e,n){return S(this,void 0,void 0,function*(){if(yield this.ensurePublisherConnected(n),this.e2eeManager&&this.e2eeManager.isDataChannelEncryptionEnabled){const s=aN(e);if(s){const r=yield this.e2eeManager.encryptData(s.toBinary());e.value={case:"encryptedPacket",value:new KT({encryptedValue:r.payload,iv:r.iv,keyIndex:r.keyIndex})}}}n===ae.RELIABLE&&(e.sequence=this.reliableDataSequence,this.reliableDataSequence+=1);const i=e.toBinary(),a=this.dataChannelForKind(n);if(a){if(n===ae.RELIABLE)yield this.waitForBufferStatusLow(n),this.reliableMessageBuffer.push({data:i,sequence:e.sequence});else{if(!this.isBufferStatusLow(n)){this.lossyDataDropCount+=1,this.lossyDataDropCount%100===0&&this.log.warn("dropping lossy data channel messages, total dropped: ".concat(this.lossyDataDropCount),this.logContext);return}this.lossyDataStatCurrentBytes+=i.byteLength}if(this.attemptingReconnect)return;a.send(i)}this.updateAndEmitDCBufferStatus(n)})}resendReliableMessagesForResume(e){return S(this,void 0,void 0,function*(){yield this.ensurePublisherConnected(ae.RELIABLE);const n=this.dataChannelForKind(ae.RELIABLE);n&&(this.reliableMessageBuffer.popToSequence(e),this.reliableMessageBuffer.getAll().forEach(i=>{n.send(i.data)})),this.updateAndEmitDCBufferStatus(ae.RELIABLE)})}waitForBufferStatusLow(e){return new Tt((n,i)=>S(this,void 0,void 0,function*(){if(this.isBufferStatusLow(e))n();else{const a=()=>i(new Ve("engine closed"));for(this.once(F.Closing,a);!this.dcBufferStatus.get(e);)yield bt(10);this.off(F.Closing,a),n()}}))}ensureDataTransportConnected(e){return S(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.subscriberPrimary;return function*(){var s;if(!i.pcManager)throw new Ve("PC manager is closed");const r=a?i.pcManager.subscriber:i.pcManager.publisher,o=a?"Subscriber":"Publisher";if(!r)throw J.internal("".concat(o," connection not set"));let l=!1;!a&&!i.dataChannelForKind(n,a)&&(i.createDataChannels(),l=!0),!l&&!a&&!i.pcManager.publisher.isICEConnected&&i.pcManager.publisher.getICEConnectionState()!=="checking"&&(l=!0),l&&i.negotiate().catch(d=>{ie.error(d,i.logContext)});const c=i.dataChannelForKind(n,a);if((c==null?void 0:c.readyState)==="open")return;const u=new Date().getTime()+i.peerConnectionTimeout;for(;new Date().getTime()<u;){if(r.isICEConnected&&((s=i.dataChannelForKind(n,a))===null||s===void 0?void 0:s.readyState)==="open")return;yield bt(50)}throw J.internal("could not establish ".concat(o," connection, state: ").concat(r.getICEConnectionState()))}()})}ensurePublisherConnected(e){return S(this,void 0,void 0,function*(){this.publisherConnectionPromise||(this.publisherConnectionPromise=this.ensureDataTransportConnected(e,!1)),yield this.publisherConnectionPromise})}verifyTransport(){return!(!this.pcManager||this.pcManager.currentState!==Be.CONNECTED||!this.client.ws||this.client.ws.readyState===WebSocket.CLOSED)}negotiate(){return S(this,void 0,void 0,function*(){return new Tt((e,n)=>S(this,void 0,void 0,function*(){if(!this.pcManager){n(new Is("PC manager is closed"));return}this.pcManager.requirePublisher(),this.pcManager.publisher.getTransceivers().length==0&&!this.lossyDC&&!this.reliableDC&&this.createDataChannels();const i=new AbortController,a=()=>{i.abort(),this.log.debug("engine disconnected while negotiation was ongoing",this.logContext),e()};this.isClosed&&n(new Is("cannot negotiate on closed engine")),this.on(F.Closing,a),this.pcManager.publisher.once(zs.RTPVideoPayloadTypes,s=>{const r=new Map;s.forEach(o=>{const l=o.codec.toLowerCase();zD(l)&&r.set(o.payload,l)}),this.emit(F.RTPVideoMapUpdate,r)});try{yield this.pcManager.negotiate(i),e()}catch(s){s instanceof Is&&(this.fullReconnectOnNext=!0),this.handleDisconnect("negotiation",Da.RR_UNKNOWN),s instanceof Error?n(s):n(new Error(String(s)))}finally{this.off(F.Closing,a)}}))})}dataChannelForKind(e,n){if(n){if(e===ae.LOSSY)return this.lossyDCSub;if(e===ae.RELIABLE)return this.reliableDCSub}else{if(e===ae.LOSSY)return this.lossyDC;if(e===ae.RELIABLE)return this.reliableDC}}sendSyncState(e,n){var i,a,s,r;if(!this.pcManager){this.log.warn("sync state cannot be sent without peer connection setup",this.logContext);return}const o=this.pcManager.publisher.getLocalDescription(),l=this.pcManager.publisher.getRemoteDescription(),c=(i=this.pcManager.subscriber)===null||i===void 0?void 0:i.getRemoteDescription(),u=(a=this.pcManager.subscriber)===null||a===void 0?void 0:a.getLocalDescription(),d=(r=(s=this.signalOpts)===null||s===void 0?void 0:s.autoSubscribe)!==null&&r!==void 0?r:!0,f=new Array,h=new Array;e.forEach(g=>{g.isDesired!==d&&f.push(g.trackSid),g.isEnabled||h.push(g.trackSid)}),this.client.sendSyncState(new zm({answer:this.pcManager.mode==="publisher-only"?l?Rs({sdp:l.sdp,type:l.type}):void 0:u?Rs({sdp:u.sdp,type:u.type}):void 0,offer:this.pcManager.mode==="publisher-only"?o?Rs({sdp:o.sdp,type:o.type}):void 0:c?Rs({sdp:c.sdp,type:c.type}):void 0,subscription:new mu({trackSids:f,subscribe:!d,participantTracks:[]}),publishTracks:ED(n),dataChannels:this.dataChannelsInfo(),trackSidsDisabled:h,datachannelReceiveStates:this.reliableReceivedState.map((g,y)=>new pC({publisherSid:y,lastSeq:g}))}))}failNext(){this.shouldFailNext=!0}dataChannelsInfo(){const e=[],n=(i,a)=>{(i==null?void 0:i.id)!==void 0&&i.id!==null&&e.push(new gC({label:i.label,id:i.id,target:a}))};return n(this.dataChannelForKind(ae.LOSSY),wn.PUBLISHER),n(this.dataChannelForKind(ae.RELIABLE),wn.PUBLISHER),n(this.dataChannelForKind(ae.LOSSY,!0),wn.SUBSCRIBER),n(this.dataChannelForKind(ae.RELIABLE,!0),wn.SUBSCRIBER),e}clearReconnectTimeout(){this.reconnectTimeout&&vt.clearTimeout(this.reconnectTimeout)}clearPendingReconnect(){this.clearReconnectTimeout(),this.reconnectAttempts=0}registerOnLineListener(){Ut()&&(window.addEventListener("online",this.handleBrowserOnLine),window.addEventListener("offline",this.handleBrowserOffline))}deregisterOnLineListener(){Ut()&&(window.removeEventListener("online",this.handleBrowserOnLine),window.removeEventListener("offline",this.handleBrowserOffline))}getTrackIdForReceiver(e){var n;const i=(n=this.pcManager)===null||n===void 0?void 0:n.getMidForReceiver(e);if(i){const a=Object.entries(this.midToTrackId).find(s=>{let[r]=s;return r===i});if(a)return a[1]}}}function XN(t){return t!==void 0&&t>13}function v0(t,e){const n=t.participantIdentity?t.participantIdentity:e.participantIdentity;t.participantIdentity=n,e.participantIdentity=n;const i=t.destinationIdentities.length!==0?t.destinationIdentities:e.destinationIdentities;t.destinationIdentities=i,e.destinationIdentities=i}class hk{get info(){return this._info}validateBytesReceived(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!(typeof this.totalByteSize!="number"||this.totalByteSize===0)){if(e&&this.bytesReceived<this.totalByteSize)throw new nn("Not enough chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, only received ").concat(this.bytesReceived," bytes"),Et.Incomplete);if(this.bytesReceived>this.totalByteSize)throw new nn("Extra chunk(s) received - expected ".concat(this.totalByteSize," bytes of data total, received ").concat(this.bytesReceived," bytes"),Et.LengthExceeded)}}constructor(e,n,i,a){this.reader=n,this.totalByteSize=i,this._info=e,this.bytesReceived=0,this.outOfBandFailureRejectingFuture=a}}class ZN extends hk{handleChunkReceived(e){var n;this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const i=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,i)}[Symbol.asyncIterator](){const e=this.reader.getReader();let n=new hn,i=null,a=null;if(this.signal){const r=this.signal;a=()=>{var o;(o=n.reject)===null||o===void 0||o.call(n,r.reason)},r.addEventListener("abort",a),i=r}const s=()=>{e.releaseLock(),i&&a&&i.removeEventListener("abort",a),this.signal=void 0};return{next:()=>S(this,void 0,void 0,function*(){var r,o;try{const{done:l,value:c}=yield Promise.race([e.read(),n.promise,(o=(r=this.outOfBandFailureRejectingFuture)===null||r===void 0?void 0:r.promise)!==null&&o!==void 0?o:new Promise(()=>{})]);return l?(this.validateBytesReceived(!0),{done:!0,value:void 0}):(this.handleChunkReceived(c),{done:!1,value:c.content})}catch(l){throw s(),l}}),return(){return S(this,void 0,void 0,function*(){return s(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,a,s,r;let o=new Set;const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=ui(l),d;d=yield u.next(),i=d.done,!i;c=!0){r=d.value,c=!1;const f=r;o.add(f)}}catch(f){a={error:f}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(a)throw a.error}}return Array.from(o)}()})}}class WN extends hk{constructor(e,n,i,a){super(e,n,i,a),this.receivedChunks=new Map}handleChunkReceived(e){var n;const i=Ql(e.chunkIndex),a=this.receivedChunks.get(i);if(a&&a.version>e.version)return;this.receivedChunks.set(i,e),this.bytesReceived+=e.content.byteLength,this.validateBytesReceived();const s=this.totalByteSize?this.bytesReceived/this.totalByteSize:void 0;(n=this.onProgress)===null||n===void 0||n.call(this,s)}[Symbol.asyncIterator](){const e=this.reader.getReader(),n=new TextDecoder("utf-8",{fatal:!0});let i=new hn,a=null,s=null;if(this.signal){const o=this.signal;s=()=>{var l;(l=i.reject)===null||l===void 0||l.call(i,o.reason)},o.addEventListener("abort",s),a=o}const r=()=>{e.releaseLock(),a&&s&&a.removeEventListener("abort",s),this.signal=void 0};return{next:()=>S(this,void 0,void 0,function*(){var o,l;try{const{done:c,value:u}=yield Promise.race([e.read(),i.promise,(l=(o=this.outOfBandFailureRejectingFuture)===null||o===void 0?void 0:o.promise)!==null&&l!==void 0?l:new Promise(()=>{})]);if(c)return this.validateBytesReceived(!0),{done:!0,value:void 0};{this.handleChunkReceived(u);let d;try{d=n.decode(u.content)}catch(f){throw new nn("Cannot decode datastream chunk ".concat(u.chunkIndex," as text: ").concat(f),Et.DecodeFailed)}return{done:!1,value:d}}}catch(c){throw r(),c}}),return(){return S(this,void 0,void 0,function*(){return r(),{done:!0,value:void 0}})}}}withAbortSignal(e){return this.signal=e,this}readAll(){return S(this,arguments,void 0,function(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function*(){var i,a,s,r;let o="";const l=n.signal?e.withAbortSignal(n.signal):e;try{for(var c=!0,u=ui(l),d;d=yield u.next(),i=d.done,!i;c=!0)r=d.value,c=!1,o+=r}catch(f){a={error:f}}finally{try{!c&&!i&&(s=u.return)&&(yield s.call(u))}finally{if(a)throw a.error}}return o}()})}}class $N{constructor(){this.log=ie,this.byteStreamControllers=new Map,this.textStreamControllers=new Map,this.byteStreamHandlers=new Map,this.textStreamHandlers=new Map}registerTextStreamHandler(e,n){if(this.textStreamHandlers.has(e))throw new nn('A text stream handler for topic "'.concat(e,'" has already been set.'),Et.HandlerAlreadyRegistered);this.textStreamHandlers.set(e,n)}unregisterTextStreamHandler(e){this.textStreamHandlers.delete(e)}registerByteStreamHandler(e,n){if(this.byteStreamHandlers.has(e))throw new nn('A byte stream handler for topic "'.concat(e,'" has already been set.'),Et.HandlerAlreadyRegistered);this.byteStreamHandlers.set(e,n)}unregisterByteStreamHandler(e){this.byteStreamHandlers.delete(e)}clearControllers(){this.byteStreamControllers.clear(),this.textStreamControllers.clear()}validateParticipantHasNoActiveDataStreams(e){var n,i,a,s;const r=Array.from(this.textStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e),o=Array.from(this.byteStreamControllers.entries()).filter(l=>l[1].sendingParticipantIdentity===e);if(r.length>0||o.length>0){const l=new nn("Participant ".concat(e," unexpectedly disconnected in the middle of sending data"),Et.AbnormalEnd);for(const[c,u]of o)(i=(n=u.outOfBandFailureRejectingFuture).reject)===null||i===void 0||i.call(n,l),this.byteStreamControllers.delete(c);for(const[c,u]of r)(s=(a=u.outOfBandFailureRejectingFuture).reject)===null||s===void 0||s.call(a,l),this.textStreamControllers.delete(c)}}handleDataStreamPacket(e,n){return S(this,void 0,void 0,function*(){switch(e.value.case){case"streamHeader":return this.handleStreamHeader(e.value.value,e.participantIdentity,n);case"streamChunk":return this.handleStreamChunk(e.value.value,n);case"streamTrailer":return this.handleStreamTrailer(e.value.value,n);default:throw new Error('DataPacket of value "'.concat(e.value.case,'" is not data stream related!'))}})}handleStreamHeader(e,n,i){return S(this,void 0,void 0,function*(){var a;if(e.contentHeader.case==="byteHeader"){const s=this.byteStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming byte stream due to no handler for topic",e.topic);return}let r;const o=new hn;o.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,name:(a=e.contentHeader.value.name)!==null&&a!==void 0?a:"unknown",mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Ql(e.timestamp),attributes:e.attributes,encryptionType:i},c=new ReadableStream({start:u=>{if(r=u,this.textStreamControllers.has(e.streamId))throw new nn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Et.AlreadyOpened);this.byteStreamControllers.set(e.streamId,{info:l,controller:r,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:o})}});s(new ZN(l,c,Ql(e.totalLength),o),{identity:n})}else if(e.contentHeader.case==="textHeader"){const s=this.textStreamHandlers.get(e.topic);if(!s){this.log.debug("ignoring incoming text stream due to no handler for topic",e.topic);return}let r;const o=new hn;o.promise.catch(u=>{this.log.error(u)});const l={id:e.streamId,mimeType:e.mimeType,size:e.totalLength?Number(e.totalLength):void 0,topic:e.topic,timestamp:Number(e.timestamp),attributes:e.attributes,encryptionType:i,attachedStreamIds:e.contentHeader.value.attachedStreamIds},c=new ReadableStream({start:u=>{if(r=u,this.textStreamControllers.has(e.streamId))throw new nn("A data stream read is already in progress for a stream with id ".concat(e.streamId,"."),Et.AlreadyOpened);this.textStreamControllers.set(e.streamId,{info:l,controller:r,startTime:Date.now(),sendingParticipantIdentity:n,outOfBandFailureRejectingFuture:o})}});s(new WN(l,c,Ql(e.totalLength),o),{identity:n})}})}handleStreamChunk(e,n){const i=this.byteStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?(i.controller.error(new nn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Et.EncryptionTypeMismatch)),this.byteStreamControllers.delete(e.streamId)):e.content.length>0&&i.controller.enqueue(e));const a=this.textStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==n?(a.controller.error(new nn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(a.info.encryptionType),Et.EncryptionTypeMismatch)),this.textStreamControllers.delete(e.streamId)):e.content.length>0&&a.controller.enqueue(e))}handleStreamTrailer(e,n){const i=this.textStreamControllers.get(e.streamId);i&&(i.info.encryptionType!==n?i.controller.error(new nn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(i.info.encryptionType),Et.EncryptionTypeMismatch)):(i.info.attributes=Object.assign(Object.assign({},i.info.attributes),e.attributes),i.controller.close(),this.textStreamControllers.delete(e.streamId)));const a=this.byteStreamControllers.get(e.streamId);a&&(a.info.encryptionType!==n?a.controller.error(new nn("Encryption type mismatch for stream ".concat(e.streamId,". Expected ").concat(n,", got ").concat(a.info.encryptionType),Et.EncryptionTypeMismatch)):(a.info.attributes=Object.assign(Object.assign({},a.info.attributes),e.attributes),a.controller.close()),this.byteStreamControllers.delete(e.streamId))}}class mk{constructor(e,n,i){this.writableStream=e,this.defaultWriter=e.getWriter(),this.onClose=i,this.info=n}write(e){return this.defaultWriter.write(e)}close(){return S(this,void 0,void 0,function*(){var e;yield this.defaultWriter.close(),this.defaultWriter.releaseLock(),(e=this.onClose)===null||e===void 0||e.call(this)})}}class e2 extends mk{}class t2 extends mk{}const b0=15e3;class n2{constructor(e,n){this.engine=e,this.log=n}setupEngine(e){this.engine=e}sendText(e,n){return S(this,void 0,void 0,function*(){var i;const a=crypto.randomUUID(),r=new TextEncoder().encode(e).byteLength,o=(i=n==null?void 0:n.attachments)===null||i===void 0?void 0:i.map(()=>crypto.randomUUID()),l=new Array(o?o.length+1:1).fill(0),c=(d,f)=>{var h;l[f]=d;const g=l.reduce((y,T)=>y+T,0);(h=n==null?void 0:n.onProgress)===null||h===void 0||h.call(n,g)},u=yield this.streamText({streamId:a,totalSize:r,destinationIdentities:n==null?void 0:n.destinationIdentities,topic:n==null?void 0:n.topic,attachedStreamIds:o,attributes:n==null?void 0:n.attributes});return yield u.write(e),c(1,0),yield u.close(),n!=null&&n.attachments&&o&&(yield Promise.all(n.attachments.map((d,f)=>S(this,void 0,void 0,function*(){return this._sendFile(o[f],d,{topic:n.topic,mimeType:d.type,onProgress:h=>{c(h,f+1)}})})))),u.info})}streamText(e){return S(this,void 0,void 0,function*(){var n,i,a;const s=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),r={id:s,mimeType:"text/plain",timestamp:Date.now(),topic:(i=e==null?void 0:e.topic)!==null&&i!==void 0?i:"",size:e==null?void 0:e.totalSize,attributes:e==null?void 0:e.attributes,encryptionType:!((a=this.engine.e2eeManager)===null||a===void 0)&&a.isDataChannelEncryptionEnabled?Ke.GCM:Ke.NONE,attachedStreamIds:e==null?void 0:e.attachedStreamIds},o=new Dc({streamId:s,mimeType:r.mimeType,topic:r.topic,timestamp:Na(r.timestamp),totalLength:Na(e==null?void 0:e.totalSize),attributes:r.attributes,contentHeader:{case:"textHeader",value:new aC({version:e==null?void 0:e.version,attachedStreamIds:r.attachedStreamIds,replyToStreamId:e==null?void 0:e.replyToStreamId,operationType:(e==null?void 0:e.type)==="update"?Bf.UPDATE:Bf.CREATE})}}),l=e==null?void 0:e.destinationIdentities,c=new _t({destinationIdentities:l,value:{case:"streamHeader",value:o}});yield this.engine.sendDataPacket(c,ae.RELIABLE);let u=0;const d=this.engine,f=new WritableStream({write(y){return S(this,void 0,void 0,function*(){for(const T of YD(y,b0)){const m=new Nc({content:T,streamId:s,chunkIndex:Na(u)}),p=new _t({destinationIdentities:l,value:{case:"streamChunk",value:m}});yield d.sendDataPacket(p,ae.RELIABLE),u+=1}})},close(){return S(this,void 0,void 0,function*(){const y=new Pc({streamId:s}),T=new _t({destinationIdentities:l,value:{case:"streamTrailer",value:y}});yield d.sendDataPacket(T,ae.RELIABLE)})},abort(y){console.log("Sink error:",y)}});let h=()=>S(this,void 0,void 0,function*(){yield g.close()});d.once(F.Closing,h);const g=new e2(f,r,()=>this.engine.off(F.Closing,h));return g})}sendFile(e,n){return S(this,void 0,void 0,function*(){const i=crypto.randomUUID();return yield this._sendFile(i,e,n),{id:i}})}_sendFile(e,n,i){return S(this,void 0,void 0,function*(){var a;const s=yield this.streamBytes({streamId:e,totalSize:n.size,name:n.name,mimeType:(a=i==null?void 0:i.mimeType)!==null&&a!==void 0?a:n.type,topic:i==null?void 0:i.topic,destinationIdentities:i==null?void 0:i.destinationIdentities}),r=n.stream().getReader();for(;;){const{done:o,value:l}=yield r.read();if(o)break;yield s.write(l)}return yield s.close(),s.info})}streamBytes(e){return S(this,void 0,void 0,function*(){var n,i,a,s,r,o;const l=(n=e==null?void 0:e.streamId)!==null&&n!==void 0?n:crypto.randomUUID(),c=e==null?void 0:e.destinationIdentities,u={id:l,mimeType:(i=e==null?void 0:e.mimeType)!==null&&i!==void 0?i:"application/octet-stream",topic:(a=e==null?void 0:e.topic)!==null&&a!==void 0?a:"",timestamp:Date.now(),attributes:e==null?void 0:e.attributes,size:e==null?void 0:e.totalSize,name:(s=e==null?void 0:e.name)!==null&&s!==void 0?s:"unknown",encryptionType:!((r=this.engine.e2eeManager)===null||r===void 0)&&r.isDataChannelEncryptionEnabled?Ke.GCM:Ke.NONE},d=new Dc({totalLength:Na((o=u.size)!==null&&o!==void 0?o:0),mimeType:u.mimeType,streamId:l,topic:u.topic,timestamp:Na(Date.now()),attributes:u.attributes,contentHeader:{case:"byteHeader",value:new sC({name:u.name})}}),f=new _t({destinationIdentities:c,value:{case:"streamHeader",value:d}});yield this.engine.sendDataPacket(f,ae.RELIABLE);let h=0;const g=new xt,y=this.engine,T=this.log,m=new WritableStream({write(v){return S(this,void 0,void 0,function*(){const b=yield g.lock();let C=0;try{for(;C<v.byteLength;){const _=v.slice(C,C+b0),w=new _t({destinationIdentities:c,value:{case:"streamChunk",value:new Nc({content:_,streamId:l,chunkIndex:Na(h)})}});yield y.sendDataPacket(w,ae.RELIABLE),h+=1,C+=_.byteLength}}finally{b()}})},close(){return S(this,void 0,void 0,function*(){const v=new Pc({streamId:l}),b=new _t({destinationIdentities:c,value:{case:"streamTrailer",value:v}});yield y.sendDataPacket(b,ae.RELIABLE)})},abort(v){T.error("Sink error:",v)}});return new t2(m,u)})}}class pk extends U{constructor(e,n,i,a,s){super(e,i,s),this.sid=n,this.receiver=a}get isLocal(){return!1}setMuted(e){this.isMuted!==e&&(this.isMuted=e,this._mediaStreamTrack.enabled=!e,this.emit(e?B.Muted:B.Unmuted,this))}setMediaStream(e){this.mediaStream=e;const n=i=>{i.track===this._mediaStreamTrack&&(e.removeEventListener("removetrack",n),this.receiver&&"playoutDelayHint"in this.receiver&&(this.receiver.playoutDelayHint=void 0),this.receiver=void 0,this._currentBitrate=0,this.emit(B.Ended,this))};e.addEventListener("removetrack",n)}start(){this.startMonitor(),super.enable()}stop(){this.stopMonitor(),super.disable()}getRTCStatsReport(){return S(this,void 0,void 0,function*(){var e;return!((e=this.receiver)===null||e===void 0)&&e.getStats?yield this.receiver.getStats():void 0})}setPlayoutDelay(e){this.receiver?"playoutDelayHint"in this.receiver?this.receiver.playoutDelayHint=e:this.log.warn("Playout delay not supported in this browser"):this.log.warn("Cannot set playout delay, track already ended")}getPlayoutDelay(){if(this.receiver){if("playoutDelayHint"in this.receiver)return this.receiver.playoutDelayHint;this.log.warn("Playout delay not supported in this browser")}else this.log.warn("Cannot get playout delay, track already ended");return 0}startMonitor(){this.monitorInterval||(this.monitorInterval=setInterval(()=>this.monitorReceiver(),tp)),_D()&&this.registerTimeSyncUpdate()}registerTimeSyncUpdate(){const e=()=>{var n;this.timeSyncHandle=requestAnimationFrame(()=>e());const i=(n=this.receiver)===null||n===void 0?void 0:n.getSynchronizationSources()[0];if(i){const{timestamp:a,rtpTimestamp:s}=i;s&&this.rtpTimestamp!==s&&(this.emit(B.TimeSyncUpdate,{timestamp:a,rtpTimestamp:s}),this.rtpTimestamp=s)}};e()}}class i2 extends pk{constructor(e,n,i,a,s,r){super(e,n,U.Kind.Audio,i,r),this.monitorReceiver=()=>S(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const o=yield this.getReceiverStats();o&&this.prevStats&&this.receiver&&(this._currentBitrate=vu(o,this.prevStats)),this.prevStats=o}),this.audioContext=a,this.webAudioPluginNodes=[],s&&(this.sinkId=s.deviceId)}setVolume(e){var n;for(const i of this.attachedElements)this.audioContext?(n=this.gainNode)===null||n===void 0||n.gain.setTargetAtTime(e,0,.1):i.volume=e;Kn()&&this._mediaStreamTrack._setVolume(e),this.elementVolume=e}getVolume(){if(this.elementVolume)return this.elementVolume;if(Kn())return 1;let e=0;return this.attachedElements.forEach(n=>{n.volume>e&&(e=n.volume)}),e}setSinkId(e){return S(this,void 0,void 0,function*(){this.sinkId=e,yield Promise.all(this.attachedElements.map(n=>{if(nh(n))return n.setSinkId(e)}))})}attach(e){const n=this.attachedElements.length===0;return e?super.attach(e):e=super.attach(),this.sinkId&&nh(e)&&e.setSinkId(this.sinkId).catch(i=>{this.log.error("Failed to set sink id on remote audio track",i,this.logContext)}),this.audioContext&&n&&(this.log.debug("using audio context mapping",this.logContext),this.connectWebAudio(this.audioContext,e),e.volume=0,e.muted=!0),this.elementVolume&&this.setVolume(this.elementVolume),e}detach(e){let n;return e?(n=super.detach(e),this.audioContext&&(this.attachedElements.length>0?this.connectWebAudio(this.audioContext,this.attachedElements[0]):this.disconnectWebAudio())):(n=super.detach(),this.disconnectWebAudio()),n}setAudioContext(e){this.audioContext=e,e&&this.attachedElements.length>0?this.connectWebAudio(e,this.attachedElements[0]):e||this.disconnectWebAudio()}setWebAudioPlugins(e){this.webAudioPluginNodes=e,this.attachedElements.length>0&&this.audioContext&&this.connectWebAudio(this.audioContext,this.attachedElements[0])}connectWebAudio(e,n){this.disconnectWebAudio(),this.sourceNode=e.createMediaStreamSource(n.srcObject);let i=this.sourceNode;this.webAudioPluginNodes.forEach(a=>{i.connect(a),i=a}),this.gainNode=e.createGain(),i.connect(this.gainNode),this.gainNode.connect(e.destination),this.elementVolume&&this.gainNode.gain.setTargetAtTime(this.elementVolume,0,.1),e.state!=="running"&&e.resume().then(()=>{e.state!=="running"&&this.emit(B.AudioPlaybackFailed,new Error("Audio Context couldn't be started automatically"))}).catch(a=>{this.emit(B.AudioPlaybackFailed,a)})}disconnectWebAudio(){var e,n;(e=this.gainNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.gainNode=void 0,this.sourceNode=void 0}getReceiverStats(){return S(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n;return e.forEach(i=>{i.type==="inbound-rtp"&&(n={type:"audio",streamId:i.id,timestamp:i.timestamp,jitter:i.jitter,bytesReceived:i.bytesReceived,concealedSamples:i.concealedSamples,concealmentEvents:i.concealmentEvents,silentConcealedSamples:i.silentConcealedSamples,silentConcealmentEvents:i.silentConcealmentEvents,totalAudioEnergy:i.totalAudioEnergy,totalSamplesDuration:i.totalSamplesDuration})}),n})}}const Nd=100;class a2 extends pk{constructor(e,n,i,a,s){super(e,n,U.Kind.Video,i,s),this.elementInfos=[],this.monitorReceiver=()=>S(this,void 0,void 0,function*(){if(!this.receiver){this._currentBitrate=0;return}const r=yield this.getReceiverStats();r&&this.prevStats&&this.receiver&&(this._currentBitrate=vu(r,this.prevStats)),this.prevStats=r}),this.debouncedHandleResize=Zm(()=>{this.updateDimensions()},Nd),this.adaptiveStreamSettings=a}get isAdaptiveStream(){return this.adaptiveStreamSettings!==void 0}setStreamState(e){super.setStreamState(e),this.log.debug("setStreamState",e),this.isAdaptiveStream&&e===U.StreamState.Active&&this.updateVisibility()}get mediaStreamTrack(){return this._mediaStreamTrack}setMuted(e){super.setMuted(e),this.attachedElements.forEach(n=>{e?js(this._mediaStreamTrack,n):_s(this._mediaStreamTrack,n)})}attach(e){if(e?super.attach(e):e=super.attach(),this.adaptiveStreamSettings&&this.elementInfos.find(n=>n.element===e)===void 0){const n=new s2(e);this.observeElementInfo(n)}return e}observeElementInfo(e){this.adaptiveStreamSettings&&this.elementInfos.find(n=>n===e)===void 0?(e.handleResize=()=>{this.debouncedHandleResize()},e.handleVisibilityChanged=()=>{this.updateVisibility()},this.elementInfos.push(e),e.observe(),this.debouncedHandleResize(),this.updateVisibility()):this.log.warn("visibility resize observer not triggered",this.logContext)}stopObservingElementInfo(e){if(!this.isAdaptiveStream){this.log.warn("stopObservingElementInfo ignored",this.logContext);return}const n=this.elementInfos.filter(i=>i===e);for(const i of n)i.stopObserving();this.elementInfos=this.elementInfos.filter(i=>i!==e),this.updateVisibility(),this.debouncedHandleResize()}detach(e){let n=[];if(e)return this.stopObservingElement(e),super.detach(e);n=super.detach();for(const i of n)this.stopObservingElement(i);return n}getDecoderImplementation(){var e;return(e=this.prevStats)===null||e===void 0?void 0:e.decoderImplementation}getReceiverStats(){return S(this,void 0,void 0,function*(){if(!this.receiver||!this.receiver.getStats)return;const e=yield this.receiver.getStats();let n,i="",a=new Map;return e.forEach(s=>{s.type==="inbound-rtp"?(i=s.codecId,n={type:"video",streamId:s.id,framesDecoded:s.framesDecoded,framesDropped:s.framesDropped,framesReceived:s.framesReceived,packetsReceived:s.packetsReceived,packetsLost:s.packetsLost,frameWidth:s.frameWidth,frameHeight:s.frameHeight,pliCount:s.pliCount,firCount:s.firCount,nackCount:s.nackCount,jitter:s.jitter,timestamp:s.timestamp,bytesReceived:s.bytesReceived,decoderImplementation:s.decoderImplementation}):s.type==="codec"&&a.set(s.id,s)}),n&&i!==""&&a.get(i)&&(n.mimeType=a.get(i).mimeType),n})}stopObservingElement(e){const n=this.elementInfos.filter(i=>i.element===e);for(const i of n)this.stopObservingElementInfo(i)}handleAppVisibilityChanged(){const e=Object.create(null,{handleAppVisibilityChanged:{get:()=>super.handleAppVisibilityChanged}});return S(this,void 0,void 0,function*(){yield e.handleAppVisibilityChanged.call(this),this.isAdaptiveStream&&this.updateVisibility()})}updateVisibility(e){var n,i;const a=this.elementInfos.reduce((l,c)=>Math.max(l,c.visibilityChangedAt||0),0),s=!((i=(n=this.adaptiveStreamSettings)===null||n===void 0?void 0:n.pauseVideoInBackground)!==null&&i!==void 0)||i?this.isInBackground:!1,r=this.elementInfos.some(l=>l.pictureInPicture),o=this.elementInfos.some(l=>l.visible)&&!s||r;if(!(this.lastVisible===o&&!e)){if(!o&&Date.now()-a<Nd){vt.setTimeout(()=>{this.updateVisibility()},Nd);return}this.lastVisible=o,this.emit(B.VisibilityChanged,o,this)}}updateDimensions(){var e,n;let i=0,a=0;const s=this.getPixelDensity();for(const r of this.elementInfos){const o=r.width()*s,l=r.height()*s;o+l>i+a&&(i=o,a=l)}((e=this.lastDimensions)===null||e===void 0?void 0:e.width)===i&&((n=this.lastDimensions)===null||n===void 0?void 0:n.height)===a||(this.lastDimensions={width:i,height:a},this.emit(B.VideoDimensionsChanged,this.lastDimensions,this))}getPixelDensity(){var e;const n=(e=this.adaptiveStreamSettings)===null||e===void 0?void 0:e.pixelDensity;return n==="screen"?Kv():n||(Kv()>2?2:1)}}class s2{get visible(){return this.isPiP||this.isIntersecting}get pictureInPicture(){return this.isPiP}constructor(e,n){this.onVisibilityChanged=i=>{var a;const{target:s,isIntersecting:r}=i;s===this.element&&(this.isIntersecting=r,this.isPiP=Mr(this.element),this.visibilityChangedAt=Date.now(),(a=this.handleVisibilityChanged)===null||a===void 0||a.call(this))},this.onEnterPiP=()=>{var i,a,s;(a=(i=window.documentPictureInPicture)===null||i===void 0?void 0:i.window)===null||a===void 0||a.addEventListener("pagehide",this.onLeavePiP),this.isPiP=Mr(this.element),(s=this.handleVisibilityChanged)===null||s===void 0||s.call(this)},this.onLeavePiP=()=>{var i;this.isPiP=Mr(this.element),(i=this.handleVisibilityChanged)===null||i===void 0||i.call(this)},this.element=e,this.isIntersecting=n??lh(e),this.isPiP=Ut()&&Mr(e),this.visibilityChangedAt=0}width(){return this.element.clientWidth}height(){return this.element.clientHeight}observe(){var e,n,i;this.isIntersecting=lh(this.element),this.isPiP=Mr(this.element),this.element.handleResize=()=>{var a;(a=this.handleResize)===null||a===void 0||a.call(this)},this.element.handleVisibilityChanged=this.onVisibilityChanged,Qv().observe(this.element),Yv().observe(this.element),this.element.addEventListener("enterpictureinpicture",this.onEnterPiP),this.element.addEventListener("leavepictureinpicture",this.onLeavePiP),(e=window.documentPictureInPicture)===null||e===void 0||e.addEventListener("enter",this.onEnterPiP),(i=(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window)===null||i===void 0||i.addEventListener("pagehide",this.onLeavePiP)}stopObserving(){var e,n,i,a,s;(e=Qv())===null||e===void 0||e.unobserve(this.element),(n=Yv())===null||n===void 0||n.unobserve(this.element),this.element.removeEventListener("enterpictureinpicture",this.onEnterPiP),this.element.removeEventListener("leavepictureinpicture",this.onLeavePiP),(i=window.documentPictureInPicture)===null||i===void 0||i.removeEventListener("enter",this.onEnterPiP),(s=(a=window.documentPictureInPicture)===null||a===void 0?void 0:a.window)===null||s===void 0||s.removeEventListener("pagehide",this.onLeavePiP)}}function Mr(t){var e,n;return document.pictureInPictureElement===t?!0:!((e=window.documentPictureInPicture)===null||e===void 0)&&e.window?lh(t,(n=window.documentPictureInPicture)===null||n===void 0?void 0:n.window):!1}function lh(t,e){const n=e||window;let i=t.offsetTop,a=t.offsetLeft;const s=t.offsetWidth,r=t.offsetHeight,{hidden:o}=t,{display:l}=getComputedStyle(t);for(;t.offsetParent;)t=t.offsetParent,i+=t.offsetTop,a+=t.offsetLeft;return i<n.pageYOffset+n.innerHeight&&a<n.pageXOffset+n.innerWidth&&i+r>n.pageYOffset&&a+s>n.pageXOffset&&!o&&l!=="none"}class ri extends Zn.EventEmitter{constructor(e,n,i,a){var s;super(),this.metadataMuted=!1,this.encryption=Ke.NONE,this.log=ie,this.handleMuted=()=>{this.emit(B.Muted)},this.handleUnmuted=()=>{this.emit(B.Unmuted)},this.log=xi((s=a==null?void 0:a.loggerName)!==null&&s!==void 0?s:Dn.Publication),this.loggerContextCb=this.loggerContextCb,this.setMaxListeners(100),this.kind=e,this.trackSid=n,this.trackName=i,this.source=U.Source.Unknown}setTrack(e){this.track&&(this.track.off(B.Muted,this.handleMuted),this.track.off(B.Unmuted,this.handleUnmuted)),this.track=e,e&&(e.on(B.Muted,this.handleMuted),e.on(B.Unmuted,this.handleUnmuted))}get logContext(){var e;return Object.assign(Object.assign({},(e=this.loggerContextCb)===null||e===void 0?void 0:e.call(this)),se(this))}get isMuted(){return this.metadataMuted}get isEnabled(){return!0}get isSubscribed(){return this.track!==void 0}get isEncrypted(){return this.encryption!==Ke.NONE}get audioTrack(){if(Hn(this.track))return this.track}get videoTrack(){if(Ca(this.track))return this.track}updateInfo(e){this.trackSid=e.sid,this.trackName=e.name,this.source=U.sourceFromProto(e.source),this.mimeType=e.mimeType,this.kind===U.Kind.Video&&e.width>0&&(this.dimensions={width:e.width,height:e.height},this.simulcasted=e.simulcast),this.encryption=e.encryption,this.trackInfo=e,this.log.debug("update publication info",Object.assign(Object.assign({},this.logContext),{info:e}))}}(function(t){(function(e){e.Desired="desired",e.Subscribed="subscribed",e.Unsubscribed="unsubscribed"})(t.SubscriptionStatus||(t.SubscriptionStatus={})),function(e){e.Allowed="allowed",e.NotAllowed="not_allowed"}(t.PermissionStatus||(t.PermissionStatus={}))})(ri||(ri={}));class ch extends ri{get isUpstreamPaused(){var e;return(e=this.track)===null||e===void 0?void 0:e.isUpstreamPaused}constructor(e,n,i,a){super(e,n.sid,n.name,a),this.track=void 0,this.handleTrackEnded=()=>{this.emit(B.Ended)},this.handleCpuConstrained=()=>{this.track&&Ca(this.track)&&this.emit(B.CpuConstrained,this.track)},this.updateInfo(n),this.setTrack(i)}setTrack(e){this.track&&(this.track.off(B.Ended,this.handleTrackEnded),this.track.off(B.CpuConstrained,this.handleCpuConstrained)),super.setTrack(e),e&&(e.on(B.Ended,this.handleTrackEnded),e.on(B.CpuConstrained,this.handleCpuConstrained))}get isMuted(){return this.track?this.track.isMuted:super.isMuted}get audioTrack(){return super.audioTrack}get videoTrack(){return super.videoTrack}get isLocal(){return!0}mute(){return S(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.mute()})}unmute(){return S(this,void 0,void 0,function*(){var e;return(e=this.track)===null||e===void 0?void 0:e.unmute()})}pauseUpstream(){return S(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.pauseUpstream()})}resumeUpstream(){return S(this,void 0,void 0,function*(){var e;yield(e=this.track)===null||e===void 0?void 0:e.resumeUpstream()})}getTrackFeatures(){var e;if(Hn(this.track)){const n=this.track.getSourceTrackSettings(),i=new Set;return n.autoGainControl&&i.add(lt.TF_AUTO_GAIN_CONTROL),n.echoCancellation&&i.add(lt.TF_ECHO_CANCELLATION),n.noiseSuppression&&i.add(lt.TF_NOISE_SUPPRESSION),n.channelCount&&n.channelCount>1&&i.add(lt.TF_STEREO),!((e=this.options)===null||e===void 0)&&e.dtx||i.add(lt.TF_NO_DTX),this.track.enhancedNoiseCancellation&&i.add(lt.TF_ENHANCED_NOISE_CANCELLATION),Array.from(i.values())}else return[]}}function bu(t,e){return S(this,void 0,void 0,function*(){t??(t={});let n=!1;const{audioProcessor:i,videoProcessor:a,optionsWithoutProcessor:s}=tk(t);let r=s.audio,o=s.video;if(i&&typeof s.audio=="object"&&(s.audio.processor=i),a&&typeof s.video=="object"&&(s.video.processor=a),t.audio&&typeof s.audio=="object"&&typeof s.audio.deviceId=="string"){const d=s.audio.deviceId;s.audio.deviceId={exact:d},n=!0,r=Object.assign(Object.assign({},s.audio),{deviceId:{ideal:d}})}if(s.video&&typeof s.video=="object"&&typeof s.video.deviceId=="string"){const d=s.video.deviceId;s.video.deviceId={exact:d},n=!0,o=Object.assign(Object.assign({},s.video),{deviceId:{ideal:d}})}s.audio===!0?s.audio={deviceId:"default"}:typeof s.audio=="object"&&s.audio!==null&&(s.audio=Object.assign(Object.assign({},s.audio),{deviceId:s.audio.deviceId||"default"})),s.video===!0?s.video={deviceId:"default"}:typeof s.video=="object"&&!s.video.deviceId&&(s.video.deviceId="default");const l=WC(s,rk,ok),c=Ym(l),u=navigator.mediaDevices.getUserMedia(c);s.audio&&(ut.userMediaPromiseMap.set("audioinput",u),u.catch(()=>ut.userMediaPromiseMap.delete("audioinput"))),s.video&&(ut.userMediaPromiseMap.set("videoinput",u),u.catch(()=>ut.userMediaPromiseMap.delete("videoinput")));try{const d=yield u;return yield Promise.all(d.getTracks().map(f=>S(this,void 0,void 0,function*(){const h=f.kind==="audio";let g=h?l.audio:l.video;(typeof g=="boolean"||!g)&&(g={});let y;const T=h?c.audio:c.video;typeof T!="boolean"&&(y=T);const m=f.getSettings().deviceId;y!=null&&y.deviceId&&la(y.deviceId)!==m?y.deviceId=m:y||(y={deviceId:m});const p=NN(f,y,e);return p.kind===U.Kind.Video?p.source=U.Source.Camera:p.kind===U.Kind.Audio&&(p.source=U.Source.Microphone),p.mediaStream=d,Hn(p)&&i?yield p.setProcessor(i):Ca(p)&&a&&(yield p.setProcessor(a)),p})))}catch(d){if(!n)throw d;return bu(Object.assign(Object.assign({},t),{audio:r,video:o}),e)}})}function r2(t){return S(this,void 0,void 0,function*(){return(yield bu({audio:!1,video:!0}))[0]})}function o2(t){return S(this,void 0,void 0,function*(){return(yield bu({audio:!0,video:!1}))[0]})}var Hi;(function(t){t.Excellent="excellent",t.Good="good",t.Poor="poor",t.Lost="lost",t.Unknown="unknown"})(Hi||(Hi={}));function l2(t){switch(t){case Br.EXCELLENT:return Hi.Excellent;case Br.GOOD:return Hi.Good;case Br.POOR:return Hi.Poor;case Br.LOST:return Hi.Lost;default:return Hi.Unknown}}class gk extends Zn.EventEmitter{get logContext(){var e,n;return Object.assign({},(n=(e=this.loggerOptions)===null||e===void 0?void 0:e.loggerContextCb)===null||n===void 0?void 0:n.call(e))}get isEncrypted(){return this.trackPublications.size>0&&Array.from(this.trackPublications.values()).every(e=>e.isEncrypted)}get isAgent(){var e;return((e=this.permissions)===null||e===void 0?void 0:e.agent)||this.kind===Eo.AGENT}get isActive(){var e;return((e=this.participantInfo)===null||e===void 0?void 0:e.state)===Ps.ACTIVE}get kind(){return this._kind}get attributes(){return Object.freeze(Object.assign({},this._attributes))}constructor(e,n,i,a,s,r){let o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:Eo.STANDARD;var l;super(),this.audioLevel=0,this.isSpeaking=!1,this._connectionQuality=Hi.Unknown,this.log=ie,this.log=xi((l=r==null?void 0:r.loggerName)!==null&&l!==void 0?l:Dn.Participant),this.loggerOptions=r,this.setMaxListeners(100),this.sid=e,this.identity=n,this.name=i,this.metadata=a,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this._kind=o,this._attributes=s??{}}getTrackPublications(){return Array.from(this.trackPublications.values())}getTrackPublication(e){for(const[,n]of this.trackPublications)if(n.source===e)return n}getTrackPublicationByName(e){for(const[,n]of this.trackPublications)if(n.trackName===e)return n}waitUntilActive(){return this.isActive?Promise.resolve():this.activeFuture?this.activeFuture.promise:(this.activeFuture=new hn,this.once(V.Active,()=>{var e,n;(n=(e=this.activeFuture)===null||e===void 0?void 0:e.resolve)===null||n===void 0||n.call(e),this.activeFuture=void 0}),this.activeFuture.promise)}get connectionQuality(){return this._connectionQuality}get isCameraEnabled(){var e;const n=this.getTrackPublication(U.Source.Camera);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isMicrophoneEnabled(){var e;const n=this.getTrackPublication(U.Source.Microphone);return!(!((e=n==null?void 0:n.isMuted)!==null&&e!==void 0)||e)}get isScreenShareEnabled(){return!!this.getTrackPublication(U.Source.ScreenShare)}get isLocal(){return!1}get joinedAt(){return this.participantInfo?new Date(Number.parseInt(this.participantInfo.joinedAt.toString())*1e3):new Date}updateInfo(e){var n;return this.participantInfo&&this.participantInfo.sid===e.sid&&this.participantInfo.version>e.version?!1:(this.identity=e.identity,this.sid=e.sid,this._setName(e.name),this._setMetadata(e.metadata),this._setAttributes(e.attributes),e.state===Ps.ACTIVE&&((n=this.participantInfo)===null||n===void 0?void 0:n.state)!==Ps.ACTIVE&&this.emit(V.Active),e.permission&&this.setPermissions(e.permission),this.participantInfo=e,!0)}_setMetadata(e){const n=this.metadata!==e,i=this.metadata;this.metadata=e,n&&this.emit(V.ParticipantMetadataChanged,i)}_setName(e){const n=this.name!==e;this.name=e,n&&this.emit(V.ParticipantNameChanged,e)}_setAttributes(e){const n=RD(this.attributes,e);this._attributes=e,Object.keys(n).length>0&&this.emit(V.AttributesChanged,n)}setPermissions(e){var n,i,a,s,r,o;const l=this.permissions,c=e.canPublish!==((n=this.permissions)===null||n===void 0?void 0:n.canPublish)||e.canSubscribe!==((i=this.permissions)===null||i===void 0?void 0:i.canSubscribe)||e.canPublishData!==((a=this.permissions)===null||a===void 0?void 0:a.canPublishData)||e.hidden!==((s=this.permissions)===null||s===void 0?void 0:s.hidden)||e.recorder!==((r=this.permissions)===null||r===void 0?void 0:r.recorder)||e.canPublishSources.length!==this.permissions.canPublishSources.length||e.canPublishSources.some((u,d)=>{var f;return u!==((f=this.permissions)===null||f===void 0?void 0:f.canPublishSources[d])})||e.canSubscribeMetrics!==((o=this.permissions)===null||o===void 0?void 0:o.canSubscribeMetrics);return this.permissions=e,c&&this.emit(V.ParticipantPermissionsChanged,l),c}setIsSpeaking(e){e!==this.isSpeaking&&(this.isSpeaking=e,e&&(this.lastSpokeAt=new Date),this.emit(V.IsSpeakingChanged,e))}setConnectionQuality(e){const n=this._connectionQuality;this._connectionQuality=l2(e),n!==this._connectionQuality&&this.emit(V.ConnectionQualityChanged,this._connectionQuality)}setDisconnected(){var e,n;this.activeFuture&&((n=(e=this.activeFuture).reject)===null||n===void 0||n.call(e,new Error("Participant disconnected")),this.activeFuture=void 0)}setAudioContext(e){this.audioContext=e,this.audioTrackPublications.forEach(n=>Hn(n.track)&&n.track.setAudioContext(e))}addTrackPublication(e){e.on(B.Muted,()=>{this.emit(V.TrackMuted,e)}),e.on(B.Unmuted,()=>{this.emit(V.TrackUnmuted,e)});const n=e;switch(n.track&&(n.track.sid=e.trackSid),this.trackPublications.set(e.trackSid,e),e.kind){case U.Kind.Audio:this.audioTrackPublications.set(e.trackSid,e);break;case U.Kind.Video:this.videoTrackPublications.set(e.trackSid,e);break}}}function c2(t){var e,n,i;if(!t.participantSid&&!t.participantIdentity)throw new Error("Invalid track permission, must provide at least one of participantIdentity and participantSid");return new hC({participantIdentity:(e=t.participantIdentity)!==null&&e!==void 0?e:"",participantSid:(n=t.participantSid)!==null&&n!==void 0?n:"",allTracks:(i=t.allowAll)!==null&&i!==void 0?i:!1,trackSids:t.allowedTrackSids||[]})}class u2 extends gk{constructor(e,n,i,a,s,r){super(e,n,void 0,void 0,void 0,{loggerName:a.loggerName,loggerContextCb:()=>this.engine.logContext}),this.pendingPublishing=new Set,this.pendingPublishPromises=new Map,this.participantTrackPermissions=[],this.allParticipantsAllowedToSubscribe=!0,this.encryptionType=Ke.NONE,this.enabledPublishVideoCodecs=[],this.pendingAcks=new Map,this.pendingResponses=new Map,this.handleReconnecting=()=>{this.reconnectFuture||(this.reconnectFuture=new hn)},this.handleReconnected=()=>{var o,l;(l=(o=this.reconnectFuture)===null||o===void 0?void 0:o.resolve)===null||l===void 0||l.call(o),this.reconnectFuture=void 0,this.updateTrackSubscriptionPermissions()},this.handleClosing=()=>{var o,l,c,u,d,f;this.reconnectFuture&&(this.reconnectFuture.promise.catch(h=>this.log.warn(h.message,this.logContext)),(l=(o=this.reconnectFuture)===null||o===void 0?void 0:o.reject)===null||l===void 0||l.call(o,new Error("Got disconnected during reconnection attempt")),this.reconnectFuture=void 0),this.signalConnectedFuture&&((u=(c=this.signalConnectedFuture).reject)===null||u===void 0||u.call(c,new Error("Got disconnected without signal connected")),this.signalConnectedFuture=void 0),(f=(d=this.activeAgentFuture)===null||d===void 0?void 0:d.reject)===null||f===void 0||f.call(d,new Error("Got disconnected without active agent present")),this.activeAgentFuture=void 0,this.firstActiveAgent=void 0},this.handleSignalConnected=o=>{var l,c;o.participant&&this.updateInfo(o.participant),this.signalConnectedFuture||(this.signalConnectedFuture=new hn),(c=(l=this.signalConnectedFuture).resolve)===null||c===void 0||c.call(l)},this.handleSignalRequestResponse=o=>{const{requestId:l,reason:c,message:u}=o,d=this.pendingSignalRequests.get(l);d&&(c!==Fm.OK&&d.reject(new zv(u,c)),this.pendingSignalRequests.delete(l))},this.handleDataPacket=o=>{switch(o.value.case){case"rpcResponse":let l=o.value.value,c=null,u=null;l.value.case==="payload"?c=l.value.value:l.value.case==="error"&&(u=Fe.fromProto(l.value.value)),this.handleIncomingRpcResponse(l.requestId,c,u);break;case"rpcAck":let d=o.value.value;this.handleIncomingRpcAck(d.requestId);break}},this.updateTrackSubscriptionPermissions=()=>{this.log.debug("updating track subscription permissions",Object.assign(Object.assign({},this.logContext),{allParticipantsAllowed:this.allParticipantsAllowedToSubscribe,participantTrackPermissions:this.participantTrackPermissions})),this.engine.client.sendUpdateSubscriptionPermissions(this.allParticipantsAllowedToSubscribe,this.participantTrackPermissions.map(o=>c2(o)))},this.onTrackUnmuted=o=>{this.onTrackMuted(o,o.isUpstreamPaused)},this.onTrackMuted=(o,l)=>{if(l===void 0&&(l=!0),!o.sid){this.log.error("could not update mute status for unpublished track",Object.assign(Object.assign({},this.logContext),se(o)));return}this.engine.updateMuteStatus(o.sid,l)},this.onTrackUpstreamPaused=o=>{this.log.debug("upstream paused",Object.assign(Object.assign({},this.logContext),se(o))),this.onTrackMuted(o,!0)},this.onTrackUpstreamResumed=o=>{this.log.debug("upstream resumed",Object.assign(Object.assign({},this.logContext),se(o))),this.onTrackMuted(o,o.isMuted)},this.onTrackFeatureUpdate=o=>{const l=this.audioTrackPublications.get(o.sid);if(!l){this.log.warn("Could not update local audio track settings, missing publication for track ".concat(o.sid),this.logContext);return}this.engine.client.sendUpdateLocalAudioTrack(l.trackSid,l.getTrackFeatures())},this.onTrackCpuConstrained=(o,l)=>{this.log.debug("track cpu constrained",Object.assign(Object.assign({},this.logContext),se(l))),this.emit(V.LocalTrackCpuConstrained,o,l)},this.handleSubscribedQualityUpdate=o=>S(this,void 0,void 0,function*(){var l,c,u,d,f;if(!(!((f=this.roomOptions)===null||f===void 0)&&f.dynacast))return;const h=this.videoTrackPublications.get(o.trackSid);if(!h){this.log.warn("received subscribed quality update for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}if(!h.videoTrack)return;const g=yield h.videoTrack.setPublishingCodecs(o.subscribedCodecs);try{for(var y=!0,T=ui(g),m;m=yield T.next(),l=m.done,!l;y=!0){d=m.value,y=!1;const p=d;TD(p)&&(this.log.debug("publish ".concat(p," for ").concat(h.videoTrack.sid),Object.assign(Object.assign({},this.logContext),se(h))),yield this.publishAdditionalCodecForTrack(h.videoTrack,p,h.options))}}catch(p){c={error:p}}finally{try{!y&&!l&&(u=T.return)&&(yield u.call(T))}finally{if(c)throw c.error}}}),this.handleLocalTrackUnpublished=o=>{const l=this.trackPublications.get(o.trackSid);if(!l){this.log.warn("received unpublished event for unknown track",Object.assign(Object.assign({},this.logContext),{trackSid:o.trackSid}));return}this.unpublishTrack(l.track)},this.handleTrackEnded=o=>S(this,void 0,void 0,function*(){if(o.source===U.Source.ScreenShare||o.source===U.Source.ScreenShareAudio)this.log.debug("unpublishing local track due to TrackEnded",Object.assign(Object.assign({},this.logContext),se(o))),this.unpublishTrack(o);else if(o.isUserProvided)yield o.mute();else if(ai(o)||Pi(o))try{if(Ut())try{const l=yield navigator==null?void 0:navigator.permissions.query({name:o.source===U.Source.Camera?"camera":"microphone"});if(l&&l.state==="denied")throw this.log.warn("user has revoked access to ".concat(o.source),Object.assign(Object.assign({},this.logContext),se(o))),l.onchange=()=>{l.state!=="denied"&&(o.isMuted||o.restartTrack(),l.onchange=null)},new Error("GetUserMedia Permission denied")}catch{}o.isMuted||(this.log.debug("track ended, attempting to use a different device",Object.assign(Object.assign({},this.logContext),se(o))),ai(o)?yield o.restartTrack({deviceId:"default"}):yield o.restartTrack())}catch{this.log.warn("could not restart track, muting instead",Object.assign(Object.assign({},this.logContext),se(o))),yield o.mute()}}),this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.trackPublications=new Map,this.engine=i,this.roomOptions=a,this.setupEngine(i),this.activeDeviceMap=new Map([["audioinput","default"],["videoinput","default"],["audiooutput","default"]]),this.pendingSignalRequests=new Map,this.rpcHandlers=s,this.roomOutgoingDataStreamManager=r}get lastCameraError(){return this.cameraError}get lastMicrophoneError(){return this.microphoneError}get isE2EEEnabled(){return this.encryptionType!==Ke.NONE}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setupEngine(e){var n;this.engine=e,this.engine.on(F.RemoteMute,(i,a)=>{const s=this.trackPublications.get(i);!s||!s.track||(a?s.mute():s.unmute())}),!((n=this.signalConnectedFuture)===null||n===void 0)&&n.isResolved&&(this.signalConnectedFuture=void 0),this.engine.on(F.Connected,this.handleReconnected).on(F.SignalConnected,this.handleSignalConnected).on(F.SignalRestarted,this.handleReconnected).on(F.SignalResumed,this.handleReconnected).on(F.Restarting,this.handleReconnecting).on(F.Resuming,this.handleReconnecting).on(F.LocalTrackUnpublished,this.handleLocalTrackUnpublished).on(F.SubscribedQualityUpdate,this.handleSubscribedQualityUpdate).on(F.Closing,this.handleClosing).on(F.SignalRequestResponse,this.handleSignalRequestResponse).on(F.DataPacketReceived,this.handleDataPacket)}setMetadata(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({metadata:e})})}setName(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({name:e})})}setAttributes(e){return S(this,void 0,void 0,function*(){yield this.requestMetadataUpdate({attributes:e})})}requestMetadataUpdate(e){return S(this,arguments,void 0,function(n){var i=this;let{metadata:a,name:s,attributes:r}=n;return function*(){return new Tt((o,l)=>S(i,void 0,void 0,function*(){var c,u;try{let d=!1;const f=yield this.engine.client.sendUpdateLocalMetadata((c=a??this.metadata)!==null&&c!==void 0?c:"",(u=s??this.name)!==null&&u!==void 0?u:"",r),h=performance.now();for(this.pendingSignalRequests.set(f,{resolve:o,reject:g=>{l(g),d=!0},values:{name:s,metadata:a,attributes:r}});performance.now()-h<5e3&&!d;){if((!s||this.name===s)&&(!a||this.metadata===a)&&(!r||Object.entries(r).every(g=>{let[y,T]=g;return this.attributes[y]===T||T===""&&!this.attributes[y]}))){this.pendingSignalRequests.delete(f),o();return}yield bt(50)}l(new zv("Request to update local metadata timed out","TimeoutError"))}catch(d){d instanceof Error?l(d):l(new Error(String(d)))}}))}()})}setCameraEnabled(e,n,i){return this.setTrackEnabled(U.Source.Camera,e,n,i)}setMicrophoneEnabled(e,n,i){return this.setTrackEnabled(U.Source.Microphone,e,n,i)}setScreenShareEnabled(e,n,i){return this.setTrackEnabled(U.Source.ScreenShare,e,n,i)}setE2EEEnabled(e){return S(this,void 0,void 0,function*(){this.encryptionType=e?Ke.GCM:Ke.NONE,yield this.republishAllTracks(void 0,!1)})}setTrackEnabled(e,n,i,a){return S(this,void 0,void 0,function*(){var s,r;this.log.debug("setTrackEnabled",Object.assign(Object.assign({},this.logContext),{source:e,enabled:n})),this.republishPromise&&(yield this.republishPromise);let o=this.getTrackPublication(e);if(n)if(o)yield o.unmute();else{let l;if(this.pendingPublishing.has(e)){const c=yield this.waitForPendingPublicationOfSource(e);return c||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e})),yield c==null?void 0:c.unmute(),c}this.pendingPublishing.add(e);try{switch(e){case U.Source.Camera:l=yield this.createTracks({video:(s=i)!==null&&s!==void 0?s:!0});break;case U.Source.Microphone:l=yield this.createTracks({audio:(r=i)!==null&&r!==void 0?r:!0});break;case U.Source.ScreenShare:l=yield this.createScreenTracks(Object.assign({},i));break;default:throw new di(e)}}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c instanceof Error&&this.emit(V.MediaDevicesError,c,$f(e)),this.pendingPublishing.delete(e),c}for(const c of l){const u=Object.assign(Object.assign({},this.roomOptions.publishDefaults),i);e===U.Source.Microphone&&Hn(c)&&u.preConnectBuffer&&(this.log.info("starting preconnect buffer for microphone",Object.assign({},this.logContext)),c.startPreConnectBuffer())}try{const c=[];for(const d of l)this.log.info("publishing track",Object.assign(Object.assign({},this.logContext),se(d))),c.push(this.publishTrack(d,a));[o]=yield Promise.all(c)}catch(c){throw l==null||l.forEach(u=>{u.stop()}),c}finally{this.pendingPublishing.delete(e)}}else if(!(o!=null&&o.track)&&this.pendingPublishing.has(e)&&(o=yield this.waitForPendingPublicationOfSource(e),o||this.log.info("waiting for pending publication promise timed out",Object.assign(Object.assign({},this.logContext),{source:e}))),o&&o.track)if(e===U.Source.ScreenShare){o=yield this.unpublishTrack(o.track);const l=this.getTrackPublication(U.Source.ScreenShareAudio);l&&l.track&&this.unpublishTrack(l.track)}else yield o.mute();return o})}enableCameraAndMicrophone(){return S(this,void 0,void 0,function*(){if(!(this.pendingPublishing.has(U.Source.Camera)||this.pendingPublishing.has(U.Source.Microphone))){this.pendingPublishing.add(U.Source.Camera),this.pendingPublishing.add(U.Source.Microphone);try{const e=yield this.createTracks({audio:!0,video:!0});yield Promise.all(e.map(n=>this.publishTrack(n)))}finally{this.pendingPublishing.delete(U.Source.Camera),this.pendingPublishing.delete(U.Source.Microphone)}}})}createTracks(e){return S(this,void 0,void 0,function*(){var n,i;e??(e={});const a=WC(e,(n=this.roomOptions)===null||n===void 0?void 0:n.audioCaptureDefaults,(i=this.roomOptions)===null||i===void 0?void 0:i.videoCaptureDefaults);try{return(yield bu(a,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext})).map(o=>(Hn(o)&&(this.microphoneError=void 0,o.setAudioContext(this.audioContext),o.source=U.Source.Microphone,this.emit(V.AudioStreamAcquired)),Ca(o)&&(this.cameraError=void 0,o.source=U.Source.Camera),o))}catch(s){throw s instanceof Error&&(e.audio&&(this.microphoneError=s),e.video&&(this.cameraError=s)),s}})}createScreenTracks(e){return S(this,void 0,void 0,function*(){if(e===void 0&&(e={}),navigator.mediaDevices.getDisplayMedia===void 0)throw new Gm("getDisplayMedia not supported");e.resolution===void 0&&!LD()&&(e.resolution=Km.h1080fps30.resolution);const n=kD(e),i=yield navigator.mediaDevices.getDisplayMedia(n),a=i.getVideoTracks();if(a.length===0)throw new di("no video track found");const s=new Ic(a[0],void 0,!1,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});s.source=U.Source.ScreenShare,e.contentHint&&(s.mediaStreamTrack.contentHint=e.contentHint);const r=[s];if(i.getAudioTracks().length>0){this.emit(V.AudioStreamAcquired);const o=new Uc(i.getAudioTracks()[0],void 0,!1,this.audioContext,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});o.source=U.Source.ScreenShareAudio,r.push(o)}return r})}publishTrack(e,n){return S(this,void 0,void 0,function*(){return this.publishOrRepublishTrack(e,n)})}publishOrRepublishTrack(e,n){return S(this,arguments,void 0,function(i,a){var s=this;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return function*(){var o,l,c,u;ai(i)&&i.setAudioContext(s.audioContext),yield(o=s.reconnectFuture)===null||o===void 0?void 0:o.promise,s.republishPromise&&!r&&(yield s.republishPromise),Bs(i)&&s.pendingPublishPromises.has(i)&&(yield s.pendingPublishPromises.get(i));let d;if(i instanceof MediaStreamTrack)d=i.getConstraints();else{d=i.constraints;let m;switch(i.source){case U.Source.Microphone:m="audioinput";break;case U.Source.Camera:m="videoinput"}m&&s.activeDeviceMap.has(m)&&(d=Object.assign(Object.assign({},d),{deviceId:s.activeDeviceMap.get(m)}))}if(i instanceof MediaStreamTrack)switch(i.kind){case"audio":i=new Uc(i,d,!0,s.audioContext,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;case"video":i=new Ic(i,d,!0,{loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});break;default:throw new di("unsupported MediaStreamTrack kind ".concat(i.kind))}else i.updateLoggerOptions({loggerName:s.roomOptions.loggerName,loggerContextCb:()=>s.logContext});let f;if(s.trackPublications.forEach(m=>{m.track&&m.track===i&&(f=m)}),f)return s.log.warn("track has already been published, skipping",Object.assign(Object.assign({},s.logContext),se(f))),f;const h=Object.assign(Object.assign({},s.roomOptions.publishDefaults),a),g="channelCount"in i.mediaStreamTrack.getSettings()&&i.mediaStreamTrack.getSettings().channelCount===2||i.mediaStreamTrack.getConstraints().channelCount===2,y=(l=h.forceStereo)!==null&&l!==void 0?l:g;y&&(h.dtx===void 0&&s.log.info("Opus DTX will be disabled for stereo tracks by default. Enable them explicitly to make it work.",Object.assign(Object.assign({},s.logContext),se(i))),h.red===void 0&&s.log.info("Opus RED will be disabled for stereo tracks by default. Enable them explicitly to make it work."),(c=h.dtx)!==null&&c!==void 0||(h.dtx=!1),(u=h.red)!==null&&u!==void 0||(h.red=!1)),!ID()&&s.roomOptions.e2ee&&(s.log.info("End-to-end encryption is set up, simulcast publishing will be disabled on Safari versions and iOS browsers running iOS < v17.2",Object.assign({},s.logContext)),h.simulcast=!1),h.source&&(i.source=h.source);const T=new Promise((m,p)=>S(s,void 0,void 0,function*(){try{if(this.engine.client.currentState!==_e.CONNECTED){this.log.debug("deferring track publication until signal is connected",Object.assign(Object.assign({},this.logContext),{track:se(i)}));let v=!1;const b=setTimeout(()=>{v=!0,i.stop(),p(new qv("publishing rejected as engine not connected within timeout",408))},15e3);if(yield this.waitUntilEngineConnected(),clearTimeout(b),v)return;const C=yield this.publish(i,h,y);m(C)}else try{const v=yield this.publish(i,h,y);m(v)}catch(v){p(v)}}catch(v){p(v)}}));s.pendingPublishPromises.set(i,T);try{return yield T}catch(m){throw m}finally{s.pendingPublishPromises.delete(i)}}()})}waitUntilEngineConnected(){return this.signalConnectedFuture||(this.signalConnectedFuture=new hn),this.signalConnectedFuture.promise}hasPermissionsToPublish(e){if(!this.permissions)return this.log.warn("no permissions present for publishing track",Object.assign(Object.assign({},this.logContext),se(e))),!1;const{canPublish:n,canPublishSources:i}=this.permissions;return n&&(i.length===0||i.map(a=>xD(a)).includes(e.source))?!0:(this.log.warn("insufficient permissions to publish",Object.assign(Object.assign({},this.logContext),se(e))),!1)}publish(e,n,i){return S(this,void 0,void 0,function*(){var a,s,r,o,l,c,u,d,f,h;if(!this.hasPermissionsToPublish(e))throw new qv("failed to publish track, insufficient permissions",403);Array.from(this.trackPublications.values()).find(O=>Bs(e)&&O.source===e.source)&&e.source!==U.Source.Unknown&&this.log.info("publishing a second track with the same source: ".concat(e.source),Object.assign(Object.assign({},this.logContext),se(e))),n.stopMicTrackOnMute&&Hn(e)&&(e.stopOnMute=!0),e.source===U.Source.ScreenShare&&Ya()&&(n.simulcast=!1),n.videoCodec==="av1"&&!DD()&&(n.videoCodec=void 0),n.videoCodec==="vp9"&&!ND()&&(n.videoCodec=void 0),n.videoCodec===void 0&&(n.videoCodec=sh),this.enabledPublishVideoCodecs.length>0&&(this.enabledPublishVideoCodecs.some(O=>n.videoCodec===io(O.mime))||(n.videoCodec=io(this.enabledPublishVideoCodecs[0].mime)));const y=n.videoCodec;e.on(B.Muted,this.onTrackMuted),e.on(B.Unmuted,this.onTrackUnmuted),e.on(B.Ended,this.handleTrackEnded),e.on(B.UpstreamPaused,this.onTrackUpstreamPaused),e.on(B.UpstreamResumed,this.onTrackUpstreamResumed),e.on(B.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate);const T=[],m=!(!((a=n.dtx)!==null&&a!==void 0)||a),p=e.getSourceTrackSettings();p.autoGainControl&&T.push(lt.TF_AUTO_GAIN_CONTROL),p.echoCancellation&&T.push(lt.TF_ECHO_CANCELLATION),p.noiseSuppression&&T.push(lt.TF_NOISE_SUPPRESSION),p.channelCount&&p.channelCount>1&&T.push(lt.TF_STEREO),m&&T.push(lt.TF_NO_DTX),ai(e)&&e.hasPreConnectBuffer&&T.push(lt.TF_PRECONNECT_BUFFER);const v=new _o({cid:e.mediaStreamTrack.id,name:n.name,type:U.kindToProto(e.kind),muted:e.isMuted,source:U.sourceToProto(e.source),disableDtx:m,encryption:this.encryptionType,stereo:i,disableRed:this.isE2EEEnabled||!(!((s=n.red)!==null&&s!==void 0)||s),stream:n==null?void 0:n.stream,backupCodecPolicy:n==null?void 0:n.backupCodecPolicy,audioFeatures:T});let b;if(e.kind===U.Kind.Video){let O={width:0,height:0};try{O=yield e.waitForDimensions()}catch{const z=(o=(r=this.roomOptions.videoCaptureDefaults)===null||r===void 0?void 0:r.resolution)!==null&&o!==void 0?o:Ro.h720.resolution;O={width:z.width,height:z.height},this.log.error("could not determine track dimensions, using defaults",Object.assign(Object.assign(Object.assign({},this.logContext),se(e)),{dims:O}))}v.width=O.width,v.height=O.height,Pi(e)&&(On(y)&&(e.source===U.Source.ScreenShare&&(n.scalabilityMode="L1T3","contentHint"in e.mediaStreamTrack&&(e.mediaStreamTrack.contentHint="motion",this.log.info("forcing contentHint to motion for screenshare with SVC codecs",Object.assign(Object.assign({},this.logContext),se(e))))),n.scalabilityMode=(l=n.scalabilityMode)!==null&&l!==void 0?l:"L3T3_KEY"),v.simulcastCodecs=[new zf({codec:y,cid:e.mediaStreamTrack.id})],n.backupCodec===!0&&(n.backupCodec={codec:sh}),n.backupCodec&&y!==n.backupCodec.codec&&v.encryption===Ke.NONE&&(this.roomOptions.dynacast||(this.roomOptions.dynacast=!0),v.simulcastCodecs.push(new zf({codec:n.backupCodec.codec,cid:""})))),b=oh(e.source===U.Source.ScreenShare,v.width,v.height,n),v.layers=m0(v.width,v.height,b,On(n.videoCodec))}else e.kind===U.Kind.Audio&&(b=[{maxBitrate:(c=n.audioPreset)===null||c===void 0?void 0:c.maxBitrate,priority:(d=(u=n.audioPreset)===null||u===void 0?void 0:u.priority)!==null&&d!==void 0?d:"high",networkPriority:(h=(f=n.audioPreset)===null||f===void 0?void 0:f.priority)!==null&&h!==void 0?h:"high"}]);if(!this.engine||this.engine.isClosed)throw new Ve("cannot publish track when not connected");const C=()=>S(this,void 0,void 0,function*(){var O,N,z;if(!this.engine.pcManager)throw new Ve("pcManager is not ready");if(e.sender=yield this.engine.createSender(e,n,b),this.emit(V.LocalSenderCreated,e.sender,e),Pi(e)&&((O=n.degradationPreference)!==null&&O!==void 0||(n.degradationPreference=VN(e)),e.setDegradationPreference(n.degradationPreference)),b)if(Ya()&&e.kind===U.Kind.Audio){let G;for(const de of this.engine.pcManager.publisher.getTransceivers())if(de.sender===e.sender){G=de;break}G&&this.engine.pcManager.publisher.setTrackCodecBitrate({transceiver:G,codec:"opus",maxbr:!((N=b[0])===null||N===void 0)&&N.maxBitrate?b[0].maxBitrate/1e3:0})}else e.codec&&On(e.codec)&&(!((z=b[0])===null||z===void 0)&&z.maxBitrate)&&this.engine.pcManager.publisher.setTrackCodecBitrate({cid:v.cid,codec:e.codec,maxbr:b[0].maxBitrate/1e3});yield this.engine.negotiate()});let _;const w=new Promise((O,N)=>S(this,void 0,void 0,function*(){var z;try{_=yield this.engine.addTrack(v),O(_)}catch(G){e.sender&&(!((z=this.engine.pcManager)===null||z===void 0)&&z.publisher)&&(this.engine.pcManager.publisher.removeTrack(e.sender),yield this.engine.negotiate().catch(de=>{this.log.error("failed to negotiate after removing track due to failed add track request",Object.assign(Object.assign(Object.assign({},this.logContext),se(e)),{error:de}))})),N(G)}}));if(this.enabledPublishVideoCodecs.length>0)_=(yield Promise.all([w,C()]))[0];else{_=yield w;let O;if(_.codecs.forEach(N=>{O===void 0&&(O=N.mimeType)}),O&&e.kind===U.Kind.Video){const N=io(O);N!==y&&(this.log.debug("falling back to server selected codec",Object.assign(Object.assign(Object.assign({},this.logContext),se(e)),{codec:N})),n.videoCodec=N,b=oh(e.source===U.Source.ScreenShare,v.width,v.height,n))}yield C()}const P=new ch(e.kind,_,e,{loggerName:this.roomOptions.loggerName,loggerContextCb:()=>this.logContext});if(P.on(B.CpuConstrained,O=>this.onTrackCpuConstrained(O,P)),P.options=n,e.sid=_.sid,this.log.debug("publishing ".concat(e.kind," with encodings"),Object.assign(Object.assign({},this.logContext),{encodings:b,trackInfo:_})),Pi(e)?e.startMonitor(this.engine.client):ai(e)&&e.startMonitor(),this.addTrackPublication(P),this.emit(V.LocalTrackPublished,P),ai(e)&&_.audioFeatures.includes(lt.TF_PRECONNECT_BUFFER)){const O=e.getPreConnectBuffer(),N=e.getPreConnectBufferMimeType();this.on(V.LocalTrackSubscribed,z=>{if(z.trackSid===_.sid){if(!e.hasPreConnectBuffer){this.log.warn("subscribe event came to late, buffer already closed",this.logContext);return}this.log.debug("finished recording preconnect buffer",Object.assign(Object.assign({},this.logContext),se(e))),e.stopPreConnectBuffer()}}),O&&new Promise((G,de)=>S(this,void 0,void 0,function*(){var at,At,q,X,ee,Ee;try{this.log.debug("waiting for agent",Object.assign(Object.assign({},this.logContext),se(e)));const Sn=setTimeout(()=>{de(new Error("agent not active within 10 seconds"))},1e4),Tn=yield this.waitUntilActiveAgentPresent();clearTimeout(Sn),this.log.debug("sending preconnect buffer",Object.assign(Object.assign({},this.logContext),se(e)));const Un=yield this.streamBytes({name:"preconnect-buffer",mimeType:N,topic:"lk.agent.pre-connect-audio-buffer",destinationIdentities:[Tn.identity],attributes:{trackId:P.trackSid,sampleRate:String((ee=p.sampleRate)!==null&&ee!==void 0?ee:"48000"),channels:String((Ee=p.channelCount)!==null&&Ee!==void 0?Ee:"1")}});try{for(var Oe=!0,Pn=ui(O),Ln;Ln=yield Pn.next(),at=Ln.done,!at;Oe=!0){X=Ln.value,Oe=!1;const hr=X;yield Un.write(hr)}}catch(hr){At={error:hr}}finally{try{!Oe&&!at&&(q=Pn.return)&&(yield q.call(Pn))}finally{if(At)throw At.error}}yield Un.close(),G()}catch(Sn){de(Sn)}})).then(()=>{this.log.debug("preconnect buffer sent successfully",Object.assign(Object.assign({},this.logContext),se(e)))}).catch(G=>{this.log.error("error sending preconnect buffer",Object.assign(Object.assign(Object.assign({},this.logContext),se(e)),{error:G}))})}return P})}get isLocal(){return!0}publishAdditionalCodecForTrack(e,n,i){return S(this,void 0,void 0,function*(){var a;if(this.encryptionType!==Ke.NONE)return;let s;if(this.trackPublications.forEach(h=>{h.track&&h.track===e&&(s=h)}),!s)throw new di("track is not published");if(!Pi(e))throw new di("track is not a video track");const r=Object.assign(Object.assign({},(a=this.roomOptions)===null||a===void 0?void 0:a.publishDefaults),i),o=qN(e,n,r);if(!o){this.log.info("backup codec has been disabled, ignoring request to add additional codec for track",Object.assign(Object.assign({},this.logContext),se(e)));return}const l=e.addSimulcastTrack(n,o);if(!l)return;const c=new _o({cid:l.mediaStreamTrack.id,type:U.kindToProto(e.kind),muted:e.isMuted,source:U.sourceToProto(e.source),sid:e.sid,simulcastCodecs:[{codec:r.videoCodec,cid:l.mediaStreamTrack.id}]});if(c.layers=m0(c.width,c.height,o),!this.engine||this.engine.isClosed)throw new Ve("cannot publish track when not connected");const u=()=>S(this,void 0,void 0,function*(){yield this.engine.createSimulcastSender(e,l,r,o),yield this.engine.negotiate()}),f=(yield Promise.all([this.engine.addTrack(c),u()]))[0];this.log.debug("published ".concat(n," for track ").concat(e.sid),Object.assign(Object.assign({},this.logContext),{encodings:o,trackInfo:f}))})}unpublishTrack(e,n){return S(this,void 0,void 0,function*(){var i,a;if(Bs(e)){const c=this.pendingPublishPromises.get(e);c&&(this.log.info("awaiting publish promise before attempting to unpublish",Object.assign(Object.assign({},this.logContext),se(e))),yield c)}const s=this.getPublicationForTrack(e),r=s?se(s):void 0;if(this.log.debug("unpublishing track",Object.assign(Object.assign({},this.logContext),r)),!s||!s.track){this.log.warn("track was not unpublished because no publication was found",Object.assign(Object.assign({},this.logContext),r));return}e=s.track,e.off(B.Muted,this.onTrackMuted),e.off(B.Unmuted,this.onTrackUnmuted),e.off(B.Ended,this.handleTrackEnded),e.off(B.UpstreamPaused,this.onTrackUpstreamPaused),e.off(B.UpstreamResumed,this.onTrackUpstreamResumed),e.off(B.AudioTrackFeatureUpdate,this.onTrackFeatureUpdate),n===void 0&&(n=(a=(i=this.roomOptions)===null||i===void 0?void 0:i.stopLocalTrackOnUnpublish)!==null&&a!==void 0?a:!0),n?e.stop():e.stopMonitor();let o=!1;const l=e.sender;if(e.sender=void 0,this.engine.pcManager&&this.engine.pcManager.currentState<Be.FAILED&&l)try{for(const c of this.engine.pcManager.publisher.getTransceivers())c.sender===l&&(c.direction="inactive",o=!0);if(this.engine.removeTrack(l)&&(o=!0),Pi(e)){for(const[,c]of e.simulcastCodecs)c.sender&&(this.engine.removeTrack(c.sender)&&(o=!0),c.sender=void 0);e.simulcastCodecs.clear()}}catch(c){this.log.warn("failed to unpublish track",Object.assign(Object.assign(Object.assign({},this.logContext),r),{error:c}))}switch(this.trackPublications.delete(s.trackSid),s.kind){case U.Kind.Audio:this.audioTrackPublications.delete(s.trackSid);break;case U.Kind.Video:this.videoTrackPublications.delete(s.trackSid);break}return this.emit(V.LocalTrackUnpublished,s),s.setTrack(void 0),o&&(yield this.engine.negotiate()),s})}unpublishTracks(e){return S(this,void 0,void 0,function*(){return(yield Promise.all(e.map(i=>this.unpublishTrack(i)))).filter(i=>!!i)})}republishAllTracks(e){return S(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return function*(){i.republishPromise&&(yield i.republishPromise),i.republishPromise=new Tt((s,r)=>S(i,void 0,void 0,function*(){try{const o=[];this.trackPublications.forEach(l=>{l.track&&(n&&(l.options=Object.assign(Object.assign({},l.options),n)),o.push(l))}),yield Promise.all(o.map(l=>S(this,void 0,void 0,function*(){const c=l.track;yield this.unpublishTrack(c,!1),a&&!c.isMuted&&c.source!==U.Source.ScreenShare&&c.source!==U.Source.ScreenShareAudio&&(ai(c)||Pi(c))&&!c.isUserProvided&&(this.log.debug("restarting existing track",Object.assign(Object.assign({},this.logContext),{track:l.trackSid})),yield c.restartTrack()),yield this.publishOrRepublishTrack(c,l.options,!0)}))),s()}catch(o){o instanceof Error?r(o):r(new Error(String(o)))}finally{this.republishPromise=void 0}})),yield i.republishPromise}()})}publishData(e){return S(this,arguments,void 0,function(n){var i=this;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const s=a.reliable?ae.RELIABLE:ae.LOSSY,r=a.destinationIdentities,o=a.topic;let l=new Nm({participantIdentity:i.identity,payload:n,destinationIdentities:r,topic:o});const c=new _t({kind:s,value:{case:"user",value:l}});yield i.engine.sendDataPacket(c,s)}()})}publishDtmf(e,n){return S(this,void 0,void 0,function*(){const i=new _t({kind:ae.RELIABLE,value:{case:"sipDtmf",value:new JT({code:e,digit:n})}});yield this.engine.sendDataPacket(i,ae.RELIABLE)})}sendChatMessage(e,n){return S(this,void 0,void 0,function*(){const i={id:crypto.randomUUID(),message:e,timestamp:Date.now(),attachedFiles:n==null?void 0:n.attachments},a=new _t({value:{case:"chatMessage",value:new Mc(Object.assign(Object.assign({},i),{timestamp:Ue.parse(i.timestamp)}))}});return yield this.engine.sendDataPacket(a,ae.RELIABLE),this.emit(V.ChatMessage,i),i})}editChatMessage(e,n){return S(this,void 0,void 0,function*(){const i=Object.assign(Object.assign({},n),{message:e,editTimestamp:Date.now()}),a=new _t({value:{case:"chatMessage",value:new Mc(Object.assign(Object.assign({},i),{timestamp:Ue.parse(i.timestamp),editTimestamp:Ue.parse(i.editTimestamp)}))}});return yield this.engine.sendDataPacket(a,ae.RELIABLE),this.emit(V.ChatMessage,i),i})}sendText(e,n){return S(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendText(e,n)})}streamText(e){return S(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamText(e)})}sendFile(e,n){return S(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.sendFile(e,n)})}streamBytes(e){return S(this,void 0,void 0,function*(){return this.roomOutgoingDataStreamManager.streamBytes(e)})}performRpc(e){let{destinationIdentity:n,method:i,payload:a,responseTimeout:s=15e3}=e;const r=7e3,o=r+1e3;return new Tt((l,c)=>S(this,void 0,void 0,function*(){var u,d,f,h;if(ep(a)>ck){c(Fe.builtIn("REQUEST_PAYLOAD_TOO_LARGE"));return}if(!((d=(u=this.engine.latestJoinResponse)===null||u===void 0?void 0:u.serverInfo)===null||d===void 0)&&d.version&&Yn((h=(f=this.engine.latestJoinResponse)===null||f===void 0?void 0:f.serverInfo)===null||h===void 0?void 0:h.version,"1.8.0")<0){c(Fe.builtIn("UNSUPPORTED_SERVER"));return}const g=Math.max(s,o),y=crypto.randomUUID();yield this.publishRpcRequest(n,y,i,a,g);const T=setTimeout(()=>{this.pendingAcks.delete(y),c(Fe.builtIn("CONNECTION_TIMEOUT")),this.pendingResponses.delete(y),clearTimeout(m)},r);this.pendingAcks.set(y,{resolve:()=>{clearTimeout(T)},participantIdentity:n});const m=setTimeout(()=>{this.pendingResponses.delete(y),c(Fe.builtIn("RESPONSE_TIMEOUT"))},s);this.pendingResponses.set(y,{resolve:(p,v)=>{clearTimeout(m),this.pendingAcks.has(y)&&(this.log.warn("RPC response received before ack",y),this.pendingAcks.delete(y),clearTimeout(T)),v?c(v):l(p??"")},participantIdentity:n})}))}registerRpcMethod(e,n){this.rpcHandlers.has(e)&&this.log.warn("you're overriding the RPC handler for method ".concat(e,", in the future this will throw an error")),this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setTrackSubscriptionPermissions(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];this.participantTrackPermissions=n,this.allParticipantsAllowedToSubscribe=e,this.engine.client.isDisconnected||this.updateTrackSubscriptionPermissions()}handleIncomingRpcAck(e){const n=this.pendingAcks.get(e);n?(n.resolve(),this.pendingAcks.delete(e)):console.error("Ack received for unexpected RPC request",e)}handleIncomingRpcResponse(e,n,i){const a=this.pendingResponses.get(e);a?(a.resolve(n,i),this.pendingResponses.delete(e)):console.error("Response received for unexpected RPC request",e)}publishRpcRequest(e,n,i,a,s){return S(this,void 0,void 0,function*(){const r=new _t({destinationIdentities:[e],kind:ae.RELIABLE,value:{case:"rpcRequest",value:new Pm({id:n,method:i,payload:a,responseTimeoutMs:s,version:1})}});yield this.engine.sendDataPacket(r,ae.RELIABLE)})}handleParticipantDisconnected(e){for(const[n,{participantIdentity:i}]of this.pendingAcks)i===e&&this.pendingAcks.delete(n);for(const[n,{participantIdentity:i,resolve:a}]of this.pendingResponses)i===e&&(a(null,Fe.builtIn("RECIPIENT_DISCONNECTED")),this.pendingResponses.delete(n))}setEnabledPublishCodecs(e){this.enabledPublishVideoCodecs=e.filter(n=>n.mime.split("/")[0].toLowerCase()==="video")}updateInfo(e){return super.updateInfo(e)?(e.tracks.forEach(n=>{var i,a;const s=this.trackPublications.get(n.sid);if(s){const r=s.isMuted||((a=(i=s.track)===null||i===void 0?void 0:i.isUpstreamPaused)!==null&&a!==void 0?a:!1);r!==n.muted&&(this.log.debug("updating server mute state after reconcile",Object.assign(Object.assign(Object.assign({},this.logContext),se(s)),{mutedOnServer:r})),this.engine.client.sendMuteTrack(n.sid,r))}}),!0):!1}setActiveAgent(e){var n,i,a,s;this.firstActiveAgent=e,e&&!this.firstActiveAgent&&(this.firstActiveAgent=e),e?(i=(n=this.activeAgentFuture)===null||n===void 0?void 0:n.resolve)===null||i===void 0||i.call(n,e):(s=(a=this.activeAgentFuture)===null||a===void 0?void 0:a.reject)===null||s===void 0||s.call(a,new Error("Agent disconnected")),this.activeAgentFuture=void 0}waitUntilActiveAgentPresent(){return this.firstActiveAgent?Promise.resolve(this.firstActiveAgent):(this.activeAgentFuture||(this.activeAgentFuture=new hn),this.activeAgentFuture.promise)}getPublicationForTrack(e){let n;return this.trackPublications.forEach(i=>{const a=i.track;a&&(e instanceof MediaStreamTrack?(ai(a)||Pi(a))&&a.mediaStreamTrack===e&&(n=i):e===a&&(n=i))}),n}waitForPendingPublicationOfSource(e){return S(this,void 0,void 0,function*(){const i=Date.now();for(;Date.now()<i+1e4;){const a=Array.from(this.pendingPublishPromises.entries()).find(s=>{let[r]=s;return r.source===e});if(a)return a[1];yield bt(20)}})}}class d2 extends ri{constructor(e,n,i,a){super(e,n.sid,n.name,a),this.track=void 0,this.allowed=!0,this.requestedDisabled=void 0,this.visible=!0,this.handleEnded=s=>{this.setTrack(void 0),this.emit(B.Ended,s)},this.handleVisibilityChange=s=>{this.log.debug("adaptivestream video visibility ".concat(this.trackSid,", visible=").concat(s),this.logContext),this.visible=s,this.emitTrackUpdate()},this.handleVideoDimensionsChange=s=>{this.log.debug("adaptivestream video dimensions ".concat(s.width,"x").concat(s.height),this.logContext),this.videoDimensionsAdaptiveStream=s,this.emitTrackUpdate()},this.subscribed=i,this.updateInfo(n)}setSubscribed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.subscribed=e,e&&(this.allowed=!0);const a=new mu({trackSids:[this.trackSid],subscribe:this.subscribed,participantTracks:[new ZT({participantSid:"",trackSids:[this.trackSid]})]});this.emit(B.UpdateSubscription,a),this.emitSubscriptionUpdateIfChanged(n),this.emitPermissionUpdateIfChanged(i)}get subscriptionStatus(){return this.subscribed===!1?ri.SubscriptionStatus.Unsubscribed:super.isSubscribed?ri.SubscriptionStatus.Subscribed:ri.SubscriptionStatus.Desired}get permissionStatus(){return this.allowed?ri.PermissionStatus.Allowed:ri.PermissionStatus.NotAllowed}get isSubscribed(){return this.subscribed===!1?!1:super.isSubscribed}get isDesired(){return this.subscribed!==!1}get isEnabled(){return this.requestedDisabled!==void 0?!this.requestedDisabled:this.isAdaptiveStream?this.visible:!0}get isLocal(){return!1}setEnabled(e){!this.isManualOperationAllowed()||this.requestedDisabled===!e||(this.requestedDisabled=!e,this.emitTrackUpdate())}setVideoQuality(e){!this.isManualOperationAllowed()||this.requestedMaxQuality===e||(this.requestedMaxQuality=e,this.requestedVideoDimensions=void 0,this.emitTrackUpdate())}setVideoDimensions(e){var n,i;this.isManualOperationAllowed()&&(((n=this.requestedVideoDimensions)===null||n===void 0?void 0:n.width)===e.width&&((i=this.requestedVideoDimensions)===null||i===void 0?void 0:i.height)===e.height||(Rd(this.track)&&(this.requestedVideoDimensions=e),this.requestedMaxQuality=void 0,this.emitTrackUpdate()))}setVideoFPS(e){this.isManualOperationAllowed()&&Rd(this.track)&&this.fps!==e&&(this.fps=e,this.emitTrackUpdate())}get videoQuality(){var e;return(e=this.requestedMaxQuality)!==null&&e!==void 0?e:Yt.HIGH}setTrack(e){const n=this.subscriptionStatus,i=this.permissionStatus,a=this.track;a!==e&&(a&&(a.off(B.VideoDimensionsChanged,this.handleVideoDimensionsChange),a.off(B.VisibilityChanged,this.handleVisibilityChange),a.off(B.Ended,this.handleEnded),a.detach(),a.stopMonitor(),this.emit(B.Unsubscribed,a)),super.setTrack(e),e&&(e.sid=this.trackSid,e.on(B.VideoDimensionsChanged,this.handleVideoDimensionsChange),e.on(B.VisibilityChanged,this.handleVisibilityChange),e.on(B.Ended,this.handleEnded),this.emit(B.Subscribed,e)),this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n))}setAllowed(e){const n=this.subscriptionStatus,i=this.permissionStatus;this.allowed=e,this.emitPermissionUpdateIfChanged(i),this.emitSubscriptionUpdateIfChanged(n)}setSubscriptionError(e){this.emit(B.SubscriptionFailed,e)}updateInfo(e){super.updateInfo(e);const n=this.metadataMuted;this.metadataMuted=e.muted,this.track?this.track.setMuted(e.muted):n!==e.muted&&this.emit(e.muted?B.Muted:B.Unmuted)}emitSubscriptionUpdateIfChanged(e){const n=this.subscriptionStatus;e!==n&&this.emit(B.SubscriptionStatusChanged,n,e)}emitPermissionUpdateIfChanged(e){this.permissionStatus!==e&&this.emit(B.SubscriptionPermissionChanged,this.permissionStatus,e)}isManualOperationAllowed(){return this.isDesired?!0:(this.log.warn("cannot update track settings when not subscribed",this.logContext),!1)}get isAdaptiveStream(){return Rd(this.track)&&this.track.isAdaptiveStream}emitTrackUpdate(){const e=new cC({trackSids:[this.trackSid],disabled:!this.isEnabled,fps:this.fps});if(this.kind===U.Kind.Video){let n=this.requestedVideoDimensions;if(this.videoDimensionsAdaptiveStream!==void 0)if(n)Vv(this.videoDimensionsAdaptiveStream,n)&&(this.log.debug("using adaptive stream dimensions instead of requested",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream);else if(this.requestedMaxQuality!==void 0&&this.trackInfo){const i=wD(this.trackInfo,this.requestedMaxQuality);i&&Vv(this.videoDimensionsAdaptiveStream,i)&&(this.log.debug("using adaptive stream dimensions instead of max quality layer",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream)}else this.log.debug("using adaptive stream dimensions",Object.assign(Object.assign({},this.logContext),this.videoDimensionsAdaptiveStream)),n=this.videoDimensionsAdaptiveStream;n?(e.width=Math.ceil(n.width),e.height=Math.ceil(n.height)):this.requestedMaxQuality!==void 0?(this.log.debug("using requested max quality",Object.assign(Object.assign({},this.logContext),{quality:this.requestedMaxQuality})),e.quality=this.requestedMaxQuality):(this.log.debug("using default quality",Object.assign(Object.assign({},this.logContext),{quality:Yt.HIGH})),e.quality=Yt.HIGH)}this.emit(B.UpdateSettings,e)}}class jc extends gk{static fromParticipantInfo(e,n,i){return new jc(e,n.sid,n.identity,n.name,n.metadata,n.attributes,i,n.kind)}get logContext(){return Object.assign(Object.assign({},super.logContext),{rpID:this.sid,remoteParticipant:this.identity})}constructor(e,n,i,a,s,r,o){let l=arguments.length>7&&arguments[7]!==void 0?arguments[7]:Eo.STANDARD;super(n,i||"",a,s,r,o,l),this.signalClient=e,this.trackPublications=new Map,this.audioTrackPublications=new Map,this.videoTrackPublications=new Map,this.volumeMap=new Map}addTrackPublication(e){super.addTrackPublication(e),e.on(B.UpdateSettings,n=>{this.log.debug("send update settings",Object.assign(Object.assign(Object.assign({},this.logContext),se(e)),{settings:n})),this.signalClient.sendUpdateTrackSettings(n)}),e.on(B.UpdateSubscription,n=>{n.participantTracks.forEach(i=>{i.participantSid=this.sid}),this.signalClient.sendUpdateSubscription(n)}),e.on(B.SubscriptionPermissionChanged,n=>{this.emit(V.TrackSubscriptionPermissionChanged,e,n)}),e.on(B.SubscriptionStatusChanged,n=>{this.emit(V.TrackSubscriptionStatusChanged,e,n)}),e.on(B.Subscribed,n=>{this.emit(V.TrackSubscribed,n,e)}),e.on(B.Unsubscribed,n=>{this.emit(V.TrackUnsubscribed,n,e)}),e.on(B.SubscriptionFailed,n=>{this.emit(V.TrackSubscriptionFailed,e.trackSid,n)})}getTrackPublication(e){const n=super.getTrackPublication(e);if(n)return n}getTrackPublicationByName(e){const n=super.getTrackPublicationByName(e);if(n)return n}setVolume(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:U.Source.Microphone;this.volumeMap.set(n,e);const i=this.getTrackPublication(n);i&&i.track&&i.track.setVolume(e)}getVolume(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:U.Source.Microphone;const n=this.getTrackPublication(e);return n&&n.track?n.track.getVolume():this.volumeMap.get(e)}addSubscribedMediaTrack(e,n,i,a,s,r){let o=this.getTrackPublicationBySid(n);if(o||n.startsWith("TR")||this.trackPublications.forEach(u=>{!o&&e.kind===u.kind.toString()&&(o=u)}),!o){if(r===0){this.log.error("could not find published track",Object.assign(Object.assign({},this.logContext),{trackSid:n})),this.emit(V.TrackSubscriptionFailed,n);return}r===void 0&&(r=20),setTimeout(()=>{this.addSubscribedMediaTrack(e,n,i,a,s,r-1)},150);return}if(e.readyState==="ended"){this.log.error("unable to subscribe because MediaStreamTrack is ended. Do not call MediaStreamTrack.stop()",Object.assign(Object.assign({},this.logContext),se(o))),this.emit(V.TrackSubscriptionFailed,n);return}const l=e.kind==="video";let c;return l?c=new a2(e,n,a,s):c=new i2(e,n,a,this.audioContext,this.audioOutput),c.source=o.source,c.isMuted=o.isMuted,c.setMediaStream(i),c.start(),o.setTrack(c),this.volumeMap.has(o.source)&&ih(c)&&Hn(c)&&c.setVolume(this.volumeMap.get(o.source)),o}get hasMetadata(){return!!this.participantInfo}getTrackPublicationBySid(e){return this.trackPublications.get(e)}updateInfo(e){if(!super.updateInfo(e))return!1;const n=new Map,i=new Map;return e.tracks.forEach(a=>{var s,r;let o=this.getTrackPublicationBySid(a.sid);if(o)o.updateInfo(a);else{const l=U.kindFromProto(a.type);if(!l)return;o=new d2(l,a,(s=this.signalClient.connectOptions)===null||s===void 0?void 0:s.autoSubscribe,{loggerContextCb:()=>this.logContext,loggerName:(r=this.loggerOptions)===null||r===void 0?void 0:r.loggerName}),o.updateInfo(a),i.set(a.sid,o);const c=Array.from(this.trackPublications.values()).find(u=>u.source===(o==null?void 0:o.source));c&&o.source!==U.Source.Unknown&&this.log.debug("received a second track publication for ".concat(this.identity," with the same source: ").concat(o.source),Object.assign(Object.assign({},this.logContext),{oldTrack:se(c),newTrack:se(o)})),this.addTrackPublication(o)}n.set(a.sid,o)}),this.trackPublications.forEach(a=>{n.has(a.trackSid)||(this.log.trace("detected removed track on remote participant, unpublishing",Object.assign(Object.assign({},this.logContext),se(a))),this.unpublishTrack(a.trackSid,!0))}),i.forEach(a=>{this.emit(V.TrackPublished,a)}),!0}unpublishTrack(e,n){const i=this.trackPublications.get(e);if(!i)return;const{track:a}=i;switch(a&&(a.stop(),i.setTrack(void 0)),this.trackPublications.delete(e),i.kind){case U.Kind.Audio:this.audioTrackPublications.delete(e);break;case U.Kind.Video:this.videoTrackPublications.delete(e);break}n&&this.emit(V.TrackUnpublished,i)}setAudioOutput(e){return S(this,void 0,void 0,function*(){this.audioOutput=e;const n=[];this.audioTrackPublications.forEach(i=>{var a;Hn(i.track)&&ih(i.track)&&n.push(i.track.setSinkId((a=e.deviceId)!==null&&a!==void 0?a:"default"))}),yield Promise.all(n)})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];return this.log.trace("participant event",Object.assign(Object.assign({},this.logContext),{event:e,args:i})),super.emit(e,...i)}}var me;(function(t){t.Disconnected="disconnected",t.Connecting="connecting",t.Connected="connected",t.Reconnecting="reconnecting",t.SignalReconnecting="signalReconnecting"})(me||(me={}));const f2=4*1e3;class Oo extends Zn.EventEmitter{get hasE2EESetup(){return this.e2eeManager!==void 0}constructor(e){var n,i,a,s,r;if(super(),n=this,this.state=me.Disconnected,this.activeSpeakers=[],this.isE2EEEnabled=!1,this.audioEnabled=!0,this.isVideoPlaybackBlocked=!1,this.log=ie,this.bufferedEvents=[],this.isResuming=!1,this.rpcHandlers=new Map,this.connect=(o,l,c)=>S(this,void 0,void 0,function*(){var u;if(!PD())throw Kn()?Error("WebRTC isn't detected, have you called registerGlobals?"):Error("LiveKit doesn't seem to be supported on this browser. Try to update your browser and make sure no browser extensions are disabling webRTC.");const d=yield this.disconnectLock.lock();if(this.state===me.Connected)return this.log.info("already connected to room ".concat(this.name),this.logContext),d(),Promise.resolve();if(this.connectFuture)return d(),this.connectFuture.promise;this.setAndEmitConnectionState(me.Connecting),((u=this.regionUrlProvider)===null||u===void 0?void 0:u.getServerUrl().toString())!==sk(o)&&(this.regionUrl=void 0,this.regionUrlProvider=void 0),tr(new URL(o))&&(this.regionUrlProvider===void 0?this.regionUrlProvider=new fe(o,l):this.regionUrlProvider.updateToken(l),this.regionUrlProvider.fetchRegionSettings().then(g=>{var y;(y=this.regionUrlProvider)===null||y===void 0||y.setServerReportedRegions(g)}).catch(g=>{this.log.warn("could not fetch region settings",Object.assign(Object.assign({},this.logContext),{error:g}))}));const f=(g,y,T)=>S(this,void 0,void 0,function*(){var m,p;this.abortController&&this.abortController.abort();const v=new AbortController;this.abortController=v,d==null||d();try{if(yield qs.getInstance().getBackOffPromise(o),v.signal.aborted)throw J.cancelled("Connection attempt aborted");yield this.attemptConnection(T??o,l,c,v),this.abortController=void 0,g()}catch(b){if(this.regionUrlProvider&&b instanceof J&&b.reason!==Re.Cancelled&&b.reason!==Re.NotAllowed){let C=null;try{this.log.debug("Fetching next region"),C=yield this.regionUrlProvider.getNextBestRegionUrl((m=this.abortController)===null||m===void 0?void 0:m.signal)}catch(_){if(_ instanceof J&&(_.status===401||_.reason===Re.Cancelled)){this.handleDisconnect(this.options.stopLocalTrackOnUnpublish),y(_);return}}[Re.InternalError,Re.ServerUnreachable,Re.Timeout].includes(b.reason)&&(this.log.debug("Adding failed connection attempt to back off"),qs.getInstance().addFailedConnectionAttempt(o)),C&&!(!((p=this.abortController)===null||p===void 0)&&p.signal.aborted)?(this.log.info("Initial connection failed with ConnectionError: ".concat(b.message,". Retrying with another region: ").concat(C),this.logContext),this.recreateEngine(),yield f(g,y,C)):(this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,Xv(b)),y(b))}else{let C=An.UNKNOWN_REASON;b instanceof J&&(C=Xv(b)),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,C),y(b)}}}),h=this.regionUrl;return this.regionUrl=void 0,this.connectFuture=new hn((g,y)=>{f(g,y,h)},()=>{this.clearConnectionFutures()}),this.connectFuture.promise}),this.connectSignal=(o,l,c,u,d,f)=>S(this,void 0,void 0,function*(){var h,g,y;const T=yield c.join(o,l,{autoSubscribe:u.autoSubscribe,adaptiveStream:typeof d.adaptiveStream=="object"?!0:d.adaptiveStream,maxRetries:u.maxRetries,e2eeEnabled:!!this.e2eeManager,websocketTimeout:u.websocketTimeout},f.signal,!d.singlePeerConnection);let m=T.serverInfo;if(m||(m={version:T.serverVersion,region:T.serverRegion}),this.serverInfo=m,this.log.debug("connected to Livekit Server ".concat(Object.entries(m).map(p=>{let[v,b]=p;return"".concat(v,": ").concat(b)}).join(", ")),{room:(h=T.room)===null||h===void 0?void 0:h.name,roomSid:(g=T.room)===null||g===void 0?void 0:g.sid,identity:(y=T.participant)===null||y===void 0?void 0:y.identity}),!m.version)throw new gD("unknown server version");return m.version==="0.15.1"&&this.options.dynacast&&(this.log.debug("disabling dynacast due to server version",this.logContext),d.dynacast=!1),T}),this.applyJoinResponse=o=>{const l=o.participant;if(this.localParticipant.sid=l.sid,this.localParticipant.identity=l.identity,this.localParticipant.setEnabledPublishCodecs(o.enabledPublishCodecs),this.e2eeManager)try{this.e2eeManager.setSifTrailer(o.sifTrailer)}catch(c){this.log.error(c instanceof Error?c.message:"Could not set SifTrailer",Object.assign(Object.assign({},this.logContext),{error:c}))}this.handleParticipantUpdates([l,...o.otherParticipants]),o.room&&this.handleRoomUpdate(o.room)},this.attemptConnection=(o,l,c,u)=>S(this,void 0,void 0,function*(){var d,f;this.state===me.Reconnecting||this.isResuming||!((d=this.engine)===null||d===void 0)&&d.pendingReconnect?(this.log.info("Reconnection attempt replaced by new connection attempt",this.logContext),this.recreateEngine()):this.maybeCreateEngine(),!((f=this.regionUrlProvider)===null||f===void 0)&&f.isCloud()&&this.engine.setRegionUrlProvider(this.regionUrlProvider),this.acquireAudioContext(),this.connOptions=Object.assign(Object.assign({},$m),c),this.connOptions.rtcConfig&&(this.engine.rtcConfig=this.connOptions.rtcConfig),this.connOptions.peerConnectionTimeout&&(this.engine.peerConnectionTimeout=this.connOptions.peerConnectionTimeout);try{const h=yield this.connectSignal(o,l,this.engine,this.connOptions,this.options,u);this.applyJoinResponse(h),this.setupLocalParticipantEvents(),this.emit(j.SignalConnected)}catch(h){yield this.engine.close(),this.recreateEngine();const g=u.signal.aborted?J.cancelled("Signal connection aborted"):J.serverUnreachable("could not establish signal connection");throw h instanceof Error&&(g.message="".concat(g.message,": ").concat(h.message)),h instanceof J&&(g.reason=h.reason,g.status=h.status),this.log.debug("error trying to establish signal connection",Object.assign(Object.assign({},this.logContext),{error:h})),g}if(u.signal.aborted)throw yield this.engine.close(),this.recreateEngine(),J.cancelled("Connection attempt aborted");try{yield this.engine.waitForPCInitialConnection(this.connOptions.peerConnectionTimeout,u)}catch(h){throw yield this.engine.close(),this.recreateEngine(),h}Ut()&&this.options.disconnectOnPageLeave&&(window.addEventListener("pagehide",this.onPageLeave),window.addEventListener("beforeunload",this.onPageLeave)),Ut()&&window.addEventListener("freeze",this.onPageLeave),this.setAndEmitConnectionState(me.Connected),this.emit(j.Connected),qs.getInstance().resetFailedConnectionAttempts(o),this.registerConnectionReconcile(),this.regionUrlProvider&&this.regionUrlProvider.notifyConnected()}),this.disconnect=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return S(n,[...l],void 0,function(){var u=this;let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return function*(){var f,h,g;const y=yield u.disconnectLock.lock();try{if(u.state===me.Disconnected){u.log.debug("already disconnected",u.logContext);return}if(u.log.info("disconnect from room",Object.assign({},u.logContext)),u.state===me.Connecting||u.state===me.Reconnecting||u.isResuming){const T="Abort connection attempt due to user initiated disconnect";u.log.warn(T,u.logContext),(f=u.abortController)===null||f===void 0||f.abort(T),(g=(h=u.connectFuture)===null||h===void 0?void 0:h.reject)===null||g===void 0||g.call(h,J.cancelled("Client initiated disconnect")),u.connectFuture=void 0}u.engine&&(u.engine.client.isDisconnected||(yield u.engine.client.sendLeave()),yield u.engine.close()),u.handleDisconnect(d,An.CLIENT_INITIATED),u.engine=void 0}finally{y()}}()})},this.onPageLeave=()=>S(this,void 0,void 0,function*(){this.log.info("Page leave detected, disconnecting",this.logContext),yield this.disconnect()}),this.startAudio=()=>S(this,void 0,void 0,function*(){const o=[],l=jt();if(l&&l.os==="iOS"){const c="livekit-dummy-audio-el";let u=document.getElementById(c);if(!u){u=document.createElement("audio"),u.id=c,u.autoplay=!0,u.hidden=!0;const d=_d();d.enabled=!0;const f=new MediaStream([d]);u.srcObject=f,document.addEventListener("visibilitychange",()=>{u&&(u.srcObject=document.hidden?null:f,document.hidden||(this.log.debug("page visible again, triggering startAudio to resume playback and update playback status",this.logContext),this.startAudio()))}),document.body.append(u),this.once(j.Disconnected,()=>{u==null||u.remove(),u=null})}o.push(u)}this.remoteParticipants.forEach(c=>{c.audioTrackPublications.forEach(u=>{u.track&&u.track.attachedElements.forEach(d=>{o.push(d)})})});try{yield Promise.all([this.acquireAudioContext(),...o.map(c=>(c.muted=!1,c.play()))]),this.handleAudioPlaybackStarted()}catch(c){throw this.handleAudioPlaybackFailed(c),c}}),this.startVideo=()=>S(this,void 0,void 0,function*(){const o=[];for(const l of this.remoteParticipants.values())l.videoTrackPublications.forEach(c=>{var u;(u=c.track)===null||u===void 0||u.attachedElements.forEach(d=>{o.includes(d)||o.push(d)})});yield Promise.all(o.map(l=>l.play())).then(()=>{this.handleVideoPlaybackStarted()}).catch(l=>{l.name==="NotAllowedError"?this.handleVideoPlaybackFailed():this.log.warn("Resuming video playback failed, make sure you call `startVideo` directly in a user gesture handler",this.logContext)})}),this.handleRestarting=()=>{this.clearConnectionReconcile(),this.isResuming=!1;for(const o of this.remoteParticipants.values())this.handleParticipantDisconnected(o.identity,o);this.setAndEmitConnectionState(me.Reconnecting)&&this.emit(j.Reconnecting)},this.handleSignalRestarted=o=>S(this,void 0,void 0,function*(){this.log.debug("signal reconnected to server, region ".concat(o.serverRegion),Object.assign(Object.assign({},this.logContext),{region:o.serverRegion})),this.bufferedEvents=[],this.applyJoinResponse(o);try{yield this.localParticipant.republishAllTracks(void 0,!0)}catch(l){this.log.error("error trying to re-publish tracks after reconnection",Object.assign(Object.assign({},this.logContext),{error:l}))}try{yield this.engine.waitForRestarted(),this.log.debug("fully reconnected to server",Object.assign(Object.assign({},this.logContext),{region:o.serverRegion}))}catch{return}this.setAndEmitConnectionState(me.Connected),this.emit(j.Reconnected),this.registerConnectionReconcile(),this.emitBufferedEvents()}),this.handleParticipantUpdates=o=>{o.forEach(l=>{var c;if(l.identity===this.localParticipant.identity){this.localParticipant.updateInfo(l);return}l.identity===""&&(l.identity=(c=this.sidToIdentity.get(l.sid))!==null&&c!==void 0?c:"");let u=this.remoteParticipants.get(l.identity);l.state===Ps.DISCONNECTED?this.handleParticipantDisconnected(l.identity,u):u=this.getOrCreateParticipant(l.identity,l)})},this.handleActiveSpeakersUpdate=o=>{const l=[],c={};o.forEach(u=>{if(c[u.sid]=!0,u.sid===this.localParticipant.sid)this.localParticipant.audioLevel=u.level,this.localParticipant.setIsSpeaking(!0),l.push(this.localParticipant);else{const d=this.getRemoteParticipantBySid(u.sid);d&&(d.audioLevel=u.level,d.setIsSpeaking(!0),l.push(d))}}),c[this.localParticipant.sid]||(this.localParticipant.audioLevel=0,this.localParticipant.setIsSpeaking(!1)),this.remoteParticipants.forEach(u=>{c[u.sid]||(u.audioLevel=0,u.setIsSpeaking(!1))}),this.activeSpeakers=l,this.emitWhenConnected(j.ActiveSpeakersChanged,l)},this.handleSpeakersChanged=o=>{const l=new Map;this.activeSpeakers.forEach(u=>{const d=this.remoteParticipants.get(u.identity);d&&d.sid!==u.sid||l.set(u.sid,u)}),o.forEach(u=>{let d=this.getRemoteParticipantBySid(u.sid);u.sid===this.localParticipant.sid&&(d=this.localParticipant),d&&(d.audioLevel=u.level,d.setIsSpeaking(u.active),u.active?l.set(u.sid,d):l.delete(u.sid))});const c=Array.from(l.values());c.sort((u,d)=>d.audioLevel-u.audioLevel),this.activeSpeakers=c,this.emitWhenConnected(j.ActiveSpeakersChanged,c)},this.handleStreamStateUpdate=o=>{o.streamStates.forEach(l=>{const c=this.getRemoteParticipantBySid(l.participantSid);if(!c)return;const u=c.getTrackPublicationBySid(l.trackSid);if(!u||!u.track)return;const d=U.streamStateFromProto(l.state);u.track.setStreamState(d),d!==u.track.streamState&&(c.emit(V.TrackStreamStateChanged,u,u.track.streamState),this.emitWhenConnected(j.TrackStreamStateChanged,u,u.track.streamState,c))})},this.handleSubscriptionPermissionUpdate=o=>{const l=this.getRemoteParticipantBySid(o.participantSid);if(!l)return;const c=l.getTrackPublicationBySid(o.trackSid);c&&c.setAllowed(o.allowed)},this.handleSubscriptionError=o=>{const l=Array.from(this.remoteParticipants.values()).find(u=>u.trackPublications.has(o.trackSid));if(!l)return;const c=l.getTrackPublicationBySid(o.trackSid);c&&c.setSubscriptionError(o.err)},this.handleDataPacket=(o,l)=>{const c=this.remoteParticipants.get(o.participantIdentity);if(o.value.case==="user")this.handleUserPacket(c,o.value.value,o.kind,l);else if(o.value.case==="transcription")this.handleTranscription(c,o.value.value);else if(o.value.case==="sipDtmf")this.handleSipDtmf(c,o.value.value);else if(o.value.case==="chatMessage")this.handleChatMessage(c,o.value.value);else if(o.value.case==="metrics")this.handleMetrics(o.value.value,c);else if(o.value.case==="streamHeader"||o.value.case==="streamChunk"||o.value.case==="streamTrailer")this.handleDataStream(o,l);else if(o.value.case==="rpcRequest"){const u=o.value.value;this.handleIncomingRpcRequest(o.participantIdentity,u.id,u.method,u.payload,u.responseTimeoutMs,u.version)}},this.handleUserPacket=(o,l,c,u)=>{this.emit(j.DataReceived,l.payload,o,c,l.topic,u),o==null||o.emit(V.DataReceived,l.payload,c,u)},this.handleSipDtmf=(o,l)=>{this.emit(j.SipDTMFReceived,l,o),o==null||o.emit(V.SipDTMFReceived,l)},this.handleTranscription=(o,l)=>{const c=l.transcribedParticipantIdentity===this.localParticipant.identity?this.localParticipant:this.getParticipantByIdentity(l.transcribedParticipantIdentity),u=c==null?void 0:c.trackPublications.get(l.trackId),d=VD(l,this.transcriptionReceivedTimes);u==null||u.emit(B.TranscriptionReceived,d),c==null||c.emit(V.TranscriptionReceived,d,u),this.emit(j.TranscriptionReceived,d,c,u)},this.handleChatMessage=(o,l)=>{const c=HD(l);this.emit(j.ChatMessage,c,o)},this.handleMetrics=(o,l)=>{this.emit(j.MetricsReceived,o,l)},this.handleDataStream=(o,l)=>{this.incomingDataStreamManager.handleDataStreamPacket(o,l)},this.bufferedSegments=new Map,this.handleAudioPlaybackStarted=()=>{this.canPlaybackAudio||(this.audioEnabled=!0,this.emit(j.AudioPlaybackStatusChanged,!0))},this.handleAudioPlaybackFailed=o=>{this.log.warn("could not playback audio",Object.assign(Object.assign({},this.logContext),{error:o})),this.canPlaybackAudio&&(this.audioEnabled=!1,this.emit(j.AudioPlaybackStatusChanged,!1))},this.handleVideoPlaybackStarted=()=>{this.isVideoPlaybackBlocked&&(this.isVideoPlaybackBlocked=!1,this.emit(j.VideoPlaybackStatusChanged,!0))},this.handleVideoPlaybackFailed=()=>{this.isVideoPlaybackBlocked||(this.isVideoPlaybackBlocked=!0,this.emit(j.VideoPlaybackStatusChanged,!1))},this.handleDeviceChange=()=>S(this,void 0,void 0,function*(){var o;((o=jt())===null||o===void 0?void 0:o.os)!=="iOS"&&(yield this.selectDefaultDevices()),this.emit(j.MediaDevicesChanged)}),this.handleRoomUpdate=o=>{const l=this.roomInfo;this.roomInfo=o,l&&l.metadata!==o.metadata&&this.emitWhenConnected(j.RoomMetadataChanged,o.metadata),(l==null?void 0:l.activeRecording)!==o.activeRecording&&this.emitWhenConnected(j.RecordingStatusChanged,o.activeRecording)},this.handleConnectionQualityUpdate=o=>{o.updates.forEach(l=>{if(l.participantSid===this.localParticipant.sid){this.localParticipant.setConnectionQuality(l.quality);return}const c=this.getRemoteParticipantBySid(l.participantSid);c&&c.setConnectionQuality(l.quality)})},this.onLocalParticipantMetadataChanged=o=>{this.emit(j.ParticipantMetadataChanged,o,this.localParticipant)},this.onLocalParticipantNameChanged=o=>{this.emit(j.ParticipantNameChanged,o,this.localParticipant)},this.onLocalAttributesChanged=o=>{this.emit(j.ParticipantAttributesChanged,o,this.localParticipant)},this.onLocalTrackMuted=o=>{this.emit(j.TrackMuted,o,this.localParticipant)},this.onLocalTrackUnmuted=o=>{this.emit(j.TrackUnmuted,o,this.localParticipant)},this.onTrackProcessorUpdate=o=>{var l;(l=o==null?void 0:o.onPublish)===null||l===void 0||l.call(o,this)},this.onLocalTrackPublished=o=>S(this,void 0,void 0,function*(){var l,c,u,d,f,h;(l=o.track)===null||l===void 0||l.on(B.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.on(B.Restarted,this.onLocalTrackRestarted),(f=(d=(u=o.track)===null||u===void 0?void 0:u.getProcessor())===null||d===void 0?void 0:d.onPublish)===null||f===void 0||f.call(d,this),this.emit(j.LocalTrackPublished,o,this.localParticipant),ai(o.track)&&(yield o.track.checkForSilence())&&this.emit(j.LocalAudioSilenceDetected,o);const g=yield(h=o.track)===null||h===void 0?void 0:h.getDeviceId(!1),y=$f(o.source);y&&g&&g!==this.localParticipant.activeDeviceMap.get(y)&&(this.localParticipant.activeDeviceMap.set(y,g),this.emit(j.ActiveDeviceChanged,y,g))}),this.onLocalTrackUnpublished=o=>{var l,c;(l=o.track)===null||l===void 0||l.off(B.TrackProcessorUpdate,this.onTrackProcessorUpdate),(c=o.track)===null||c===void 0||c.off(B.Restarted,this.onLocalTrackRestarted),this.emit(j.LocalTrackUnpublished,o,this.localParticipant)},this.onLocalTrackRestarted=o=>S(this,void 0,void 0,function*(){const l=yield o.getDeviceId(!1),c=$f(o.source);c&&l&&l!==this.localParticipant.activeDeviceMap.get(c)&&(this.log.debug("local track restarted, setting ".concat(c," ").concat(l," active"),this.logContext),this.localParticipant.activeDeviceMap.set(c,l),this.emit(j.ActiveDeviceChanged,c,l))}),this.onLocalConnectionQualityChanged=o=>{this.emit(j.ConnectionQualityChanged,o,this.localParticipant)},this.onMediaDevicesError=(o,l)=>{this.emit(j.MediaDevicesError,o,l)},this.onLocalParticipantPermissionsChanged=o=>{this.emit(j.ParticipantPermissionsChanged,o,this.localParticipant)},this.onLocalChatMessageSent=o=>{this.emit(j.ChatMessage,o,this.localParticipant)},this.setMaxListeners(100),this.remoteParticipants=new Map,this.sidToIdentity=new Map,this.options=Object.assign(Object.assign({},kN),e),this.log=xi((i=this.options.loggerName)!==null&&i!==void 0?i:Dn.Room),this.transcriptionReceivedTimes=new Map,this.options.audioCaptureDefaults=Object.assign(Object.assign({},rk),e==null?void 0:e.audioCaptureDefaults),this.options.videoCaptureDefaults=Object.assign(Object.assign({},ok),e==null?void 0:e.videoCaptureDefaults),this.options.publishDefaults=Object.assign(Object.assign({},CN),e==null?void 0:e.publishDefaults),this.maybeCreateEngine(),this.incomingDataStreamManager=new $N,this.outgoingDataStreamManager=new n2(this.engine,this.log),this.disconnectLock=new xt,this.localParticipant=new u2("","",this.engine,this.options,this.rpcHandlers,this.outgoingDataStreamManager),(this.options.e2ee||this.options.encryption)&&this.setupE2EE(),this.engine.e2eeManager=this.e2eeManager,this.options.videoCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("videoinput",la(this.options.videoCaptureDefaults.deviceId)),this.options.audioCaptureDefaults.deviceId&&this.localParticipant.activeDeviceMap.set("audioinput",la(this.options.audioCaptureDefaults.deviceId)),!((a=this.options.audioOutput)===null||a===void 0)&&a.deviceId&&this.switchActiveDevice("audiooutput",la(this.options.audioOutput.deviceId)).catch(o=>this.log.warn("Could not set audio output: ".concat(o.message),this.logContext)),Ut()){const o=new AbortController;(r=(s=navigator.mediaDevices)===null||s===void 0?void 0:s.addEventListener)===null||r===void 0||r.call(s,"devicechange",this.handleDeviceChange,{signal:o.signal}),Oo.cleanupRegistry&&Oo.cleanupRegistry.register(this,()=>{o.abort()})}}registerTextStreamHandler(e,n){return this.incomingDataStreamManager.registerTextStreamHandler(e,n)}unregisterTextStreamHandler(e){return this.incomingDataStreamManager.unregisterTextStreamHandler(e)}registerByteStreamHandler(e,n){return this.incomingDataStreamManager.registerByteStreamHandler(e,n)}unregisterByteStreamHandler(e){return this.incomingDataStreamManager.unregisterByteStreamHandler(e)}registerRpcMethod(e,n){if(this.rpcHandlers.has(e))throw Error("RPC handler already registered for method ".concat(e,", unregisterRpcMethod before trying to register again"));this.rpcHandlers.set(e,n)}unregisterRpcMethod(e){this.rpcHandlers.delete(e)}setE2EEEnabled(e){return S(this,void 0,void 0,function*(){if(this.e2eeManager)yield Promise.all([this.localParticipant.setE2EEEnabled(e)]),this.localParticipant.identity!==""&&this.e2eeManager.setParticipantCryptorEnabled(e,this.localParticipant.identity);else throw Error("e2ee not configured, please set e2ee settings within the room options")})}setupE2EE(){var e;const n=!!this.options.encryption,i=this.options.encryption||this.options.e2ee;i&&("e2eeManager"in i?(this.e2eeManager=i.e2eeManager,this.e2eeManager.isDataChannelEncryptionEnabled=n):this.e2eeManager=new sN(i,n),this.e2eeManager.on(Zi.ParticipantEncryptionStatusChanged,(a,s)=>{KD(s)&&(this.isE2EEEnabled=a),this.emit(j.ParticipantEncryptionStatusChanged,a,s)}),this.e2eeManager.on(Zi.EncryptionError,(a,s)=>{const r=s?this.getParticipantByIdentity(s):void 0;this.emit(j.EncryptionError,a,r)}),(e=this.e2eeManager)===null||e===void 0||e.setup(this))}get logContext(){var e;return{room:this.name,roomID:(e=this.roomInfo)===null||e===void 0?void 0:e.sid,participant:this.localParticipant.identity,pID:this.localParticipant.sid}}get isRecording(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.activeRecording)!==null&&n!==void 0?n:!1}getSid(){return this.state===me.Disconnected?Tt.resolve(""):this.roomInfo&&this.roomInfo.sid!==""?Tt.resolve(this.roomInfo.sid):new Tt((e,n)=>{const i=a=>{a.sid!==""&&(this.engine.off(F.RoomUpdate,i),e(a.sid))};this.engine.on(F.RoomUpdate,i),this.once(j.Disconnected,()=>{this.engine.off(F.RoomUpdate,i),n(new Ve("Room disconnected before room server id was available"))})})}get name(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.name)!==null&&n!==void 0?n:""}get metadata(){var e;return(e=this.roomInfo)===null||e===void 0?void 0:e.metadata}get numParticipants(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numParticipants)!==null&&n!==void 0?n:0}get numPublishers(){var e,n;return(n=(e=this.roomInfo)===null||e===void 0?void 0:e.numPublishers)!==null&&n!==void 0?n:0}maybeCreateEngine(){this.engine&&!this.engine.isClosed||(this.engine=new JN(this.options),this.engine.e2eeManager=this.e2eeManager,this.engine.on(F.ParticipantUpdate,this.handleParticipantUpdates).on(F.RoomUpdate,this.handleRoomUpdate).on(F.SpeakersChanged,this.handleSpeakersChanged).on(F.StreamStateChanged,this.handleStreamStateUpdate).on(F.ConnectionQualityUpdate,this.handleConnectionQualityUpdate).on(F.SubscriptionError,this.handleSubscriptionError).on(F.SubscriptionPermissionUpdate,this.handleSubscriptionPermissionUpdate).on(F.MediaTrackAdded,(e,n,i)=>{this.onTrackAdded(e,n,i)}).on(F.Disconnected,e=>{this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,e)}).on(F.ActiveSpeakersUpdate,this.handleActiveSpeakersUpdate).on(F.DataPacketReceived,this.handleDataPacket).on(F.Resuming,()=>{this.clearConnectionReconcile(),this.isResuming=!0,this.log.info("Resuming signal connection",this.logContext),this.setAndEmitConnectionState(me.SignalReconnecting)&&this.emit(j.SignalReconnecting)}).on(F.Resumed,()=>{this.registerConnectionReconcile(),this.isResuming=!1,this.log.info("Resumed signal connection",this.logContext),this.updateSubscriptions(),this.emitBufferedEvents(),this.setAndEmitConnectionState(me.Connected)&&this.emit(j.Reconnected)}).on(F.SignalResumed,()=>{this.bufferedEvents=[],(this.state===me.Reconnecting||this.isResuming)&&this.sendSyncState()}).on(F.Restarting,this.handleRestarting).on(F.SignalRestarted,this.handleSignalRestarted).on(F.Offline,()=>{this.setAndEmitConnectionState(me.Reconnecting)&&this.emit(j.Reconnecting)}).on(F.DCBufferStatusChanged,(e,n)=>{this.emit(j.DCBufferStatusChanged,e,n)}).on(F.LocalTrackSubscribed,e=>{const n=this.localParticipant.getTrackPublications().find(i=>{let{trackSid:a}=i;return a===e});if(!n){this.log.warn("could not find local track subscription for subscribed event",this.logContext);return}this.localParticipant.emit(V.LocalTrackSubscribed,n),this.emitWhenConnected(j.LocalTrackSubscribed,n,this.localParticipant)}).on(F.RoomMoved,e=>{this.log.debug("room moved",e),e.room&&this.handleRoomUpdate(e.room),this.remoteParticipants.forEach((n,i)=>{this.handleParticipantDisconnected(i,n)}),this.emit(j.Moved,e.room.name),e.participant?this.handleParticipantUpdates([e.participant,...e.otherParticipants]):this.handleParticipantUpdates(e.otherParticipants)}),this.localParticipant&&this.localParticipant.setupEngine(this.engine),this.e2eeManager&&this.e2eeManager.setupEngine(this.engine),this.outgoingDataStreamManager&&this.outgoingDataStreamManager.setupEngine(this.engine))}static getLocalDevices(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return ut.getInstance().getDevices(e,n)}prepareConnection(e,n){return S(this,void 0,void 0,function*(){if(this.state===me.Disconnected){this.log.debug("prepareConnection to ".concat(e),this.logContext);try{if(tr(new URL(e))&&n){this.regionUrlProvider=new fe(e,n);const i=yield this.regionUrlProvider.getNextBestRegionUrl();i&&this.state===me.Disconnected&&(this.regionUrl=i,yield fetch(wo(i),{method:"HEAD"}),this.log.debug("prepared connection to ".concat(i),this.logContext))}else yield fetch(wo(e),{method:"HEAD"})}catch(i){this.log.warn("could not prepare connection",Object.assign(Object.assign({},this.logContext),{error:i}))}}})}getParticipantByIdentity(e){return this.localParticipant.identity===e?this.localParticipant:this.remoteParticipants.get(e)}clearConnectionFutures(){this.connectFuture=void 0}simulateScenario(e,n){return S(this,void 0,void 0,function*(){let i=()=>S(this,void 0,void 0,function*(){}),a;switch(e){case"signal-reconnect":yield this.engine.client.handleOnClose("simulate disconnect");break;case"speaker":a=new jn({scenario:{case:"speakerUpdate",value:3}});break;case"node-failure":a=new jn({scenario:{case:"nodeFailure",value:!0}});break;case"server-leave":a=new jn({scenario:{case:"serverLeave",value:!0}});break;case"migration":a=new jn({scenario:{case:"migration",value:!0}});break;case"resume-reconnect":this.engine.failNext(),yield this.engine.client.handleOnClose("simulate resume-disconnect");break;case"disconnect-signal-on-resume":i=()=>S(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new jn({scenario:{case:"disconnectSignalOnResume",value:!0}});break;case"disconnect-signal-on-resume-no-messages":i=()=>S(this,void 0,void 0,function*(){yield this.engine.client.handleOnClose("simulate resume-disconnect")}),a=new jn({scenario:{case:"disconnectSignalOnResumeNoMessages",value:!0}});break;case"full-reconnect":this.engine.fullReconnectOnNext=!0,yield this.engine.client.handleOnClose("simulate full-reconnect");break;case"force-tcp":case"force-tls":a=new jn({scenario:{case:"switchCandidateProtocol",value:e==="force-tls"?2:1}}),i=()=>S(this,void 0,void 0,function*(){const s=this.engine.client.onLeave;s&&s(new pu({reason:An.CLIENT_INITIATED,action:Ls.RECONNECT}))});break;case"subscriber-bandwidth":if(n===void 0||typeof n!="number")throw new Error("subscriber-bandwidth requires a number as argument");a=new jn({scenario:{case:"subscriberBandwidth",value:Na(n)}});break;case"leave-full-reconnect":a=new jn({scenario:{case:"leaveRequestFullReconnect",value:!0}})}a&&(yield this.engine.client.sendSimulateScenario(a),yield i())})}get canPlaybackAudio(){return this.audioEnabled}get canPlaybackVideo(){return!this.isVideoPlaybackBlocked}getActiveDevice(e){return this.localParticipant.activeDeviceMap.get(e)}switchActiveDevice(e,n){return S(this,arguments,void 0,function(i,a){var s=this;let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return function*(){var o,l,c,u,d,f,h;let g=!0,y=!1;const T=r?{exact:a}:a;if(i==="audioinput"){y=s.localParticipant.audioTrackPublications.size===0;const m=(o=s.getActiveDevice(i))!==null&&o!==void 0?o:s.options.audioCaptureDefaults.deviceId;s.options.audioCaptureDefaults.deviceId=T;const p=Array.from(s.localParticipant.audioTrackPublications.values()).filter(b=>b.source===U.Source.Microphone);try{g=(yield Promise.all(p.map(b=>{var C;return(C=b.audioTrack)===null||C===void 0?void 0:C.setDeviceId(T)}))).every(b=>b===!0)}catch(b){throw s.options.audioCaptureDefaults.deviceId=m,b}const v=p.some(b=>{var C,_;return(_=(C=b.track)===null||C===void 0?void 0:C.isMuted)!==null&&_!==void 0?_:!1});g&&v&&(y=!0)}else if(i==="videoinput"){y=s.localParticipant.videoTrackPublications.size===0;const m=(l=s.getActiveDevice(i))!==null&&l!==void 0?l:s.options.videoCaptureDefaults.deviceId;s.options.videoCaptureDefaults.deviceId=T;const p=Array.from(s.localParticipant.videoTrackPublications.values()).filter(b=>b.source===U.Source.Camera);try{g=(yield Promise.all(p.map(b=>{var C;return(C=b.videoTrack)===null||C===void 0?void 0:C.setDeviceId(T)}))).every(b=>b===!0)}catch(b){throw s.options.videoCaptureDefaults.deviceId=m,b}const v=p.some(b=>{var C,_;return(_=(C=b.track)===null||C===void 0?void 0:C.isMuted)!==null&&_!==void 0?_:!1});g&&v&&(y=!0)}else if(i==="audiooutput"){if(y=!0,!nh()&&!s.options.webAudioMix||s.options.webAudioMix&&s.audioContext&&!("setSinkId"in s.audioContext))throw new Error("cannot switch audio output, the current browser does not support it");s.options.webAudioMix&&(a=(c=yield ut.getInstance().normalizeDeviceId("audiooutput",a))!==null&&c!==void 0?c:""),(u=(h=s.options).audioOutput)!==null&&u!==void 0||(h.audioOutput={});const m=(d=s.getActiveDevice(i))!==null&&d!==void 0?d:s.options.audioOutput.deviceId;s.options.audioOutput.deviceId=a;try{s.options.webAudioMix&&((f=s.audioContext)===null||f===void 0||f.setSinkId(a)),yield Promise.all(Array.from(s.remoteParticipants.values()).map(p=>p.setAudioOutput({deviceId:a})))}catch(p){throw s.options.audioOutput.deviceId=m,p}}return y&&(s.localParticipant.activeDeviceMap.set(i,a),s.emit(j.ActiveDeviceChanged,i,a)),g}()})}setupLocalParticipantEvents(){this.localParticipant.on(V.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).on(V.ParticipantNameChanged,this.onLocalParticipantNameChanged).on(V.AttributesChanged,this.onLocalAttributesChanged).on(V.TrackMuted,this.onLocalTrackMuted).on(V.TrackUnmuted,this.onLocalTrackUnmuted).on(V.LocalTrackPublished,this.onLocalTrackPublished).on(V.LocalTrackUnpublished,this.onLocalTrackUnpublished).on(V.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).on(V.MediaDevicesError,this.onMediaDevicesError).on(V.AudioStreamAcquired,this.startAudio).on(V.ChatMessage,this.onLocalChatMessageSent).on(V.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged)}recreateEngine(){var e;(e=this.engine)===null||e===void 0||e.close(),this.engine=void 0,this.isResuming=!1,this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.bufferedEvents=[],this.maybeCreateEngine()}onTrackAdded(e,n,i){if(this.state===me.Connecting||this.state===me.Reconnecting){const d=()=>{this.log.debug("deferring on track for later",{mediaTrackId:e.id,mediaStreamId:n.id,tracksInStream:n.getTracks().map(h=>h.id)}),this.onTrackAdded(e,n,i),f()},f=()=>{this.off(j.Reconnected,d),this.off(j.Connected,d),this.off(j.Disconnected,f)};this.once(j.Reconnected,d),this.once(j.Connected,d),this.once(j.Disconnected,f);return}if(this.state===me.Disconnected){this.log.warn("skipping incoming track after Room disconnected",this.logContext);return}if(e.readyState==="ended"){this.log.info("skipping incoming track as it already ended",this.logContext);return}const a=MD(n.id),s=a[0];let r=a[1],o=e.id;if(r&&r.startsWith("TR")&&(o=r),s===this.localParticipant.sid){this.log.warn("tried to create RemoteParticipant for local participant",this.logContext);return}const l=Array.from(this.remoteParticipants.values()).find(d=>d.sid===s);if(!l){this.log.error("Tried to add a track for a participant, that's not present. Sid: ".concat(s),this.logContext);return}if(!o.startsWith("TR")){const d=this.engine.getTrackIdForReceiver(i);if(!d){this.log.error("Tried to add a track whose 'sid' could not be found for a participant, that's not present. Sid: ".concat(s),this.logContext);return}o=d}o.startsWith("TR")||this.log.warn("Tried to add a track whose 'sid' could not be determined for a participant, that's not present. Sid: ".concat(s,", streamId: ").concat(r,", trackId: ").concat(o),Object.assign(Object.assign({},this.logContext),{rpID:s,streamId:r,trackId:o}));let c;this.options.adaptiveStream&&(typeof this.options.adaptiveStream=="object"?c=this.options.adaptiveStream:c={});const u=l.addSubscribedMediaTrack(e,o,n,i,c);u!=null&&u.isEncrypted&&!this.e2eeManager&&this.emit(j.EncryptionError,new Error("Encrypted ".concat(u.source," track received from participant ").concat(l.sid,", but room does not have encryption enabled!")))}handleDisconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,n=arguments.length>1?arguments[1]:void 0;var i,a;if(this.clearConnectionReconcile(),this.isResuming=!1,this.bufferedEvents=[],this.transcriptionReceivedTimes.clear(),this.incomingDataStreamManager.clearControllers(),this.state!==me.Disconnected){this.regionUrl=void 0,this.regionUrlProvider&&this.regionUrlProvider.notifyDisconnected();try{this.remoteParticipants.forEach(s=>{s.trackPublications.forEach(r=>{s.unpublishTrack(r.trackSid)})}),this.localParticipant.trackPublications.forEach(s=>{var r,o,l;s.track&&this.localParticipant.unpublishTrack(s.track,e),e?((r=s.track)===null||r===void 0||r.detach(),(o=s.track)===null||o===void 0||o.stop()):(l=s.track)===null||l===void 0||l.stopMonitor()}),this.localParticipant.off(V.ParticipantMetadataChanged,this.onLocalParticipantMetadataChanged).off(V.ParticipantNameChanged,this.onLocalParticipantNameChanged).off(V.AttributesChanged,this.onLocalAttributesChanged).off(V.TrackMuted,this.onLocalTrackMuted).off(V.TrackUnmuted,this.onLocalTrackUnmuted).off(V.LocalTrackPublished,this.onLocalTrackPublished).off(V.LocalTrackUnpublished,this.onLocalTrackUnpublished).off(V.ConnectionQualityChanged,this.onLocalConnectionQualityChanged).off(V.MediaDevicesError,this.onMediaDevicesError).off(V.AudioStreamAcquired,this.startAudio).off(V.ChatMessage,this.onLocalChatMessageSent).off(V.ParticipantPermissionsChanged,this.onLocalParticipantPermissionsChanged),this.localParticipant.trackPublications.clear(),this.localParticipant.videoTrackPublications.clear(),this.localParticipant.audioTrackPublications.clear(),this.remoteParticipants.clear(),this.sidToIdentity.clear(),this.activeSpeakers=[],this.audioContext&&typeof this.options.webAudioMix=="boolean"&&(this.audioContext.close(),this.audioContext=void 0),Ut()&&(window.removeEventListener("beforeunload",this.onPageLeave),window.removeEventListener("pagehide",this.onPageLeave),window.removeEventListener("freeze",this.onPageLeave),(a=(i=navigator.mediaDevices)===null||i===void 0?void 0:i.removeEventListener)===null||a===void 0||a.call(i,"devicechange",this.handleDeviceChange))}finally{this.setAndEmitConnectionState(me.Disconnected),this.emit(j.Disconnected,n)}}}handleParticipantDisconnected(e,n){var i;this.remoteParticipants.delete(e),n&&(this.incomingDataStreamManager.validateParticipantHasNoActiveDataStreams(e),n.trackPublications.forEach(a=>{n.unpublishTrack(a.trackSid,!0)}),this.emit(j.ParticipantDisconnected,n),n.setDisconnected(),(i=this.localParticipant)===null||i===void 0||i.handleParticipantDisconnected(n.identity))}handleIncomingRpcRequest(e,n,i,a,s,r){return S(this,void 0,void 0,function*(){if(yield this.engine.publishRpcAck(e,n),r!==1){yield this.engine.publishRpcResponse(e,n,null,Fe.builtIn("UNSUPPORTED_VERSION"));return}const o=this.rpcHandlers.get(i);if(!o){yield this.engine.publishRpcResponse(e,n,null,Fe.builtIn("UNSUPPORTED_METHOD"));return}let l=null,c=null;try{const u=yield o({requestId:n,callerIdentity:e,payload:a,responseTimeout:s});ep(u)>ck?(l=Fe.builtIn("RESPONSE_PAYLOAD_TOO_LARGE"),this.log.warn("RPC Response payload too large for ".concat(i))):c=u}catch(u){u instanceof Fe?l=u:(this.log.warn("Uncaught error returned by RPC handler for ".concat(i,". Returning APPLICATION_ERROR instead."),u),l=Fe.builtIn("APPLICATION_ERROR"))}yield this.engine.publishRpcResponse(e,n,c,l)})}selectDefaultDevices(){return S(this,void 0,void 0,function*(){var e,n,i;const a=ut.getInstance().previousDevices,s=yield ut.getInstance().getDevices(void 0,!1),r=jt();if((r==null?void 0:r.name)==="Chrome"&&r.os!=="iOS")for(let l of s){const c=a.find(u=>u.deviceId===l.deviceId);c&&c.label!==""&&c.kind===l.kind&&c.label!==l.label&&this.getActiveDevice(l.kind)==="default"&&this.emit(j.ActiveDeviceChanged,l.kind,l.deviceId)}const o=["audiooutput","audioinput","videoinput"];for(let l of o){const c=CD(l),u=this.localParticipant.getTrackPublication(c);if(u&&(!((e=u.track)===null||e===void 0)&&e.isUserProvided))continue;const d=s.filter(h=>h.kind===l),f=this.getActiveDevice(l);if(f===((n=a.filter(h=>h.kind===l)[0])===null||n===void 0?void 0:n.deviceId)&&d.length>0&&((i=d[0])===null||i===void 0?void 0:i.deviceId)!==f){yield this.switchActiveDevice(l,d[0].deviceId);continue}l==="audioinput"&&!xo()||l==="videoinput"||d.length>0&&!d.find(h=>h.deviceId===this.getActiveDevice(l))&&(l!=="audiooutput"||!xo())&&(yield this.switchActiveDevice(l,d[0].deviceId))}})}acquireAudioContext(){return S(this,void 0,void 0,function*(){var e,n;if(typeof this.options.webAudioMix!="boolean"&&this.options.webAudioMix.audioContext?this.audioContext=this.options.webAudioMix.audioContext:(!this.audioContext||this.audioContext.state==="closed")&&(this.audioContext=(e=ek())!==null&&e!==void 0?e:void 0),this.options.webAudioMix&&this.remoteParticipants.forEach(a=>a.setAudioContext(this.audioContext)),this.localParticipant.setAudioContext(this.audioContext),this.audioContext&&this.audioContext.state==="suspended")try{yield Promise.race([this.audioContext.resume(),bt(200)])}catch(a){this.log.warn("Could not resume audio context",Object.assign(Object.assign({},this.logContext),{error:a}))}const i=((n=this.audioContext)===null||n===void 0?void 0:n.state)==="running";i!==this.canPlaybackAudio&&(this.audioEnabled=i,this.emit(j.AudioPlaybackStatusChanged,i))})}createParticipant(e,n){var i;let a;return n?a=jc.fromParticipantInfo(this.engine.client,n,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}):a=new jc(this.engine.client,"",e,void 0,void 0,void 0,{loggerContextCb:()=>this.logContext,loggerName:this.options.loggerName}),this.options.webAudioMix&&a.setAudioContext(this.audioContext),!((i=this.options.audioOutput)===null||i===void 0)&&i.deviceId&&a.setAudioOutput(this.options.audioOutput).catch(s=>this.log.warn("Could not set audio output: ".concat(s.message),this.logContext)),a}getOrCreateParticipant(e,n){if(this.remoteParticipants.has(e)){const a=this.remoteParticipants.get(e);return n&&a.updateInfo(n)&&this.sidToIdentity.set(n.sid,n.identity),a}const i=this.createParticipant(e,n);return this.remoteParticipants.set(e,i),this.sidToIdentity.set(n.sid,n.identity),this.emitWhenConnected(j.ParticipantConnected,i),i.on(V.TrackPublished,a=>{this.emitWhenConnected(j.TrackPublished,a,i)}).on(V.TrackSubscribed,(a,s)=>{a.kind===U.Kind.Audio?(a.on(B.AudioPlaybackStarted,this.handleAudioPlaybackStarted),a.on(B.AudioPlaybackFailed,this.handleAudioPlaybackFailed)):a.kind===U.Kind.Video&&(a.on(B.VideoPlaybackFailed,this.handleVideoPlaybackFailed),a.on(B.VideoPlaybackStarted,this.handleVideoPlaybackStarted)),this.emit(j.TrackSubscribed,a,s,i)}).on(V.TrackUnpublished,a=>{this.emit(j.TrackUnpublished,a,i)}).on(V.TrackUnsubscribed,(a,s)=>{this.emit(j.TrackUnsubscribed,a,s,i)}).on(V.TrackMuted,a=>{this.emitWhenConnected(j.TrackMuted,a,i)}).on(V.TrackUnmuted,a=>{this.emitWhenConnected(j.TrackUnmuted,a,i)}).on(V.ParticipantMetadataChanged,a=>{this.emitWhenConnected(j.ParticipantMetadataChanged,a,i)}).on(V.ParticipantNameChanged,a=>{this.emitWhenConnected(j.ParticipantNameChanged,a,i)}).on(V.AttributesChanged,a=>{this.emitWhenConnected(j.ParticipantAttributesChanged,a,i)}).on(V.ConnectionQualityChanged,a=>{this.emitWhenConnected(j.ConnectionQualityChanged,a,i)}).on(V.ParticipantPermissionsChanged,a=>{this.emitWhenConnected(j.ParticipantPermissionsChanged,a,i)}).on(V.TrackSubscriptionStatusChanged,(a,s)=>{this.emitWhenConnected(j.TrackSubscriptionStatusChanged,a,s,i)}).on(V.TrackSubscriptionFailed,(a,s)=>{this.emit(j.TrackSubscriptionFailed,a,i,s)}).on(V.TrackSubscriptionPermissionChanged,(a,s)=>{this.emitWhenConnected(j.TrackSubscriptionPermissionChanged,a,s,i)}).on(V.Active,()=>{this.emitWhenConnected(j.ParticipantActive,i),i.kind===Eo.AGENT&&this.localParticipant.setActiveAgent(i)}),n&&i.updateInfo(n),i}sendSyncState(){const e=Array.from(this.remoteParticipants.values()).reduce((i,a)=>(i.push(...a.getTrackPublications()),i),[]),n=this.localParticipant.getTrackPublications();this.engine.sendSyncState(e,n)}updateSubscriptions(){for(const e of this.remoteParticipants.values())for(const n of e.videoTrackPublications.values())n.isSubscribed&&GD(n)&&n.emitTrackUpdate()}getRemoteParticipantBySid(e){const n=this.sidToIdentity.get(e);if(n)return this.remoteParticipants.get(n)}registerConnectionReconcile(){this.clearConnectionReconcile();let e=0;this.connectionReconcileInterval=vt.setInterval(()=>{!this.engine||this.engine.isClosed||!this.engine.verifyTransport()?(e++,this.log.warn("detected connection state mismatch",Object.assign(Object.assign({},this.logContext),{numFailures:e,engine:this.engine?{closed:this.engine.isClosed,transportsConnected:this.engine.verifyTransport()}:void 0})),e>=3&&(this.recreateEngine(),this.handleDisconnect(this.options.stopLocalTrackOnUnpublish,An.STATE_MISMATCH))):e=0},f2)}clearConnectionReconcile(){this.connectionReconcileInterval&&vt.clearInterval(this.connectionReconcileInterval)}setAndEmitConnectionState(e){return e===this.state?!1:(this.state=e,this.emit(j.ConnectionStateChanged,this.state),!0)}emitBufferedEvents(){this.bufferedEvents.forEach(e=>{let[n,i]=e;this.emit(n,...i)}),this.bufferedEvents=[]}emitWhenConnected(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];if(this.state===me.Reconnecting||this.isResuming||!this.engine||this.engine.pendingReconnect)this.bufferedEvents.push([e,i]);else if(this.state===me.Connected)return this.emit(e,...i);return!1}simulateParticipants(e){return S(this,void 0,void 0,function*(){var n,i,a,s;const r=Object.assign({audio:!0,video:!0,useRealTracks:!1},e.publish),o=Object.assign({count:9,audio:!1,video:!0,aspectRatios:[1.66,1.7,1.3]},e.participants);if(this.handleDisconnect(),this.roomInfo=new du({sid:"RM_SIMULATED",name:"simulated-room",emptyTimeout:0,maxParticipants:0,creationTime:Ue.parse(new Date().getTime()),metadata:"",numParticipants:1,numPublishers:1,turnPassword:"",enabledCodecs:[],activeRecording:!1}),this.localParticipant.updateInfo(new Ka({identity:"simulated-local",name:"local-name"})),this.setupLocalParticipantEvents(),this.emit(j.SignalConnected),this.emit(j.Connected),this.setAndEmitConnectionState(me.Connected),r.video){const l=new ch(U.Kind.Video,new Es({source:Xe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:xn.AUDIO,name:"video-dummy"}),new Ic(r.useRealTracks&&(!((n=window.navigator.mediaDevices)===null||n===void 0)&&n.getUserMedia)?(yield window.navigator.mediaDevices.getUserMedia({video:!0})).getVideoTracks()[0]:Jv(160*((i=o.aspectRatios[0])!==null&&i!==void 0?i:1),160,!0,!0),void 0,!1,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(V.LocalTrackPublished,l)}if(r.audio){const l=new ch(U.Kind.Audio,new Es({source:Xe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:xn.AUDIO}),new Uc(r.useRealTracks&&(!((a=navigator.mediaDevices)===null||a===void 0)&&a.getUserMedia)?(yield navigator.mediaDevices.getUserMedia({audio:!0})).getAudioTracks()[0]:_d(),void 0,!1,this.audioContext,{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext}),{loggerName:this.options.loggerName,loggerContextCb:()=>this.logContext});this.localParticipant.addTrackPublication(l),this.localParticipant.emit(V.LocalTrackPublished,l)}for(let l=0;l<o.count-1;l+=1){let c=new Ka({sid:Math.floor(Math.random()*1e4).toString(),identity:"simulated-".concat(l),state:Ps.ACTIVE,tracks:[],joinedAt:Ue.parse(Date.now())});const u=this.getOrCreateParticipant(c.identity,c);if(o.video){const d=Jv(160*((s=o.aspectRatios[l%o.aspectRatios.length])!==null&&s!==void 0?s:1),160,!1,!0),f=new Es({source:Xe.CAMERA,sid:Math.floor(Math.random()*1e4).toString(),type:xn.AUDIO});u.addSubscribedMediaTrack(d,f.sid,new MediaStream([d]),new RTCRtpReceiver),c.tracks=[...c.tracks,f]}if(o.audio){const d=_d(),f=new Es({source:Xe.MICROPHONE,sid:Math.floor(Math.random()*1e4).toString(),type:xn.AUDIO});u.addSubscribedMediaTrack(d,f.sid,new MediaStream([d]),new RTCRtpReceiver),c.tracks=[...c.tracks,f]}u.updateInfo(c)}})}emit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];if(e!==j.ActiveSpeakersChanged&&e!==j.TranscriptionReceived){const s=vk(i).filter(r=>r!==void 0);(e===j.TrackSubscribed||e===j.TrackUnsubscribed)&&this.log.trace("subscribe trace: ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s})),this.log.debug("room event ".concat(e),Object.assign(Object.assign({},this.logContext),{event:e,args:s}))}return super.emit(e,...i)}}Oo.cleanupRegistry=typeof FinalizationRegistry<"u"&&new FinalizationRegistry(t=>{t()});function vk(t){return t.map(e=>{if(e)return Array.isArray(e)?vk(e):typeof e=="object"?"logContext"in e?e.logContext:void 0:e})}var Rn;(function(t){t[t.IDLE=0]="IDLE",t[t.RUNNING=1]="RUNNING",t[t.SKIPPED=2]="SKIPPED",t[t.SUCCESS=3]="SUCCESS",t[t.FAILED=4]="FAILED"})(Rn||(Rn={}));class ka extends Zn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.status=Rn.IDLE,this.logs=[],this.options={},this.url=e,this.token=n,this.name=this.constructor.name,this.room=new Oo(i.roomOptions),this.connectOptions=i.connectOptions,this.options=i}run(e){return S(this,void 0,void 0,function*(){if(this.status!==Rn.IDLE)throw Error("check is running already");this.setStatus(Rn.RUNNING);try{yield this.perform()}catch(n){n instanceof Error&&(this.options.errorsAsWarnings?this.appendWarning(n.message):this.appendError(n.message))}return yield this.disconnect(),yield new Promise(n=>setTimeout(n,500)),this.status!==Rn.SKIPPED&&this.setStatus(this.isSuccess()?Rn.SUCCESS:Rn.FAILED),e&&e(),this.getInfo()})}isSuccess(){return!this.logs.some(e=>e.level==="error")}connect(e){return S(this,void 0,void 0,function*(){return this.room.state===me.Connected?this.room:(e||(e=this.url),yield this.room.connect(e,this.token,this.connectOptions),this.room)})}disconnect(){return S(this,void 0,void 0,function*(){this.room&&this.room.state!==me.Disconnected&&(yield this.room.disconnect(),yield new Promise(e=>setTimeout(e,500)))})}skip(){this.setStatus(Rn.SKIPPED)}switchProtocol(e){return S(this,void 0,void 0,function*(){let n=!1,i=!1;if(this.room.on(j.Reconnecting,()=>{n=!0}),this.room.once(j.Reconnected,()=>{i=!0}),this.room.simulateScenario("force-".concat(e)),yield new Promise(s=>setTimeout(s,1e3)),!n)return;const a=Date.now()+1e4;for(;Date.now()<a;){if(i)return;yield bt(100)}throw new Error("Could not reconnect using ".concat(e," protocol after 10 seconds"))})}appendMessage(e){this.logs.push({level:"info",message:e}),this.emit("update",this.getInfo())}appendWarning(e){this.logs.push({level:"warning",message:e}),this.emit("update",this.getInfo())}appendError(e){this.logs.push({level:"error",message:e}),this.emit("update",this.getInfo())}setStatus(e){this.status=e,this.emit("update",this.getInfo())}get engine(){var e;return(e=this.room)===null||e===void 0?void 0:e.engine}getInfo(){return{logs:this.logs,name:this.name,status:this.status,description:this.description}}}class h2 extends ka{get description(){return"Cloud regions"}perform(){return S(this,void 0,void 0,function*(){const e=new fe(this.url,this.token);if(!e.isCloud()){this.skip();return}const n=[],i=new Set;for(let s=0;s<3;s++){const r=yield e.getNextBestRegionUrl();if(!r)break;if(i.has(r))continue;i.add(r);const o=yield this.checkCloudRegion(r);this.appendMessage("".concat(o.region," RTT: ").concat(o.rtt,"ms, duration: ").concat(o.duration,"ms")),n.push(o)}n.sort((s,r)=>(s.duration-r.duration)*.5+(s.rtt-r.rtt)*.5);const a=n[0];this.bestStats=a,this.appendMessage("best Cloud region: ".concat(a.region))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkCloudRegion(e){return S(this,void 0,void 0,function*(){var n,i;yield this.connect(e),this.options.protocol==="tcp"&&(yield this.switchProtocol("tcp"));const a=(n=this.room.serverInfo)===null||n===void 0?void 0:n.region;if(!a)throw new Error("Region not found");const s=yield this.room.localParticipant.streamText({topic:"test"}),r=1e3,l=1e6/r,c="A".repeat(r),u=Date.now();for(let g=0;g<l;g++)yield s.write(c);yield s.close();const d=Date.now(),f=yield(i=this.room.engine.pcManager)===null||i===void 0?void 0:i.publisher.getStats(),h={region:a,rtt:1e4,duration:d-u};return f==null||f.forEach(g=>{g.type==="candidate-pair"&&g.nominated&&(h.rtt=g.currentRoundTripTime*1e3)}),yield this.disconnect(),h})}}const Pd=1e4;class m2 extends ka{get description(){return"Connection via UDP vs TCP"}perform(){return S(this,void 0,void 0,function*(){const e=yield this.checkConnectionProtocol("udp"),n=yield this.checkConnectionProtocol("tcp");this.bestStats=e,e.qualityLimitationDurations.bandwidth-n.qualityLimitationDurations.bandwidth>.5||(e.packetsLost-n.packetsLost)/e.packetsSent>.01?(this.appendMessage("best connection quality via tcp"),this.bestStats=n):this.appendMessage("best connection quality via udp");const i=this.bestStats;this.appendMessage("upstream bitrate: ".concat((i.bitrateTotal/i.count/1e3/1e3).toFixed(2)," mbps")),this.appendMessage("RTT: ".concat((i.rttTotal/i.count*1e3).toFixed(2)," ms")),this.appendMessage("jitter: ".concat((i.jitterTotal/i.count*1e3).toFixed(2)," ms")),i.packetsLost>0&&this.appendWarning("packets lost: ".concat((i.packetsLost/i.packetsSent*100).toFixed(2),"%")),i.qualityLimitationDurations.bandwidth>1&&this.appendWarning("bandwidth limited ".concat((i.qualityLimitationDurations.bandwidth/(Pd/1e3)*100).toFixed(2),"%")),i.qualityLimitationDurations.cpu>0&&this.appendWarning("cpu limited ".concat((i.qualityLimitationDurations.cpu/(Pd/1e3)*100).toFixed(2),"%"))})}getInfo(){const e=super.getInfo();return e.data=this.bestStats,e}checkConnectionProtocol(e){return S(this,void 0,void 0,function*(){yield this.connect(),e==="tcp"?yield this.switchProtocol("tcp"):yield this.switchProtocol("udp");const n=document.createElement("canvas");n.width=1280,n.height=720;const i=n.getContext("2d");if(!i)throw new Error("Could not get canvas context");let a=0;const s=()=>{a=(a+1)%360,i.fillStyle="hsl(".concat(a,", 100%, 50%)"),i.fillRect(0,0,n.width,n.height),requestAnimationFrame(s)};s();const o=n.captureStream(30).getVideoTracks()[0],c=(yield this.room.localParticipant.publishTrack(o,{simulcast:!1,degradationPreference:"maintain-resolution",videoEncoding:{maxBitrate:2e6}})).track,u={protocol:e,packetsLost:0,packetsSent:0,qualityLimitationDurations:{},rttTotal:0,jitterTotal:0,bitrateTotal:0,count:0},d=setInterval(()=>S(this,void 0,void 0,function*(){const f=yield c.getRTCStatsReport();f==null||f.forEach(h=>{h.type==="outbound-rtp"?(u.packetsSent=h.packetsSent,u.qualityLimitationDurations=h.qualityLimitationDurations,u.bitrateTotal+=h.targetBitrate,u.count++):h.type==="remote-inbound-rtp"&&(u.packetsLost=h.packetsLost,u.rttTotal+=h.roundTripTime,u.jitterTotal+=h.jitter)})}),1e3);return yield new Promise(f=>setTimeout(f,Pd)),clearInterval(d),o.stop(),n.remove(),yield this.disconnect(),u})}}class p2 extends ka{get description(){return"Can publish audio"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield o2();if(yield $C(i,1e3))throw new Error("unable to detect audio from microphone");this.appendMessage("detected audio from microphone"),n.localParticipant.publishTrack(i),yield new Promise(o=>setTimeout(o,3e3));const s=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!s)throw new Error("Could not get RTCStats");let r=0;if(s.forEach(o=>{o.type==="outbound-rtp"&&(o.kind==="audio"||!o.kind&&o.mediaType==="audio")&&(r=o.packetsSent)}),r===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(r," audio packets"))})}}class g2 extends ka{get description(){return"Can publish video"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect(),i=yield r2();yield this.checkForVideo(i.mediaStreamTrack),n.localParticipant.publishTrack(i),yield new Promise(r=>setTimeout(r,5e3));const a=yield(e=i.sender)===null||e===void 0?void 0:e.getStats();if(!a)throw new Error("Could not get RTCStats");let s=0;if(a.forEach(r=>{r.type==="outbound-rtp"&&(r.kind==="video"||!r.kind&&r.mediaType==="video")&&(s+=r.packetsSent)}),s===0)throw new Error("Could not determine packets are sent");this.appendMessage("published ".concat(s," video packets"))})}checkForVideo(e){return S(this,void 0,void 0,function*(){const n=new MediaStream;n.addTrack(e.clone());const i=document.createElement("video");i.srcObject=n,i.muted=!0,i.autoplay=!0,i.playsInline=!0,i.setAttribute("playsinline","true"),document.body.appendChild(i),yield new Promise(a=>{i.onplay=()=>{setTimeout(()=>{var s,r,o,l;const c=document.createElement("canvas"),u=e.getSettings(),d=(r=(s=u.width)!==null&&s!==void 0?s:i.videoWidth)!==null&&r!==void 0?r:1280,f=(l=(o=u.height)!==null&&o!==void 0?o:i.videoHeight)!==null&&l!==void 0?l:720;c.width=d,c.height=f;const h=c.getContext("2d");h.drawImage(i,0,0);const y=h.getImageData(0,0,c.width,c.height).data;let T=!0;for(let m=0;m<y.length;m+=4)if(y[m]!==0||y[m+1]!==0||y[m+2]!==0){T=!1;break}T?this.appendError("camera appears to be producing only black frames"):this.appendMessage("received video frames"),a()},1e3)},i.play()}),n.getTracks().forEach(a=>a.stop()),i.remove()})}}class v2 extends ka{get description(){return"Resuming connection after interruption"}perform(){return S(this,void 0,void 0,function*(){var e;const n=yield this.connect();let i=!1,a=!1,s;const r=new Promise(c=>{setTimeout(c,5e3),s=c}),o=()=>{i=!0};n.on(j.SignalReconnecting,o).on(j.Reconnecting,o).on(j.Reconnected,()=>{a=!0,s(!0)}),(e=n.engine.client.ws)===null||e===void 0||e.close();const l=n.engine.client.onClose;if(l&&l(""),yield r,i){if(!a||n.state!==me.Connected)throw this.appendWarning("reconnection is only possible in Redis-based configurations"),new Error("Not able to reconnect")}else throw new Error("Did not attempt to reconnect")})}}class b2 extends ka{get description(){return"Can connect via TURN"}perform(){return S(this,void 0,void 0,function*(){var e,n,i;tr(new URL(this.url))&&(this.appendMessage("Using region specific url"),this.url=(e=yield new fe(this.url,this.token).getNextBestRegionUrl())!==null&&e!==void 0?e:this.url);const a=new Jm,s=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0);let r=!1,o=!1,l=!1;for(let c of s.iceServers)for(let u of c.urls)u.startsWith("turn:")?(o=!0,l=!0):u.startsWith("turns:")&&(o=!0,l=!0,r=!0),u.startsWith("stun:")&&(l=!0);l?o&&!r&&this.appendWarning("TURN is configured server side, but TURN/TLS is unavailable."):this.appendWarning("No STUN servers configured on server side."),yield a.close(),!((i=(n=this.connectOptions)===null||n===void 0?void 0:n.rtcConfig)===null||i===void 0)&&i.iceServers||o?yield this.room.connect(this.url,this.token,{rtcConfig:{iceTransportPolicy:"relay"}}):(this.appendWarning("No TURN servers configured."),this.skip(),yield new Promise(c=>setTimeout(c,0)))})}}class y2 extends ka{get description(){return"Establishing WebRTC connection"}perform(){return S(this,void 0,void 0,function*(){let e=!1,n=!1;this.room.on(j.SignalConnected,()=>{var i;const a=this.room.engine.client.onTrickle;this.room.engine.client.onTrickle=(s,r)=>{if(s.candidate){const o=new RTCIceCandidate(s);let l="".concat(o.protocol," ").concat(o.address,":").concat(o.port," ").concat(o.type);o.address&&(S2(o.address)?l+=" (private)":o.protocol==="tcp"&&o.tcpType==="passive"?(e=!0,l+=" (passive)"):o.protocol==="udp"&&(n=!0)),this.appendMessage(l)}a&&a(s,r)},!((i=this.room.engine.pcManager)===null||i===void 0)&&i.subscriber&&(this.room.engine.pcManager.subscriber.onIceCandidateError=s=>{s instanceof RTCPeerConnectionIceErrorEvent&&this.appendWarning("error with ICE candidate: ".concat(s.errorCode," ").concat(s.errorText," ").concat(s.url))})});try{yield this.connect(),ie.info("now the room is connected")}catch(i){throw this.appendWarning("ports need to be open on firewall in order to connect."),i}e||this.appendWarning("Server is not configured for ICE/TCP"),n||this.appendWarning("No public IPv4 UDP candidates were found. Your server is likely not configured correctly")})}}function S2(t){const e=t.split(".");if(e.length===4){if(e[0]==="10")return!0;if(e[0]==="192"&&e[1]==="168")return!0;if(e[0]==="172"){const n=parseInt(e[1],10);if(n>=16&&n<=31)return!0}}return!1}class T2 extends ka{get description(){return"Connecting to signal connection via WebSocket"}perform(){return S(this,void 0,void 0,function*(){var e,n,i;(this.url.startsWith("ws:")||this.url.startsWith("http:"))&&this.appendWarning("Server is insecure, clients may block connections to it");let a=new Jm,s;try{s=yield a.join(this.url,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0)}catch(r){if(tr(new URL(this.url))){this.appendMessage("Initial connection failed with error ".concat(r.message,". Retrying with region fallback"));const l=yield new fe(this.url,this.token).getNextBestRegionUrl();l&&(s=yield a.join(l,this.token,{autoSubscribe:!0,maxRetries:0,e2eeEnabled:!1,websocketTimeout:15e3},void 0,!0),this.appendMessage("Fallback to region worked. To avoid initial connections failing, ensure you're calling room.prepareConnection() ahead of time"))}}s?(this.appendMessage("Connected to server, version ".concat(s.serverVersion,".")),((e=s.serverInfo)===null||e===void 0?void 0:e.edition)===$T.Cloud&&(!((n=s.serverInfo)===null||n===void 0)&&n.region)&&this.appendMessage("LiveKit Cloud: ".concat((i=s.serverInfo)===null||i===void 0?void 0:i.region))):this.appendError("Websocket connection could not be established"),yield a.close()})}}class Y2 extends Zn.EventEmitter{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};super(),this.options={},this.checkResults=new Map,this.url=e,this.token=n,this.options=i}getNextCheckId(){const e=this.checkResults.size;return this.checkResults.set(e,{logs:[],status:Rn.IDLE,name:"",description:""}),e}updateCheck(e,n){this.checkResults.set(e,n),this.emit("checkUpdate",e,n)}isSuccess(){return Array.from(this.checkResults.values()).every(e=>e.status!==Rn.FAILED)}getResults(){return Array.from(this.checkResults.values())}createAndRunCheck(e){return S(this,void 0,void 0,function*(){const n=this.getNextCheckId(),i=new e(this.url,this.token,this.options),a=r=>{this.updateCheck(n,r)};i.on("update",a);const s=yield i.run();return i.off("update",a),s})}checkWebsocket(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(T2)})}checkWebRTC(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(y2)})}checkTURN(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(b2)})}checkReconnect(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(v2)})}checkPublishAudio(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(p2)})}checkPublishVideo(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(g2)})}checkConnectionProtocol(){return S(this,void 0,void 0,function*(){const e=yield this.createAndRunCheck(m2);if(e.data&&"protocol"in e.data){const n=e.data;this.options.protocol=n.protocol}return e})}checkCloudRegion(){return S(this,void 0,void 0,function*(){return this.createAndRunCheck(h2)})}}function le(t,e,n){return(e=k2(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function C2(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var i=n.call(t,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function k2(t){var e=C2(t,"string");return typeof e=="symbol"?e:e+""}new TextEncoder;new TextDecoder;class Ot extends Error{constructor(e,n){var i;super(e,n),le(this,"code","ERR_JOSE_GENERIC"),this.name=this.constructor.name,(i=Error.captureStackTrace)===null||i===void 0||i.call(Error,this,this.constructor)}}le(Ot,"code","ERR_JOSE_GENERIC");class E2 extends Ot{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:a,payload:n}}),le(this,"code","ERR_JWT_CLAIM_VALIDATION_FAILED"),le(this,"claim",void 0),le(this,"reason",void 0),le(this,"payload",void 0),this.claim=i,this.reason=a,this.payload=n}}le(E2,"code","ERR_JWT_CLAIM_VALIDATION_FAILED");class _2 extends Ot{constructor(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"unspecified",a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"unspecified";super(e,{cause:{claim:i,reason:a,payload:n}}),le(this,"code","ERR_JWT_EXPIRED"),le(this,"claim",void 0),le(this,"reason",void 0),le(this,"payload",void 0),this.claim=i,this.reason=a,this.payload=n}}le(_2,"code","ERR_JWT_EXPIRED");class R2 extends Ot{constructor(){super(...arguments),le(this,"code","ERR_JOSE_ALG_NOT_ALLOWED")}}le(R2,"code","ERR_JOSE_ALG_NOT_ALLOWED");class x2 extends Ot{constructor(){super(...arguments),le(this,"code","ERR_JOSE_NOT_SUPPORTED")}}le(x2,"code","ERR_JOSE_NOT_SUPPORTED");class w2 extends Ot{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"decryption operation failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),le(this,"code","ERR_JWE_DECRYPTION_FAILED")}}le(w2,"code","ERR_JWE_DECRYPTION_FAILED");class O2 extends Ot{constructor(){super(...arguments),le(this,"code","ERR_JWE_INVALID")}}le(O2,"code","ERR_JWE_INVALID");class A2 extends Ot{constructor(){super(...arguments),le(this,"code","ERR_JWS_INVALID")}}le(A2,"code","ERR_JWS_INVALID");class M2 extends Ot{constructor(){super(...arguments),le(this,"code","ERR_JWT_INVALID")}}le(M2,"code","ERR_JWT_INVALID");class D2 extends Ot{constructor(){super(...arguments),le(this,"code","ERR_JWK_INVALID")}}le(D2,"code","ERR_JWK_INVALID");class N2 extends Ot{constructor(){super(...arguments),le(this,"code","ERR_JWKS_INVALID")}}le(N2,"code","ERR_JWKS_INVALID");class P2 extends Ot{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"no applicable key found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),le(this,"code","ERR_JWKS_NO_MATCHING_KEY")}}le(P2,"code","ERR_JWKS_NO_MATCHING_KEY");class L2 extends Ot{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"multiple matching keys found in the JSON Web Key Set",n=arguments.length>1?arguments[1]:void 0;super(e,n),le(this,Symbol.asyncIterator,void 0),le(this,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS")}}le(L2,"code","ERR_JWKS_MULTIPLE_MATCHING_KEYS");class U2 extends Ot{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"request timed out",n=arguments.length>1?arguments[1]:void 0;super(e,n),le(this,"code","ERR_JWKS_TIMEOUT")}}le(U2,"code","ERR_JWKS_TIMEOUT");class I2 extends Ot{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"signature verification failed",n=arguments.length>1?arguments[1]:void 0;super(e,n),le(this,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED")}}le(I2,"code","ERR_JWS_SIGNATURE_VERIFICATION_FAILED");var y0;(function(t){t[t.Reserved=0]="Reserved",t[t.TooLarge=1]="TooLarge"})(y0||(y0={}));var S0;(function(t){t[t.TooShort=0]="TooShort",t[t.HeaderOverrun=1]="HeaderOverrun",t[t.MissingExtWords=2]="MissingExtWords",t[t.UnsupportedVersion=3]="UnsupportedVersion",t[t.InvalidHandle=4]="InvalidHandle",t[t.MalformedExt=5]="MalformedExt"})(S0||(S0={}));var T0;(function(t){t[t.TooSmallForHeader=0]="TooSmallForHeader",t[t.TooSmallForPayload=1]="TooSmallForPayload"})(T0||(T0={}));var Bc;(function(t){t[t.UserTimestamp=2]="UserTimestamp",t[t.E2ee=1]="E2ee"})(Bc||(Bc={}));Bc.UserTimestamp;Bc.E2ee;var C0;(function(t){t[t.Start=0]="Start",t[t.Inter=1]="Inter",t[t.Final=2]="Final",t[t.Single=3]="Single"})(C0||(C0={}));const j2=()=>{const t=[{piece:"Rey",icon:"",value:"Fin del juego",desc:"La pieza ms importante. Mueve una casilla en cualquier direccin. No puede ser capturado y nunca puede moverse a una casilla atacada (jaque)."},{piece:"Dama",icon:"",value:"9 puntos",desc:"La pieza ms poderosa. Combina los movimientos de la torre y el alfil: mueve cualquier nmero de casillas en vertical, horizontal o diagonal."},{piece:"Torre",icon:"",value:"5 puntos",desc:"Mueve cualquier nmero de casillas en horizontal o vertical. Es fundamental para el enroque."},{piece:"Alfil",icon:"",value:"3 puntos",desc:"Mueve cualquier nmero de casillas siempre en diagonal. Se mantiene siempre en casillas del mismo color que su casilla de origen."},{piece:"Caballo",icon:"",value:"3 puntos",desc:'Mueve en forma de "L" (dos casillas en una direccin y una en perpendicular). Es la nica pieza que puede saltar sobre otras.'},{piece:"Pen",icon:"",value:"1 punto",desc:"Mueve una casilla hacia adelante (dos en su primer movimiento). Captura en diagonal. Puede promocionar al llegar al final del tablero."}],e=[{name:"Enroque",desc:"Movimiento del rey y la torre para proteger al monarca."},{name:"Al Paso",desc:"Captura especial de pen inmediatamente despus de que un pen contrario mueva dos casillas."},{name:"Promocin",desc:"Un pen llega a la ltima fila y se transforma en Dama, Torre, Alfil o Caballo."}];return k.jsxs("div",{className:"flex-grow overflow-y-auto p-4 space-y-6 custom-scrollbar bg-[#262421]",children:[k.jsxs("section",{children:[k.jsx("h3",{className:"text-[#bf811d] font-bold text-xs uppercase tracking-widest mb-4",children:"Piezas y Movimientos"}),k.jsx("div",{className:"space-y-4",children:t.map((n,i)=>k.jsxs("div",{className:"bg-[#161512] p-3 rounded-lg border border-[#302e2b] hover:border-[#bf811d]/50 transition-colors",children:[k.jsxs("div",{className:"flex justify-between items-center mb-1",children:[k.jsx("span",{className:"text-xl mr-2 text-white",children:n.icon}),k.jsx("span",{className:"font-bold text-sm text-white",children:n.piece}),k.jsx("span",{className:"text-[10px] text-[#666] uppercase font-bold ml-auto",children:n.value})]}),k.jsx("p",{className:"text-xs text-[#bababa] leading-relaxed",children:n.desc})]},i))})]}),k.jsxs("section",{children:[k.jsx("h3",{className:"text-[#bf811d] font-bold text-xs uppercase tracking-widest mb-4",children:"Movimientos Especiales"}),k.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.map((n,i)=>k.jsxs("div",{className:"bg-[#1a1917] p-2 rounded-md border border-[#302e2b] flex items-center justify-between",children:[k.jsx("span",{className:"text-xs font-bold text-[#bababa]",children:n.name}),k.jsx("span",{className:"text-[10px] text-[#666]",children:n.desc})]},i))})]})]})},B2=()=>{const{teacherId:t}=IS(),{userRole:e,currentUserId:n}=yi.useContext(is),[i,a]=x.useState(""),[s,r]=x.useState("audio"),o=ru();return x.useEffect(()=>{if(e==="student"&&pe.getRequestStatus(n,t)!=="approved"){alert("Debes solicitar acceso al profesor primero."),o(`/chat/${t}`);return}a("ey_MOCK_TOKEN_FOR_MVP_PURPOSES_ONLY_ey")},[e,n,t,o]),i?k.jsx("div",{className:"flex flex-col h-[calc(100vh-100px)] gap-4 pt-4",children:k.jsxs("div",{className:"flex flex-grow gap-4 h-full",children:[k.jsx("div",{className:"flex-grow bg-[#161512] rounded-xl overflow-hidden flex flex-col shadow-2xl border border-[#302e2b] h-full relative",children:k.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4",children:k.jsx(uA,{teacherId:t})})}),k.jsxs("div",{className:"w-80 flex flex-col gap-3",children:[k.jsxs("div",{className:"flex justify-between items-center bg-[#262421] p-3 rounded-lg border border-[#302e2b] shadow-lg",children:[k.jsxs("h2",{className:"text-xs font-bold text-white uppercase tracking-widest",children:["Sala: ",t]}),k.jsx("button",{onClick:()=>o(e==="teacher"?"/dashboard":"/"),className:"bg-red-600 hover:bg-red-700 text-white p-1 rounded-md text-[10px] px-3 transition-all shadow-md font-bold uppercase",children:"Salir"})]}),k.jsxs("div",{className:"flex bg-[#161512] p-1 rounded-lg border border-[#302e2b]",children:[k.jsx("button",{onClick:()=>r("audio"),className:`flex-1 py-1.5 text-[10px] font-bold uppercase rounded-md transition-all ${s==="audio"?"bg-[#363431] text-white shadow-sm":"text-[#666] hover:text-[#999]"}`,children:"Voz"}),k.jsx("button",{onClick:()=>r("chat"),className:`flex-1 py-1.5 text-[10px] font-bold uppercase rounded-md transition-all ${s==="chat"?"bg-[#363431] text-white shadow-sm":"text-[#666] hover:text-[#999]"}`,children:"Chat"}),k.jsx("button",{onClick:()=>r("rules"),className:`flex-1 py-1.5 text-[10px] font-bold uppercase rounded-md transition-all ${s==="rules"?"bg-[#363431] text-white shadow-sm":"text-[#666] hover:text-[#999]"}`,children:"Reglas"})]}),k.jsxs("div",{className:"flex-grow bg-[#262421] border border-[#302e2b] rounded-lg flex flex-col overflow-hidden shadow-2xl relative",children:[s==="audio"&&k.jsxs("div",{className:"h-full flex flex-col",children:[k.jsxs("div",{className:"bg-[#161512] p-3 border-b border-[#302e2b] flex justify-between items-center",children:[k.jsx("h3",{className:"font-bold text-xs text-[#bababa] uppercase tracking-tight",children:"Voz en Directo"}),k.jsxs("div",{className:"flex items-center gap-1",children:[k.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse shadow-[0_0_5px_#22c55e]"}),k.jsx("span",{className:"text-[10px] text-[#bababa] font-medium uppercase",children:"Live"})]})]}),k.jsxs("div",{className:"flex-grow flex flex-col justify-center items-center p-4",children:[k.jsx("div",{className:"w-14 h-14 bg-[#161512] rounded-full mx-auto flex items-center justify-center mb-3 border border-[#302e2b] shadow-inner",children:k.jsx("span",{className:"text-xl opacity-80",children:""})}),k.jsx("p",{className:"text-[10px] text-[#666] uppercase font-bold tracking-widest",children:"Canal de Audio"}),k.jsx("p",{className:"text-xs text-[#bababa] mt-1 font-medium",children:t})]})]}),s==="chat"&&k.jsxs("div",{className:"h-full flex flex-col",children:[k.jsx("div",{className:"bg-[#161512] p-3 border-b border-[#302e2b]",children:k.jsx("h3",{className:"font-bold text-xs text-[#bababa] uppercase tracking-tight",children:"Mensajes"})}),k.jsxs("div",{className:"flex-grow p-4 overflow-y-auto space-y-3 custom-scrollbar",children:[k.jsxs("div",{className:"text-sm",children:[k.jsxs("span",{className:"font-bold text-[#bf811d] mr-2",children:["GM ",t,":"]}),k.jsx("span",{className:"text-[#bababa]",children:"Bienvenidos a la clase. Analicemos esta posicin."})]}),k.jsxs("div",{className:"text-sm",children:[k.jsx("span",{className:"font-bold text-blue-400 mr-2",children:"Alumno:"}),k.jsx("span",{className:"text-[#bababa]",children:"Entendido!"})]})]}),k.jsx("div",{className:"p-3 border-t border-[#302e2b] bg-[#161512]",children:k.jsx("input",{type:"text",placeholder:"Escribe un mensaje...",className:"w-full bg-[#262421] border border-[#302e2b] rounded px-3 py-2 text-sm text-white focus:outline-none focus:border-[#bf811d] transition-colors"})})]}),s==="rules"&&k.jsx(j2,{})]})]})]})}):k.jsx("div",{className:"text-center mt-10",children:"Cargando aula..."})},q2=()=>{const{teacherId:t}=IS(),{userRole:e,currentUserId:n}=yi.useContext(is),i=ru(),[a,s]=x.useState([]),[r,o]=x.useState(""),[l,c]=x.useState(null),[u,d]=x.useState(null),f=x.useRef(null);x.useEffect(()=>{const g=pe.getTeacherById(t);g&&d(g);const y=pe.getRequestStatus(n,t);c(y),s(pe.getMessages(n,t));const T=pe.subscribeToChat(n,t,m=>{s(m),c(pe.getRequestStatus(n,t))});return()=>T()},[t,n]),x.useEffect(()=>{var g;(g=f.current)==null||g.scrollIntoView({behavior:"smooth"})},[a]);const h=()=>{r.trim()&&(l?pe.sendMessage(n,t,r,"student"):(pe.createRequest(n,t,r),c("pending")),o(""))};return u?k.jsxs("div",{className:"max-w-2xl mx-auto h-[calc(100vh-100px)] flex flex-col pt-4",children:[k.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-t-lg p-4 flex items-center justify-between shadow-lg",children:[k.jsxs("div",{className:"flex items-center gap-4",children:[k.jsx("img",{src:u.image,alt:u.name,className:"w-12 h-12 rounded-full object-cover border border-[#403d39]"}),k.jsxs("div",{children:[k.jsx("h2",{className:"font-bold text-white text-lg",children:u.name}),k.jsx("p",{className:"text-xs text-[#bababa]",children:"Chat Directo"})]})]}),k.jsxs("div",{className:"flex items-center gap-2",children:[l==="approved"&&k.jsxs("button",{onClick:()=>i(`/room/${t}`),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold flex items-center gap-2 text-sm transition-colors",children:[k.jsx(Zx,{size:16})," Ir al Aula"]}),l==="pending"&&k.jsxs("div",{className:"bg-[#bf811d]/20 text-[#bf811d] border border-[#bf811d]/30 px-3 py-1 rounded text-xs flex items-center gap-2 font-bold",children:[k.jsx($x,{size:14})," Solicitud Pendiente"]}),!l&&k.jsxs("div",{className:"bg-gray-700/50 text-gray-400 px-3 py-1 rounded text-xs flex items-center gap-2",children:[k.jsx(sw,{size:14})," Sin conexin"]})]})]}),k.jsxs("div",{className:"flex-grow bg-[#161512] border-x border-[#302e2b] p-4 overflow-y-auto space-y-3 relative",children:[a.length===0?k.jsxs("div",{className:"text-center text-[#666] mt-10",children:[k.jsxs("p",{className:"mb-2",children:["Enva un mensaje para solicitar clases con ",k.jsx("strong",{children:u.name}),"."]}),k.jsx("p",{className:"text-sm",children:"El profesor debe aprobar tu solicitud para acceder al aula."})]}):a.map(g=>k.jsx("div",{className:`flex ${g.sender==="student"?"justify-end":"justify-start"}`,children:k.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 text-sm ${g.sender==="student"?"bg-[#2b5f8f] text-white rounded-br-none":"bg-[#262421] text-[#bababa] border border-[#302e2b] rounded-bl-none"}`,children:[k.jsx("p",{children:g.text}),k.jsx("span",{className:"text-[10px] opacity-50 block text-right mt-1",children:new Date(g.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},g.id)),k.jsx("div",{ref:f})]}),k.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-b-lg p-3 flex gap-2",children:[k.jsx("input",{type:"text",value:r,onChange:g=>o(g.target.value),onKeyDown:g=>g.key==="Enter"&&h(),placeholder:l==="approved"?"Escribe un mensaje...":"Escribe para solicitar conexin...",className:"flex-grow bg-[#161512] border border-[#302e2b] text-white text-sm rounded px-3 focus:outline-none focus:border-[#bf811d] transition-colors"}),k.jsx("button",{onClick:h,disabled:!r.trim(),className:"bg-[#bf811d] text-white p-2 rounded hover:bg-[#a66f19] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:k.jsx(cw,{size:18})})]})]}):k.jsx("div",{className:"p-8 text-center",children:"Cargando..."})},z2=({teacherId:t})=>{const[e,n]=x.useState([]);x.useEffect(()=>{n(pe.getRequestsForTeacher(t));const r=setInterval(()=>{n(pe.getRequestsForTeacher(t))},2e3);return()=>clearInterval(r)},[t]);const i=r=>{pe.updateRequestStatus(r,t,"approved"),n(pe.getRequestsForTeacher(t)),alert("Estudiante aprobado. Ahora tiene acceso al aula.")},a=r=>{pe.updateRequestStatus(r,t,"rejected"),n(pe.getRequestsForTeacher(t))},s=()=>{const r="student_"+Math.floor(Math.random()*1e3);pe.createRequest(r,t,"Hola profesor, me gustara tomar clases."),n(pe.getRequestsForTeacher(t)),alert("Simulacin: Solicitud de estudiante creada.")};return e.length===0?k.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b] mb-8 text-center opacity-70 hover:opacity-100 transition-opacity",children:[k.jsxs("h2",{className:"text-xl font-bold text-white mb-2 flex items-center justify-center gap-2",children:[k.jsx(Wg,{className:"text-[#666]"})," Solicitudes Pendientes"]}),k.jsx("p",{className:"text-[#bababa] text-sm mb-4",children:"No tienes solicitudes nuevas en este momento."}),k.jsx("button",{onClick:s,className:"text-xs text-[#bf811d] border border-[#bf811d] px-3 py-1 rounded hover:bg-[#bf811d] hover:text-white transition-colors",children:"Simular Solicitud de Alumno (Demo)"})]}):k.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b] mb-8",children:[k.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[k.jsx(Wg,{className:"text-[#bf811d]"})," Solicitudes Pendientes",k.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:e.length})]}),k.jsx("div",{className:"space-y-3",children:e.map(r=>k.jsxs("div",{className:"bg-[#161512] p-4 rounded-lg flex justify-between items-center border border-[#302e2b]",children:[k.jsxs("div",{children:[k.jsxs("p",{className:"font-bold text-white",children:["Estudiante #",r.studentId]}),k.jsx("p",{className:"text-xs text-[#bababa]",children:new Date(r.timestamp).toLocaleDateString()})]}),k.jsxs("div",{className:"flex gap-2",children:[k.jsx(ma,{to:`/chat/${t}`,className:"p-2 bg-[#363431] text-white rounded hover:bg-[#403d39]",title:"Ver Mensajes",children:k.jsx(ow,{size:18})}),k.jsx("button",{onClick:()=>i(r.studentId),className:"p-2 bg-green-600/20 text-green-500 rounded hover:bg-green-600/30 border border-green-600/30",children:k.jsx(Jx,{size:18})}),k.jsx("button",{onClick:()=>a(r.studentId),className:"p-2 bg-red-600/20 text-red-500 rounded hover:bg-red-600/30 border border-red-600/30",children:k.jsx(mw,{size:18})})]})]},r.id))})]})},F2=()=>{const{userRole:t,currentUserId:e}=yi.useContext(is),[n,i]=x.useState(null),[a,s]=x.useState(!0);x.useEffect(()=>{if(t!=="teacher")return;(async()=>{pe.initialize();const u=pe.getTeacherById(e);u?i(u):console.error("Teacher not found in mock DB"),s(!1)})()},[t,e]);const r=c=>c<=20?.6:c<=50?.7:.8,o=async()=>{if(!n)return;const c=n.classesGiven+1;let u=.6;c>50?u=.8:c>20&&(u=.7);const f=n.price*u,h=pe.updateTeacher(e,{classesGiven:c,earnings:n.earnings+f});h?(i(h),alert(`Clase terminada! Ganaste $${f.toFixed(2)} (${u*100}%)`)):alert("Error al actualizar datos.")};if(t!=="teacher")return k.jsxs("div",{className:"text-center mt-10 text-xl",children:["Acceso denegado. ",k.jsx("br",{}),k.jsx("span",{className:"text-sm text-[#bababa]",children:"Debes ser profesor."})]});if(a)return k.jsx("div",{className:"text-center mt-10",children:"Cargando panel..."});if(!n)return k.jsx("div",{className:"text-center mt-10",children:"No se encontraron datos del profesor."});const l=r(n.classesGiven+1);return k.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[k.jsxs("h1",{className:"text-3xl font-bold text-white mb-8",children:["Panel de Profesor (",n.name,")"]}),k.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-12",children:[k.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b]",children:[k.jsxs("div",{className:"flex items-center gap-3 text-[#bf811d] mb-2",children:[k.jsx(tw,{})," ",k.jsx("span",{className:"font-bold",children:"Ganancias Totales"})]}),k.jsxs("p",{className:"text-3xl text-white",children:["$",n.earnings.toFixed(2)]})]}),k.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b]",children:[k.jsxs("div",{className:"flex items-center gap-3 text-[#bf811d] mb-2",children:[k.jsx(Yx,{})," ",k.jsx("span",{className:"font-bold",children:"Clases Dadas"})]}),k.jsx("p",{className:"text-3xl text-white",children:n.classesGiven})]}),k.jsxs("div",{className:"bg-[#262421] p-6 rounded-lg border border-[#302e2b]",children:[k.jsxs("div",{className:"flex items-center gap-3 text-[#bf811d] mb-2",children:[k.jsx(dw,{})," ",k.jsx("span",{className:"font-bold",children:"Nivel de Comisin"})]}),k.jsxs("p",{className:"text-3xl text-white",children:[(l*100).toFixed(0),"%"]}),k.jsx("p",{className:"text-xs text-[#bababa] mt-2",children:n.classesGiven<=20?`Faltan ${21-n.classesGiven} para 70%`:n.classesGiven<=50?`Faltan ${51-n.classesGiven} para 80%`:"Nivel Mximo"})]})]}),k.jsx(z2,{teacherId:e}),k.jsxs("div",{className:"bg-[#262421] p-8 rounded-lg border border-[#302e2b] text-center mt-12",children:[k.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Control de Clase"}),k.jsx("p",{className:"mb-6",children:"Al terminar una clase, se registrar y se sumar el saldo a tu cuenta."}),k.jsxs("div",{className:"flex justify-center gap-4",children:[k.jsx(ma,{to:`/room/${e}`,className:"bg-[#363431] hover:bg-[#403d39] text-white font-bold py-3 px-8 rounded-full text-lg transition-all border border-[#504e4b]",children:"Entrar al Aula"}),k.jsx("button",{onClick:o,className:"bg-[#bf811d] hover:bg-[#a66f19] text-white font-bold py-3 px-8 rounded-full text-lg transition-all transform hover:scale-105 shadow-lg shadow-orange-900/20",children:"Terminar Clase Actual"})]})]})]})},is=yi.createContext();function V2(){const[t,e]=x.useState("student"),n=t==="teacher"?"teacher1":"student1";return k.jsx(is.Provider,{value:{userRole:t,setUserRole:e,currentUserId:n},children:k.jsx(Mx,{basename:"/TopChess",children:k.jsxs("div",{className:"min-h-screen bg-[#161512] text-[#bababa] font-sans",children:[k.jsx(H2,{}),k.jsx("main",{className:"container mx-auto p-4",children:k.jsxs(ox,{children:[k.jsx(Ir,{path:"/",element:k.jsx(pw,{})}),k.jsx(Ir,{path:"/chat/:teacherId",element:k.jsx(q2,{})}),k.jsx(Ir,{path:"/room/:teacherId",element:k.jsx(B2,{})}),k.jsx(Ir,{path:"/dashboard",element:k.jsx(F2,{})})]})})]})})})}function H2(){const{userRole:t,setUserRole:e}=yi.useContext(is),n=ru(),a=function(){try{return window.location.pathname}catch{return"/"}}().includes("/room/");return k.jsxs("nav",{className:"bg-[#262421] border-b border-[#302e2b] p-4 flex justify-between items-center h-16 shadow-lg z-50",children:[k.jsxs(ma,{to:"/",className:"text-xl font-bold flex items-center gap-2 text-[#bababa] hover:text-white transition-colors",children:[k.jsx("span",{className:"text-2xl",children:""})," AjedrezTopChess"]}),k.jsxs("div",{className:"flex items-center gap-6",children:[!a&&k.jsxs("div",{className:"flex bg-[#161512] rounded-lg p-1 border border-[#302e2b]",children:[k.jsx("button",{onClick:()=>e("student"),className:`px-4 py-1 rounded-md text-sm transition-all ${t==="student"?"bg-[#363431] text-white shadow-sm":"text-[#666] hover:text-[#999]"}`,children:"Soy Alumno"}),k.jsx("button",{onClick:()=>{e("teacher"),n("/dashboard")},className:`px-4 py-1 rounded-md text-sm transition-all ${t==="teacher"?"bg-[#363431] text-white shadow-sm":"text-[#666] hover:text-[#999]"}`,children:"Soy Profesor"})]}),t==="teacher"&&k.jsxs(ma,{to:"/dashboard",className:"flex items-center gap-2 px-4 py-2 rounded bg-[#363431] hover:bg-[#403d39] text-[#bababa] hover:text-white transition-colors font-medium text-sm",children:[k.jsx(iw,{size:18}),"Panel"]})]})]})}uR.createRoot(document.getElementById("root")).render(k.jsx(x.StrictMode,{children:k.jsx(V2,{})}));
