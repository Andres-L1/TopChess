const c="topchess-app",i=window.location.origin+"/TopChess/lichess-callback",l={async getUserStudies(e,r){try{if(!e)return[];const t={};r&&(t.Authorization=`Bearer ${r}`);const n=`https://lichess.org/api/study/by/${e}`,s=await fetch(n,{headers:t});if(!s.ok)throw new Error("Error fetching studies");return(await s.text()).split(`
`).filter(o=>o.trim()).map(o=>{try{return JSON.parse(o)}catch{return null}}).filter(Boolean)}catch(t){return console.error("Lichess API Error:",t),[]}},async getStudyPgn(e,r){try{const t={};r&&(t.Authorization=`Bearer ${r}`);const n=await fetch(`https://lichess.org/api/study/${e}.pgn`,{headers:t});if(!n.ok)throw new Error("Error fetching PGN");return await n.text()}catch(t){return console.error("Lichess PGN Error:",t),""}},async exchangeCodeForToken(e,r){try{const t=new URLSearchParams({grant_type:"authorization_code",code:e,code_verifier:r,redirect_uri:i,client_id:c}),n=await fetch("https://lichess.org/api/token",{method:"POST",body:t});if(!n.ok){const a=await n.text();return console.error("Token exchange failed:",a),null}return(await n.json()).access_token}catch(t){return console.error("Lichess token error:",t),null}},async getAuthUser(e){try{const r=await fetch("https://lichess.org/api/account",{headers:{Authorization:`Bearer ${e}`}});return r.ok?await r.json():null}catch{return null}},parseChapters(e){return e.split(/\[Event /g).filter(Boolean).map(t=>{const n="[Event "+t.trim(),s=n.match(/\[Event "(.*)"\]/);return{name:s?s[1]:"Sin t√≠tulo",pgn:n}})},sanitizePgn(e){if(!e)return"";if(e.trim().startsWith("{")&&e.trim().endsWith("}"))try{const r=JSON.parse(e);return r&&typeof r=="object"&&r.pgn?this.sanitizePgn(r.pgn):""}catch{}return e.replace(/\r/g,"").replace(/\[(LichessId|Variant|Annotator|SIT|Clock|UTCDate|UTCTime|ChapterMode) "[^"]*"\]\s*/g,"").replace(/\{\s*(\[%[^\]]+\]\s*)+\}/g,"").replace(/\[%[^\]]+\]/g,"").replace(/\{\s+/g,"{ ").replace(/\s+\}/g," }").replace(/[ \t]{2,}/g," ").replace(/\n{3,}/g,`

`).trim()},getLICHESS_CLIENT_ID(){return c},getREDIRECT_URI(){return i}};export{l};
