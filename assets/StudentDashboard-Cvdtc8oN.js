import{c as q,a as R,u as F,r as a,j as e,g as U,h as x,f as l,z as f}from"./index-BF4Qa0mj.js";import{S as O,V,M as H,X as J,C as X}from"./Skeleton-Bx4gR5A9.js";import{T as _}from"./trophy-C04TQBds.js";import{C as G}from"./calendar-D85LO-1T.js";import{C as K}from"./clock-Dr4ffMkl.js";import"./check-DKbDv5Dg.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=q("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),le=()=>{const k=R(),{currentUserId:i,logout:S}=k,C=F(),[W,Y]=a.useState(0),[b,I]=a.useState([]),[j,T]=a.useState([]),[v,N]=a.useState([]),[B,w]=a.useState(!0),[o,m]=a.useState(null),[M,P]=a.useState([]);a.useEffect(()=>{i&&(async()=>{w(!0);try{const r=await l.getRequestsForStudent(i),h=await l.getBookingsForUser(i,"student"),p=r.filter(t=>t.status==="approved"),d=new Map;p.forEach(t=>{d.has(t.teacherId)||d.set(t.teacherId,t)});const g=Array.from(d.values()).map(t=>l.getTeacherById(t.teacherId)),n=await Promise.all(g),L=r.filter(t=>t.status==="pending"),u=new Map;L.forEach(t=>{u.has(t.teacherId)||u.set(t.teacherId,t)});const $=Array.from(u.values()).map(async t=>{const y=await l.getTeacherById(t.teacherId);return y?{...y,requestDate:t.timestamp}:null}),D=await Promise.all($);I(n.filter(t=>t!==null)),T(D.filter(t=>t!==null)),N(h)}catch(r){console.error("Error fetching dashboard data",r),f.error("Error al cargar datos")}finally{w(!1)}})()},[i]);const z=async s=>{const r=await l.getTeacherAvailability(s.id);P(r),m(s)},A=async s=>{const h=`Próximo ${["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"][s.dayIndex]}`,p=`${s.dayIndex}-${s.hour}`,g={id:`booking_${Date.now()}`,studentId:i,teacherId:o.id,slotId:p,date:new Date().toISOString().split("T")[0],time:s.hour,status:"confirmed",timestamp:Date.now(),meetingLink:`/classroom/${o.id}`};try{await l.createBooking(g),f.success(`Clase reservada para el ${h} a las ${s.hour}`),m(null);const n=await l.getBookingsForUser(i,"student");N(n)}catch(n){console.error("Error creating booking",n),f.error("Error al reservar la clase")}},E=()=>{S(),C("/")},c=v.length>0?v[0]:null;return e.jsxs("div",{className:"p-4 md:p-8 max-w-7xl mx-auto space-y-6 md:space-y-8 animate-fade-in pb-24",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold font-display text-white",children:["Hola, ",e.jsx("span",{className:"text-gold",children:"Alumno"})]}),e.jsx("p",{className:"text-sm md:text-base text-text-muted",children:"Continúa tu camino hacia la maestría."})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:E,className:"p-2 text-text-muted hover:text-red-400 transition-colors rounded-lg border border-white/5 hover:border-red-500/20",title:"Cerrar Sesión",children:e.jsx(U,{size:20})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("section",{children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(_,{className:"text-gold",size:20})," Mis Profesores"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:B?e.jsx(e.Fragment,{children:[1,2].map(s=>e.jsx("div",{className:"glass-panel p-4 rounded-xl flex flex-col gap-4",children:e.jsx(O,{width:"100%",height:100})},s))}):e.jsxs(e.Fragment,{children:[b.length===0&&e.jsxs("div",{className:"col-span-1 md:col-span-2 p-8 rounded-2xl border border-dashed border-white/10 text-center text-text-muted",children:[e.jsx("p",{children:"Aún no tienes profesores activos."}),e.jsx(x,{to:"/",className:"text-gold hover:underline mt-2 inline-block",children:"Buscar Profesor"})]}),b.map(s=>e.jsxs("div",{className:"glass-panel p-4 rounded-xl flex flex-col gap-4 group hover:border-gold/30 transition-all",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.image||"https://ui-avatars.com/api/?name=Profesor+Chess&background=random",alt:s.name,className:"w-12 h-12 rounded-full object-cover border-2 border-gold/20"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-bold text-white truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-text-muted",children:[s.elo," ELO"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mt-auto",children:[e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsxs(x,{to:`/classroom/${s.id}`,className:"flex-1 btn-secondary text-center text-[10px] md:text-xs py-2 px-1 flex items-center justify-center gap-1",children:[e.jsx(V,{size:14})," Aula"]}),e.jsxs(x,{to:`/chat/${s.id}`,className:"flex-1 bg-white/5 hover:bg-white/10 border border-white/10 text-white text-[10px] md:text-xs py-2 px-1 rounded-lg transition-all flex items-center justify-center gap-1",children:[e.jsx(H,{size:14})," Chat"]})]}),e.jsxs("button",{onClick:()=>z(s),className:"w-full sm:w-auto sm:px-4 bg-white/5 hover:bg-gold hover:text-black border border-white/10 text-white text-[10px] md:text-xs py-2 rounded-lg transition-all flex items-center justify-center gap-1",children:[e.jsx(G,{size:14})," Agendar"]})]})]},s.id))]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 rounded-2xl",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"text-blue-400",size:18})," Solicitudes Enviadas"]}),e.jsxs("div",{className:"space-y-3",children:[j.length===0&&e.jsx("p",{className:"text-xs text-text-muted italic",children:"No tienes solicitudes pendientes."}),j.map(s=>e.jsxs("div",{className:"p-3 bg-white/5 rounded-lg border border-white/5 flex items-center gap-3 opacity-70",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-xs flex-shrink-0",children:s.name.substring(0,2)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-white font-medium truncate",children:s.name}),e.jsx("p",{className:"text-[10px] text-yellow-500",children:"Pendiente de aprobación"})]})]},s.id))]})]}),e.jsxs("div",{className:"glass-panel p-6 rounded-2xl bg-gradient-to-br from-dark-panel to-green-900/10 border-green-500/10",children:[e.jsxs("h3",{className:"font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx(Q,{className:"text-green-400",size:18})," Próxima Clase"]}),c?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-3xl font-bold text-white mb-1",children:c.time}),e.jsx("p",{className:"text-sm text-green-400 font-mono mb-4",children:c.date}),e.jsx(x,{to:c.meetingLink,className:"w-full btn-primary py-2 text-sm block",children:"Unirse ahora"})]}):e.jsx("div",{className:"text-center py-6 text-text-muted",children:e.jsx("p",{children:"No tienes clases próximas."})})]})]})]}),o&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-dark-panel border border-white/10 rounded-2xl w-full max-w-lg overflow-hidden shadow-2xl relative",children:[e.jsx("button",{onClick:()=>m(null),className:"absolute top-4 right-4 text-text-muted hover:text-white",children:e.jsx(J,{size:24})}),e.jsxs("div",{className:"p-6 border-b border-white/5",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Reservar Clase"}),e.jsxs("p",{className:"text-sm text-text-muted",children:["con ",e.jsx("span",{className:"text-gold",children:o.name})]})]}),e.jsx("div",{className:"p-6",children:e.jsx(X,{mode:"view",availability:M,onSlotClick:A})})]})})]})};export{le as default};
