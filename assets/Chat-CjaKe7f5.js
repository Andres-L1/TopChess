import{c as f,d as q,r as o,A,u as z,j as e}from"./index-BkyA-Quh.js";import{m as r}from"./mockDatabase-Deltym9t.js";import{D as R}from"./dollar-sign-DixTMC4x.js";import{C as $}from"./clock-CDDedjq5.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=f("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=f("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=f("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),K=()=>{const{teacherId:S}=q(),k=o.useContext(A),{userRole:n,currentUserId:s}=k,C=z(),a=S,[h,x]=o.useState([]),[d,j]=o.useState(""),[i,u]=o.useState(null),[l,M]=o.useState(null),v=o.useRef(null),[P,p]=o.useState(!1),[g,D]=o.useState(20);o.useEffect(()=>{let t=null;const b=r.getProfile(a);if(M(b),n==="student"){t=r.getRequestStatus(s,a),x(r.getMessages(s,a));const c=r.subscribeToChat(s,a,y=>{x(y),u(r.getRequestStatus(s,a))});return u(t),()=>c()}else{const c=a,N=JSON.parse(localStorage.getItem("topchess_requests")||"[]").find(m=>m.studentId===c&&m.teacherId===s);t=N?N.status:null,x(r.getMessages(c,s));const I=r.subscribeToChat(c,s,m=>{x(m)});return u(t),()=>I()}},[a,s,n]),o.useEffect(()=>{var t;(t=v.current)==null||t.scrollIntoView({behavior:"smooth"})},[h]);const w=()=>{d.trim()&&(n==="student"?i?r.sendMessage(s,a,d,"student"):(r.createRequest(s,a,d),u("pending")):r.sendMessage(a,s,d,"teacher"),j(""))},E=()=>{const t=new Date().toLocaleString("es-ES",{month:"long"}),b=r.processPayment(s,a,g,`SuscripciÃ³n Mensual: ${t}`);b.success?(alert("Pago realizado con Ã©xito!"),p(!1),n==="student"&&r.sendMessage(s,a,`ðŸ’° He pagado la mensualidad de ${t} (${g}â‚¬)`,"student")):alert("Error: "+b.error)};return l?e.jsxs("div",{className:"max-w-2xl mx-auto h-[calc(100vh-100px)] flex flex-col pt-4",children:[e.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-t-lg p-4 flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:l.image,alt:l.name,className:"w-12 h-12 rounded-full object-cover border border-[#403d39]"}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-white text-lg",children:l.name}),e.jsx("p",{className:"text-xs text-[#bababa]",children:n==="student"?"Profesor":"Estudiante"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[n==="student"&&i==="approved"&&e.jsxs("button",{onClick:()=>p(!0),className:"bg-[#D4AF37]/20 hover:bg-[#D4AF37]/40 text-[#D4AF37] border border-[#D4AF37]/50 px-3 py-2 rounded font-bold flex items-center gap-2 text-xs transition-colors mr-2",children:[e.jsx(R,{size:14})," Pagar Mensualidad"]}),i==="approved"&&e.jsxs("button",{onClick:()=>C(n==="student"?`/classroom/${a}`:`/classroom/${s}`),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-bold flex items-center gap-2 text-sm transition-colors",children:[e.jsx(F,{size:16})," Ir al Aula"]}),i==="pending"&&e.jsxs("div",{className:"bg-[#bf811d]/20 text-[#bf811d] border border-[#bf811d]/30 px-3 py-1 rounded text-xs flex items-center gap-2 font-bold",children:[e.jsx($,{size:14})," Solicitud Pendiente"]}),!i&&n==="student"&&e.jsxs("div",{className:"bg-gray-700/50 text-gray-400 px-3 py-1 rounded text-xs flex items-center gap-2",children:[e.jsx(L,{size:14})," Sin conexiÃ³n"]})]})]}),e.jsxs("div",{className:"flex-grow bg-[#161512] border-x border-[#302e2b] p-4 overflow-y-auto space-y-3 relative",children:[h.length===0?e.jsx("div",{className:"text-center text-[#666] mt-10",children:e.jsx("p",{className:"mb-2",children:n==="student"?`EnvÃ­a un mensaje para solicitar clases con ${l.name}.`:`Inicio del historial de chat con ${l.name}.`})}):h.map(t=>e.jsx("div",{className:`flex ${t.sender===n?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg p-3 text-sm ${t.sender===n?"bg-[#2b5f8f] text-white rounded-br-none":"bg-[#262421] text-[#bababa] border border-[#302e2b] rounded-bl-none"}`,children:[e.jsx("p",{children:t.text}),e.jsx("span",{className:"text-[10px] opacity-50 block text-right mt-1",children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},t.id)),e.jsx("div",{ref:v})]}),e.jsxs("div",{className:"bg-[#262421] border border-[#302e2b] rounded-b-lg p-3 flex gap-2",children:[e.jsx("input",{type:"text",value:d,onChange:t=>j(t.target.value),onKeyDown:t=>t.key==="Enter"&&w(),placeholder:i==="approved"?"Escribe un mensaje...":"Escribe para solicitar conexiÃ³n...",className:"flex-grow bg-[#161512] border border-[#302e2b] text-white text-sm rounded px-3 focus:outline-none focus:border-[#bf811d] transition-colors"}),e.jsx("button",{onClick:w,disabled:!d.trim(),className:"bg-[#bf811d] text-white p-2 rounded hover:bg-[#a66f19] disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:e.jsx(T,{size:18})})]}),P&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-[#262421] w-full max-w-sm rounded-2xl border border-white/10 shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b border-white/5",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Pagar Mensualidad"}),e.jsxs("p",{className:"text-xs text-[#8b8982]",children:["SuscripciÃ³n con ",l.name]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("label",{className:"block text-xs font-bold text-[#8b8982] uppercase mb-2",children:"Cantidad"}),e.jsx("input",{type:"number",value:g,onChange:t=>D(Number(t.target.value)),className:"w-full bg-[#1a1917] border border-white/10 rounded-xl py-3 px-4 text-white focus:outline-none focus:border-[#D4AF37] font-bold text-lg mb-4"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 text-[#8b8982] hover:text-white font-bold text-sm",children:"Cancelar"}),e.jsx("button",{onClick:E,className:"px-6 py-2 bg-[#D4AF37] text-black font-bold rounded-lg hover:bg-white transition-colors",children:"Confirmar"})]})]})]})})]}):e.jsx("div",{className:"p-8 text-center text-white",children:"Cargando perfil..."})};export{K as default};
