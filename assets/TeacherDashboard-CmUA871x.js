import{c as H,a as te,u as ae,b as le,r as c,j as e,h as j,g as $,f as d,z as m}from"./index-OgmrRwAe.js";import{C as re,S as v,X as ne,V as D,M as ie}from"./Skeleton-N7PP3CW1.js";import{l as G}from"./lichessService-CGkUorkZ.js";import{D as de}from"./dollar-sign-mks3P4gM.js";import{U as B}from"./users-TgiXw_Sd.js";import{C as oe}from"./clock-D_H90H_a.js";import{T as ce}from"./trophy-CfkPpbJs.js";import{C as xe}from"./check-BEvIrCkd.js";import"./calendar-BjK9ZNkz.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=H("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=H("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);async function ue(){const a=new Uint8Array(32);return window.crypto.getRandomValues(a),V(a)}async function pe(a){const w=new TextEncoder().encode(a),n=await window.crypto.subtle.digest("SHA-256",w);return V(new Uint8Array(n))}function V(a){return btoa(String.fromCharCode(...a)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const Ce=()=>{var M;const{currentUserId:a,logout:T}=te(),w=ae(),{t:n}=le(),[N,U]=c.useState("overview"),[y,O]=c.useState({earnings:0,students:0,hours:0}),[g,k]=c.useState([]),[z,R]=c.useState([]),[X,I]=c.useState([]),[t,C]=c.useState(null),[S,J]=c.useState(null),[f,q]=c.useState(!0);c.useEffect(()=>{a&&(async()=>{q(!0);try{const l=await d.getTeacherById(a);C(l);const u=await d.getTeacherAvailability(a),p=await d.getRequestsForTeacher(a),b=await d.getBookingsForUser(a,"teacher");l&&O({earnings:l.earnings,students:l.classesGiven>0?Math.floor(l.classesGiven/4):0,hours:l.classesGiven});const A=p.filter(r=>r.status==="pending").map(async r=>{const o=await d.getUser(r.studentId);return{...r,studentName:(o==null?void 0:o.name)||"Usuario"}}),_=await Promise.all(A);k(_);const i=p.filter(r=>r.status==="approved"),x=new Map;i.forEach(r=>{x.has(r.studentId)||x.set(r.studentId,r)});const ee=Array.from(x.values()).map(async r=>{const o=await d.getUser(r.studentId);return o?{...o,requestId:r.id}:null}),se=await Promise.all(ee);if(R(se.filter(r=>r!==null)),I(u),b.length>0){const r=[...b].sort((o,L)=>{const F=o.date.localeCompare(L.date);return F!==0?F:o.time.localeCompare(L.time)});J(r[0])}}catch(l){console.error("Error fetching dashboard data",l),m.error("Error al cargar datos")}finally{q(!1)}})()},[a]);const K=async s=>{try{await d.updateRequestStatus(s,"approved"),k(i=>i.filter(x=>x.id!==s)),m.success("Solicitud aceptada");const u=(await d.getRequestsForTeacher(a)).filter(i=>i.status==="approved"),p=new Map;u.forEach(i=>{p.has(i.studentId)||p.set(i.studentId,i)});const b=Array.from(p.values()).map(async i=>{const x=await d.getUser(i.studentId);return x?{...x,requestId:i.id}:null}),A=await Promise.all(b);R(A.filter(i=>i!==null));const _=await d.getTeacherById(a);C(_)}catch(l){console.error("Error accepting request:",l),m.error("Error al procesar solicitud")}},P=async s=>{try{await d.updateRequestStatus(s,"rejected"),k(l=>l.filter(u=>u.id!==s)),m.success("Solicitud rechazada")}catch(l){console.error("Error rejecting request:",l),m.error("Error al rechazar solicitud")}},Q=async s=>{await d.updateTeacherAvailability(a,s),I(s),m.success("Horario actualizado correctamente")},W=()=>{T(),w("/")},E=s=>s<10?{name:"Novato",next:"Instructor",target:10,currentComm:.5,nextComm:.55}:s<50?{name:"Instructor",next:"Profesor",target:50,currentComm:.55,nextComm:.6}:s<200?{name:"Profesor",next:"Maestro",target:200,currentComm:.6,nextComm:.7}:{name:"Maestro",next:"Gran Maestro",target:1e3,currentComm:.7,nextComm:.85},h=E(t?t.classesGiven:0),Y=t?Math.min(100,t.classesGiven/h.target*100):0,Z=(t==null?void 0:t.currency)==="EUR"?"€":"$";return e.jsxs("div",{className:"p-4 md:p-8 max-w-7xl mx-auto space-y-6 md:space-y-8 animate-fade-in pb-24",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold font-display text-white",children:[n("dashboard.title")," ",e.jsx("span",{className:"text-gold",children:"."})]}),e.jsx("p",{className:"text-sm md:text-base text-text-muted",children:n("dashboard.subtitle")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 items-center w-full md:w-auto",children:[e.jsxs(j,{to:`/classroom/${a}`,className:"btn-secondary flex items-center gap-2 text-[10px] sm:text-sm md:text-base flex-1 md:flex-none justify-center py-2 px-2 sm:px-4",children:[e.jsx(he,{size:18}),e.jsx("span",{className:"truncate",children:n("dashboard.my_classroom")})]}),e.jsxs("div",{className:"flex gap-1 p-1 bg-dark-panel rounded-lg border border-white/5 flex-1 md:flex-none justify-center",children:[e.jsx("button",{onClick:()=>U("overview"),className:`flex-1 md:flex-none px-2 sm:px-4 py-2 rounded-md text-[10px] sm:text-sm font-medium transition-all ${N==="overview"?"bg-gold text-black shadow-lg":"text-text-muted hover:text-white"}`,children:n("dashboard.overview")}),e.jsx("button",{onClick:()=>U("schedule"),className:`flex-1 md:flex-none px-2 sm:px-4 py-2 rounded-md text-[10px] sm:text-sm font-medium transition-all ${N==="schedule"?"bg-gold text-black shadow-lg":"text-text-muted hover:text-white"}`,children:n("dashboard.schedule")})]}),e.jsx("button",{onClick:W,className:"p-2 text-text-muted hover:text-red-400 transition-colors rounded-lg border border-white/5 hover:border-red-500/20",title:n("nav.exit"),"aria-label":n("nav.exit"),children:e.jsx($,{size:20})})]})]}),N==="schedule"?e.jsx("div",{className:"glass-panel p-4 md:p-6 rounded-2xl animate-enter overflow-x-auto",children:e.jsx("div",{className:"min-w-[600px] md:min-w-0",children:e.jsx(re,{mode:"edit",availability:X,onSaveAvailability:Q})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4",children:f?e.jsx(e.Fragment,{children:[1,2,3,4].map(s=>e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-2xl flex flex-col justify-between",children:[e.jsx(v,{width:"40%",height:20}),e.jsx(v,{width:"80%",height:40})]},s))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-2xl flex flex-col justify-between group hover:border-gold/30 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"p-3 rounded-xl bg-green-500/10 text-green-400 group-hover:scale-110 transition-transform",children:e.jsx(de,{size:24})}),e.jsxs("span",{className:"text-xs font-mono text-green-400/80",children:["Ganancia: ",(h.currentComm*100).toFixed(0),"%"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-2xl md:text-3xl font-bold text-white tracking-tight",children:[y.earnings.toFixed(2),Z]}),e.jsx("p",{className:"text-xs md:text-sm text-text-muted",children:n("dashboard.total_earnings")})]})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-2xl flex flex-col justify-between group hover:border-gold/30 transition-all",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx("div",{className:"p-3 rounded-xl bg-blue-500/10 text-blue-400 group-hover:scale-110 transition-transform",children:e.jsx(B,{size:24})})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-2xl md:text-3xl font-bold text-white tracking-tight",children:y.students}),e.jsx("p",{className:"text-xs md:text-sm text-text-muted",children:n("dashboard.active_students")})]})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-2xl flex flex-col justify-between group hover:border-gold/30 transition-all",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx("div",{className:"p-3 rounded-xl bg-purple-500/10 text-purple-400 group-hover:scale-110 transition-transform",children:e.jsx(oe,{size:24})})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("span",{className:"text-2xl md:text-3xl font-bold text-white tracking-tight",children:[y.hours,"h"]}),e.jsx("p",{className:"text-xs md:text-sm text-text-muted",children:n("dashboard.classes_given")})]})]}),e.jsxs("div",{className:"glass-panel p-4 md:p-6 rounded-2xl bg-gradient-to-br from-dark-panel to-gold/5 border-gold/20 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gold/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ce,{size:20,className:"text-gold"}),e.jsxs("span",{className:"text-gold font-bold text-sm uppercase tracking-wider",children:["Nivel ",h.name]}),(t==null?void 0:t.title)&&e.jsx("span",{className:"ml-auto px-1.5 py-0.5 bg-gold text-black text-[8px] rounded font-black tracking-widest",children:t.title})]}),e.jsx("div",{className:"w-full bg-black/40 h-2 rounded-full mb-2 overflow-hidden relative",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gold to-orange-500 shadow-[0_0_10px_rgba(255,215,0,0.5)] transition-all duration-1000",style:{width:`${Y}%`}})}),e.jsxs("p",{className:"text-xs text-text-muted flex justify-between",children:[e.jsxs("span",{children:[(t==null?void 0:t.classesGiven)||0," / ",h.target," Clases"]}),e.jsxs("span",{className:"text-gold",children:["Siguiente: ",h.next]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-white/5 text-[10px] space-y-1",children:[e.jsxs("p",{className:"flex justify-between text-white/80",children:[e.jsx("span",{children:"Tu Comisión Actual:"})," ",e.jsxs("span",{className:"text-green-400 font-mono font-bold",children:[(h.currentComm*100).toFixed(0),"%"]})]}),e.jsxs("p",{className:"flex justify-between text-white/50",children:[e.jsx("span",{children:"Siguiente Nivel:"})," ",e.jsxs("span",{className:"text-gold font-mono",children:[(h.nextComm*100).toFixed(0),"%"]})]})]})]})]})]})}),e.jsxs("div",{className:"flex gap-6 flex-col lg:flex-row h-full",children:[e.jsxs("div",{className:"flex-1 glass-panel rounded-2xl p-4 md:p-6 min-h-[400px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-white",children:n("dashboard.pending_requests")}),!f&&g.length>0&&e.jsxs("span",{className:"bg-red-500/20 text-red-400 px-2 py-0.5 rounded text-xs font-bold animate-pulse",children:[g.length," nuevas"]})]}),e.jsx("div",{className:"space-y-4",children:f?e.jsx(e.Fragment,{children:[1,2,3].map(s=>e.jsx("div",{className:"p-3 md:p-4 rounded-xl bg-white/5 border border-white/5 flex items-center justify-between gap-3",children:e.jsx(v,{width:"100%",height:60})},s))}):g.length===0?e.jsxs("div",{className:"text-center py-10 text-text-muted",children:[e.jsx(me,{size:40,className:"mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No tienes solicitudes de alumnos por el momento."})]}):g.map(s=>e.jsxs("div",{className:"p-3 md:p-4 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 transition-colors flex flex-col sm:flex-row items-start sm:items-center justify-between group gap-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center font-bold text-white flex-shrink-0",children:(s.studentName||"U").substring(0,1).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white",children:s.studentName||"Alumno"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Interesado en tus clases"})]})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx("button",{onClick:()=>K(s.id),className:"p-2 rounded-lg bg-green-500/20 text-green-400 hover:bg-green-500 hover:text-white transition-all",title:"Aceptar","aria-label":"Aceptar",children:e.jsx(xe,{size:18})}),e.jsx("button",{onClick:()=>P(s.id),className:"p-2 rounded-lg bg-red-500/20 text-red-400 hover:bg-red-500 hover:text-white transition-all",title:"Rechazar","aria-label":"Rechazar",children:e.jsx(ne,{size:18})})]})]},s.id))})]}),e.jsxs("div",{className:"w-full lg:w-80 flex flex-col gap-6",children:[e.jsxs("div",{className:"glass-panel rounded-2xl p-4 md:p-6 flex flex-col gap-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-white mb-2",children:n("dashboard.quick_access")}),e.jsxs(j,{to:`/classroom/${a}`,className:"group relative overflow-hidden rounded-xl aspect-video bg-black flex items-center justify-center border border-white/10 hover:border-gold/50 transition-all",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-dark-panel to-gold/20 opacity-40 group-hover:scale-105 transition-transform duration-700"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gold/90 text-black flex items-center justify-center shadow-[0_0_20px_rgba(255,215,0,0.3)] group-hover:scale-110 transition-transform",children:e.jsx(D,{size:24})}),e.jsx("span",{className:"font-bold text-white tracking-wide",children:n("dashboard.enter_classroom")})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/5 space-y-2",children:[e.jsx("h4",{className:"font-bold text-sm text-gold",children:n("dashboard.next_class")}),S?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs text-white",children:["Clase el ",S.date]}),e.jsxs("p",{className:"text-[10px] text-text-muted",children:["Hora: ",S.time]}),e.jsx("div",{className:"h-1 w-full bg-black/50 rounded-full overflow-hidden mt-1",children:e.jsx("div",{className:"h-full bg-green-500 w-full animate-pulse-slow"})})]}):e.jsx("p",{className:"text-xs text-text-muted italic",children:"No tienes clases próximas agendadas."})]})]}),e.jsxs("div",{className:"glass-panel rounded-2xl p-4 md:p-6 flex flex-col gap-4 bg-gradient-to-br from-[#1b1a17] to-white/[0.05]",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center",children:e.jsx("img",{src:"https://lichess.org/assets/images/favicon-32-white.png",alt:"Lichess",className:"w-5 h-5 opacity-80"})}),e.jsx("h2",{className:"text-lg font-bold text-white",children:"Lichess Sync"}),(t==null?void 0:t.lichessAccessToken)&&e.jsx("div",{className:"ml-auto w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]"})]}),e.jsx("p",{className:"text-[10px] text-white/50 leading-relaxed",children:t!=null&&t.lichessAccessToken?`Conectado como ${t.lichessUsername}. Tus estudios privados ahora son visibles en el aula.`:"Conecta tu cuenta para importar estudios privados y públicos directamente en el Aula."}),e.jsx("div",{className:"pt-2",children:t!=null&&t.lichessAccessToken?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-grow bg-white/5 border border-white/10 rounded-xl px-4 py-2 flex items-center gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-white/10 flex items-center justify-center font-bold text-[10px] text-white",children:(M=t.lichessUsername)==null?void 0:M.substring(0,1).toUpperCase()}),e.jsx("span",{className:"text-xs text-white/90 font-bold",children:t.lichessUsername})]}),e.jsx("button",{onClick:async()=>{try{await d.updateTeacher(a,{lichessAccessToken:void 0,lichessUsername:void 0}),C(s=>s?{...s,lichessAccessToken:void 0,lichessUsername:void 0}:null),m.success("Desconectado de Lichess")}catch{m.error("Error al desconectar")}},className:"p-2 bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-xl text-red-500 transition-all",title:"Desconectar",children:e.jsx($,{size:16})})]}):e.jsx("button",{onClick:async()=>{const s=await ue(),l=await pe(s);sessionStorage.setItem("lichess_code_verifier",s);const u=new URLSearchParams({response_type:"code",client_id:G.getLICHESS_CLIENT_ID(),redirect_uri:G.getREDIRECT_URI(),scope:"study:read",code_challenge_method:"S256",code_challenge:l,state:Math.random().toString(36).substring(2)});window.location.href=`https://lichess.org/oauth?${u.toString()}`},className:"w-full py-3 bg-white text-black rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-gold transition-all hover:scale-[1.02] shadow-xl shadow-white/5",children:"Conectar con Lichess"})})]})]}),e.jsxs("div",{className:"flex-1 glass-panel rounded-2xl p-4 md:p-6 min-h-[400px]",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-white mb-6",children:"Mis Alumnos"}),e.jsx("div",{className:"space-y-4",children:f?[1,2].map(s=>e.jsx(v,{width:"100%",height:80},s)):z.length===0?e.jsxs("div",{className:"text-center py-10 text-text-muted",children:[e.jsx(B,{size:40,className:"mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"Aún no tienes alumnos activos."})]}):z.map(s=>e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 hover:border-gold/30 transition-all",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-gold/20 to-gold/40 flex items-center justify-center font-bold text-gold",children:(s.name||"U").substring(0,1).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-white",children:s.name||"Usuario"}),e.jsx("p",{className:"text-xs text-text-muted",children:"Alumno Activo"})]})]})}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsxs(j,{to:`/chat/${s.id}`,className:"flex-1 bg-white/5 hover:bg-white/10 border border-white/10 text-white text-[10px] md:text-xs py-2 px-1 rounded-lg transition-all flex items-center justify-center gap-2",children:[e.jsx(ie,{size:14})," Chat"]}),e.jsxs(j,{to:`/classroom/${a}`,className:"flex-1 btn-secondary text-center text-[10px] md:text-xs py-2 px-1 flex items-center justify-center gap-2",children:[e.jsx(D,{size:14})," Aula"]})]})})]},s.id))})]})]})]})]})};export{Ce as default};
