import{d as A,a as T,u as L,r as n,j as e,m as f,A as B,f as o,z as m}from"./index-Czbnao6e.js";import{P as u}from"./PremiumButton-zsSWnV2j.js";import{C as W}from"./chevron-left-DI2IzLfE.js";import{D as P}from"./dollar-sign-C6F3oeOb.js";import{C}from"./circle-check-big-CRZYW2tr.js";import{C as H}from"./clock-CXWEg6dR.js";import{S}from"./send-Cf90mzpk.js";const Q=()=>{const{teacherId:E}=A(),{userRole:s,currentUserId:r}=T(),b=L(),a=E,[h,z]=n.useState([]),[d,w]=n.useState(""),[c,j]=n.useState(null),[i,I]=n.useState(null),v=n.useRef(null),[$,p]=n.useState(!1),[g]=n.useState(59),[y,N]=n.useState(!1);n.useEffect(()=>{let t;return r&&a&&(async()=>{try{const l=await o.getPublicProfile(a);I(l);const _=await o.getRequestStatus(s==="student"?r:a,s==="student"?a:r);j(_);const q=s==="student"?r:a,M=s==="student"?a:r;t=o.subscribeToChat(q,M,R=>{z(R)})}catch(l){console.error("Chat init error",l)}})(),()=>{t&&t()}},[a,r,s]),n.useEffect(()=>{var t;(t=v.current)==null||t.scrollIntoView({behavior:"smooth"})},[h]);const k=async()=>{if(d.trim())try{const t={studentId:s==="student"?r:a,teacherId:s==="student"?a:r,text:d,sender:s||"student",timestamp:Date.now(),type:"text"};s==="student"&&!c&&(await o.createRequest({id:`req_${Date.now()}`,studentId:r,teacherId:a,status:"pending",timestamp:Date.now(),message:d}),j("pending")),await o.sendMessage(t),w("")}catch{m.error("Error al enviar mensaje")}},D=async()=>{N(!0);try{const t=await o.processPayment(r,a,g);if(t.success){m.success(t.message),p(!1);const x=new Date().toLocaleString("es-ES",{month:"long"});await o.sendMessage({studentId:r,teacherId:a,text:`ðŸ’° He pagado la mensualidad de ${x} (${g}â‚¬)`,sender:"student",timestamp:Date.now(),type:"payment_request"})}else m.error(t.message)}catch(t){console.error("Payment error",t),m.error("Error al procesar el pago")}finally{N(!1)}};return i?e.jsxs("div",{className:"max-w-4xl mx-auto h-[calc(100vh-100px)] flex flex-col pt-8 px-4 animate-fade-in",children:[e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl border border-white/10 rounded-t-3xl p-4 flex items-center justify-between shadow-2xl z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>b(-1),className:"p-2 hover:bg-white/5 rounded-full text-text-muted transition-colors",children:e.jsx(W,{size:20})}),e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i.image,alt:i.name,className:"w-12 h-12 rounded-2xl object-cover border border-white/10 shadow-lg"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-[#161512] rounded-full shadow-lg"})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-white text-lg leading-tight tracking-tight",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] uppercase font-black tracking-widest text-[#8b8982]",children:s==="student"?"Profesor":"Estudiante"}),e.jsx("span",{className:"w-1 h-1 bg-white/20 rounded-full"}),e.jsxs("span",{className:"text-[10px] uppercase font-black tracking-widest text-gold/80",children:["ELO ",i.elo]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[s==="student"&&c==="approved"&&e.jsx(u,{variant:"gold",size:"sm",onClick:()=>p(!0),icon:P,children:"Pagar"}),c==="approved"&&e.jsx(u,{variant:"white",size:"sm",onClick:()=>b(s==="student"?`/classroom/${a}`:`/classroom/${r}`),icon:C,children:"Aula"}),c==="pending"&&e.jsxs("div",{className:"px-4 py-2 bg-orange-500/10 text-orange-400 border border-orange-500/20 rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center gap-2 shadow-inner",children:[e.jsx(H,{size:12,strokeWidth:3})," ",s==="student"?"Esperando Respuesta":"Pendiente"]})]})]}),e.jsxs("div",{className:"flex-grow bg-black/20 backdrop-blur-sm border-x border-white/5 p-6 overflow-y-auto space-y-6 custom-scrollbar scroll-smooth",children:[h.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center opacity-40 space-y-4",children:[e.jsx("div",{className:"p-6 rounded-full bg-white/5 border border-white/5",children:e.jsx(S,{size:40,strokeWidth:1,className:"text-white/30"})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium text-white max-w-[200px]",children:s==="student"?`CuÃ©ntale a ${i.name} por quÃ© quieres aprender ajedrez.`:`Inicio del chat con ${i.name}.`})})]}):e.jsx("div",{className:"space-y-4",children:h.map((t,x)=>{const l=t.sender===s;return e.jsx(f.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},className:`flex ${l?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`group relative max-w-[75%] px-5 py-3 shadow-2xl transition-all duration-300 ${l?"bg-gold text-black rounded-3xl rounded-tr-none":"bg-white/5 backdrop-blur-md text-white border border-white/10 rounded-3xl rounded-tl-none"}`,children:[e.jsx("p",{className:"text-sm leading-relaxed font-medium whitespace-pre-wrap",children:t.text}),e.jsxs("div",{className:`text-[10px] font-bold mt-1.5 opacity-40 flex items-center gap-1 ${l?"justify-end":"justify-start"}`,children:[new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),l&&e.jsx(C,{size:10})]})]})},t.id||x)})}),e.jsx("div",{ref:v})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl border border-white/10 rounded-b-3xl p-4 flex gap-4 shadow-[0_-20px_50px_rgba(0,0,0,0.5)]",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx("input",{type:"text",value:d,onChange:t=>w(t.target.value),onKeyDown:t=>t.key==="Enter"&&k(),placeholder:c==="approved"?"Escribe un mensaje...":"Escribe para presentarte...",className:"w-full bg-black/40 border border-white/10 text-white text-sm rounded-2xl px-5 py-3.5 focus:outline-none focus:ring-2 focus:ring-gold/50 focus:border-transparent transition-all placeholder:text-white/20 shadow-inner"})}),e.jsx(u,{onClick:k,disabled:!d.trim(),className:"!rounded-2xl shadow-xl shadow-gold/10",icon:S,children:e.jsx("span",{className:"hidden sm:inline",children:"Enviar"})})]}),e.jsx(B,{children:$&&e.jsx(f.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 backdrop-blur-xl z-[60] flex items-center justify-center p-4",children:e.jsxs(f.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-[#1a1917] w-full max-w-sm rounded-[40px] border border-white/10 shadow-[0_0_100px_rgba(212,175,55,0.15)] overflow-hidden",children:[e.jsxs("div",{className:"p-8 text-center border-b border-white/5 bg-gradient-to-b from-white/5 to-transparent",children:[e.jsx("div",{className:"w-20 h-20 bg-gold/10 rounded-[30px] border border-gold/30 flex items-center justify-center mx-auto mb-6 shadow-2xl shadow-gold/5",children:e.jsx(P,{size:40,className:"text-gold"})}),e.jsx("h3",{className:"text-2xl font-black text-white tracking-tight",children:"SuscripciÃ³n Premium"}),e.jsx("p",{className:"text-sm font-bold text-text-muted mt-2 uppercase tracking-widest",children:i.name})]}),e.jsxs("div",{className:"p-10",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsxs("div",{className:"text-5xl font-black text-white flex items-center justify-center gap-1",children:[g,e.jsx("span",{className:"text-2xl text-gold font-light",children:"â‚¬"})]}),e.jsx("p",{className:"text-xs font-bold text-[#8b8982] mt-2 uppercase tracking-[0.2em]",children:"Pago Mensual"})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(u,{onClick:D,disabled:y,className:"w-full !rounded-[24px] !py-5 shadow-2xl shadow-gold/20",size:"lg",children:y?"Procesando...":"Confirmar Pago"}),e.jsx("button",{onClick:()=>p(!1),className:"w-full py-4 text-[#666] hover:text-white font-black text-xs uppercase tracking-widest transition-all",children:"Cancelar"})]})]})]})})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-dark-bg text-gold",children:e.jsx("div",{className:"w-12 h-12 border-4 border-gold/30 border-t-gold rounded-full animate-spin"})})};export{Q as default};
