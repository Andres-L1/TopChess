import{k as u,u as h,a as f,R as m,r as p,j as c,z as r,f as b}from"./index-T5cuqC96.js";import{l as d}from"./lichessService-CGkUorkZ.js";const w=()=>{const[a]=u(),s=h(),{currentUserId:t}=f(),n=m.useRef(!1);return p.useEffect(()=>{if(n.current)return;(async()=>{const i=a.get("code");if(a.get("error")){r.error("Error al autorizar con Lichess"),s("/dashboard");return}if(!i)return;n.current=!0;const l=sessionStorage.getItem("lichess_code_verifier");if(!l){r.error("Sesión de autenticación expirada"),s("/dashboard");return}try{const e=await d.exchangeCodeForToken(i,l);if(e){const o=await d.getAuthUser(e);if(o)await b.updateTeacher(t,{lichessAccessToken:e,lichessUsername:o.username}),r.success(`¡Conectado como ${o.username}!`);else throw new Error("No se pudo obtener el perfil de Lichess");sessionStorage.removeItem("lichess_code_verifier")}else r.error("No se pudo obtener el token de acceso")}catch(e){console.error(e),r.error("Error en la sincronización")}finally{s("/dashboard")}})()},[a,s,t]),c.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-4",children:[c.jsx("div",{className:"w-12 h-12 border-4 border-gold/30 border-t-gold rounded-full animate-spin"}),c.jsx("p",{className:"text-white/60 font-medium animate-pulse",children:"Estableciendo conexión segura con Lichess..."})]})};export{w as default};
