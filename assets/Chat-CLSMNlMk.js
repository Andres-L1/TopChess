import{h as T,a as L,u as B,r as n,j as e,m as b,A as W,f as l,z as m}from"./index-T5cuqC96.js";import{P as u}from"./PremiumButton-BUO13sOM.js";import{C as H,S as C}from"./send-BJAej-ei.js";import{D as S}from"./dollar-sign-CnsC6zDt.js";import{C as E}from"./circle-check-big-vIiCkPY8.js";import{C as K}from"./clock-D3di33pq.js";const U=()=>{const{teacherId:z}=T(),{userRole:s,currentUserId:r,currentUser:p}=L(),w=B(),a=z,[h,I]=n.useState([]),[c,j]=n.useState(""),[o,y]=n.useState(null),[i,$]=n.useState(null),N=n.useRef(null),[D,g]=n.useState(!1),[f]=n.useState(59),[v,k]=n.useState(!1);n.useEffect(()=>{let t;return r&&a&&(async()=>{try{const d=await l.getPublicProfile(a);$(d);const q=await l.getRequestStatus(s==="student"?r:a,s==="student"?a:r);y(q);const M=s==="student"?r:a,A=s==="student"?a:r;t=l.subscribeToChat(M,A,R=>{I(R)})}catch(d){console.error("Chat init error",d)}})(),()=>{t&&t()}},[a,r,s]),n.useEffect(()=>{var t;(t=N.current)==null||t.scrollIntoView({behavior:"smooth"})},[h]);const P=async()=>{if(c.trim())try{const t={studentId:s==="student"?r:a,teacherId:s==="student"?a:r,text:c,sender:s||"student",timestamp:Date.now(),type:"text"};s==="student"&&!o&&(await l.createRequest({id:`req_${Date.now()}`,studentId:r,studentName:(p==null?void 0:p.displayName)||"Estudiante",teacherId:a,status:"pending",timestamp:Date.now()}),y("pending")),await l.sendMessage(t),j("")}catch{m.error("Error al enviar mensaje")}},_=async()=>{k(!0);try{const t=await l.processPayment(r,a,f);if(t.success){m.success(t.message),g(!1);const x=new Date().toLocaleString("es-ES",{month:"long"});await l.sendMessage({studentId:r,teacherId:a,text:`ðŸ’° He pagado la mensualidad de ${x} (${f}â‚¬)`,sender:"student",timestamp:Date.now(),type:"payment_request"})}else m.error(t.message)}catch(t){console.error("Payment error",t),m.error("Error al procesar el pago")}finally{k(!1)}};return i?e.jsxs("div",{className:"max-w-4xl mx-auto h-[calc(100vh-80px)] md:h-[calc(100vh-100px)] flex flex-col pt-4 md:pt-8 px-2 md:px-4 animate-fade-in pb-20 md:pb-0",children:[e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl border border-white/10 rounded-t-3xl p-4 flex items-center justify-between shadow-2xl z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-4 flex-1 min-w-0",children:[e.jsx("button",{onClick:()=>w(-1),className:"p-1 md:p-2 hover:bg-white/5 rounded-full text-text-muted transition-colors",children:e.jsx(H,{size:20})}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("img",{src:i.image,alt:i.name,className:"w-10 h-10 md:w-12 md:h-12 rounded-xl md:rounded-2xl object-cover border border-white/10 shadow-lg"}),e.jsx("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 md:w-4 md:h-4 bg-green-500 border-2 border-[#161512] rounded-full shadow-lg"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"font-bold text-white text-sm md:text-lg leading-tight tracking-tight truncate",children:i.name}),e.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[e.jsx("span",{className:"text-[8px] md:text-[10px] uppercase font-black tracking-widest text-[#8b8982] truncate",children:s==="student"?"Profesor":"Alumno"}),e.jsx("span",{className:"w-1 h-1 bg-white/20 rounded-full"}),e.jsxs("span",{className:"text-[8px] md:text-[10px] uppercase font-black tracking-widest text-gold/80 flex-shrink-0",children:["ELO ",i.elo]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 md:gap-3 ml-2",children:[s==="student"&&o==="approved"&&e.jsx(u,{variant:"gold",size:"sm",onClick:()=>g(!0),icon:S,className:"!px-2 md:!px-4 !py-1 text-[10px] md:text-xs",children:e.jsx("span",{className:"hidden sm:inline",children:"Pagar"})}),o==="approved"&&e.jsx(u,{variant:"white",size:"sm",onClick:()=>w(s==="student"?`/classroom/${a}`:`/classroom/${r}`),icon:E,className:"!px-2 md:!px-4 !py-1 text-[10px] md:text-xs",children:"Aula"}),o==="pending"&&e.jsxs("div",{className:"px-2 md:px-4 py-1.5 md:py-2 bg-orange-500/10 text-orange-400 border border-orange-500/20 rounded-lg md:rounded-xl text-[8px] md:text-[10px] font-black uppercase tracking-widest flex items-center gap-1 md:gap-2 shadow-inner",children:[e.jsx(K,{size:10,className:"md:w-3 md:h-3",strokeWidth:3})," ",e.jsx("span",{className:"hidden xs:inline",children:s==="student"?"Esperando":"Pendiente"}),e.jsx("span",{className:"xs:hidden",children:"..."})]})]})]}),e.jsxs("div",{className:"flex-grow bg-black/20 backdrop-blur-sm border-x border-white/5 p-6 overflow-y-auto space-y-6 custom-scrollbar scroll-smooth",children:[h.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center opacity-40 space-y-4",children:[e.jsx("div",{className:"p-6 rounded-full bg-white/5 border border-white/5",children:e.jsx(C,{size:40,strokeWidth:1,className:"text-white/30"})}),e.jsx("div",{children:e.jsx("p",{className:"text-sm font-medium text-white max-w-[200px]",children:s==="student"?`CuÃ©ntale a ${i.name} por quÃ© quieres aprender ajedrez.`:`Inicio del chat con ${i.name}.`})})]}):e.jsx("div",{className:"space-y-4",children:h.map((t,x)=>{const d=t.sender===s;return e.jsx(b.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},className:`flex ${d?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`group relative max-w-[75%] px-5 py-3 shadow-2xl transition-all duration-300 ${d?"bg-gold text-black rounded-3xl rounded-tr-none":"bg-white/5 backdrop-blur-md text-white border border-white/10 rounded-3xl rounded-tl-none"}`,children:[e.jsx("p",{className:"text-sm leading-relaxed font-medium whitespace-pre-wrap",children:t.text}),e.jsxs("div",{className:`text-[10px] font-bold mt-1.5 opacity-40 flex items-center gap-1 ${d?"justify-end":"justify-start"}`,children:[new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d&&e.jsx(E,{size:10})]})]})},t.id||x)})}),e.jsx("div",{ref:N})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl border border-white/10 rounded-b-3xl p-4 flex gap-4 shadow-[0_-20px_50px_rgba(0,0,0,0.5)]",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx("input",{type:"text",value:c,onChange:t=>j(t.target.value),onKeyDown:t=>t.key==="Enter"&&P(),placeholder:o==="approved"?"Escribe un mensaje...":"Escribe para presentarte...",className:"w-full bg-black/40 border border-white/10 text-white text-sm rounded-2xl px-5 py-3.5 focus:outline-none focus:ring-2 focus:ring-gold/50 focus:border-transparent transition-all placeholder:text-white/20 shadow-inner"})}),e.jsx(u,{onClick:P,disabled:!c.trim(),className:"!rounded-2xl shadow-xl shadow-gold/10",icon:C,children:e.jsx("span",{className:"hidden sm:inline",children:"Enviar"})})]}),e.jsx(W,{children:D&&e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 backdrop-blur-xl z-[60] flex items-center justify-center p-4",children:e.jsxs(b.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},className:"bg-[#1a1917] w-full max-w-sm rounded-[40px] border border-white/10 shadow-[0_0_100px_rgba(212,175,55,0.15)] overflow-hidden",children:[e.jsxs("div",{className:"p-8 text-center border-b border-white/5 bg-gradient-to-b from-white/5 to-transparent",children:[e.jsx("div",{className:"w-20 h-20 bg-gold/10 rounded-[30px] border border-gold/30 flex items-center justify-center mx-auto mb-6 shadow-2xl shadow-gold/5",children:e.jsx(S,{size:40,className:"text-gold"})}),e.jsx("h3",{className:"text-2xl font-black text-white tracking-tight",children:"SuscripciÃ³n Premium"}),e.jsx("p",{className:"text-sm font-bold text-text-muted mt-2 uppercase tracking-widest",children:i.name})]}),e.jsxs("div",{className:"p-10",children:[e.jsxs("div",{className:"text-center mb-10",children:[e.jsxs("div",{className:"text-5xl font-black text-white flex items-center justify-center gap-1",children:[f,e.jsx("span",{className:"text-2xl text-gold font-light",children:"â‚¬"})]}),e.jsx("p",{className:"text-xs font-bold text-[#8b8982] mt-2 uppercase tracking-[0.2em]",children:"Pago Mensual"})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(u,{onClick:_,disabled:v,className:"w-full !rounded-[24px] !py-5 shadow-2xl shadow-gold/20",size:"lg",children:v?"Procesando...":"Confirmar Pago"}),e.jsx("button",{onClick:()=>g(!1),className:"w-full py-4 text-[#666] hover:text-white font-black text-xs uppercase tracking-widest transition-all",children:"Cancelar"})]})]})]})})})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-dark-bg text-gold",children:e.jsx("div",{className:"w-12 h-12 border-4 border-gold/30 border-t-gold rounded-full animate-spin"})})};export{U as default};
